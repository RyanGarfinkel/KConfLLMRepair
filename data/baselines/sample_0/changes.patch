diff --git a/.clang-format b/.clang-format
index 48405c54ef27..f371a13b4d19 100644
--- a/.clang-format
+++ b/.clang-format
@@ -294,7 +294,6 @@ ForEachMacros:
   - 'for_each_fib6_node_rt_rcu'
   - 'for_each_fib6_walker_rt'
   - 'for_each_file_lock'
-  - 'for_each_free_mem_pfn_range_in_zone_from'
   - 'for_each_free_mem_range'
   - 'for_each_free_mem_range_reverse'
   - 'for_each_func_rsrc'
diff --git a/Documentation/ABI/testing/debugfs-cxl b/Documentation/ABI/testing/debugfs-cxl
index e95e21f131e9..2989d4da96c1 100644
--- a/Documentation/ABI/testing/debugfs-cxl
+++ b/Documentation/ABI/testing/debugfs-cxl
@@ -19,6 +19,20 @@ Description:
 		is returned to the user. The inject_poison attribute is only
 		visible for devices supporting the capability.
 
+		TEST-ONLY INTERFACE: This interface is intended for testing
+		and validation purposes only. It is not a data repair mechanism
+		and should never be used on production systems or live data.
+
+		DATA LOSS RISK: For CXL persistent memory (PMEM) devices,
+		poison injection can result in permanent data loss. Injected
+		poison may render data permanently inaccessible even after
+		clearing, as the clear operation writes zeros and does not
+		recover original data.
+
+		SYSTEM STABILITY RISK: For volatile memory, poison injection
+		can cause kernel crashes, system instability, or unpredictable
+		behavior if the poisoned addresses are accessed by running code
+		or critical kernel structures.
 
 What:		/sys/kernel/debug/cxl/memX/clear_poison
 Date:		April, 2023
@@ -35,6 +49,79 @@ Description:
 		The clear_poison attribute is only visible for devices
 		supporting the capability.
 
+		TEST-ONLY INTERFACE: This interface is intended for testing
+		and validation purposes only. It is not a data repair mechanism
+		and should never be used on production systems or live data.
+
+		CLEAR IS NOT DATA RECOVERY: This operation writes zeros to the
+		specified address range and removes the address from the poison
+		list. It does NOT recover or restore original data that may have
+		been present before poison injection. Any original data at the
+		cleared address is permanently lost and replaced with zeros.
+
+		CLEAR IS NOT A REPAIR MECHANISM: This interface is for testing
+		purposes only and should not be used as a data repair tool.
+		Clearing poison is fundamentally different from data recovery
+		or error correction.
+
+What:		/sys/kernel/debug/cxl/regionX/inject_poison
+Date:		August, 2025
+Contact:	linux-cxl@vger.kernel.org
+Description:
+		(WO) When a Host Physical Address (HPA) is written to this
+		attribute, the region driver translates it to a Device
+		Physical Address (DPA) and identifies the corresponding
+		memdev. It then sends an inject poison command to that memdev
+		at the translated DPA. Refer to the memdev ABI entry at:
+		/sys/kernel/debug/cxl/memX/inject_poison for the detailed
+		behavior. This attribute is only visible if all memdevs
+		participating in the region support both inject and clear
+		poison commands.
+
+		TEST-ONLY INTERFACE: This interface is intended for testing
+		and validation purposes only. It is not a data repair mechanism
+		and should never be used on production systems or live data.
+
+		DATA LOSS RISK: For CXL persistent memory (PMEM) devices,
+		poison injection can result in permanent data loss. Injected
+		poison may render data permanently inaccessible even after
+		clearing, as the clear operation writes zeros and does not
+		recover original data.
+
+		SYSTEM STABILITY RISK: For volatile memory, poison injection
+		can cause kernel crashes, system instability, or unpredictable
+		behavior if the poisoned addresses are accessed by running code
+		or critical kernel structures.
+
+What:		/sys/kernel/debug/cxl/regionX/clear_poison
+Date:		August, 2025
+Contact:	linux-cxl@vger.kernel.org
+Description:
+		(WO) When a Host Physical Address (HPA) is written to this
+		attribute, the region driver translates it to a Device
+		Physical Address (DPA) and identifies the corresponding
+		memdev. It then sends a clear poison command to that memdev
+		at the translated DPA. Refer to the memdev ABI entry at:
+		/sys/kernel/debug/cxl/memX/clear_poison for the detailed
+		behavior. This attribute is only visible if all memdevs
+		participating in the region support both inject and clear
+		poison commands.
+
+		TEST-ONLY INTERFACE: This interface is intended for testing
+		and validation purposes only. It is not a data repair mechanism
+		and should never be used on production systems or live data.
+
+		CLEAR IS NOT DATA RECOVERY: This operation writes zeros to the
+		specified address range and removes the address from the poison
+		list. It does NOT recover or restore original data that may have
+		been present before poison injection. Any original data at the
+		cleared address is permanently lost and replaced with zeros.
+
+		CLEAR IS NOT A REPAIR MECHANISM: This interface is for testing
+		purposes only and should not be used as a data repair tool.
+		Clearing poison is fundamentally different from data recovery
+		or error correction.
+
 What:		/sys/kernel/debug/cxl/einj_types
 Date:		January, 2024
 KernelVersion:	v6.9
diff --git a/Documentation/driver-api/cxl/conventions.rst b/Documentation/driver-api/cxl/conventions.rst
index da347a81a237..e37336d7b116 100644
--- a/Documentation/driver-api/cxl/conventions.rst
+++ b/Documentation/driver-api/cxl/conventions.rst
@@ -45,3 +45,138 @@ Detailed Description of the Change
 ----------------------------------
 
 <Propose spec language that corrects the conflict.>
+
+
+Resolve conflict between CFMWS, Platform Memory Holes, and Endpoint Decoders
+============================================================================
+
+Document
+--------
+
+CXL Revision 3.2, Version 1.0
+
+License
+-------
+
+SPDX-License Identifier: CC-BY-4.0
+
+Creator/Contributors
+--------------------
+
+- Fabio M. De Francesco, Intel
+- Dan J. Williams, Intel
+- Mahesh Natu, Intel
+
+Summary of the Change
+---------------------
+
+According to the current Compute Express Link (CXL) Specifications (Revision
+3.2, Version 1.0), the CXL Fixed Memory Window Structure (CFMWS) describes zero
+or more Host Physical Address (HPA) windows associated with each CXL Host
+Bridge. Each window represents a contiguous HPA range that may be interleaved
+across one or more targets, including CXL Host Bridges. Each window has a set
+of restrictions that govern its usage. It is the Operating System-directed
+configuration and Power Management (OSPM) responsibility to utilize each window
+for the specified use.
+
+Table 9-22 of the current CXL Specifications states that the Window Size field
+contains the total number of consecutive bytes of HPA this window describes.
+This value must be a multiple of the Number of Interleave Ways (NIW) * 256 MB.
+
+Platform Firmware (BIOS) might reserve physical addresses below 4 GB where a
+memory gap such as the Low Memory Hole for PCIe MMIO may exist. In such cases,
+the CFMWS Range Size may not adhere to the NIW * 256 MB rule.
+
+The HPA represents the actual physical memory address space that the CXL devices
+can decode and respond to, while the System Physical Address (SPA), a related
+but distinct concept, represents the system-visible address space that users can
+direct transaction to and so it excludes reserved regions.
+
+BIOS publishes CFMWS to communicate the active SPA ranges that, on platforms
+with LMH's, map to a strict subset of the HPA. The SPA range trims out the hole,
+resulting in lost capacity in the Endpoints with no SPA to map to that part of
+the HPA range that intersects the hole.
+
+E.g, an x86 platform with two CFMWS and an LMH starting at 2 GB:
+
+ +--------+------------+-------------------+------------------+-------------------+------+
+ | Window | CFMWS Base |    CFMWS Size     | HDM Decoder Base |  HDM Decoder Size | Ways |
+ +========+============+===================+==================+===================+======+
+ |   0    |   0 GB     |       2 GB        |      0 GB        |       3 GB        |  12  |
+ +--------+------------+-------------------+------------------+-------------------+------+
+ |   1    |   4 GB     | NIW*256MB Aligned |      4 GB        | NIW*256MB Aligned |  12  |
+ +--------+------------+-------------------+------------------+-------------------+------+
+
+HDM decoder base and HDM decoder size represent all the 12 Endpoint Decoders of
+a 12 ways region and all the intermediate Switch Decoders. They are configured
+by the BIOS according to the NIW * 256MB rule, resulting in a HPA range size of
+3GB. Instead, the CFMWS Base and CFMWS Size are used to configure the Root
+Decoder HPA range that results smaller (2GB) than that of the Switch and
+Endpoint Decoders in the hierarchy (3GB).
+
+This creates 2 issues which lead to a failure to construct a region:
+
+1) A mismatch in region size between root and any HDM decoder. The root decoders
+   will always be smaller due to the trim.
+
+2) The trim causes the root decoder to violate the (NIW * 256MB) rule.
+
+This change allows a region with a base address of 0GB to bypass these checks to
+allow for region creation with the trimmed root decoder address range.
+
+This change does not allow for any other arbitrary region to violate these
+checks - it is intended exclusively to enable x86 platforms which map CXL memory
+under 4GB.
+
+Despite the HDM decoders covering the PCIE hole HPA region, it is expected that
+the platform will never route address accesses to the CXL complex because the
+root decoder only covers the trimmed region (which excludes this). This is
+outside the ability of Linux to enforce.
+
+On the example platform, only the first 2GB will be potentially usable, but
+Linux, aiming to adhere to the current specifications, fails to construct
+Regions and attach Endpoint and intermediate Switch Decoders to them.
+
+There are several points of failure that due to the expectation that the Root
+Decoder HPA size, that is equal to the CFMWS from which it is configured, has
+to be greater or equal to the matching Switch and Endpoint HDM Decoders.
+
+In order to succeed with construction and attachment, Linux must construct a
+Region with Root Decoder HPA range size, and then attach to that all the
+intermediate Switch Decoders and Endpoint Decoders that belong to the hierarchy
+regardless of their range sizes.
+
+Benefits of the Change
+----------------------
+
+Without the change, the OSPM wouldn't match intermediate Switch and Endpoint
+Decoders with Root Decoders configured with CFMWS HPA sizes that don't align
+with the NIW * 256MB constraint, and so it leads to lost memdev capacity.
+
+This change allows the OSPM to construct Regions and attach intermediate Switch
+and Endpoint Decoders to them, so that the addressable part of the memory
+devices total capacity is made available to the users.
+
+References
+----------
+
+Compute Express Link Specification Revision 3.2, Version 1.0
+<https://www.computeexpresslink.org/>
+
+Detailed Description of the Change
+----------------------------------
+
+The description of the Window Size field in table 9-22 needs to account for
+platforms with Low Memory Holes, where SPA ranges might be subsets of the
+endpoints HPA. Therefore, it has to be changed to the following:
+
+"The total number of consecutive bytes of HPA this window represents. This value
+shall be a multiple of NIW * 256 MB.
+
+On platforms that reserve physical addresses below 4 GB, such as the Low Memory
+Hole for PCIe MMIO on x86, an instance of CFMWS whose Base HPA range is 0 might
+have a size that doesn't align with the NIW * 256 MB constraint.
+
+Note that the matching intermediate Switch Decoders and the Endpoint Decoders
+HPA range sizes must still align to the above-mentioned rule, but the memory
+capacity that exceeds the CFMWS window size won't be accessible.".
diff --git a/Documentation/driver-api/cxl/maturity-map.rst b/Documentation/driver-api/cxl/maturity-map.rst
index 1330f3f52129..282c1102dd81 100644
--- a/Documentation/driver-api/cxl/maturity-map.rst
+++ b/Documentation/driver-api/cxl/maturity-map.rst
@@ -173,7 +173,7 @@ Accelerator
 User Flow Support
 -----------------
 
-* [0] Inject & clear poison by HPA
+* [2] Inject & clear poison by region offset
 
 Details
 =======
diff --git a/Documentation/driver-api/cxl/platform/bios-and-efi.rst b/Documentation/driver-api/cxl/platform/bios-and-efi.rst
index 645322632cc9..a9aa0ccd92af 100644
--- a/Documentation/driver-api/cxl/platform/bios-and-efi.rst
+++ b/Documentation/driver-api/cxl/platform/bios-and-efi.rst
@@ -202,7 +202,7 @@ future and such a configuration should be avoided.
 
 Memory Holes
 ------------
-If your platform includes memory holes intersparsed between your CXL memory, it
+If your platform includes memory holes interspersed between your CXL memory, it
 is recommended to utilize multiple decoders to cover these regions of memory,
 rather than try to program the decoders to accept the entire range and expect
 Linux to manage the overlap.
diff --git a/Documentation/gpu/nova/core/todo.rst b/Documentation/gpu/nova/core/todo.rst
index 091a2fb78c6b..0972cb905f7a 100644
--- a/Documentation/gpu/nova/core/todo.rst
+++ b/Documentation/gpu/nova/core/todo.rst
@@ -145,7 +145,6 @@ Numerical operations [NUMM]
 Nova uses integer operations that are not part of the standard library (or not
 implemented in an optimized way for the kernel). These include:
 
-- Aligning up and down to a power of two,
 - The "Find Last Set Bit" (`fls` function of the C part of the kernel)
   operation.
 
diff --git a/Documentation/kbuild/kconfig-language.rst b/Documentation/kbuild/kconfig-language.rst
index a91abb8f6840..abce88f15d7c 100644
--- a/Documentation/kbuild/kconfig-language.rst
+++ b/Documentation/kbuild/kconfig-language.rst
@@ -232,6 +232,38 @@ applicable everywhere (see syntax).
   enables the third modular state for all config symbols.
   At most one symbol may have the "modules" option set.
 
+- transitional attribute: "transitional"
+  This declares the symbol as transitional, meaning it should be processed
+  during configuration but omitted from newly written .config files.
+  Transitional symbols are useful for backward compatibility during config
+  option migrations - they allow olddefconfig to process existing .config
+  files while ensuring the old option doesn't appear in new configurations.
+
+  A transitional symbol:
+  - Has no prompt (is not visible to users in menus)
+  - Is processed normally during configuration (values are read and used)
+  - Can be referenced in default expressions of other symbols
+  - Is not written to new .config files
+  - Cannot have any other properties (it is a pass-through option)
+
+  Example migration from OLD_NAME to NEW_NAME::
+
+    config NEW_NAME
+	bool "New option name"
+	default OLD_NAME
+	help
+	  This replaces the old CONFIG_OLD_NAME option.
+
+    config OLD_NAME
+	bool
+	transitional
+	help
+	  Transitional config for OLD_NAME to NEW_NAME migration.
+
+  With this setup, existing .config files with "CONFIG_OLD_NAME=y" will
+  result in "CONFIG_NEW_NAME=y" being set, while CONFIG_OLD_NAME will be
+  omitted from newly written .config files.
+
 Menu dependencies
 -----------------
 
diff --git a/Documentation/staging/crc32.rst b/Documentation/staging/crc32.rst
index 7542220967cb..64f3dd430a6c 100644
--- a/Documentation/staging/crc32.rst
+++ b/Documentation/staging/crc32.rst
@@ -34,7 +34,7 @@ do it in the right order, matching the endianness.
 Just like with ordinary division, you proceed one digit (bit) at a time.
 Each step of the division you take one more digit (bit) of the dividend
 and append it to the current remainder.  Then you figure out the
-appropriate multiple of the divisor to subtract to being the remainder
+appropriate multiple of the divisor to subtract to bring the remainder
 back into range.  In binary, this is easy - it has to be either 0 or 1,
 and to make the XOR cancel, it's just a copy of bit 32 of the remainder.
 
@@ -116,7 +116,7 @@ for any fractional bytes at the end.
 To reduce the number of conditional branches, software commonly uses
 the byte-at-a-time table method, popularized by Dilip V. Sarwate,
 "Computation of Cyclic Redundancy Checks via Table Look-Up", Comm. ACM
-v.31 no.8 (August 1998) p. 1008-1013.
+v.31 no.8 (August 1988) p. 1008-1013.
 
 Here, rather than just shifting one bit of the remainder to decide
 in the correct multiple to subtract, we can shift a byte at a time.
diff --git a/MAINTAINERS b/MAINTAINERS
index 649c3fc5dcaa..343948543711 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -4332,6 +4332,7 @@ F:	include/linux/bits.h
 F:	include/linux/cpumask.h
 F:	include/linux/cpumask_types.h
 F:	include/linux/find.h
+F:	include/linux/hw_bitfield.h
 F:	include/linux/nodemask.h
 F:	include/linux/nodemask_types.h
 F:	include/uapi/linux/bits.h
@@ -4355,8 +4356,18 @@ F:	tools/lib/find_bit.c
 BITMAP API BINDINGS [RUST]
 M:	Yury Norov <yury.norov@gmail.com>
 S:	Maintained
+F:	rust/helpers/bitmap.c
 F:	rust/helpers/cpumask.c
 
+BITMAP API [RUST]
+M:	Alice Ryhl <aliceryhl@google.com>
+M:	Burak Emir <bqe@google.com>
+R:	Yury Norov <yury.norov@gmail.com>
+S:	Maintained
+F:	lib/find_bit_benchmark_rust.rs
+F:	rust/kernel/bitmap.rs
+F:	rust/kernel/id_pool.rs
+
 BITOPS API
 M:	Yury Norov <yury.norov@gmail.com>
 R:	Rasmus Villemoes <linux@rasmusvillemoes.dk>
@@ -4371,6 +4382,11 @@ F:	include/linux/bitops.h
 F:	lib/test_bitops.c
 F:	tools/*/bitops*
 
+BITOPS API BINDINGS [RUST]
+M:	Yury Norov <yury.norov@gmail.com>
+S:	Maintained
+F:	rust/helpers/bitops.c
+
 BLINKM RGB LED DRIVER
 M:	Jan-Simon Moeller <jansimon.moeller@gmx.de>
 S:	Maintained
@@ -10377,7 +10393,7 @@ L:	linux-kernel@vger.kernel.org
 S:	Maintained
 T:	git git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git core/entry
 F:	include/linux/entry-common.h
-F:	include/linux/entry-kvm.h
+F:	include/linux/entry-virt.h
 F:	include/linux/irq-entry-common.h
 F:	kernel/entry/
 
@@ -18304,6 +18320,7 @@ F:	Documentation/core-api/symbol-namespaces.rst
 F:	scripts/nsdeps
 
 NTB AMD DRIVER
+M:	Basavaraj Natikar <Basavaraj.Natikar@amd.com>
 M:	Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
 L:	ntb@lists.linux.dev
 S:	Supported
diff --git a/Makefile b/Makefile
index 45001a6438d5..2b5b5399730a 100644
--- a/Makefile
+++ b/Makefile
@@ -1017,7 +1017,7 @@ KBUILD_AFLAGS	+= -fno-lto
 export CC_FLAGS_LTO
 endif
 
-ifdef CONFIG_CFI_CLANG
+ifdef CONFIG_CFI
 CC_FLAGS_CFI	:= -fsanitize=kcfi
 ifdef CONFIG_CFI_ICALL_NORMALIZE_INTEGERS
 	CC_FLAGS_CFI	+= -fsanitize-cfi-icall-experimental-normalize-integers
diff --git a/Next/SHA1s b/Next/SHA1s
new file mode 100644
index 000000000000..e544a5a001e8
--- /dev/null
+++ b/Next/SHA1s
@@ -0,0 +1,409 @@
+Name		SHA1
+----		----
+origin		e5f0a698b34ed76002dc5cff3804a61c80233a7a
+fixes		89be9a83ccf1f88522317ce02f854f30d6115c41
+ext4-fixes	d0b3b7b22dfa1f4b515fd3a295b3fd958f9e81af
+vfs-brauner-fixes	4d428dca252c858bfac691c31fa95d26cd008706
+fscrypt-current	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+fsverity-current	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+btrfs-fixes	71db937b4e0c04dd5b1784da3abce24704796633
+vfs-fixes	00e782110428366d553c94401c2e46bbb2a1b2ac
+erofs-fixes	f83ec76bf285bea5727f478a68b894f5543ca76e
+nfsd-fixes	bee47cb026e762841f3faece47b51f985e215edb
+v9fs-fixes	2014c95afecee3e76ca4a56956a936e23283f05b
+overlayfs-fixes	e8bd877fb76bb9f35253e8f41ce0c772269934dd
+fscrypt		19591f7e781fd1e68228f5b3bee60be6425af886
+btrfs		975e8386564fa78c65045e601ee087904026efba
+ceph		c22ec9a59b43cf4a274c44f445348905c3f10fd0
+cifs		3893198177151ca5712942e0efc7158c15f5f638
+configfs	462272dd734b568f0190d01e24f5257c1a763fae
+ecryptfs	fba133a3411847db49297c965218400c49571ebd
+dlm		8e40210788636619404871df07445fa4590138b4
+erofs		e2d3af0d64e5fe2ee269e8f082642f82bcca3903
+exfat		6558447ace6122794873ed9930fbefc995923dc0
+exportfs	adc218676eef25575469234709c2d87185ca223a
+ext3		25554ea0b42b65dd1156430c711fc502292f4a5e
+ext4		acf943e9768ec9d9be80982ca0ebc4bfd6b7631e
+f2fs		c872b6279cd26762339ff02513e2a3f16149a6f1
+fsverity	a1f692fd69ccdbe1e492d366788b63227d429753
+fuse		d3906d8f3cee0279d459dc88b5a871fcdcd4b236
+gfs2		28c4d9bc0708956c1a736a9e49fee71b65deee81
+jfs		cafc6679824a026998d93e7435f6005f64e515d2
+ksmbd		022e5d45d6351a3b9466428a49ea534e519eaf54
+nfs		07e27ad16399afcd693be20211b0dfae63e0615f
+nfs-anna	20b1d75fb840cc27490028a5b13914e22375f273
+nfsd		db155b7c7c85b5f14edec21e164001a168581ffb
+ntfs3		7d460636b6402343ca150682f7bae896c4ff2a76
+orangefs	9a8e34089020d82d017ff0aae26cdf5ed8b7df05
+overlayfs	ad1423922781e6552f18d055a5742b1cff018cdc
+ubifs		99dbb2a1bd661418be33b1ff1462c09b7d2221cf
+v9fs		528f218b31aac4bbfc58914d43766a22ab545d48
+v9fs-ericvh	2014c95afecee3e76ca4a56956a936e23283f05b
+xfs		c91d38b57f2c4784d885c874b2a1234a01361afd
+zonefs		a42938e80357a13f8b8592111e63f2e33a919863
+vfs-brauner	267652e9d4746e5290886a22ac1ac634f054d41d
+vfs		15f5e46385aa4804ef717bc4a37287fcfae7f9a2
+mm-hotfixes	1d1b743290abbe141e5560a4e92b81a530e5e64e
+fs-current	305f7da737d6ec088f4814639286fd4fd200c700
+kbuild-current	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+arc-current	d7b8f8e20813f0179d8ef519541a3527e7661d3a
+arm-current	0c66c6f4e21cb22220cbd8821c5c73fc157d20dc
+arm64-fixes	a7ed7b9d0ebb038db9963d574da0311cab0b666a
+arm-soc-fixes	13923775d5b0b47656e800bec7baf50a20474aaf
+davinci-current	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+drivers-memory-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+sophgo-fixes	19272b37aa4f83ca52bdf9c16d5d81bdd1354494
+sophgo-soc-fixes	0af2f6be1b4281385b618cb86ad946eded089ac8
+m68k-current	695f2c0c25f3c844f9dd177d20c1e8afc55df1ac
+powerpc-fixes	8763d2257f5231cfdfd8a53594647927dbf8bb06
+s390-fixes	ce971233242b5391d99442271f3ca096fb49818d
+net		012ea489aedab1a4c08efbd936bb7be91a06d236
+bpf		bf40f4b87761e2ec16efc8e49b9ca0d81f4115d8
+ipsec		91d8a53db2199eefc73ecf3682e0665ea6895696
+netfilter	4ff71af020ae59ae2d83b174646fc2ad9fcd4dc4
+ipvs		4ff71af020ae59ae2d83b174646fc2ad9fcd4dc4
+wireless	cbf658dd09419f1ef9de11b9604e950bdd5c170b
+ath		cbf658dd09419f1ef9de11b9604e950bdd5c170b
+iwlwifi		a38108a23ab558b834d71d542d32c05ab0fb64d4
+wpan		8ce4f287524c74a118b0af1eebd4b24a8efca57a
+rdma-fixes	85fe9f565d2d5af95ac2bbaa5082b8ce62b039f5
+sound-current	f65dc3b1ab145c9b8b36301256d703c1dd153f71
+sound-asoc-fixes	733a763dd8b3ac2858dd238a91bb3a2fdff4739e
+regmap-fixes	1b237f190eb3d36f52dffe07a40b5eb210280e00
+regulator-fixes	f83ec76bf285bea5727f478a68b894f5543ca76e
+spi-fixes	398a8a4e51dbd03e4103ea596ea4ea037fe67175
+pci-current	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+driver-core.current	f83ec76bf285bea5727f478a68b894f5543ca76e
+tty.current	a699213d4e6ef4286348c6439837990f121e0c03
+usb.current	f83ec76bf285bea5727f478a68b894f5543ca76e
+usb-serial-fixes	f83ec76bf285bea5727f478a68b894f5543ca76e
+phy		f83ec76bf285bea5727f478a68b894f5543ca76e
+staging.current	82a051e2553b9e297cba82a975d9c538b882c79e
+iio-fixes	875e7d357a7f2e77a7f3fc4759d0aa0872c33027
+counter-current	c17b750b3ad9f45f2b6f7e6f7f4679844244f0b9
+char-misc.current	10df039834f84a297c72ec962c0f9b7c8c5ca31a
+soundwire-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+thunderbolt-fixes	07e27ad16399afcd693be20211b0dfae63e0615f
+input-current	30989f67650cbf8dc763f7c22e3a210f70a8d7d0
+crypto-current	1b34cbbf4f011a121ef7b2d7d6e6920a036d5285
+libcrypto-fixes	cdb03b6d1896c2d23f9c47dc779edba0a9241115
+vfio-fixes	c1d9dac0db168198b6f63f460665256dedad9b6e
+kselftest-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+dmaengine-fixes	f83ec76bf285bea5727f478a68b894f5543ca76e
+backlight-fixes	1613e604df0cd359cf2a7fbd9be7a0bcfacfabd0
+mtd-fixes	4550d33e18112a11a740424c4eec063cd58e918c
+mfd-fixes	d9d79e4f7dc935fea96dbf3de524404c08d08b03
+v4l-dvb-fixes	6f6fbd9a0c5a75eee0618c1499cf73cc770b3f52
+reset-fixes	9a52827a9bbbabb461e87bb41174a96a82c0e8ae
+mips-fixes	1b237f190eb3d36f52dffe07a40b5eb210280e00
+at91-fixes	217efb440933bf97a78ef328b211d8a39f4ff171
+omap-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+kvm-fixes	ecd42dd170ea7bacdd9d01d8e74658df8dff621d
+kvms390-fixes	5f9df945d4e862979b50e4ecaba3dc81fb06e8ed
+hwmon-fixes	07e27ad16399afcd693be20211b0dfae63e0615f
+nvdimm-fixes	d0b3b7b22dfa1f4b515fd3a295b3fd958f9e81af
+cxl-fixes	d0b3b7b22dfa1f4b515fd3a295b3fd958f9e81af
+dma-mapping-fixes	7e2368a21741e2db542330b32aa6fdd8908e7cff
+drivers-x86-fixes	3ed17349f18774c24505b0c21dfbd3cc4f126518
+samsung-krzk-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+pinctrl-samsung-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+devicetree-fixes	80af3745ca465c6c47e833c1902004a7fa944f37
+dt-krzk-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+scsi-fixes	5cb782ff3c62c837e4984b6ae9f5d9a423cd5088
+drm-fixes	e5f0a698b34ed76002dc5cff3804a61c80233a7a
+drm-intel-fixes	7f97a0a871d9532f2e1a5ee7d16d0e364215bcac
+mmc-fixes	77a436c93d10d68201bfd4941d1ca3230dfd1f40
+rtc-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+gnss-fixes	1b237f190eb3d36f52dffe07a40b5eb210280e00
+hyperv-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+risc-v-fixes	e24108012ce9662d90093f91d5ffebcbf78da7de
+riscv-dt-fixes	19272b37aa4f83ca52bdf9c16d5d81bdd1354494
+riscv-soc-fixes	0af2f6be1b4281385b618cb86ad946eded089ac8
+fpga-fixes	19272b37aa4f83ca52bdf9c16d5d81bdd1354494
+spdx		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+gpio-brgl-fixes	e5f0a698b34ed76002dc5cff3804a61c80233a7a
+gpio-intel-fixes	19c839a98c731169f06d32e7c9e00c78a0086ebe
+pinctrl-intel-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+auxdisplay-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+kunit-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+memblock-fixes	b3dcc9d1d806fb1e175f85978713eef868531da4
+renesas-fixes	379c590113ce46f605439d4887996c60ab8820cc
+perf-current	20c9ccffccd61b37325a0519fb6d485caeecf7fa
+efi-fixes	05e75ac35ee9e38f96bbfebf1830ec2cace2e7f8
+battery-fixes	1e451977e1703b6db072719b37cd1b8e250b9cc9
+iommufd-fixes	43f6bee02196e56720dd68eea847d213c6e69328
+rust-fixes	51a24b7deaae5c3561965f5b4b27bb9d686add1c
+w1-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+pmdomain-fixes	5fc4ab3269dea6a0b00c7256cb6f6c0101b6a44b
+i2c-host-fixes	07e27ad16399afcd693be20211b0dfae63e0615f
+sparc-fixes	6613476e225e090cc9aad49be7fa504e290dd33d
+clk-fixes	764c921bf0c5ff125989a6c039a344ed211ffda9
+thead-clk-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+pwrseq-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+thead-dt-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+ftrace-fixes	327e28664307d49ce3fa71ba30dcc0007c270974
+ring-buffer-fixes	e4d4b8670c44cdd22212cab3c576e2d317efa67c
+trace-fixes	0db0934e7f9bb624ed98a665890dbe249f65b8fd
+tracefs-fixes	8b55572e51805184353ee7d587c720a51818fb82
+spacemit-fixes	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+tip-fixes	8f9736633f8ca0224d6dd0cf6826044b7b5f9737
+slab-fixes	850470a8413a8a78e772c4f6bd9fe81ec6bd5b0f
+drm-msm-fixes	b5bad77e1e3c7249e4c0c88f98477e1ee7669b63
+uml-fixes	df447a3b4a4b961c9979b4b3ffb74317394b9b40
+fwctl-fixes	f12343013022a92fff0cf22cb7b22b9c909cdbf5
+devsec-tsm-fixes	fba4ceaa242d2bdf4c04b77bda41d32d02d3925d
+drm-rust-fixes	349510052f765b6eb9c2a21d0ffe08ba61fa683c
+drm-misc-fixes	7d9c3442b02ab7dd3c44e20095a178fd57d2eccb
+linus		ffd294d346d185b70e28b1a28abe367bbfe53c04
+mm-stable	89a3ecca49ee889cc1ab4def6caa0452df196efb
+mm-nonmm-stable	3437819c5e7a855b344030bfe15bbd513c28388f
+mm-unstable	32bb854337cd91f81ca70aaf6ddfbbe34c54ce9f
+mm-nonmm-unstable	05b21b507d8f89e5b47aa4709d8c70c536931829
+kbuild		2ea77fca84f07849aa995271271340d262d0c2e9
+clang-format	c147f663b6a5813b9860f3917cc473fb2c462d8d
+perf		c17dda8013495d8132c976cbf349be9949d0fbd1
+compiler-attributes	98f7e32f20d28ec452afb208f9cffc08448a2652
+dma-mapping	ef3d979b3e270b6a41b6f306bfc442253c41a4cd
+asm-generic	edcc8a38b5ac1a3dbd05e113a38a25b937ebefe5
+alpha		1523226edda566057bdd3264ceb56631ddf5f6f7
+arm		015e1729c81b161ac00803f9fafa65bae767e297
+arm64		cb0c5a60a6f7dd7f35fa5b46fd04dfb66b37fc1e
+arm-perf	2084660ad288c998b6f0c885e266deb364f65fba
+arm-soc		205ceac7f90a518c01375ba71c45b581167b52ff
+amlogic		a0c59ce817bca11da800b37df3aab3bbb69c55f1
+asahi-soc	fd4068f052ce4b421824c11d724fa60a2d0bc7b0
+at91		5a410e87e09e29f92cec7a7beb0d5ed2ce31824c
+bmc		54650eac785836a4ab9fb1ba00a2db47a7508457
+broadcom	cd0e2df0bb0c4fdd73c8be489eebef08671c17d0
+cix		de1ab02c6e14bf3d41f183ef4f342b361360f739
+davinci		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+drivers-memory	3804cef4c59742cf695e7b41a9aabe8d5bb25ca2
+fsl		5498f07842cbddd86c725b960acb8e478684ca45
+imx-mxs		ea21fa34164c9ea0a2a5b8714c7e36f54c7fb46e
+mediatek	462e0bb5f2bcab722e72eb36f3a1924fbc8c28c2
+mvebu		86a99e9f53947fd71411c891b5887308e8b19daf
+omap		462bfcbe8834d8deb893e6d1a9a6edcd7d7782f1
+qcom		30bf3ec8cb6b2d2e2f8715388395cbd27cbe4fc9
+renesas		35083f5599e6ef1517370efdaefaa2be2074264f
+reset		1527cd3b89f0db8d71828f86a64dc901415f9be1
+rockchip	bf9bcd2873e57a91da906ceedbb71b8c58167a0f
+samsung-krzk	541a89b87cb63daeee2d6332a1fe54e799821620
+scmi		f7c0a4834a6b5d8816baba6f649f4a47c6d5f1ed
+sophgo		0251a1deaec78252cb311fc8305d3670bc5eee0e
+sophgo-soc	c8754c7deab4cbfa947fa2d656cbaf83771828ef
+spacemit	d2b7cd9be23bd581ed563eb2630f689034d92c0d
+stm32		53c18dc078bb6d9e9dfe2cc0671ab78588c44723
+sunxi		40a65ba440d1a20799eb71a455346f3b80791ead
+tee		fd956758aeed64209051cf3c47540df8c6359dee
+tegra		ed02736cab22e2ffd22703423f661698b7fd2a19
+thead-dt	dfa743da83ab7ba51ec5692d5939ba1bab4b78c1
+ti		f406ed777073029b008bc9492b0e716a031c3549
+xilinx		227cbbdee8c0c691e8ce386091927edd727d3547
+clk		db0809310d8e2bbb5d8c798e3d4a69e2c33b59af
+clk-imx		14be8b7b6cbc0a072c749e46e28d66e0ea6d0857
+clk-renesas	b5788b96cba97da01e1f0e1316133427c1102ff6
+thead-clk	c567bc5fc68c4388c00e11fc65fd14fe86b52070
+csky		2b48804336be69272d43939ff0dc3b0c0a703395
+loongarch	66e2d96b1c5875122bfb94239989d832ccf51477
+m68k		695f2c0c25f3c844f9dd177d20c1e8afc55df1ac
+m68knommu	07e27ad16399afcd693be20211b0dfae63e0615f
+microblaze	438f7cd41765dbe8830009a37f90145b7f05ed39
+mips		c662a6fef10aff3b13befc499335a334205316d5
+openrisc	8c30b0018f9d93391573e091960d257fd9de120a
+parisc-hd	c12503903873f12ad83a44c19cfcd71ff1739506
+powerpc		ef104054a312608deab266f95945057fa73eeaad
+risc-v		41d7b9d85379cdf212ca498939f2c7fb2fa8989d
+riscv-dt	4cce8b2503ab50f75a2dbc3eef2e55722836588e
+riscv-soc	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+s390		b64a294bf2d68514bcdee294a773475729a7d457
+sh		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+sparc		fe0126702a40b2f3d315bc943ef10dc2f707e29d
+uml		e66ae377fe219c98d3d5b8a0d35da4413a5390ca
+xtensa		4c8bad3ed035ab85ad9b0d247154be43a53ef84d
+fs-next		a466035c03fd45b05ee2a22bbac5c7278c106c39
+printk		3cb5302e8c6864bd1e4528c6228a084bcb456da4
+pci		c28eb27d98c2eeae24a65c7c6be41f5640d4f3d9
+pstore		d679c2e1e8d96f71f85e2ef3877407d264212cc3
+hid		dabac188f8e4e30c78e111672ec981b4a9a58b6f
+i2c		0e301196ecb23cf3d093adab5f924a9e0b376e87
+i2c-host	217f92d91c9faeb6b78bd6205b3585944cbcb433
+i3c		d6ddd9beb1a5c32acb9b80f5c2cd8b17f41371d1
+dmi		4d1b28a8119c615f1e932520f9ee1f80bdda5204
+hwmon-staging	76bb6969a8cfc5e00ca142fdad86ffd0a6ed9ecd
+jc_docs		2cf0dde453d012cd1626f67f6142bbebba7fa946
+v4l-dvb		afb100a5ea7a13d7e6937dcd3b36b19dc6cc9328
+v4l-dvb-next	adc218676eef25575469234709c2d87185ca223a
+pm		b203b7259395468689942c61402947780ac55041
+cpufreq-arm	ba6018929165fc914c665f071f8e8cdbac844a49
+cpupower	23199d2aa6dcaf6dd2da772f93d2c94317d71459
+devfreq		eddb5ba91b289faa15117d4fc1c2fb223f3493c2
+pmdomain	bbc3110823eca23b066e75a920bdc8118adda0d2
+opp		05db35963eef7a55f1782190185cb8ddb9d923b7
+thermal		dc67521c20b701b5237ff486ae078829dc1f8fea
+rdma		e6d736bd08902ba53460df1b62ee4218bbd17d9b
+net-next	e835faaed2f80ee8652f59a54703edceab04f0d9
+bpf-next	95524d1a6bd69856826d3516631d4d15b2b4ec19
+ipsec-next	9f4f591cd5a410f4203a9c104f92d467945b7d7e
+mlx5-next	137d1a6355131457723b51a34192320d93d15654
+netfilter-next	1493c18fe8696bfc758a97130a485fc4e08387f5
+ipvs-next	12de5f0f6c2d7aad7e60aada650fcfb374c28a5e
+bluetooth	be812ace0378a9db86344ad637c5ed2a5d11f216
+wireless-next	94aced6ed9e2630bae0b5631e384a5302c4b6783
+ath-next	1e06a137513dff9835e57f76cff177cb1e2e5475
+iwlwifi-next	08579b1861a8f3174d55261062330cac6a145b98
+wpan-next	1dd9291eb90378f8096669d9cb33761fd84599e0
+wpan-staging	1dd9291eb90378f8096669d9cb33761fd84599e0
+mtd		9781c381c159523c6792b1d08d4be6055e0dbd8b
+nand		b8df622cf7f6808c85764e681847150ed6d85f3d
+spi-nor		17926cd770ec837ed27d9856cf07f2da8dda4131
+crypto		166c83f7789ed02dc1f25bc7bed4a1beb25343aa
+libcrypto	b94bc4398beccd329a51052c5e7e84e4670dbcd9
+drm		62bea0e1d5c71a3d9c953d4bbbae79428d0ba05c
+drm-exynos	d07e4c00696f53510ec8a23dcba0c4ac87840874
+drm-misc	0c4932f6ddf815618fa34f7403df682aed7862b5
+amdgpu		df2ba5709416ac6ce8dab1d141fc246b79549e78
+drm-intel	996ad9cd3e1eee1183aba9c7c4d1ada4a62c6f9a
+drm-msm		b5bad77e1e3c7249e4c0c88f98477e1ee7669b63
+drm-msm-lumag	a643abb673790c09a4c188a5ee9b064844f5047b
+drm-rust	299eb32863e584cfff7c6b667c3e92ae7d4d2bf9
+drm-nova	93296e9d9528f0d87f2cf3fee494599060a0f14a
+drm-xe		662d98b8b373007fa1b08ba93fee11f6fd3e387c
+etnaviv		6bde14ba5f7ef59e103ac317df6cc5ac4291ff4a
+fbdev		6d85b579a9cab152e19282a4c26b55b929cdd2e0
+regmap		29883457319786c1f5ce825cb26d1541e84610dc
+sound		f65dc3b1ab145c9b8b36301256d703c1dd153f71
+ieee1394	40d4c761200b796a44bf2c7675ae09c87b17d4af
+sound-asoc	b4f4fd2fac842c92caa689d91e7d602254a9f7eb
+modules		5eb4b9a4cdbb70d70377fe8fb2920b75910e5024
+input		db74430a4218f282d16e58a38337275ad3f9f517
+block		5c85b52fba5a507f1afcf859d4f76a546322b404
+device-mapper	55dcfdf8af9c38cce6f5b2058d3b58dde25e5020
+libata		f145845d8348c9b6288df41cb7904fd9fde566dc
+pcmcia		4a81f78caa53e0633cf311ca1526377d9bff7479
+mmc		7aada81cd75ad844c84fb1dcdce2d67ec41763f8
+mfd		58cd9c86b24072f0a25b27d602fd36ec8c8222a7
+backlight	9f218f9bb9d274b9d5d48a4c95e1b199141fc1f2
+battery		41307ec7df057239aae3d0f089cc35a0d735cdf8
+regulator	e609438851928381e39b5393f17156955a84122a
+security	54d94c422fed9575b74167333c1757847a4e6899
+apparmor	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+integrity	00642a06d60c897a8348784e1eee9e5369219ce5
+selinux		68e1e908cb7682db9fb7f79907f9352435a81c0f
+smack		6ddd169d0288ebee8ec9afcd75825ce8476edb00
+tomoyo		3b3dcf8afa296e3aeef56d3a75f7f764f7011193
+tpmdd		688cf647bad9fbd4e46a48a357be8ba4b572afb3
+watchdog	c64c2a50cdd487e2270c875c1770cd55705d75ff
+iommu		5f4b8c03f41782f37d278946296d9443a7194153
+audit		26cbca1db23a175f8273f3e5afc5fda42e6dc31d
+devicetree	129b91fc329604e05f794dc1a18a6da3eb518b4e
+dt-krzk		7ee0f223cabe9b9384250024fec577c731cbcf72
+mailbox		5378bdf6a611a32500fccf13d14156f219bb0c85
+spi		7e2212429ec9a7b11644a7971d5d606d44ee4d78
+tip		707007037fc6b68dea6f338c06e3fb2710f8864c
+clockevents	45d78cd0bf2c40e74c31f70340484e20aae45b07
+edac		5c4a065eebd70227b51bb2c8d06e9e4c1b313b05
+ftrace		4c064f7ff43b6fdcbf73e5ce62c8b7adbce900f2
+rcu		1d289fc5691c7a970a285bc53292bac9e37c89a6
+paulmck		b706eec9304fc3cbc48a6a09aff8533081815ebc
+kvm		a6ad54137af92535cfe32e19e5f3bc1bb7dbd383
+kvm-arm		5e2ad9b56225023d470f31c38c3272bbb8902334
+kvms390		352ccf890a3e91f58bc32503f9afdc161bc2c34a
+kvm-ppc		c17b750b3ad9f45f2b6f7e6f7f4679844244f0b9
+kvm-riscv	dbdadd943a278fb8a24ae4199a668131108034b4
+kvm-x86		325fbe689e121ba11c16096f452750614767c31e
+xen-tip		9d52b0b41be5b932a0a929c10038f1bb04af4ca5
+percpu		87d6aab2389e5ce0197d8257d5f8ee965a67c4cd
+workqueues	8b8cfc05ada8a02b86cf43f6bfdb47ea3cc64ab2
+sched-ext	e343e82601f93d749fccef04c3af9d0e33fe311a
+drivers-x86	b8754092dfed4fc2fcdb0de32a029ba8f9b464b6
+chrome-platform	48633acccf38d706d7b368400647bb9db9caf1ae
+chrome-platform-firmware	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+hsi		ca50b295fd473ef797b69b8538036cca716f3d55
+leds-lj		ef381e17930e9c5268a53f57187c87a85676d0f7
+ipmi		d46651d4e3c0caab554c4c591c0b6c3b026b1e93
+driver-core	6d97171ac6585de698df019b0bfea3f123fd8385
+usb		e40b984b6c4ce3f80814f39f86f87b2a48f2e662
+thunderbolt	67600ccfc4f38ebd331b9332ac94717bfbc87ea7
+usb-serial	0e0ba0ecec3d6e819e0c2348331ff99afe2eb5d5
+tty		f4abab350840d58d69814c6993736f03ac27df83
+char-misc	22d693e45d4a4513bd99489a4e50b81cc0175b21
+accel		f03eee5fc922158654405318a02db9982c0ddf07
+coresight	01f96b812526a2c8dcd5c0e510dda37e09ec8bcd
+fastrpc		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+fpga		4f156ee58bb84a081ae4a8ac0bbc425176882014
+icc		bcdf7a064c3c73cd97870a3ef5e4dd6214b28b79
+iio		561285d048053fec8a3d6d1e3ddc60df11c393a0
+phy-next	bdb978979ed133c47e19099ff2a4ae51e515452b
+soundwire	88f5d2a477ec64b12e83b488407490bb4a9298f8
+extcon		94d885eb8ffe15b3eb4abe92e03d852fce8ba81f
+gnss		1b237f190eb3d36f52dffe07a40b5eb210280e00
+vfio		407aa63018d15c35a34938633868e61174d2ef6e
+w1		25fb0ea986dc10e05f3f4b43cabde4d1853a1fd7
+spmi		0ff41df1cb268fc69e703a08a57ee14ae967d0ca
+staging		b76029bdd71054b17f62740fe9617d6b2ea601c3
+counter-next	51548c36b37d0e84bd43a5f20bcbc36f70e61c5a
+siox		db418d5f1ca5b7bafc8eaa9393ea18a7901bb0ed
+mux		59b723cd2adbac2a34fc8e12c74ae26ae45bf230
+dmaengine	cc0bacac6de7763a038550cf43cb94634d8be9cd
+cgroup		32768f03eb4694f5298887c3f14e366a49959375
+scsi		e50b8f02e00d445cdb8cf928eb4b06541cb98e5f
+scsi-mkp	fb641516a6687801fddc25e889bee9ab46e133d7
+vhost		bcd630c7edc628e20d4f8e037341f26c90ab4365
+rpmsg		e6e8a72ec5276d645a8d788508a2167414b79807
+gpio-brgl	bc061143637532c08d9fc657eec93fdc2588068e
+gpio-intel	19c839a98c731169f06d32e7c9e00c78a0086ebe
+pinctrl		da3a88e9656c17a34daf49c9acc6d85f73b4d3d9
+pinctrl-intel	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+pinctrl-renesas	512bf60226c621893729605121a396240e84a5d4
+pinctrl-samsung	d37db94b078197ec4be1cadebbfd7bf144e3c5e4
+pwm		8f2689f194b8d1bff41150ae316abdfccf191309
+ktest		a5e71638ddd7f1dc0b9f3a5ac8ab8bef48b9f0ee
+kselftest	19692013415486febf71343f5cc539a343a2994b
+kunit		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+kunit-next	285cae57a51664cc94e85de0ff994f9965b3aca8
+livepatching	dcf9f31c62b3d31c033ee5bce522855c3d7f56b1
+rtc		a6de182daa2b1a627d88a594526a0db4ac1e396e
+nvdimm		a9e6aa994917ee602798bbb03180a194b37865bb
+at24		c7ec58c39b0252e6635dde55e5c708132ab25cfc
+ntb		68113d26067408736fc3be948c2fe8db935aff1c
+seccomp		b0c9bfbab925ac6385d4d06a134fd89cadf771fe
+slimbus		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+nvmem		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+xarray		6684aba0780da9f505c202f27e68ee6d18c0aa66
+hyperv		553d825fb2f0a79cb373514fbc73dbdc484e81c6
+auxdisplay	8f5ae30d69d7543eee0d70083daf4de8fe15d585
+kgdb		fdbdd0ccb30af18d3b29e714ac8d5ab6163279e0
+hmm		19272b37aa4f83ca52bdf9c16d5d81bdd1354494
+cfi		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+mhi		54c67740fff7360b6607d02b8499d09b944b3fda
+memblock	e68f150bc11d0a05cbe984a4e5c0f72a95cae07d
+cxl		46037455cbb748c5e85071c95f2244e81986eb58
+zstd		65d1f5507ed2c78c64fce40e44e5574a9419eb09
+efi		ea62db903f0ba80832e2fc7834e5febfc3e305c1
+unicode		6b56a63d286f6f57066c4b5648d8fbec9510beae
+slab		ca74b8cadaad4b179f77f1f4dc3d288be9a580f1
+random		3778dcb2dcc1ce03a2b25e5d951fe9912e843d1e
+landlock	6dde339a3df80a57ac3d780d8cfc14d9262e2acd
+rust		f3f6b3664302e16ef1c6b91034a72df5564d6b8a
+rust-alloc	fe927defbb4f31c15a52f0372d7f5d608f161086
+rust-io		86731a2a651e58953fc949573895f2fa6d456841
+rust-pin-init	42415d163e5df6db799c7de6262d707e402c2c7e
+rust-timekeeping	4521438fb076f8a6a52f45b0e508f6ef10ac0c49
+rust-xarray	fa616196fbea12462107774fb6a1908c95f71cf0
+sysctl		19272b37aa4f83ca52bdf9c16d5d81bdd1354494
+execve		8c94db0ae97c72c253a615f990bd466b456e94f6
+bitmap		2cdae413cd3ee6aad782cf4bce8c10fdb0f0657c
+hte		9e4259716f60c96c069a38e826884ad783dc4eb4
+kspp		e067972c4d3414c6d0bac153b9463d9a02bab65f
+nolibc		2d965c1ae4135ed6f505661458f6dabd39488dac
+iommufd		885add2e6be65978cfebbe00c00fe865aef9424f
+turbostat	447c98c1ca4a4b0d43be99f76c558c09956484f3
+pwrseq		8f5ae30d69d7543eee0d70083daf4de8fe15d585
+capabilities-next	d87d3c530e0cef7747cfadd4154fd6fb4261b8c0
+ipe		038d61fd642278bab63ee8ef722c50d10ab01e8f
+kcsan		800348aa34b2bc40d558bb17b6719c51fac0b6de
+crc		136d029662cdde77d3e4db5c07de655f35f0239f
+fwctl		479bec4cb39a1bfb2e5d3e3959d660f61399cad4
+devsec-tsm	9d948b8804096d940022b1a3c483a5beb8b46574
+hisilicon	6c177775dcc5e70a64ddf4ee842c66af498f2c7c
+kthread		d8b4bf4ea04dd96fe43f6010c614149aba4c9b91
diff --git a/Next/Trees b/Next/Trees
new file mode 100644
index 000000000000..8be9f272e3ef
--- /dev/null
+++ b/Next/Trees
@@ -0,0 +1,409 @@
+Trees included into this release:
+
+Name		Url
+----		---
+origin		https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git#master
+fixes		../next-fixes#fixes
+ext4-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/tytso/ext4.git#fixes
+vfs-brauner-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs.git#vfs.fixes
+fscrypt-current	https://git.kernel.org/pub/scm/fs/fscrypt/linux.git#for-current
+fsverity-current	https://git.kernel.org/pub/scm/fs/fsverity/linux.git#for-current
+btrfs-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/kdave/linux.git#next-fixes
+vfs-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git#fixes
+erofs-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/xiang/erofs.git#fixes
+nfsd-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/cel/linux#nfsd-fixes
+v9fs-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/ericvh/v9fs.git#fixes/next
+overlayfs-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/overlayfs/vfs.git#ovl-fixes
+fscrypt		https://git.kernel.org/pub/scm/fs/fscrypt/linux.git#for-next
+btrfs		https://git.kernel.org/pub/scm/linux/kernel/git/kdave/linux.git#for-next
+ceph		https://github.com/ceph/ceph-client.git#master
+cifs		git://git.samba.org/sfrench/cifs-2.6.git#for-next
+configfs	https://git.kernel.org/pub/scm/linux/kernel/git/a.hindborg/linux.git#configfs-next
+ecryptfs	https://git.kernel.org/pub/scm/linux/kernel/git/tyhicks/ecryptfs.git#next
+dlm		https://git.kernel.org/pub/scm/linux/kernel/git/teigland/linux-dlm.git#next
+erofs		https://git.kernel.org/pub/scm/linux/kernel/git/xiang/erofs.git#dev
+exfat		https://git.kernel.org/pub/scm/linux/kernel/git/linkinjeon/exfat.git#dev
+exportfs	https://git.kernel.org/pub/scm/linux/kernel/git/cel/linux.git#exportfs-next
+ext3		https://git.kernel.org/pub/scm/linux/kernel/git/jack/linux-fs.git#for_next
+ext4		https://git.kernel.org/pub/scm/linux/kernel/git/tytso/ext4.git#dev
+f2fs		https://git.kernel.org/pub/scm/linux/kernel/git/jaegeuk/f2fs.git#dev
+fsverity	https://git.kernel.org/pub/scm/fs/fsverity/linux.git#for-next
+fuse		https://git.kernel.org/pub/scm/linux/kernel/git/mszeredi/fuse.git#for-next
+gfs2		https://git.kernel.org/pub/scm/linux/kernel/git/gfs2/linux-gfs2.git#for-next
+jfs		https://github.com/kleikamp/linux-shaggy.git#jfs-next
+ksmbd		https://github.com/smfrench/smb3-kernel.git#ksmbd-for-next
+nfs		git://git.linux-nfs.org/projects/trondmy/nfs-2.6.git#linux-next
+nfs-anna	git://git.linux-nfs.org/projects/anna/linux-nfs.git#linux-next
+nfsd		https://git.kernel.org/pub/scm/linux/kernel/git/cel/linux#nfsd-next
+ntfs3		https://github.com/Paragon-Software-Group/linux-ntfs3.git#master
+orangefs	https://git.kernel.org/pub/scm/linux/kernel/git/hubcap/linux.git#for-next
+overlayfs	https://git.kernel.org/pub/scm/linux/kernel/git/overlayfs/vfs.git#overlayfs-next
+ubifs		https://git.kernel.org/pub/scm/linux/kernel/git/rw/ubifs.git#next
+v9fs		https://github.com/martinetd/linux#9p-next
+v9fs-ericvh	https://git.kernel.org/pub/scm/linux/kernel/git/ericvh/v9fs.git#ericvh/for-next
+xfs		https://git.kernel.org/pub/scm/fs/xfs/xfs-linux.git#for-next
+zonefs		https://git.kernel.org/pub/scm/linux/kernel/git/dlemoal/zonefs.git#for-next
+vfs-brauner	https://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs.git#vfs.all
+vfs		https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git#for-next
+mm-hotfixes	https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm#mm-hotfixes-unstable
+kbuild-current	https://git.kernel.org/pub/scm/linux/kernel/git/kbuild/linux.git#kbuild-fixes
+arc-current	https://git.kernel.org/pub/scm/linux/kernel/git/vgupta/arc.git#for-curr
+arm-current	https://git.kernel.org/pub/scm/linux/kernel/git/rmk/linux.git#fixes
+arm64-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux#for-next/fixes
+arm-soc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/soc/soc.git#arm/fixes
+davinci-current	https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#davinci/for-current
+drivers-memory-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-mem-ctrl.git#fixes
+sophgo-fixes	https://github.com/sophgo/linux.git#fixes
+sophgo-soc-fixes	https://github.com/sophgo/linux.git#soc-fixes
+m68k-current	https://git.kernel.org/pub/scm/linux/kernel/git/geert/linux-m68k.git#for-linus
+powerpc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/powerpc/linux.git#fixes
+s390-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/s390/linux.git#fixes
+net		https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net.git#main
+bpf		https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf.git/#master
+ipsec		https://git.kernel.org/pub/scm/linux/kernel/git/klassert/ipsec.git#master
+netfilter	https://git.kernel.org/pub/scm/linux/kernel/git/netfilter/nf.git#main
+ipvs		https://git.kernel.org/pub/scm/linux/kernel/git/horms/ipvs.git#main
+wireless	https://git.kernel.org/pub/scm/linux/kernel/git/wireless/wireless.git#for-next
+ath		https://git.kernel.org/pub/scm/linux/kernel/git/ath/ath.git#for-current
+iwlwifi		https://git.kernel.org/pub/scm/linux/kernel/git/iwlwifi/iwlwifi-next.git#fixes
+wpan		https://git.kernel.org/pub/scm/linux/kernel/git/wpan/wpan.git#master
+rdma-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git#for-rc
+sound-current	https://git.kernel.org/pub/scm/linux/kernel/git/tiwai/sound.git#for-linus
+sound-asoc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/broonie/sound.git#for-linus
+regmap-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regmap.git#for-linus
+regulator-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regulator.git#for-linus
+spi-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/broonie/spi.git#for-linus
+pci-current	https://git.kernel.org/pub/scm/linux/kernel/git/pci/pci.git#for-linus
+driver-core.current	https://git.kernel.org/pub/scm/linux/kernel/git/driver-core/driver-core.git#driver-core-linus
+tty.current	https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/tty.git#tty-linus
+usb.current	https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/usb.git#usb-linus
+usb-serial-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/johan/usb-serial.git#usb-linus
+phy		https://git.kernel.org/pub/scm/linux/kernel/git/phy/linux-phy.git#fixes
+staging.current	https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/staging.git#staging-linus
+iio-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git#fixes-togreg
+counter-current	https://git.kernel.org/pub/scm/linux/kernel/git/wbg/counter.git#counter-current
+char-misc.current	https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/char-misc.git#char-misc-linus
+soundwire-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/soundwire.git#fixes
+thunderbolt-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/westeri/thunderbolt.git#fixes
+input-current	https://git.kernel.org/pub/scm/linux/kernel/git/dtor/input.git#for-linus
+crypto-current	https://git.kernel.org/pub/scm/linux/kernel/git/herbert/crypto-2.6.git#master
+libcrypto-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/ebiggers/linux.git#libcrypto-fixes
+vfio-fixes	https://github.com/awilliam/linux-vfio.git#for-linus
+kselftest-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git#fixes
+dmaengine-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/dmaengine.git#fixes
+backlight-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/lee/backlight.git#for-backlight-fixes
+mtd-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git#mtd/fixes
+mfd-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/lee/mfd.git#for-mfd-fixes
+v4l-dvb-fixes	git://linuxtv.org/media-ci/media-pending.git#fixes
+reset-fixes	https://git.pengutronix.de/git/pza/linux#reset/fixes
+mips-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/mips/linux.git#mips-fixes
+at91-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/at91/linux.git#at91-fixes
+omap-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap.git#fixes
+kvm-fixes	git://git.kernel.org/pub/scm/virt/kvm/kvm.git#master
+kvms390-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/kvms390/linux.git#master
+hwmon-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/groeck/linux-staging.git#hwmon
+nvdimm-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/nvdimm/nvdimm.git#libnvdimm-fixes
+cxl-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/cxl/cxl.git#fixes
+dma-mapping-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/mszyprowski/linux.git#dma-mapping-fixes
+drivers-x86-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/pdx86/platform-drivers-x86.git#fixes
+samsung-krzk-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux.git#fixes
+pinctrl-samsung-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/samsung.git#fixes
+devicetree-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/robh/linux.git#dt/linus
+dt-krzk-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-dt.git#fixes
+scsi-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/mkp/scsi.git#fixes
+drm-fixes	https://gitlab.freedesktop.org/drm/kernel.git#drm-fixes
+drm-intel-fixes	https://gitlab.freedesktop.org/drm/i915/kernel.git#for-linux-next-fixes
+mmc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/mmc.git#fixes
+rtc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/abelloni/linux.git#rtc-fixes
+gnss-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/johan/gnss.git#gnss-linus
+hyperv-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/hyperv/linux.git#hyperv-fixes
+risc-v-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/riscv/linux.git#fixes
+riscv-dt-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git#riscv-dt-fixes
+riscv-soc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git#riscv-soc-fixes
+fpga-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/fpga/linux-fpga.git#fixes
+spdx		https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/spdx.git#spdx-linus
+gpio-brgl-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#gpio/for-current
+gpio-intel-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-gpio-intel.git#fixes
+pinctrl-intel-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/intel.git#fixes
+auxdisplay-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-auxdisplay.git#fixes
+kunit-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git#kunit-fixes
+memblock-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/rppt/memblock.git#fixes
+renesas-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-devel.git#fixes
+perf-current	https://git.kernel.org/pub/scm/linux/kernel/git/perf/perf-tools.git#perf-tools
+efi-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/efi/efi.git#urgent
+battery-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/sre/linux-power-supply.git#fixes
+iommufd-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/jgg/iommufd.git#for-rc
+rust-fixes	https://github.com/Rust-for-Linux/linux.git#rust-fixes
+w1-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-w1.git#fixes
+pmdomain-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/linux-pm.git#fixes
+i2c-host-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/andi.shyti/linux.git#i2c/i2c-host-fixes
+sparc-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/alarsson/linux-sparc.git#for-linus
+clk-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/clk/linux.git#clk-fixes
+thead-clk-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git#thead-clk-fixes
+pwrseq-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#pwrseq/for-current
+thead-dt-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git#thead-dt-fixes
+ftrace-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git#ftrace/fixes
+ring-buffer-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git#ring-buffer/fixes
+trace-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git#trace/fixes
+tracefs-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git#tracefs/fixes
+spacemit-fixes	https://github.com/spacemit-com/linux#fixes
+tip-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git#tip/urgent
+slab-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/vbabka/slab.git#slab/for-next-fixes
+drm-msm-fixes	https://gitlab.freedesktop.org/drm/msm.git#msm-fixes
+uml-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/uml/linux.git#fixes
+fwctl-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/fwctl/fwctl.git#for-rc
+devsec-tsm-fixes	https://git.kernel.org/pub/scm/linux/kernel/git/devsec/tsm.git#fixes
+drm-rust-fixes	https://gitlab.freedesktop.org/drm/rust/kernel.git#drm-rust-fixes
+drm-misc-fixes	https://gitlab.freedesktop.org/drm/misc/kernel.git#for-linux-next-fixes
+linus		https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git#for-next
+mm-stable	https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm#mm-stable
+mm-nonmm-stable	https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm#mm-nonmm-stable
+mm-unstable	https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm#mm-unstable
+mm-nonmm-unstable	https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm#mm-nonmm-unstable
+kbuild		https://git.kernel.org/pub/scm/linux/kernel/git/kbuild/linux.git#kbuild-next
+clang-format	https://github.com/ojeda/linux.git#clang-format
+perf		https://git.kernel.org/pub/scm/linux/kernel/git/perf/perf-tools-next.git#perf-tools-next
+compiler-attributes	https://github.com/ojeda/linux.git#compiler-attributes
+dma-mapping	https://git.kernel.org/pub/scm/linux/kernel/git/mszyprowski/linux.git#dma-mapping-for-next
+asm-generic	https://git.kernel.org/pub/scm/linux/kernel/git/arnd/asm-generic#master
+alpha		https://git.kernel.org/pub/scm/linux/kernel/git/mattst88/alpha.git#alpha-next
+arm		https://git.kernel.org/pub/scm/linux/kernel/git/rmk/linux.git#for-next
+arm64		https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux#for-next/core
+arm-perf	https://git.kernel.org/pub/scm/linux/kernel/git/will/linux.git#for-next/perf
+arm-soc		https://git.kernel.org/pub/scm/linux/kernel/git/soc/soc.git#for-next
+amlogic		https://git.kernel.org/pub/scm/linux/kernel/git/amlogic/linux.git#for-next
+asahi-soc	https://github.com/AsahiLinux/linux.git#asahi-soc/for-next
+at91		https://git.kernel.org/pub/scm/linux/kernel/git/at91/linux.git#at91-next
+bmc		https://git.kernel.org/pub/scm/linux/kernel/git/bmc/linux.git#for-next
+broadcom	https://github.com/Broadcom/stblinux.git#next
+cix		https://git.kernel.org/pub/scm/linux/kernel/git/peter.chen/cix.git#for-next
+davinci		https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#davinci/for-next
+drivers-memory	https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-mem-ctrl.git#for-next
+fsl		https://github.com/chleroy/linux.git#soc_fsl
+imx-mxs		https://git.kernel.org/pub/scm/linux/kernel/git/shawnguo/linux.git#for-next
+mediatek	https://git.kernel.org/pub/scm/linux/kernel/git/mediatek/linux.git#for-next
+mvebu		https://git.kernel.org/pub/scm/linux/kernel/git/gclement/mvebu.git#for-next
+omap		https://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap.git#for-next
+qcom		https://git.kernel.org/pub/scm/linux/kernel/git/qcom/linux.git#for-next
+renesas		https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-devel.git#next
+reset		https://git.pengutronix.de/git/pza/linux#reset/next
+rockchip	https://git.kernel.org/pub/scm/linux/kernel/git/mmind/linux-rockchip.git#for-next
+samsung-krzk	https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux.git#for-next
+scmi		https://git.kernel.org/pub/scm/linux/kernel/git/sudeep.holla/linux.git#for-linux-next
+sophgo		https://github.com/sophgo/linux.git#for-next
+sophgo-soc	https://github.com/sophgo/linux.git#soc-for-next
+spacemit	https://github.com/spacemit-com/linux#for-next
+stm32		https://git.kernel.org/pub/scm/linux/kernel/git/atorgue/stm32.git#stm32-next
+sunxi		https://git.kernel.org/pub/scm/linux/kernel/git/sunxi/linux.git#sunxi/for-next
+tee		https://git.kernel.org/pub/scm/linux/kernel/git/jenswi/linux-tee.git#next
+tegra		https://git.kernel.org/pub/scm/linux/kernel/git/tegra/linux.git#for-next
+thead-dt	https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git#thead-dt-for-next
+ti		https://git.kernel.org/pub/scm/linux/kernel/git/ti/linux.git#ti-next
+xilinx		https://github.com/Xilinx/linux-xlnx.git#for-next
+clk		https://git.kernel.org/pub/scm/linux/kernel/git/clk/linux.git#clk-next
+clk-imx		https://git.kernel.org/pub/scm/linux/kernel/git/abelvesa/linux.git#for-next
+clk-renesas	https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-drivers.git#renesas-clk
+thead-clk	https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git#thead-clk-for-next
+csky		https://github.com/c-sky/csky-linux.git#linux-next
+loongarch	https://git.kernel.org/pub/scm/linux/kernel/git/chenhuacai/linux-loongson.git#loongarch-next
+m68k		https://git.kernel.org/pub/scm/linux/kernel/git/geert/linux-m68k.git#for-next
+m68knommu	https://git.kernel.org/pub/scm/linux/kernel/git/gerg/m68knommu.git#for-next
+microblaze	git://git.monstr.eu/linux-2.6-microblaze.git#next
+mips		https://git.kernel.org/pub/scm/linux/kernel/git/mips/linux.git#mips-next
+openrisc	https://github.com/openrisc/linux.git#for-next
+parisc-hd	https://git.kernel.org/pub/scm/linux/kernel/git/deller/parisc-linux.git#for-next
+powerpc		https://git.kernel.org/pub/scm/linux/kernel/git/powerpc/linux.git#next
+risc-v		https://git.kernel.org/pub/scm/linux/kernel/git/riscv/linux.git#for-next
+riscv-dt	https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git#riscv-dt-for-next
+riscv-soc	https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git#riscv-soc-for-next
+s390		https://git.kernel.org/pub/scm/linux/kernel/git/s390/linux.git#for-next
+sh		https://git.kernel.org/pub/scm/linux/kernel/git/glaubitz/sh-linux.git#for-next
+sparc		https://git.kernel.org/pub/scm/linux/kernel/git/alarsson/linux-sparc.git#for-next
+uml		https://git.kernel.org/pub/scm/linux/kernel/git/uml/linux.git#next
+xtensa		https://github.com/jcmvbkbc/linux-xtensa.git#xtensa-for-next
+printk		https://git.kernel.org/pub/scm/linux/kernel/git/printk/linux.git#for-next
+pci		https://git.kernel.org/pub/scm/linux/kernel/git/pci/pci.git#next
+pstore		https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git#for-next/pstore
+hid		https://git.kernel.org/pub/scm/linux/kernel/git/hid/hid.git#for-next
+i2c		https://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux.git#i2c/for-next
+i2c-host	https://git.kernel.org/pub/scm/linux/kernel/git/andi.shyti/linux.git#i2c/i2c-host
+i3c		https://git.kernel.org/pub/scm/linux/kernel/git/i3c/linux.git#i3c/next
+dmi		https://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging.git#dmi-for-next
+hwmon-staging	https://git.kernel.org/pub/scm/linux/kernel/git/groeck/linux-staging.git#hwmon-next
+jc_docs		git://git.lwn.net/linux.git#docs-next
+v4l-dvb		git://linuxtv.org/media-ci/media-pending.git#next
+v4l-dvb-next	git://linuxtv.org/mchehab/media-next.git#master
+pm		https://git.kernel.org/pub/scm/linux/kernel/git/rafael/linux-pm.git#linux-next
+cpufreq-arm	https://git.kernel.org/pub/scm/linux/kernel/git/vireshk/pm.git#cpufreq/arm/linux-next
+cpupower	https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux.git#cpupower
+devfreq		https://git.kernel.org/pub/scm/linux/kernel/git/chanwoo/linux.git#devfreq-next
+pmdomain	https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/linux-pm.git#next
+opp		https://git.kernel.org/pub/scm/linux/kernel/git/vireshk/pm.git#opp/linux-next
+thermal		https://git.kernel.org/pub/scm/linux/kernel/git/thermal/linux.git#thermal/linux-next
+rdma		https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git#for-next
+net-next	https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net-next.git#main
+bpf-next	https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf-next.git#for-next
+ipsec-next	https://git.kernel.org/pub/scm/linux/kernel/git/klassert/ipsec-next.git#master
+mlx5-next	https://git.kernel.org/pub/scm/linux/kernel/git/mellanox/linux.git#mlx5-next
+netfilter-next	https://git.kernel.org/pub/scm/linux/kernel/git/netfilter/nf-next.git#main
+ipvs-next	https://git.kernel.org/pub/scm/linux/kernel/git/horms/ipvs-next.git#main
+bluetooth	https://git.kernel.org/pub/scm/linux/kernel/git/bluetooth/bluetooth-next.git#master
+wireless-next	https://git.kernel.org/pub/scm/linux/kernel/git/wireless/wireless-next.git#for-next
+ath-next	https://git.kernel.org/pub/scm/linux/kernel/git/ath/ath.git#for-next
+iwlwifi-next	https://git.kernel.org/pub/scm/linux/kernel/git/iwlwifi/iwlwifi-next.git#next
+wpan-next	https://git.kernel.org/pub/scm/linux/kernel/git/wpan/wpan-next.git#master
+wpan-staging	https://git.kernel.org/pub/scm/linux/kernel/git/wpan/wpan-next.git#staging
+mtd		https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git#mtd/next
+nand		https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git#nand/next
+spi-nor		https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git#spi-nor/next
+crypto		https://git.kernel.org/pub/scm/linux/kernel/git/herbert/cryptodev-2.6.git#master
+libcrypto	https://git.kernel.org/pub/scm/linux/kernel/git/ebiggers/linux.git#libcrypto-next
+drm		https://gitlab.freedesktop.org/drm/kernel.git#drm-next
+drm-exynos	https://git.kernel.org/pub/scm/linux/kernel/git/daeinki/drm-exynos.git#for-linux-next
+drm-misc	https://gitlab.freedesktop.org/drm/misc/kernel.git#for-linux-next
+amdgpu		https://gitlab.freedesktop.org/agd5f/linux.git#drm-next
+drm-intel	https://gitlab.freedesktop.org/drm/i915/kernel.git#for-linux-next
+drm-msm		https://gitlab.freedesktop.org/drm/msm.git#msm-next
+drm-msm-lumag	https://gitlab.freedesktop.org/lumag/msm.git#msm-next-lumag
+drm-rust	https://gitlab.freedesktop.org/drm/rust/kernel.git#drm-rust-next
+drm-nova	https://gitlab.freedesktop.org/drm/nova.git#nova-next
+drm-xe		https://gitlab.freedesktop.org/drm/xe/kernel.git#drm-xe-next
+etnaviv		https://git.pengutronix.de/git/lst/linux#etnaviv/next
+fbdev		https://git.kernel.org/pub/scm/linux/kernel/git/deller/linux-fbdev.git#for-next
+regmap		https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regmap.git#for-next
+sound		https://git.kernel.org/pub/scm/linux/kernel/git/tiwai/sound.git#for-next
+ieee1394	https://git.kernel.org/pub/scm/linux/kernel/git/ieee1394/linux1394.git#for-next
+sound-asoc	https://git.kernel.org/pub/scm/linux/kernel/git/broonie/sound.git#for-next
+modules		https://git.kernel.org/pub/scm/linux/kernel/git/modules/linux.git#modules-next
+input		https://git.kernel.org/pub/scm/linux/kernel/git/dtor/input.git#next
+block		git://git.kernel.dk/linux-block.git#for-next
+device-mapper	https://git.kernel.org/pub/scm/linux/kernel/git/device-mapper/linux-dm.git#for-next
+libata		https://git.kernel.org/pub/scm/linux/kernel/git/libata/linux#for-next
+pcmcia		https://git.kernel.org/pub/scm/linux/kernel/git/brodo/linux.git#pcmcia-next
+mmc		https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/mmc.git#next
+mfd		https://git.kernel.org/pub/scm/linux/kernel/git/lee/mfd.git#for-mfd-next
+backlight	https://git.kernel.org/pub/scm/linux/kernel/git/lee/backlight.git#for-backlight-next
+battery		https://git.kernel.org/pub/scm/linux/kernel/git/sre/linux-power-supply.git#for-next
+regulator	https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regulator.git#for-next
+security	https://git.kernel.org/pub/scm/linux/kernel/git/pcmoore/lsm.git#next
+apparmor	https://git.kernel.org/pub/scm/linux/kernel/git/jj/linux-apparmor#apparmor-next
+integrity	https://git.kernel.org/pub/scm/linux/kernel/git/zohar/linux-integrity#next-integrity
+selinux		https://git.kernel.org/pub/scm/linux/kernel/git/pcmoore/selinux.git#next
+smack		https://github.com/cschaufler/smack-next#next
+tomoyo		git://git.code.sf.net/p/tomoyo/tomoyo.git#master
+tpmdd		https://git.kernel.org/pub/scm/linux/kernel/git/jarkko/linux-tpmdd.git#next
+watchdog	git://www.linux-watchdog.org/linux-watchdog-next.git#master
+iommu		https://git.kernel.org/pub/scm/linux/kernel/git/iommu/linux.git#next
+audit		https://git.kernel.org/pub/scm/linux/kernel/git/pcmoore/audit.git#next
+devicetree	https://git.kernel.org/pub/scm/linux/kernel/git/robh/linux.git#for-next
+dt-krzk		https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-dt.git#for-next
+mailbox		https://git.kernel.org/pub/scm/linux/kernel/git/jassibrar/mailbox.git#for-next
+spi		https://git.kernel.org/pub/scm/linux/kernel/git/broonie/spi.git#for-next
+tip		https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git#master
+clockevents	https://git.kernel.org/pub/scm/linux/kernel/git/daniel.lezcano/linux.git#timers/drivers/next
+edac		https://git.kernel.org/pub/scm/linux/kernel/git/ras/ras.git#edac-for-next
+ftrace		https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git#for-next
+rcu		https://git.kernel.org/pub/scm/linux/kernel/git/rcu/linux#next
+paulmck		https://git.kernel.org/pub/scm/linux/kernel/git/paulmck/linux-rcu.git#non-rcu/next
+kvm		git://git.kernel.org/pub/scm/virt/kvm/kvm.git#next
+kvm-arm		https://git.kernel.org/pub/scm/linux/kernel/git/kvmarm/kvmarm.git#next
+kvms390		https://git.kernel.org/pub/scm/linux/kernel/git/kvms390/linux.git#next
+kvm-ppc		https://git.kernel.org/pub/scm/linux/kernel/git/powerpc/linux.git#topic/ppc-kvm
+kvm-riscv	https://github.com/kvm-riscv/linux.git#riscv_kvm_next
+kvm-x86		https://github.com/kvm-x86/linux.git#next
+xen-tip		https://git.kernel.org/pub/scm/linux/kernel/git/xen/tip.git#linux-next
+percpu		https://git.kernel.org/pub/scm/linux/kernel/git/dennis/percpu.git#for-next
+workqueues	https://git.kernel.org/pub/scm/linux/kernel/git/tj/wq.git#for-next
+sched-ext	https://git.kernel.org/pub/scm/linux/kernel/git/tj/sched_ext.git#for-next
+drivers-x86	https://git.kernel.org/pub/scm/linux/kernel/git/pdx86/platform-drivers-x86.git#for-next
+chrome-platform	https://git.kernel.org/pub/scm/linux/kernel/git/chrome-platform/linux.git#for-next
+chrome-platform-firmware	https://git.kernel.org/pub/scm/linux/kernel/git/chrome-platform/linux.git#for-firmware-next
+hsi		https://git.kernel.org/pub/scm/linux/kernel/git/sre/linux-hsi.git#for-next
+leds-lj		https://git.kernel.org/pub/scm/linux/kernel/git/lee/leds.git#for-leds-next
+ipmi		https://github.com/cminyard/linux-ipmi.git#for-next
+driver-core	https://git.kernel.org/pub/scm/linux/kernel/git/driver-core/driver-core.git#driver-core-next
+usb		https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/usb.git#usb-next
+thunderbolt	https://git.kernel.org/pub/scm/linux/kernel/git/westeri/thunderbolt.git#next
+usb-serial	https://git.kernel.org/pub/scm/linux/kernel/git/johan/usb-serial.git#usb-next
+tty		https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/tty.git#tty-next
+char-misc	https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/char-misc.git#char-misc-next
+accel		https://git.kernel.org/pub/scm/linux/kernel/git/ogabbay/linux.git#habanalabs-next
+coresight	https://git.kernel.org/pub/scm/linux/kernel/git/coresight/linux.git#next
+fastrpc		https://git.kernel.org/pub/scm/linux/kernel/git/srini/fastrpc.git#for-next
+fpga		https://git.kernel.org/pub/scm/linux/kernel/git/fpga/linux-fpga.git#for-next
+icc		https://git.kernel.org/pub/scm/linux/kernel/git/djakov/icc.git#icc-next
+iio		https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git#togreg
+phy-next	https://git.kernel.org/pub/scm/linux/kernel/git/phy/linux-phy.git#next
+soundwire	https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/soundwire.git#next
+extcon		https://git.kernel.org/pub/scm/linux/kernel/git/chanwoo/extcon.git#extcon-next
+gnss		https://git.kernel.org/pub/scm/linux/kernel/git/johan/gnss.git#gnss-next
+vfio		https://github.com/awilliam/linux-vfio.git#next
+w1		https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-w1.git#for-next
+spmi		https://git.kernel.org/pub/scm/linux/kernel/git/sboyd/spmi.git#spmi-next
+staging		https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/staging.git#staging-next
+counter-next	https://git.kernel.org/pub/scm/linux/kernel/git/wbg/counter.git#counter-next
+siox		https://git.kernel.org/pub/scm/linux/kernel/git/ukleinek/linux.git#siox/for-next
+mux		https://gitlab.com/peda-linux/mux.git#for-next
+dmaengine	https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/dmaengine.git#next
+cgroup		https://git.kernel.org/pub/scm/linux/kernel/git/tj/cgroup.git#for-next
+scsi		https://git.kernel.org/pub/scm/linux/kernel/git/jejb/scsi.git#for-next
+scsi-mkp	https://git.kernel.org/pub/scm/linux/kernel/git/mkp/scsi.git#for-next
+vhost		https://git.kernel.org/pub/scm/linux/kernel/git/mst/vhost.git#linux-next
+rpmsg		https://git.kernel.org/pub/scm/linux/kernel/git/remoteproc/linux.git#for-next
+gpio-brgl	https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#gpio/for-next
+gpio-intel	https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-gpio-intel.git#for-next
+pinctrl		https://git.kernel.org/pub/scm/linux/kernel/git/linusw/linux-pinctrl.git#for-next
+pinctrl-intel	https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/intel.git#for-next
+pinctrl-renesas	https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-drivers.git#renesas-pinctrl
+pinctrl-samsung	https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/samsung.git#for-next
+pwm		https://git.kernel.org/pub/scm/linux/kernel/git/ukleinek/linux.git#pwm/for-next
+ktest		https://git.kernel.org/pub/scm/linux/kernel/git/rostedt/linux-ktest.git#for-next
+kselftest	https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git#next
+kunit		https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git#test
+kunit-next	https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git#kunit
+livepatching	https://git.kernel.org/pub/scm/linux/kernel/git/livepatching/livepatching.git#for-next
+rtc		https://git.kernel.org/pub/scm/linux/kernel/git/abelloni/linux.git#rtc-next
+nvdimm		https://git.kernel.org/pub/scm/linux/kernel/git/nvdimm/nvdimm.git#libnvdimm-for-next
+at24		https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#at24/for-next
+ntb		https://github.com/jonmason/ntb.git#ntb-next
+seccomp		https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git#for-next/seccomp
+slimbus		https://git.kernel.org/pub/scm/linux/kernel/git/srini/slimbus.git#for-next
+nvmem		https://git.kernel.org/pub/scm/linux/kernel/git/srini/nvmem.git#for-next
+xarray		git://git.infradead.org/users/willy/xarray.git#main
+hyperv		https://git.kernel.org/pub/scm/linux/kernel/git/hyperv/linux.git#hyperv-next
+auxdisplay	https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-auxdisplay.git#for-next
+kgdb		https://git.kernel.org/pub/scm/linux/kernel/git/danielt/linux.git#kgdb/for-next
+hmm		https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git#hmm
+cfi		https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git#cfi/next
+mhi		https://git.kernel.org/pub/scm/linux/kernel/git/mani/mhi.git#mhi-next
+memblock	https://git.kernel.org/pub/scm/linux/kernel/git/rppt/memblock.git#for-next
+cxl		https://git.kernel.org/pub/scm/linux/kernel/git/cxl/cxl.git#next
+zstd		https://github.com/terrelln/linux.git#zstd-next
+efi		https://git.kernel.org/pub/scm/linux/kernel/git/efi/efi.git#next
+unicode		https://git.kernel.org/pub/scm/linux/kernel/git/krisman/unicode.git#for-next
+slab		https://git.kernel.org/pub/scm/linux/kernel/git/vbabka/slab.git#slab/for-next
+random		https://git.kernel.org/pub/scm/linux/kernel/git/crng/random.git#master
+landlock	https://git.kernel.org/pub/scm/linux/kernel/git/mic/linux.git#next
+rust		https://github.com/Rust-for-Linux/linux.git#rust-next
+rust-alloc	https://github.com/Rust-for-Linux/linux.git#alloc-next
+rust-io		https://github.com/Rust-for-Linux/linux.git#io-next
+rust-pin-init	https://github.com/Rust-for-Linux/linux.git#pin-init-next
+rust-timekeeping	https://github.com/Rust-for-Linux/linux.git#timekeeping-next
+rust-xarray	https://github.com/Rust-for-Linux/linux.git#xarray-next
+sysctl		https://git.kernel.org/pub/scm/linux/kernel/git/sysctl/sysctl.git#sysctl-next
+execve		https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git#for-next/execve
+bitmap		https://github.com/norov/linux.git#bitmap-for-next
+hte		https://git.kernel.org/pub/scm/linux/kernel/git/pateldipen1984/linux.git#for-next
+kspp		https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git#for-next/kspp
+nolibc		https://git.kernel.org/pub/scm/linux/kernel/git/nolibc/linux-nolibc.git#for-next
+iommufd		https://git.kernel.org/pub/scm/linux/kernel/git/jgg/iommufd.git#for-next
+turbostat	https://git.kernel.org/pub/scm/linux/kernel/git/lenb/linux.git#next
+pwrseq		https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git#pwrseq/for-next
+capabilities-next	https://git.kernel.org/pub/scm/linux/kernel/git/sergeh/linux.git#caps-next
+ipe		https://git.kernel.org/pub/scm/linux/kernel/git/wufan/ipe.git#next
+kcsan		https://git.kernel.org/pub/scm/linux/kernel/git/melver/linux.git#next
+crc		https://git.kernel.org/pub/scm/linux/kernel/git/ebiggers/linux.git#crc-next
+fwctl		https://git.kernel.org/pub/scm/linux/kernel/git/fwctl/fwctl.git#for-next
+devsec-tsm	https://git.kernel.org/pub/scm/linux/kernel/git/devsec/tsm.git#next
+hisilicon	https://github.com/hisilicon/linux-hisi.git#for-next
+kthread		https://git.kernel.org/pub/scm/linux/kernel/git/frederic/linux-dynticks.git#for-next
diff --git a/Next/merge.log b/Next/merge.log
new file mode 100644
index 000000000000..627153ccfb69
--- /dev/null
+++ b/Next/merge.log
@@ -0,0 +1,16275 @@
+$ date -R
+Mon, 29 Sep 2025 11:19:48 +0100
+$ git checkout master
+Already on 'master'
+$ git reset --hard stable
+Updating files:  48% (5459/11350)Updating files:  49% (5562/11350)Updating files:  50% (5675/11350)Updating files:  51% (5789/11350)Updating files:  52% (5902/11350)Updating files:  53% (6016/11350)Updating files:  54% (6129/11350)Updating files:  55% (6243/11350)Updating files:  56% (6356/11350)Updating files:  57% (6470/11350)Updating files:  58% (6583/11350)Updating files:  59% (6697/11350)Updating files:  60% (6810/11350)Updating files:  61% (6924/11350)Updating files:  62% (7037/11350)Updating files:  63% (7151/11350)Updating files:  64% (7264/11350)Updating files:  65% (7378/11350)Updating files:  66% (7491/11350)Updating files:  67% (7605/11350)Updating files:  68% (7718/11350)Updating files:  69% (7832/11350)Updating files:  70% (7945/11350)Updating files:  71% (8059/11350)Updating files:  72% (8172/11350)Updating files:  73% (8286/11350)Updating files:  74% (8399/11350)Updating files:  75% (8513/11350)Updating files:  76% (8626/11350)Updating files:  77% (8740/11350)Updating files:  78% (8853/11350)Updating files:  79% (8967/11350)Updating files:  79% (9075/11350)Updating files:  80% (9080/11350)Updating files:  81% (9194/11350)Updating files:  82% (9307/11350)Updating files:  83% (9421/11350)Updating files:  84% (9534/11350)Updating files:  85% (9648/11350)Updating files:  86% (9761/11350)Updating files:  87% (9875/11350)Updating files:  88% (9988/11350)Updating files:  89% (10102/11350)Updating files:  90% (10215/11350)Updating files:  91% (10329/11350)Updating files:  92% (10442/11350)Updating files:  93% (10556/11350)Updating files:  94% (10669/11350)Updating files:  95% (10783/11350)Updating files:  96% (10896/11350)Updating files:  97% (11010/11350)Updating files:  98% (11123/11350)Updating files:  99% (11237/11350)Updating files: 100% (11350/11350)Updating files: 100% (11350/11350), done.
+HEAD is now at 4ff71af020ae5 Merge tag 'net-6.17-rc8' of git://git.kernel.org/pub/scm/linux/kernel/git/netdev/net
+Merging origin/master (e5f0a698b34ed Linux 6.17)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git origin/master
+Updating 4ff71af020ae5..e5f0a698b34ed
+Fast-forward (no commit created; -m option ignored)
+ .mailmap                                           |   1 +
+ Documentation/admin-guide/laptops/lg-laptop.rst    |   4 +-
+ .../devicetree/bindings/i2c/spacemit,k1-i2c.yaml   |   3 +
+ MAINTAINERS                                        |  29 ++---
+ Makefile                                           |   2 +-
+ arch/arm/kernel/module.c                           |   2 +-
+ arch/riscv/include/asm/pgtable.h                   |  17 +++
+ arch/x86/Kconfig                                   |   2 +-
+ arch/x86/include/asm/topology.h                    |  10 ++
+ arch/x86/kernel/cpu/topology.c                     |  13 +++
+ block/blk-core.c                                   |   4 +-
+ drivers/gpio/gpio-regmap.c                         |   2 +-
+ drivers/gpio/gpiolib.c                             |  21 +++-
+ drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c  |  12 +-
+ drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.h  |   7 ++
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_color.c    |   2 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_plane.c    |   2 +-
+ .../amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c   | 121 ++++++++++++++++++++-
+ drivers/gpu/drm/amd/display/dc/dc.h                |   1 -
+ .../drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c    |   6 +-
+ .../drm/amd/display/dc/hwss/dcn401/dcn401_hwseq.c  |   6 +-
+ drivers/gpu/drm/ast/ast_dp.c                       |   2 +-
+ drivers/gpu/drm/gma500/oaktrail_hdmi.c             |   2 +-
+ drivers/gpu/drm/i915/display/intel_ddi.c           |   5 +-
+ drivers/gpu/drm/i915/gem/i915_gem_shmem.c          |   7 ++
+ drivers/gpu/drm/panthor/panthor_sched.c            |   8 +-
+ drivers/gpu/drm/xe/xe_bo_evict.c                   |   4 +-
+ drivers/gpu/drm/xe/xe_configfs.c                   |   2 +-
+ drivers/gpu/drm/xe/xe_device_sysfs.c               |   2 +-
+ drivers/i2c/busses/i2c-riic.c                      |   2 +-
+ drivers/i2c/busses/i2c-rtl9300.c                   |   3 +-
+ drivers/platform/x86/amd/pmc/pmc-quirks.c          |   7 ++
+ drivers/platform/x86/dell/dell-lis3lv02d.c         |   1 +
+ drivers/platform/x86/dell/dell-pc.c                |   9 ++
+ drivers/platform/x86/lg-laptop.c                   |  34 +++---
+ drivers/pmdomain/mediatek/mt8195-pm-domains.h      |   1 +
+ drivers/spi/spi-cadence-quadspi.c                  |  53 ++++++---
+ drivers/spi/spi-omap2-mcspi.c                      |   1 +
+ drivers/video/fbdev/core/fbcon.c                   |  13 ++-
+ fs/afs/server.c                                    |   3 +-
+ fs/hugetlbfs/inode.c                               |  10 +-
+ fs/netfs/buffered_read.c                           |  10 +-
+ fs/netfs/buffered_write.c                          |   2 +-
+ fs/netfs/direct_read.c                             |   7 +-
+ fs/netfs/direct_write.c                            |   6 +-
+ fs/netfs/internal.h                                |   1 +
+ fs/netfs/objects.c                                 |  30 ++++-
+ fs/netfs/read_pgpriv2.c                            |   2 +-
+ fs/netfs/read_single.c                             |   2 +-
+ fs/netfs/write_issue.c                             |   3 +-
+ fs/proc/task_mmu.c                                 |   3 +
+ fs/smb/client/smb2inode.c                          | 103 +++++++++++++++---
+ include/linux/mm_types.h                           |   5 +
+ include/linux/pgtable.h                            |   6 +-
+ include/linux/sched.h                              |   2 -
+ init/Kconfig                                       |   3 +
+ kernel/fork.c                                      |   2 +-
+ kernel/futex/requeue.c                             |   6 +-
+ kernel/sched/deadline.c                            |  35 +-----
+ kernel/sched/fair.c                                |   7 +-
+ kernel/sched/sched.h                               |  37 ++++++-
+ kernel/trace/fgraph.c                              |  12 ++
+ kernel/trace/trace_osnoise.c                       |   3 +-
+ mm/damon/sysfs.c                                   |   4 +-
+ mm/hugetlb.c                                       |  15 +--
+ mm/kmsan/core.c                                    |  10 +-
+ mm/kmsan/kmsan_test.c                              |  16 +++
+ tools/tracing/rtla/src/actions.c                   |   4 +-
+ 68 files changed, 573 insertions(+), 199 deletions(-)
+Merging fixes/fixes (89be9a83ccf1f Linux 6.16-rc7)
+$ git merge -m Merge branch 'fixes' of ../next-fixes fixes/fixes
+Already up to date.
+Merging ext4-fixes/fixes (d0b3b7b22dfa1 Linux 6.16-rc4)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/tytso/ext4.git ext4-fixes/fixes
+Already up to date.
+Merging vfs-brauner-fixes/vfs.fixes (4d428dca252c8 netfs: fix reference leak)
+$ git merge -m Merge branch 'vfs.fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs.git vfs-brauner-fixes/vfs.fixes
+Already up to date.
+Merging fscrypt-current/for-current (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-current' of https://git.kernel.org/pub/scm/fs/fscrypt/linux.git fscrypt-current/for-current
+Already up to date.
+Merging fsverity-current/for-current (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-current' of https://git.kernel.org/pub/scm/fs/fsverity/linux.git fsverity-current/for-current
+Already up to date.
+Merging btrfs-fixes/next-fixes (71db937b4e0c0 Merge branch 'misc-6.18' into next-fixes)
+$ git merge -m Merge branch 'next-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/kdave/linux.git btrfs-fixes/next-fixes
+Auto-merging fs/btrfs/zoned.c
+CONFLICT (content): Merge conflict in fs/btrfs/zoned.c
+Resolved 'fs/btrfs/zoned.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[fs-current 7d5803c3d33cc] Merge branch 'next-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/kdave/linux.git
+$ git diff -M --stat --summary HEAD^..
+ fs/btrfs/Kconfig                    |   12 +-
+ fs/btrfs/Makefile                   |    2 +-
+ fs/btrfs/accessors.c                |    2 +-
+ fs/btrfs/backref.c                  |   26 +-
+ fs/btrfs/backref.h                  |    4 +-
+ fs/btrfs/bio.c                      |   54 +-
+ fs/btrfs/bio.h                      |    2 +
+ fs/btrfs/block-group.c              |   30 +-
+ fs/btrfs/block-group.h              |    2 +-
+ fs/btrfs/btrfs_inode.h              |   16 +-
+ fs/btrfs/compression.c              |  243 +++--
+ fs/btrfs/compression.h              |   59 +-
+ fs/btrfs/ctree.c                    |  135 +--
+ fs/btrfs/defrag.c                   |    4 +-
+ fs/btrfs/delayed-inode.c            |  186 ++--
+ fs/btrfs/delayed-inode.h            |   93 ++
+ fs/btrfs/delayed-ref.c              |   13 +-
+ fs/btrfs/delayed-ref.h              |    9 +-
+ fs/btrfs/dev-replace.c              |   12 +-
+ fs/btrfs/direct-io.c                |   12 +
+ fs/btrfs/disk-io.c                  |   97 +-
+ fs/btrfs/disk-io.h                  |    3 +-
+ fs/btrfs/export.c                   |   10 +-
+ fs/btrfs/extent-io-tree.c           |    4 +-
+ fs/btrfs/extent-io-tree.h           |    2 +-
+ fs/btrfs/extent-tree.c              |  104 +-
+ fs/btrfs/extent-tree.h              |    7 +-
+ fs/btrfs/extent_io.c                |  127 ++-
+ fs/btrfs/extent_io.h                |    3 +-
+ fs/btrfs/extent_map.c               |   22 +-
+ fs/btrfs/fiemap.c                   |    2 +-
+ fs/btrfs/file-item.c                |   60 +-
+ fs/btrfs/file.c                     |   49 +-
+ fs/btrfs/free-space-cache.c         |    6 +-
+ fs/btrfs/free-space-tree.c          |   60 +-
+ fs/btrfs/fs.c                       |   48 +
+ fs/btrfs/fs.h                       |   41 +-
+ fs/btrfs/inode-item.c               |   10 +-
+ fs/btrfs/inode.c                    |  506 ++++-----
+ fs/btrfs/ioctl.c                    |   69 +-
+ fs/btrfs/locking.c                  |    2 +-
+ fs/btrfs/locking.h                  |    2 +-
+ fs/btrfs/lzo.c                      |   93 +-
+ fs/btrfs/messages.c                 |    1 +
+ fs/btrfs/messages.h                 |    1 -
+ fs/btrfs/misc.h                     |   49 +
+ fs/btrfs/print-tree.c               |  256 ++++-
+ fs/btrfs/qgroup.c                   |   44 +-
+ fs/btrfs/raid-stripe-tree.c         |   17 +-
+ fs/btrfs/raid56.c                   |  121 ++-
+ fs/btrfs/raid56.h                   |    4 +-
+ fs/btrfs/ref-verify.c               |    3 +-
+ fs/btrfs/ref-verify.h               |    4 +-
+ fs/btrfs/reflink.c                  |   15 +-
+ fs/btrfs/relocation.c               |   81 +-
+ fs/btrfs/root-tree.c                |   66 +-
+ fs/btrfs/scrub.c                    |   95 +-
+ fs/btrfs/scrub.h                    |    2 +-
+ fs/btrfs/send.c                     |  373 +++----
+ fs/btrfs/space-info.c               |    4 +-
+ fs/btrfs/subpage.c                  |    2 +-
+ fs/btrfs/subpage.h                  |    2 +-
+ fs/btrfs/super.c                    |   34 +-
+ fs/btrfs/sysfs.c                    |   16 +-
+ fs/btrfs/tests/delayed-refs-tests.c |    4 +-
+ fs/btrfs/tests/extent-map-tests.c   |    2 +-
+ fs/btrfs/transaction.c              |   49 +-
+ fs/btrfs/tree-checker.c             |   39 +-
+ fs/btrfs/tree-log.c                 | 1920 ++++++++++++++++++++---------------
+ fs/btrfs/verity.c                   |    8 +-
+ fs/btrfs/volumes.c                  |   70 +-
+ fs/btrfs/volumes.h                  |    4 +-
+ fs/btrfs/zlib.c                     |   86 +-
+ fs/btrfs/zoned.c                    |   66 +-
+ fs/btrfs/zoned.h                    |    9 +-
+ fs/btrfs/zstd.c                     |  198 ++--
+ 76 files changed, 3442 insertions(+), 2446 deletions(-)
+Merging vfs-fixes/fixes (00e7821104283 nfs4_setup_readdir(): insufficient locking for ->d_parent->d_inode dereferencing)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git vfs-fixes/fixes
+Merge made by the 'ort' strategy.
+ fs/nfs/nfs4proc.c | 2 ++
+ 1 file changed, 2 insertions(+)
+Merging erofs-fixes/fixes (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/xiang/erofs.git erofs-fixes/fixes
+Already up to date.
+Merging nfsd-fixes/nfsd-fixes (bee47cb026e76 sunrpc: fix handling of server side tls alerts)
+$ git merge -m Merge branch 'nfsd-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/cel/linux nfsd-fixes/nfsd-fixes
+Already up to date.
+Merging v9fs-fixes/fixes/next (2014c95afecee Linux 6.14-rc1)
+$ git merge -m Merge branch 'fixes/next' of https://git.kernel.org/pub/scm/linux/kernel/git/ericvh/v9fs.git v9fs-fixes/fixes/next
+Already up to date.
+Merging overlayfs-fixes/ovl-fixes (e8bd877fb76bb ovl: fix possible double unlink)
+$ git merge -m Merge branch 'ovl-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/overlayfs/vfs.git overlayfs-fixes/ovl-fixes
+Already up to date.
+Merging fscrypt/for-next (19591f7e781fd fscrypt: use HMAC-SHA512 library for HKDF)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/fs/fscrypt/linux.git fscrypt/for-next
+Merge made by the 'ort' strategy.
+ fs/crypto/Kconfig           |   5 +--
+ fs/crypto/bio.c             |   2 +-
+ fs/crypto/fname.c           |   1 -
+ fs/crypto/fscrypt_private.h |  26 +++++------
+ fs/crypto/hkdf.c            | 105 ++++++++++++++++----------------------------
+ fs/crypto/hooks.c           |   2 +-
+ fs/crypto/keyring.c         |  30 ++++---------
+ fs/crypto/keysetup.c        |  65 +++++++++------------------
+ fs/crypto/policy.c          |   4 +-
+ 9 files changed, 81 insertions(+), 159 deletions(-)
+Merging btrfs/for-next (975e8386564fa Merge branch 'for-next-current-v6.16-20250926' into for-next-20250926)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/kdave/linux.git btrfs/for-next
+Merge made by the 'ort' strategy.
+Merging ceph/master (c22ec9a59b43c ceph: fix potential race condition on operations with CEPH_I_ODIRECT flag)
+$ git merge -m Merge branch 'master' of https://github.com/ceph/ceph-client.git ceph/master
+Merge made by the 'ort' strategy.
+ fs/ceph/dir.c                  |   3 +-
+ fs/ceph/file.c                 |  30 ++++++-------
+ fs/ceph/io.c                   | 100 ++++++++++++++++++++++++++++++-----------
+ fs/ceph/io.h                   |   8 ++--
+ fs/ceph/ioctl.c                |  17 ++++---
+ fs/ceph/locks.c                |   5 ++-
+ fs/ceph/mds_client.c           |   5 ++-
+ fs/ceph/super.h                |   3 +-
+ include/linux/ceph/messenger.h |   4 +-
+ net/ceph/Kconfig               |   3 +-
+ net/ceph/messenger_v2.c        |  77 +++++++++----------------------
+ 11 files changed, 143 insertions(+), 112 deletions(-)
+Merging cifs/for-next (3893198177151 cifs: client: force multichannel=off when max_channels=1)
+$ git merge -m Merge branch 'for-next' of git://git.samba.org/sfrench/cifs-2.6.git cifs/for-next
+Merge made by the 'ort' strategy.
+ fs/smb/client/Kconfig       |   1 +
+ fs/smb/client/cached_dir.c  |  32 ++---
+ fs/smb/client/cached_dir.h  |   7 +-
+ fs/smb/client/cifsencrypt.c |   8 +-
+ fs/smb/client/dir.c         |  45 +++++-
+ fs/smb/client/fs_context.c  |   7 +
+ fs/smb/client/inode.c       |   2 +-
+ fs/smb/client/smb2ops.c     | 333 +++++++++++++++++++++++++++-----------------
+ fs/smb/client/smb2pdu.c     |  18 +--
+ fs/smb/client/smb2pdu.h     |  16 ++-
+ fs/smb/client/trace.h       |   3 +-
+ fs/smb/common/Makefile      |   1 -
+ fs/smb/common/arc4.h        |  23 ---
+ fs/smb/common/cifs_arc4.c   |  75 ----------
+ fs/smb/server/Kconfig       |   1 +
+ fs/smb/server/auth.c        |   9 +-
+ 16 files changed, 309 insertions(+), 272 deletions(-)
+ delete mode 100644 fs/smb/common/arc4.h
+ delete mode 100644 fs/smb/common/cifs_arc4.c
+Merging configfs/configfs-next (462272dd734b5 configfs: use PTR_ERR_OR_ZERO() to simplify code)
+$ git merge -m Merge branch 'configfs-next' of https://git.kernel.org/pub/scm/linux/kernel/git/a.hindborg/linux.git configfs/configfs-next
+Merge made by the 'ort' strategy.
+ fs/configfs/dir.c | 5 +----
+ 1 file changed, 1 insertion(+), 4 deletions(-)
+Merging ecryptfs/next (fba133a341184 ecryptfs: Remove unused declartion ecryptfs_fill_zeros())
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/tyhicks/ecryptfs.git ecryptfs/next
+Auto-merging fs/ecryptfs/crypto.c
+Auto-merging fs/ecryptfs/ecryptfs_kernel.h
+Merge made by the 'ort' strategy.
+ fs/ecryptfs/crypto.c          | 2 +-
+ fs/ecryptfs/ecryptfs_kernel.h | 1 -
+ fs/ecryptfs/keystore.c        | 4 ++--
+ 3 files changed, 3 insertions(+), 4 deletions(-)
+Merging dlm/next (8e40210788636 dlm: check for undefined release_option values)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/teigland/linux-dlm.git dlm/next
+Merge made by the 'ort' strategy.
+ drivers/md/md-cluster.c |  4 ++--
+ fs/dlm/config.c         | 64 +++++++++++++++++++++++++++++++++++++++++++++++--
+ fs/dlm/config.h         |  2 ++
+ fs/dlm/lock.c           |  2 +-
+ fs/dlm/lockspace.c      | 46 +++++++++++++++++++----------------
+ fs/dlm/member.c         | 27 ++++++++++++++++-----
+ fs/dlm/recover.c        |  2 +-
+ fs/dlm/user.c           |  6 ++---
+ fs/gfs2/lock_dlm.c      |  4 ++--
+ fs/ocfs2/stack_user.c   |  2 +-
+ include/linux/dlm.h     | 33 ++++++++++++++++++++++++-
+ 11 files changed, 153 insertions(+), 39 deletions(-)
+Merging erofs/dev (e2d3af0d64e5f erofs: drop redundant sanity check for ztailpacking inline)
+$ git merge -m Merge branch 'dev' of https://git.kernel.org/pub/scm/linux/kernel/git/xiang/erofs.git erofs/dev
+Merge made by the 'ort' strategy.
+ fs/erofs/data.c     |  4 ++++
+ fs/erofs/dir.c      |  4 ++++
+ fs/erofs/inode.c    | 40 ++++++++++++++++++++++++++++++++++++----
+ fs/erofs/internal.h |  5 +++++
+ fs/erofs/super.c    |  8 ++++++++
+ fs/erofs/zdata.c    |  7 ++-----
+ fs/erofs/zmap.c     |  4 ++--
+ 7 files changed, 61 insertions(+), 11 deletions(-)
+Merging exfat/dev (6558447ace612 exfat: combine iocharset and utf8 option setup)
+$ git merge -m Merge branch 'dev' of https://git.kernel.org/pub/scm/linux/kernel/git/linkinjeon/exfat.git exfat/dev
+Merge made by the 'ort' strategy.
+ fs/exfat/balloc.c    |  85 +++++++++++++++++++++++----
+ fs/exfat/dir.c       | 158 +++++++++++++++++++++++++++++++++++++++++++++++++++
+ fs/exfat/exfat_fs.h  |   7 +++
+ fs/exfat/exfat_raw.h |   6 ++
+ fs/exfat/fatent.c    |  11 ++--
+ fs/exfat/file.c      |  52 +++++++++++++++++
+ fs/exfat/inode.c     |   2 +-
+ fs/exfat/namei.c     |   2 +-
+ fs/exfat/nls.c       |   2 +-
+ fs/exfat/super.c     |  68 +++++++++++++++++-----
+ 10 files changed, 358 insertions(+), 35 deletions(-)
+Merging exportfs/exportfs-next (adc218676eef2 Linux 6.12)
+$ git merge -m Merge branch 'exportfs-next' of https://git.kernel.org/pub/scm/linux/kernel/git/cel/linux.git exportfs/exportfs-next
+Already up to date.
+Merging ext3/for_next (25554ea0b42b6 Pull udf extent block verification.)
+$ git merge -m Merge branch 'for_next' of https://git.kernel.org/pub/scm/linux/kernel/git/jack/linux-fs.git ext3/for_next
+Merge made by the 'ort' strategy.
+ fs/notify/fanotify/fanotify.h        |   2 +
+ fs/notify/fanotify/fanotify_user.c   | 105 +++++++++++++++++++++++++++++++++++
+ fs/notify/inotify/inotify_fsnotify.c |   2 +-
+ fs/quota/dquot.c                     |  10 +++-
+ fs/udf/inode.c                       |   3 +
+ include/linux/fsnotify_backend.h     |   2 +
+ 6 files changed, 122 insertions(+), 2 deletions(-)
+Merging ext4/dev (acf943e9768ec ext4: fix checks for orphan inodes)
+$ git merge -m Merge branch 'dev' of https://git.kernel.org/pub/scm/linux/kernel/git/tytso/ext4.git ext4/dev
+Merge made by the 'ort' strategy.
+ fs/ext4/Kconfig           |  27 ----
+ fs/ext4/ext4.h            |  28 ++++-
+ fs/ext4/fast_commit.c     |   2 +-
+ fs/ext4/file.c            |   2 +-
+ fs/ext4/fsmap.c           |  14 ++-
+ fs/ext4/indirect.c        |   2 +-
+ fs/ext4/inode.c           |  47 ++-----
+ fs/ext4/ioctl.c           | 312 ++++++++++++++++++++++++++++++++++++++++++++--
+ fs/ext4/mballoc.c         |  10 ++
+ fs/ext4/mmp.c             |   6 +-
+ fs/ext4/move_extent.c     |   2 +-
+ fs/ext4/orphan.c          |  19 ++-
+ fs/ext4/super.c           |  38 +++---
+ fs/ext4/xattr.c           |  21 ++--
+ fs/jbd2/checkpoint.c      |   2 +-
+ include/uapi/linux/ext4.h |  53 ++++++++
+ 16 files changed, 467 insertions(+), 118 deletions(-)
+Merging f2fs/dev (c872b6279cd26 f2fs: allocate HOT_DATA for IPU writes)
+$ git merge -m Merge branch 'dev' of https://git.kernel.org/pub/scm/linux/kernel/git/jaegeuk/f2fs.git f2fs/dev
+Merge made by the 'ort' strategy.
+ Documentation/ABI/testing/sysfs-fs-f2fs |  56 ++++++++++++++-
+ Documentation/filesystems/f2fs.rst      | 116 +++++++++++++++++++-----------
+ fs/f2fs/checkpoint.c                    |  53 ++++++++++++++
+ fs/f2fs/compress.c                      |  39 +++++-----
+ fs/f2fs/dir.c                           |  17 ++++-
+ fs/f2fs/f2fs.h                          |  88 ++++++++++++++++++-----
+ fs/f2fs/gc.c                            |   9 ++-
+ fs/f2fs/node.c                          |  75 ++++++++++++++------
+ fs/f2fs/node.h                          |   1 +
+ fs/f2fs/recovery.c                      |   2 +-
+ fs/f2fs/segment.c                       |  30 +++++++-
+ fs/f2fs/segment.h                       |  28 ++++----
+ fs/f2fs/super.c                         | 121 ++++++++++++++++++++++++++++----
+ fs/f2fs/sysfs.c                         | 109 ++++++++++++++++++++++++++++
+ include/linux/f2fs_fs.h                 |   1 +
+ 15 files changed, 611 insertions(+), 134 deletions(-)
+Merging fsverity/for-next (a1f692fd69ccd fsverity: Use 2-way interleaved SHA-256 hashing when supported)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/fs/fsverity/linux.git fsverity/for-next
+Auto-merging fs/btrfs/btrfs_inode.h
+Auto-merging fs/btrfs/inode.c
+Auto-merging fs/btrfs/verity.c
+Auto-merging fs/ceph/inode.c
+Auto-merging fs/ceph/super.h
+Auto-merging fs/crypto/bio.c
+Auto-merging fs/crypto/fname.c
+Auto-merging fs/crypto/fscrypt_private.h
+Auto-merging fs/crypto/hooks.c
+Auto-merging fs/crypto/keysetup.c
+Auto-merging fs/crypto/policy.c
+Auto-merging fs/ext4/ext4.h
+Auto-merging fs/ext4/super.c
+Auto-merging fs/f2fs/f2fs.h
+Auto-merging fs/f2fs/super.c
+Auto-merging include/linux/fs.h
+Merge made by the 'ort' strategy.
+ fs/btrfs/btrfs_inode.h          |   5 +
+ fs/btrfs/inode.c                |   3 +
+ fs/btrfs/verity.c               |   2 +
+ fs/ceph/crypto.c                |   2 +
+ fs/ceph/inode.c                 |   1 +
+ fs/ceph/super.h                 |   1 +
+ fs/crypto/bio.c                 |   2 +-
+ fs/crypto/crypto.c              |  14 +-
+ fs/crypto/fname.c               |  11 +-
+ fs/crypto/fscrypt_private.h     |   4 +-
+ fs/crypto/hooks.c               |   2 +-
+ fs/crypto/inline_crypt.c        |  12 +-
+ fs/crypto/keysetup.c            |  43 +++--
+ fs/crypto/policy.c              |   7 +-
+ fs/ext4/crypto.c                |   2 +
+ fs/ext4/ext4.h                  |   8 +
+ fs/ext4/super.c                 |   6 +
+ fs/ext4/verity.c                |   2 +
+ fs/f2fs/f2fs.h                  |   6 +
+ fs/f2fs/super.c                 |  10 +-
+ fs/f2fs/verity.c                |   2 +
+ fs/ubifs/crypto.c               |   2 +
+ fs/ubifs/ubifs.h                |   4 +
+ fs/verity/enable.c              |  18 +-
+ fs/verity/fsverity_private.h    |  11 +-
+ fs/verity/hash_algs.c           |   3 +-
+ fs/verity/open.c                |  23 +--
+ fs/verity/verify.c              | 177 +++++++++++++++----
+ include/crypto/sha2.h           |  28 +++
+ include/linux/fs.h              |  10 --
+ include/linux/fscrypt.h         |  40 ++++-
+ include/linux/fsverity.h        |  57 +++++--
+ lib/crypto/arm64/sha256-ce.S    | 284 ++++++++++++++++++++++++++++++-
+ lib/crypto/arm64/sha256.h       |  37 ++++
+ lib/crypto/sha256.c             |  71 +++++++-
+ lib/crypto/tests/sha256_kunit.c | 184 ++++++++++++++++++++
+ lib/crypto/x86/sha256-ni-asm.S  | 368 ++++++++++++++++++++++++++++++++++++++++
+ lib/crypto/x86/sha256.h         |  39 +++++
+ 38 files changed, 1362 insertions(+), 139 deletions(-)
+Merging fuse/for-next (d3906d8f3cee0 fuse: enable FUSE_SYNCFS for all fuseblk servers)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mszeredi/fuse.git fuse/for-next
+Auto-merging MAINTAINERS
+Auto-merging fs/fuse/virtio_fs.c
+Merge made by the 'ort' strategy.
+ .../filesystems/{ => fuse}/fuse-io-uring.rst       |   0
+ Documentation/filesystems/{ => fuse}/fuse-io.rst   |   2 +-
+ .../filesystems/{ => fuse}/fuse-passthrough.rst    |   0
+ Documentation/filesystems/{ => fuse}/fuse.rst      |  20 +-
+ Documentation/filesystems/fuse/index.rst           |  14 ++
+ Documentation/filesystems/index.rst                |   5 +-
+ Documentation/filesystems/sysfs.rst                |   2 +-
+ .../translations/zh_CN/filesystems/sysfs.txt       |   2 +-
+ .../translations/zh_TW/filesystems/sysfs.txt       |   2 +-
+ MAINTAINERS                                        |   3 +-
+ fs/fuse/Kconfig                                    |   2 +-
+ fs/fuse/cuse.c                                     |   3 +-
+ fs/fuse/dev.c                                      | 226 +++++++++++++--------
+ fs/fuse/dev_uring.c                                |   8 +-
+ fs/fuse/file.c                                     |  86 ++++----
+ fs/fuse/fuse_dev_i.h                               |  13 +-
+ fs/fuse/fuse_i.h                                   |  23 ++-
+ fs/fuse/inode.c                                    |  76 +++++--
+ fs/fuse/iomode.c                                   |   3 +-
+ fs/fuse/passthrough.c                              |   4 +-
+ fs/fuse/virtio_fs.c                                |  12 +-
+ include/linux/backing-dev.h                        |  14 +-
+ include/linux/wait.h                               |  12 ++
+ include/uapi/linux/fuse.h                          |  22 +-
+ mm/backing-dev.c                                   |   2 +-
+ mm/page-writeback.c                                |  45 ++--
+ tools/testing/selftests/Makefile                   |   1 +
+ .../testing/selftests/filesystems/fuse/.gitignore  |   3 +
+ tools/testing/selftests/filesystems/fuse/Makefile  |  21 ++
+ .../testing/selftests/filesystems/fuse/fuse_mnt.c  | 146 +++++++++++++
+ .../selftests/filesystems/fuse/fusectl_test.c      | 140 +++++++++++++
+ 31 files changed, 699 insertions(+), 213 deletions(-)
+ rename Documentation/filesystems/{ => fuse}/fuse-io-uring.rst (100%)
+ rename Documentation/filesystems/{ => fuse}/fuse-io.rst (99%)
+ rename Documentation/filesystems/{ => fuse}/fuse-passthrough.rst (100%)
+ rename Documentation/filesystems/{ => fuse}/fuse.rst (95%)
+ create mode 100644 Documentation/filesystems/fuse/index.rst
+ create mode 100644 tools/testing/selftests/filesystems/fuse/.gitignore
+ create mode 100644 tools/testing/selftests/filesystems/fuse/Makefile
+ create mode 100644 tools/testing/selftests/filesystems/fuse/fuse_mnt.c
+ create mode 100644 tools/testing/selftests/filesystems/fuse/fusectl_test.c
+Merging gfs2/for-next (28c4d9bc07089 gfs2: Fix unlikely race in gdlm_put_lock)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gfs2/linux-gfs2.git gfs2/for-next
+Auto-merging fs/gfs2/lock_dlm.c
+Merge made by the 'ort' strategy.
+ fs/gfs2/file.c       |  23 ++++---
+ fs/gfs2/glock.c      | 185 +++++++++++++++++++++++----------------------------
+ fs/gfs2/glock.h      |   4 ++
+ fs/gfs2/incore.h     |   5 +-
+ fs/gfs2/lock_dlm.c   | 100 +++++++++++++++++-----------
+ fs/gfs2/trace_gfs2.h |   1 -
+ fs/gfs2/util.c       |  38 ++++-------
+ fs/gfs2/util.h       |  36 +++++-----
+ 8 files changed, 199 insertions(+), 193 deletions(-)
+Merging jfs/jfs-next (cafc6679824a0 jfs: replace hardcoded magic number with DTPAGEMAXSLOT constant)
+$ git merge -m Merge branch 'jfs-next' of https://github.com/kleikamp/linux-shaggy.git jfs/jfs-next
+Merge made by the 'ort' strategy.
+ fs/jfs/inode.c      |  8 +++++++-
+ fs/jfs/jfs_dtree.c  |  4 ++--
+ fs/jfs/jfs_logmgr.c |  1 -
+ fs/jfs/jfs_mount.c  | 10 +++++-----
+ fs/jfs/jfs_txnmgr.c |  9 +++++----
+ 5 files changed, 19 insertions(+), 13 deletions(-)
+Merging ksmbd/ksmbd-for-next (022e5d45d6351 ksmbd: add an error print when maximum IP connections limit is reached)
+$ git merge -m Merge branch 'ksmbd-for-next' of https://github.com/smfrench/smb3-kernel.git ksmbd/ksmbd-for-next
+Auto-merging fs/smb/client/smb2ops.c
+Auto-merging fs/smb/client/smb2pdu.c
+Merge made by the 'ort' strategy.
+ fs/smb/client/cifs_debug.c                 |   81 +-
+ fs/smb/client/cifsglob.h                   |    9 +-
+ fs/smb/client/file.c                       |   16 +-
+ fs/smb/client/smb2ops.c                    |    8 +-
+ fs/smb/client/smb2pdu.c                    |    2 +-
+ fs/smb/client/smbdirect.c                  | 1225 ++++++++++++---------
+ fs/smb/client/smbdirect.h                  |  102 +-
+ fs/smb/common/smbdirect/smbdirect.h        |    7 +
+ fs/smb/common/smbdirect/smbdirect_socket.h |  319 +++++-
+ fs/smb/server/connection.c                 |   27 +-
+ fs/smb/server/connection.h                 |   16 +-
+ fs/smb/server/ksmbd_netlink.h              |    5 +-
+ fs/smb/server/mgmt/share_config.c          |    2 +-
+ fs/smb/server/mgmt/user_session.c          |   28 +-
+ fs/smb/server/server.c                     |    1 +
+ fs/smb/server/server.h                     |    1 +
+ fs/smb/server/smb2pdu.c                    |   30 +-
+ fs/smb/server/smb2pdu.h                    |    6 -
+ fs/smb/server/transport_ipc.c              |    3 +
+ fs/smb/server/transport_rdma.c             | 1614 ++++++++++++++++------------
+ fs/smb/server/transport_rdma.h             |   45 +-
+ fs/smb/server/transport_tcp.c              |   97 +-
+ fs/smb/server/vfs.c                        |   16 +-
+ 23 files changed, 2189 insertions(+), 1471 deletions(-)
+Merging nfs/linux-next (07e27ad16399a Linux 6.17-rc7)
+$ git merge -m Merge branch 'linux-next' of git://git.linux-nfs.org/projects/trondmy/nfs-2.6.git nfs/linux-next
+Already up to date.
+Merging nfs-anna/linux-next (20b1d75fb840c NFSv4/flexfiles: Add support for striped layouts)
+$ git merge -m Merge branch 'linux-next' of git://git.linux-nfs.org/projects/anna/linux-nfs.git nfs-anna/linux-next
+Auto-merging fs/nfs/nfs4proc.c
+Merge made by the 'ort' strategy.
+ fs/lockd/svc.c                            |   6 +-
+ fs/nfs/blocklayout/blocklayout.c          |   8 +-
+ fs/nfs/blocklayout/dev.c                  |   8 +-
+ fs/nfs/callback.c                         |  10 +-
+ fs/nfs/dir.c                              |   8 +-
+ fs/nfs/file.c                             |  29 +-
+ fs/nfs/filelayout/filelayout.c            |  10 +-
+ fs/nfs/filelayout/filelayoutdev.c         |  10 +-
+ fs/nfs/flexfilelayout/flexfilelayout.c    | 804 ++++++++++++++++++++----------
+ fs/nfs/flexfilelayout/flexfilelayout.h    |  64 ++-
+ fs/nfs/flexfilelayout/flexfilelayoutdev.c | 115 +++--
+ fs/nfs/nfs42proc.c                        |   4 +-
+ fs/nfs/nfs42xdr.c                         |   2 +-
+ fs/nfs/nfs4file.c                         |   1 +
+ fs/nfs/nfs4proc.c                         |  10 +-
+ fs/nfs/nfs4state.c                        |   3 +
+ fs/nfs/nfs4xdr.c                          |   4 +-
+ fs/nfs/nfstrace.h                         | 139 +++++-
+ fs/nfs/write.c                            |  34 +-
+ fs/nfsd/nfsctl.c                          |   2 +-
+ fs/nfsd/nfssvc.c                          |   7 +-
+ include/linux/nfs_page.h                  |   2 -
+ include/linux/nfs_xdr.h                   |   4 +-
+ include/linux/pagemap.h                   |   2 +
+ include/linux/sunrpc/debug.h              |  30 +-
+ include/linux/sunrpc/svc.h                |   4 +-
+ include/linux/sunrpc/svc_xprt.h           |   3 +-
+ include/linux/sunrpc/xdr.h                |   8 +-
+ mm/filemap.c                              |  34 +-
+ net/sunrpc/Kconfig                        |  14 +
+ net/sunrpc/auth_gss/gss_rpc_xdr.c         |   8 +-
+ net/sunrpc/socklib.c                      |   2 +-
+ net/sunrpc/svc.c                          |  11 +-
+ net/sunrpc/svc_xprt.c                     |   7 +-
+ net/sunrpc/xprtrdma/rpc_rdma.c            |   2 +-
+ 35 files changed, 956 insertions(+), 453 deletions(-)
+Merging nfsd/nfsd-next (db155b7c7c85b NFSD: Disallow layoutget during grace period)
+$ git merge -m Merge branch 'nfsd-next' of https://git.kernel.org/pub/scm/linux/kernel/git/cel/linux nfsd/nfsd-next
+Auto-merging include/linux/fs.h
+Auto-merging include/linux/sunrpc/svc_xprt.h
+Auto-merging include/linux/sunrpc/xdr.h
+Auto-merging net/sunrpc/svc.c
+Auto-merging net/sunrpc/svc_xprt.c
+Merge made by the 'ort' strategy.
+ fs/attr.c                                          | 44 +++++-----
+ fs/lockd/svclock.c                                 |  2 +-
+ fs/nfsd/Kconfig                                    |  2 +-
+ fs/nfsd/blocklayout.c                              | 25 +++---
+ fs/nfsd/blocklayoutxdr.c                           | 86 ++++++++++++-------
+ fs/nfsd/blocklayoutxdr.h                           |  4 +-
+ fs/nfsd/debugfs.c                                  |  2 +-
+ fs/nfsd/export.c                                   | 82 ++++++++++++------
+ fs/nfsd/export.h                                   |  3 +
+ fs/nfsd/filecache.c                                | 21 -----
+ fs/nfsd/filecache.h                                |  1 -
+ fs/nfsd/flexfilelayoutxdr.c                        |  3 +-
+ fs/nfsd/localio.c                                  |  1 -
+ fs/nfsd/lockd.c                                    | 15 ++++
+ fs/nfsd/nfs4layouts.c                              |  1 -
+ fs/nfsd/nfs4proc.c                                 | 98 ++++++++++++++++------
+ fs/nfsd/nfs4recover.c                              | 31 ++-----
+ fs/nfsd/nfs4state.c                                | 86 ++++++++++++++-----
+ fs/nfsd/nfs4xdr.c                                  | 32 +++----
+ fs/nfsd/nfscache.c                                 | 15 +---
+ fs/nfsd/nfsfh.c                                    | 47 ++++++++++-
+ fs/nfsd/nfsfh.h                                    | 38 +++++++++
+ fs/nfsd/pnfs.h                                     |  1 +
+ fs/nfsd/state.h                                    | 16 +++-
+ fs/nfsd/vfs.c                                      |  2 +-
+ fs/nfsd/vfs.h                                      | 33 --------
+ fs/nfsd/xdr4.h                                     | 39 ++++++++-
+ include/linux/fs.h                                 |  1 +
+ include/linux/nfslocalio.h                         |  1 -
+ include/linux/sunrpc/svc_xprt.h                    |  3 +
+ include/linux/sunrpc/xdr.h                         |  4 +-
+ net/sunrpc/auth_gss/svcauth_gss.c                  |  2 +-
+ net/sunrpc/svc.c                                   | 17 +++-
+ net/sunrpc/svc_xprt.c                              | 13 +++
+ net/sunrpc/svcsock.c                               | 25 +++---
+ net/sunrpc/sysfs.c                                 |  2 +-
+ .../C/typedef/decoder/fixed_length_opaque.j2       |  2 +-
+ 37 files changed, 508 insertions(+), 292 deletions(-)
+Merging ntfs3/master (7d460636b6402 ntfs3: stop using write_cache_pages)
+$ git merge -m Merge branch 'master' of https://github.com/Paragon-Software-Group/linux-ntfs3.git ntfs3/master
+Merge made by the 'ort' strategy.
+ fs/ntfs3/bitmap.c  |  1 +
+ fs/ntfs3/file.c    | 28 ++++++++++++++++++++++++++++
+ fs/ntfs3/index.c   | 10 ++++++++++
+ fs/ntfs3/inode.c   | 16 +++++++++++-----
+ fs/ntfs3/ntfs_fs.h |  2 +-
+ fs/ntfs3/run.c     | 12 +++++++++---
+ 6 files changed, 60 insertions(+), 9 deletions(-)
+Merging orangefs/for-next (9a8e34089020d fs/orangefs: Replace kzalloc + copy_from_user with memdup_user_nul)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/hubcap/linux.git orangefs/for-next
+Merge made by the 'ort' strategy.
+ fs/orangefs/namei.c            | 10 +++-------
+ fs/orangefs/orangefs-debugfs.c | 11 +++++------
+ fs/orangefs/orangefs-kernel.h  |  2 +-
+ fs/orangefs/xattr.c            | 12 +++++++-----
+ 4 files changed, 16 insertions(+), 19 deletions(-)
+Merging overlayfs/overlayfs-next (ad1423922781e ovl: make sure that ovl_create_real() returns a hashed dentry)
+$ git merge -m Merge branch 'overlayfs-next' of https://git.kernel.org/pub/scm/linux/kernel/git/overlayfs/vfs.git overlayfs/overlayfs-next
+Auto-merging include/linux/fs.h
+Merge made by the 'ort' strategy.
+ fs/overlayfs/copy_up.c   |   2 +-
+ fs/overlayfs/dir.c       |  29 ++++++++++-
+ fs/overlayfs/inode.c     |   1 +
+ fs/overlayfs/namei.c     |  17 ++++---
+ fs/overlayfs/overlayfs.h |   8 +--
+ fs/overlayfs/ovl_entry.h |   1 +
+ fs/overlayfs/params.c    |  15 ++++--
+ fs/overlayfs/params.h    |   1 +
+ fs/overlayfs/readdir.c   | 126 +++++++++++++++++++++++++++++++++++++++--------
+ fs/overlayfs/super.c     |  64 +++++++++++++++++++++++-
+ fs/overlayfs/util.c      |   6 +--
+ include/linux/fs.h       |  29 +++++++++--
+ 12 files changed, 255 insertions(+), 44 deletions(-)
+Merging ubifs/next (99dbb2a1bd661 ubifs: stop using write_cache_pages)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/rw/ubifs.git ubifs/next
+Already up to date.
+Merging v9fs/9p-next (528f218b31aac 9p: sysfs_init: don't hardcode error to ENOMEM)
+$ git merge -m Merge branch '9p-next' of https://github.com/martinetd/linux v9fs/9p-next
+Merge made by the 'ort' strategy.
+ fs/9p/v9fs.c           | 16 +++++++++-------
+ fs/9p/vfs_dentry.c     | 33 +++++++++++++++++++++++++++++----
+ fs/9p/vfs_inode.c      |  8 +++++++-
+ fs/9p/vfs_inode_dotl.c |  8 +++++++-
+ net/9p/trans_fd.c      | 17 +++++------------
+ net/9p/trans_usbg.c    | 16 +++++++++++++---
+ 6 files changed, 70 insertions(+), 28 deletions(-)
+Merging v9fs-ericvh/ericvh/for-next (2014c95afecee Linux 6.14-rc1)
+$ git merge -m Merge branch 'ericvh/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ericvh/v9fs.git v9fs-ericvh/ericvh/for-next
+Already up to date.
+Merging xfs/for-next (c91d38b57f2c4 xfs: rework datasync tracking and execution)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/fs/xfs/xfs-linux.git xfs/for-next
+Merge made by the 'ort' strategy.
+ Documentation/admin-guide/xfs.rst |  69 +----
+ fs/xfs/Kconfig                    |  22 +-
+ fs/xfs/libxfs/xfs_ag_resv.c       |   7 +-
+ fs/xfs/libxfs/xfs_alloc.c         |   5 +-
+ fs/xfs/libxfs/xfs_attr_leaf.c     |  25 +-
+ fs/xfs/libxfs/xfs_bmap.c          |  31 +-
+ fs/xfs/libxfs/xfs_btree.c         |   2 +-
+ fs/xfs/libxfs/xfs_da_btree.c      |   2 +-
+ fs/xfs/libxfs/xfs_dir2.c          |   2 +-
+ fs/xfs/libxfs/xfs_errortag.h      | 114 ++++---
+ fs/xfs/libxfs/xfs_exchmaps.c      |   4 +-
+ fs/xfs/libxfs/xfs_ialloc.c        |   6 +-
+ fs/xfs/libxfs/xfs_inode_buf.c     |   4 +-
+ fs/xfs/libxfs/xfs_inode_fork.c    |   3 +-
+ fs/xfs/libxfs/xfs_inode_util.c    |  11 -
+ fs/xfs/libxfs/xfs_log_format.h    | 150 +++++----
+ fs/xfs/libxfs/xfs_log_recover.h   |   2 +-
+ fs/xfs/libxfs/xfs_metafile.c      |   2 +-
+ fs/xfs/libxfs/xfs_ondisk.h        |   2 +
+ fs/xfs/libxfs/xfs_refcount.c      |   7 +-
+ fs/xfs/libxfs/xfs_rmap.c          |   2 +-
+ fs/xfs/libxfs/xfs_rtbitmap.c      |   2 +-
+ fs/xfs/libxfs/xfs_sb.c            |   9 +-
+ fs/xfs/libxfs/xfs_zones.h         |   7 +
+ fs/xfs/scrub/cow_repair.c         |   4 +-
+ fs/xfs/scrub/metapath.c           |  12 +-
+ fs/xfs/scrub/newbt.c              |   9 +
+ fs/xfs/scrub/reap.c               | 622 ++++++++++++++++++++++++++++++--------
+ fs/xfs/scrub/repair.c             |   2 +-
+ fs/xfs/scrub/repair.h             |   8 -
+ fs/xfs/scrub/symlink_repair.c     |   2 +-
+ fs/xfs/scrub/trace.c              |   1 +
+ fs/xfs/scrub/trace.h              |  45 +++
+ fs/xfs/xfs_attr_item.c            |   2 +-
+ fs/xfs/xfs_buf.c                  |  46 +--
+ fs/xfs/xfs_buf.h                  |   4 +-
+ fs/xfs/xfs_buf_item_recover.c     |  10 +
+ fs/xfs/xfs_error.c                | 216 ++-----------
+ fs/xfs/xfs_error.h                |  47 ++-
+ fs/xfs/xfs_extfree_item.c         |   4 +-
+ fs/xfs/xfs_extfree_item.h         |   4 +-
+ fs/xfs/xfs_file.c                 |  75 +++--
+ fs/xfs/xfs_globals.c              |   2 -
+ fs/xfs/xfs_icache.c               |   6 +-
+ fs/xfs/xfs_inode.c                | 117 +++----
+ fs/xfs/xfs_inode_item.c           | 125 +++++---
+ fs/xfs/xfs_inode_item.h           |  10 +-
+ fs/xfs/xfs_ioctl.c                |  24 +-
+ fs/xfs/xfs_iomap.c                |  19 +-
+ fs/xfs/xfs_iops.c                 |  14 +-
+ fs/xfs/xfs_linux.h                |   2 -
+ fs/xfs/xfs_log.c                  |  35 +--
+ fs/xfs/xfs_log.h                  |  37 +++
+ fs/xfs/xfs_log_priv.h             |   4 +-
+ fs/xfs/xfs_log_recover.c          |  34 ++-
+ fs/xfs/xfs_mount.c                |  13 -
+ fs/xfs/xfs_mount.h                |  12 +-
+ fs/xfs/xfs_notify_failure.c       |   2 +-
+ fs/xfs/xfs_super.c                |  67 +---
+ fs/xfs/xfs_sysctl.c               |  29 +-
+ fs/xfs/xfs_sysctl.h               |   3 -
+ fs/xfs/xfs_trans.c                |  23 +-
+ fs/xfs/xfs_trans_ail.c            |   2 +-
+ fs/xfs/xfs_zone_alloc.c           | 122 ++++----
+ include/linux/rw_hint.h           |   1 +
+ 65 files changed, 1251 insertions(+), 1055 deletions(-)
+Merging zonefs/for-next (a42938e80357a zonefs: correct some spelling mistakes)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/dlemoal/zonefs.git zonefs/for-next
+Merge made by the 'ort' strategy.
+ fs/zonefs/file.c  | 2 +-
+ fs/zonefs/super.c | 4 ++--
+ 2 files changed, 3 insertions(+), 3 deletions(-)
+Merging vfs-brauner/vfs.all (267652e9d4746 Merge branch 'vfs-6.18.async' into vfs.all)
+$ git merge -m Merge branch 'vfs.all' of https://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs.git vfs-brauner/vfs.all
+Auto-merging MAINTAINERS
+Auto-merging fs/btrfs/block-group.c
+Auto-merging fs/btrfs/disk-io.c
+Auto-merging fs/btrfs/extent_map.c
+Auto-merging fs/btrfs/inode.c
+Auto-merging fs/btrfs/space-info.c
+Auto-merging fs/btrfs/zoned.c
+Auto-merging fs/ceph/mds_client.c
+Auto-merging fs/ext4/mballoc.c
+Auto-merging fs/ext4/super.c
+Auto-merging fs/f2fs/super.c
+Auto-merging fs/fuse/dev.c
+Auto-merging fs/fuse/inode.c
+Auto-merging fs/nfsd/filecache.c
+Auto-merging fs/nfsd/vfs.c
+Auto-merging fs/overlayfs/overlayfs.h
+Auto-merging fs/overlayfs/readdir.c
+Auto-merging fs/overlayfs/super.c
+Auto-merging fs/quota/dquot.c
+CONFLICT (content): Merge conflict in fs/quota/dquot.c
+Auto-merging fs/smb/client/inode.c
+Auto-merging fs/smb/server/transport_rdma.c
+Auto-merging fs/smb/server/vfs.c
+Auto-merging fs/verity/verify.c
+Auto-merging fs/xfs/xfs_inode.c
+Auto-merging fs/xfs/xfs_log.c
+Auto-merging fs/xfs/xfs_super.c
+Auto-merging include/linux/fs.h
+Auto-merging init/Kconfig
+Auto-merging kernel/cgroup/cgroup.c
+Auto-merging kernel/fork.c
+Auto-merging kernel/sched/core.c
+Auto-merging kernel/sched/fair.c
+Auto-merging kernel/sched/sched.h
+Auto-merging mm/backing-dev.c
+Resolved 'fs/quota/dquot.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 63863620e37e8] Merge branch 'vfs.all' of https://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/admin-guide/kernel-parameters.txt    |    3 +
+ Documentation/filesystems/porting.rst              |   16 +-
+ Documentation/filesystems/proc.rst                 |    8 +
+ Documentation/filesystems/vfs.rst                  |   31 +-
+ MAINTAINERS                                        |    1 +
+ arch/alpha/kernel/process.c                        |    2 +-
+ arch/arc/kernel/process.c                          |    2 +-
+ arch/arm/kernel/process.c                          |    2 +-
+ arch/arm64/kernel/process.c                        |    2 +-
+ arch/csky/kernel/process.c                         |    2 +-
+ arch/hexagon/kernel/process.c                      |    2 +-
+ arch/loongarch/kernel/process.c                    |    2 +-
+ arch/m68k/kernel/process.c                         |    2 +-
+ arch/microblaze/kernel/process.c                   |    2 +-
+ arch/mips/kernel/process.c                         |    2 +-
+ arch/nios2/include/asm/syscalls.h                  |    1 +
+ arch/nios2/include/asm/unistd.h                    |    2 -
+ arch/nios2/kernel/entry.S                          |    6 +
+ arch/nios2/kernel/process.c                        |    2 +-
+ arch/nios2/kernel/syscall_table.c                  |    1 +
+ arch/openrisc/kernel/process.c                     |    2 +-
+ arch/parisc/kernel/process.c                       |    2 +-
+ arch/powerpc/kernel/process.c                      |    2 +-
+ arch/powerpc/platforms/cell/spufs/file.c           |    2 +-
+ arch/powerpc/platforms/cell/spufs/syscalls.c       |    4 +-
+ arch/riscv/kernel/process.c                        |    2 +-
+ arch/s390/kernel/process.c                         |    2 +-
+ arch/sh/kernel/process_32.c                        |    2 +-
+ arch/sparc/kernel/process_32.c                     |    2 +-
+ arch/sparc/kernel/process_64.c                     |    2 +-
+ arch/um/kernel/process.c                           |    2 +-
+ arch/x86/include/asm/fpu/sched.h                   |    2 +-
+ arch/x86/include/asm/shstk.h                       |    4 +-
+ arch/x86/kernel/fpu/core.c                         |    2 +-
+ arch/x86/kernel/process.c                          |    2 +-
+ arch/x86/kernel/shstk.c                            |    2 +-
+ arch/xtensa/kernel/process.c                       |    2 +-
+ block/bdev.c                                       |    2 +-
+ block/blk-integrity.c                              |    8 +-
+ block/blk-ioc.c                                    |    2 +-
+ drivers/base/devtmpfs.c                            |   22 +-
+ drivers/dax/super.c                                |    2 +-
+ drivers/misc/ibmasm/ibmasmfs.c                     |    2 +-
+ drivers/usb/gadget/function/f_fs.c                 |    2 +-
+ drivers/usb/gadget/legacy/inode.c                  |    2 +-
+ fs/9p/vfs_super.c                                  |    2 +-
+ fs/afs/callback.c                                  |    4 +-
+ fs/afs/dir.c                                       |  223 ++-
+ fs/afs/dir_edit.c                                  |   18 +-
+ fs/afs/dir_silly.c                                 |   11 +
+ fs/afs/inode.c                                     |    4 +-
+ fs/afs/internal.h                                  |   15 +-
+ fs/afs/main.c                                      |    4 +-
+ fs/afs/misc.c                                      |    1 +
+ fs/afs/protocol_yfs.h                              |    3 +
+ fs/afs/rotate.c                                    |   17 +-
+ fs/afs/write.c                                     |    2 +-
+ fs/afs/yfsclient.c                                 |  249 ++++
+ fs/aio.c                                           |    2 +-
+ fs/bcachefs/btree_write_buffer.c                   |    2 +-
+ fs/bcachefs/fs-ioctl.c                             |   10 +-
+ fs/bcachefs/io_read.c                              |    8 +-
+ fs/bcachefs/journal_io.c                           |    2 +-
+ fs/bcachefs/super.c                                |   10 +-
+ fs/btrfs/block-group.c                             |    2 +-
+ fs/btrfs/disk-io.c                                 |    2 +-
+ fs/btrfs/extent_map.c                              |    2 +-
+ fs/btrfs/inode.c                                   |    4 +-
+ fs/btrfs/space-info.c                              |    4 +-
+ fs/btrfs/zoned.c                                   |    2 +-
+ fs/cachefiles/namei.c                              |    3 +-
+ fs/ceph/mds_client.c                               |    2 +-
+ fs/ceph/super.c                                    |    4 +-
+ fs/configfs/mount.c                                |    2 +-
+ fs/coredump.c                                      |    2 +-
+ fs/cramfs/inode.c                                  |   11 +-
+ fs/dcache.c                                        |    5 +-
+ fs/debugfs/inode.c                                 |   11 +-
+ fs/dlm/lowcomms.c                                  |    2 +-
+ fs/dlm/main.c                                      |    2 +-
+ fs/ecryptfs/inode.c                                |    3 +-
+ fs/efivarfs/super.c                                |    2 +-
+ fs/eventpoll.c                                     |  139 +-
+ fs/ext4/ialloc.c                                   |    4 +-
+ fs/ext4/mballoc.c                                  |    2 +-
+ fs/ext4/super.c                                    |    2 +-
+ fs/f2fs/super.c                                    |    6 +-
+ fs/fcntl.c                                         |   10 +-
+ fs/fhandle.c                                       |    6 +
+ fs/file.c                                          |    5 +-
+ fs/fs-writeback.c                                  |  141 +-
+ fs/fsopen.c                                        |   70 +-
+ fs/fuse/dev.c                                      |    2 +-
+ fs/fuse/inode.c                                    |    4 +-
+ fs/gfs2/main.c                                     |    5 +-
+ fs/gfs2/ops_fstype.c                               |    8 +-
+ fs/gfs2/super.c                                    |    2 +-
+ fs/hostfs/hostfs_kern.c                            |    2 +-
+ fs/hpfs/inode.c                                    |    2 +-
+ fs/init.c                                          |   17 +-
+ fs/inode.c                                         |  118 +-
+ fs/internal.h                                      |    1 +
+ fs/ioctl.c                                         |    5 +-
+ fs/iomap/buffered-io.c                             |   18 +-
+ fs/iomap/direct-io.c                               |    3 +
+ fs/iomap/trace.h                                   |    1 +
+ fs/kernfs/mount.c                                  |    2 +-
+ fs/locks.c                                         |    4 +-
+ fs/minix/inode.c                                   |    8 +-
+ fs/mount.h                                         |   12 +-
+ fs/namei.c                                         |  186 ++-
+ fs/namespace.c                                     |  314 ++---
+ fs/netfs/misc.c                                    |    2 +-
+ fs/netfs/objects.c                                 |    2 +-
+ fs/nfs/inode.c                                     |    6 +-
+ fs/nfs/namespace.c                                 |    2 +-
+ fs/nfs/nfs4renewd.c                                |    2 +-
+ fs/nfsd/filecache.c                                |    2 +-
+ fs/nfsd/vfs.c                                      |    3 +-
+ fs/notify/fsnotify.c                               |    2 +-
+ fs/notify/mark.c                                   |    4 +-
+ fs/nsfs.c                                          |  211 ++-
+ fs/ocfs2/dlm/dlmdomain.c                           |    3 +-
+ fs/ocfs2/dlmfs/dlmfs.c                             |    5 +-
+ fs/ocfs2/refcounttree.c                            |    4 +-
+ fs/orangefs/super.c                                |    2 +-
+ fs/overlayfs/overlayfs.h                           |    3 +-
+ fs/overlayfs/readdir.c                             |   28 +-
+ fs/overlayfs/super.c                               |    2 +-
+ fs/pidfs.c                                         |    4 +-
+ fs/pipe.c                                          |    6 +-
+ fs/proc/array.c                                    |    4 +-
+ fs/proc/inode.c                                    |    2 +-
+ fs/proc/namespaces.c                               |    6 +-
+ fs/proc/root.c                                     |   98 +-
+ fs/pstore/inode.c                                  |    2 +-
+ fs/ramfs/inode.c                                   |    2 +-
+ fs/read_write.c                                    |   14 +-
+ fs/smb/client/cifsfs.c                             |   18 +-
+ fs/smb/client/inode.c                              |    2 +-
+ fs/smb/server/ksmbd_work.c                         |    2 +-
+ fs/smb/server/transport_rdma.c                     |    3 +-
+ fs/smb/server/vfs.c                                |   11 +-
+ fs/super.c                                         |   74 +-
+ fs/ubifs/super.c                                   |    4 +-
+ fs/verity/verify.c                                 |    2 +-
+ fs/xfs/xfs_inode.c                                 |    2 +-
+ fs/xfs/xfs_log.c                                   |    3 +-
+ fs/xfs/xfs_mru_cache.c                             |    3 +-
+ fs/xfs/xfs_super.c                                 |   17 +-
+ fs/xfs/xfs_trace.h                                 |    2 +-
+ include/linux/backing-dev-defs.h                   |    4 +
+ include/linux/cgroup.h                             |   47 +-
+ include/linux/cgroup_namespace.h                   |   58 +
+ include/linux/cred.h                               |    2 +-
+ include/linux/exportfs.h                           |    6 +
+ include/linux/fs.h                                 |  272 ++--
+ include/linux/fs_context.h                         |   18 +-
+ include/linux/iocontext.h                          |    6 +-
+ include/linux/ipc_namespace.h                      |   13 +-
+ include/linux/lsm_hook_defs.h                      |    2 +-
+ include/linux/mnt_namespace.h                      |    4 +-
+ include/linux/namei.h                              |   19 +-
+ include/linux/ns_common.h                          |  139 +-
+ include/linux/nsfs.h                               |   40 +
+ include/linux/nsproxy.h                            |   13 +-
+ include/linux/nstree.h                             |   78 ++
+ include/linux/pid_namespace.h                      |   20 +-
+ include/linux/proc_ns.h                            |   22 +-
+ include/linux/rseq.h                               |    4 +-
+ include/linux/sched/task.h                         |    2 +-
+ include/linux/security.h                           |    4 +-
+ include/linux/sem.h                                |    4 +-
+ include/linux/time_namespace.h                     |   17 +-
+ include/linux/uprobes.h                            |    4 +-
+ include/linux/user_events.h                        |    4 +-
+ include/linux/user_namespace.h                     |    9 +-
+ include/linux/uts_namespace.h                      |   65 +
+ include/linux/utsname.h                            |   53 +-
+ include/linux/writeback.h                          |    2 +
+ include/net/net_namespace.h                        |   17 +-
+ include/trace/events/afs.h                         |    6 +
+ include/trace/events/filelock.h                    |    5 +-
+ include/trace/events/task.h                        |    6 +-
+ include/trace/events/writeback.h                   |   29 +
+ include/uapi/linux/fcntl.h                         |    1 +
+ include/uapi/linux/fs.h                            |    5 +-
+ include/uapi/linux/nsfs.h                          |   18 +-
+ init/Kconfig                                       |    1 +
+ init/do_mounts_rd.c                                |   14 +-
+ init/initramfs.c                                   |    5 +-
+ init/main.c                                        |    2 +
+ init/version-timestamp.c                           |    5 +-
+ ipc/msgutil.c                                      |    6 +-
+ ipc/namespace.c                                    |   21 +-
+ ipc/sem.c                                          |    2 +-
+ ipc/shm.c                                          |    2 +
+ kernel/Makefile                                    |    2 +-
+ kernel/audit_fsnotify.c                            |   11 +-
+ kernel/audit_watch.c                               |    3 +-
+ kernel/bpf/inode.c                                 |    6 +-
+ kernel/cgroup/cgroup.c                             |    7 +-
+ kernel/cgroup/namespace.c                          |   29 +-
+ kernel/cred.c                                      |    2 +-
+ kernel/events/uprobes.c                            |    2 +-
+ kernel/fork.c                                      |   10 +-
+ kernel/nscommon.c                                  |   77 ++
+ kernel/nsproxy.c                                   |    8 +-
+ kernel/nstree.c                                    |  247 ++++
+ kernel/pid.c                                       |   12 +-
+ kernel/pid_namespace.c                             |   47 +-
+ kernel/sched/core.c                                |    4 +-
+ kernel/sched/fair.c                                |    2 +-
+ kernel/sched/sched.h                               |    4 +-
+ kernel/time/namespace.c                            |   34 +-
+ kernel/tsacct.c                                    |    3 +-
+ kernel/user.c                                      |    5 +-
+ kernel/user_namespace.c                            |   24 +-
+ kernel/utsname.c                                   |   33 +-
+ mm/backing-dev.c                                   |    5 +
+ mm/shmem.c                                         |    2 +-
+ net/core/net-sysfs.c                               |    6 +-
+ net/core/net_namespace.c                           |   60 +-
+ net/ipv4/inet_timewait_sock.c                      |    4 +-
+ net/ipv4/tcp_metrics.c                             |    2 +-
+ net/socket.c                                       |    3 +
+ net/unix/af_unix.c                                 |    6 +-
+ rust/kernel/fs/file.rs                             |   10 +-
+ rust/kernel/pid_namespace.rs                       |    5 +-
+ security/apparmor/lsm.c                            |    2 +-
+ security/landlock/fs.c                             |    2 +-
+ security/security.c                                |    2 +-
+ security/selinux/hooks.c                           |    2 +-
+ security/tomoyo/tomoyo.c                           |    2 +-
+ tools/include/uapi/linux/nsfs.h                    |   17 +-
+ tools/testing/selftests/filesystems/.gitignore     |    1 +
+ tools/testing/selftests/filesystems/Makefile       |    2 +-
+ tools/testing/selftests/filesystems/fclog.c        |  130 ++
+ tools/testing/selftests/namespaces/.gitignore      |    3 +
+ tools/testing/selftests/namespaces/Makefile        |    7 +
+ tools/testing/selftests/namespaces/config          |    7 +
+ .../selftests/namespaces/file_handle_test.c        | 1429 ++++++++++++++++++++
+ tools/testing/selftests/namespaces/init_ino_test.c |   61 +
+ tools/testing/selftests/namespaces/nsid_test.c     |  986 ++++++++++++++
+ tools/testing/selftests/proc/.gitignore            |    1 +
+ tools/testing/selftests/proc/Makefile              |    1 +
+ tools/testing/selftests/proc/proc-pidns.c          |  211 +++
+ 247 files changed, 5682 insertions(+), 1421 deletions(-)
+ create mode 100644 include/linux/cgroup_namespace.h
+ create mode 100644 include/linux/nsfs.h
+ create mode 100644 include/linux/nstree.h
+ create mode 100644 include/linux/uts_namespace.h
+ create mode 100644 kernel/nscommon.c
+ create mode 100644 kernel/nstree.c
+ create mode 100644 tools/testing/selftests/filesystems/fclog.c
+ create mode 100644 tools/testing/selftests/namespaces/.gitignore
+ create mode 100644 tools/testing/selftests/namespaces/Makefile
+ create mode 100644 tools/testing/selftests/namespaces/config
+ create mode 100644 tools/testing/selftests/namespaces/file_handle_test.c
+ create mode 100644 tools/testing/selftests/namespaces/init_ino_test.c
+ create mode 100644 tools/testing/selftests/namespaces/nsid_test.c
+ create mode 100644 tools/testing/selftests/proc/proc-pidns.c
+$ git am -3 ../patches/0001-Revert-nios2-implement-architecture-specific-portion.patch
+Applying: Revert "nios2: implement architecture-specific portion of sys_clone3"
+$ git reset HEAD^
+Unstaged changes after reset:
+M	arch/nios2/include/asm/syscalls.h
+M	arch/nios2/include/asm/unistd.h
+M	arch/nios2/kernel/entry.S
+M	arch/nios2/kernel/syscall_table.c
+$ git add -A .
+$ git commit -v -a --amend
+warning: notes ref refs/notes/commits is invalid
+[master 8830d93184ea8] Merge branch 'vfs.all' of https://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs.git
+ Date: Mon Sep 29 13:11:46 2025 +0100
+Merging vfs/for-next (15f5e46385aa4 Merge branches 'work.fs_context', 'work.f_path', 'work.qstr', 'work.misc', 'work.nfsctl' and 'work.finish_no_open' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git vfs/for-next
+Auto-merging Documentation/filesystems/porting.rst
+CONFLICT (content): Merge conflict in Documentation/filesystems/porting.rst
+Auto-merging fs/9p/vfs_inode.c
+Auto-merging fs/9p/vfs_inode_dotl.c
+Auto-merging fs/afs/dir_edit.c
+Auto-merging fs/afs/internal.h
+CONFLICT (content): Merge conflict in fs/afs/internal.h
+Auto-merging fs/dcache.c
+Auto-merging fs/ecryptfs/ecryptfs_kernel.h
+Auto-merging fs/ecryptfs/inode.c
+Auto-merging fs/exfat/namei.c
+Auto-merging fs/fuse/dir.c
+Auto-merging fs/internal.h
+Auto-merging fs/mount.h
+Auto-merging fs/namei.c
+CONFLICT (content): Merge conflict in fs/namei.c
+Auto-merging fs/namespace.c
+CONFLICT (content): Merge conflict in fs/namespace.c
+Auto-merging fs/nfs/dir.c
+Auto-merging fs/nfs/localio.c
+Auto-merging fs/nfs/namespace.c
+Auto-merging fs/nfsd/export.c
+Auto-merging fs/nfsd/export.h
+Auto-merging fs/nfsd/nfsctl.c
+Auto-merging fs/overlayfs/copy_up.c
+Auto-merging fs/overlayfs/overlayfs.h
+Auto-merging fs/overlayfs/super.c
+Auto-merging fs/overlayfs/util.c
+Auto-merging fs/pidfs.c
+Auto-merging fs/smb/client/dir.c
+Auto-merging fs/smb/client/fs_context.c
+Auto-merging fs/smb/server/vfs.c
+Auto-merging fs/super.c
+Auto-merging include/linux/exportfs.h
+Auto-merging include/linux/fs.h
+Auto-merging include/linux/fs_context.h
+Auto-merging include/linux/lsm_hook_defs.h
+Auto-merging include/linux/namei.h
+CONFLICT (content): Merge conflict in include/linux/namei.h
+Auto-merging include/linux/security.h
+Auto-merging kernel/trace/trace.c
+Auto-merging security/security.c
+Auto-merging security/selinux/hooks.c
+Resolved 'Documentation/filesystems/porting.rst' using previous resolution.
+Resolved 'fs/afs/internal.h' using previous resolution.
+Resolved 'fs/namei.c' using previous resolution.
+Resolved 'fs/namespace.c' using previous resolution.
+Resolved 'include/linux/namei.h' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 2bc01d77199e3] Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/filesystems/mount_api.rst        |   10 +-
+ Documentation/filesystems/porting.rst          |   12 +
+ arch/alpha/include/asm/pgtable.h               |   25 +-
+ arch/alpha/mm/init.c                           |   27 -
+ arch/csky/mm/fault.c                           |    2 +-
+ arch/m68k/include/asm/pgtable_mm.h             |   10 -
+ arch/microblaze/include/asm/pgtable.h          |    1 -
+ arch/openrisc/include/asm/pgtable.h            |   17 -
+ arch/xtensa/include/asm/pgtable.h              |    1 -
+ drivers/gpu/drm/i915/gem/i915_gemfs.c          |    9 +-
+ drivers/gpu/drm/v3d/v3d_gemfs.c                |    9 +-
+ fs/9p/vfs_inode.c                              |   34 +-
+ fs/9p/vfs_inode_dotl.c                         |   15 +-
+ fs/afs/dir_edit.c                              |    4 +-
+ fs/afs/dir_search.c                            |    2 +-
+ fs/afs/internal.h                              |    6 +-
+ fs/afs/mntpt.c                                 |    3 +-
+ fs/bpf_fs_kfuncs.c                             |    2 +-
+ fs/configfs/symlink.c                          |   33 +-
+ fs/dcache.c                                    |   30 +-
+ fs/ecryptfs/dentry.c                           |   14 +-
+ fs/ecryptfs/ecryptfs_kernel.h                  |   27 +-
+ fs/ecryptfs/file.c                             |   15 +-
+ fs/ecryptfs/inode.c                            |   19 +-
+ fs/ecryptfs/main.c                             |   24 +-
+ fs/exfat/namei.c                               |    2 +-
+ fs/file_table.c                                |    6 +-
+ fs/fs_context.c                                |   17 +-
+ fs/fuse/dir.c                                  |   21 +-
+ fs/gfs2/inode.c                                |   26 +-
+ fs/internal.h                                  |    6 +-
+ fs/mount.h                                     |   39 +-
+ fs/namei.c                                     |   12 +-
+ fs/namespace.c                                 | 1018 +++++++++++-------------
+ fs/nfs/dir.c                                   |   18 +-
+ fs/nfs/fs_context.c                            |    3 +-
+ fs/nfs/localio.c                               |    2 +-
+ fs/nfs/namespace.c                             |    3 +-
+ fs/nfs/nfs4super.c                             |   44 +-
+ fs/nfsd/export.c                               |    4 +-
+ fs/nfsd/export.h                               |    2 +-
+ fs/nfsd/nfsctl.c                               |  147 ++--
+ fs/open.c                                      |   20 +-
+ fs/overlayfs/copy_up.c                         |    2 +-
+ fs/overlayfs/file.c                            |    2 +-
+ fs/overlayfs/overlayfs.h                       |    8 +-
+ fs/overlayfs/super.c                           |    2 +-
+ fs/overlayfs/util.c                            |    8 +-
+ fs/pidfs.c                                     |    2 +-
+ fs/pnode.c                                     |   75 +-
+ fs/pnode.h                                     |    1 +
+ fs/smb/client/dir.c                            |    8 +-
+ fs/smb/client/fs_context.c                     |    4 +-
+ fs/smb/server/vfs.c                            |    8 +-
+ fs/smb/server/vfs.h                            |    6 +-
+ fs/stat.c                                      |    2 +-
+ fs/super.c                                     |    3 +-
+ fs/vboxsf/dir.c                                |   25 +-
+ include/linux/dcache.h                         |    5 +-
+ include/linux/exportfs.h                       |    2 +-
+ include/linux/fs.h                             |   19 +-
+ include/linux/fs_context.h                     |    9 +-
+ include/linux/lsm_hook_defs.h                  |    2 +-
+ include/linux/mount.h                          |    9 +-
+ include/linux/namei.h                          |    2 +-
+ include/linux/security.h                       |    4 +-
+ kernel/acct.c                                  |  114 ++-
+ kernel/audit_tree.c                            |   12 +-
+ kernel/trace/bpf_trace.c                       |    2 +-
+ kernel/trace/trace.c                           |    3 +-
+ security/apparmor/af_unix.c                    |   14 +-
+ security/security.c                            |    2 +-
+ security/selinux/hooks.c                       |    2 +-
+ security/smack/smack_lsm.c                     |    2 +-
+ tools/testing/selftests/bpf/bpf_experimental.h |    2 +-
+ 75 files changed, 928 insertions(+), 1174 deletions(-)
+$ git am -3 /home/broonie/git/next/sfr/patches/0001-nsfs-Fix-up-merge.patch
+Applying: nsfs: Fix up merge
+$ git reset HEAD^
+Unstaged changes after reset:
+M	fs/nsfs.c
+$ git add -A .
+$ git commit -v -a --amend
+warning: notes ref refs/notes/commits is invalid
+[master d28cebba00b2d] Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git
+ Date: Mon Sep 29 14:36:15 2025 +0100
+Merging mm-hotfixes/mm-hotfixes-unstable (1d1b743290abb mm/thp: fix MTE tag mismatch when replacing zero-filled subpages)
+$ git merge -m Merge branch 'mm-hotfixes-unstable' of https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm mm-hotfixes/mm-hotfixes-unstable
+Merge made by the 'ort' strategy.
+ include/linux/hung_task.h |  8 +++++---
+ mm/huge_memory.c          | 15 +++------------
+ mm/migrate.c              |  8 +-------
+ 3 files changed, 9 insertions(+), 22 deletions(-)
+Merging fs-current (305f7da737d6e Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git)
+$ git merge -m Merge branch 'fs-current' of linux-next fs-current
+Already up to date.
+Merging kbuild-current/kbuild-fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'kbuild-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/kbuild/linux.git kbuild-current/kbuild-fixes
+Already up to date.
+Merging arc-current/for-curr (d7b8f8e20813f Linux 6.16-rc5)
+$ git merge -m Merge branch 'for-curr' of https://git.kernel.org/pub/scm/linux/kernel/git/vgupta/arc.git arc-current/for-curr
+Already up to date.
+Merging arm-current/fixes (0c66c6f4e21cb ARM: 9359/1: flush: check if the folio is reserved for no-mapping addresses)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/rmk/linux.git arm-current/fixes
+Already up to date.
+Merging arm64-fixes/for-next/fixes (a7ed7b9d0ebb0 arm64: ftrace: fix unreachable PLT for ftrace_caller in init_module with CONFIG_DYNAMIC_FTRACE)
+$ git merge -m Merge branch 'for-next/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux arm64-fixes/for-next/fixes
+Already up to date.
+Merging arm-soc-fixes/arm/fixes (13923775d5b0b Merge tag 'tegra-for-6.17-firmware-fixes' of git://git.kernel.org/pub/scm/linux/kernel/git/tegra/linux into arm/fixes)
+$ git merge -m Merge branch 'arm/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/soc/soc.git arm-soc-fixes/arm/fixes
+Already up to date.
+Merging davinci-current/davinci/for-current (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'davinci/for-current' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git davinci-current/davinci/for-current
+Already up to date.
+Merging drivers-memory-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-mem-ctrl.git drivers-memory-fixes/fixes
+Already up to date.
+Merging sophgo-fixes/fixes (19272b37aa4f8 Linux 6.16-rc1)
+$ git merge -m Merge branch 'fixes' of https://github.com/sophgo/linux.git sophgo-fixes/fixes
+Already up to date.
+Merging sophgo-soc-fixes/soc-fixes (0af2f6be1b428 Linux 6.15-rc1)
+$ git merge -m Merge branch 'soc-fixes' of https://github.com/sophgo/linux.git sophgo-soc-fixes/soc-fixes
+Already up to date.
+Merging m68k-current/for-linus (695f2c0c25f3c m68k: defconfig: Update defconfigs for v6.17-rc1)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/geert/linux-m68k.git m68k-current/for-linus
+Merge made by the 'ort' strategy.
+ arch/m68k/configs/amiga_defconfig    |  9 +++------
+ arch/m68k/configs/apollo_defconfig   |  9 +++------
+ arch/m68k/configs/atari_defconfig    |  9 +++------
+ arch/m68k/configs/bvme6000_defconfig |  9 +++------
+ arch/m68k/configs/hp300_defconfig    |  9 +++------
+ arch/m68k/configs/mac_defconfig      |  9 +++------
+ arch/m68k/configs/multi_defconfig    |  9 +++------
+ arch/m68k/configs/mvme147_defconfig  |  9 +++------
+ arch/m68k/configs/mvme16x_defconfig  |  9 +++------
+ arch/m68k/configs/q40_defconfig      |  9 +++------
+ arch/m68k/configs/sun3_defconfig     |  9 +++------
+ arch/m68k/configs/sun3x_defconfig    |  9 +++------
+ arch/m68k/include/asm/bitops.h       | 25 ++++++++++++++-----------
+ drivers/zorro/names.c                | 12 ++++++------
+ 14 files changed, 56 insertions(+), 89 deletions(-)
+Merging powerpc-fixes/fixes (8763d2257f523 powerpc/boot/install.sh: Fix shellcheck warnings)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/powerpc/linux.git powerpc-fixes/fixes
+Already up to date.
+Merging s390-fixes/fixes (ce971233242b5 s390/cpum_cf: Deny all sampling events by counter PMU)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/s390/linux.git s390-fixes/fixes
+Already up to date.
+Merging net/main (012ea489aedab Merge branch 'net-macb-various-fixes')
+$ git merge -m Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net.git net/main
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/net/cdns,macb.yaml         |   2 +-
+ drivers/net/ethernet/cadence/macb.h                |   4 -
+ drivers/net/ethernet/cadence/macb_main.c           | 138 ++++++++++-----------
+ drivers/net/ethernet/freescale/enetc/enetc4_pf.c   |   2 +-
+ drivers/net/usb/rtl8150.c                          |   2 -
+ drivers/ptp/ptp_private.h                          |   1 +
+ drivers/ptp/ptp_sysfs.c                            |   2 +-
+ drivers/vhost/vringh.c                             |   7 +-
+ 8 files changed, 76 insertions(+), 82 deletions(-)
+Merging bpf/master (bf40f4b87761e Merge tag 'probes-fixes-v6.17-rc7' of git://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf.git/ bpf/master
+Already up to date.
+Merging ipsec/master (91d8a53db2199 xfrm: fix offloading of cross-family tunnels)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/klassert/ipsec.git ipsec/master
+Already up to date.
+Merging netfilter/main (4ff71af020ae5 Merge tag 'net-6.17-rc8' of git://git.kernel.org/pub/scm/linux/kernel/git/netdev/net)
+$ git merge -m Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/netfilter/nf.git netfilter/main
+Already up to date.
+Merging ipvs/main (4ff71af020ae5 Merge tag 'net-6.17-rc8' of git://git.kernel.org/pub/scm/linux/kernel/git/netdev/net)
+$ git merge -m Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/horms/ipvs.git ipvs/main
+Already up to date.
+Merging wireless/for-next (cbf658dd09419 Merge tag 'net-6.17-rc7' of git://git.kernel.org/pub/scm/linux/kernel/git/netdev/net)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/wireless/wireless.git wireless/for-next
+Already up to date.
+Merging ath/for-current (cbf658dd09419 Merge tag 'net-6.17-rc7' of git://git.kernel.org/pub/scm/linux/kernel/git/netdev/net)
+$ git merge -m Merge branch 'for-current' of https://git.kernel.org/pub/scm/linux/kernel/git/ath/ath.git ath/for-current
+Already up to date.
+Merging iwlwifi/fixes (a38108a23ab55 wifi: iwlwifi: pcie: fix byte count table for some devices)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/iwlwifi/iwlwifi-next.git iwlwifi/fixes
+Already up to date.
+Merging wpan/master (8ce4f287524c7 net: libwx: fix firmware mailbox abnormal return)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/wpan/wpan.git wpan/master
+Already up to date.
+Merging rdma-fixes/for-rc (85fe9f565d2d5 IB/mlx5: Fix obj_type mismatch for SRQ event subscriptions)
+$ git merge -m Merge branch 'for-rc' of https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git rdma-fixes/for-rc
+Already up to date.
+Merging sound-current/for-linus (f65dc3b1ab145 ALSA: usb-audio: don't hardcode gain for output channel of Presonus Studio)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/tiwai/sound.git sound-current/for-linus
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/mfd/twl4030-audio.txt      |   46 -
+ .../regulator/qcom,sdm845-refgen-regulator.yaml    |    3 +
+ .../devicetree/bindings/sound/alc5623.txt          |   25 -
+ .../bindings/sound/asahi-kasei,ak4458.yaml         |    4 +
+ .../devicetree/bindings/sound/brcm,bcm2835-i2s.txt |   24 -
+ .../bindings/sound/brcm,bcm2835-i2s.yaml           |   51 +
+ .../devicetree/bindings/sound/cirrus,cs35l41.yaml  |    6 +
+ .../devicetree/bindings/sound/everest,es8316.yaml  |   16 +
+ .../bindings/sound/foursemi,fs2105s.yaml           |  101 ++
+ .../devicetree/bindings/sound/fsl,easrc.yaml       |    2 +-
+ .../devicetree/bindings/sound/fsl,imx-asrc.yaml    |    2 +-
+ .../bindings/sound/imx-audio-sgtl5000.txt          |   56 -
+ .../devicetree/bindings/sound/linux,spdif.yaml     |    3 +
+ .../bindings/sound/mediatek,mt8183-audio.yaml      |  228 +++
+ .../bindings/sound/mediatek,mt8183_da7219.yaml     |   49 +
+ .../sound/mediatek,mt8183_mt6358_ts3a227.yaml      |   59 +
+ .../devicetree/bindings/sound/mt8183-afe-pcm.txt   |   42 -
+ .../bindings/sound/mt8183-da7219-max98357.txt      |   21 -
+ .../sound/mt8183-mt6358-ts3a227-max98357.txt       |   25 -
+ .../devicetree/bindings/sound/nuvoton,nau8825.yaml |   14 +
+ .../devicetree/bindings/sound/omap-twl4030.txt     |   62 -
+ .../bindings/sound/qcom,lpass-va-macro.yaml        |   24 +-
+ .../bindings/sound/qcom,lpass-wsa-macro.yaml       |    1 +
+ .../bindings/sound/qcom,pm4125-codec.yaml          |  134 ++
+ .../devicetree/bindings/sound/qcom,pm4125-sdw.yaml |   79 +
+ .../devicetree/bindings/sound/qcom,sm8250.yaml     |    1 +
+ .../devicetree/bindings/sound/qcom,wsa883x.yaml    |   11 +-
+ .../devicetree/bindings/sound/realtek,alc5623.yaml |   54 +
+ .../devicetree/bindings/sound/ti,omap-twl4030.yaml |   98 ++
+ .../devicetree/bindings/sound/ti,pcm1754.yaml      |   55 +
+ .../devicetree/bindings/sound/ti,tas2781.yaml      |   96 +-
+ .../bindings/sound/ti,twl4030-audio.yaml           |   90 +
+ .../devicetree/bindings/sound/wlf,wm8960.yaml      |   22 +
+ .../devicetree/bindings/vendor-prefixes.yaml       |    2 +
+ Documentation/sound/alsa-configuration.rst         |  105 +-
+ Documentation/sound/soc/codec.rst                  |    4 +-
+ Documentation/sound/soc/platform.rst               |    4 +-
+ MAINTAINERS                                        |   10 +
+ drivers/soc/fsl/qe/qmc.c                           |   44 +-
+ drivers/soundwire/bus.c                            |   12 +
+ drivers/soundwire/slave.c                          |    6 +
+ include/linux/soundwire/sdw.h                      |   17 +
+ include/sound/compress_driver.h                    |    2 +-
+ include/sound/cs-amp-lib.h                         |    1 +
+ include/sound/cs35l56.h                            |    5 +-
+ include/sound/dmaengine_pcm.h                      |    5 +
+ include/sound/emu10k1.h                            |    3 +-
+ include/sound/gus.h                                |    1 -
+ include/sound/hda_codec.h                          |   34 +-
+ include/sound/hdaudio.h                            |    1 +
+ include/sound/soc-component.h                      |   83 +-
+ include/sound/soc-dai.h                            |    7 +-
+ include/sound/soc-dapm.h                           |   61 +-
+ include/sound/soc.h                                |    5 +
+ include/sound/soc_sdw_utils.h                      |    8 +
+ include/sound/sof/ipc4/header.h                    |    4 +
+ include/sound/soundfont.h                          |   18 +
+ include/sound/tas2781-dsp.h                        |   11 +
+ include/sound/tas2781.h                            |   14 +-
+ include/sound/tas2x20-tlv.h                        |  259 +++
+ include/sound/tas5825-tlv.h                        |   24 +
+ include/sound/tlv320dac33-plat.h                   |   21 -
+ include/uapi/sound/compress_offload.h              |   35 +-
+ include/uapi/sound/compress_params.h               |   41 +-
+ include/uapi/sound/intel/avs/tokens.h              |   15 +
+ include/uapi/sound/snd_ar_tokens.h                 |   20 +-
+ include/uapi/sound/sof/tokens.h                    |    2 +
+ sound/ac97/bus.c                                   |   22 +-
+ sound/aoa/codecs/onyx.c                            |  106 +-
+ sound/aoa/codecs/tas.c                             |  115 +-
+ sound/aoa/codecs/toonie.c                          |    2 +-
+ sound/aoa/core/alsa.c                              |    8 +-
+ sound/aoa/core/gpio-feature.c                      |   20 +-
+ sound/aoa/core/gpio-pmf.c                          |   26 +-
+ sound/aoa/fabrics/layout.c                         |    9 +-
+ sound/aoa/soundbus/i2sbus/core.c                   |    4 +-
+ sound/aoa/soundbus/i2sbus/pcm.c                    |  206 +--
+ sound/arm/aaci.c                                   |  168 +-
+ sound/arm/pxa2xx-ac97-lib.c                        |   12 +-
+ sound/atmel/ac97c.c                                |   18 +-
+ sound/core/compress_offload.c                      |   98 +-
+ sound/core/misc.c                                  |   25 +-
+ sound/core/oss/pcm_oss.c                           |    3 +-
+ sound/core/pcm_dmaengine.c                         |    2 +
+ sound/core/pcm_native.c                            |   21 +-
+ sound/core/seq/oss/seq_oss.c                       |   24 +-
+ sound/core/seq/oss/seq_oss_device.h                |    7 +-
+ sound/core/seq/oss/seq_oss_midi.c                  |  116 +-
+ sound/core/seq/oss/seq_oss_readq.c                 |   10 +-
+ sound/core/seq/oss/seq_oss_synth.c                 |  125 +-
+ sound/core/seq/oss/seq_oss_writeq.c                |    5 +-
+ sound/core/seq/seq_clientmgr.c                     |  759 ++++-----
+ sound/core/seq/seq_clientmgr.h                     |   17 +-
+ sound/core/seq/seq_fifo.c                          |   16 +-
+ sound/core/seq/seq_fifo.h                          |    1 +
+ sound/core/seq/seq_ports.c                         |   19 +-
+ sound/core/seq/seq_ports.h                         |    2 +
+ sound/core/seq/seq_queue.c                         |   76 +-
+ sound/core/seq/seq_queue.h                         |    2 +
+ sound/core/seq/seq_timer.c                         |    5 +-
+ sound/drivers/aloop.c                              |  276 ++-
+ sound/drivers/dummy.c                              |   40 +-
+ sound/drivers/mpu401/mpu401_uart.c                 |   41 +-
+ sound/drivers/mtpav.c                              |   59 +-
+ sound/drivers/mts64.c                              |   57 +-
+ sound/drivers/opl3/opl3_lib.c                      |   26 +-
+ sound/drivers/opl3/opl3_midi.c                     |   51 +-
+ sound/drivers/opl3/opl3_seq.c                      |   27 +-
+ sound/drivers/opl4/opl4_lib.c                      |   10 +-
+ sound/drivers/opl4/opl4_mixer.c                    |    8 +-
+ sound/drivers/opl4/opl4_proc.c                     |   10 +-
+ sound/drivers/opl4/opl4_seq.c                      |   28 +-
+ sound/drivers/opl4/opl4_synth.c                    |   81 +-
+ sound/drivers/portman2x4.c                         |   12 +-
+ sound/drivers/serial-generic.c                     |   12 +-
+ sound/drivers/serial-u16550.c                      |   48 +-
+ sound/drivers/vx/vx_core.c                         |   19 +-
+ sound/drivers/vx/vx_mixer.c                        |   57 +-
+ sound/drivers/vx/vx_pcm.c                          |    3 +-
+ sound/drivers/vx/vx_uer.c                          |   17 +-
+ sound/firewire/amdtp-stream.c                      |   28 +-
+ sound/firewire/bebob/bebob.c                       |   36 +-
+ sound/firewire/bebob/bebob_hwdep.c                 |   37 +-
+ sound/firewire/bebob/bebob_maudio.c                |   42 +-
+ sound/firewire/bebob/bebob_midi.c                  |   34 +-
+ sound/firewire/bebob/bebob_pcm.c                   |   68 +-
+ sound/firewire/bebob/bebob_stream.c                |   21 +-
+ sound/firewire/cmp.c                               |   37 +-
+ sound/firewire/dice/dice-hwdep.c                   |   37 +-
+ sound/firewire/dice/dice-midi.c                    |   38 +-
+ sound/firewire/dice/dice-pcm.c                     |   91 +-
+ sound/firewire/dice/dice-stream.c                  |   21 +-
+ sound/firewire/dice/dice-transaction.c             |    7 +-
+ sound/firewire/dice/dice.c                         |    3 +-
+ sound/firewire/digi00x/digi00x-hwdep.c             |   37 +-
+ sound/firewire/digi00x/digi00x-midi.c              |   34 +-
+ sound/firewire/digi00x/digi00x-pcm.c               |   73 +-
+ sound/firewire/digi00x/digi00x-stream.c            |   21 +-
+ sound/firewire/digi00x/digi00x-transaction.c       |    8 +-
+ sound/firewire/digi00x/digi00x.c                   |    3 +-
+ sound/firewire/fcp.c                               |   19 +-
+ sound/firewire/fireface/ff-hwdep.c                 |   37 +-
+ sound/firewire/fireface/ff-midi.c                  |   10 +-
+ sound/firewire/fireface/ff-pcm.c                   |   92 +-
+ sound/firewire/fireface/ff-stream.c                |   21 +-
+ sound/firewire/fireface/ff-transaction.c           |    4 +-
+ sound/firewire/fireworks/fireworks.c               |   39 +-
+ sound/firewire/fireworks/fireworks_command.c       |   16 +-
+ sound/firewire/fireworks/fireworks_hwdep.c         |   41 +-
+ sound/firewire/fireworks/fireworks_midi.c          |   37 +-
+ sound/firewire/fireworks/fireworks_pcm.c           |   65 +-
+ sound/firewire/fireworks/fireworks_stream.c        |   21 +-
+ sound/firewire/fireworks/fireworks_transaction.c   |   39 +-
+ sound/firewire/isight.c                            |   20 +-
+ sound/firewire/iso-resources.c                     |   66 +-
+ .../motu/motu-command-dsp-message-parser.c         |    9 +-
+ sound/firewire/motu/motu-hwdep.c                   |   37 +-
+ sound/firewire/motu/motu-midi.c                    |   38 +-
+ sound/firewire/motu/motu-pcm.c                     |   94 +-
+ .../motu/motu-register-dsp-message-parser.c        |   18 +-
+ sound/firewire/motu/motu-stream.c                  |   21 +-
+ sound/firewire/motu/motu-transaction.c             |    7 +-
+ sound/firewire/oxfw/oxfw-hwdep.c                   |   37 +-
+ sound/firewire/oxfw/oxfw-midi.c                    |   62 +-
+ sound/firewire/oxfw/oxfw-pcm.c                     |   90 +-
+ sound/firewire/oxfw/oxfw-stream.c                  |   21 +-
+ sound/firewire/oxfw/oxfw.c                         |    3 +-
+ sound/firewire/tascam/amdtp-tascam.c               |   15 +-
+ sound/firewire/tascam/tascam-hwdep.c               |   37 +-
+ sound/firewire/tascam/tascam-midi.c                |   10 +-
+ sound/firewire/tascam/tascam-pcm.c                 |   69 +-
+ sound/firewire/tascam/tascam-stream.c              |   21 +-
+ sound/firewire/tascam/tascam.c                     |    3 +-
+ sound/hda/codecs/analog.c                          |    3 +-
+ sound/hda/codecs/ca0132.c                          |  295 ++--
+ sound/hda/codecs/cirrus/cs8409.c                   |   22 +-
+ sound/hda/codecs/conexant.c                        |    4 +-
+ sound/hda/codecs/generic.c                         |   76 +-
+ sound/hda/codecs/hdmi/hdmi.c                       |  199 +--
+ sound/hda/codecs/hdmi/nvhdmi-mcp.c                 |    3 +-
+ sound/hda/codecs/realtek/alc268.c                  |    3 +-
+ sound/hda/codecs/realtek/alc269.c                  |    7 +-
+ sound/hda/codecs/realtek/realtek.c                 |   40 +-
+ sound/hda/codecs/realtek/realtek.h                 |   21 +
+ sound/hda/codecs/side-codecs/cs35l41_hda.c         |  110 +-
+ sound/hda/codecs/side-codecs/cs35l56_hda.c         |    1 +
+ sound/hda/codecs/side-codecs/cs35l56_hda_i2c.c     |    2 -
+ sound/hda/codecs/side-codecs/cs35l56_hda_spi.c     |    2 -
+ sound/hda/codecs/side-codecs/hda_component.c       |   15 +-
+ sound/hda/codecs/side-codecs/hda_component.h       |    3 +-
+ sound/hda/codecs/side-codecs/tas2781_hda_i2c.c     |   83 +-
+ sound/hda/common/codec.c                           |  142 +-
+ sound/hda/common/controller.c                      |  124 +-
+ sound/hda/common/proc.c                            |   13 +-
+ sound/hda/common/sysfs.c                           |  110 +-
+ sound/hda/controllers/intel.c                      |   14 +-
+ sound/hda/core/bus.c                               |    8 +-
+ sound/hda/core/component.c                         |    6 +-
+ sound/hda/core/controller.c                        |   58 +-
+ sound/hda/core/device.c                            |   23 +-
+ sound/hda/core/ext/controller.c                    |    6 +-
+ sound/hda/core/ext/stream.c                        |   38 +-
+ sound/hda/core/regmap.c                            |   35 +-
+ sound/hda/core/stream.c                            |   34 +-
+ sound/i2c/other/ak4113.c                           |   54 +-
+ sound/i2c/other/ak4114.c                           |   39 +-
+ sound/i2c/other/ak4117.c                           |   40 +-
+ sound/isa/ad1816a/ad1816a_lib.c                    |  117 +-
+ sound/isa/cmi8330.c                                |   15 +-
+ sound/isa/cs423x/cs4236_lib.c                      |  133 +-
+ sound/isa/es1688/es1688_lib.c                      |  276 ++-
+ sound/isa/es18xx.c                                 |   58 +-
+ sound/isa/gus/gus_dma.c                            |   88 +-
+ sound/isa/gus/gus_dram.c                           |    8 +-
+ sound/isa/gus/gus_io.c                             |   65 +-
+ sound/isa/gus/gus_main.c                           |   65 +-
+ sound/isa/gus/gus_mem.c                            |   33 +-
+ sound/isa/gus/gus_mixer.c                          |   12 +-
+ sound/isa/gus/gus_pcm.c                            |  177 +-
+ sound/isa/gus/gus_reset.c                          |   66 +-
+ sound/isa/gus/gus_timer.c                          |   16 +-
+ sound/isa/gus/gus_uart.c                           |   24 +-
+ sound/isa/gus/gusextreme.c                         |   21 +-
+ sound/isa/gus/interwave.c                          |   33 +-
+ sound/isa/msnd/msnd.c                              |   29 +-
+ sound/isa/msnd/msnd_pinnacle.c                     |   11 +-
+ sound/isa/msnd/msnd_pinnacle_mixer.c               |    8 +-
+ sound/isa/opl3sa2.c                                |   29 +-
+ sound/isa/opti9xx/miro.c                           |   17 +-
+ sound/isa/opti9xx/opti92x-ad1848.c                 |   21 +-
+ sound/isa/sb/emu8000.c                             |   94 +-
+ sound/isa/sb/emu8000_pcm.c                         |   46 +-
+ sound/isa/sb/sb16.c                                |   11 +-
+ sound/isa/sb/sb16_csp.c                            |  225 ++-
+ sound/isa/sb/sb16_main.c                           |  123 +-
+ sound/isa/sb/sb8_main.c                            |  168 +-
+ sound/isa/sb/sb8_midi.c                            |  121 +-
+ sound/isa/sb/sb_common.c                           |   17 +-
+ sound/isa/sb/sb_mixer.c                            |   61 +-
+ sound/isa/sscape.c                                 |  184 +-
+ sound/isa/wavefront/wavefront_midi.c               |  129 +-
+ sound/isa/wavefront/wavefront_synth.c              |   18 +-
+ sound/isa/wss/wss_lib.c                            |  285 ++--
+ sound/mips/sgio2audio.c                            |   20 +-
+ sound/mips/snd-n64.c                               |   17 +-
+ sound/parisc/harmony.c                             |   99 +-
+ sound/pci/ac97/ac97_codec.c                        |   32 +-
+ sound/pci/ac97/ac97_patch.c                        |    9 +-
+ sound/pci/ac97/ac97_pcm.c                          |   50 +-
+ sound/pci/ac97/ac97_proc.c                         |   10 +-
+ sound/pci/ad1889.c                                 |   12 +-
+ sound/pci/ak4531_codec.c                           |   18 +-
+ sound/pci/ali5451/ali5451.c                        |   92 +-
+ sound/pci/als300.c                                 |   21 +-
+ sound/pci/als4000.c                                |   68 +-
+ sound/pci/asihpi/asihpi.c                          |   16 +-
+ sound/pci/atiixp.c                                 |   69 +-
+ sound/pci/atiixp_modem.c                           |   49 +-
+ sound/pci/aw2/aw2-alsa.c                           |   26 +-
+ sound/pci/azt3328.c                                |  143 +-
+ sound/pci/bt87x.c                                  |   26 +-
+ sound/pci/ca0106/ca0106_main.c                     |   33 +-
+ sound/pci/ca0106/ca0106_proc.c                     |   28 +-
+ sound/pci/ca0106/ca_midi.c                         |  169 +-
+ sound/pci/cmipci.c                                 |  185 +-
+ sound/pci/cs4281.c                                 |   54 +-
+ sound/pci/cs46xx/cs46xx_lib.c                      |  200 +--
+ sound/pci/cs46xx/dsp_spos.c                        |   70 +-
+ sound/pci/cs46xx/dsp_spos_scb_lib.c                |   63 +-
+ sound/pci/cs5535audio/cs5535audio.c                |   14 +-
+ sound/pci/cs5535audio/cs5535audio_pcm.c            |   12 +-
+ sound/pci/ctxfi/ctamixer.c                         |   67 +-
+ sound/pci/ctxfi/ctatc.c                            |   28 +-
+ sound/pci/ctxfi/ctdaio.c                           |   42 +-
+ sound/pci/ctxfi/cthw20k1.c                         |   39 +-
+ sound/pci/ctxfi/ctsrc.c                            |  101 +-
+ sound/pci/ctxfi/cttimer.c                          |   63 +-
+ sound/pci/ctxfi/ctvmem.c                           |   16 +-
+ sound/pci/echoaudio/echoaudio.c                    |  128 +-
+ sound/pci/echoaudio/echoaudio_3g.c                 |    6 +-
+ sound/pci/echoaudio/gina24_dsp.c                   |    3 +-
+ sound/pci/echoaudio/layla24_dsp.c                  |    6 +-
+ sound/pci/echoaudio/midi.c                         |   41 +-
+ sound/pci/echoaudio/mona_dsp.c                     |    3 +-
+ sound/pci/emu10k1/emu10k1_main.c                   |   27 +-
+ sound/pci/emu10k1/emu10k1_synth.c                  |   11 +-
+ sound/pci/emu10k1/emu10k1x.c                       |  221 +--
+ sound/pci/emu10k1/emufx.c                          |   81 +-
+ sound/pci/emu10k1/emumixer.c                       |   71 +-
+ sound/pci/emu10k1/emumpu401.c                      |  173 +-
+ sound/pci/emu10k1/emupcm.c                         |   58 +-
+ sound/pci/emu10k1/emuproc.c                        |   19 +-
+ sound/pci/emu10k1/io.c                             |  123 +-
+ sound/pci/emu10k1/memory.c                         |   34 +-
+ sound/pci/emu10k1/p16v.c                           |    8 +-
+ sound/pci/emu10k1/voice.c                          |    8 +-
+ sound/pci/ens1370.c                                |  316 ++--
+ sound/pci/es1938.c                                 |   28 +-
+ sound/pci/es1968.c                                 |  160 +-
+ sound/pci/fm801.c                                  |   71 +-
+ sound/pci/ice1712/aureon.c                         |   27 +-
+ sound/pci/ice1712/delta.c                          |   83 +-
+ sound/pci/ice1712/ews.c                            |   53 +-
+ sound/pci/ice1712/hoontech.c                       |   24 +-
+ sound/pci/ice1712/ice1712.c                        |  186 +-
+ sound/pci/ice1712/ice1724.c                        |  314 ++--
+ sound/pci/ice1712/maya44.c                         |   18 +-
+ sound/pci/ice1712/phase.c                          |    6 +-
+ sound/pci/ice1712/pontis.c                         |   70 +-
+ sound/pci/ice1712/prodigy192.c                     |   11 +-
+ sound/pci/ice1712/prodigy_hifi.c                   |   56 +-
+ sound/pci/ice1712/quartet.c                        |    3 +-
+ sound/pci/ice1712/wtm.c                            |    6 +-
+ sound/pci/intel8x0.c                               |  178 +-
+ sound/pci/intel8x0m.c                              |    8 +-
+ sound/pci/korg1212/korg1212.c                      |  182 +-
+ sound/pci/lola/lola.c                              |    4 +-
+ sound/pci/lola/lola_pcm.c                          |   36 +-
+ sound/pci/lx6464es/lx6464es.c                      |   49 +-
+ sound/pci/lx6464es/lx_core.c                       |  111 +-
+ sound/pci/maestro3.c                               |   23 +-
+ sound/pci/mixart/mixart.c                          |   48 +-
+ sound/pci/mixart/mixart_core.c                     |   71 +-
+ sound/pci/mixart/mixart_mixer.c                    |   46 +-
+ sound/pci/nm256/nm256.c                            |   37 +-
+ sound/pci/oxygen/oxygen.c                          |   12 +-
+ sound/pci/oxygen/oxygen_lib.c                      |  132 +-
+ sound/pci/oxygen/oxygen_mixer.c                    |   66 +-
+ sound/pci/oxygen/oxygen_pcm.c                      |  165 +-
+ sound/pci/oxygen/xonar_cs43xx.c                    |    6 +-
+ sound/pci/oxygen/xonar_dg_mixer.c                  |   33 +-
+ sound/pci/oxygen/xonar_lib.c                       |    3 +-
+ sound/pci/oxygen/xonar_pcm179x.c                   |   21 +-
+ sound/pci/oxygen/xonar_wm87x6.c                    |   31 +-
+ sound/pci/pcxhr/pcxhr.c                            |   35 +-
+ sound/pci/pcxhr/pcxhr_core.c                       |   15 +-
+ sound/pci/pcxhr/pcxhr_mix22.c                      |   23 +-
+ sound/pci/pcxhr/pcxhr_mixer.c                      |   58 +-
+ sound/pci/rme32.c                                  |  152 +-
+ sound/pci/rme96.c                                  |  211 +--
+ sound/pci/rme9652/hdsp.c                           |  309 ++--
+ sound/pci/rme9652/hdspm.c                          |  303 ++--
+ sound/pci/rme9652/rme9652.c                        |  203 +--
+ sound/pci/sis7019.c                                |   43 +-
+ sound/pci/sonicvibes.c                             |  113 +-
+ sound/pci/trident/trident_main.c                   |  324 ++--
+ sound/pci/trident/trident_memory.c                 |   19 +-
+ sound/pci/via82xx.c                                |   80 +-
+ sound/pci/via82xx_modem.c                          |    6 +-
+ sound/pci/vx222/vx222_ops.c                        |   12 +-
+ sound/pci/ymfpci/ymfpci_main.c                     |  248 ++-
+ sound/pcmcia/pdaudiocf/pdaudiocf_core.c            |    3 +-
+ sound/pcmcia/pdaudiocf/pdaudiocf_pcm.c             |   25 +-
+ sound/pcmcia/vx/vxp_mixer.c                        |    9 +-
+ sound/pcmcia/vx/vxp_ops.c                          |    6 +-
+ sound/ppc/awacs.c                                  |   24 +-
+ sound/ppc/beep.c                                   |   17 +-
+ sound/ppc/burgundy.c                               |   10 +-
+ sound/ppc/pmac.c                                   |   88 +-
+ sound/ppc/snd_ps3.c                                |   21 +-
+ sound/soc/amd/acp/acp-rembrandt.c                  |    2 +-
+ sound/soc/amd/acp/amd-sdw-acpi.c                   |    2 +-
+ sound/soc/amd/raven/acp3x-i2s.c                    |    3 +-
+ sound/soc/amd/vangogh/acp5x-i2s.c                  |    3 +-
+ sound/soc/codecs/Kconfig                           |   67 +-
+ sound/soc/codecs/Makefile                          |   20 +-
+ sound/soc/codecs/adau1977.c                        |    2 +-
+ sound/soc/codecs/cs-amp-lib-test.c                 |  252 ++-
+ sound/soc/codecs/cs-amp-lib.c                      |  139 +-
+ sound/soc/codecs/cs35l41.c                         |   75 +-
+ sound/soc/codecs/cs35l56-i2c.c                     |    4 +-
+ sound/soc/codecs/cs35l56-sdw.c                     |    4 +-
+ sound/soc/codecs/cs35l56-shared.c                  |  109 +-
+ sound/soc/codecs/cs35l56-spi.c                     |    2 +-
+ sound/soc/codecs/cs42l43-jack.c                    |    8 +-
+ sound/soc/codecs/cs42l43.c                         |  109 +-
+ sound/soc/codecs/cs42l43.h                         |    3 +
+ sound/soc/codecs/cs48l32-tables.c                  |    4 +-
+ sound/soc/codecs/da7213.c                          |    6 +-
+ sound/soc/codecs/es8323.c                          |   17 +-
+ sound/soc/codecs/fs-amp-lib.c                      |  265 +++
+ sound/soc/codecs/fs-amp-lib.h                      |  150 ++
+ sound/soc/codecs/fs210x.c                          | 1586 +++++++++++++++++
+ sound/soc/codecs/fs210x.h                          |   75 +
+ sound/soc/codecs/lpass-macro-common.h              |    1 +
+ sound/soc/codecs/lpass-va-macro.c                  |    2 +
+ sound/soc/codecs/lpass-wsa-macro.c                 |    2 +
+ sound/soc/codecs/pcm1754.c                         |  185 ++
+ sound/soc/codecs/pcm6240.c                         |    4 +-
+ sound/soc/codecs/pm4125-sdw.c                      |  545 ++++++
+ sound/soc/codecs/pm4125.c                          | 1780 ++++++++++++++++++++
+ sound/soc/codecs/pm4125.h                          |  307 ++++
+ sound/soc/codecs/rt1320-sdw.c                      |  380 ++++-
+ sound/soc/codecs/rt1320-sdw.h                      |   10 +
+ sound/soc/codecs/rt721-sdca-sdw.c                  |   10 +-
+ sound/soc/codecs/tas2781-comlib-i2c.c              |    2 +
+ sound/soc/codecs/tas2781-fmwlib.c                  |   79 +-
+ sound/soc/codecs/tas2781-i2c.c                     |  190 ++-
+ sound/soc/codecs/tas2783-sdw.c                     | 1331 +++++++++++++++
+ sound/soc/codecs/tas2783.h                         |  110 ++
+ sound/soc/codecs/tlv320aic32x4.c                   |   18 +-
+ sound/soc/codecs/tlv320aic3x.c                     |   32 +-
+ sound/soc/codecs/tlv320dac33.c                     |   69 +-
+ sound/soc/codecs/wcd-common.c                      |  144 ++
+ sound/soc/codecs/wcd-common.h                      |   46 +
+ sound/soc/codecs/wcd934x.c                         |   99 +-
+ sound/soc/codecs/wcd937x-sdw.c                     |   67 +-
+ sound/soc/codecs/wcd937x.c                         |   93 +-
+ sound/soc/codecs/wcd937x.h                         |   24 +-
+ sound/soc/codecs/wcd938x-sdw.c                     |   83 +-
+ sound/soc/codecs/wcd938x.c                         |   99 +-
+ sound/soc/codecs/wcd938x.h                         |   26 +-
+ sound/soc/codecs/wcd939x-sdw.c                     |   98 +-
+ sound/soc/codecs/wcd939x.c                         |  104 +-
+ sound/soc/codecs/wcd939x.h                         |   32 +-
+ sound/soc/codecs/wl1273.c                          |  500 ------
+ sound/soc/codecs/wl1273.h                          |   16 -
+ sound/soc/codecs/wm8993.c                          |    2 +-
+ sound/soc/codecs/wm8994.c                          |    6 +-
+ sound/soc/codecs/wm8994.h                          |   12 +-
+ sound/soc/codecs/wm8996.c                          |    2 +-
+ sound/soc/codecs/wm_adsp.c                         |    6 +-
+ sound/soc/codecs/wm_adsp.h                         |    2 +-
+ sound/soc/codecs/wsa883x.c                         |   57 +-
+ sound/soc/fsl/fsl_qmc_audio.c                      |  125 +-
+ sound/soc/fsl/fsl_sai.c                            |    3 +-
+ sound/soc/fsl/imx-audmux.c                         |    2 +-
+ sound/soc/fsl/imx-hdmi.c                           |   13 +-
+ sound/soc/generic/test-component.c                 |    4 +-
+ sound/soc/intel/atom/sst-mfld-platform-compress.c  |   12 +-
+ sound/soc/intel/atom/sst-mfld-platform.h           |    2 +-
+ sound/soc/intel/atom/sst/sst.c                     |    2 +-
+ sound/soc/intel/atom/sst/sst_drv_interface.c       |    9 +-
+ sound/soc/intel/avs/apl.c                          |    1 +
+ sound/soc/intel/avs/avs.h                          |   90 +-
+ sound/soc/intel/avs/board_selection.c              |  321 ++--
+ sound/soc/intel/avs/boards/da7219.c                |   15 +-
+ sound/soc/intel/avs/boards/dmic.c                  |   80 +-
+ sound/soc/intel/avs/boards/es8336.c                |   18 +-
+ sound/soc/intel/avs/boards/hdaudio.c               |   13 +-
+ sound/soc/intel/avs/boards/i2s_test.c              |   15 +-
+ sound/soc/intel/avs/boards/max98357a.c             |   15 +-
+ sound/soc/intel/avs/boards/max98373.c              |   15 +-
+ sound/soc/intel/avs/boards/max98927.c              |   15 +-
+ sound/soc/intel/avs/boards/nau8825.c               |   15 +-
+ sound/soc/intel/avs/boards/probe.c                 |   49 +-
+ sound/soc/intel/avs/boards/rt274.c                 |   17 +-
+ sound/soc/intel/avs/boards/rt286.c                 |   15 +-
+ sound/soc/intel/avs/boards/rt298.c                 |   15 +-
+ sound/soc/intel/avs/boards/rt5514.c                |   15 +-
+ sound/soc/intel/avs/boards/rt5640.c                |    2 +-
+ sound/soc/intel/avs/boards/rt5663.c                |   15 +-
+ sound/soc/intel/avs/boards/rt5682.c                |   15 +-
+ sound/soc/intel/avs/boards/ssm4567.c               |   15 +-
+ sound/soc/intel/avs/cnl.c                          |    1 +
+ sound/soc/intel/avs/core.c                         |    1 +
+ sound/soc/intel/avs/debug.h                        |   91 +
+ sound/soc/intel/avs/debugfs.c                      |    1 +
+ sound/soc/intel/avs/icl.c                          |    1 +
+ sound/soc/intel/avs/ipc.c                          |    1 +
+ sound/soc/intel/avs/lnl.c                          |    1 +
+ sound/soc/intel/avs/mtl.c                          |    1 +
+ sound/soc/intel/avs/path.c                         |  267 +++
+ sound/soc/intel/avs/path.h                         |   13 +
+ sound/soc/intel/avs/pcm.c                          |   35 +-
+ sound/soc/intel/avs/probes.c                       |   25 +-
+ sound/soc/intel/avs/ptl.c                          |    1 +
+ sound/soc/intel/avs/skl.c                          |    1 +
+ sound/soc/intel/avs/tgl.c                          |    1 +
+ sound/soc/intel/avs/topology.c                     |  110 ++
+ sound/soc/intel/avs/topology.h                     |    8 +
+ sound/soc/intel/boards/bytcht_cx2072x.c            |    2 +-
+ sound/soc/intel/boards/bytcht_es8316.c             |   22 +-
+ sound/soc/intel/boards/bytcr_rt5640.c              |    9 +-
+ sound/soc/intel/boards/bytcr_rt5651.c              |   28 +-
+ sound/soc/intel/boards/bytcr_wm5102.c              |    2 +-
+ sound/soc/intel/boards/sof_es8336.c                |    2 +-
+ sound/soc/intel/boards/sof_sdw.c                   |    2 +-
+ sound/soc/intel/common/soc-acpi-intel-mtl-match.c  |   30 +
+ sound/soc/mediatek/common/mtk-soundcard-driver.c   |   19 +-
+ sound/soc/mediatek/mt8173/mt8173-rt5650.c          |    2 +-
+ sound/soc/mediatek/mt8183/mt8183-da7219-max98357.c |    2 +-
+ .../mt8183/mt8183-mt6358-ts3a227-max98357.c        |    2 +-
+ sound/soc/mediatek/mt8186/mt8186-mt6366.c          |    2 +-
+ sound/soc/mediatek/mt8188/mt8188-mt6359.c          |    8 +-
+ .../mediatek/mt8192/mt8192-mt6359-rt1015-rt5682.c  |    2 +-
+ sound/soc/mediatek/mt8195/mt8195-mt6359.c          |    4 +-
+ sound/soc/pxa/Kconfig                              |    4 +-
+ sound/soc/qcom/lpass-cdc-dma.c                     |    3 +-
+ sound/soc/qcom/lpass-hdmi.c                        |    2 +-
+ sound/soc/qcom/qdsp6/audioreach.c                  |   54 +
+ sound/soc/qcom/qdsp6/audioreach.h                  |   35 +-
+ sound/soc/qcom/qdsp6/q6apm-dai.c                   |   29 +-
+ sound/soc/qcom/qdsp6/q6apm.c                       |    3 +
+ sound/soc/qcom/qdsp6/q6asm-dai.c                   |   26 +-
+ sound/soc/qcom/qdsp6/topology.c                    |   45 +-
+ sound/soc/qcom/sc8280xp.c                          |    7 +-
+ sound/soc/qcom/x1e80100.c                          |    5 +-
+ sound/soc/renesas/fsi.c                            |   30 +-
+ sound/soc/renesas/rcar/core.c                      |   18 +-
+ sound/soc/renesas/rcar/msiof.c                     |  221 ++-
+ sound/soc/renesas/rcar/src.c                       |   19 +-
+ sound/soc/renesas/rcar/ssi.c                       |   37 +-
+ sound/soc/renesas/rz-ssi.c                         |   14 +-
+ sound/soc/sdw_utils/Makefile                       |    3 +-
+ sound/soc/sdw_utils/soc_sdw_ti_amp.c               |   92 +
+ sound/soc/sdw_utils/soc_sdw_utils.c                |   38 +-
+ sound/soc/soc-component.c                          |    2 +-
+ sound/soc/soc-compress.c                           |    2 +-
+ sound/soc/soc-core.c                               |    4 +-
+ sound/soc/soc-dai.c                                |    2 +-
+ sound/soc/soc-dapm.c                               |  121 +-
+ sound/soc/soc-ops.c                                |    1 +
+ sound/soc/sof/amd/acp-probes.c                     |    2 +-
+ sound/soc/sof/compress.c                           |    2 +-
+ sound/soc/sof/imx/imx-common.c                     |    6 +-
+ sound/soc/sof/imx/imx8.c                           |    3 +-
+ sound/soc/sof/intel/hda-codec.c                    |    3 -
+ sound/soc/sof/intel/hda-ctrl.c                     |    8 +-
+ sound/soc/sof/intel/hda-dsp.c                      |    2 +-
+ sound/soc/sof/intel/hda-probes.c                   |    2 +-
+ sound/soc/sof/intel/hda-sdw-bpt.c                  |    2 +-
+ sound/soc/sof/intel/hda.c                          |    2 +-
+ sound/soc/sof/intel/hda.h                          |    2 +-
+ sound/soc/sof/ipc3-dtrace.c                        |    2 +-
+ sound/soc/sof/ipc4-pcm.c                           |   60 +-
+ sound/soc/sof/ipc4-topology.c                      |  187 +-
+ sound/soc/sof/ipc4-topology.h                      |   16 +
+ sound/soc/sof/sof-audio.h                          |    3 +
+ sound/soc/sof/sof-client-probes-ipc3.c             |   25 +-
+ sound/soc/sof/sof-client-probes-ipc4.c             |  134 +-
+ sound/soc/sof/sof-client-probes.c                  |   62 +-
+ sound/soc/sof/sof-client-probes.h                  |   13 +-
+ sound/soc/sof/sof-client.c                         |  118 +-
+ sound/soc/sof/sof-client.h                         |    8 +-
+ sound/soc/sof/sof-priv.h                           |    9 +
+ sound/soc/sprd/sprd-pcm-compress.c                 |    6 +-
+ sound/soc/sprd/sprd-pcm-dma.h                      |    4 +-
+ sound/soc/stm/stm32_sai_sub.c                      |    8 +
+ sound/soc/uniphier/aio-compress.c                  |    2 +-
+ sound/sparc/amd7930.c                              |  110 +-
+ sound/sparc/cs4231.c                               |  225 +--
+ sound/sparc/dbri.c                                 |  228 ++-
+ sound/spi/at73c213.c                               |   85 +-
+ sound/synth/emux/emux_effect.c                     |   29 +-
+ sound/synth/emux/emux_proc.c                       |    6 +-
+ sound/synth/emux/emux_seq.c                        |   17 +-
+ sound/synth/emux/emux_synth.c                      |   54 +-
+ sound/synth/emux/soundfont.c                       |  115 +-
+ sound/synth/util_mem.c                             |   17 +-
+ sound/usb/6fire/chip.c                             |   40 +-
+ sound/usb/6fire/midi.c                             |   21 +-
+ sound/usb/6fire/pcm.c                              |   83 +-
+ sound/usb/Kconfig                                  |   12 +
+ sound/usb/bcd2000/bcd2000.c                        |   16 +-
+ sound/usb/caiaq/audio.c                            |   39 +-
+ sound/usb/card.c                                   |   94 +-
+ sound/usb/endpoint.c                               |  124 +-
+ sound/usb/fcp.c                                    |   17 +-
+ sound/usb/hiface/chip.c                            |   11 +-
+ sound/usb/hiface/pcm.c                             |   60 +-
+ sound/usb/line6/capture.c                          |    6 +-
+ sound/usb/line6/driver.c                           |   37 +-
+ sound/usb/line6/midi.c                             |   10 +-
+ sound/usb/line6/pcm.c                              |   85 +-
+ sound/usb/media.c                                  |    6 +-
+ sound/usb/midi.c                                   |   75 +-
+ sound/usb/midi2.c                                  |   16 +-
+ sound/usb/misc/ua101.c                             |  250 ++-
+ sound/usb/mixer.c                                  |   66 +-
+ sound/usb/mixer_quirks.c                           |  362 ++--
+ sound/usb/mixer_s1810c.c                           |  303 ++--
+ sound/usb/mixer_scarlett2.c                        | 1414 ++++++----------
+ sound/usb/mixer_us16x08.c                          |    3 +-
+ sound/usb/pcm.c                                    |  309 ++--
+ sound/usb/proc.c                                   |    3 +-
+ sound/usb/qcom/qc_audio_offload.c                  |   84 +-
+ sound/usb/quirks.c                                 |  200 ++-
+ sound/usb/quirks.h                                 |   11 +-
+ sound/usb/usbaudio.h                               |  110 +-
+ sound/usb/usx2y/Makefile                           |    2 +
+ sound/usb/usx2y/us122l.c                           |   50 +-
+ sound/usb/usx2y/us144mkii.c                        |  620 +++++++
+ sound/usb/usx2y/us144mkii.h                        |  367 ++++
+ sound/usb/usx2y/us144mkii_capture.c                |  319 ++++
+ sound/usb/usx2y/us144mkii_controls.c               |  444 +++++
+ sound/usb/usx2y/us144mkii_midi.c                   |  403 +++++
+ sound/usb/usx2y/us144mkii_pcm.c                    |  370 ++++
+ sound/usb/usx2y/us144mkii_pcm.h                    |  165 ++
+ sound/usb/usx2y/us144mkii_playback.c               |  456 +++++
+ sound/usb/usx2y/usbusx2yaudio.c                    |   23 +-
+ sound/usb/usx2y/usx2yhwdeppcm.c                    |   33 +-
+ sound/usb/validate.c                               |    9 +-
+ sound/virtio/virtio_card.c                         |    8 +-
+ sound/virtio/virtio_ctl_msg.c                      |   23 +-
+ sound/virtio/virtio_pcm.c                          |    8 +-
+ sound/virtio/virtio_pcm_msg.c                      |   17 +-
+ sound/virtio/virtio_pcm_ops.c                      |   56 +-
+ sound/x86/intel_hdmi_audio.c                       |  109 +-
+ sound/xen/xen_snd_front.c                          |   80 +-
+ sound/xen/xen_snd_front_evtchnl.c                  |   33 +-
+ tools/testing/selftests/alsa/mixer-test.c          |    8 +-
+ tools/testing/selftests/alsa/pcm-test.c            |    8 +-
+ 603 files changed, 24386 insertions(+), 16192 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/mfd/twl4030-audio.txt
+ delete mode 100644 Documentation/devicetree/bindings/sound/alc5623.txt
+ delete mode 100644 Documentation/devicetree/bindings/sound/brcm,bcm2835-i2s.txt
+ create mode 100644 Documentation/devicetree/bindings/sound/brcm,bcm2835-i2s.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/foursemi,fs2105s.yaml
+ delete mode 100644 Documentation/devicetree/bindings/sound/imx-audio-sgtl5000.txt
+ create mode 100644 Documentation/devicetree/bindings/sound/mediatek,mt8183-audio.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/mediatek,mt8183_da7219.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/mediatek,mt8183_mt6358_ts3a227.yaml
+ delete mode 100644 Documentation/devicetree/bindings/sound/mt8183-afe-pcm.txt
+ delete mode 100644 Documentation/devicetree/bindings/sound/mt8183-da7219-max98357.txt
+ delete mode 100644 Documentation/devicetree/bindings/sound/mt8183-mt6358-ts3a227-max98357.txt
+ delete mode 100644 Documentation/devicetree/bindings/sound/omap-twl4030.txt
+ create mode 100644 Documentation/devicetree/bindings/sound/qcom,pm4125-codec.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/qcom,pm4125-sdw.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/realtek,alc5623.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/ti,omap-twl4030.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/ti,pcm1754.yaml
+ create mode 100644 Documentation/devicetree/bindings/sound/ti,twl4030-audio.yaml
+ create mode 100644 include/sound/tas2x20-tlv.h
+ create mode 100644 include/sound/tas5825-tlv.h
+ delete mode 100644 include/sound/tlv320dac33-plat.h
+ create mode 100644 sound/soc/codecs/fs-amp-lib.c
+ create mode 100644 sound/soc/codecs/fs-amp-lib.h
+ create mode 100644 sound/soc/codecs/fs210x.c
+ create mode 100644 sound/soc/codecs/fs210x.h
+ create mode 100644 sound/soc/codecs/pcm1754.c
+ create mode 100644 sound/soc/codecs/pm4125-sdw.c
+ create mode 100644 sound/soc/codecs/pm4125.c
+ create mode 100644 sound/soc/codecs/pm4125.h
+ create mode 100644 sound/soc/codecs/tas2783-sdw.c
+ create mode 100644 sound/soc/codecs/tas2783.h
+ create mode 100644 sound/soc/codecs/wcd-common.c
+ create mode 100644 sound/soc/codecs/wcd-common.h
+ delete mode 100644 sound/soc/codecs/wl1273.c
+ delete mode 100644 sound/soc/codecs/wl1273.h
+ create mode 100644 sound/soc/intel/avs/debug.h
+ create mode 100644 sound/soc/sdw_utils/soc_sdw_ti_amp.c
+ create mode 100644 sound/usb/usx2y/us144mkii.c
+ create mode 100644 sound/usb/usx2y/us144mkii.h
+ create mode 100644 sound/usb/usx2y/us144mkii_capture.c
+ create mode 100644 sound/usb/usx2y/us144mkii_controls.c
+ create mode 100644 sound/usb/usx2y/us144mkii_midi.c
+ create mode 100644 sound/usb/usx2y/us144mkii_pcm.c
+ create mode 100644 sound/usb/usx2y/us144mkii_pcm.h
+ create mode 100644 sound/usb/usx2y/us144mkii_playback.c
+Merging sound-asoc-fixes/for-linus (733a763dd8b3a ASoC: tlv320aic3x: Fix class-D initialization for tlv320aic3007)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/sound.git sound-asoc-fixes/for-linus
+Already up to date.
+Merging regmap-fixes/for-linus (1b237f190eb3d Linux 6.17-rc3)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regmap.git regmap-fixes/for-linus
+Already up to date.
+Merging regulator-fixes/for-linus (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regulator.git regulator-fixes/for-linus
+Already up to date.
+Merging spi-fixes/for-linus (398a8a4e51dbd spi: omap2-mcspi: drive SPI_CLK on transfer_setup())
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/spi.git spi-fixes/for-linus
+Already up to date.
+Merging pci-current/for-linus (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/pci/pci.git pci-current/for-linus
+Already up to date.
+Merging driver-core.current/driver-core-linus (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'driver-core-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/driver-core/driver-core.git driver-core.current/driver-core-linus
+Already up to date.
+Merging tty.current/tty-linus (a699213d4e6ef serial: qcom-geni: Fix blocked task)
+$ git merge -m Merge branch 'tty-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/tty.git tty.current/tty-linus
+Merge made by the 'ort' strategy.
+ drivers/tty/serial/qcom_geni_serial.c | 176 ++++------------------------------
+ 1 file changed, 16 insertions(+), 160 deletions(-)
+Merging usb.current/usb-linus (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'usb-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/usb.git usb.current/usb-linus
+Already up to date.
+Merging usb-serial-fixes/usb-linus (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'usb-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/johan/usb-serial.git usb-serial-fixes/usb-linus
+Already up to date.
+Merging phy/fixes (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/phy/linux-phy.git phy/fixes
+Already up to date.
+Merging staging.current/staging-linus (82a051e2553b9 staging: axis-fifo: flush RX FIFO on read errors)
+$ git merge -m Merge branch 'staging-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/staging.git staging.current/staging-linus
+Merge made by the 'ort' strategy.
+ drivers/staging/axis-fifo/axis-fifo.c | 68 ++++++++++++++++-------------------
+ 1 file changed, 31 insertions(+), 37 deletions(-)
+Merging iio-fixes/fixes-togreg (875e7d357a7f2 iio: dac: ad5421: use int type to store negative error codes)
+$ git merge -m Merge branch 'fixes-togreg' of https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git iio-fixes/fixes-togreg
+Merge made by the 'ort' strategy.
+ drivers/iio/adc/pac1934.c             | 20 +++++++++++++--
+ drivers/iio/adc/xilinx-ams.c          | 47 +++++++++++++++++++----------------
+ drivers/iio/dac/ad5360.c              |  2 +-
+ drivers/iio/dac/ad5421.c              |  2 +-
+ drivers/iio/frequency/adf4350.c       | 20 +++++++++------
+ include/linux/iio/frequency/adf4350.h |  2 +-
+ 6 files changed, 60 insertions(+), 33 deletions(-)
+Merging counter-current/counter-current (c17b750b3ad9f Linux 6.17-rc2)
+$ git merge -m Merge branch 'counter-current' of https://git.kernel.org/pub/scm/linux/kernel/git/wbg/counter.git counter-current/counter-current
+Already up to date.
+Merging char-misc.current/char-misc-linus (10df039834f84 misc: fastrpc: Skip reference for DMA handles)
+$ git merge -m Merge branch 'char-misc-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/char-misc.git char-misc.current/char-misc-linus
+Merge made by the 'ort' strategy.
+ drivers/misc/fastrpc.c  | 89 ++++++++++++++++++++++++++++++++-----------------
+ drivers/nvmem/layouts.c | 13 ++++++++
+ 2 files changed, 71 insertions(+), 31 deletions(-)
+Merging soundwire-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/soundwire.git soundwire-fixes/fixes
+Already up to date.
+Merging thunderbolt-fixes/fixes (07e27ad16399a Linux 6.17-rc7)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/westeri/thunderbolt.git thunderbolt-fixes/fixes
+Already up to date.
+Merging input-current/for-linus (30989f67650cb MAINTAINERS: Input: Drop melfas-mip4 section)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/dtor/input.git input-current/for-linus
+Already up to date.
+Merging crypto-current/master (1b34cbbf4f011 crypto: af_alg - Disallow concurrent writes in af_alg_sendmsg)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/herbert/crypto-2.6.git crypto-current/master
+Already up to date.
+Merging libcrypto-fixes/libcrypto-fixes (cdb03b6d1896c crypto: sha512 - Implement export_core() and import_core())
+$ git merge -m Merge branch 'libcrypto-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/ebiggers/linux.git libcrypto-fixes/libcrypto-fixes
+Already up to date.
+Merging vfio-fixes/for-linus (c1d9dac0db168 vfio/pci: Align huge faults to order)
+$ git merge -m Merge branch 'for-linus' of https://github.com/awilliam/linux-vfio.git vfio-fixes/for-linus
+Already up to date.
+Merging kselftest-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git kselftest-fixes/fixes
+Already up to date.
+Merging dmaengine-fixes/fixes (f83ec76bf285b Linux 6.17-rc6)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/dmaengine.git dmaengine-fixes/fixes
+Already up to date.
+Merging backlight-fixes/for-backlight-fixes (1613e604df0cd Linux 6.10-rc1)
+$ git merge -m Merge branch 'for-backlight-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/lee/backlight.git backlight-fixes/for-backlight-fixes
+Already up to date.
+Merging mtd-fixes/mtd/fixes (4550d33e18112 mtd: spinand: winbond: Fix oob_layout for W25N01JW)
+$ git merge -m Merge branch 'mtd/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git mtd-fixes/mtd/fixes
+Already up to date.
+Merging mfd-fixes/for-mfd-fixes (d9d79e4f7dc93 mfd: Fix building without CONFIG_OF)
+$ git merge -m Merge branch 'for-mfd-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/lee/mfd.git mfd-fixes/for-mfd-fixes
+Already up to date.
+Merging v4l-dvb-fixes/fixes (6f6fbd9a0c5a7 media: Remove redundant pm_runtime_mark_last_busy() calls)
+$ git merge -m Merge branch 'fixes' of git://linuxtv.org/media-ci/media-pending.git v4l-dvb-fixes/fixes
+Already up to date.
+Merging reset-fixes/reset/fixes (9a52827a9bbba reset: eyeq: fix OF node leak)
+$ git merge -m Merge branch 'reset/fixes' of https://git.pengutronix.de/git/pza/linux reset-fixes/reset/fixes
+Already up to date.
+Merging mips-fixes/mips-fixes (1b237f190eb3d Linux 6.17-rc3)
+$ git merge -m Merge branch 'mips-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/mips/linux.git mips-fixes/mips-fixes
+Already up to date.
+Merging at91-fixes/at91-fixes (217efb440933b ARM: dts: microchip: sama7d65: Force SDMMC Legacy mode)
+$ git merge -m Merge branch 'at91-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/at91/linux.git at91-fixes/at91-fixes
+Already up to date.
+Merging omap-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap.git omap-fixes/fixes
+Already up to date.
+Merging kvm-fixes/master (ecd42dd170ea7 Merge tag 'kvm-s390-master-6.17-1' of https://git.kernel.org/pub/scm/linux/kernel/git/kvms390/linux into HEAD)
+$ git merge -m Merge branch 'master' of git://git.kernel.org/pub/scm/virt/kvm/kvm.git kvm-fixes/master
+Already up to date.
+Merging kvms390-fixes/master (5f9df945d4e86 KVM: s390: Fix FOLL_*/FAULT_FLAG_* confusion)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/kvms390/linux.git kvms390-fixes/master
+Already up to date.
+Merging hwmon-fixes/hwmon (07e27ad16399a Linux 6.17-rc7)
+$ git merge -m Merge branch 'hwmon' of https://git.kernel.org/pub/scm/linux/kernel/git/groeck/linux-staging.git hwmon-fixes/hwmon
+Already up to date.
+Merging nvdimm-fixes/libnvdimm-fixes (d0b3b7b22dfa1 Linux 6.16-rc4)
+$ git merge -m Merge branch 'libnvdimm-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/nvdimm/nvdimm.git nvdimm-fixes/libnvdimm-fixes
+Already up to date.
+Merging cxl-fixes/fixes (d0b3b7b22dfa1 Linux 6.16-rc4)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/cxl/cxl.git cxl-fixes/fixes
+Already up to date.
+Merging dma-mapping-fixes/dma-mapping-fixes (7e2368a21741e dma-debug: don't enforce dma mapping check on noncoherent allocations)
+$ git merge -m Merge branch 'dma-mapping-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/mszyprowski/linux.git dma-mapping-fixes/dma-mapping-fixes
+Already up to date.
+Merging drivers-x86-fixes/fixes (3ed17349f1877 platform/x86: lg-laptop: Fix WMAB call in fan_mode_store())
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/pdx86/platform-drivers-x86.git drivers-x86-fixes/fixes
+Already up to date.
+Merging samsung-krzk-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux.git samsung-krzk-fixes/fixes
+Already up to date.
+Merging pinctrl-samsung-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/samsung.git pinctrl-samsung-fixes/fixes
+Already up to date.
+Merging devicetree-fixes/dt/linus (80af3745ca465 of: dynamic: Fix use after free in of_changeset_add_prop_helper())
+$ git merge -m Merge branch 'dt/linus' of https://git.kernel.org/pub/scm/linux/kernel/git/robh/linux.git devicetree-fixes/dt/linus
+Already up to date.
+Merging dt-krzk-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-dt.git dt-krzk-fixes/fixes
+Already up to date.
+Merging scsi-fixes/fixes (5cb782ff3c62c scsi: ufs: mcq: Fix memory allocation checks for SQE and CQE)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/mkp/scsi.git scsi-fixes/fixes
+Already up to date.
+Merging drm-fixes/drm-fixes (e5f0a698b34ed Linux 6.17)
+$ git merge -m Merge branch 'drm-fixes' of https://gitlab.freedesktop.org/drm/kernel.git drm-fixes/drm-fixes
+Already up to date.
+Merging drm-intel-fixes/for-linux-next-fixes (7f97a0a871d95 drm/i915/ddi: Guard reg_val against a INVALID_TRANSCODER)
+$ git merge -m Merge branch 'for-linux-next-fixes' of https://gitlab.freedesktop.org/drm/i915/kernel.git drm-intel-fixes/for-linux-next-fixes
+Already up to date.
+Merging mmc-fixes/fixes (77a436c93d10d mmc: sdhci-pci-gli: GL9767: Fix initializing the UHS-II interface during a power-on)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/mmc.git mmc-fixes/fixes
+Already up to date.
+Merging rtc-fixes/rtc-fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'rtc-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/abelloni/linux.git rtc-fixes/rtc-fixes
+Already up to date.
+Merging gnss-fixes/gnss-linus (1b237f190eb3d Linux 6.17-rc3)
+$ git merge -m Merge branch 'gnss-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/johan/gnss.git gnss-fixes/gnss-linus
+Already up to date.
+Merging hyperv-fixes/hyperv-fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'hyperv-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/hyperv/linux.git hyperv-fixes/hyperv-fixes
+Already up to date.
+Merging risc-v-fixes/fixes (e24108012ce96 MAINTAINERS: Update Paul Walmsley's E-mail address)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/riscv/linux.git risc-v-fixes/fixes
+Already up to date.
+Merging riscv-dt-fixes/riscv-dt-fixes (19272b37aa4f8 Linux 6.16-rc1)
+$ git merge -m Merge branch 'riscv-dt-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git riscv-dt-fixes/riscv-dt-fixes
+Already up to date.
+Merging riscv-soc-fixes/riscv-soc-fixes (0af2f6be1b428 Linux 6.15-rc1)
+$ git merge -m Merge branch 'riscv-soc-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git riscv-soc-fixes/riscv-soc-fixes
+Already up to date.
+Merging fpga-fixes/fixes (19272b37aa4f8 Linux 6.16-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/fpga/linux-fpga.git fpga-fixes/fixes
+Already up to date.
+Merging spdx/spdx-linus (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'spdx-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/spdx.git spdx/spdx-linus
+Already up to date.
+Merging gpio-brgl-fixes/gpio/for-current (e5f0a698b34ed Linux 6.17)
+$ git merge -m Merge branch 'gpio/for-current' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git gpio-brgl-fixes/gpio/for-current
+Already up to date.
+Merging gpio-intel-fixes/fixes (19c839a98c731 gpiolib: acpi: initialize acpi_gpio_info struct)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-gpio-intel.git gpio-intel-fixes/fixes
+Already up to date.
+Merging pinctrl-intel-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/intel.git pinctrl-intel-fixes/fixes
+Already up to date.
+Merging auxdisplay-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-auxdisplay.git auxdisplay-fixes/fixes
+Already up to date.
+Merging kunit-fixes/kunit-fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'kunit-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git kunit-fixes/kunit-fixes
+Already up to date.
+Merging memblock-fixes/fixes (b3dcc9d1d806f memblock: fix kernel-doc for MEMBLOCK_RSRV_NOINIT)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/rppt/memblock.git memblock-fixes/fixes
+Already up to date.
+Merging renesas-fixes/fixes (379c590113ce4 ARM: shmobile: smp: Enforce shmobile_smp_* alignment)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-devel.git renesas-fixes/fixes
+Already up to date.
+Merging perf-current/perf-tools (20c9ccffccd61 perf maps: Ensure kmap is set up for all inserts)
+$ git merge -m Merge branch 'perf-tools' of https://git.kernel.org/pub/scm/linux/kernel/git/perf/perf-tools.git perf-current/perf-tools
+Already up to date.
+Merging efi-fixes/urgent (05e75ac35ee9e efi: Explain OVMF acronym in OVMF_DEBUG_LOG help text)
+$ git merge -m Merge branch 'urgent' of https://git.kernel.org/pub/scm/linux/kernel/git/efi/efi.git efi-fixes/urgent
+Merge made by the 'ort' strategy.
+ drivers/firmware/efi/Kconfig | 7 ++++---
+ 1 file changed, 4 insertions(+), 3 deletions(-)
+Merging battery-fixes/fixes (1e451977e1703 power: supply: bq27xxx: restrict no-battery detection to bq27000)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/sre/linux-power-supply.git battery-fixes/fixes
+Already up to date.
+Merging iommufd-fixes/for-rc (43f6bee02196e iommufd/selftest: Update the fail_nth limit)
+$ git merge -m Merge branch 'for-rc' of https://git.kernel.org/pub/scm/linux/kernel/git/jgg/iommufd.git iommufd-fixes/for-rc
+Already up to date.
+Merging rust-fixes/rust-fixes (51a24b7deaae5 Merge tag 'trace-tools-v6.17-rc5' of git://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace)
+$ git merge -m Merge branch 'rust-fixes' of https://github.com/Rust-for-Linux/linux.git rust-fixes/rust-fixes
+Already up to date.
+Merging w1-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-w1.git w1-fixes/fixes
+Already up to date.
+Merging pmdomain-fixes/fixes (5fc4ab3269dea pmdomain: mediatek: set default off flag for MT8195 AUDIO power domain)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/linux-pm.git pmdomain-fixes/fixes
+Already up to date.
+Merging i2c-host-fixes/i2c/i2c-host-fixes (07e27ad16399a Linux 6.17-rc7)
+$ git merge -m Merge branch 'i2c/i2c-host-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/andi.shyti/linux.git i2c-host-fixes/i2c/i2c-host-fixes
+Already up to date.
+Merging sparc-fixes/for-linus (6613476e225e0 Linux 6.8-rc1)
+$ git merge -m Merge branch 'for-linus' of https://git.kernel.org/pub/scm/linux/kernel/git/alarsson/linux-sparc.git sparc-fixes/for-linus
+Already up to date.
+Merging clk-fixes/clk-fixes (764c921bf0c5f Merge tag 'sunxi-clk-fixes-for-6.17' of https://git.kernel.org/pub/scm/linux/kernel/git/sunxi/linux into clk-fixes)
+$ git merge -m Merge branch 'clk-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/clk/linux.git clk-fixes/clk-fixes
+Already up to date.
+Merging thead-clk-fixes/thead-clk-fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'thead-clk-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git thead-clk-fixes/thead-clk-fixes
+Already up to date.
+Merging pwrseq-fixes/pwrseq/for-current (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'pwrseq/for-current' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git pwrseq-fixes/pwrseq/for-current
+Already up to date.
+Merging thead-dt-fixes/thead-dt-fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'thead-dt-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git thead-dt-fixes/thead-dt-fixes
+Already up to date.
+Merging ftrace-fixes/ftrace/fixes (327e28664307d fgraph: Do not enable function_graph tracer when setting funcgraph-args)
+$ git merge -m Merge branch 'ftrace/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git ftrace-fixes/ftrace/fixes
+Already up to date.
+Merging ring-buffer-fixes/ring-buffer/fixes (e4d4b8670c44c ring-buffer: Use flush_kernel_vmap_range() over flush_dcache_folio())
+$ git merge -m Merge branch 'ring-buffer/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git ring-buffer-fixes/ring-buffer/fixes
+Already up to date.
+Merging trace-fixes/trace/fixes (0db0934e7f9bb tracing: fgraph: Protect return handler from recursion loop)
+$ git merge -m Merge branch 'trace/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git trace-fixes/trace/fixes
+Already up to date.
+Merging tracefs-fixes/tracefs/fixes (8b55572e51805 tracing/selftests: Add tracefs mount options test)
+$ git merge -m Merge branch 'tracefs/fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git tracefs-fixes/tracefs/fixes
+Already up to date.
+Merging spacemit-fixes/fixes (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'fixes' of https://github.com/spacemit-com/linux spacemit-fixes/fixes
+Already up to date.
+Merging tip-fixes/tip/urgent (8f9736633f8ca Merge tag 'trace-v6.17-rc7' of git://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace)
+$ git merge -m Merge branch 'tip/urgent' of https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git tip-fixes/tip/urgent
+Already up to date.
+Merging slab-fixes/slab/for-next-fixes (850470a8413a8 mm: slub: avoid wake up kswapd in set_track_prepare)
+$ git merge -m Merge branch 'slab/for-next-fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/vbabka/slab.git slab-fixes/slab/for-next-fixes
+Already up to date.
+Merging drm-msm-fixes/msm-fixes (b5bad77e1e3c7 drm/msm/registers: Sync GPU registers from mesa)
+$ git merge -m Merge branch 'msm-fixes' of https://gitlab.freedesktop.org/drm/msm.git drm-msm-fixes/msm-fixes
+Auto-merging drivers/gpu/drm/msm/msm_drv.h
+Auto-merging drivers/gpu/drm/msm/msm_gem.c
+Merge made by the 'ort' strategy.
+ .../bindings/display/msm/dp-controller.yaml        | 146 ++++-
+ .../bindings/display/msm/dsi-controller-main.yaml  |   2 +
+ .../devicetree/bindings/display/msm/gmu.yaml       |  34 +
+ .../devicetree/bindings/display/msm/gpu.yaml       | 229 ++++++-
+ .../bindings/display/msm/qcom,sa8775p-mdss.yaml    |  26 +-
+ .../bindings/display/msm/qcom,sar2130p-mdss.yaml   |  10 +-
+ .../bindings/display/msm/qcom,sc7280-mdss.yaml     |   3 +-
+ .../bindings/display/msm/qcom,sc8180x-dpu.yaml     | 103 +++
+ .../bindings/display/msm/qcom,sc8180x-mdss.yaml    | 359 ++++++++++
+ .../bindings/display/msm/qcom,sm7150-mdss.yaml     |  16 +-
+ .../bindings/display/msm/qcom,sm8750-mdss.yaml     |  10 +-
+ .../bindings/display/msm/qcom,x1e80100-mdss.yaml   |  20 +-
+ drivers/gpu/drm/msm/adreno/a6xx_catalog.c          |  92 ++-
+ drivers/gpu/drm/msm/adreno/a6xx_gmu.c              | 108 ++-
+ drivers/gpu/drm/msm/adreno/a6xx_gmu.h              |  14 +
+ drivers/gpu/drm/msm/adreno/a6xx_gpu.c              | 242 +++++--
+ drivers/gpu/drm/msm/adreno/a6xx_gpu.h              |   3 +
+ drivers/gpu/drm/msm/adreno/a6xx_gpu_state.c        |  10 +-
+ drivers/gpu/drm/msm/adreno/a6xx_hfi.c              |  34 +-
+ drivers/gpu/drm/msm/adreno/a6xx_preempt.c          |  44 +-
+ drivers/gpu/drm/msm/adreno/adreno_device.c         |  13 +
+ drivers/gpu/drm/msm/adreno/adreno_gpu.c            |  21 +-
+ drivers/gpu/drm/msm/adreno/adreno_gpu.h            |   1 +
+ drivers/gpu/drm/msm/disp/dpu1/dpu_core_perf.c      |  35 +-
+ drivers/gpu/drm/msm/disp/dpu1/dpu_core_perf.h      |   3 +
+ drivers/gpu/drm/msm/disp/dpu1/dpu_crtc.c           |  17 +-
+ .../gpu/drm/msm/disp/dpu1/dpu_encoder_phys_wb.c    |   2 +-
+ drivers/gpu/drm/msm/disp/dpu1/dpu_hw_catalog.c     |   5 -
+ drivers/gpu/drm/msm/disp/dpu1/dpu_hw_catalog.h     |   1 -
+ drivers/gpu/drm/msm/disp/dpu1/dpu_kms.c            |   2 +-
+ drivers/gpu/drm/msm/disp/dpu1/dpu_plane.c          |   4 +
+ drivers/gpu/drm/msm/disp/dpu1/dpu_rm.c             |  23 +-
+ drivers/gpu/drm/msm/disp/dpu1/dpu_writeback.c      |  10 +-
+ drivers/gpu/drm/msm/disp/mdp4/mdp4_kms.c           |  29 +-
+ drivers/gpu/drm/msm/disp/mdp4/mdp4_kms.h           |   2 +-
+ drivers/gpu/drm/msm/disp/mdp4/mdp4_lcdc_encoder.c  |   2 +-
+ drivers/gpu/drm/msm/disp/mdp4/mdp4_lvds_pll.c      |  47 +-
+ drivers/gpu/drm/msm/disp/mdp5/mdp5_kms.c           |   2 +-
+ drivers/gpu/drm/msm/dsi/phy/dsi_phy.h              |   1 +
+ drivers/gpu/drm/msm/dsi/phy/dsi_phy_10nm.c         |  16 +-
+ drivers/gpu/drm/msm/dsi/phy/dsi_phy_14nm.c         |  34 +-
+ drivers/gpu/drm/msm/dsi/phy/dsi_phy_28nm.c         |  21 +-
+ drivers/gpu/drm/msm/dsi/phy/dsi_phy_28nm_8960.c    |  32 +-
+ drivers/gpu/drm/msm/dsi/phy/dsi_phy_7nm.c          |  95 ++-
+ drivers/gpu/drm/msm/hdmi/hdmi_phy_8996.c           |  16 +-
+ drivers/gpu/drm/msm/hdmi/hdmi_phy_8998.c           |  16 +-
+ drivers/gpu/drm/msm/hdmi/hdmi_pll_8960.c           |  12 +-
+ drivers/gpu/drm/msm/msm_drv.c                      |   1 +
+ drivers/gpu/drm/msm/msm_drv.h                      |   2 +-
+ drivers/gpu/drm/msm/msm_gem.c                      |  21 +-
+ drivers/gpu/drm/msm/msm_gem.h                      |   6 +-
+ drivers/gpu/drm/msm/msm_gem_prime.c                |   2 +-
+ drivers/gpu/drm/msm/msm_gem_vma.c                  |  31 +-
+ drivers/gpu/drm/msm/msm_gpu.c                      |   2 +-
+ drivers/gpu/drm/msm/msm_gpu.h                      |   9 +
+ drivers/gpu/drm/msm/msm_gpu_trace.h                |  12 +
+ drivers/gpu/drm/msm/msm_iommu.c                    |   8 +-
+ drivers/gpu/drm/msm/msm_kms.c                      |  14 +-
+ drivers/gpu/drm/msm/msm_mdss.c                     |   3 +-
+ drivers/gpu/drm/msm/msm_submitqueue.c              |   4 +
+ drivers/gpu/drm/msm/registers/adreno/a6xx.xml      | 726 ++++++++++++---------
+ .../drm/msm/registers/adreno/a6xx_descriptors.xml  |  40 --
+ .../gpu/drm/msm/registers/adreno/a6xx_enums.xml    |  50 +-
+ drivers/gpu/drm/msm/registers/adreno/a6xx_gmu.xml  |  11 +
+ .../gpu/drm/msm/registers/adreno/adreno_pm4.xml    | 179 ++---
+ .../gpu/drm/msm/registers/display/dsi_phy_7nm.xml  |  11 +-
+ drivers/gpu/drm/msm/registers/gen_header.py        | 201 +++---
+ 67 files changed, 2347 insertions(+), 953 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/display/msm/qcom,sc8180x-dpu.yaml
+ create mode 100644 Documentation/devicetree/bindings/display/msm/qcom,sc8180x-mdss.yaml
+Merging uml-fixes/fixes (df447a3b4a4b9 um: Fix FD copy size in os_rcv_fd_msg())
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/uml/linux.git uml-fixes/fixes
+Already up to date.
+Merging fwctl-fixes/for-rc (f12343013022a pds_fwctl: Remove the use of dev_err_probe())
+$ git merge -m Merge branch 'for-rc' of https://git.kernel.org/pub/scm/linux/kernel/git/fwctl/fwctl.git fwctl-fixes/for-rc
+Merge made by the 'ort' strategy.
+ drivers/fwctl/mlx5/main.c | 2 +-
+ drivers/fwctl/pds/main.c  | 2 +-
+ 2 files changed, 2 insertions(+), 2 deletions(-)
+Merging devsec-tsm-fixes/fixes (fba4ceaa242d2 configfs-tsm-report: Fix NULL dereference of tsm_ops)
+$ git merge -m Merge branch 'fixes' of https://git.kernel.org/pub/scm/linux/kernel/git/devsec/tsm.git devsec-tsm-fixes/fixes
+Already up to date.
+Merging drm-rust-fixes/drm-rust-fixes (349510052f765 MAINTAINERS: Add drm-rust tree for Rust DRM drivers and infrastructure)
+$ git merge -m Merge branch 'drm-rust-fixes' of https://gitlab.freedesktop.org/drm/rust/kernel.git drm-rust-fixes/drm-rust-fixes
+Already up to date.
+Merging drm-misc-fixes/for-linux-next-fixes (7d9c3442b02ab drm/panthor: Defer scheduler entitiy destruction to queue release)
+$ git merge -m Merge branch 'for-linux-next-fixes' of https://gitlab.freedesktop.org/drm/misc/kernel.git drm-misc-fixes/for-linux-next-fixes
+Already up to date.
+Merging linus/for-next (ffd294d346d18 Linux 6.13)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linus/for-next
+Already up to date.
+Merging mm-stable/mm-stable (89a3ecca49ee8 kho: make sure page being restored is actually from KHO)
+  8d4bb46ba7671 ("ntfs3: stop using write_cache_pages")
+$ git merge -m Merge branch 'mm-stable' of https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm mm-stable/mm-stable
+Auto-merging Documentation/filesystems/proc.rst
+Auto-merging MAINTAINERS
+Auto-merging arch/loongarch/Kconfig
+Auto-merging arch/riscv/include/asm/pgtable.h
+CONFLICT (content): Merge conflict in arch/riscv/include/asm/pgtable.h
+Auto-merging arch/x86/Kconfig
+Auto-merging fs/aio.c
+Auto-merging fs/btrfs/disk-io.c
+Auto-merging fs/btrfs/inode.c
+Auto-merging fs/coredump.c
+Auto-merging fs/exec.c
+Auto-merging fs/fuse/dev.c
+Auto-merging fs/hugetlbfs/inode.c
+Auto-merging fs/ntfs3/inode.c
+Auto-merging fs/pidfs.c
+Auto-merging fs/proc/array.c
+Auto-merging fs/proc/task_mmu.c
+Auto-merging include/linux/fs.h
+Auto-merging include/linux/mm_types.h
+Auto-merging include/linux/pagemap.h
+Auto-merging include/linux/pgtable.h
+Auto-merging include/linux/writeback.h
+Auto-merging kernel/events/uprobes.c
+Auto-merging kernel/fork.c
+Auto-merging kernel/sched/fair.c
+Auto-merging mm/backing-dev.c
+Auto-merging mm/damon/sysfs.c
+Auto-merging mm/filemap.c
+Auto-merging mm/huge_memory.c
+Auto-merging mm/hugetlb.c
+Auto-merging mm/migrate.c
+Auto-merging mm/page-writeback.c
+Auto-merging mm/shmem.c
+Auto-merging mm/slub.c
+Auto-merging rust/kernel/lib.rs
+Resolved 'arch/riscv/include/asm/pgtable.h' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 055316cb465aa] Merge branch 'mm-stable' of https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm
+$ git diff -M --stat --summary HEAD^..
+ Documentation/ABI/testing/sysfs-kernel-mm-damon    |   7 +
+ Documentation/admin-guide/mm/damon/start.rst       |   2 +-
+ Documentation/admin-guide/mm/damon/usage.rst       |  11 +-
+ Documentation/admin-guide/mm/transhuge.rst         |  42 +-
+ Documentation/admin-guide/mm/zswap.rst             |  33 +-
+ Documentation/core-api/mm-api.rst                  |   1 -
+ Documentation/dev-tools/kasan.rst                  |   3 +
+ Documentation/driver-api/crypto/iaa/iaa-crypto.rst |   2 -
+ Documentation/filesystems/proc.rst                 |  18 +-
+ Documentation/mm/damon/design.rst                  |  18 +-
+ Documentation/mm/damon/maintainer-profile.rst      |  17 +-
+ Documentation/mm/index.rst                         |   1 +
+ Documentation/mm/swap-table.rst                    |  69 +++
+ MAINTAINERS                                        |  11 +-
+ arch/arc/include/asm/arcregs.h                     |   3 -
+ arch/arc/mm/cache.c                                |   8 +-
+ arch/arc/mm/tlb.c                                  |   2 +-
+ arch/arm/include/asm/highmem.h                     |   6 +-
+ arch/arm/include/asm/hugetlb.h                     |   2 +-
+ arch/arm/mm/copypage-v4mc.c                        |   2 +-
+ arch/arm/mm/copypage-v6.c                          |   2 +-
+ arch/arm/mm/copypage-xscale.c                      |   2 +-
+ arch/arm/mm/dma-mapping.c                          |   2 +-
+ arch/arm/mm/fault-armv.c                           |   2 +-
+ arch/arm/mm/flush.c                                |  10 +-
+ arch/arm/mm/kasan_init.c                           |   2 +-
+ arch/arm/mm/mmu.c                                  |   2 +-
+ arch/arm64/Kconfig                                 |   1 -
+ arch/arm64/include/asm/hugetlb.h                   |   6 +-
+ arch/arm64/include/asm/memory.h                    |   1 +
+ arch/arm64/include/asm/mte-kasan.h                 |   6 +
+ arch/arm64/include/asm/mte.h                       |  16 +-
+ arch/arm64/kernel/cpufeature.c                     |   2 +-
+ arch/arm64/kernel/mte.c                            |  18 +
+ arch/arm64/mm/flush.c                              |   8 +-
+ arch/arm64/mm/kasan_init.c                         |   4 +-
+ arch/arm64/mm/mmu.c                                |   2 +-
+ arch/csky/abiv1/cacheflush.c                       |   6 +-
+ arch/loongarch/Kconfig                             |   1 +
+ arch/loongarch/configs/loongson3_defconfig         |   1 -
+ arch/loongarch/include/asm/kasan.h                 |   7 -
+ arch/loongarch/mm/kasan_init.c                     |   8 +-
+ arch/mips/include/asm/cacheflush.h                 |  17 +-
+ arch/mips/mm/cache.c                               |   8 +-
+ arch/nios2/mm/cacheflush.c                         |   6 +-
+ arch/openrisc/include/asm/cacheflush.h             |   2 +-
+ arch/openrisc/mm/cache.c                           |   2 +-
+ arch/parisc/include/asm/processor.h                |   2 +-
+ arch/parisc/kernel/cache.c                         |   6 +-
+ arch/parisc/kernel/sys_parisc.c                    |   2 +-
+ arch/powerpc/Kconfig                               |   1 +
+ arch/powerpc/include/asm/cacheflush.h              |   4 +-
+ arch/powerpc/include/asm/kasan.h                   |  12 -
+ arch/powerpc/include/asm/kvm_ppc.h                 |   4 +-
+ arch/powerpc/mm/book3s64/hash_utils.c              |   4 +-
+ arch/powerpc/mm/book3s64/radix_pgtable.c           |   2 +-
+ arch/powerpc/mm/kasan/init_32.c                    |   2 +-
+ arch/powerpc/mm/kasan/init_book3e_64.c             |   2 +-
+ arch/powerpc/mm/kasan/init_book3s_64.c             |   6 +-
+ arch/powerpc/mm/pgtable.c                          |  12 +-
+ arch/powerpc/mm/ptdump/8xx.c                       |   2 +-
+ arch/powerpc/mm/ptdump/book3s64.c                  |   2 +-
+ arch/powerpc/mm/ptdump/ptdump.h                    |   4 +-
+ arch/powerpc/mm/ptdump/shared.c                    |   2 +-
+ arch/powerpc/platforms/pseries/cmm.c               |   2 +-
+ arch/riscv/include/asm/cacheflush.h                |   4 +-
+ arch/riscv/include/asm/hugetlb.h                   |   2 +-
+ arch/riscv/include/asm/pgtable.h                   |   4 +-
+ arch/riscv/mm/cacheflush.c                         |   4 +-
+ arch/riscv/mm/init.c                               |   4 +-
+ arch/riscv/mm/kasan_init.c                         |   1 +
+ arch/s390/Kconfig                                  |   1 -
+ arch/s390/include/asm/hugetlb.h                    |   2 +-
+ arch/s390/kernel/early.c                           |   3 +-
+ arch/s390/kernel/uv.c                              |  12 +-
+ arch/s390/mm/gmap.c                                |   2 +-
+ arch/s390/mm/hugetlbpage.c                         |   2 +-
+ arch/s390/mm/mmap.c                                |  10 +-
+ arch/s390/mm/pgalloc.c                             |   6 +-
+ arch/sh/include/asm/hugetlb.h                      |   2 +-
+ arch/sh/mm/cache-sh4.c                             |   2 +-
+ arch/sh/mm/cache-sh7705.c                          |   2 +-
+ arch/sh/mm/cache.c                                 |  14 +-
+ arch/sh/mm/kmap.c                                  |   2 +-
+ arch/sparc/kernel/sys_sparc_64.c                   |   6 +-
+ arch/sparc/mm/init_64.c                            |  10 +-
+ arch/um/Kconfig                                    |   1 +
+ arch/um/include/asm/kasan.h                        |   5 +-
+ arch/um/kernel/mem.c                               |  13 +-
+ arch/x86/Kconfig                                   |   1 -
+ arch/x86/mm/init.c                                 |   1 +
+ arch/x86/mm/init_64.c                              |   2 +-
+ arch/x86/mm/kasan_init_64.c                        |   2 +-
+ arch/x86/mm/mmap.c                                 |  10 +-
+ arch/x86/mm/pat/memtype.c                          |   6 +-
+ arch/x86/platform/efi/memmap.c                     |   2 +-
+ arch/xtensa/include/asm/highmem.h                  |   2 +-
+ arch/xtensa/mm/cache.c                             |  12 +-
+ arch/xtensa/mm/kasan_init.c                        |   2 +-
+ block/blk-lib.c                                    |  15 +-
+ crypto/ahash.c                                     |   4 +-
+ crypto/scompress.c                                 |   8 +-
+ drivers/ata/libata-sff.c                           |   6 +-
+ drivers/base/node.c                                |   5 +
+ drivers/block/aoe/aoecmd.c                         |   2 +-
+ drivers/block/zram/zram_drv.c                      |  23 +-
+ drivers/char/mem.c                                 |  21 +-
+ drivers/gpu/drm/drm_gem.c                          |   4 +-
+ drivers/gpu/drm/i915/gem/i915_gem_pages.c          |   2 +-
+ drivers/memstick/core/mspro_block.c                |   3 +-
+ drivers/memstick/host/jmb38x_ms.c                  |   3 +-
+ drivers/memstick/host/tifm_ms.c                    |   3 +-
+ drivers/misc/vmw_balloon.c                         |   4 +-
+ drivers/mmc/host/tifm_sd.c                         |   4 +-
+ drivers/mmc/host/usdhi6rol0.c                      |   4 +-
+ drivers/scsi/scsi_lib.c                            |   3 +-
+ drivers/scsi/sg.c                                  |   3 +-
+ drivers/vfio/pci/pds/lm.c                          |   3 +-
+ drivers/vfio/pci/virtio/migrate.c                  |   3 +-
+ drivers/virtio/virtio_balloon.c                    |  10 +-
+ drivers/xen/Kconfig                                |   1 +
+ drivers/xen/gntdev.c                               |   5 +-
+ fs/Kconfig                                         |   1 -
+ fs/aio.c                                           |   2 +-
+ fs/bcachefs/darray.c                               |   2 +-
+ fs/bcachefs/fs-io-buffered.c                       |  13 +-
+ fs/bcachefs/util.h                                 |   2 +-
+ fs/btrfs/disk-io.c                                 |   1 +
+ fs/btrfs/inode.c                                   |   4 +-
+ fs/coredump.c                                      |   4 +-
+ fs/dax.c                                           |  47 +-
+ fs/exec.c                                          |   2 +-
+ fs/fuse/dev.c                                      |   2 +-
+ fs/gfs2/glops.c                                    |   2 +-
+ fs/hugetlbfs/inode.c                               |  38 +-
+ fs/jffs2/file.c                                    |   4 +-
+ fs/jfs/jfs_metapage.c                              |   8 +-
+ fs/mpage.c                                         |  14 +-
+ fs/nilfs2/page.c                                   |   2 +-
+ fs/pidfs.c                                         |   7 +-
+ fs/proc/array.c                                    |   2 +-
+ fs/proc/base.c                                     |  12 +-
+ fs/proc/internal.h                                 |  15 +-
+ fs/proc/page.c                                     |   5 +-
+ fs/proc/task_mmu.c                                 | 190 ++++--
+ fs/proc/task_nommu.c                               |  14 +-
+ fs/ubifs/file.c                                    |   6 +-
+ include/asm-generic/memory_model.h                 |   2 +-
+ include/crypto/scatterwalk.h                       |   4 +-
+ include/linux/alloc_tag.h                          |  12 +
+ include/linux/blkdev.h                             |   2 +-
+ include/linux/bpfptr.h                             |   2 +-
+ include/linux/bvec.h                               |   7 +-
+ include/linux/codetag.h                            |   5 +-
+ include/linux/damon.h                              |  18 +-
+ include/linux/freezer.h                            |   2 +
+ include/linux/fs.h                                 |   8 +-
+ include/linux/highmem-internal.h                   |  36 +-
+ include/linux/highmem.h                            |   8 +-
+ include/linux/huge_mm.h                            | 110 +++-
+ include/linux/hugetlb.h                            |   7 +-
+ include/linux/kasan-enabled.h                      |  32 +-
+ include/linux/kasan.h                              |   6 +
+ include/linux/khugepaged.h                         |   6 +-
+ include/linux/ksm.h                                |   6 +-
+ include/linux/maple_tree.h                         |  27 +-
+ include/linux/memcontrol.h                         |  10 +-
+ include/linux/mempool.h                            |   2 +-
+ include/linux/memremap.h                           |  47 +-
+ include/linux/migrate.h                            |  11 +-
+ include/linux/mm.h                                 | 275 ++++++---
+ include/linux/mm_inline.h                          |  37 +-
+ include/linux/mm_types.h                           | 136 +++--
+ include/linux/mman.h                               |   2 +-
+ include/linux/mmap_lock.h                          |  85 ---
+ include/linux/mmzone.h                             |  91 +--
+ include/linux/netfs.h                              |   2 +-
+ include/linux/oom.h                                |   2 +-
+ include/linux/page-flags.h                         |  45 +-
+ include/linux/pageblock-flags.h                    |  12 +-
+ include/linux/pagemap.h                            |  65 ++-
+ include/linux/pagevec.h                            |   4 +-
+ include/linux/pgalloc_tag.h                        |   7 +-
+ include/linux/pgtable.h                            |  26 +
+ include/linux/rmap.h                               |  62 +-
+ include/linux/scatterlist.h                        |   3 +-
+ include/linux/sched/coredump.h                     |  18 +-
+ include/linux/sched/mm.h                           |   4 +-
+ include/linux/shmem_fs.h                           |   4 +-
+ include/linux/slab.h                               |  39 +-
+ include/linux/swap.h                               |  50 +-
+ include/linux/vm_event_item.h                      |   2 +
+ include/linux/vmalloc.h                            |  12 +-
+ include/linux/writeback.h                          |   6 -
+ include/linux/zpool.h                              |  86 ---
+ include/trace/events/cma.h                         |  19 +-
+ include/trace/events/huge_memory.h                 |  19 +-
+ include/trace/events/kmem.h                        |   5 +-
+ include/trace/events/page_ref.h                    |   4 +-
+ include/trace/events/readahead.h                   | 132 +++++
+ include/uapi/linux/mempolicy.h                     |  12 +-
+ include/uapi/linux/prctl.h                         |  10 +
+ io_uring/zcrx.c                                    |   4 +-
+ kernel/dma/remap.c                                 |   2 +-
+ kernel/events/uprobes.c                            |  32 +-
+ kernel/exit.c                                      |  25 +-
+ kernel/fork.c                                      |  19 +-
+ kernel/freezer.c                                   |  20 +-
+ kernel/kexec_handover.c                            |  72 ++-
+ kernel/rcu/rcuscale.c                              |   2 +-
+ kernel/resource.c                                  |  50 +-
+ kernel/sched/fair.c                                |  10 +-
+ kernel/sys.c                                       |  69 ++-
+ lib/Kconfig.kasan                                  |  12 +
+ lib/alloc_tag.c                                    |  30 +-
+ lib/maple_tree.c                                   |  12 +-
+ lib/rhashtable.c                                   |   4 +-
+ lib/test_hmm.c                                     |   2 +-
+ lib/test_kho.c                                     |  52 +-
+ lib/test_maple_tree.c                              |   2 +-
+ lib/xarray.c                                       |   2 +-
+ mm/Kconfig                                         |  72 +--
+ mm/Makefile                                        |   1 -
+ mm/backing-dev.c                                   |   2 +-
+ mm/cma.c                                           |  41 +-
+ mm/damon/Kconfig                                   |   2 +-
+ mm/damon/core.c                                    | 111 ++--
+ mm/damon/lru_sort.c                                |  51 +-
+ mm/damon/ops-common.c                              |  11 +-
+ mm/damon/ops-common.h                              |   2 +
+ mm/damon/paddr.c                                   | 130 +++--
+ mm/damon/reclaim.c                                 |  49 +-
+ mm/damon/stat.c                                    |  26 +-
+ mm/damon/sysfs.c                                   |  44 +-
+ mm/damon/tests/core-kunit.h                        |  38 +-
+ mm/damon/tests/vaddr-kunit.h                       |   2 +-
+ mm/damon/vaddr.c                                   | 105 +++-
+ mm/debug.c                                         |   4 +-
+ mm/filemap.c                                       |  74 ++-
+ mm/gup.c                                           | 126 ++--
+ mm/highmem.c                                       |  10 +-
+ mm/hmm.c                                           |  70 ++-
+ mm/huge_memory.c                                   | 246 ++++----
+ mm/hugetlb.c                                       | 160 ++---
+ mm/hugetlb_cma.c                                   |   3 +-
+ mm/hugetlb_cma.h                                   |   6 +-
+ mm/hwpoison-inject.c                               |  91 +++
+ mm/internal.h                                      |  20 +-
+ mm/kasan/common.c                                  |  17 +-
+ mm/kasan/generic.c                                 |  19 +-
+ mm/kasan/hw_tags.c                                 |  54 +-
+ mm/kasan/init.c                                    |   4 +-
+ mm/kasan/kasan.h                                   |  15 +-
+ mm/kasan/kasan_test_c.c                            | 245 +++++---
+ mm/kasan/shadow.c                                  |  12 +-
+ mm/kasan/sw_tags.c                                 |   1 +
+ mm/kasan/tags.c                                    |   2 +-
+ mm/kfence/core.c                                   |  12 +-
+ mm/khugepaged.c                                    |  77 +--
+ mm/ksm.c                                           |  47 +-
+ mm/memcontrol-v1.c                                 |   8 +-
+ mm/memcontrol.c                                    |   8 +-
+ mm/memfd.c                                         |   4 +-
+ mm/memory-failure.c                                | 122 +---
+ mm/memory-tiers.c                                  |  12 +
+ mm/memory.c                                        | 404 ++++++++-----
+ mm/memory_hotplug.c                                |   2 +-
+ mm/memremap.c                                      |  25 +-
+ mm/migrate.c                                       | 113 ++--
+ mm/migrate_device.c                                |   2 +-
+ mm/mincore.c                                       |  70 ++-
+ mm/mm_init.c                                       |  15 +-
+ mm/mmap.c                                          |  10 +-
+ mm/mmap_lock.c                                     | 109 +++-
+ mm/mmu_gather.c                                    |   4 +-
+ mm/mmzone.c                                        |   4 +-
+ mm/nommu.c                                         |  17 +-
+ mm/oom_kill.c                                      |  52 +-
+ mm/page-writeback.c                                |  46 +-
+ mm/page_alloc.c                                    | 157 +++--
+ mm/page_io.c                                       |  12 +-
+ mm/pagewalk.c                                      |  28 +-
+ mm/percpu-km.c                                     |   2 +-
+ mm/readahead.c                                     |   8 +
+ mm/rmap.c                                          | 128 ++--
+ mm/shmem.c                                         | 139 ++---
+ mm/show_mem.c                                      |  17 +-
+ mm/slab.h                                          |   6 +-
+ mm/slub.c                                          |  79 ++-
+ mm/sparse.c                                        |   6 +-
+ mm/swap.c                                          |  13 +-
+ mm/swap.h                                          | 329 +++++++++--
+ mm/swap_state.c                                    | 474 +++++++--------
+ mm/swap_table.h                                    | 130 +++++
+ mm/swapfile.c                                      | 563 +++++++++++-------
+ mm/userfaultfd.c                                   | 229 +++++---
+ mm/util.c                                          | 110 +++-
+ mm/vma.c                                           |   5 +-
+ mm/vma.h                                           |  30 +-
+ mm/vma_init.c                                      |   2 +-
+ mm/vmalloc.c                                       |  39 +-
+ mm/vmscan.c                                        |  65 ++-
+ mm/vmstat.c                                        |   4 +-
+ mm/workingset.c                                    |   2 +-
+ mm/zpdesc.h                                        |  14 +-
+ mm/zpool.c                                         | 328 -----------
+ mm/zsmalloc.c                                      |  83 +--
+ mm/zswap.c                                         | 269 ++++-----
+ rust/helpers/helpers.c                             |   1 +
+ rust/helpers/maple_tree.c                          |   8 +
+ rust/helpers/slab.c                                |  10 +-
+ rust/helpers/vmalloc.c                             |   5 +-
+ rust/kernel/alloc.rs                               |  54 +-
+ rust/kernel/alloc/allocator.rs                     | 105 +++-
+ rust/kernel/alloc/allocator_test.rs                |   3 +-
+ rust/kernel/alloc/kbox.rs                          |   4 +-
+ rust/kernel/alloc/kvec.rs                          |  11 +-
+ rust/kernel/lib.rs                                 |   1 +
+ rust/kernel/maple_tree.rs                          | 647 +++++++++++++++++++++
+ rust/kernel/mm.rs                                  |   3 +-
+ rust/kernel/mm/mmput_async.rs                      |   2 +-
+ samples/cgroup/memcg_event_listener.c              |   2 -
+ samples/damon/mtier.c                              |  11 +-
+ samples/damon/prcl.c                               |  11 +-
+ samples/damon/wsse.c                               |  15 +-
+ scripts/decode_stacktrace.sh                       |  35 +-
+ tools/include/linux/atomic.h                       |  22 +
+ tools/mm/slabinfo.c                                |   7 +-
+ tools/testing/radix-tree/maple.c                   |  10 +-
+ tools/testing/scatterlist/linux/mm.h               |   1 -
+ tools/testing/selftests/damon/Makefile             |   2 +
+ tools/testing/selftests/damon/access_memory_even.c |   1 -
+ .../selftests/damon/sysfs_no_op_commit_break.py    |  72 +++
+ tools/testing/selftests/kho/init.c                 |  13 +-
+ tools/testing/selftests/kho/vmtest.sh              |  26 +-
+ tools/testing/selftests/kselftest.h                |   8 +
+ tools/testing/selftests/landlock/audit.h           |   6 +-
+ tools/testing/selftests/landlock/common.h          |   4 -
+ tools/testing/selftests/mm/.gitignore              |   2 +
+ tools/testing/selftests/mm/Makefile                |   5 +
+ tools/testing/selftests/mm/cow.c                   |  13 +-
+ tools/testing/selftests/mm/gup_test.c              |   2 +
+ tools/testing/selftests/mm/hmm-tests.c             |   5 +-
+ tools/testing/selftests/mm/hugepage-mremap.c       |  16 +-
+ tools/testing/selftests/mm/khugepaged.c            |   2 +-
+ tools/testing/selftests/mm/ksm_functional_tests.c  | 156 ++---
+ tools/testing/selftests/mm/madv_populate.c         |  21 +-
+ tools/testing/selftests/mm/mremap_test.c           |   6 +-
+ tools/testing/selftests/mm/pagemap_ioctl.c         |  24 +-
+ tools/testing/selftests/mm/pfnmap.c                |  48 +-
+ tools/testing/selftests/mm/pkey-helpers.h          |   3 -
+ tools/testing/selftests/mm/pkey_sighandler_tests.c |   2 +-
+ tools/testing/selftests/mm/prctl_thp_disable.c     | 291 +++++++++
+ tools/testing/selftests/mm/protection_keys.c       |   6 +-
+ tools/testing/selftests/mm/rmap.c                  | 433 ++++++++++++++
+ tools/testing/selftests/mm/run_vmtests.sh          |  31 +-
+ tools/testing/selftests/mm/soft-dirty.c            |   5 +-
+ tools/testing/selftests/mm/split_huge_page_test.c  | 477 +++++++++++----
+ tools/testing/selftests/mm/test_vmalloc.sh         |   6 +-
+ tools/testing/selftests/mm/thp_settings.c          |   9 +-
+ tools/testing/selftests/mm/thp_settings.h          |   1 +
+ tools/testing/selftests/mm/thuge-gen.c             |  11 +-
+ tools/testing/selftests/mm/uffd-common.c           | 271 +++++----
+ tools/testing/selftests/mm/uffd-common.h           |  78 +--
+ tools/testing/selftests/mm/uffd-stress.c           | 243 ++++----
+ tools/testing/selftests/mm/uffd-unit-tests.c       | 559 +++++++++---------
+ tools/testing/selftests/mm/uffd-wp-mremap.c        |  29 +-
+ tools/testing/selftests/mm/va_high_addr_switch.c   |   4 +-
+ tools/testing/selftests/mm/va_high_addr_switch.sh  |  37 ++
+ tools/testing/selftests/mm/virtual_address_range.c |  13 +-
+ tools/testing/selftests/mm/vm_util.c               | 167 +++++-
+ tools/testing/selftests/mm/vm_util.h               |  18 +
+ tools/testing/selftests/net/ovpn/ovpn-cli.c        |   3 +-
+ tools/testing/selftests/net/psock_lib.h            |   4 -
+ .../selftests/perf_events/watermark_signal.c       |   2 -
+ tools/testing/selftests/proc/proc-maps-race.c      |  65 +++
+ tools/testing/selftests/ublk/utils.h               |   2 -
+ .../testing/selftests/wireguard/qemu/kernel.config |   1 -
+ tools/testing/selftests/zram/README                |   1 -
+ tools/testing/shared/linux/maple_tree.h            |   6 +-
+ tools/testing/shared/shared.mk                     |   6 +-
+ tools/testing/vma/linux/atomic.h                   |  17 -
+ tools/testing/vma/vma_internal.h                   |  85 ++-
+ 383 files changed, 8886 insertions(+), 4932 deletions(-)
+ create mode 100644 Documentation/mm/swap-table.rst
+ delete mode 100644 include/linux/zpool.h
+ create mode 100644 include/trace/events/readahead.h
+ create mode 100644 mm/swap_table.h
+ delete mode 100644 mm/zpool.c
+ create mode 100644 rust/helpers/maple_tree.c
+ create mode 100644 rust/kernel/maple_tree.rs
+ create mode 100755 tools/testing/selftests/damon/sysfs_no_op_commit_break.py
+ create mode 100644 tools/testing/selftests/mm/prctl_thp_disable.c
+ create mode 100644 tools/testing/selftests/mm/rmap.c
+ delete mode 100644 tools/testing/vma/linux/atomic.h
+Merging mm-nonmm-stable/mm-nonmm-stable (3437819c5e7a8 ocfs2: avoid extra calls to strlen() after ocfs2_sprintf_system_inode_name())
+$ git merge -m Merge branch 'mm-nonmm-stable' of https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm mm-nonmm-stable/mm-nonmm-stable
+Auto-merging Documentation/admin-guide/kernel-parameters.txt
+Auto-merging drivers/video/fbdev/core/fbcon.c
+Auto-merging fs/proc/base.c
+Auto-merging include/linux/sched/task.h
+Auto-merging init/main.c
+Auto-merging kernel/Makefile
+Auto-merging kernel/fork.c
+Auto-merging kernel/kexec_handover.c
+Auto-merging kernel/sys.c
+Auto-merging lib/alloc_tag.c
+Auto-merging tools/testing/selftests/proc/.gitignore
+Auto-merging tools/testing/selftests/proc/Makefile
+Merge made by the 'ort' strategy.
+ Documentation/accounting/delay-accounting.rst      |  89 ++--
+ Documentation/admin-guide/kernel-parameters.txt    |   2 +-
+ Documentation/admin-guide/sysctl/kernel.rst        |   2 +-
+ Documentation/dev-tools/kcov.rst                   |   7 +-
+ arch/x86/kernel/crash.c                            |  25 +-
+ arch/x86/kernel/kexec-bzimage64.c                  |  47 +-
+ drivers/firmware/efi/efi-init.c                    |  29 +-
+ drivers/video/fbdev/core/fbcon.c                   |   9 +-
+ fs/fat/dir.c                                       |   7 +-
+ fs/ocfs2/alloc.c                                   |   3 +-
+ fs/ocfs2/dlm/dlmmaster.c                           |  11 -
+ fs/ocfs2/dlm/dlmrecovery.c                         |   1 -
+ fs/ocfs2/inode.c                                   |   8 +
+ fs/ocfs2/ioctl.c                                   |  18 +-
+ fs/ocfs2/move_extents.c                            |   8 +-
+ fs/ocfs2/ocfs2_fs.h                                |   2 +-
+ fs/ocfs2/sysfile.c                                 |  12 +-
+ fs/proc/base.c                                     |   2 +-
+ fs/squashfs/inode.c                                |   4 +
+ include/linux/idr.h                                |   8 -
+ include/linux/kernel.h                             |  21 +-
+ include/linux/kexec.h                              |   5 +-
+ include/linux/kexec_handover.h                     |   6 +
+ include/linux/list.h                               |   8 +
+ include/linux/moduleparam.h                        |  13 +
+ include/linux/nvmem-provider.h                     |   2 +-
+ include/linux/panic.h                              |   6 +
+ include/linux/printk.h                             |   2 -
+ include/linux/sched/task.h                         |   5 +-
+ include/uapi/linux/kexec.h                         |   4 +
+ init/main.c                                        |  12 +
+ kernel/Kconfig.kexec                               |  11 +
+ kernel/Makefile                                    |   1 +
+ kernel/crash_core.c                                |  30 +-
+ kernel/crash_core_test.c                           | 343 +++++++++++++
+ kernel/fork.c                                      |  18 +-
+ kernel/hung_task.c                                 |  78 +--
+ kernel/kcov.c                                      |   9 +
+ kernel/kexec_core.c                                |   1 -
+ kernel/kexec_file.c                                |   1 +
+ kernel/kexec_handover.c                            |  20 +
+ kernel/panic.c                                     | 127 ++++-
+ kernel/printk/internal.h                           |   1 -
+ kernel/printk/nbcon.c                              |  14 +-
+ kernel/printk/printk.c                             |  37 +-
+ kernel/printk/printk_ringbuffer.c                  |   2 +-
+ kernel/sys.c                                       |  22 +-
+ kernel/watchdog.c                                  |  28 +-
+ kernel/watchdog_perf.c                             |   4 +
+ lib/alloc_tag.c                                    |   3 +-
+ lib/btree.c                                        |   4 +-
+ lib/decompress.c                                   |  21 +-
+ lib/digsig.c                                       |   1 -
+ lib/dump_stack.c                                   |   2 +-
+ lib/fault-inject-usercopy.c                        |   4 +-
+ lib/ref_tracker.c                                  |   6 +-
+ lib/sys_info.c                                     |   3 +-
+ lib/test_firmware.c                                |   7 +-
+ scripts/checkpatch.pl                              |   2 +-
+ scripts/coccinelle/api/platform_no_drv_owner.cocci |   9 +
+ scripts/coccinelle/misc/of_table.cocci             |  14 +-
+ tools/accounting/delaytop.c                        | 569 +++++++++++++++------
+ tools/testing/radix-tree/idr-test.c                |  16 +-
+ tools/testing/selftests/proc/.gitignore            |   1 +
+ tools/testing/selftests/proc/Makefile              |   1 +
+ tools/testing/selftests/proc/proc-net-dev-lseek.c  |  68 +++
+ tools/testing/selftests/proc/proc-pid-vm.c         |  12 +-
+ 67 files changed, 1427 insertions(+), 441 deletions(-)
+ create mode 100644 kernel/crash_core_test.c
+ create mode 100644 tools/testing/selftests/proc/proc-net-dev-lseek.c
+Merging mm-unstable/mm-unstable (32bb854337cd9 mm: swap: check for stable address space before operating on the VMA)
+$ git merge -m Merge branch 'mm-unstable' of https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm mm-unstable/mm-unstable
+Auto-merging mm/filemap.c
+Auto-merging mm/slub.c
+Merge made by the 'ort' strategy.
+ .../ABI/testing/sysfs-memory-page-offline          |   3 +
+ Documentation/admin-guide/sysctl/vm.rst            |  28 +++++-
+ drivers/base/node.c                                |   1 -
+ fs/hugetlbfs/inode.c                               |   9 ++
+ include/linux/ksm.h                                |   8 +-
+ include/linux/mm.h                                 |   2 +-
+ include/linux/page-flags.h                         |   5 +-
+ include/linux/rmap.h                               |   5 +
+ mm/Kconfig                                         |   1 -
+ mm/compaction.c                                    |   2 +-
+ mm/execmem.c                                       |   3 -
+ mm/filemap.c                                       |  15 +++
+ mm/hugetlb.c                                       |   9 +-
+ mm/khugepaged.c                                    | 101 ++++++++-----------
+ mm/ksm.c                                           |  20 ++--
+ mm/memory-failure.c                                |  17 +++-
+ mm/memory.c                                        |   9 +-
+ mm/memory_hotplug.c                                |   2 +-
+ mm/page_vma_mapped.c                               |   1 +
+ mm/rmap.c                                          | 109 ++++++++++++---------
+ mm/slub.c                                          |  18 ++--
+ mm/swapfile.c                                      |   3 +
+ tools/testing/selftests/mm/hugetlb-soft-offline.c  |  19 +++-
+ tools/testing/selftests/mm/ksm_functional_tests.c  |  43 +++++++-
+ 24 files changed, 276 insertions(+), 157 deletions(-)
+Merging mm-nonmm-unstable/mm-nonmm-unstable (05b21b507d8f8 Squashfs: reject negative file sizes in squashfs_read_inode())
+$ git merge -m Merge branch 'mm-nonmm-unstable' of https://git.kernel.org/pub/scm/linux/kernel/git/akpm/mm mm-nonmm-unstable/mm-nonmm-unstable
+Auto-merging .mailmap
+Auto-merging MAINTAINERS
+Auto-merging fs/cramfs/inode.c
+Auto-merging fs/ocfs2/stack_user.c
+Auto-merging kernel/kexec_handover.c
+Auto-merging kernel/sys.c
+Merge made by the 'ort' strategy.
+ .mailmap                       |   3 +-
+ MAINTAINERS                    |   2 +-
+ fs/cramfs/inode.c              |   2 +-
+ fs/ocfs2/stack_user.c          |   1 +
+ fs/squashfs/file.c             | 137 ++++++++++++++--
+ fs/squashfs/inode.c            |  35 +++-
+ fs/squashfs/squashfs.h         |   1 +
+ fs/squashfs/squashfs_fs.h      |   1 +
+ fs/squashfs/squashfs_fs_i.h    |   2 +-
+ include/linux/kexec_handover.h |  33 +++-
+ kernel/kallsyms_selftest.c     |   2 +-
+ kernel/kexec_handover.c        | 365 ++++++++++++++++++++++++++++++++++++-----
+ kernel/panic.c                 |   2 +-
+ kernel/sys.c                   |  10 ++
+ lib/Kconfig.debug              |   6 -
+ lib/genalloc.c                 |   5 +-
+ mm/memblock.c                  |   4 +-
+ scripts/checkpatch.pl          |  12 +-
+ 18 files changed, 543 insertions(+), 80 deletions(-)
+Merging kbuild/kbuild-next (2ea77fca84f07 modpost: Initialize builtin_modname to stop SIGSEGVs)
+$ git merge -m Merge branch 'kbuild-next' of https://git.kernel.org/pub/scm/linux/kernel/git/kbuild/linux.git kbuild/kbuild-next
+Auto-merging Makefile
+Auto-merging arch/arm64/Kconfig
+Auto-merging lib/Kconfig.debug
+Merge made by the 'ort' strategy.
+ .gitignore                                         |   2 +-
+ .../driver-api/early-userspace/buffer-format.rst   |   5 +
+ Documentation/kbuild/reproducible-builds.rst       |   3 +
+ Documentation/process/changes.rst                  |   2 +-
+ Makefile                                           |   8 +-
+ arch/Kconfig                                       |   1 -
+ arch/arm/Kconfig                                   |  11 +-
+ arch/arm64/Kconfig                                 |   5 +-
+ arch/mips/Kconfig                                  |   2 +-
+ arch/powerpc/include/asm/inst.h                    |   4 -
+ arch/riscv/Kconfig                                 |  21 +-
+ arch/riscv/Makefile                                |   9 +-
+ arch/s390/kernel/vmlinux.lds.S                     |  10 +-
+ drivers/scsi/BusLogic.c                            |   4 +-
+ include/asm-generic/vmlinux.lds.h                  |   2 +-
+ include/linux/module.h                             |  18 +-
+ init/initramfs_test.c                              |  67 +++++-
+ lib/Kconfig.debug                                  |   2 +-
+ lib/Kconfig.kcsan                                  |   6 -
+ lib/Kconfig.kmsan                                  |  11 +-
+ rust/kernel/device_id.rs                           |   8 +-
+ scripts/Makefile.extrawarn                         |  18 +-
+ scripts/Makefile.vmlinux                           |  79 ++++---
+ scripts/Makefile.vmlinux_o                         |  26 +--
+ scripts/extract-vmlinux                            |   8 +-
+ scripts/kconfig/nconf.gui.c                        |   8 +-
+ scripts/kconfig/qconf.cc                           |  13 ++
+ scripts/link-vmlinux.sh                            |   5 +-
+ scripts/min-tool-version.sh                        |   6 +-
+ scripts/misc-check                                 |   4 +-
+ scripts/mksysmap                                   |   6 +
+ scripts/mod/file2alias.c                           |  35 +++-
+ scripts/mod/modpost.c                              |  15 ++
+ scripts/mod/modpost.h                              |   2 +
+ tools/objtool/check.c                              |  10 -
+ tools/power/cpupower/.gitignore                    |   3 -
+ usr/gen_init_cpio.c                                | 233 ++++++++++++++-------
+ usr/gen_initramfs.sh                               |   7 +-
+ usr/include/Makefile                               |   4 +-
+ usr/include/headers_check.pl                       |   9 +-
+ 40 files changed, 432 insertions(+), 260 deletions(-)
+Merging clang-format/clang-format (c147f663b6a58 clang-format: Update with v6.11-rc1's `for_each` macro list)
+$ git merge -m Merge branch 'clang-format' of https://github.com/ojeda/linux.git clang-format/clang-format
+Already up to date.
+Merging perf/perf-tools-next (c17dda8013495 perf session: Fix handling when buffer exceeds 2 GiB)
+$ git merge -m Merge branch 'perf-tools-next' of https://git.kernel.org/pub/scm/linux/kernel/git/perf/perf-tools-next.git perf/perf-tools-next
+Merge made by the 'ort' strategy.
+ tools/arch/arm/include/uapi/asm/kvm.h              | 315 -------------
+ tools/arch/s390/include/uapi/asm/kvm_perf.h        |  22 -
+ tools/arch/x86/include/uapi/asm/kvm_perf.h         |  17 -
+ tools/lib/perf/include/perf/event.h                |   1 +
+ tools/perf/Documentation/perf-annotate.txt         |   1 -
+ tools/perf/Documentation/perf-arm-spe.txt          |  14 +-
+ tools/perf/Documentation/perf-bench.txt            |  58 ++-
+ tools/perf/Documentation/perf-list.txt             |   1 +
+ tools/perf/Documentation/perf-trace.txt            |   4 +
+ tools/perf/Documentation/perf.data-file-format.txt |  10 +
+ tools/perf/arch/arm64/util/arm-spe.c               |   5 +
+ tools/perf/arch/arm64/util/arm64_exception_types.h |  15 +-
+ tools/perf/arch/x86/util/evsel.c                   |  64 ++-
+ tools/perf/bench/bench.h                           |   1 +
+ tools/perf/bench/mem-functions.c                   | 390 +++++++++++----
+ tools/perf/bench/mem-memcpy-arch.h                 |   2 +-
+ tools/perf/bench/mem-memcpy-x86-64-asm-def.h       |   4 +
+ tools/perf/bench/mem-memset-arch.h                 |   2 +-
+ tools/perf/bench/mem-memset-x86-64-asm-def.h       |   4 +
+ tools/perf/builtin-annotate.c                      |   5 -
+ tools/perf/builtin-bench.c                         |   1 +
+ tools/perf/builtin-stat.c                          |  48 +-
+ tools/perf/builtin-trace.c                         |  14 +-
+ tools/perf/check-headers.sh                        |   3 -
+ tools/perf/perf.h                                  |   2 -
+ .../arch/arm64/ampere/ampereone/metrics.json       |   8 +-
+ .../arch/arm64/ampere/ampereonex/metrics.json      |  10 +-
+ .../pmu-events/arch/x86/alderlake/adl-metrics.json | 114 ++---
+ .../perf/pmu-events/arch/x86/alderlake/cache.json  |  99 ++--
+ .../arch/x86/alderlake/floating-point.json         |  28 +-
+ .../pmu-events/arch/x86/alderlake/frontend.json    |  42 +-
+ .../perf/pmu-events/arch/x86/alderlake/memory.json |  12 +-
+ .../perf/pmu-events/arch/x86/alderlake/other.json  |   8 +-
+ .../pmu-events/arch/x86/alderlake/pipeline.json    | 163 +++----
+ .../arch/x86/alderlake/uncore-interconnect.json    |   2 -
+ .../arch/x86/alderlake/virtual-memory.json         |  40 +-
+ .../arch/x86/alderlaken/adln-metrics.json          |  20 +-
+ .../arch/x86/alderlaken/uncore-interconnect.json   |   2 -
+ .../pmu-events/arch/x86/arrowlake/arl-metrics.json | 186 +++++---
+ .../perf/pmu-events/arch/x86/arrowlake/cache.json  | 122 +++--
+ .../pmu-events/arch/x86/arrowlake/frontend.json    |  40 +-
+ .../perf/pmu-events/arch/x86/arrowlake/memory.json |  22 +-
+ .../pmu-events/arch/x86/arrowlake/pipeline.json    |  94 ++--
+ .../pmu-events/arch/x86/broadwell/bdw-metrics.json |  30 +-
+ .../arch/x86/broadwellde/bdwde-metrics.json        |  30 +-
+ .../arch/x86/broadwellx/bdx-metrics.json           |  33 +-
+ .../arch/x86/cascadelakex/clx-metrics.json         | 143 ++++--
+ .../pmu-events/arch/x86/emeraldrapids/cache.json   | 100 ++--
+ .../arch/x86/emeraldrapids/emr-metrics.json        | 135 +++---
+ .../arch/x86/emeraldrapids/floating-point.json     |  43 +-
+ .../arch/x86/emeraldrapids/frontend.json           |  42 +-
+ .../pmu-events/arch/x86/emeraldrapids/memory.json  |  30 +-
+ .../pmu-events/arch/x86/emeraldrapids/other.json   |  28 +-
+ .../arch/x86/emeraldrapids/pipeline.json           | 167 +++----
+ .../arch/x86/emeraldrapids/uncore-memory.json      |  82 ++++
+ .../arch/x86/emeraldrapids/virtual-memory.json     |  40 +-
+ .../arch/x86/grandridge/grr-metrics.json           |  20 +-
+ .../pmu-events/arch/x86/graniterapids/cache.json   | 227 ++++++---
+ .../arch/x86/graniterapids/floating-point.json     |  43 +-
+ .../arch/x86/graniterapids/frontend.json           |  42 +-
+ .../arch/x86/graniterapids/gnr-metrics.json        | 135 +++---
+ .../pmu-events/arch/x86/graniterapids/memory.json  |  33 +-
+ .../pmu-events/arch/x86/graniterapids/other.json   |  30 +-
+ .../arch/x86/graniterapids/pipeline.json           | 167 +++----
+ .../arch/x86/graniterapids/uncore-io.json          |   1 -
+ .../arch/x86/graniterapids/uncore-memory.json      |  31 --
+ .../arch/x86/graniterapids/virtual-memory.json     |  40 +-
+ .../pmu-events/arch/x86/haswell/hsw-metrics.json   |  32 +-
+ .../pmu-events/arch/x86/haswellx/hsx-metrics.json  |  35 +-
+ .../pmu-events/arch/x86/icelake/icl-metrics.json   | 104 ++--
+ .../pmu-events/arch/x86/icelakex/icx-metrics.json  | 159 +++++--
+ .../pmu-events/arch/x86/ivybridge/ivb-metrics.json |  30 +-
+ .../pmu-events/arch/x86/ivytown/ivt-metrics.json   |  33 +-
+ .../pmu-events/arch/x86/jaketown/jkt-metrics.json  |  20 +-
+ .../perf/pmu-events/arch/x86/lunarlake/cache.json  | 104 +++-
+ .../pmu-events/arch/x86/lunarlake/frontend.json    |  40 +-
+ .../pmu-events/arch/x86/lunarlake/lnl-metrics.json | 222 +++++----
+ .../perf/pmu-events/arch/x86/lunarlake/memory.json |  22 +-
+ .../pmu-events/arch/x86/lunarlake/pipeline.json    |  85 ++--
+ .../arch/x86/lunarlake/uncore-interconnect.json    |  10 +
+ .../arch/x86/lunarlake/uncore-memory.json          |   8 +
+ tools/perf/pmu-events/arch/x86/mapfile.csv         |  16 +-
+ .../perf/pmu-events/arch/x86/meteorlake/cache.json | 129 +++--
+ .../arch/x86/meteorlake/floating-point.json        |  28 +-
+ .../pmu-events/arch/x86/meteorlake/frontend.json   |  42 +-
+ .../pmu-events/arch/x86/meteorlake/memory.json     |  15 +-
+ .../arch/x86/meteorlake/mtl-metrics.json           | 113 ++---
+ .../perf/pmu-events/arch/x86/meteorlake/other.json |   5 +-
+ .../pmu-events/arch/x86/meteorlake/pipeline.json   | 173 +++----
+ .../arch/x86/meteorlake/virtual-memory.json        |  40 +-
+ .../arch/x86/rocketlake/rkl-metrics.json           | 105 +++--
+ .../arch/x86/sandybridge/snb-metrics.json          |  19 +-
+ .../pmu-events/arch/x86/sapphirerapids/cache.json  | 100 ++--
+ .../arch/x86/sapphirerapids/floating-point.json    |  43 +-
+ .../arch/x86/sapphirerapids/frontend.json          |  42 +-
+ .../pmu-events/arch/x86/sapphirerapids/memory.json |  30 +-
+ .../pmu-events/arch/x86/sapphirerapids/other.json  |  28 +-
+ .../arch/x86/sapphirerapids/pipeline.json          | 167 +++----
+ .../arch/x86/sapphirerapids/spr-metrics.json       | 157 ++++---
+ .../arch/x86/sapphirerapids/uncore-memory.json     |  82 ++++
+ .../arch/x86/sapphirerapids/virtual-memory.json    |  40 +-
+ .../arch/x86/sierraforest/srf-metrics.json         |  20 +-
+ .../pmu-events/arch/x86/skylake/skl-metrics.json   | 109 +++--
+ .../pmu-events/arch/x86/skylakex/skx-metrics.json  | 109 +++--
+ .../pmu-events/arch/x86/tigerlake/tgl-metrics.json | 105 +++--
+ tools/perf/python/ilist.py                         | 495 +++++++++++++++++++
+ tools/perf/tests/perf-record.c                     |  38 +-
+ tools/perf/tests/shell/amd-ibs-swfilt.sh           |  51 +-
+ tools/perf/tests/shell/attr/test-stat-default      |   7 +
+ tools/perf/tests/shell/attr/test-stat-detailed-1   |   7 +
+ tools/perf/tests/shell/attr/test-stat-detailed-2   |   7 +
+ tools/perf/tests/shell/attr/test-stat-detailed-3   |   7 +
+ tools/perf/tests/shell/lock_contention.sh          |   7 +-
+ tools/perf/tests/shell/record_lbr.sh               |  26 +-
+ tools/perf/tests/shell/trace_btf_enum.sh           |  11 +
+ tools/perf/ui/browsers/annotate.c                  | 169 +++++--
+ tools/perf/ui/browsers/hists.c                     |   2 +-
+ tools/perf/util/annotate-data.c                    |   9 +
+ tools/perf/util/annotate.c                         | 178 +++++--
+ tools/perf/util/annotate.h                         |  29 +-
+ tools/perf/util/arm-spe-decoder/arm-spe-decoder.c  |  37 +-
+ tools/perf/util/arm-spe-decoder/arm-spe-decoder.h  |  33 +-
+ .../util/arm-spe-decoder/arm-spe-pkt-decoder.c     |  14 +
+ .../util/arm-spe-decoder/arm-spe-pkt-decoder.h     |   7 +
+ tools/perf/util/arm-spe.c                          | 271 +++++++----
+ tools/perf/util/arm-spe.h                          |   2 +
+ tools/perf/util/auxtrace.c                         |   5 +-
+ tools/perf/util/bpf-trace-summary.c                |  40 +-
+ tools/perf/util/bpf_skel/kwork_top.bpf.c           |   2 -
+ tools/perf/util/disasm.c                           |   7 +-
+ tools/perf/util/drm_pmu.c                          |   4 +-
+ tools/perf/util/dso.h                              |  21 +
+ tools/perf/util/dwarf-aux.c                        |  69 ++-
+ tools/perf/util/dwarf-aux.h                        |   2 +
+ tools/perf/util/evsel.c                            |   9 +-
+ tools/perf/util/evsel.h                            |   3 +-
+ tools/perf/util/hist.h                             |  12 +-
+ tools/perf/util/lzma.c                             |   2 +-
+ tools/perf/util/parse-events.c                     | 121 ++---
+ tools/perf/util/parse-events.h                     |   1 +
+ tools/perf/util/parse-events.l                     |   5 +-
+ tools/perf/util/python.c                           | 522 ++++++++++++++++++++-
+ tools/perf/util/session.c                          |   2 +-
+ tools/perf/util/symbol.c                           |   7 +-
+ tools/perf/util/tool_pmu.c                         |   3 -
+ tools/perf/util/tp_pmu.c                           |   2 -
+ tools/perf/util/trace.h                            |   4 +-
+ tools/perf/util/zlib.c                             |   2 +-
+ 148 files changed, 5273 insertions(+), 3287 deletions(-)
+ delete mode 100644 tools/arch/arm/include/uapi/asm/kvm.h
+ delete mode 100644 tools/arch/s390/include/uapi/asm/kvm_perf.h
+ delete mode 100644 tools/arch/x86/include/uapi/asm/kvm_perf.h
+ create mode 100644 tools/perf/pmu-events/arch/x86/lunarlake/uncore-interconnect.json
+ create mode 100755 tools/perf/python/ilist.py
+Merging compiler-attributes/compiler-attributes (98f7e32f20d28 Linux 6.11)
+$ git merge -m Merge branch 'compiler-attributes' of https://github.com/ojeda/linux.git compiler-attributes/compiler-attributes
+Already up to date.
+Merging dma-mapping/dma-mapping-for-next (ef3d979b3e270 kmsan: fix missed kmsan_handle_dma() signature conversion)
+$ git merge -m Merge branch 'dma-mapping-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mszyprowski/linux.git dma-mapping/dma-mapping-for-next
+Auto-merging include/linux/page-flags.h
+Auto-merging mm/hmm.c
+Merge made by the 'ort' strategy.
+ Documentation/core-api/dma-api.rst        |   4 +-
+ Documentation/core-api/dma-attributes.rst |  18 +++++
+ arch/powerpc/kernel/dma-iommu.c           |   4 +-
+ drivers/iommu/dma-iommu.c                 |  61 ++++++++--------
+ drivers/virtio/virtio_ring.c              |   4 +-
+ drivers/xen/swiotlb-xen.c                 |  21 +++++-
+ include/linux/dma-direct.h                |   2 -
+ include/linux/dma-map-ops.h               |   8 +--
+ include/linux/dma-mapping.h               |  33 +++++++++
+ include/linux/iommu-dma.h                 |  11 +--
+ include/linux/kmsan.h                     |   9 ++-
+ include/linux/page-flags.h                |   1 +
+ include/trace/events/dma.h                |   9 ++-
+ kernel/dma/debug.c                        |  82 ++++++----------------
+ kernel/dma/debug.h                        |  37 ++--------
+ kernel/dma/direct.c                       |  53 +++++---------
+ kernel/dma/direct.h                       |  55 +++++++++------
+ kernel/dma/mapping.c                      | 112 ++++++++++++++++++------------
+ kernel/dma/ops_helpers.c                  |   6 +-
+ kernel/dma/swiotlb.c                      |   2 +-
+ mm/hmm.c                                  |  19 ++---
+ mm/kmsan/hooks.c                          |  13 ++--
+ rust/kernel/dma.rs                        |   3 +
+ tools/virtio/linux/kmsan.h                |   2 +-
+ 24 files changed, 294 insertions(+), 275 deletions(-)
+Merging asm-generic/master (edcc8a38b5ac1 once: fix race by moving DO_ONCE to separate section)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/arnd/asm-generic asm-generic/master
+Auto-merging include/asm-generic/vmlinux.lds.h
+Merge made by the 'ort' strategy.
+ include/asm-generic/io.h          | 98 ++++++++++++++++++++++++++-------------
+ include/asm-generic/vmlinux.lds.h |  1 +
+ include/linux/once.h              |  4 +-
+ 3 files changed, 69 insertions(+), 34 deletions(-)
+Merging alpha/alpha-next (1523226edda56 alpha: Use str_yes_no() helper in pci_dac_dma_supported())
+$ git merge -m Merge branch 'alpha-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mattst88/alpha.git alpha/alpha-next
+Already up to date.
+Merging arm/for-next (015e1729c81b1 Merge branches 'fixes' and 'misc' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/rmk/linux.git arm/for-next
+Auto-merging arch/arm/Kconfig
+Merge made by the 'ort' strategy.
+ arch/arm/Kconfig               |  1 +
+ arch/arm/kernel/bios32.c       |  5 +++--
+ arch/arm/kernel/entry-ftrace.S | 18 ++++++++++++++----
+ arch/arm/mm/cache-l2x0.c       |  7 ++++---
+ arch/arm/mm/fault.c            |  3 +--
+ 5 files changed, 23 insertions(+), 11 deletions(-)
+Merging arm64/for-next/core (cb0c5a60a6f7d docs: perf: Fujitsu: Fix htmldocs build warnings and errors)
+$ git merge -m Merge branch 'for-next/core' of https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux arm64/for-next/core
+Auto-merging Documentation/admin-guide/kernel-parameters.txt
+Auto-merging MAINTAINERS
+Auto-merging arch/arm64/Kconfig
+CONFLICT (content): Merge conflict in arch/arm64/Kconfig
+Auto-merging arch/arm64/include/asm/sysreg.h
+Auto-merging arch/arm64/kernel/cpufeature.c
+Auto-merging arch/arm64/mm/mmu.c
+Auto-merging kernel/events/uprobes.c
+Auto-merging mm/pagewalk.c
+Resolved 'arch/arm64/Kconfig' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 9d412f49cc49c] Merge branch 'for-next/core' of https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux
+$ git diff -M --stat --summary HEAD^..
+ Documentation/admin-guide/kernel-parameters.txt    |   5 +-
+ Documentation/admin-guide/perf/dwc_pcie_pmu.rst    |   4 +-
+ .../admin-guide/perf/fujitsu_uncore_pmu.rst        | 115 ++++
+ Documentation/admin-guide/perf/hisi-pmu.rst        |  53 +-
+ Documentation/admin-guide/perf/index.rst           |   1 +
+ Documentation/arch/arm64/booting.rst               |  11 +
+ Documentation/arch/arm64/elf_hwcaps.rst            |   4 +
+ Documentation/arch/arm64/silicon-errata.rst        |   2 +
+ Documentation/arch/arm64/sme.rst                   |  14 +-
+ .../devicetree/bindings/perf/fsl-imx-ddr.yaml      |   1 +
+ MAINTAINERS                                        |   4 +-
+ arch/arm64/Kconfig                                 |  22 +-
+ arch/arm64/include/asm/cpufeature.h                |   2 +
+ arch/arm64/include/asm/cputype.h                   |   8 +-
+ arch/arm64/include/asm/daifflags.h                 |   2 +-
+ arch/arm64/include/asm/el2_setup.h                 |  28 +-
+ arch/arm64/include/asm/entry-common.h              |  57 ++
+ arch/arm64/include/asm/exception.h                 |   1 -
+ arch/arm64/include/asm/ftrace.h                    |   1 +
+ arch/arm64/include/asm/gcs.h                       |  91 ++-
+ arch/arm64/include/asm/hwcap.h                     |   1 +
+ arch/arm64/include/asm/io.h                        |   6 +-
+ arch/arm64/include/asm/mmu.h                       |   8 +
+ arch/arm64/include/asm/pgtable.h                   |   5 +
+ arch/arm64/include/asm/preempt.h                   |   2 -
+ arch/arm64/include/asm/ptdump.h                    |   2 +
+ arch/arm64/include/asm/ptrace.h                    |  13 +-
+ arch/arm64/include/asm/rsi.h                       |   2 +-
+ arch/arm64/include/asm/setup.h                     |   4 +-
+ arch/arm64/include/asm/sysreg.h                    |  11 -
+ arch/arm64/include/asm/uaccess.h                   |  40 --
+ arch/arm64/include/asm/vmalloc.h                   |   9 +-
+ arch/arm64/include/asm/xen/events.h                |   2 +-
+ arch/arm64/include/uapi/asm/hwcap.h                |   1 +
+ arch/arm64/kernel/acpi.c                           |  12 +-
+ arch/arm64/kernel/cpu_errata.c                     |   2 +
+ arch/arm64/kernel/cpufeature.c                     | 111 +---
+ arch/arm64/kernel/cpuinfo.c                        |   1 +
+ arch/arm64/kernel/debug-monitors.c                 |   2 +-
+ arch/arm64/kernel/entry-common.c                   | 423 +++++---------
+ arch/arm64/kernel/fpsimd.c                         |   5 +-
+ arch/arm64/kernel/pi/map_kernel.c                  |  47 +-
+ arch/arm64/kernel/pi/map_range.c                   |  20 +-
+ arch/arm64/kernel/pi/pi.h                          |   9 +-
+ arch/arm64/kernel/probes/decode-insn.c             |   7 +-
+ arch/arm64/kernel/probes/kprobes.c                 |  12 +
+ arch/arm64/kernel/probes/simulate-insn.c           |  50 +-
+ arch/arm64/kernel/probes/simulate-insn.h           |   3 +-
+ arch/arm64/kernel/probes/uprobes.c                 |  33 ++
+ arch/arm64/kernel/proton-pack.c                    |   1 +
+ arch/arm64/kernel/rsi.c                            |  26 +-
+ arch/arm64/kernel/sdei.c                           |   2 +-
+ arch/arm64/kernel/setup.c                          |   4 +-
+ arch/arm64/kernel/signal.c                         |   3 +-
+ arch/arm64/kernel/syscall.c                        |   2 +-
+ arch/arm64/kernel/vdso32/Makefile                  |  13 +-
+ arch/arm64/mm/init.c                               |   8 +-
+ arch/arm64/mm/mmu.c                                | 588 ++++++++++++++++++--
+ arch/arm64/mm/pageattr.c                           | 129 +++--
+ arch/arm64/mm/proc.S                               |  27 +-
+ arch/arm64/mm/ptdump.c                             |  11 +-
+ arch/arm64/tools/gen-sysreg.awk                    |  20 +
+ arch/arm64/tools/sysreg                            |  83 ++-
+ drivers/hwtracing/coresight/coresight-trbe.c       |   3 +-
+ drivers/perf/Kconfig                               |   9 +
+ drivers/perf/Makefile                              |   1 +
+ drivers/perf/arm-ccn.c                             |   2 +-
+ drivers/perf/arm-cmn.c                             |   9 +-
+ drivers/perf/arm_pmuv3.c                           |  29 +-
+ drivers/perf/arm_spe_pmu.c                         | 114 +++-
+ drivers/perf/dwc_pcie_pmu.c                        | 161 ++++--
+ drivers/perf/fsl_imx9_ddr_perf.c                   |   6 +
+ drivers/perf/fujitsu_uncore_pmu.c                  | 613 +++++++++++++++++++++
+ drivers/perf/hisilicon/Makefile                    |   3 +-
+ drivers/perf/hisilicon/hisi_uncore_l3c_pmu.c       | 557 +++++++++++++++----
+ drivers/perf/hisilicon/hisi_uncore_mn_pmu.c        | 411 ++++++++++++++
+ drivers/perf/hisilicon/hisi_uncore_noc_pmu.c       | 443 +++++++++++++++
+ drivers/perf/hisilicon/hisi_uncore_pmu.c           |   5 +-
+ drivers/perf/hisilicon/hisi_uncore_pmu.h           |   6 +-
+ drivers/virt/coco/efi_secret/Kconfig               |   2 +-
+ include/linux/pagewalk.h                           |   3 +
+ kernel/entry/common.c                              |  16 +-
+ kernel/events/uprobes.c                            |   2 +-
+ mm/pagewalk.c                                      |  36 +-
+ tools/testing/selftests/arm64/abi/hwcap.c          |  22 +-
+ tools/testing/selftests/arm64/abi/tpidr2.c         |   8 +-
+ tools/testing/selftests/arm64/bti/assembler.h      |   1 -
+ tools/testing/selftests/arm64/fp/fp-ptrace.c       |   1 -
+ tools/testing/selftests/arm64/fp/fp-stress.c       |   6 +-
+ tools/testing/selftests/arm64/fp/kernel-test.c     |   4 +-
+ tools/testing/selftests/arm64/fp/sve-ptrace.c      | 104 +++-
+ tools/testing/selftests/arm64/fp/vec-syscfg.c      |   1 -
+ tools/testing/selftests/arm64/fp/zt-ptrace.c       |   1 -
+ tools/testing/selftests/arm64/gcs/Makefile         |   6 +-
+ tools/testing/selftests/arm64/gcs/basic-gcs.c      |  12 +-
+ tools/testing/selftests/arm64/gcs/gcs-locking.c    |   1 -
+ tools/testing/selftests/arm64/gcs/gcs-stress.c     |   2 +-
+ tools/testing/selftests/arm64/pauth/exec_target.c  |   7 +-
+ 98 files changed, 3920 insertions(+), 873 deletions(-)
+ create mode 100644 Documentation/admin-guide/perf/fujitsu_uncore_pmu.rst
+ create mode 100644 arch/arm64/include/asm/entry-common.h
+ create mode 100644 drivers/perf/fujitsu_uncore_pmu.c
+ create mode 100644 drivers/perf/hisilicon/hisi_uncore_mn_pmu.c
+ create mode 100644 drivers/perf/hisilicon/hisi_uncore_noc_pmu.c
+Merging arm-perf/for-next/perf (2084660ad288c perf/dwc_pcie: Fix use of uninitialized variable)
+$ git merge -m Merge branch 'for-next/perf' of https://git.kernel.org/pub/scm/linux/kernel/git/will/linux.git arm-perf/for-next/perf
+Already up to date.
+Merging arm-soc/for-next (205ceac7f90a5 soc: document merges)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/soc/soc.git arm-soc/for-next
+Auto-merging Documentation/devicetree/bindings/vendor-prefixes.yaml
+Auto-merging MAINTAINERS
+Auto-merging arch/arm/Kconfig
+Auto-merging drivers/tty/serial/qcom_geni_serial.c
+Merge made by the 'ort' strategy.
+ Documentation/devicetree/bindings/arm/apple.yaml   |   41 +-
+ .../devicetree/bindings/arm/apple/apple,pmgr.yaml  |   33 +-
+ .../devicetree/bindings/arm/aspeed/aspeed.yaml     |    4 +
+ Documentation/devicetree/bindings/arm/axis.txt     |   13 -
+ Documentation/devicetree/bindings/arm/axis.yaml    |   36 +
+ .../devicetree/bindings/arm/bcm/brcm,bcm4708.yaml  |    1 +
+ .../bindings/arm/freescale/fsl,imx7ulp-pm.yaml     |    8 +
+ Documentation/devicetree/bindings/arm/fsl.yaml     |   50 +
+ .../devicetree/bindings/arm/intel-ixp4xx.yaml      |    2 +
+ .../devicetree/bindings/arm/keystone/keystone.txt  |   42 -
+ .../bindings/arm/marvell/armada-37xx.yaml          |    1 +
+ .../devicetree/bindings/arm/mediatek.yaml          |    2 +
+ .../devicetree/bindings/arm/nxp/lpc32xx.yaml       |    2 +-
+ .../devicetree/bindings/arm/qcom-soc.yaml          |    5 +-
+ Documentation/devicetree/bindings/arm/qcom.yaml    |  121 +-
+ .../devicetree/bindings/arm/rockchip.yaml          |   29 +
+ .../bindings/arm/samsung/samsung-boards.yaml       |    6 -
+ Documentation/devicetree/bindings/arm/sti.yaml     |    4 -
+ Documentation/devicetree/bindings/arm/sunxi.yaml   |   13 +
+ Documentation/devicetree/bindings/arm/tegra.yaml   |   12 +-
+ Documentation/devicetree/bindings/arm/ti/k3.yaml   |   13 +
+ .../devicetree/bindings/arm/ti/ti,keystone.yaml    |   42 +
+ .../bindings/cache/andestech,ax45mp-cache.yaml     |    6 +-
+ .../bindings/clock/allwinner,sun55i-a523-ccu.yaml  |   37 +-
+ .../devicetree/bindings/clock/apple,nco.yaml       |   17 +-
+ .../bindings/clock/qcom,ipq5424-apss-clk.yaml      |   55 +
+ .../bindings/cpufreq/apple,cluster-cpufreq.yaml    |    3 +
+ .../bindings/display/tegra/nvidia,tegra20-vi.yaml  |    3 -
+ .../display/tegra/nvidia,tegra210-csi.yaml         |    3 +
+ .../devicetree/bindings/dma/apple,admac.yaml       |   17 +-
+ .../devicetree/bindings/firmware/arm,scmi.yaml     |    2 +-
+ .../bindings/firmware/nxp,imx95-scmi.yaml          |   10 +-
+ .../devicetree/bindings/firmware/qcom,scm.yaml     |    3 +
+ .../devicetree/bindings/gpu/apple,agx.yaml         |    6 +
+ .../bindings/i2c/nvidia,tegra20-i2c.yaml           |    7 +
+ .../bindings/i2c/qcom,i2c-geni-qcom.yaml           |    1 +
+ .../bindings/interrupt-controller/apple,aic2.yaml  |    1 +
+ .../interrupt-controller/sifive,plic-1.0.0.yaml    |    1 +
+ .../devicetree/bindings/iommu/apple,dart.yaml      |   14 +-
+ .../devicetree/bindings/iommu/apple,sart.yaml      |    5 +-
+ .../devicetree/bindings/mailbox/apple,mailbox.yaml |    8 +
+ .../memory-controllers/brcm,brcmstb-memc-ddr.yaml  |    4 +
+ .../memory-controllers/nvidia,tegra210-emc.yaml    |   11 +
+ .../memory-controllers/starfive,jh7110-dmc.yaml    |   74 +
+ .../devicetree/bindings/mfd/apple,smc.yaml         |   17 +-
+ .../bindings/mmc/brcm,sdhci-brcmstb.yaml           |    2 +-
+ .../net/bluetooth/brcm,bcm4377-bluetooth.yaml      |    1 +
+ .../devicetree/bindings/net/can/bosch,m_can.yaml   |    3 +
+ .../bindings/net/wireless/brcm,bcm4329-fmac.yaml   |    1 +
+ .../devicetree/bindings/nvme/apple,nvme-ans.yaml   |   30 +-
+ .../devicetree/bindings/pinctrl/apple,pinctrl.yaml |   27 +-
+ .../pinctrl/renesas,r9a09g077-pinctrl.yaml         |  172 ++
+ .../bindings/power/apple,pmgr-pwrstate.yaml        |   27 +-
+ .../bindings/reset/brcm,bcm6345-reset.yaml         |    4 +-
+ Documentation/devicetree/bindings/riscv/cpus.yaml  |    1 +
+ Documentation/devicetree/bindings/riscv/eswin.yaml |   29 +
+ .../devicetree/bindings/riscv/extensions.yaml      |   18 +
+ .../devicetree/bindings/riscv/microchip.yaml       |   13 +
+ .../devicetree/bindings/riscv/spacemit.yaml        |    1 +
+ .../devicetree/bindings/riscv/starfive.yaml        |    2 +
+ .../bindings/serial/qcom,serial-geni-qcom.yaml     |    1 +
+ .../bindings/soc/imx/fsl,imx-iomuxc-gpr.yaml       |    1 +
+ .../bindings/soc/qcom/qcom,rpmh-rsc.yaml           |    2 +-
+ .../bindings/soc/qcom/qcom,se-common-props.yaml    |   26 +
+ .../devicetree/bindings/soc/renesas/renesas.yaml   |    6 +
+ .../devicetree/bindings/soc/rockchip/grf.yaml      |    3 +
+ .../bindings/soc/samsung/exynos-usi.yaml           |    1 +
+ .../devicetree/bindings/soc/xilinx/xilinx.yaml     |   81 +
+ .../devicetree/bindings/sound/apple,mca.yaml       |   17 +-
+ .../devicetree/bindings/spi/apple,spi.yaml         |   16 +-
+ .../bindings/spi/qcom,spi-geni-qcom.yaml           |    1 +
+ .../devicetree/bindings/spmi/apple,spmi.yaml       |   20 +-
+ .../devicetree/bindings/sram/qcom,imem.yaml        |    1 +
+ .../devicetree/bindings/vendor-prefixes.yaml       |    8 +
+ .../devicetree/bindings/watchdog/apple,wdt.yaml    |   27 +-
+ Documentation/process/maintainer-soc.rst           |    6 +-
+ Documentation/tee/index.rst                        |    1 +
+ Documentation/tee/qtee.rst                         |   96 +
+ MAINTAINERS                                        |   34 +-
+ arch/arm/Kconfig                                   |    2 -
+ arch/arm/Kconfig.platforms                         |   25 +
+ arch/arm/Makefile                                  |    1 -
+ arch/arm/arm-soc-for-next-contents.txt             |  226 ++
+ arch/arm/boot/dts/allwinner/Makefile               |   10 +
+ .../dts/allwinner/sun8i-h2-plus-orangepi-zero.dts  |   14 +
+ .../dts/allwinner/sun8i-h3-orangepi-zero-plus2.dts |   14 +
+ .../sun8i-orangepi-zero-interface-board.dtso       |   46 +
+ .../sun8i-t113s-netcube-nagami-basic-carrier.dts   |   67 +
+ .../sun8i-t113s-netcube-nagami-keypad-carrier.dts  |  129 ++
+ .../dts/allwinner/sun8i-t113s-netcube-nagami.dtsi  |  250 +++
+ arch/arm/boot/dts/aspeed/Makefile                  |    4 +
+ .../dts/aspeed/aspeed-bmc-ampere-mtjefferson.dts   |    2 +-
+ .../aspeed/aspeed-bmc-arm-stardragon4800-rep2.dts  |    2 +-
+ .../dts/aspeed/aspeed-bmc-asrock-e3c246d4i.dts     |   12 +-
+ .../dts/aspeed/aspeed-bmc-asrock-e3c256d4i.dts     |   12 +-
+ .../dts/aspeed/aspeed-bmc-asrock-romed8hm3.dts     |   12 +-
+ .../boot/dts/aspeed/aspeed-bmc-asrock-x570d4u.dts  |   18 +-
+ .../dts/aspeed/aspeed-bmc-facebook-catalina.dts    |    4 +-
+ .../dts/aspeed/aspeed-bmc-facebook-clemente.dts    | 1283 +++++++++++
+ .../boot/dts/aspeed/aspeed-bmc-facebook-darwin.dts |   72 +
+ .../boot/dts/aspeed/aspeed-bmc-facebook-elbert.dts |   12 +
+ .../dts/aspeed/aspeed-bmc-facebook-fuji-data64.dts | 1256 +++++++++++
+ .../boot/dts/aspeed/aspeed-bmc-facebook-fuji.dts   | 1247 +----------
+ .../boot/dts/aspeed/aspeed-bmc-facebook-harma.dts  |   43 +-
+ .../dts/aspeed/aspeed-bmc-facebook-minerva.dts     |   36 +-
+ .../aspeed/aspeed-bmc-facebook-santabarbara.dts    |    2 +-
+ .../dts/aspeed/aspeed-bmc-facebook-tiogapass.dts   |    2 +-
+ .../aspeed/aspeed-bmc-facebook-wedge400-data64.dts |  375 ++++
+ .../dts/aspeed/aspeed-bmc-facebook-wedge400.dts    |  366 +---
+ .../dts/aspeed/aspeed-bmc-facebook-yosemite4.dts   |   12 +-
+ .../arm/boot/dts/aspeed/aspeed-bmc-ibm-everest.dts |   24 +-
+ .../arm/boot/dts/aspeed/aspeed-bmc-ibm-rainier.dts |    2 +-
+ arch/arm/boot/dts/aspeed/aspeed-bmc-ibm-sbp1.dts   |    8 +-
+ .../boot/dts/aspeed/aspeed-bmc-inspur-fp5280g2.dts |    3 +-
+ .../boot/dts/aspeed/aspeed-bmc-lenovo-hr855xg2.dts |    4 +-
+ .../dts/aspeed/aspeed-bmc-nvidia-gb200nvl-bmc.dts  |   56 +-
+ .../arm/boot/dts/aspeed/aspeed-bmc-opp-lanyang.dts |    2 +-
+ arch/arm/boot/dts/aspeed/aspeed-bmc-opp-mowgli.dts |    2 +-
+ arch/arm/boot/dts/aspeed/aspeed-bmc-opp-nicole.dts |    3 +-
+ .../boot/dts/aspeed/aspeed-bmc-opp-palmetto.dts    |    4 +-
+ .../arm/boot/dts/aspeed/aspeed-bmc-opp-romulus.dts |    3 +-
+ .../boot/dts/aspeed/aspeed-bmc-opp-witherspoon.dts |    2 +-
+ arch/arm/boot/dts/aspeed/aspeed-bmc-opp-zaius.dts  |    4 +-
+ arch/arm/boot/dts/aspeed/aspeed-bmc-quanta-s6q.dts |    4 +-
+ arch/arm/boot/dts/aspeed/aspeed-bmc-vegman.dtsi    |    2 +-
+ arch/arm/boot/dts/aspeed/aspeed-g4.dtsi            |    1 -
+ arch/arm/boot/dts/aspeed/aspeed-g5.dtsi            |    2 -
+ arch/arm/boot/dts/aspeed/aspeed-g6-pinctrl.dtsi    |   10 +
+ arch/arm/boot/dts/aspeed/aspeed-g6.dtsi            |   10 +-
+ .../dts/aspeed/ast2600-facebook-netbmc-common.dtsi |   22 +-
+ .../facebook-bmc-flash-layout-128-data64.dtsi      |   60 +
+ arch/arm/boot/dts/aspeed/ibm-power10-dual.dtsi     |   12 +-
+ arch/arm/boot/dts/aspeed/ibm-power10-quad.dtsi     |   12 +-
+ arch/arm/boot/dts/broadcom/Makefile                |    1 +
+ .../dts/broadcom/bcm4708-buffalo-wxr-1750dhp.dts   |  138 ++
+ arch/arm/boot/dts/cirrus/ep7211-edb7211.dts        |    4 +-
+ arch/arm/boot/dts/intel/ixp/Makefile               |    2 +
+ .../ixp/intel-ixp42x-actiontec-mi424wr-ac.dts      |   37 +
+ .../intel/ixp/intel-ixp42x-actiontec-mi424wr-d.dts |   38 +
+ .../intel/ixp/intel-ixp42x-actiontec-mi424wr.dtsi  |  272 +++
+ .../boot/dts/microchip/at91-sama7d65_curiosity.dts |   53 +-
+ arch/arm/boot/dts/microchip/sam9x7.dtsi            |   21 +
+ arch/arm/boot/dts/microchip/sama7d65.dtsi          |   17 +-
+ .../boot/dts/nuvoton/nuvoton-common-npcm7xx.dtsi   |    2 +-
+ arch/arm/boot/dts/nuvoton/nuvoton-npcm750.dtsi     |    2 +-
+ arch/arm/boot/dts/nvidia/Makefile                  |    1 +
+ arch/arm/boot/dts/nvidia/tegra114.dtsi             |   33 +
+ arch/arm/boot/dts/nvidia/tegra20-asus-sl101.dts    |   61 +
+ arch/arm/boot/dts/nvidia/tegra20-asus-tf101.dts    | 1251 +----------
+ .../nvidia/tegra20-asus-transformer-common.dtsi    | 1268 +++++++++++
+ arch/arm/boot/dts/nvidia/tegra30-lg-p880.dts       |    4 +-
+ .../boot/dts/nxp/imx/imx35-eukrea-cpuimx35.dtsi    |    2 +-
+ .../boot/dts/nxp/imx/imx51-eukrea-cpuimx51.dtsi    |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx53-kp.dtsi            |    4 +-
+ arch/arm/boot/dts/nxp/imx/imx53-m53.dtsi           |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6dl-alti6p.dts        |    4 +-
+ .../boot/dts/nxp/imx/imx6dl-aristainetos2_4.dts    |   38 +-
+ .../boot/dts/nxp/imx/imx6dl-aristainetos2_7.dts    |   38 +-
+ arch/arm/boot/dts/nxp/imx/imx6dl-prtmvt.dts        |    1 -
+ arch/arm/boot/dts/nxp/imx/imx6dl-qmx6.dtsi         |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6dl-riotboard.dts     |    2 -
+ arch/arm/boot/dts/nxp/imx/imx6q-ba16.dtsi          |    2 +
+ arch/arm/boot/dts/nxp/imx/imx6q-bx50v3.dtsi        |    2 +-
+ .../imx/imx6q-display5-tianma-tm070-1280x768.dts   |   33 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-display5.dtsi      |   33 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-dmo-edmqmx6.dts    |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-dms-ba16.dts       |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-gw5400-a.dts       |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-h100.dts           |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-kp.dtsi            |    4 +-
+ arch/arm/boot/dts/nxp/imx/imx6q-mccmon6.dts        |    2 -
+ arch/arm/boot/dts/nxp/imx/imx6q-novena.dts         |    4 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-apalis.dtsi      |    4 +-
+ .../boot/dts/nxp/imx/imx6qdl-aristainetos2.dtsi    |   43 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-colibri.dtsi     |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-cubox-i.dtsi     |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-emcon.dtsi       |    4 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw51xx.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw52xx.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw53xx.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw54xx.dtsi      |   12 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw551x.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw552x.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw553x.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw560x.dtsi      |   11 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw5903.dtsi      |   11 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw5904.dtsi      |   11 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw5907.dtsi      |   13 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw5910.dtsi      |   11 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw5912.dtsi      |   10 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-gw5913.dtsi      |   11 +-
+ .../arm/boot/dts/nxp/imx/imx6qdl-hummingboard.dtsi |    1 -
+ arch/arm/boot/dts/nxp/imx/imx6qdl-nit6xlite.dtsi   |    4 +-
+ .../boot/dts/nxp/imx/imx6qdl-nitrogen6_max.dtsi    |   16 +-
+ .../boot/dts/nxp/imx/imx6qdl-nitrogen6_som2.dtsi   |   12 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-nitrogen6x.dtsi  |   12 +-
+ .../nxp/imx/imx6qdl-phytec-mira-peb-eval-01.dtsi   |   10 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-phytec-mira.dtsi |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-rex.dtsi         |    2 -
+ arch/arm/boot/dts/nxp/imx/imx6qdl-sabreauto.dtsi   |   10 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-sabrelite.dtsi   |   12 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-sabresd.dtsi     |    6 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-savageboard.dtsi |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-ts7970.dtsi      |    4 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-tx6.dtsi         |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6qdl-vicut1.dtsi      |    1 -
+ .../boot/dts/nxp/imx/imx6sl-tolino-shine2hd.dts    |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6sll.dtsi             |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx6sx-sdb.dtsi          |    4 +-
+ arch/arm/boot/dts/nxp/imx/imx6ul-14x14-evk.dtsi    |   25 +-
+ .../dts/nxp/imx/imx6ul-phytec-segin-peb-av-02.dtsi |    2 +-
+ .../nxp/imx/imx6ul-phytec-segin-peb-eval-01.dtsi   |    8 +-
+ arch/arm/boot/dts/nxp/imx/imx6ul-pico.dtsi         |    1 +
+ arch/arm/boot/dts/nxp/imx/imx6ul-tx6ul.dtsi        |   12 +-
+ .../boot/dts/nxp/imx/imx6ull-colibri-aster.dtsi    |    2 +-
+ .../arm/boot/dts/nxp/imx/imx6ull-colibri-iris.dtsi |    2 +-
+ .../dts/nxp/imx/imx6ull-engicam-microgea-rmm.dts   |    2 +-
+ .../arm/boot/dts/nxp/imx/imx6ull-phytec-tauri.dtsi |    6 +-
+ arch/arm/boot/dts/nxp/imx/imx6ulz-bsh-smm-m2.dts   |    4 +
+ arch/arm/boot/dts/nxp/imx/imx7d-nitrogen7.dts      |    2 +-
+ arch/arm/boot/dts/nxp/imx/imx7s-warp.dts           |    2 +-
+ arch/arm/boot/dts/nxp/imx/mba6ulx.dtsi             |    7 +
+ arch/arm/boot/dts/nxp/lpc/lpc18xx.dtsi             |   14 +-
+ arch/arm/boot/dts/nxp/lpc/lpc32xx.dtsi             |   11 +-
+ arch/arm/boot/dts/nxp/lpc/lpc4337-ciaa.dts         |    6 +-
+ arch/arm/boot/dts/nxp/lpc/lpc4350-hitex-eval.dts   |   22 +-
+ arch/arm/boot/dts/nxp/lpc/lpc4350.dtsi             |    9 +
+ .../arm/boot/dts/nxp/lpc/lpc4357-ea4357-devkit.dts |   21 +-
+ arch/arm/boot/dts/nxp/lpc/lpc4357-myd-lpc4357.dts  |    6 +-
+ arch/arm/boot/dts/nxp/lpc/lpc4357.dtsi             |    9 +
+ arch/arm/boot/dts/nxp/ls/ls1021a-qds.dts           |    8 +-
+ ...1021a-tqmls1021a-mbls1021a-rgb-cdtech-dc44.dtso |    2 +-
+ ...1021a-tqmls1021a-mbls1021a-rgb-cdtech-fc21.dtso |    2 +-
+ arch/arm/boot/dts/nxp/ls/ls1021a-tqmls1021a.dtsi   |    2 -
+ arch/arm/boot/dts/nxp/ls/ls1021a-tsn.dts           |    2 -
+ arch/arm/boot/dts/nxp/ls/ls1021a-twr.dts           |    2 +-
+ arch/arm/boot/dts/nxp/ls/ls1021a.dtsi              |   45 +-
+ arch/arm/boot/dts/nxp/vf/vf610-zii-dev-rev-b.dts   |    8 +-
+ arch/arm/boot/dts/nxp/vf/vf610-zii-dev.dtsi        |   14 +-
+ arch/arm/boot/dts/nxp/vf/vf610m4.dtsi              |    4 +
+ arch/arm/boot/dts/nxp/vf/vfxxx.dtsi                |    4 +-
+ arch/arm/boot/dts/qcom/Makefile                    |    1 +
+ arch/arm/boot/dts/qcom/pm8921.dtsi                 |    6 +
+ .../boot/dts/qcom/qcom-apq8064-lg-nexus4-mako.dts  |    6 +-
+ arch/arm/boot/dts/qcom/qcom-apq8064.dtsi           |    9 +-
+ arch/arm/boot/dts/qcom/qcom-ipq4019.dtsi           |    9 +-
+ arch/arm/boot/dts/qcom/qcom-ipq8064.dtsi           |   25 +-
+ .../boot/dts/qcom/qcom-msm8226-samsung-ms013g.dts  |    2 +
+ arch/arm/boot/dts/qcom/qcom-msm8960-pins.dtsi      |   40 +
+ .../dts/qcom/qcom-msm8960-samsung-expressatt.dts   |    5 +
+ .../boot/dts/qcom/qcom-msm8960-sony-huashan.dts    |  361 ++++
+ arch/arm/boot/dts/qcom/qcom-msm8960.dtsi           |   32 +
+ .../boot/dts/qcom/qcom-msm8974-samsung-hlte.dts    |   45 +
+ arch/arm/boot/dts/qcom/qcom-sdx55.dtsi             |    9 +-
+ arch/arm/boot/dts/renesas/r7s72100-genmai.dts      |    4 +-
+ arch/arm/boot/dts/renesas/r7s72100-gr-peach.dts    |    4 +-
+ arch/arm/boot/dts/renesas/r7s72100-rskrza1.dts     |    3 +
+ arch/arm/boot/dts/renesas/r7s72100.dtsi            |    3 +
+ arch/arm/boot/dts/renesas/r8a7791-porter.dts       |    2 +-
+ arch/arm/boot/dts/rockchip/rk3288-miqi.dts         |   22 +
+ arch/arm/boot/dts/samsung/exynos5250-smdk5250.dts  |   37 +
+ arch/arm/boot/dts/samsung/exynos5250.dtsi          |    9 +
+ arch/arm/boot/dts/samsung/exynos5410.dtsi          |    8 +-
+ .../arm/boot/dts/socionext/uniphier-pxs2-vodka.dts |    4 +-
+ arch/arm/boot/dts/st/Makefile                      |    2 -
+ arch/arm/boot/dts/st/ste-nomadik-s8815.dts         |    6 +-
+ .../boot/dts/st/ste-ux500-samsung-codina-tmo.dts   |    5 +-
+ arch/arm/boot/dts/st/ste-ux500-samsung-codina.dts  |    5 +-
+ arch/arm/boot/dts/st/ste-ux500-samsung-janice.dts  |    5 +-
+ arch/arm/boot/dts/st/stih407-b2120.dts             |   27 -
+ arch/arm/boot/dts/st/stih407-clock.dtsi            |  210 --
+ arch/arm/boot/dts/st/stih407-family.dtsi           |    4 +-
+ arch/arm/boot/dts/st/stih407.dtsi                  |  145 --
+ arch/arm/boot/dts/st/stih410-b2120.dts             |   66 -
+ arch/arm/boot/dts/st/stihxxx-b2120.dtsi            |  206 --
+ arch/arm/boot/dts/st/stm32mp131.dtsi               |    9 +
+ arch/arm/boot/dts/st/stm32mp133.dtsi               |    2 +
+ arch/arm/boot/dts/st/stm32mp15-pinctrl.dtsi        |   39 +
+ arch/arm/boot/dts/st/stm32mp151.dtsi               |    7 +
+ arch/arm/boot/dts/st/stm32mp151c-plyaqm.dts        |    4 +-
+ arch/arm/boot/dts/st/stm32mp153.dtsi               |    2 +
+ arch/arm/boot/dts/st/stm32mp157c-dk2.dts           |    8 +-
+ arch/arm/boot/dts/st/stm32mp157c-ed1.dts           |    2 +
+ arch/arm/boot/dts/st/stm32mp157c-ultra-fly-sbc.dts |    2 +-
+ arch/arm/boot/dts/st/stm32mp157f-dk2.dts           |    2 -
+ arch/arm/boot/dts/st/stm32mp15xc-lxa-tac.dtsi      |    2 +-
+ arch/arm/boot/dts/st/stm32mp15xx-dhcom-drc02.dtsi  |    1 -
+ arch/arm/boot/dts/st/stm32mp15xx-dhcom-pdk2.dtsi   |    3 -
+ arch/arm/boot/dts/st/stm32mp15xx-dhcom-som.dtsi    |    2 -
+ arch/arm/boot/dts/st/stm32mp15xx-dkx.dtsi          |    2 +
+ arch/arm/boot/dts/ti/omap/am335x-baltos.dtsi       |    2 +-
+ arch/arm/boot/dts/ti/omap/am335x-cm-t335.dts       |    2 -
+ arch/arm/boot/dts/ti/omap/am335x-myirtech-myd.dts  |    4 +-
+ arch/arm/boot/dts/ti/omap/am335x-sl50.dts          |    2 +-
+ arch/arm/boot/dts/ti/omap/am33xx-l4.dtsi           |   20 +-
+ arch/arm/boot/dts/ti/omap/am33xx.dtsi              |    8 +-
+ .../boot/dts/ti/omap/am57xx-beagle-x15-common.dtsi |    2 +-
+ arch/arm/boot/dts/ti/omap/dm814x.dtsi              |    8 +-
+ arch/arm/boot/dts/ti/omap/dm816x.dtsi              |    8 +-
+ arch/arm/boot/dts/ti/omap/dra7-l4.dtsi             |   14 +-
+ arch/arm/boot/dts/ti/omap/dra71-evm.dts            |   16 +-
+ .../boot/dts/ti/omap/omap3-devkit8000-common.dtsi  |    4 +-
+ .../dts/ti/omap/omap3-devkit8000-lcd-common.dtsi   |    2 +-
+ arch/arm/boot/dts/ti/omap/omap3-sbc-t3517.dts      |    4 +-
+ arch/arm/boot/dts/ti/omap/omap4-sdp.dts            |    2 +-
+ .../dts/ti/omap/omap4-var-om44customboard.dtsi     |    2 +-
+ arch/arm/configs/multi_v7_defconfig                |    4 -
+ arch/arm/configs/pxa_defconfig                     |    1 -
+ arch/arm/configs/qcom_defconfig                    |    4 -
+ arch/arm/configs/s3c6400_defconfig                 |    1 -
+ arch/arm/mach-at91/pm.c                            |    2 +-
+ arch/arm/mach-at91/pm_suspend.S                    |   41 +-
+ arch/arm/mach-hpe/Kconfig                          |   23 -
+ arch/arm/mach-hpe/Makefile                         |    1 -
+ arch/arm/mach-hpe/gxp.c                            |   15 -
+ arch/arm/mach-omap1/clock.c                        |   19 +-
+ arch/arm/mach-omap2/am33xx-restart.c               |   36 +
+ arch/arm/mach-omap2/board-n8x0.c                   |    2 +-
+ arch/arm/mach-omap2/clkt2xxx_virt_prcm_set.c       |   12 +-
+ arch/arm/mach-omap2/pm33xx-core.c                  |    6 +-
+ arch/arm/mach-omap2/powerdomain.c                  |    2 +-
+ arch/arm/mach-omap2/voltage.c                      |   12 +-
+ arch/arm/mach-omap2/vp.c                           |    4 +-
+ arch/arm/mach-rockchip/Kconfig                     |    2 +-
+ arch/arm/mach-shmobile/pm-rcar-gen2.c              |    2 +-
+ arch/arm/mach-sti/Kconfig                          |   20 +-
+ arch/arm/mach-sti/board-dt.c                       |    2 -
+ arch/arm64/Kconfig.platforms                       |   58 +-
+ arch/arm64/boot/dts/allwinner/Makefile             |    1 +
+ arch/arm64/boot/dts/allwinner/sun50i-h313-x96q.dts |  230 ++
+ arch/arm64/boot/dts/allwinner/sun55i-a523.dtsi     |   41 +
+ .../boot/dts/allwinner/sun55i-a527-cubie-a5e.dts   |   46 +-
+ .../boot/dts/allwinner/sun55i-t527-avaota-a1.dts   |   34 +
+ .../boot/dts/allwinner/sun55i-t527-orangepi-4a.dts |   31 +
+ arch/arm64/boot/dts/amazon/alpine-v2.dtsi          |    1 +
+ arch/arm64/boot/dts/amazon/alpine-v3.dtsi          |    1 +
+ arch/arm64/boot/dts/amlogic/amlogic-a4.dtsi        |   37 +
+ arch/arm64/boot/dts/amlogic/amlogic-c3.dtsi        |   41 +-
+ arch/arm64/boot/dts/amlogic/amlogic-s7.dtsi        |   36 +
+ arch/arm64/boot/dts/amlogic/amlogic-t7.dtsi        |   74 +
+ arch/arm64/boot/dts/amlogic/meson-a1.dtsi          |   15 +
+ arch/arm64/boot/dts/amlogic/meson-axg.dtsi         |   21 +
+ arch/arm64/boot/dts/amlogic/meson-g12a.dtsi        |   27 +
+ arch/arm64/boot/dts/amlogic/meson-g12b.dtsi        |   62 +-
+ arch/arm64/boot/dts/amlogic/meson-gx.dtsi          |   27 +
+ .../arm64/boot/dts/amlogic/meson-gxbb-odroidc2.dts |    4 -
+ arch/arm64/boot/dts/amlogic/meson-gxm.dtsi         |   24 +
+ .../arm64/boot/dts/amlogic/meson-sm1-bananapi.dtsi |    5 +-
+ arch/arm64/boot/dts/amlogic/meson-sm1.dtsi         |   27 +
+ arch/arm64/boot/dts/apm/apm-shadowcat.dtsi         |   40 +-
+ arch/arm64/boot/dts/apm/apm-storm.dtsi             |   75 +-
+ arch/arm64/boot/dts/apple/Makefile                 |    9 +
+ arch/arm64/boot/dts/apple/s5l8960x.dtsi            |   76 +
+ arch/arm64/boot/dts/apple/s800-0-3.dtsi            |   57 +
+ arch/arm64/boot/dts/apple/s8001.dtsi               |   76 +
+ arch/arm64/boot/dts/apple/t6000-j314s.dts          |    8 +
+ arch/arm64/boot/dts/apple/t6000-j316s.dts          |    8 +
+ arch/arm64/boot/dts/apple/t6001-j314c.dts          |    8 +
+ arch/arm64/boot/dts/apple/t6001-j316c.dts          |    8 +
+ arch/arm64/boot/dts/apple/t6001-j375c.dts          |    8 +
+ arch/arm64/boot/dts/apple/t6002-j375d.dts          |    8 +
+ arch/arm64/boot/dts/apple/t600x-die0.dtsi          |   35 +
+ arch/arm64/boot/dts/apple/t600x-j314-j316.dtsi     |   10 +
+ arch/arm64/boot/dts/apple/t600x-j375.dtsi          |   11 +
+ arch/arm64/boot/dts/apple/t6020-j414s.dts          |   26 +
+ arch/arm64/boot/dts/apple/t6020-j416s.dts          |   26 +
+ arch/arm64/boot/dts/apple/t6020-j474s.dts          |   47 +
+ arch/arm64/boot/dts/apple/t6020.dtsi               |   22 +
+ arch/arm64/boot/dts/apple/t6021-j414c.dts          |   26 +
+ arch/arm64/boot/dts/apple/t6021-j416c.dts          |   26 +
+ arch/arm64/boot/dts/apple/t6021-j475c.dts          |   37 +
+ arch/arm64/boot/dts/apple/t6021.dtsi               |   69 +
+ arch/arm64/boot/dts/apple/t6022-j180d.dts          |  121 ++
+ arch/arm64/boot/dts/apple/t6022-j475d.dts          |   42 +
+ arch/arm64/boot/dts/apple/t6022-jxxxd.dtsi         |   38 +
+ arch/arm64/boot/dts/apple/t6022.dtsi               |  349 +++
+ arch/arm64/boot/dts/apple/t602x-common.dtsi        |  465 ++++
+ arch/arm64/boot/dts/apple/t602x-die0.dtsi          |  575 +++++
+ arch/arm64/boot/dts/apple/t602x-dieX.dtsi          |  128 ++
+ arch/arm64/boot/dts/apple/t602x-gpio-pins.dtsi     |   81 +
+ arch/arm64/boot/dts/apple/t602x-j414-j416.dtsi     |   45 +
+ arch/arm64/boot/dts/apple/t602x-j474-j475.dtsi     |   38 +
+ arch/arm64/boot/dts/apple/t602x-nvme.dtsi          |   42 +
+ arch/arm64/boot/dts/apple/t602x-pmgr.dtsi          | 2265 ++++++++++++++++++++
+ arch/arm64/boot/dts/apple/t7000.dtsi               |   76 +
+ arch/arm64/boot/dts/apple/t7001.dtsi               |   76 +
+ arch/arm64/boot/dts/apple/t8010.dtsi               |   76 +
+ arch/arm64/boot/dts/apple/t8011.dtsi               |   76 +
+ arch/arm64/boot/dts/apple/t8012.dtsi               |    8 +
+ arch/arm64/boot/dts/apple/t8015-pmgr.dtsi          |    1 +
+ arch/arm64/boot/dts/apple/t8015.dtsi               |  118 +
+ arch/arm64/boot/dts/apple/t8103-j457.dts           |   12 +-
+ arch/arm64/boot/dts/apple/t8103.dtsi               |   35 +
+ arch/arm64/boot/dts/apple/t8112-j415.dts           |   80 +
+ arch/arm64/boot/dts/apple/t8112.dtsi               |   35 +
+ .../boot/dts/broadcom/bcm2712-rpi-5-b-ovl-rp1.dts  |  133 ++
+ arch/arm64/boot/dts/broadcom/bcm2712-rpi-5-b.dts   |   41 +-
+ arch/arm64/boot/dts/broadcom/bcm2712.dtsi          |   56 +
+ arch/arm64/boot/dts/broadcom/rp1-common.dtsi       |   44 +
+ arch/arm64/boot/dts/cix/sky1.dtsi                  |  100 +
+ arch/arm64/boot/dts/exynos/Makefile                |    1 +
+ arch/arm64/boot/dts/exynos/axis/Makefile           |    4 +
+ arch/arm64/boot/dts/exynos/axis/artpec-pinctrl.h   |   36 +
+ .../arm64/boot/dts/exynos/axis/artpec8-grizzly.dts |   35 +
+ .../boot/dts/exynos/axis/artpec8-pinctrl.dtsi      |  120 ++
+ arch/arm64/boot/dts/exynos/axis/artpec8.dtsi       |  244 +++
+ arch/arm64/boot/dts/exynos/exynos2200-pinctrl.dtsi |    2 +-
+ arch/arm64/boot/dts/exynos/exynos2200.dtsi         | 1434 ++++++++++++-
+ arch/arm64/boot/dts/exynos/exynos5433.dtsi         |    1 +
+ arch/arm64/boot/dts/exynos/exynos850-e850-96.dts   |   15 +
+ arch/arm64/boot/dts/exynos/exynos8895-pinctrl.dtsi |    2 +-
+ arch/arm64/boot/dts/exynos/exynos990-c1s.dts       |   16 +
+ arch/arm64/boot/dts/exynos/exynos990-r8s.dts       |   16 +
+ .../boot/dts/exynos/exynos990-x1s-common.dtsi      |   16 +
+ arch/arm64/boot/dts/exynos/exynos990.dtsi          |   77 +
+ arch/arm64/boot/dts/exynos/google/gs101.dtsi       |    1 +
+ arch/arm64/boot/dts/freescale/Makefile             |   14 +
+ .../fsl-ls1012a-tqmls1012al-mbls1012al-emmc.dts    |   23 +
+ .../fsl-ls1012a-tqmls1012al-mbls1012al.dts         |  366 ++++
+ .../dts/freescale/fsl-ls1012a-tqmls1012al.dtsi     |   81 +
+ arch/arm64/boot/dts/freescale/fsl-ls1012a.dtsi     |    1 +
+ arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi     |    1 +
+ arch/arm64/boot/dts/freescale/fsl-ls1046a.dtsi     |    1 +
+ .../arm64/boot/dts/freescale/fsl-lx2160a-cex7.dtsi |    2 +
+ .../dts/freescale/fsl-lx2160a-clearfog-itx.dtsi    |    8 +
+ .../arm64/boot/dts/freescale/imx8-apalis-v1.1.dtsi |    2 +-
+ arch/arm64/boot/dts/freescale/imx8-ss-hsio.dtsi    |    8 +-
+ arch/arm64/boot/dts/freescale/imx8dxl-evk.dts      |    2 +-
+ arch/arm64/boot/dts/freescale/imx8dxl-ss-conn.dtsi |    2 +
+ arch/arm64/boot/dts/freescale/imx8dxl-ss-hsio.dtsi |    8 +-
+ arch/arm64/boot/dts/freescale/imx8dxl.dtsi         |    1 +
+ .../boot/dts/freescale/imx8mm-emtop-baseboard.dts  |    2 +-
+ arch/arm64/boot/dts/freescale/imx8mm-evk.dtsi      |   17 +-
+ .../boot/dts/freescale/imx8mm-kontron-bl-lte.dtso  |  186 ++
+ .../boot/dts/freescale/imx8mm-kontron-bl-osm-s.dts |    8 -
+ .../arm64/boot/dts/freescale/imx8mm-kontron-bl.dts |   12 +-
+ .../boot/dts/freescale/imx8mm-kontron-dl.dtso      |   13 +-
+ .../boot/dts/freescale/imx8mm-kontron-osm-s.dtsi   |   50 +-
+ .../freescale/imx8mm-phyboard-polis-peb-av-10.dtso |    2 +-
+ .../boot/dts/freescale/imx8mm-phycore-som.dtsi     |    8 +-
+ arch/arm64/boot/dts/freescale/imx8mm.dtsi          |    1 +
+ arch/arm64/boot/dts/freescale/imx8mn-evk.dtsi      |    5 +
+ .../freescale/imx8mp-aristainetos3-proton2s.dts    |    2 +-
+ .../freescale/imx8mp-aristainetos3a-som-v1.dtsi    |    6 +-
+ arch/arm64/boot/dts/freescale/imx8mp-cubox-m.dts   |  223 ++
+ arch/arm64/boot/dts/freescale/imx8mp-edm-g-wb.dts  |  359 ++++
+ arch/arm64/boot/dts/freescale/imx8mp-edm-g.dtsi    |  786 +++++++
+ arch/arm64/boot/dts/freescale/imx8mp-evk.dts       |    2 +-
+ .../dts/freescale/imx8mp-hummingboard-mate.dts     |   31 +
+ .../boot/dts/freescale/imx8mp-hummingboard-pro.dts |   76 +
+ .../freescale/imx8mp-hummingboard-pulse-codec.dtsi |   59 +
+ .../imx8mp-hummingboard-pulse-common.dtsi          |  384 ++++
+ .../freescale/imx8mp-hummingboard-pulse-hdmi.dtsi  |   44 +
+ .../freescale/imx8mp-hummingboard-pulse-m2con.dtsi |   60 +
+ .../imx8mp-hummingboard-pulse-mini-hdmi.dtsi       |   81 +
+ .../dts/freescale/imx8mp-hummingboard-pulse.dts    |   83 +
+ .../dts/freescale/imx8mp-hummingboard-ripple.dts   |   31 +
+ .../boot/dts/freescale/imx8mp-kontron-bl-osm-s.dts |   59 +-
+ .../boot/dts/freescale/imx8mp-skov-revb-lt6.dts    |    2 +-
+ arch/arm64/boot/dts/freescale/imx8mp-sr-som.dtsi   |  591 +++++
+ .../imx8mp-tx8p-ml81-moduline-display-106.dts      |   46 +-
+ .../boot/dts/freescale/imx8mp-ultra-mach-sbc.dts   |  907 ++++++++
+ arch/arm64/boot/dts/freescale/imx8mp.dtsi          |   23 +-
+ arch/arm64/boot/dts/freescale/imx8mq-evk.dts       |    8 +-
+ arch/arm64/boot/dts/freescale/imx8mq.dtsi          |    1 +
+ arch/arm64/boot/dts/freescale/imx8qm-mek.dts       |    4 +-
+ arch/arm64/boot/dts/freescale/imx8qm-ss-hsio.dtsi  |   16 +-
+ arch/arm64/boot/dts/freescale/imx8qm.dtsi          |    1 +
+ arch/arm64/boot/dts/freescale/imx8qxp-mek.dts      |    2 +-
+ arch/arm64/boot/dts/freescale/imx8qxp.dtsi         |    1 +
+ arch/arm64/boot/dts/freescale/imx8ulp-9x9-evk.dts  |   69 +
+ arch/arm64/boot/dts/freescale/imx8x-colibri.dtsi   |    4 +-
+ arch/arm64/boot/dts/freescale/imx91-11x11-evk.dts  |  674 ++++++
+ arch/arm64/boot/dts/freescale/imx91-pinfunc.h      |  770 +++++++
+ .../dts/freescale/imx91-tqma9131-mba91xxca.dts     |  739 +++++++
+ arch/arm64/boot/dts/freescale/imx91-tqma9131.dtsi  |  295 +++
+ arch/arm64/boot/dts/freescale/imx91.dtsi           |   71 +
+ arch/arm64/boot/dts/freescale/imx91_93_common.dtsi | 1187 ++++++++++
+ arch/arm64/boot/dts/freescale/imx93-11x11-evk.dts  |   20 +-
+ arch/arm64/boot/dts/freescale/imx93-14x14-evk.dts  |   19 +-
+ arch/arm64/boot/dts/freescale/imx93-9x9-qsb.dts    |   18 +
+ .../boot/dts/freescale/imx93-kontron-bl-osm-s.dts  |   53 +-
+ .../boot/dts/freescale/imx93-kontron-osm-s.dtsi    |    9 +
+ .../boot/dts/freescale/imx93-phyboard-nash.dts     |   35 +
+ .../boot/dts/freescale/imx93-phyboard-segin.dts    |    9 +
+ .../boot/dts/freescale/imx93-phycore-som.dtsi      |   12 +-
+ .../dts/freescale/imx93-tqma9352-mba91xxca.dts     |   11 +
+ .../dts/freescale/imx93-tqma9352-mba93xxca.dts     |   25 +
+ .../dts/freescale/imx93-tqma9352-mba93xxla.dts     |   25 +
+ .../boot/dts/freescale/imx93-var-som-symphony.dts  |   17 +
+ arch/arm64/boot/dts/freescale/imx93.dtsi           | 1430 +-----------
+ arch/arm64/boot/dts/freescale/imx94.dtsi           |    6 +-
+ arch/arm64/boot/dts/freescale/imx95-15x15-evk.dts  |   30 +-
+ arch/arm64/boot/dts/freescale/imx95-19x19-evk.dts  |   99 +-
+ arch/arm64/boot/dts/freescale/imx95.dtsi           |  207 +-
+ arch/arm64/boot/dts/freescale/s32g2.dtsi           |  126 ++
+ arch/arm64/boot/dts/freescale/s32g274a-rdb2.dts    |   20 +
+ arch/arm64/boot/dts/freescale/s32g3.dtsi           |  202 ++
+ arch/arm64/boot/dts/freescale/s32g399a-rdb3.dts    |   36 +
+ arch/arm64/boot/dts/intel/socfpga_agilex5.dtsi     |  336 +++
+ .../arm64/boot/dts/intel/socfpga_agilex5_socdk.dts |   20 +
+ arch/arm64/boot/dts/marvell/Makefile               |    1 +
+ arch/arm64/boot/dts/marvell/ac5-98dx25xx.dtsi      |    2 +-
+ .../boot/dts/marvell/armada-3720-atlas-v5.dts      |  110 +
+ arch/arm64/boot/dts/marvell/armada-37xx.dtsi       |    1 +
+ arch/arm64/boot/dts/marvell/armada-cp11x.dtsi      |    1 +
+ arch/arm64/boot/dts/marvell/cn9130-sr-som.dtsi     |    2 +
+ arch/arm64/boot/dts/marvell/cn9132-clearfog.dts    |    4 +-
+ arch/arm64/boot/dts/marvell/cn9132-sr-cex7.dtsi    |    2 +-
+ arch/arm64/boot/dts/mediatek/mt6331.dtsi           |   10 +-
+ arch/arm64/boot/dts/mediatek/mt6755.dtsi           |    2 +-
+ arch/arm64/boot/dts/mediatek/mt6779.dtsi           |    2 +-
+ .../boot/dts/mediatek/mt6795-sony-xperia-m5.dts    |   40 +-
+ arch/arm64/boot/dts/mediatek/mt6795.dtsi           |    3 +-
+ arch/arm64/boot/dts/mediatek/mt6797.dtsi           |   52 +-
+ arch/arm64/boot/dts/mediatek/mt7981b.dtsi          |   31 +-
+ .../dts/mediatek/mt7986a-acelink-ew-7886cax.dts    |    2 -
+ .../boot/dts/mediatek/mt7986a-bananapi-bpi-r3.dts  |   11 +-
+ arch/arm64/boot/dts/mediatek/mt7986a.dtsi          |   32 +-
+ .../dts/mediatek/mt7988a-bananapi-bpi-r4-2g5.dts   |   11 +
+ .../boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dts  |   19 +
+ .../boot/dts/mediatek/mt7988a-bananapi-bpi-r4.dtsi |   86 +
+ arch/arm64/boot/dts/mediatek/mt7988a.dtsi          |  285 ++-
+ .../dts/mediatek/mt8183-kukui-audio-da7219.dtsi    |    4 +-
+ .../dts/mediatek/mt8183-kukui-audio-ts3a227e.dtsi  |    2 +-
+ .../boot/dts/mediatek/mt8183-kukui-jacuzzi.dtsi    |   27 +-
+ .../boot/dts/mediatek/mt8183-kukui-kakadu.dtsi     |   43 +-
+ .../boot/dts/mediatek/mt8183-kukui-kodama.dtsi     |   40 +-
+ .../boot/dts/mediatek/mt8183-kukui-krane.dtsi      |   40 +-
+ arch/arm64/boot/dts/mediatek/mt8183-kukui.dtsi     |  115 +-
+ arch/arm64/boot/dts/mediatek/mt8183-pumpkin.dts    |   28 +-
+ arch/arm64/boot/dts/mediatek/mt8183.dtsi           |  239 ++-
+ .../boot/dts/mediatek/mt8186-corsola-krabby.dtsi   |    8 +-
+ .../mt8186-corsola-tentacruel-sku262144.dts        |    4 +
+ arch/arm64/boot/dts/mediatek/mt8188-geralt.dtsi    |   25 +
+ arch/arm64/boot/dts/mediatek/mt8188.dtsi           |    2 +-
+ .../boot/dts/mediatek/mt8195-cherry-tomato-r1.dts  |    1 +
+ .../boot/dts/mediatek/mt8195-cherry-tomato-r2.dts  |    1 +
+ arch/arm64/boot/dts/mediatek/mt8195-cherry.dtsi    |    3 +-
+ arch/arm64/boot/dts/mediatek/mt8195.dtsi           |   33 +-
+ .../dts/mediatek/mt8395-kontron-3-5-sbc-i1200.dts  |   16 +-
+ .../boot/dts/mediatek/mt8395-radxa-nio-12l.dts     |   46 +
+ arch/arm64/boot/dts/mediatek/mt8516-pumpkin.dts    |    2 +-
+ arch/arm64/boot/dts/mediatek/pumpkin-common.dtsi   |   18 +-
+ .../boot/dts/nuvoton/nuvoton-common-npcm8xx.dtsi   |  669 +++++-
+ .../arm64/boot/dts/nuvoton/nuvoton-npcm845-evb.dts |    6 +
+ arch/arm64/boot/dts/nvidia/tegra264.dtsi           |  225 ++
+ arch/arm64/boot/dts/qcom/Makefile                  |   23 +-
+ arch/arm64/boot/dts/qcom/apq8016-sbc.dts           |    6 +-
+ arch/arm64/boot/dts/qcom/hamoa-iot-evk.dts         | 1222 +++++++++++
+ arch/arm64/boot/dts/qcom/hamoa-iot-som.dtsi        |  619 ++++++
+ arch/arm64/boot/dts/qcom/ipq5018-rdp432-c2.dts     |    3 +-
+ .../dts/qcom/ipq5018-tplink-archer-ax55-v1.dts     |    3 +-
+ arch/arm64/boot/dts/qcom/ipq5018.dtsi              |  381 +++-
+ arch/arm64/boot/dts/qcom/ipq5332.dtsi              |   16 +-
+ arch/arm64/boot/dts/qcom/ipq5424-rdp466.dts        |   44 +-
+ arch/arm64/boot/dts/qcom/ipq5424.dtsi              |  144 +-
+ arch/arm64/boot/dts/qcom/ipq6018.dtsi              |    8 +-
+ arch/arm64/boot/dts/qcom/ipq8074.dtsi              |   16 +-
+ arch/arm64/boot/dts/qcom/ipq9574-rdp433.dts        |   32 -
+ arch/arm64/boot/dts/qcom/ipq9574.dtsi              |   34 +-
+ arch/arm64/boot/dts/qcom/lemans-auto.dtsi          |  104 +
+ .../dts/qcom/lemans-evk-camera-csi1-imx577.dtso    |   97 +
+ arch/arm64/boot/dts/qcom/lemans-evk.dts            |  776 +++++++
+ .../qcom/{sa8775p-pmics.dtsi => lemans-pmics.dtsi} |    0
+ .../{sa8775p-ride.dtsi => lemans-ride-common.dtsi} |  183 +-
+ .../dts/qcom/lemans-ride-ethernet-88ea1512.dtsi    |  205 ++
+ .../dts/qcom/lemans-ride-ethernet-aqr115c.dtsi     |  205 ++
+ .../boot/dts/qcom/{sa8775p.dtsi => lemans.dtsi}    |  966 +++++++--
+ arch/arm64/boot/dts/qcom/monaco-evk.dts            |  507 +++++
+ arch/arm64/boot/dts/qcom/msm8916.dtsi              |   12 +-
+ arch/arm64/boot/dts/qcom/msm8939.dtsi              |    2 +
+ .../arm64/boot/dts/qcom/msm8953-flipkart-rimob.dts |  255 +++
+ arch/arm64/boot/dts/qcom/msm8953-xiaomi-daisy.dts  |    2 +-
+ arch/arm64/boot/dts/qcom/msm8953.dtsi              |  162 +-
+ .../boot/dts/qcom/msm8976-longcheer-l9360.dts      |    6 +
+ arch/arm64/boot/dts/qcom/msm8996.dtsi              |   25 +-
+ arch/arm64/boot/dts/qcom/msm8998.dtsi              |    6 +-
+ arch/arm64/boot/dts/qcom/pmk8550.dtsi              |    2 +-
+ arch/arm64/boot/dts/qcom/qcm2290.dtsi              |  112 +
+ arch/arm64/boot/dts/qcom/qcm6490-fairphone-fp5.dts |   22 +-
+ arch/arm64/boot/dts/qcom/qcm6490-idp.dts           |  214 +-
+ .../boot/dts/qcom/qcm6490-particle-tachyon.dts     |  864 ++++++++
+ arch/arm64/boot/dts/qcom/qcm6490-shift-otter.dts   |    6 +-
+ arch/arm64/boot/dts/qcom/qcs404.dtsi               |    1 +
+ arch/arm64/boot/dts/qcom/qcs615-ride.dts           |  192 +-
+ arch/arm64/boot/dts/qcom/qcs6490-audioreach.dtsi   |  119 +
+ arch/arm64/boot/dts/qcom/qcs6490-rb3gen2.dts       |   88 +-
+ arch/arm64/boot/dts/qcom/qcs8300-ride.dts          |   41 +-
+ arch/arm64/boot/dts/qcom/qcs8300.dtsi              |  689 +++++-
+ arch/arm64/boot/dts/qcom/qcs9100-ride-r3.dts       |    9 +-
+ arch/arm64/boot/dts/qcom/qcs9100-ride.dts          |    9 +-
+ arch/arm64/boot/dts/qcom/qrb2210-rb1.dts           |    9 +-
+ arch/arm64/boot/dts/qcom/qrb4210-rb2.dts           |    5 +-
+ arch/arm64/boot/dts/qcom/qrb5165-rb5.dts           |   12 +-
+ arch/arm64/boot/dts/qcom/sa8295p-adp.dts           |   96 +-
+ arch/arm64/boot/dts/qcom/sa8775p-ride-r3.dts       |   40 +-
+ arch/arm64/boot/dts/qcom/sa8775p-ride.dts          |   40 +-
+ arch/arm64/boot/dts/qcom/sar2130p.dtsi             |   49 +-
+ arch/arm64/boot/dts/qcom/sc7180-acer-aspire1.dts   |    6 +-
+ arch/arm64/boot/dts/qcom/sc7180-idp.dts            |   12 +-
+ .../dts/qcom/sc7180-trogdor-quackingstick.dtsi     |   12 +-
+ .../boot/dts/qcom/sc7180-trogdor-wormdingler.dtsi  |   12 +-
+ arch/arm64/boot/dts/qcom/sc7180.dtsi               |   56 +-
+ arch/arm64/boot/dts/qcom/sc7280-chrome-common.dtsi |    5 -
+ arch/arm64/boot/dts/qcom/sc7280-herobrine.dtsi     |    6 +-
+ arch/arm64/boot/dts/qcom/sc7280-idp.dts            |    6 +-
+ arch/arm64/boot/dts/qcom/sc7280-idp.dtsi           |    6 +-
+ arch/arm64/boot/dts/qcom/sc7280.dtsi               |  378 +++-
+ .../arm64/boot/dts/qcom/sc8180x-lenovo-flex-5g.dts |   14 +-
+ arch/arm64/boot/dts/qcom/sc8180x-primus.dts        |   14 +-
+ arch/arm64/boot/dts/qcom/sc8180x.dtsi              |   92 +-
+ arch/arm64/boot/dts/qcom/sc8280xp-crd.dts          |   23 +-
+ .../boot/dts/qcom/sc8280xp-huawei-gaokun3.dts      |   12 +
+ .../dts/qcom/sc8280xp-lenovo-thinkpad-x13s.dts     |   29 +-
+ .../boot/dts/qcom/sc8280xp-microsoft-arcata.dts    |   12 +
+ .../boot/dts/qcom/sc8280xp-microsoft-blackrock.dts |   25 +-
+ arch/arm64/boot/dts/qcom/sc8280xp.dtsi             |  498 ++++-
+ arch/arm64/boot/dts/qcom/sdm632-fairphone-fp3.dts  |   62 +
+ arch/arm64/boot/dts/qcom/sdm670-google-sargo.dts   |   17 +
+ arch/arm64/boot/dts/qcom/sdm845-cheza-r1.dts       |  238 --
+ arch/arm64/boot/dts/qcom/sdm845-cheza-r2.dts       |  238 --
+ arch/arm64/boot/dts/qcom/sdm845-cheza-r3.dts       |  174 --
+ arch/arm64/boot/dts/qcom/sdm845-cheza.dtsi         | 1330 ------------
+ .../qcom/sdm845-db845c-navigation-mezzanine.dtso   |    3 +-
+ arch/arm64/boot/dts/qcom/sdm845-db845c.dts         |   27 +-
+ arch/arm64/boot/dts/qcom/sdm845-mtp.dts            |   26 +-
+ .../arm64/boot/dts/qcom/sdm845-oneplus-common.dtsi |    4 +
+ .../boot/dts/qcom/sdm845-oneplus-enchilada.dts     |   38 +-
+ arch/arm64/boot/dts/qcom/sdm845-oneplus-fajita.dts |   10 +-
+ .../boot/dts/qcom/sdm845-samsung-starqltechn.dts   |   38 +-
+ arch/arm64/boot/dts/qcom/sdm845-shift-axolotl.dts  |    4 +-
+ .../boot/dts/qcom/sdm845-sony-xperia-tama.dtsi     |    3 +-
+ .../dts/qcom/sdm845-xiaomi-beryllium-common.dtsi   |    3 +-
+ arch/arm64/boot/dts/qcom/sdm845-xiaomi-polaris.dts |    3 +-
+ arch/arm64/boot/dts/qcom/sdm845.dtsi               |   51 +-
+ .../boot/dts/qcom/sdm850-lenovo-yoga-c630.dts      |  116 +-
+ .../boot/dts/qcom/{qcs615.dtsi => sm6150.dtsi}     |  614 ++++++
+ arch/arm64/boot/dts/qcom/sm6350.dtsi               |   18 +-
+ arch/arm64/boot/dts/qcom/sm7225-fairphone-fp4.dts  |   36 +
+ .../boot/dts/qcom/sm7325-nothing-spacewar.dts      |    6 +-
+ arch/arm64/boot/dts/qcom/sm8150-hdk.dts            |   24 +-
+ arch/arm64/boot/dts/qcom/sm8150.dtsi               |   31 +-
+ .../arm64/boot/dts/qcom/sm8250-samsung-common.dtsi |  204 ++
+ arch/arm64/boot/dts/qcom/sm8250-samsung-r8q.dts    |   26 +
+ arch/arm64/boot/dts/qcom/sm8250-samsung-x1q.dts    |   26 +
+ arch/arm64/boot/dts/qcom/sm8250-xiaomi-pipa.dts    |   96 +-
+ arch/arm64/boot/dts/qcom/sm8250.dtsi               |   85 +-
+ arch/arm64/boot/dts/qcom/sm8350-hdk.dts            |   12 +-
+ arch/arm64/boot/dts/qcom/sm8350.dtsi               |   27 +-
+ arch/arm64/boot/dts/qcom/sm8450-hdk.dts            |    5 -
+ arch/arm64/boot/dts/qcom/sm8450-qrd.dts            |   51 +-
+ arch/arm64/boot/dts/qcom/sm8450-samsung-r0q.dts    |  145 ++
+ .../boot/dts/qcom/sm8450-sony-xperia-nagara.dtsi   |    5 +-
+ arch/arm64/boot/dts/qcom/sm8450.dtsi               |   98 +-
+ arch/arm64/boot/dts/qcom/sm8550-hdk.dts            |    8 +-
+ arch/arm64/boot/dts/qcom/sm8550-mtp.dts            |    8 +-
+ arch/arm64/boot/dts/qcom/sm8550-qrd.dts            |    8 +-
+ arch/arm64/boot/dts/qcom/sm8550-samsung-q5q.dts    |    4 +-
+ arch/arm64/boot/dts/qcom/sm8550.dtsi               |  704 +++---
+ .../boot/dts/qcom/sm8650-hdk-display-card.dtso     |   15 +-
+ arch/arm64/boot/dts/qcom/sm8650-hdk.dts            |   14 +-
+ arch/arm64/boot/dts/qcom/sm8650-mtp.dts            |    6 +-
+ arch/arm64/boot/dts/qcom/sm8650-qrd.dts            |   14 +-
+ arch/arm64/boot/dts/qcom/sm8650.dtsi               |  458 ++--
+ arch/arm64/boot/dts/qcom/sm8750-mtp.dts            |  161 +-
+ arch/arm64/boot/dts/qcom/sm8750.dtsi               |  256 ++-
+ arch/arm64/boot/dts/qcom/x1-asus-zenbook-a14.dtsi  |   21 +-
+ arch/arm64/boot/dts/qcom/x1-crd.dtsi               |   88 +-
+ arch/arm64/boot/dts/qcom/x1-dell-thena.dtsi        | 1666 ++++++++++++++
+ arch/arm64/boot/dts/qcom/x1-el2.dtso               |    5 +
+ arch/arm64/boot/dts/qcom/x1-hp-omnibook-x14.dtsi   | 1544 +++++++++++++
+ arch/arm64/boot/dts/qcom/x1e001de-devkit.dts       |    7 +-
+ .../qcom/x1e78100-lenovo-thinkpad-t14s-oled.dts    |    8 +
+ .../dts/qcom/x1e78100-lenovo-thinkpad-t14s.dtsi    |   32 +-
+ .../boot/dts/qcom/x1e80100-asus-vivobook-s15.dts   |   23 +-
+ arch/arm64/boot/dts/qcom/x1e80100-crd.dts          |    4 +
+ .../qcom/x1e80100-dell-inspiron-14-plus-7441.dts   |   57 +
+ .../boot/dts/qcom/x1e80100-dell-latitude-7455.dts  |   58 +
+ .../boot/dts/qcom/x1e80100-dell-xps13-9345.dts     |   26 +-
+ .../boot/dts/qcom/x1e80100-hp-omnibook-x14.dts     | 1549 +------------
+ .../boot/dts/qcom/x1e80100-lenovo-yoga-slim7x.dts  |  170 +-
+ .../boot/dts/qcom/x1e80100-microsoft-romulus.dtsi  |  164 +-
+ arch/arm64/boot/dts/qcom/x1e80100-pmics.dtsi       |    2 +
+ arch/arm64/boot/dts/qcom/x1e80100-qcp.dts          |  143 +-
+ arch/arm64/boot/dts/qcom/x1e80100.dtsi             |  246 ++-
+ arch/arm64/boot/dts/qcom/x1p42100-crd.dts          |    4 +
+ .../boot/dts/qcom/x1p42100-hp-omnibook-x14.dts     |   33 +
+ .../boot/dts/qcom/x1p42100-lenovo-thinkbook-16.dts | 1625 ++++++++++++++
+ arch/arm64/boot/dts/qcom/x1p42100.dtsi             |  121 +-
+ arch/arm64/boot/dts/renesas/Makefile               |   16 +
+ arch/arm64/boot/dts/renesas/r8a774a1.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a774b1.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a774c0.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a774e1.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77951.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77960.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77961.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77965.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77970.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77980.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a77990.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r8a779a0.dtsi          |    4 +-
+ arch/arm64/boot/dts/renesas/r8a779g0.dtsi          |    4 +-
+ .../r8a779g3-sparrow-hawk-camera-j1-imx219.dtso    |  116 +
+ .../r8a779g3-sparrow-hawk-camera-j1-imx462.dtso    |  117 +
+ .../r8a779g3-sparrow-hawk-camera-j2-imx219.dtso    |  116 +
+ .../r8a779g3-sparrow-hawk-camera-j2-imx462.dtso    |  117 +
+ .../dts/renesas/r8a779g3-sparrow-hawk-fan-pwm.dtso |   15 +-
+ .../boot/dts/renesas/r8a779g3-sparrow-hawk.dts     |  149 +-
+ arch/arm64/boot/dts/renesas/r8a779h0.dtsi          |    2 +-
+ arch/arm64/boot/dts/renesas/r9a08g045.dtsi         |   36 +
+ arch/arm64/boot/dts/renesas/r9a09g047.dtsi         |  215 +-
+ arch/arm64/boot/dts/renesas/r9a09g047e57-smarc.dts |    7 +-
+ arch/arm64/boot/dts/renesas/r9a09g056.dtsi         |   49 +-
+ .../boot/dts/renesas/r9a09g056n48-rzv2n-evk.dts    |    2 +-
+ arch/arm64/boot/dts/renesas/r9a09g057.dtsi         |  112 +-
+ .../boot/dts/renesas/r9a09g057h44-rzv2h-evk.dts    |    2 +-
+ arch/arm64/boot/dts/renesas/r9a09g057h48-kakip.dts |    4 +-
+ arch/arm64/boot/dts/renesas/r9a09g077.dtsi         |  399 ++++
+ .../boot/dts/renesas/r9a09g077m44-rzt2h-evk.dts    |  184 ++
+ arch/arm64/boot/dts/renesas/r9a09g077m44.dtsi      |   13 +
+ arch/arm64/boot/dts/renesas/r9a09g087.dtsi         |  399 ++++
+ .../boot/dts/renesas/r9a09g087m44-rzn2h-evk.dts    |  229 ++
+ arch/arm64/boot/dts/renesas/r9a09g087m44.dtsi      |   13 +
+ arch/arm64/boot/dts/renesas/rzg2lc-smarc.dtsi      |    5 +-
+ .../boot/dts/renesas/rzt2h-n2h-evk-common.dtsi     |  246 +++
+ arch/arm64/boot/dts/rockchip/Makefile              |    7 +
+ arch/arm64/boot/dts/rockchip/rk3328-a1.dts         |   28 +
+ arch/arm64/boot/dts/rockchip/rk3328-roc-pc.dts     |    4 -
+ arch/arm64/boot/dts/rockchip/rk3328-roc.dtsi       |   17 +
+ arch/arm64/boot/dts/rockchip/rk3328-rock64.dts     |    4 +
+ arch/arm64/boot/dts/rockchip/rk3328.dtsi           |   40 +-
+ .../boot/dts/rockchip/rk3399-pinebook-pro.dts      |   18 +
+ .../boot/dts/rockchip/rk3399-pinephone-pro.dts     |   18 +
+ .../boot/dts/rockchip/rk3528-armsom-sige1.dts      |  464 ++++
+ .../boot/dts/rockchip/rk3528-nanopi-zero2.dts      |  340 +++
+ arch/arm64/boot/dts/rockchip/rk3528-rock-2.dtsi    |  293 +++
+ arch/arm64/boot/dts/rockchip/rk3528-rock-2a.dts    |   82 +
+ arch/arm64/boot/dts/rockchip/rk3528-rock-2f.dts    |   10 +
+ arch/arm64/boot/dts/rockchip/rk3528.dtsi           |  116 +-
+ .../boot/dts/rockchip/rk3568-hinlink-h66k.dts      |   10 +
+ .../boot/dts/rockchip/rk3568-hinlink-h68k.dts      |   83 +
+ .../boot/dts/rockchip/rk3568-hinlink-opc.dtsi      |  666 ++++++
+ arch/arm64/boot/dts/rockchip/rk3576-evb1-v10.dts   |  165 +-
+ arch/arm64/boot/dts/rockchip/rk3576-roc-pc.dts     |   16 +
+ arch/arm64/boot/dts/rockchip/rk3576.dtsi           |  272 ++-
+ arch/arm64/boot/dts/rockchip/rk3582-radxa-e52c.dts |   30 +-
+ arch/arm64/boot/dts/rockchip/rk3588-base.dtsi      |  157 +-
+ arch/arm64/boot/dts/rockchip/rk3588-extra.dtsi     |   30 +
+ arch/arm64/boot/dts/rockchip/rk3588-nanopc-t6.dtsi |   17 +
+ .../boot/dts/rockchip/rk3588-orangepi-5-plus.dts   |   17 +
+ .../arm64/boot/dts/rockchip/rk3588-orangepi-5.dtsi |   56 +
+ .../arm64/boot/dts/rockchip/rk3588-quartzpro64.dts |   30 +
+ arch/arm64/boot/dts/rockchip/rk3588-roc-rt.dts     | 1132 ++++++++++
+ arch/arm64/boot/dts/rockchip/rk3588-rock-5-itx.dts |   61 +
+ .../boot/dts/rockchip/rk3588-rock-5b-5bp-5t.dtsi   |  190 ++
+ .../boot/dts/rockchip/rk3588-rock-5b-plus.dts      |   12 +
+ arch/arm64/boot/dts/rockchip/rk3588-rock-5b.dts    |   12 +
+ arch/arm64/boot/dts/rockchip/rk3588-rock-5t.dts    |   12 +
+ arch/arm64/boot/dts/rockchip/rk3588s-coolpi-4b.dts |   37 +
+ .../boot/dts/rockchip/rk3588s-gameforce-ace.dts    |  122 ++
+ .../arm64/boot/dts/rockchip/rk3588s-nanopi-r6.dtsi |   42 +
+ .../boot/dts/rockchip/rk3588s-orangepi-5.dtsi      |   34 +
+ arch/arm64/boot/dts/rockchip/rk3588s-rock-5a.dts   |    7 +
+ .../boot/dts/socionext/uniphier-ld11-global.dts    |    4 +-
+ .../boot/dts/socionext/uniphier-ld20-akebi96.dts   |    4 +-
+ .../boot/dts/socionext/uniphier-ld20-global.dts    |    4 +-
+ arch/arm64/boot/dts/socionext/uniphier-ld20.dtsi   |    1 +
+ arch/arm64/boot/dts/socionext/uniphier-pxs3.dtsi   |    1 +
+ arch/arm64/boot/dts/st/stm32mp231.dtsi             |   22 -
+ arch/arm64/boot/dts/st/stm32mp235f-dk.dts          |   25 +-
+ arch/arm64/boot/dts/st/stm32mp25-pinctrl.dtsi      |  146 ++
+ arch/arm64/boot/dts/st/stm32mp251.dtsi             |   85 +
+ arch/arm64/boot/dts/st/stm32mp255.dtsi             |   18 +
+ arch/arm64/boot/dts/st/stm32mp257f-dk.dts          |   23 +
+ arch/arm64/boot/dts/st/stm32mp257f-ev1.dts         |  125 +-
+ arch/arm64/boot/dts/tesla/fsd.dtsi                 |    1 +
+ arch/arm64/boot/dts/ti/Makefile                    |    9 +
+ arch/arm64/boot/dts/ti/k3-am62-lp-sk.dts           |    8 +
+ arch/arm64/boot/dts/ti/k3-am62-main.dtsi           |    4 +
+ arch/arm64/boot/dts/ti/k3-am62-phycore-som.dtsi    |   49 +-
+ arch/arm64/boot/dts/ti/k3-am62-pocketbeagle2.dts   |   36 +-
+ .../arm64/boot/dts/ti/k3-am62-ti-ipc-firmware.dtsi |   52 +
+ arch/arm64/boot/dts/ti/k3-am62-verdin.dtsi         |   19 +-
+ arch/arm64/boot/dts/ti/k3-am62-wakeup.dtsi         |    1 +
+ arch/arm64/boot/dts/ti/k3-am625-beagleplay.dts     |    2 +-
+ arch/arm64/boot/dts/ti/k3-am625-sk-common.dtsi     |  296 +++
+ arch/arm64/boot/dts/ti/k3-am625-sk.dts             |  301 +--
+ arch/arm64/boot/dts/ti/k3-am6254atl-sk.dts         |   15 +
+ arch/arm64/boot/dts/ti/k3-am6254atl.dtsi           |   23 +
+ arch/arm64/boot/dts/ti/k3-am62a-main.dtsi          |    9 +-
+ arch/arm64/boot/dts/ti/k3-am62a-mcu.dtsi           |    1 +
+ arch/arm64/boot/dts/ti/k3-am62a-phycore-som.dtsi   |   99 +-
+ .../boot/dts/ti/k3-am62a-ti-ipc-firmware.dtsi      |   98 +
+ arch/arm64/boot/dts/ti/k3-am62a-wakeup.dtsi        |    1 +
+ arch/arm64/boot/dts/ti/k3-am62a7-sk.dts            |  100 +-
+ arch/arm64/boot/dts/ti/k3-am62d2-evm.dts           |  174 +-
+ .../boot/dts/ti/k3-am62p-j722s-common-main.dtsi    |    6 +-
+ .../boot/dts/ti/k3-am62p-j722s-common-mcu.dtsi     |    1 +
+ .../boot/dts/ti/k3-am62p-j722s-common-wakeup.dtsi  |    1 +
+ arch/arm64/boot/dts/ti/k3-am62p-main.dtsi          |    6 +
+ .../boot/dts/ti/k3-am62p-ti-ipc-firmware.dtsi      |   60 +
+ arch/arm64/boot/dts/ti/k3-am62p-verdin.dtsi        |   30 +-
+ arch/arm64/boot/dts/ti/k3-am62p5-sk.dts            |   64 +-
+ .../boot/dts/ti/k3-am62p5-var-som-symphony.dts     |  500 +++++
+ arch/arm64/boot/dts/ti/k3-am62p5-var-som.dtsi      |  387 ++++
+ arch/arm64/boot/dts/ti/k3-am62x-sk-common.dtsi     |   65 +-
+ arch/arm64/boot/dts/ti/k3-am64-main.dtsi           |    6 +
+ arch/arm64/boot/dts/ti/k3-am64-phycore-som.dtsi    |  128 +-
+ .../arm64/boot/dts/ti/k3-am64-ti-ipc-firmware.dtsi |  162 ++
+ arch/arm64/boot/dts/ti/k3-am642-evm.dts            |  150 +-
+ .../ti/k3-am642-phyboard-electra-peb-c-010.dtso    |  158 ++
+ .../boot/dts/ti/k3-am642-phyboard-electra-rdk.dts  |    1 +
+ arch/arm64/boot/dts/ti/k3-am642-sk.dts             |  150 +-
+ arch/arm64/boot/dts/ti/k3-am642-sr-som.dtsi        |   96 +-
+ arch/arm64/boot/dts/ti/k3-am642-tqma64xxl.dtsi     |  111 +-
+ arch/arm64/boot/dts/ti/k3-am65-iot2050-common.dtsi |   62 +-
+ arch/arm64/boot/dts/ti/k3-am65-mcu.dtsi            |    3 +
+ .../arm64/boot/dts/ti/k3-am65-ti-ipc-firmware.dtsi |   64 +
+ arch/arm64/boot/dts/ti/k3-am654-base-board.dts     |   58 +-
+ .../boot/dts/ti/k3-am6548-iot2050-advanced-sm.dts  |    2 +-
+ arch/arm64/boot/dts/ti/k3-am67a-beagley-ai.dts     |  156 +-
+ arch/arm64/boot/dts/ti/k3-am68-phycore-som.dtsi    |  239 +--
+ arch/arm64/boot/dts/ti/k3-am68-sk-base-board.dts   |   97 +
+ arch/arm64/boot/dts/ti/k3-am68-sk-som.dtsi         |  233 +-
+ arch/arm64/boot/dts/ti/k3-am69-sk.dts              |  370 +---
+ arch/arm64/boot/dts/ti/k3-j7200-main.dtsi          |    3 +
+ arch/arm64/boot/dts/ti/k3-j7200-mcu-wakeup.dtsi    |    3 +
+ arch/arm64/boot/dts/ti/k3-j7200-som-p0.dtsi        |  119 +-
+ .../boot/dts/ti/k3-j7200-ti-ipc-firmware.dtsi      |  130 ++
+ arch/arm64/boot/dts/ti/k3-j721e-beagleboneai64.dts |  233 +-
+ arch/arm64/boot/dts/ti/k3-j721e-main.dtsi          |   51 +
+ arch/arm64/boot/dts/ti/k3-j721e-mcu-wakeup.dtsi    |    3 +
+ arch/arm64/boot/dts/ti/k3-j721e-sk.dts             |  270 +--
+ arch/arm64/boot/dts/ti/k3-j721e-som-p0.dtsi        |  270 +--
+ .../boot/dts/ti/k3-j721e-ti-ipc-firmware.dtsi      |  288 +++
+ .../boot/dts/ti/k3-j721s2-common-proc-board.dts    |  117 +
+ .../boot/dts/ti/k3-j721s2-evm-usb0-type-a.dtso     |   28 +
+ arch/arm64/boot/dts/ti/k3-j721s2-main.dtsi         |   52 +
+ arch/arm64/boot/dts/ti/k3-j721s2-mcu-wakeup.dtsi   |    3 +
+ arch/arm64/boot/dts/ti/k3-j721s2-som-p0.dtsi       |  276 +--
+ .../boot/dts/ti/k3-j721s2-ti-ipc-firmware.dtsi     |  253 +++
+ arch/arm64/boot/dts/ti/k3-j722s-evm.dts            |  162 +-
+ arch/arm64/boot/dts/ti/k3-j722s-main.dtsi          |   20 +
+ .../boot/dts/ti/k3-j722s-ti-ipc-firmware.dtsi      |  163 ++
+ arch/arm64/boot/dts/ti/k3-j742s2-mcu-wakeup.dtsi   |   17 +
+ arch/arm64/boot/dts/ti/k3-j742s2.dtsi              |    1 +
+ arch/arm64/boot/dts/ti/k3-j784s4-evm.dts           |   26 +-
+ .../boot/dts/ti/k3-j784s4-j742s2-evm-common.dtsi   |  462 ++--
+ .../boot/dts/ti/k3-j784s4-j742s2-main-common.dtsi  |   57 +
+ .../dts/ti/k3-j784s4-j742s2-mcu-wakeup-common.dtsi |    3 +
+ .../k3-j784s4-j742s2-ti-ipc-firmware-common.dtsi   |  350 +++
+ .../boot/dts/ti/k3-j784s4-ti-ipc-firmware.dtsi     |   35 +
+ arch/arm64/boot/dts/ti/k3-pinctrl.h                |   51 +-
+ arch/arm64/boot/dts/toshiba/tmpv7708.dtsi          |    1 +
+ arch/arm64/boot/dts/xilinx/Makefile                |   24 +
+ arch/arm64/boot/dts/xilinx/versal-net.dtsi         |  410 +++-
+ .../boot/dts/xilinx/zynqmp-sck-kd-g-revA.dtso      |  390 ++++
+ .../boot/dts/xilinx/zynqmp-sck-kr-g-revA.dtso      |  455 ++++
+ .../boot/dts/xilinx/zynqmp-sck-kr-g-revB.dtso      |  456 ++++
+ .../boot/dts/xilinx/zynqmp-sck-kv-g-revA.dtso      |   40 +-
+ .../boot/dts/xilinx/zynqmp-sck-kv-g-revB.dtso      |   39 +-
+ arch/arm64/boot/dts/xilinx/zynqmp-sm-k24-revA.dts  |   23 +
+ arch/arm64/boot/dts/xilinx/zynqmp-sm-k26-revA.dts  |    7 +-
+ arch/arm64/boot/dts/xilinx/zynqmp-smk-k24-revA.dts |   21 +
+ .../boot/dts/xilinx/zynqmp-zc1751-xm016-dc2.dts    |    1 -
+ .../boot/dts/xilinx/zynqmp-zc1751-xm017-dc3.dts    |    1 -
+ arch/arm64/boot/dts/xilinx/zynqmp-zcu100-revC.dts  |   21 +
+ arch/arm64/boot/dts/xilinx/zynqmp-zcu102-revA.dts  |   18 +
+ arch/arm64/boot/dts/xilinx/zynqmp-zcu104-revA.dts  |   18 +
+ arch/arm64/boot/dts/xilinx/zynqmp-zcu104-revC.dts  |   18 +
+ arch/arm64/boot/dts/xilinx/zynqmp-zcu106-revA.dts  |   14 +-
+ arch/arm64/boot/dts/xilinx/zynqmp-zcu111-revA.dts  |   20 +-
+ arch/arm64/boot/dts/xilinx/zynqmp.dtsi             |   18 +-
+ arch/arm64/configs/defconfig                       |   13 +
+ arch/powerpc/platforms/Kconfig                     |    1 -
+ arch/riscv/Kconfig.socs                            |    6 +
+ arch/riscv/boot/dts/Makefile                       |    1 +
+ arch/riscv/boot/dts/allwinner/sunxi-d1s-t113.dtsi  |   48 +
+ arch/riscv/boot/dts/eswin/Makefile                 |    2 +
+ .../boot/dts/eswin/eic7700-hifive-premier-p550.dts |   29 +
+ arch/riscv/boot/dts/eswin/eic7700.dtsi             |  345 +++
+ arch/riscv/boot/dts/microchip/Makefile             |    2 +
+ .../riscv/boot/dts/microchip/mpfs-beaglev-fire.dts |    2 +-
+ .../boot/dts/microchip/mpfs-disco-kit-fabric.dtsi  |   58 +
+ arch/riscv/boot/dts/microchip/mpfs-disco-kit.dts   |  190 ++
+ .../boot/dts/microchip/mpfs-icicle-kit-common.dtsi |  249 +++
+ .../boot/dts/microchip/mpfs-icicle-kit-fabric.dtsi |   25 +-
+ .../boot/dts/microchip/mpfs-icicle-kit-prod.dts    |   23 +
+ arch/riscv/boot/dts/microchip/mpfs-icicle-kit.dts  |  244 +--
+ arch/riscv/boot/dts/sophgo/sg2042-cpus.dtsi        |   64 +
+ arch/riscv/boot/dts/sophgo/sg2042.dtsi             |   20 +
+ arch/riscv/boot/dts/spacemit/Makefile              |    1 +
+ arch/riscv/boot/dts/spacemit/k1-bananapi-f3.dts    |    4 +
+ arch/riscv/boot/dts/spacemit/k1-milkv-jupiter.dts  |    4 +
+ arch/riscv/boot/dts/spacemit/k1-orangepi-rv2.dts   |   40 +
+ arch/riscv/boot/dts/spacemit/k1.dtsi               |   31 +-
+ arch/riscv/boot/dts/starfive/Makefile              |    2 +
+ arch/riscv/boot/dts/starfive/jh7110-common.dtsi    |    4 -
+ .../boot/dts/starfive/jh7110-milkv-marscm-emmc.dts |   12 +
+ .../boot/dts/starfive/jh7110-milkv-marscm-lite.dts |   25 +
+ .../boot/dts/starfive/jh7110-milkv-marscm.dtsi     |  159 ++
+ arch/riscv/boot/dts/starfive/jh7110.dtsi           |   24 +
+ arch/riscv/boot/dts/thead/th1520.dtsi              |   21 +
+ arch/riscv/configs/defconfig                       |    6 +-
+ drivers/bus/fsl-mc/fsl-mc-bus.c                    |    9 +-
+ drivers/cache/sifive_ccache.c                      |    8 +-
+ drivers/char/hw_random/Kconfig                     |    2 +-
+ drivers/clk/clk-rp1.c                              | 1022 ++++++++-
+ drivers/clk/tegra/clk-tegra30.c                    |    1 +
+ drivers/crypto/Kconfig                             |    2 +-
+ drivers/dma-buf/dma-heap.c                         |    4 +
+ drivers/firmware/arm_scmi/bus.c                    |   13 +-
+ drivers/firmware/arm_scmi/quirks.c                 |   15 +-
+ drivers/firmware/arm_scmi/transports/mailbox.c     |    7 +-
+ drivers/firmware/arm_scmi/transports/optee.c       |    2 +-
+ drivers/firmware/arm_scmi/transports/virtio.c      |    3 +
+ .../firmware/arm_scmi/vendors/imx/imx-sm-misc.c    |  111 +
+ drivers/firmware/arm_scmi/vendors/imx/imx95.rst    |   25 +
+ drivers/firmware/arm_scmi/voltage.c                |    2 +-
+ drivers/firmware/broadcom/bcm47xx_sprom.c          |    2 +-
+ drivers/firmware/meson/Kconfig                     |    2 +-
+ drivers/firmware/meson/meson_sm.c                  |    7 +-
+ drivers/firmware/qcom/qcom_scm.c                   |  125 +-
+ drivers/firmware/qcom/qcom_scm.h                   |    7 +
+ drivers/firmware/qcom/qcom_tzmem.c                 |   64 +-
+ drivers/firmware/samsung/exynos-acpm-pmic.c        |   25 +-
+ drivers/firmware/ti_sci.c                          |   57 +-
+ drivers/firmware/ti_sci.h                          |    3 +
+ drivers/i2c/busses/Kconfig                         |    2 +-
+ drivers/i2c/busses/i2c-qcom-geni.c                 |    8 +-
+ drivers/media/platform/qcom/venus/firmware.c       |    4 +-
+ drivers/memory/samsung/exynos-srom.c               |   10 +-
+ drivers/memory/stm32_omm.c                         |    2 +-
+ drivers/memory/tegra/tegra210.c                    |  146 +-
+ drivers/mfd/Kconfig                                |    2 +-
+ drivers/net/wireless/ath/ath12k/ahb.c              |    2 +-
+ drivers/nvme/host/apple.c                          |  197 +-
+ drivers/pinctrl/pinctrl-apple-gpio.c               |    1 +
+ drivers/pmdomain/apple/pmgr-pwrstate.c             |    1 +
+ drivers/remoteproc/qcom_q6v5_adsp.c                |    2 +-
+ drivers/remoteproc/qcom_q6v5_pas.c                 |    7 +-
+ drivers/remoteproc/qcom_q6v5_wcss.c                |    2 +-
+ drivers/reset/Kconfig                              |    7 +
+ drivers/reset/Makefile                             |    1 +
+ drivers/reset/reset-aspeed.c                       |  253 +++
+ drivers/reset/reset-bcm6345.c                      |    1 +
+ drivers/reset/reset-intel-gw.c                     |    1 -
+ drivers/reset/reset-qcom-pdc.c                     |    1 -
+ drivers/reset/reset-th1520.c                       |   41 +-
+ drivers/soc/apple/Kconfig                          |    3 -
+ drivers/soc/apple/mailbox.c                        |   19 +
+ drivers/soc/apple/sart.c                           |   60 +-
+ drivers/soc/aspeed/aspeed-lpc-ctrl.c               |   14 +-
+ drivers/soc/aspeed/aspeed-p2a-ctrl.c               |   14 +-
+ drivers/soc/aspeed/aspeed-socinfo.c                |    4 +
+ drivers/soc/fsl/qbman/qman_test_stash.c            |    2 +-
+ drivers/soc/fsl/qe/gpio.c                          |  129 +-
+ drivers/soc/hisilicon/kunpeng_hccs.c               |    2 +-
+ drivers/soc/mediatek/mtk-svs.c                     |   23 +
+ drivers/soc/qcom/icc-bwmon.c                       |    3 +
+ drivers/soc/qcom/llcc-qcom.c                       |    1 -
+ drivers/soc/qcom/mdt_loader.c                      |   20 +-
+ drivers/soc/qcom/qcom-geni-se.c                    |  506 ++++-
+ drivers/soc/qcom/qcom_pd_mapper.c                  |    1 +
+ drivers/soc/qcom/ramp_controller.c                 |    1 -
+ drivers/soc/qcom/rpm_master_stats.c                |    2 +-
+ drivers/soc/qcom/rpmh-rsc.c                        |    7 +-
+ drivers/soc/qcom/smem.c                            |    2 +-
+ drivers/soc/renesas/Kconfig                        |   13 +
+ drivers/soc/renesas/r9a08g045-sysc.c               |    1 +
+ drivers/soc/renesas/r9a09g047-sys.c                |    1 +
+ drivers/soc/renesas/r9a09g057-sys.c                |    1 +
+ drivers/soc/renesas/renesas-soc.c                  |   12 +
+ drivers/soc/renesas/rz-sysc.c                      |   30 +-
+ drivers/soc/renesas/rz-sysc.h                      |    2 +
+ drivers/soc/samsung/exynos-pmu.c                   |  276 ++-
+ drivers/soc/sunxi/sunxi_sram.c                     |   14 +
+ drivers/soc/tegra/fuse/fuse-tegra30.c              |  122 ++
+ drivers/soc/ti/k3-socinfo.c                        |   10 +
+ drivers/soc/ti/pruss.c                             |    2 +-
+ drivers/spi/Kconfig                                |    2 +-
+ drivers/spi/spi-apple.c                            |    1 +
+ drivers/spi/spi-geni-qcom.c                        |    6 +
+ drivers/tee/Kconfig                                |    9 +-
+ drivers/tee/Makefile                               |    2 +
+ drivers/tee/optee/Kconfig                          |    5 +
+ drivers/tee/optee/Makefile                         |    1 +
+ drivers/tee/optee/core.c                           |    9 +-
+ drivers/tee/optee/ffa_abi.c                        |  146 +-
+ drivers/tee/optee/optee_ffa.h                      |   29 +-
+ drivers/tee/optee/optee_msg.h                      |   84 +-
+ drivers/tee/optee/optee_private.h                  |   15 +-
+ drivers/tee/optee/optee_smc.h                      |   37 +-
+ drivers/tee/optee/protmem.c                        |  335 +++
+ drivers/tee/optee/smc_abi.c                        |  141 +-
+ drivers/tee/qcomtee/Kconfig                        |   12 +
+ drivers/tee/qcomtee/Makefile                       |    9 +
+ drivers/tee/qcomtee/async.c                        |  182 ++
+ drivers/tee/qcomtee/call.c                         |  820 +++++++
+ drivers/tee/qcomtee/core.c                         |  915 ++++++++
+ drivers/tee/qcomtee/mem_obj.c                      |  169 ++
+ drivers/tee/qcomtee/primordial_obj.c               |  113 +
+ drivers/tee/qcomtee/qcomtee.h                      |  185 ++
+ drivers/tee/qcomtee/qcomtee_msg.h                  |  304 +++
+ drivers/tee/qcomtee/qcomtee_object.h               |  316 +++
+ drivers/tee/qcomtee/shm.c                          |  150 ++
+ drivers/tee/qcomtee/user_obj.c                     |  692 ++++++
+ drivers/tee/tee_core.c                             |  342 ++-
+ drivers/tee/tee_heap.c                             |  500 +++++
+ drivers/tee/tee_private.h                          |   20 +-
+ drivers/tee/tee_shm.c                              |  165 +-
+ drivers/tty/serial/Kconfig                         |    2 +-
+ drivers/tty/serial/qcom_geni_serial.c              |    8 +-
+ include/dt-bindings/clock/qcom,apss-ipq.h          |    6 +
+ include/dt-bindings/clock/qcom,dispcc-sc7280.h     |    4 +
+ include/dt-bindings/clock/raspberrypi,rp1-clocks.h |    4 +
+ .../dt-bindings/clock/renesas,r9a09g077-cpg-mssr.h |    1 +
+ .../dt-bindings/clock/renesas,r9a09g087-cpg-mssr.h |    1 +
+ include/dt-bindings/clock/sun55i-a523-ccu.h        |    1 +
+ include/dt-bindings/clock/sun55i-a523-mcu-ccu.h    |   54 +
+ include/dt-bindings/clock/tegra30-car.h            |    3 +-
+ include/dt-bindings/interconnect/qcom,ipq5424.h    |    3 +
+ include/dt-bindings/memory/tegra210-mc.h           |   74 +
+ .../pinctrl/renesas,r9a09g077-pinctrl.h            |   22 +
+ include/dt-bindings/reset/nvidia,tegra114-car.h    |   13 +
+ include/dt-bindings/reset/sun55i-a523-mcu-ccu.h    |   30 +
+ include/dt-bindings/reset/thead,th1520-reset.h     |    7 +
+ include/linux/firmware/qcom/qcom_scm.h             |    6 +
+ include/linux/firmware/qcom/qcom_tzmem.h           |   15 +
+ include/linux/scmi_protocol.h                      |    2 +-
+ include/linux/soc/qcom/geni-se.h                   |    4 +
+ include/linux/soc/qcom/mdt_loader.h                |    7 +-
+ include/linux/tee_core.h                           |  113 +-
+ include/linux/tee_drv.h                            |   22 +
+ include/soc/at91/sama7-sfrbu.h                     |    7 -
+ include/uapi/linux/tee.h                           |   87 +-
+ sound/soc/apple/mca.c                              |    1 +
+ 1039 files changed, 70382 insertions(+), 17151 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/arm/axis.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/axis.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/keystone/keystone.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/ti/ti,keystone.yaml
+ create mode 100644 Documentation/devicetree/bindings/clock/qcom,ipq5424-apss-clk.yaml
+ create mode 100644 Documentation/devicetree/bindings/memory-controllers/starfive,jh7110-dmc.yaml
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/renesas,r9a09g077-pinctrl.yaml
+ create mode 100644 Documentation/devicetree/bindings/riscv/eswin.yaml
+ create mode 100644 Documentation/devicetree/bindings/soc/qcom/qcom,se-common-props.yaml
+ create mode 100644 Documentation/tee/qtee.rst
+ create mode 100644 arch/arm/arm-soc-for-next-contents.txt
+ create mode 100644 arch/arm/boot/dts/allwinner/sun8i-orangepi-zero-interface-board.dtso
+ create mode 100644 arch/arm/boot/dts/allwinner/sun8i-t113s-netcube-nagami-basic-carrier.dts
+ create mode 100644 arch/arm/boot/dts/allwinner/sun8i-t113s-netcube-nagami-keypad-carrier.dts
+ create mode 100644 arch/arm/boot/dts/allwinner/sun8i-t113s-netcube-nagami.dtsi
+ create mode 100644 arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-clemente.dts
+ create mode 100644 arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-darwin.dts
+ create mode 100644 arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-fuji-data64.dts
+ create mode 100644 arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-wedge400-data64.dts
+ create mode 100644 arch/arm/boot/dts/aspeed/facebook-bmc-flash-layout-128-data64.dtsi
+ create mode 100644 arch/arm/boot/dts/broadcom/bcm4708-buffalo-wxr-1750dhp.dts
+ create mode 100644 arch/arm/boot/dts/intel/ixp/intel-ixp42x-actiontec-mi424wr-ac.dts
+ create mode 100644 arch/arm/boot/dts/intel/ixp/intel-ixp42x-actiontec-mi424wr-d.dts
+ create mode 100644 arch/arm/boot/dts/intel/ixp/intel-ixp42x-actiontec-mi424wr.dtsi
+ create mode 100644 arch/arm/boot/dts/nvidia/tegra20-asus-sl101.dts
+ create mode 100644 arch/arm/boot/dts/nvidia/tegra20-asus-transformer-common.dtsi
+ create mode 100644 arch/arm/boot/dts/qcom/qcom-msm8960-sony-huashan.dts
+ delete mode 100644 arch/arm/boot/dts/st/stih407-b2120.dts
+ delete mode 100644 arch/arm/boot/dts/st/stih407-clock.dtsi
+ delete mode 100644 arch/arm/boot/dts/st/stih407.dtsi
+ delete mode 100644 arch/arm/boot/dts/st/stih410-b2120.dts
+ delete mode 100644 arch/arm/boot/dts/st/stihxxx-b2120.dtsi
+ delete mode 100644 arch/arm/mach-hpe/Kconfig
+ delete mode 100644 arch/arm/mach-hpe/Makefile
+ delete mode 100644 arch/arm/mach-hpe/gxp.c
+ create mode 100644 arch/arm64/boot/dts/allwinner/sun50i-h313-x96q.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6020-j414s.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6020-j416s.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6020-j474s.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6020.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t6021-j414c.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6021-j416c.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6021-j475c.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6021.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t6022-j180d.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6022-j475d.dts
+ create mode 100644 arch/arm64/boot/dts/apple/t6022-jxxxd.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t6022.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-common.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-die0.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-dieX.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-gpio-pins.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-j414-j416.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-j474-j475.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-nvme.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t602x-pmgr.dtsi
+ create mode 100644 arch/arm64/boot/dts/apple/t8112-j415.dts
+ create mode 100644 arch/arm64/boot/dts/exynos/axis/Makefile
+ create mode 100644 arch/arm64/boot/dts/exynos/axis/artpec-pinctrl.h
+ create mode 100644 arch/arm64/boot/dts/exynos/axis/artpec8-grizzly.dts
+ create mode 100644 arch/arm64/boot/dts/exynos/axis/artpec8-pinctrl.dtsi
+ create mode 100644 arch/arm64/boot/dts/exynos/axis/artpec8.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/fsl-ls1012a-tqmls1012al-mbls1012al-emmc.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/fsl-ls1012a-tqmls1012al-mbls1012al.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/fsl-ls1012a-tqmls1012al.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mm-kontron-bl-lte.dtso
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-cubox-m.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-edm-g-wb.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-edm-g.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-mate.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pro.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pulse-codec.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pulse-common.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pulse-hdmi.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pulse-m2con.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pulse-mini-hdmi.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-pulse.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-hummingboard-ripple.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-sr-som.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8mp-ultra-mach-sbc.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx8ulp-9x9-evk.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx91-11x11-evk.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx91-pinfunc.h
+ create mode 100644 arch/arm64/boot/dts/freescale/imx91-tqma9131-mba91xxca.dts
+ create mode 100644 arch/arm64/boot/dts/freescale/imx91-tqma9131.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx91.dtsi
+ create mode 100644 arch/arm64/boot/dts/freescale/imx91_93_common.dtsi
+ create mode 100644 arch/arm64/boot/dts/marvell/armada-3720-atlas-v5.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/hamoa-iot-evk.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/hamoa-iot-som.dtsi
+ create mode 100644 arch/arm64/boot/dts/qcom/lemans-auto.dtsi
+ create mode 100644 arch/arm64/boot/dts/qcom/lemans-evk-camera-csi1-imx577.dtso
+ create mode 100644 arch/arm64/boot/dts/qcom/lemans-evk.dts
+ rename arch/arm64/boot/dts/qcom/{sa8775p-pmics.dtsi => lemans-pmics.dtsi} (100%)
+ rename arch/arm64/boot/dts/qcom/{sa8775p-ride.dtsi => lemans-ride-common.dtsi} (87%)
+ create mode 100644 arch/arm64/boot/dts/qcom/lemans-ride-ethernet-88ea1512.dtsi
+ create mode 100644 arch/arm64/boot/dts/qcom/lemans-ride-ethernet-aqr115c.dtsi
+ rename arch/arm64/boot/dts/qcom/{sa8775p.dtsi => lemans.dtsi} (90%)
+ create mode 100644 arch/arm64/boot/dts/qcom/monaco-evk.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/msm8953-flipkart-rimob.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/qcm6490-particle-tachyon.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/qcs6490-audioreach.dtsi
+ delete mode 100644 arch/arm64/boot/dts/qcom/sdm845-cheza-r1.dts
+ delete mode 100644 arch/arm64/boot/dts/qcom/sdm845-cheza-r2.dts
+ delete mode 100644 arch/arm64/boot/dts/qcom/sdm845-cheza-r3.dts
+ delete mode 100644 arch/arm64/boot/dts/qcom/sdm845-cheza.dtsi
+ rename arch/arm64/boot/dts/qcom/{qcs615.dtsi => sm6150.dtsi} (86%)
+ create mode 100644 arch/arm64/boot/dts/qcom/sm8250-samsung-common.dtsi
+ create mode 100644 arch/arm64/boot/dts/qcom/sm8250-samsung-r8q.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/sm8250-samsung-x1q.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/sm8450-samsung-r0q.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/x1-dell-thena.dtsi
+ create mode 100644 arch/arm64/boot/dts/qcom/x1-hp-omnibook-x14.dtsi
+ create mode 100644 arch/arm64/boot/dts/qcom/x1e80100-dell-inspiron-14-plus-7441.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/x1e80100-dell-latitude-7455.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/x1p42100-hp-omnibook-x14.dts
+ create mode 100644 arch/arm64/boot/dts/qcom/x1p42100-lenovo-thinkbook-16.dts
+ create mode 100644 arch/arm64/boot/dts/renesas/r8a779g3-sparrow-hawk-camera-j1-imx219.dtso
+ create mode 100644 arch/arm64/boot/dts/renesas/r8a779g3-sparrow-hawk-camera-j1-imx462.dtso
+ create mode 100644 arch/arm64/boot/dts/renesas/r8a779g3-sparrow-hawk-camera-j2-imx219.dtso
+ create mode 100644 arch/arm64/boot/dts/renesas/r8a779g3-sparrow-hawk-camera-j2-imx462.dtso
+ create mode 100644 arch/arm64/boot/dts/renesas/r9a09g077.dtsi
+ create mode 100644 arch/arm64/boot/dts/renesas/r9a09g077m44-rzt2h-evk.dts
+ create mode 100644 arch/arm64/boot/dts/renesas/r9a09g077m44.dtsi
+ create mode 100644 arch/arm64/boot/dts/renesas/r9a09g087.dtsi
+ create mode 100644 arch/arm64/boot/dts/renesas/r9a09g087m44-rzn2h-evk.dts
+ create mode 100644 arch/arm64/boot/dts/renesas/r9a09g087m44.dtsi
+ create mode 100644 arch/arm64/boot/dts/renesas/rzt2h-n2h-evk-common.dtsi
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3528-armsom-sige1.dts
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3528-nanopi-zero2.dts
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3528-rock-2.dtsi
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3528-rock-2a.dts
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3528-rock-2f.dts
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3568-hinlink-h66k.dts
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3568-hinlink-h68k.dts
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3568-hinlink-opc.dtsi
+ create mode 100644 arch/arm64/boot/dts/rockchip/rk3588-roc-rt.dts
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am62-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am625-sk-common.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am6254atl-sk.dts
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am6254atl.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am62a-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am62p-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am62p5-var-som-symphony.dts
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am62p5-var-som.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am64-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am642-phyboard-electra-peb-c-010.dtso
+ create mode 100644 arch/arm64/boot/dts/ti/k3-am65-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j7200-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j721e-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j721s2-evm-usb0-type-a.dtso
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j721s2-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j722s-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j742s2-mcu-wakeup.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j784s4-j742s2-ti-ipc-firmware-common.dtsi
+ create mode 100644 arch/arm64/boot/dts/ti/k3-j784s4-ti-ipc-firmware.dtsi
+ create mode 100644 arch/arm64/boot/dts/xilinx/zynqmp-sck-kd-g-revA.dtso
+ create mode 100644 arch/arm64/boot/dts/xilinx/zynqmp-sck-kr-g-revA.dtso
+ create mode 100644 arch/arm64/boot/dts/xilinx/zynqmp-sck-kr-g-revB.dtso
+ create mode 100644 arch/arm64/boot/dts/xilinx/zynqmp-sm-k24-revA.dts
+ create mode 100644 arch/arm64/boot/dts/xilinx/zynqmp-smk-k24-revA.dts
+ create mode 100644 arch/riscv/boot/dts/eswin/Makefile
+ create mode 100644 arch/riscv/boot/dts/eswin/eic7700-hifive-premier-p550.dts
+ create mode 100644 arch/riscv/boot/dts/eswin/eic7700.dtsi
+ create mode 100644 arch/riscv/boot/dts/microchip/mpfs-disco-kit-fabric.dtsi
+ create mode 100644 arch/riscv/boot/dts/microchip/mpfs-disco-kit.dts
+ create mode 100644 arch/riscv/boot/dts/microchip/mpfs-icicle-kit-common.dtsi
+ create mode 100644 arch/riscv/boot/dts/microchip/mpfs-icicle-kit-prod.dts
+ create mode 100644 arch/riscv/boot/dts/spacemit/k1-orangepi-rv2.dts
+ create mode 100644 arch/riscv/boot/dts/starfive/jh7110-milkv-marscm-emmc.dts
+ create mode 100644 arch/riscv/boot/dts/starfive/jh7110-milkv-marscm-lite.dts
+ create mode 100644 arch/riscv/boot/dts/starfive/jh7110-milkv-marscm.dtsi
+ create mode 100644 drivers/reset/reset-aspeed.c
+ create mode 100644 drivers/tee/optee/protmem.c
+ create mode 100644 drivers/tee/qcomtee/Kconfig
+ create mode 100644 drivers/tee/qcomtee/Makefile
+ create mode 100644 drivers/tee/qcomtee/async.c
+ create mode 100644 drivers/tee/qcomtee/call.c
+ create mode 100644 drivers/tee/qcomtee/core.c
+ create mode 100644 drivers/tee/qcomtee/mem_obj.c
+ create mode 100644 drivers/tee/qcomtee/primordial_obj.c
+ create mode 100644 drivers/tee/qcomtee/qcomtee.h
+ create mode 100644 drivers/tee/qcomtee/qcomtee_msg.h
+ create mode 100644 drivers/tee/qcomtee/qcomtee_object.h
+ create mode 100644 drivers/tee/qcomtee/shm.c
+ create mode 100644 drivers/tee/qcomtee/user_obj.c
+ create mode 100644 drivers/tee/tee_heap.c
+ create mode 100644 include/dt-bindings/clock/sun55i-a523-mcu-ccu.h
+ create mode 100644 include/dt-bindings/pinctrl/renesas,r9a09g077-pinctrl.h
+ create mode 100644 include/dt-bindings/reset/nvidia,tegra114-car.h
+ create mode 100644 include/dt-bindings/reset/sun55i-a523-mcu-ccu.h
+Merging amlogic/for-next (a0c59ce817bca Merge branch 'v6.18/arm64-dt' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/amlogic/linux.git amlogic/for-next
+Merge made by the 'ort' strategy.
+Merging asahi-soc/asahi-soc/for-next (fd4068f052ce4 Merge branch 'apple-soc/drivers-6.18' into asahi-soc/for-next)
+$ git merge -m Merge branch 'asahi-soc/for-next' of https://github.com/AsahiLinux/linux.git asahi-soc/asahi-soc/for-next
+Merge made by the 'ort' strategy.
+Merging at91/at91-next (5a410e87e09e2 Merge branch 'at91-dt' into at91-next)
+$ git merge -m Merge branch 'at91-next' of https://git.kernel.org/pub/scm/linux/kernel/git/at91/linux.git at91/at91-next
+Merge made by the 'ort' strategy.
+ drivers/clk/at91/clk-master.c      |  3 ++
+ drivers/clk/at91/clk-sam9x60-pll.c | 82 +++++++++++++++++++-------------------
+ drivers/clk/at91/pmc.h             |  1 +
+ drivers/clk/at91/sam9x60.c         |  2 +
+ drivers/clk/at91/sam9x7.c          |  6 +++
+ drivers/clk/at91/sama7d65.c        |  4 ++
+ drivers/clk/at91/sama7g5.c         |  2 +
+ include/linux/clk/at91_pmc.h       |  2 -
+ 8 files changed, 59 insertions(+), 43 deletions(-)
+Merging bmc/for-next (54650eac78583 Merge branches 'aspeed/drivers', 'aspeed/arm/dt', 'nuvoton/arm/dt' and 'nuvoton/arm64/dt' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/bmc/linux.git bmc/for-next
+Merge made by the 'ort' strategy.
+ arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-clemente.dts  |  2 ++
+ arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-harma.dts     |  8 ++++++++
+ arch/arm/boot/dts/aspeed/aspeed-bmc-facebook-yosemite4.dts | 14 ++++++++++++++
+ 3 files changed, 24 insertions(+)
+Merging broadcom/next (cd0e2df0bb0c4 Merge branch 'drivers/next' into next)
+$ git merge -m Merge branch 'next' of https://github.com/Broadcom/stblinux.git broadcom/next
+Merge made by the 'ort' strategy.
+Merging cix/for-next (de1ab02c6e14b arm64: dts: cix: add DT nodes for SPI)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/peter.chen/cix.git cix/for-next
+Merge made by the 'ort' strategy.
+ arch/arm64/boot/dts/cix/sky1.dtsi | 20 ++++++++++++++++++++
+ 1 file changed, 20 insertions(+)
+Merging davinci/davinci/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'davinci/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git davinci/davinci/for-next
+Already up to date.
+Merging drivers-memory/for-next (3804cef4c5974 memory: tegra210: Use bindings for client ids)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-mem-ctrl.git drivers-memory/for-next
+Already up to date.
+Merging fsl/soc_fsl (5498f07842cbd soc/fsl/qbman: Use for_each_online_cpu() instead of for_each_cpu())
+$ git merge -m Merge branch 'soc_fsl' of https://github.com/chleroy/linux.git fsl/soc_fsl
+Already up to date.
+Merging imx-mxs/for-next (ea21fa34164c9 Merge branch 'imx/defconfig' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/shawnguo/linux.git imx-mxs/for-next
+Merge made by the 'ort' strategy.
+Merging mediatek/for-next (462e0bb5f2bca Merge branch 'v6.17-next/soc' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mediatek/linux.git mediatek/for-next
+Merge made by the 'ort' strategy.
+Merging mvebu/for-next (86a99e9f53947 Merge branch 'mvebu/fixes' into mvebu/for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gclement/mvebu.git mvebu/for-next
+Merge made by the 'ort' strategy.
+Merging omap/for-next (462bfcbe8834d Merge branch 'omap-for-v6.18/soc' into tmp/omap-next-20250915.162436)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap.git omap/for-next
+Merge made by the 'ort' strategy.
+Merging qcom/for-next (30bf3ec8cb6b2 Merge branches 'arm32-defconfig-for-v6.18', 'arm32-for-6.18', 'arm64-defconfig-for-6.18', 'arm64-for-6.18', 'clk-for-6.18', 'drivers-fixes-for-6.17' and 'drivers-for-6.18' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/qcom/linux.git qcom/for-next
+Merge made by the 'ort' strategy.
+ .../bindings/clock/qcom,gcc-msm8953.yaml           |   11 +-
+ .../bindings/clock/qcom,glymur-dispcc.yaml         |   98 +
+ .../devicetree/bindings/clock/qcom,glymur-gcc.yaml |  121 +
+ .../devicetree/bindings/clock/qcom,rpmhcc.yaml     |    1 +
+ .../bindings/clock/qcom,sm8550-tcsr.yaml           |    3 +
+ .../devicetree/bindings/clock/qcom,videocc.yaml    |   23 +-
+ drivers/clk/qcom/Kconfig                           |   44 +-
+ drivers/clk/qcom/Makefile                          |    4 +
+ drivers/clk/qcom/a7-pll.c                          |    2 +-
+ drivers/clk/qcom/apss-ipq5424.c                    |  265 +
+ drivers/clk/qcom/camcc-milos.c                     |    2 +-
+ drivers/clk/qcom/clk-alpha-pll.c                   |  162 +-
+ drivers/clk/qcom/clk-alpha-pll.h                   |    6 +
+ drivers/clk/qcom/clk-rcg.c                         |    2 +-
+ drivers/clk/qcom/clk-rcg2.c                        |    8 +-
+ drivers/clk/qcom/clk-rpmh.c                        |   28 +-
+ drivers/clk/qcom/clk-smd-rpm.c                     |    8 +-
+ drivers/clk/qcom/common.c                          |    4 +-
+ drivers/clk/qcom/dispcc-glymur.c                   | 1982 +++++
+ drivers/clk/qcom/dispcc-milos.c                    |    2 +-
+ drivers/clk/qcom/dispcc-sc7280.c                   |    8 +
+ drivers/clk/qcom/gcc-glymur.c                      | 8616 ++++++++++++++++++++
+ drivers/clk/qcom/gcc-ipq6018.c                     |   60 +-
+ drivers/clk/qcom/gcc-msm8917.c                     |  617 +-
+ drivers/clk/qcom/gcc-qcs404.c                      |    2 +-
+ drivers/clk/qcom/gcc-sc8280xp.c                    |    4 -
+ drivers/clk/qcom/gcc-sdm660.c                      |   72 +
+ drivers/clk/qcom/gpucc-sa8775p.c                   |    6 +-
+ drivers/clk/qcom/gpucc-sc7180.c                    |    2 +-
+ drivers/clk/qcom/gpucc-sm6350.c                    |    4 +-
+ drivers/clk/qcom/gpucc-sm8150.c                    |    2 +-
+ drivers/clk/qcom/gpucc-sm8250.c                    |    2 +-
+ drivers/clk/qcom/lpassaudiocc-sc7280.c             |    4 +-
+ drivers/clk/qcom/lpasscc-sc8280xp.c                |    4 +-
+ drivers/clk/qcom/lpasscc-sm6115.c                  |    2 +-
+ drivers/clk/qcom/lpasscorecc-sc7180.c              |    2 +-
+ drivers/clk/qcom/mmcc-sdm660.c                     |    2 +-
+ drivers/clk/qcom/nsscc-ipq9574.c                   |    2 +-
+ drivers/clk/qcom/tcsrcc-glymur.c                   |  313 +
+ drivers/clk/qcom/tcsrcc-x1e80100.c                 |    4 +
+ drivers/clk/qcom/videocc-milos.c                   |    2 +-
+ include/dt-bindings/clock/qcom,gcc-msm8917.h       |   19 +
+ include/dt-bindings/clock/qcom,gcc-sdm660.h        |    6 +
+ include/dt-bindings/clock/qcom,glymur-dispcc.h     |  114 +
+ include/dt-bindings/clock/qcom,glymur-gcc.h        |  578 ++
+ include/dt-bindings/clock/qcom,glymur-tcsr.h       |   24 +
+ 46 files changed, 13094 insertions(+), 153 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/clock/qcom,glymur-dispcc.yaml
+ create mode 100644 Documentation/devicetree/bindings/clock/qcom,glymur-gcc.yaml
+ create mode 100644 drivers/clk/qcom/apss-ipq5424.c
+ create mode 100644 drivers/clk/qcom/dispcc-glymur.c
+ create mode 100644 drivers/clk/qcom/gcc-glymur.c
+ create mode 100644 drivers/clk/qcom/tcsrcc-glymur.c
+ create mode 100644 include/dt-bindings/clock/qcom,glymur-dispcc.h
+ create mode 100644 include/dt-bindings/clock/qcom,glymur-gcc.h
+ create mode 100644 include/dt-bindings/clock/qcom,glymur-tcsr.h
+Merging renesas/next (35083f5599e6e Merge branches 'renesas-arm-defconfig-for-v6.18', 'renesas-arm-soc-for-v6.18', 'renesas-drivers-for-v6.18', 'renesas-dt-bindings-for-v6.18' and 'renesas-dts-for-v6.18' into renesas-next)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-devel.git renesas/next
+Merge made by the 'ort' strategy.
+Merging reset/reset/next (1527cd3b89f0d reset: remove unneeded 'fast_io' parameter in regmap_config)
+$ git merge -m Merge branch 'reset/next' of https://git.pengutronix.de/git/pza/linux reset/reset/next
+Already up to date.
+Merging rockchip/for-next (bf9bcd2873e57 Merge branch 'v6.18-armsoc/dts64' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mmind/linux-rockchip.git rockchip/for-next
+Auto-merging arch/arm64/boot/dts/rockchip/rk3588-rock-5t.dts
+CONFLICT (content): Merge conflict in arch/arm64/boot/dts/rockchip/rk3588-rock-5t.dts
+Resolved 'arch/arm64/boot/dts/rockchip/rk3588-rock-5t.dts' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 99a4f575ba410] Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mmind/linux-rockchip.git
+$ git diff -M --stat --summary HEAD^..
+ arch/arm64/boot/dts/rockchip/rk3588-rock-5t.dts | 8 ++++----
+ 1 file changed, 4 insertions(+), 4 deletions(-)
+Merging samsung-krzk/for-next (541a89b87cb63 Merge branch 'next/drivers' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux.git samsung-krzk/for-next
+Merge made by the 'ort' strategy.
+ .../bindings/clock/axis,artpec8-clock.yaml         |  213 ++++
+ .../bindings/clock/samsung,exynos990-clock.yaml    |   24 +
+ drivers/clk/samsung/Makefile                       |    1 +
+ drivers/clk/samsung/clk-artpec8.c                  | 1044 ++++++++++++++++
+ drivers/clk/samsung/clk-cpu.c                      |   12 +-
+ drivers/clk/samsung/clk-exynos990.c                | 1240 +++++++++++++++++++-
+ drivers/clk/samsung/clk-fsd.c                      |   28 +-
+ drivers/clk/samsung/clk-pll.c                      |  161 ++-
+ drivers/clk/samsung/clk-pll.h                      |    2 +
+ include/dt-bindings/clock/axis,artpec8-clk.h       |  169 +++
+ include/dt-bindings/clock/fsd-clk.h                |   13 +
+ include/dt-bindings/clock/samsung,exynos990.h      |  181 +++
+ 12 files changed, 3032 insertions(+), 56 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/clock/axis,artpec8-clock.yaml
+ create mode 100644 drivers/clk/samsung/clk-artpec8.c
+ create mode 100644 include/dt-bindings/clock/axis,artpec8-clk.h
+Merging scmi/for-linux-next (f7c0a4834a6b5 Merge branch 'for-next/ffa/updates' of ssh://gitolite.kernel.org/pub/scm/linux/kernel/git/sudeep.holla/linux into for-linux-next)
+$ git merge -m Merge branch 'for-linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sudeep.holla/linux.git scmi/for-linux-next
+Merge made by the 'ort' strategy.
+ drivers/firmware/arm_ffa/driver.c | 51 +++++++++++++++++++++++++++------------
+ include/linux/arm_ffa.h           | 21 ++++++++++++++--
+ 2 files changed, 55 insertions(+), 17 deletions(-)
+Merging sophgo/for-next (0251a1deaec78 Merge branch 'dt/riscv' into for-next)
+$ git merge -m Merge branch 'for-next' of https://github.com/sophgo/linux.git sophgo/for-next
+Merge made by the 'ort' strategy.
+Merging sophgo-soc/soc-for-next (c8754c7deab4c soc: sophgo: cv1800: rtcsys: New driver (handling RTC only))
+$ git merge -m Merge branch 'soc-for-next' of https://github.com/sophgo/linux.git sophgo-soc/soc-for-next
+Already up to date.
+Merging spacemit/for-next (d2b7cd9be23bd Merge branch 'spacemit-clk-for-6.18' into spacemit-for-next)
+$ git merge -m Merge branch 'for-next' of https://github.com/spacemit-com/linux spacemit/for-next
+Merge made by the 'ort' strategy.
+ drivers/clk/spacemit/ccu-k1.c                  | 29 ++++++++++++++++++++++----
+ drivers/clk/spacemit/ccu_ddn.c                 | 11 ++++++----
+ drivers/clk/spacemit/ccu_mix.c                 | 12 ++++++-----
+ drivers/clk/spacemit/ccu_pll.c                 | 10 +++++----
+ include/dt-bindings/clock/spacemit,k1-syscon.h |  2 ++
+ 5 files changed, 47 insertions(+), 17 deletions(-)
+Merging stm32/stm32-next (53c18dc078bb6 arm64: dts: st: fix memory region size on stm32mp235f-dk)
+$ git merge -m Merge branch 'stm32-next' of https://git.kernel.org/pub/scm/linux/kernel/git/atorgue/stm32.git stm32/stm32-next
+Already up to date.
+Merging sunxi/sunxi/for-next (40a65ba440d1a Merge branch 'sunxi/dt-for-6.18' into sunxi/for-next)
+$ git merge -m Merge branch 'sunxi/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sunxi/linux.git sunxi/sunxi/for-next
+Merge made by the 'ort' strategy.
+ drivers/clk/sunxi-ng/Kconfig               |   5 +
+ drivers/clk/sunxi-ng/Makefile              |   2 +
+ drivers/clk/sunxi-ng/ccu-sun55i-a523-mcu.c | 469 +++++++++++++++++++++++++++++
+ drivers/clk/sunxi-ng/ccu-sun55i-a523.c     |  21 +-
+ drivers/clk/sunxi-ng/ccu-sun55i-a523.h     |  14 -
+ drivers/clk/sunxi-ng/ccu-sun6i-rtc.c       |  11 +
+ drivers/clk/sunxi-ng/ccu_div.h             |  18 ++
+ 7 files changed, 523 insertions(+), 17 deletions(-)
+ create mode 100644 drivers/clk/sunxi-ng/ccu-sun55i-a523-mcu.c
+ delete mode 100644 drivers/clk/sunxi-ng/ccu-sun55i-a523.h
+Merging tee/next (fd956758aeed6 Merge branch 'tee_qcomtee_fixes_for_v6.18' into next)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/jenswi/linux-tee.git tee/next
+Merge made by the 'ort' strategy.
+ drivers/tee/qcomtee/call.c | 2 +-
+ drivers/tee/qcomtee/core.c | 2 +-
+ 2 files changed, 2 insertions(+), 2 deletions(-)
+Merging tegra/for-next (ed02736cab22e Merge branch for-6.18/arm64/dt into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/tegra/linux.git tegra/for-next
+Merge made by the 'ort' strategy.
+ drivers/clk/tegra/Kconfig                  |   2 +-
+ drivers/clk/tegra/clk-tegra114.c           |  30 +++++-
+ drivers/clk/tegra/clk-tegra124-dfll-fcpu.c | 158 ++++++++++++++++++++++++-----
+ drivers/clk/tegra/clk.h                    |   2 -
+ 4 files changed, 158 insertions(+), 34 deletions(-)
+Merging thead-dt/thead-dt-for-next (dfa743da83ab7 MAINTAINERS: Add RISC-V T-HEAD SoC patchwork)
+$ git merge -m Merge branch 'thead-dt-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git thead-dt/thead-dt-for-next
+Already up to date.
+Merging ti/ti-next (f406ed7770730 Merge branches 'ti-k3-dts-next' and 'ti-drivers-soc-next' into ti-next)
+$ git merge -m Merge branch 'ti-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ti/linux.git ti/ti-next
+Merge made by the 'ort' strategy.
+Merging xilinx/for-next (227cbbdee8c0c Merge branch 'zynqmp/dt' into for-next)
+$ git merge -m Merge branch 'for-next' of https://github.com/Xilinx/linux-xlnx.git xilinx/for-next
+Merge made by the 'ort' strategy.
+ drivers/firmware/xilinx/zynqmp-debug.c  |  13 ++++
+ drivers/firmware/xilinx/zynqmp.c        | 114 ++++++++++++++++++++++++--------
+ drivers/pinctrl/pinctrl-zynqmp.c        |   7 +-
+ drivers/soc/xilinx/xlnx_event_manager.c |   8 +--
+ drivers/soc/xilinx/zynqmp_power.c       |  10 +--
+ include/linux/firmware/xlnx-zynqmp.h    |  30 +++++----
+ 6 files changed, 128 insertions(+), 54 deletions(-)
+Merging clk/clk-next (db0809310d8e2 Merge branch 'clk-mediatek' into clk-next)
+$ git merge -m Merge branch 'clk-next' of https://git.kernel.org/pub/scm/linux/kernel/git/clk/linux.git clk/clk-next
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/clock/adi,axi-clkgen.yaml  |    4 +
+ .../bindings/clock/fujitsu,mb86s70-crg11.txt       |   26 -
+ .../bindings/clock/mediatek,mt8196-clock.yaml      |  112 ++
+ .../bindings/clock/mediatek,mt8196-sys-clock.yaml  |  107 +
+ .../devicetree/bindings/clock/mediatek,syscon.yaml |   15 +
+ .../devicetree/bindings/clock/samsung,s2mps11.yaml |    1 +
+ .../devicetree/bindings/clock/silabs,si514.txt     |   24 -
+ .../devicetree/bindings/clock/silabs,si5341.txt    |  175 --
+ .../devicetree/bindings/clock/silabs,si5341.yaml   |  223 +++
+ .../devicetree/bindings/clock/silabs,si544.txt     |   25 -
+ .../devicetree/bindings/clock/silabs,si544.yaml    |   54 +
+ .../devicetree/bindings/clock/silabs,si570.txt     |   41 -
+ .../devicetree/bindings/clock/silabs,si570.yaml    |   80 +
+ .../bindings/clock/st,stm32mp21-rcc.yaml           |  199 ++
+ .../bindings/clock/st,stm32mp25-rcc.yaml           |   13 +-
+ .../devicetree/bindings/clock/st/st,flexgen.txt    |    3 -
+ MAINTAINERS                                        |    2 +
+ drivers/clk/Kconfig                                |    2 +
+ drivers/clk/actions/owl-common.c                   |    1 -
+ drivers/clk/actions/owl-composite.c                |    8 +-
+ drivers/clk/actions/owl-divider.c                  |   13 +-
+ drivers/clk/actions/owl-factor.c                   |   12 +-
+ drivers/clk/actions/owl-pll.c                      |   25 +-
+ drivers/clk/at91/clk-audio-pll.c                   |   42 +-
+ drivers/clk/at91/clk-h32mx.c                       |   33 +-
+ drivers/clk/at91/clk-peripheral.c                  |   48 +-
+ drivers/clk/at91/clk-pll.c                         |   12 +-
+ drivers/clk/at91/clk-plldiv.c                      |   34 +-
+ drivers/clk/at91/clk-sam9x60-pll.c                 |   29 +-
+ drivers/clk/at91/clk-usb.c                         |   20 +-
+ drivers/clk/axs10x/i2s_pll_clock.c                 |   14 +-
+ drivers/clk/axs10x/pll_clock.c                     |   12 +-
+ drivers/clk/baikal-t1/ccu-div.c                    |   27 +-
+ drivers/clk/baikal-t1/ccu-pll.c                    |   14 +-
+ drivers/clk/bcm/clk-iproc-asiu.c                   |   25 +-
+ drivers/clk/bcm/clk-raspberrypi.c                  |   72 +-
+ drivers/clk/clk-apple-nco.c                        |   14 +-
+ drivers/clk/clk-axi-clkgen.c                       |    2 +-
+ drivers/clk/clk-axm5516.c                          |    1 -
+ drivers/clk/clk-bm1880.c                           |   21 +-
+ drivers/clk/clk-cdce706.c                          |   16 +-
+ drivers/clk/clk-cdce925.c                          |   50 +-
+ drivers/clk/clk-cs2000-cp.c                        |   14 +-
+ drivers/clk/clk-divider.c                          |   23 -
+ drivers/clk/clk-ep93xx.c                           |   18 +-
+ drivers/clk/clk-fixed-factor.c                     |   16 +-
+ drivers/clk/clk-fractional-divider.c               |   25 +-
+ drivers/clk/clk-gemini.c                           |   15 +-
+ drivers/clk/clk-highbank.c                         |   26 +-
+ drivers/clk/clk-hsdk-pll.c                         |   12 +-
+ drivers/clk/clk-lmk04832.c                         |   53 +-
+ drivers/clk/clk-loongson1.c                        |   12 +-
+ drivers/clk/clk-max9485.c                          |   27 +-
+ drivers/clk/clk-milbeaut.c                         |   22 +-
+ drivers/clk/clk-multiplier.c                       |   12 +-
+ drivers/clk/clk-s2mps11.c                          |    8 +
+ drivers/clk/clk-scmi.c                             |   46 +-
+ drivers/clk/clk-scpi.c                             |   18 +-
+ drivers/clk/clk-si514.c                            |   24 +-
+ drivers/clk/clk-si521xx.c                          |   14 +-
+ drivers/clk/clk-si5341.c                           |   22 +-
+ drivers/clk/clk-si544.c                            |   10 +-
+ drivers/clk/clk-si570.c                            |   26 +-
+ drivers/clk/clk-sp7021.c                           |   22 +-
+ drivers/clk/clk-sparx5.c                           |   10 +-
+ drivers/clk/clk-stm32f4.c                          |   26 +-
+ drivers/clk/clk-tps68470.c                         |   12 +-
+ drivers/clk/clk-versaclock3.c                      |   70 +-
+ drivers/clk/clk-versaclock5.c                      |   71 +-
+ drivers/clk/clk-versaclock7.c                      |   30 +-
+ drivers/clk/clk-vt8500.c                           |   59 +-
+ drivers/clk/clk-wm831x.c                           |   14 +-
+ drivers/clk/clk-xgene.c                            |   41 +-
+ drivers/clk/clk.c                                  |   66 +-
+ drivers/clk/hisilicon/clk-hi3660-stub.c            |   18 +-
+ drivers/clk/hisilicon/clk-hi6220-stub.c            |   12 +-
+ drivers/clk/hisilicon/clkdivider-hi6220.c          |   12 +-
+ drivers/clk/imx/clk-imx95-blk-ctl.c                |   57 +-
+ drivers/clk/ingenic/cgu.c                          |   12 +-
+ drivers/clk/ingenic/jz4780-cgu.c                   |   24 +-
+ drivers/clk/ingenic/x1000-cgu.c                    |   19 +-
+ drivers/clk/keystone/sci-clk.c                     |    5 +-
+ drivers/clk/mediatek/Kconfig                       |   71 +
+ drivers/clk/mediatek/Makefile                      |   13 +
+ drivers/clk/mediatek/clk-gate.c                    |  117 +-
+ drivers/clk/mediatek/clk-gate.h                    |    3 +
+ drivers/clk/mediatek/clk-mt7622-aud.c              |    1 +
+ drivers/clk/mediatek/clk-mt8195-infra_ao.c         |    2 +-
+ drivers/clk/mediatek/clk-mt8196-apmixedsys.c       |  204 ++
+ drivers/clk/mediatek/clk-mt8196-disp0.c            |  170 ++
+ drivers/clk/mediatek/clk-mt8196-disp1.c            |  170 ++
+ drivers/clk/mediatek/clk-mt8196-imp_iic_wrap.c     |  118 ++
+ drivers/clk/mediatek/clk-mt8196-mcu.c              |  167 ++
+ drivers/clk/mediatek/clk-mt8196-mdpsys.c           |  186 ++
+ drivers/clk/mediatek/clk-mt8196-mfg.c              |  150 ++
+ drivers/clk/mediatek/clk-mt8196-ovl0.c             |  154 ++
+ drivers/clk/mediatek/clk-mt8196-ovl1.c             |  154 ++
+ drivers/clk/mediatek/clk-mt8196-peri_ao.c          |  142 ++
+ drivers/clk/mediatek/clk-mt8196-pextp.c            |  131 ++
+ drivers/clk/mediatek/clk-mt8196-topckgen.c         |  985 ++++++++++
+ drivers/clk/mediatek/clk-mt8196-topckgen2.c        |  568 ++++++
+ drivers/clk/mediatek/clk-mt8196-ufs_ao.c           |  108 ++
+ drivers/clk/mediatek/clk-mt8196-vdec.c             |  253 +++
+ drivers/clk/mediatek/clk-mt8196-vdisp_ao.c         |   80 +
+ drivers/clk/mediatek/clk-mt8196-venc.c             |  236 +++
+ drivers/clk/mediatek/clk-mt8196-vlpckgen.c         |  725 +++++++
+ drivers/clk/mediatek/clk-mtk.c                     |   16 +
+ drivers/clk/mediatek/clk-mtk.h                     |   22 +
+ drivers/clk/mediatek/clk-mux.c                     |  122 +-
+ drivers/clk/mediatek/clk-mux.h                     |   87 +
+ drivers/clk/mediatek/clk-pll.c                     |   58 +-
+ drivers/clk/mediatek/clk-pll.h                     |   11 +-
+ drivers/clk/mediatek/clk-pllfh.c                   |    2 +-
+ drivers/clk/meson/Kconfig                          |   13 +-
+ drivers/clk/meson/Makefile                         |    1 -
+ drivers/clk/meson/a1-peripherals.c                 |  999 +++++-----
+ drivers/clk/meson/a1-pll.c                         |  124 +-
+ drivers/clk/meson/axg-aoclk.c                      |  153 +-
+ drivers/clk/meson/axg.c                            |  231 +--
+ drivers/clk/meson/c3-peripherals.c                 | 2001 +++++--------------
+ drivers/clk/meson/c3-pll.c                         |  239 +--
+ drivers/clk/meson/clk-regmap.h                     |   20 -
+ drivers/clk/meson/g12a-aoclk.c                     |  238 +--
+ drivers/clk/meson/g12a.c                           | 2052 ++++++++++----------
+ drivers/clk/meson/gxbb-aoclk.c                     |  123 +-
+ drivers/clk/meson/gxbb.c                           |  603 +++---
+ drivers/clk/meson/meson-aoclk.c                    |   32 +-
+ drivers/clk/meson/meson-aoclk.h                    |    2 +-
+ drivers/clk/meson/meson-clkc-utils.c               |   86 +-
+ drivers/clk/meson/meson-clkc-utils.h               |   89 +
+ drivers/clk/meson/meson-eeclk.c                    |   60 -
+ drivers/clk/meson/meson-eeclk.h                    |   24 -
+ drivers/clk/meson/meson8-ddr.c                     |   64 +-
+ drivers/clk/meson/meson8b.c                        |  734 ++++---
+ drivers/clk/meson/s4-peripherals.c                 | 1158 ++++-------
+ drivers/clk/meson/s4-pll.c                         |   82 +-
+ drivers/clk/microchip/clk-core.c                   |   44 +-
+ drivers/clk/mmp/Kconfig                            |   10 +
+ drivers/clk/mmp/Makefile                           |    5 +-
+ drivers/clk/mmp/clk-audio.c                        |   18 +-
+ drivers/clk/mmp/clk-frac.c                         |   27 +-
+ drivers/clk/mmp/clk-pxa1908-apmu.c                 |    7 +
+ drivers/clk/mstar/clk-msc313-cpupll.c              |   18 +-
+ drivers/clk/mvebu/ap-cpu-clk.c                     |   12 +-
+ drivers/clk/mvebu/armada-37xx-periph.c             |   15 +-
+ drivers/clk/mvebu/clk-corediv.c                    |   18 +-
+ drivers/clk/mvebu/clk-cpu.c                        |   12 +-
+ drivers/clk/mvebu/dove-divider.c                   |   16 +-
+ drivers/clk/mxs/clk-div.c                          |    8 +-
+ drivers/clk/mxs/clk-frac.c                         |   16 +-
+ drivers/clk/mxs/clk-ref.c                          |   16 +-
+ drivers/clk/nuvoton/clk-ma35d1-divider.c           |   12 +-
+ drivers/clk/nuvoton/clk-ma35d1-pll.c               |   28 +-
+ drivers/clk/nxp/clk-lpc18xx-cgu.c                  |   16 +-
+ drivers/clk/nxp/clk-lpc32xx.c                      |   60 +-
+ drivers/clk/pistachio/clk-pll.c                    |   20 +-
+ drivers/clk/qcom/a53-pll.c                         |    1 -
+ drivers/clk/qcom/a7-pll.c                          |    1 -
+ drivers/clk/qcom/apss-ipq-pll.c                    |    1 -
+ drivers/clk/qcom/clk-cbf-8996.c                    |    1 -
+ drivers/clk/qcom/clk-cpu-8996.c                    |    1 -
+ drivers/clk/qcom/clk-regmap-divider.c              |   27 +-
+ drivers/clk/qcom/hfpll.c                           |    1 -
+ drivers/clk/qcom/ipq-cmn-pll.c                     |    1 -
+ drivers/clk/renesas/r9a07g043-cpg.c                |  140 +-
+ drivers/clk/renesas/r9a07g044-cpg.c                |  162 +-
+ drivers/clk/renesas/r9a08g045-cpg.c                |   29 +-
+ drivers/clk/renesas/r9a09g047-cpg.c                |   36 +-
+ drivers/clk/renesas/r9a09g056-cpg.c                |   16 +-
+ drivers/clk/renesas/r9a09g057-cpg.c                |   11 +-
+ drivers/clk/renesas/r9a09g077-cpg.c                |   41 +-
+ drivers/clk/renesas/renesas-cpg-mssr.c             |    7 +-
+ drivers/clk/renesas/rzg2l-cpg.c                    |   61 +-
+ drivers/clk/renesas/rzg2l-cpg.h                    |    1 +
+ drivers/clk/renesas/rzv2h-cpg.c                    |   22 +-
+ drivers/clk/rockchip/clk-ddr.c                     |   13 +-
+ drivers/clk/rockchip/clk-half-divider.c            |   12 +-
+ drivers/clk/rockchip/clk-pll.c                     |   23 +-
+ drivers/clk/sifive/fu540-prci.h                    |    2 +-
+ drivers/clk/sifive/fu740-prci.h                    |    2 +-
+ drivers/clk/sifive/sifive-prci.c                   |   11 +-
+ drivers/clk/sifive/sifive-prci.h                   |    4 +-
+ drivers/clk/sophgo/clk-cv18xx-ip.c                 |   10 +-
+ drivers/clk/sophgo/clk-sg2042-clkgen.c             |   17 +-
+ drivers/clk/sophgo/clk-sg2042-pll.c                |   28 +-
+ drivers/clk/spacemit/ccu-k1.c                      |   32 +-
+ drivers/clk/spacemit/ccu_ddn.c                     |   12 +-
+ drivers/clk/spacemit/ccu_ddn.h                     |    6 +-
+ drivers/clk/spear/clk-aux-synth.c                  |   12 +-
+ drivers/clk/spear/clk-frac-synth.c                 |   12 +-
+ drivers/clk/spear/clk-gpt-synth.c                  |   12 +-
+ drivers/clk/spear/clk-vco-pll.c                    |   23 +-
+ drivers/clk/sprd/div.c                             |   13 +-
+ drivers/clk/sprd/pll.c                             |    8 +-
+ drivers/clk/st/clk-flexgen.c                       |   80 -
+ drivers/clk/st/clkgen-fsyn.c                       |   33 +-
+ drivers/clk/st/clkgen-pll.c                        |   38 +-
+ drivers/clk/stm32/Kconfig                          |    7 +
+ drivers/clk/stm32/Makefile                         |    1 +
+ drivers/clk/stm32/clk-stm32-core.c                 |   28 +-
+ drivers/clk/stm32/clk-stm32mp1.c                   |   13 +-
+ drivers/clk/stm32/clk-stm32mp21.c                  | 1586 +++++++++++++++
+ drivers/clk/stm32/stm32mp21_rcc.h                  |  651 +++++++
+ drivers/clk/tegra/clk-audio-sync.c                 |   10 +-
+ drivers/clk/tegra/clk-dfll.c                       |    2 +-
+ drivers/clk/tegra/clk-divider.c                    |   28 +-
+ drivers/clk/tegra/clk-periph.c                     |    8 +-
+ drivers/clk/tegra/clk-pll.c                        |   52 +-
+ drivers/clk/tegra/clk-super.c                      |    9 +-
+ drivers/clk/tegra/clk-tegra210-emc.c               |   26 +-
+ drivers/clk/thead/clk-th1520-ap.c                  |  500 +++--
+ drivers/clk/ti/clk-33xx.c                          |    2 +
+ drivers/clk/ti/clk-dra7-atl.c                      |   12 +-
+ drivers/clk/ti/clkt_dpll.c                         |   36 +-
+ drivers/clk/ti/clock.h                             |    6 +-
+ drivers/clk/ti/composite.c                         |    6 +-
+ drivers/clk/ti/divider.c                           |   12 +-
+ drivers/clk/ti/dpll.c                              |   10 +-
+ drivers/clk/ti/dpll3xxx.c                          |    7 +-
+ drivers/clk/ti/dpll44xx.c                          |   89 +-
+ drivers/clk/ti/fapll.c                             |   48 +-
+ drivers/clk/ux500/clk-prcmu.c                      |   14 +-
+ drivers/clk/versatile/clk-icst.c                   |   72 +-
+ drivers/clk/versatile/clk-vexpress-osc.c           |   16 +-
+ drivers/clk/visconti/pll.c                         |   17 +-
+ drivers/clk/x86/clk-cgu.c                          |   35 +-
+ drivers/clk/xilinx/clk-xlnx-clock-wizard.c         |   87 +-
+ drivers/clk/xilinx/xlnx_vcu.c                      |   15 +-
+ drivers/clk/zynq/pll.c                             |   12 +-
+ drivers/clk/zynqmp/divider.c                       |   23 +-
+ drivers/clk/zynqmp/pll.c                           |   24 +-
+ include/dt-bindings/clock/mediatek,mt8196-clock.h  |  803 ++++++++
+ include/dt-bindings/clock/mt7622-clk.h             |    2 +-
+ include/dt-bindings/clock/renesas,r9a09g047-cpg.h  |    2 +
+ .../dt-bindings/clock/renesas,r9a09g077-cpg-mssr.h |    5 +
+ .../dt-bindings/clock/renesas,r9a09g087-cpg-mssr.h |    5 +
+ include/dt-bindings/clock/spacemit,k1-syscon.h     |    4 +
+ include/dt-bindings/clock/st,stm32mp21-rcc.h       |  426 ++++
+ include/dt-bindings/reset/mediatek,mt8196-resets.h |   26 +
+ include/dt-bindings/reset/st,stm32mp21-rcc.h       |  138 ++
+ include/linux/clk/ti.h                             |    8 +-
+ include/soc/spacemit/k1-syscon.h                   |    1 +
+ 242 files changed, 15740 insertions(+), 7513 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/clock/fujitsu,mb86s70-crg11.txt
+ create mode 100644 Documentation/devicetree/bindings/clock/mediatek,mt8196-clock.yaml
+ create mode 100644 Documentation/devicetree/bindings/clock/mediatek,mt8196-sys-clock.yaml
+ delete mode 100644 Documentation/devicetree/bindings/clock/silabs,si514.txt
+ delete mode 100644 Documentation/devicetree/bindings/clock/silabs,si5341.txt
+ create mode 100644 Documentation/devicetree/bindings/clock/silabs,si5341.yaml
+ delete mode 100644 Documentation/devicetree/bindings/clock/silabs,si544.txt
+ create mode 100644 Documentation/devicetree/bindings/clock/silabs,si544.yaml
+ delete mode 100644 Documentation/devicetree/bindings/clock/silabs,si570.txt
+ create mode 100644 Documentation/devicetree/bindings/clock/silabs,si570.yaml
+ create mode 100644 Documentation/devicetree/bindings/clock/st,stm32mp21-rcc.yaml
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-apmixedsys.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-disp0.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-disp1.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-imp_iic_wrap.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-mcu.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-mdpsys.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-mfg.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-ovl0.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-ovl1.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-peri_ao.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-pextp.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-topckgen.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-topckgen2.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-ufs_ao.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-vdec.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-vdisp_ao.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-venc.c
+ create mode 100644 drivers/clk/mediatek/clk-mt8196-vlpckgen.c
+ delete mode 100644 drivers/clk/meson/meson-eeclk.c
+ delete mode 100644 drivers/clk/meson/meson-eeclk.h
+ create mode 100644 drivers/clk/mmp/Kconfig
+ create mode 100644 drivers/clk/stm32/clk-stm32mp21.c
+ create mode 100644 drivers/clk/stm32/stm32mp21_rcc.h
+ create mode 100644 include/dt-bindings/clock/mediatek,mt8196-clock.h
+ create mode 100644 include/dt-bindings/clock/st,stm32mp21-rcc.h
+ create mode 100644 include/dt-bindings/reset/mediatek,mt8196-resets.h
+ create mode 100644 include/dt-bindings/reset/st,stm32mp21-rcc.h
+Merging clk-imx/for-next (14be8b7b6cbc0 clk: imx95-blk-ctl: Save/restore registers when RPM routines are called)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/abelvesa/linux.git clk-imx/for-next
+Already up to date.
+Merging clk-renesas/renesas-clk (b5788b96cba97 clk: renesas: r9a09g05[67]: Reduce differences)
+$ git merge -m Merge branch 'renesas-clk' of https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-drivers.git clk-renesas/renesas-clk
+Already up to date.
+Merging thead-clk/thead-clk-for-next (c567bc5fc68c4 clk: thead: th1520-ap: set all AXI clocks to CLK_IS_CRITICAL)
+$ git merge -m Merge branch 'thead-clk-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/fustini/linux.git thead-clk/thead-clk-for-next
+Already up to date.
+Merging csky/linux-next (2b48804336be6 csky: fix csky_cmpxchg_fixup not working)
+$ git merge -m Merge branch 'linux-next' of https://github.com/c-sky/csky-linux.git csky/linux-next
+Auto-merging arch/csky/mm/fault.c
+Merge made by the 'ort' strategy.
+ arch/csky/mm/fault.c | 4 ++--
+ 1 file changed, 2 insertions(+), 2 deletions(-)
+Merging loongarch/loongarch-next (66e2d96b1c587 LoongArch: KVM: Move kvm_iocsr tracepoint out of generic code)
+$ git merge -m Merge branch 'loongarch-next' of https://git.kernel.org/pub/scm/linux/kernel/git/chenhuacai/linux-loongson.git loongarch/loongarch-next
+Merge made by the 'ort' strategy.
+ arch/loongarch/include/asm/kvm_pch_pic.h |  15 +-
+ arch/loongarch/include/uapi/asm/kvm.h    |   1 +
+ arch/loongarch/kvm/exit.c                |  19 +--
+ arch/loongarch/kvm/intc/ipi.c            |  80 ++++++-----
+ arch/loongarch/kvm/intc/pch_pic.c        | 239 +++++++++++++------------------
+ arch/loongarch/kvm/trace.h               |  35 +++++
+ arch/loongarch/kvm/vcpu.c                |   2 +
+ arch/loongarch/kvm/vm.c                  |   4 +
+ include/trace/events/kvm.h               |  35 -----
+ 9 files changed, 211 insertions(+), 219 deletions(-)
+Merging m68k/for-next (695f2c0c25f3c m68k: defconfig: Update defconfigs for v6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/geert/linux-m68k.git m68k/for-next
+Already up to date.
+Merging m68knommu/for-next (07e27ad16399a Linux 6.17-rc7)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gerg/m68knommu.git m68knommu/for-next
+Already up to date.
+Merging microblaze/next (438f7cd41765d microblaze: Replace __ASSEMBLY__ with __ASSEMBLER__ in non-uapi headers)
+$ git merge -m Merge branch 'next' of git://git.monstr.eu/linux-2.6-microblaze.git microblaze/next
+Auto-merging arch/microblaze/include/asm/pgtable.h
+Merge made by the 'ort' strategy.
+ arch/microblaze/Kconfig.platform                | 10 +++++-----
+ arch/microblaze/include/asm/asm-compat.h        |  2 +-
+ arch/microblaze/include/asm/current.h           |  4 ++--
+ arch/microblaze/include/asm/entry.h             |  4 ++--
+ arch/microblaze/include/asm/exceptions.h        |  4 ++--
+ arch/microblaze/include/asm/fixmap.h            |  4 ++--
+ arch/microblaze/include/asm/ftrace.h            |  2 +-
+ arch/microblaze/include/asm/kgdb.h              |  4 ++--
+ arch/microblaze/include/asm/mmu.h               |  4 ++--
+ arch/microblaze/include/asm/page.h              |  8 ++++----
+ arch/microblaze/include/asm/pgtable.h           | 18 +++++++++---------
+ arch/microblaze/include/asm/processor.h         |  8 ++++----
+ arch/microblaze/include/asm/ptrace.h            |  4 ++--
+ arch/microblaze/include/asm/sections.h          |  4 ++--
+ arch/microblaze/include/asm/setup.h             |  4 ++--
+ arch/microblaze/include/asm/thread_info.h       |  4 ++--
+ arch/microblaze/include/asm/unistd.h            |  4 ++--
+ arch/microblaze/include/asm/xilinx_mb_manager.h |  4 ++--
+ arch/microblaze/include/uapi/asm/ptrace.h       |  4 ++--
+ 19 files changed, 50 insertions(+), 50 deletions(-)
+Merging mips/mips-next (c662a6fef10af mips: math-emu: replace deprecated strcpy() in me-debugfs)
+$ git merge -m Merge branch 'mips-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mips/linux.git mips/mips-next
+Auto-merging MAINTAINERS
+Auto-merging arch/mips/Kconfig
+Merge made by the 'ort' strategy.
+ Documentation/devicetree/bindings/mips/cpus.yaml   |   1 +
+ .../devicetree/bindings/mips/loongson/devices.yaml |   2 +
+ MAINTAINERS                                        |   3 +-
+ arch/mips/Kconfig                                  |  64 ++---
+ arch/mips/alchemy/common/clock.c                   |  20 +-
+ arch/mips/boot/dts/Makefile                        |   1 +
+ arch/mips/boot/dts/brcm/bcm7346.dtsi               |   3 +-
+ arch/mips/boot/dts/brcm/bcm7360.dtsi               |   3 +-
+ arch/mips/boot/dts/brcm/bcm7362.dtsi               |   3 +-
+ arch/mips/boot/dts/brcm/bcm7425.dtsi               |   6 +-
+ arch/mips/boot/dts/brcm/bcm7435.dtsi               |   6 +-
+ arch/mips/boot/dts/lantiq/danube.dtsi              |   6 +
+ arch/mips/boot/dts/lantiq/danube_easy50712.dts     |   4 +-
+ arch/mips/boot/dts/loongson/Makefile               |  10 +
+ arch/mips/boot/dts/loongson/cq-t300b.dts           | 110 ++++++++
+ arch/mips/boot/dts/loongson/loongson1.dtsi         | 136 ++++++++++
+ arch/mips/boot/dts/loongson/loongson1b.dtsi        | 198 ++++++++++++++
+ arch/mips/boot/dts/loongson/loongson1c.dtsi        | 141 ++++++++++
+ arch/mips/boot/dts/loongson/ls1b-demo.dts          | 125 +++++++++
+ arch/mips/boot/dts/loongson/lsgz_1b_dev.dts        | 162 ++++++++++++
+ arch/mips/boot/dts/loongson/smartloong-1c.dts      | 110 ++++++++
+ arch/mips/cavium-octeon/executive/octeon-model.c   |  31 +--
+ arch/mips/cavium-octeon/octeon-platform.c          |   4 +-
+ arch/mips/cavium-octeon/smp.c                      |   2 +-
+ .../{loongson1b_defconfig => loongson1_defconfig}  |  94 +++++--
+ arch/mips/configs/loongson1c_defconfig             | 121 ---------
+ arch/mips/fw/arc/cmdline.c                         |  22 +-
+ arch/mips/generic/board-ocelot.c                   |   3 +-
+ arch/mips/include/asm/addrspace.h                  |   4 +-
+ arch/mips/include/asm/asm-eva.h                    |   6 +-
+ arch/mips/include/asm/asm.h                        |   8 +-
+ arch/mips/include/asm/bmips.h                      |   4 +-
+ arch/mips/include/asm/cpu-type.h                   |   3 +-
+ arch/mips/include/asm/cpu.h                        |   7 +-
+ arch/mips/include/asm/dec/ecc.h                    |   2 +-
+ arch/mips/include/asm/dec/interrupts.h             |   4 +-
+ arch/mips/include/asm/dec/kn01.h                   |   2 +-
+ arch/mips/include/asm/dec/kn02.h                   |   2 +-
+ arch/mips/include/asm/dec/kn02xa.h                 |   2 +-
+ arch/mips/include/asm/eva.h                        |   4 +-
+ arch/mips/include/asm/ftrace.h                     |   8 +-
+ arch/mips/include/asm/hazards.h                    |   4 +-
+ arch/mips/include/asm/irqflags.h                   |   4 +-
+ arch/mips/include/asm/jazz.h                       |  16 +-
+ arch/mips/include/asm/jump_label.h                 |   4 +-
+ arch/mips/include/asm/linkage.h                    |   2 +-
+ arch/mips/include/asm/mach-generic/spaces.h        |   4 +-
+ arch/mips/include/asm/mach-loongson32/irq.h        | 107 --------
+ arch/mips/include/asm/mach-loongson32/loongson1.h  |  50 ----
+ arch/mips/include/asm/mach-loongson32/platform.h   |  23 --
+ arch/mips/include/asm/mach-loongson32/regs-mux.h   | 124 ---------
+ arch/mips/include/asm/mips-boards/bonito64.h       |   4 +-
+ arch/mips/include/asm/mipsmtregs.h                 |   6 +-
+ arch/mips/include/asm/mipsregs.h                   |   6 +-
+ arch/mips/include/asm/msa.h                        |   4 +-
+ arch/mips/include/asm/pci/bridge.h                 |   4 +-
+ arch/mips/include/asm/pm.h                         |   6 +-
+ arch/mips/include/asm/prefetch.h                   |   2 +-
+ arch/mips/include/asm/regdef.h                     |   4 +-
+ arch/mips/include/asm/sibyte/board.h               |   4 +-
+ arch/mips/include/asm/sibyte/sb1250.h              |   2 +-
+ arch/mips/include/asm/sibyte/sb1250_defs.h         |   6 +-
+ arch/mips/include/asm/smp-cps.h                    |   6 +-
+ arch/mips/include/asm/sn/addrs.h                   |  18 +-
+ arch/mips/include/asm/sn/gda.h                     |   4 +-
+ arch/mips/include/asm/sn/kldir.h                   |   4 +-
+ arch/mips/include/asm/sn/klkernvars.h              |   4 +-
+ arch/mips/include/asm/sn/launch.h                  |   4 +-
+ arch/mips/include/asm/sn/nmi.h                     |   8 +-
+ arch/mips/include/asm/sn/sn0/addrs.h               |  14 +-
+ arch/mips/include/asm/sn/sn0/hub.h                 |   2 +-
+ arch/mips/include/asm/sn/sn0/hubio.h               |  36 +--
+ arch/mips/include/asm/sn/sn0/hubmd.h               |   4 +-
+ arch/mips/include/asm/sn/sn0/hubni.h               |   6 +-
+ arch/mips/include/asm/sn/sn0/hubpi.h               |   4 +-
+ arch/mips/include/asm/sn/types.h                   |   2 +-
+ arch/mips/include/asm/sync.h                       |   2 +-
+ arch/mips/include/asm/thread_info.h                |   4 +-
+ arch/mips/include/asm/unistd.h                     |   4 +-
+ arch/mips/include/asm/vdso/gettimeofday.h          |   4 +-
+ arch/mips/include/asm/vdso/processor.h             |   4 +-
+ arch/mips/include/asm/vdso/vdso.h                  |   4 +-
+ arch/mips/include/asm/vdso/vsyscall.h              |   4 +-
+ arch/mips/include/asm/xtalk/xtalk.h                |   4 +-
+ arch/mips/include/asm/xtalk/xwidget.h              |   4 +-
+ arch/mips/kernel/cpu-probe.c                       |   6 +-
+ arch/mips/lantiq/xway/sysctrl.c                    |   2 +-
+ arch/mips/loongson32/Kconfig                       |  43 +---
+ arch/mips/loongson32/Makefile                      |  17 --
+ arch/mips/loongson32/Platform                      |   1 -
+ arch/mips/loongson32/common/Makefile               |   6 -
+ arch/mips/loongson32/common/irq.c                  | 191 --------------
+ arch/mips/loongson32/common/platform.c             | 285 ---------------------
+ arch/mips/loongson32/common/prom.c                 |  42 ---
+ arch/mips/loongson32/common/setup.c                |  26 --
+ arch/mips/loongson32/common/time.c                 |  23 --
+ arch/mips/loongson32/ls1b/Makefile                 |   6 -
+ arch/mips/loongson32/ls1b/board.c                  |  55 ----
+ arch/mips/loongson32/ls1c/Makefile                 |   6 -
+ arch/mips/loongson32/ls1c/board.c                  |  23 --
+ arch/mips/loongson64/boardinfo.c                   |   9 +-
+ arch/mips/math-emu/me-debugfs.c                    |   6 +-
+ arch/mips/rb532/prom.c                             |  17 +-
+ arch/mips/sgi-ip22/ip22-setup.c                    |   3 +-
+ arch/mips/sgi-ip32/ip32-setup.c                    |   3 +-
+ arch/mips/sni/setup.c                              |   3 +-
+ arch/mips/txx9/generic/setup.c                     |   4 +-
+ drivers/soc/bcm/brcmstb/pm/pm.h                    |   2 +-
+ 108 files changed, 1356 insertions(+), 1406 deletions(-)
+ create mode 100644 arch/mips/boot/dts/loongson/cq-t300b.dts
+ create mode 100644 arch/mips/boot/dts/loongson/loongson1.dtsi
+ create mode 100644 arch/mips/boot/dts/loongson/loongson1b.dtsi
+ create mode 100644 arch/mips/boot/dts/loongson/loongson1c.dtsi
+ create mode 100644 arch/mips/boot/dts/loongson/ls1b-demo.dts
+ create mode 100644 arch/mips/boot/dts/loongson/lsgz_1b_dev.dts
+ create mode 100644 arch/mips/boot/dts/loongson/smartloong-1c.dts
+ rename arch/mips/configs/{loongson1b_defconfig => loongson1_defconfig} (51%)
+ delete mode 100644 arch/mips/configs/loongson1c_defconfig
+ delete mode 100644 arch/mips/include/asm/mach-loongson32/irq.h
+ delete mode 100644 arch/mips/include/asm/mach-loongson32/loongson1.h
+ delete mode 100644 arch/mips/include/asm/mach-loongson32/platform.h
+ delete mode 100644 arch/mips/include/asm/mach-loongson32/regs-mux.h
+ delete mode 100644 arch/mips/loongson32/common/Makefile
+ delete mode 100644 arch/mips/loongson32/common/irq.c
+ delete mode 100644 arch/mips/loongson32/common/platform.c
+ delete mode 100644 arch/mips/loongson32/common/prom.c
+ delete mode 100644 arch/mips/loongson32/common/setup.c
+ delete mode 100644 arch/mips/loongson32/common/time.c
+ delete mode 100644 arch/mips/loongson32/ls1b/Makefile
+ delete mode 100644 arch/mips/loongson32/ls1b/board.c
+ delete mode 100644 arch/mips/loongson32/ls1c/Makefile
+ delete mode 100644 arch/mips/loongson32/ls1c/board.c
+Merging openrisc/for-next (8c30b0018f9d9 openrisc: Add jump label support)
+$ git merge -m Merge branch 'for-next' of https://github.com/openrisc/linux.git openrisc/for-next
+Merge made by the 'ort' strategy.
+ .../features/core/jump-labels/arch-support.txt     |  2 +-
+ arch/openrisc/Kconfig                              |  2 +
+ arch/openrisc/configs/or1ksim_defconfig            | 19 ++----
+ arch/openrisc/configs/virt_defconfig               |  2 +-
+ arch/openrisc/include/asm/Kbuild                   |  1 -
+ arch/openrisc/include/asm/fixmap.h                 |  1 +
+ arch/openrisc/include/asm/insn-def.h               | 15 ++++
+ arch/openrisc/include/asm/jump_label.h             | 72 ++++++++++++++++++++
+ arch/openrisc/include/asm/text-patching.h          | 13 ++++
+ arch/openrisc/kernel/Makefile                      |  2 +
+ arch/openrisc/kernel/jump_label.c                  | 51 ++++++++++++++
+ arch/openrisc/kernel/module.c                      |  4 ++
+ arch/openrisc/kernel/patching.c                    | 79 ++++++++++++++++++++++
+ arch/openrisc/kernel/setup.c                       |  2 +
+ arch/openrisc/mm/init.c                            |  6 +-
+ 15 files changed, 255 insertions(+), 16 deletions(-)
+ create mode 100644 arch/openrisc/include/asm/insn-def.h
+ create mode 100644 arch/openrisc/include/asm/jump_label.h
+ create mode 100644 arch/openrisc/include/asm/text-patching.h
+ create mode 100644 arch/openrisc/kernel/jump_label.c
+ create mode 100644 arch/openrisc/kernel/patching.c
+Merging parisc-hd/for-next (c12503903873f parisc: Remove spurious if statement from raw_copy_from_user())
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/deller/parisc-linux.git parisc-hd/for-next
+Merge made by the 'ort' strategy.
+ arch/parisc/lib/memcpy.c | 1 -
+ 1 file changed, 1 deletion(-)
+Merging powerpc/next (ef104054a3126 powerpc/pseries: Define __u{8,32} types in papr_hvpipe_hdr struct)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/powerpc/linux.git powerpc/next
+Auto-merging arch/powerpc/Kconfig
+Auto-merging arch/powerpc/include/asm/kasan.h
+Auto-merging arch/powerpc/platforms/Kconfig
+Auto-merging drivers/gpio/Kconfig
+Merge made by the 'ort' strategy.
+ .../testing/sysfs-bus-event_source-devices-vpa-dtl |  25 +
+ Documentation/arch/powerpc/index.rst               |   1 +
+ Documentation/arch/powerpc/vpa-dtl.rst             | 156 ++++
+ Documentation/userspace-api/ioctl/ioctl-number.rst |   2 +
+ arch/powerpc/Kconfig                               |   4 +-
+ arch/powerpc/Makefile                              |   2 +-
+ arch/powerpc/boot/page.h                           |   2 +-
+ arch/powerpc/boot/wrapper                          |   6 +-
+ arch/powerpc/include/asm/asm-const.h               |   2 +-
+ arch/powerpc/include/asm/barrier.h                 |   2 +-
+ arch/powerpc/include/asm/book3s/32/kup.h           |   4 +-
+ arch/powerpc/include/asm/book3s/32/mmu-hash.h      |   8 +-
+ arch/powerpc/include/asm/book3s/32/pgalloc.h       |  10 +-
+ arch/powerpc/include/asm/book3s/32/pgtable.h       |  12 +-
+ arch/powerpc/include/asm/book3s/64/hash-4k.h       |   4 +-
+ arch/powerpc/include/asm/book3s/64/hash-64k.h      |   4 +-
+ arch/powerpc/include/asm/book3s/64/hash.h          |   4 +-
+ arch/powerpc/include/asm/book3s/64/kup.h           |   6 +-
+ arch/powerpc/include/asm/book3s/64/mmu-hash.h      |  12 +-
+ arch/powerpc/include/asm/book3s/64/mmu.h           |   8 +-
+ arch/powerpc/include/asm/book3s/64/pgtable-64k.h   |   4 +-
+ arch/powerpc/include/asm/book3s/64/pgtable.h       |  10 +-
+ arch/powerpc/include/asm/book3s/64/radix.h         |   8 +-
+ arch/powerpc/include/asm/book3s/64/slice.h         |   4 +-
+ arch/powerpc/include/asm/bug.h                     |  14 +-
+ arch/powerpc/include/asm/cache.h                   |   4 +-
+ arch/powerpc/include/asm/cpu_has_feature.h         |   4 +-
+ arch/powerpc/include/asm/cpuidle.h                 |   2 +-
+ arch/powerpc/include/asm/cputable.h                |   8 +-
+ arch/powerpc/include/asm/cputhreads.h              |   4 +-
+ arch/powerpc/include/asm/dbell.h                   |  18 +-
+ arch/powerpc/include/asm/dcr-native.h              |   4 +-
+ arch/powerpc/include/asm/dcr.h                     |   4 +-
+ arch/powerpc/include/asm/epapr_hcalls.h            |   4 +-
+ arch/powerpc/include/asm/exception-64e.h           |   2 +-
+ arch/powerpc/include/asm/exception-64s.h           |   6 +-
+ arch/powerpc/include/asm/extable.h                 |   2 +-
+ arch/powerpc/include/asm/feature-fixups.h          |   6 +-
+ arch/powerpc/include/asm/firmware.h                |   4 +-
+ arch/powerpc/include/asm/fixmap.h                  |   4 +-
+ arch/powerpc/include/asm/fprobe.h                  |  12 +
+ arch/powerpc/include/asm/ftrace.h                  |  23 +-
+ arch/powerpc/include/asm/head-64.h                 |   4 +-
+ arch/powerpc/include/asm/hvcall.h                  |   4 +-
+ arch/powerpc/include/asm/hw_irq.h                  |   4 +-
+ arch/powerpc/include/asm/interrupt.h               |   4 +-
+ arch/powerpc/include/asm/irqflags.h                |   2 +-
+ arch/powerpc/include/asm/jump_label.h              |   2 +-
+ arch/powerpc/include/asm/kasan.h                   |   4 +-
+ arch/powerpc/include/asm/kdump.h                   |   4 +-
+ arch/powerpc/include/asm/kexec.h                   |   4 +-
+ arch/powerpc/include/asm/kgdb.h                    |   4 +-
+ arch/powerpc/include/asm/kup.h                     |   8 +-
+ arch/powerpc/include/asm/kvm_asm.h                 |   2 +-
+ arch/powerpc/include/asm/kvm_book3s_asm.h          |   6 +-
+ arch/powerpc/include/asm/kvm_booke_hv_asm.h        |   4 +-
+ arch/powerpc/include/asm/lv1call.h                 |   4 +-
+ arch/powerpc/include/asm/mmu.h                     |   8 +-
+ arch/powerpc/include/asm/module.h                  |   1 +
+ arch/powerpc/include/asm/mpc52xx.h                 |  12 +-
+ arch/powerpc/include/asm/nohash/32/kup-8xx.h       |   4 +-
+ arch/powerpc/include/asm/nohash/32/mmu-44x.h       |   4 +-
+ arch/powerpc/include/asm/nohash/32/mmu-8xx.h       |   4 +-
+ arch/powerpc/include/asm/nohash/32/pgtable.h       |  12 +-
+ arch/powerpc/include/asm/nohash/32/pte-8xx.h       |   2 +-
+ arch/powerpc/include/asm/nohash/64/pgtable-4k.h    |   8 +-
+ arch/powerpc/include/asm/nohash/64/pgtable.h       |   4 +-
+ arch/powerpc/include/asm/nohash/kup-booke.h        |   4 +-
+ arch/powerpc/include/asm/nohash/mmu-e500.h         |   4 +-
+ arch/powerpc/include/asm/nohash/pgalloc.h          |   2 +-
+ arch/powerpc/include/asm/nohash/pgtable.h          |   6 +-
+ arch/powerpc/include/asm/nohash/pte-e500.h         |   4 +-
+ arch/powerpc/include/asm/opal-api.h                |   4 +-
+ arch/powerpc/include/asm/opal.h                    |   4 +-
+ arch/powerpc/include/asm/page.h                    |  14 +-
+ arch/powerpc/include/asm/page_32.h                 |   4 +-
+ arch/powerpc/include/asm/page_64.h                 |   4 +-
+ arch/powerpc/include/asm/papr-sysparm.h            |   1 +
+ arch/powerpc/include/asm/pci-bridge.h              |   2 -
+ arch/powerpc/include/asm/pgtable.h                 |  20 +-
+ arch/powerpc/include/asm/ppc-opcode.h              |   1 +
+ arch/powerpc/include/asm/ppc_asm.h                 |   4 +-
+ arch/powerpc/include/asm/processor.h               |   8 +-
+ arch/powerpc/include/asm/ptrace.h                  |   6 +-
+ arch/powerpc/include/asm/reg.h                     |   6 +-
+ arch/powerpc/include/asm/reg_booke.h               |   4 +-
+ arch/powerpc/include/asm/reg_fsl_emb.h             |   4 +-
+ arch/powerpc/include/asm/rtas.h                    |   9 +
+ arch/powerpc/include/asm/setup.h                   |   4 +-
+ arch/powerpc/include/asm/smp.h                     |   4 +-
+ arch/powerpc/include/asm/spu_csa.h                 |   4 +-
+ arch/powerpc/include/asm/synch.h                   |   4 +-
+ arch/powerpc/include/asm/thread_info.h             |   8 +-
+ arch/powerpc/include/asm/time.h                    |   4 +
+ arch/powerpc/include/asm/tm.h                      |   4 +-
+ arch/powerpc/include/asm/types.h                   |   4 +-
+ arch/powerpc/include/asm/unistd.h                  |   4 +-
+ arch/powerpc/include/asm/vdso.h                    |   6 +-
+ arch/powerpc/include/asm/vdso/getrandom.h          |   4 +-
+ arch/powerpc/include/asm/vdso/gettimeofday.h       |   4 +-
+ arch/powerpc/include/asm/vdso/processor.h          |   4 +-
+ arch/powerpc/include/asm/vdso/vsyscall.h           |   4 +-
+ arch/powerpc/include/asm/vdso_datapage.h           |   6 +-
+ arch/powerpc/include/asm/xive.h                    |   1 -
+ arch/powerpc/include/uapi/asm/opal-prd.h           |   4 +-
+ arch/powerpc/include/uapi/asm/papr-hvpipe.h        |  33 +
+ arch/powerpc/include/uapi/asm/ptrace.h             |  12 +-
+ arch/powerpc/include/uapi/asm/types.h              |   4 +-
+ arch/powerpc/kernel/head_8xx.S                     |  25 +-
+ arch/powerpc/kernel/head_booke.h                   |   4 +-
+ arch/powerpc/kernel/module_64.c                    |  26 +-
+ arch/powerpc/kernel/rtas.c                         |  24 +
+ arch/powerpc/kernel/rtasd.c                        |   2 +
+ arch/powerpc/kernel/time.c                         |   8 +-
+ arch/powerpc/kernel/trace/ftrace.c                 |  10 +-
+ arch/powerpc/kernel/trace/ftrace_entry.S           |  42 +-
+ arch/powerpc/kernel/vdso.c                         |   3 +-
+ arch/powerpc/lib/qspinlock.c                       |  19 +-
+ arch/powerpc/mm/book3s32/mmu.c                     |   4 +-
+ arch/powerpc/mm/nohash/mmu_context.c               |  10 +-
+ arch/powerpc/mm/pgtable_32.c                       |   2 +-
+ arch/powerpc/net/bpf_jit.h                         |   8 +-
+ arch/powerpc/net/bpf_jit_comp.c                    |  32 +-
+ arch/powerpc/net/bpf_jit_comp32.c                  |   2 +-
+ arch/powerpc/net/bpf_jit_comp64.c                  | 401 +++++++---
+ arch/powerpc/perf/Makefile                         |   2 +-
+ arch/powerpc/perf/vpa-dtl.c                        | 596 +++++++++++++++
+ arch/powerpc/platforms/44x/Kconfig                 |   1 -
+ arch/powerpc/platforms/44x/gpio.c                  |  96 +--
+ arch/powerpc/platforms/8xx/Kconfig                 |   1 -
+ arch/powerpc/platforms/Kconfig                     |   1 -
+ arch/powerpc/platforms/powernv/Kconfig             |   1 +
+ arch/powerpc/platforms/powernv/pci-ioda.c          |  96 +--
+ arch/powerpc/platforms/powernv/subcore.h           |   4 +-
+ arch/powerpc/platforms/pseries/Kconfig             |   1 +
+ arch/powerpc/platforms/pseries/Makefile            |   1 +
+ arch/powerpc/platforms/pseries/mobility.c          |   3 +
+ arch/powerpc/platforms/pseries/msi.c               | 132 ++--
+ arch/powerpc/platforms/pseries/papr-hvpipe.c       | 818 +++++++++++++++++++++
+ arch/powerpc/platforms/pseries/papr-hvpipe.h       |  42 ++
+ arch/powerpc/sysdev/cpm_common.c                   |  56 +-
+ arch/powerpc/sysdev/xive/common.c                  |  63 +-
+ arch/powerpc/xmon/ppc-opc.c                        |  16 +-
+ arch/powerpc/xmon/xmon_bpts.h                      |   4 +-
+ drivers/gpio/Kconfig                               |   1 -
+ drivers/gpio/gpio-mpc5200.c                        |  78 +-
+ drivers/ps3/ps3stor_lib.c                          |   3 +-
+ include/linux/msi.h                                |   4 -
+ kernel/irq/msi.c                                   |   3 -
+ .../selftests/powerpc/include/instructions.h       |   2 +-
+ 150 files changed, 2660 insertions(+), 768 deletions(-)
+ create mode 100644 Documentation/ABI/testing/sysfs-bus-event_source-devices-vpa-dtl
+ create mode 100644 Documentation/arch/powerpc/vpa-dtl.rst
+ create mode 100644 arch/powerpc/include/asm/fprobe.h
+ create mode 100644 arch/powerpc/include/uapi/asm/papr-hvpipe.h
+ create mode 100644 arch/powerpc/perf/vpa-dtl.c
+ create mode 100644 arch/powerpc/platforms/pseries/papr-hvpipe.c
+ create mode 100644 arch/powerpc/platforms/pseries/papr-hvpipe.h
+Merging risc-v/for-next (41d7b9d85379c riscv: errata: Add ERRATA_THEAD_WRITE_ONCE fixup)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/riscv/linux.git risc-v/for-next
+Auto-merging Documentation/devicetree/bindings/riscv/extensions.yaml
+Auto-merging MAINTAINERS
+Auto-merging arch/riscv/Kconfig
+Auto-merging arch/riscv/configs/defconfig
+Auto-merging arch/riscv/include/asm/pgtable.h
+Auto-merging arch/riscv/mm/init.c
+Auto-merging drivers/clk/Kconfig
+Merge made by the 'ort' strategy.
+ Documentation/arch/riscv/hwprobe.rst               |    9 +
+ .../bindings/clock/riscv,rpmi-clock.yaml           |   64 ++
+ .../bindings/clock/riscv,rpmi-mpxy-clock.yaml      |   64 ++
+ .../riscv,rpmi-mpxy-system-msi.yaml                |   67 ++
+ .../riscv,rpmi-system-msi.yaml                     |   74 ++
+ .../bindings/mailbox/riscv,rpmi-shmem-mbox.yaml    |  124 +++
+ .../bindings/mailbox/riscv,sbi-mpxy-mbox.yaml      |   51 +
+ .../devicetree/bindings/riscv/extensions.yaml      |    6 +
+ MAINTAINERS                                        |   15 +
+ arch/riscv/Kconfig                                 |    1 +
+ arch/riscv/Kconfig.errata                          |   40 +
+ arch/riscv/Kconfig.vendor                          |   13 +
+ arch/riscv/configs/defconfig                       |    2 +
+ arch/riscv/errata/Makefile                         |    1 +
+ arch/riscv/errata/mips/Makefile                    |    5 +
+ arch/riscv/errata/mips/errata.c                    |   67 ++
+ arch/riscv/errata/thead/errata.c                   |   20 +
+ arch/riscv/include/asm/alternative-macros.h        |   12 +-
+ arch/riscv/include/asm/alternative.h               |    5 +-
+ arch/riscv/include/asm/asm-extable.h               |    6 +-
+ arch/riscv/include/asm/asm.h                       |   10 +-
+ arch/riscv/include/asm/assembler.h                 |    2 +-
+ arch/riscv/include/asm/barrier.h                   |    4 +-
+ arch/riscv/include/asm/cache.h                     |    4 +-
+ arch/riscv/include/asm/cmpxchg.h                   |    3 +-
+ arch/riscv/include/asm/cpu_ops_sbi.h               |    2 +-
+ arch/riscv/include/asm/csr.h                       |    4 +-
+ arch/riscv/include/asm/current.h                   |    4 +-
+ arch/riscv/include/asm/errata_list.h               |   38 +-
+ arch/riscv/include/asm/errata_list_vendors.h       |   30 +
+ arch/riscv/include/asm/ftrace.h                    |    6 +-
+ arch/riscv/include/asm/gpr-num.h                   |    6 +-
+ arch/riscv/include/asm/hwprobe.h                   |    3 +-
+ arch/riscv/include/asm/image.h                     |    4 +-
+ arch/riscv/include/asm/insn-def.h                  |    8 +-
+ arch/riscv/include/asm/insn.h                      |  216 ++++-
+ arch/riscv/include/asm/io.h                        |    4 +
+ arch/riscv/include/asm/irq.h                       |    6 +
+ arch/riscv/include/asm/jump_label.h                |    4 +-
+ arch/riscv/include/asm/kasan.h                     |    2 +-
+ arch/riscv/include/asm/kgdb.h                      |    4 +-
+ arch/riscv/include/asm/mmu.h                       |    4 +-
+ arch/riscv/include/asm/page.h                      |    4 +-
+ arch/riscv/include/asm/pgtable.h                   |    5 +-
+ arch/riscv/include/asm/processor.h                 |    4 +-
+ arch/riscv/include/asm/ptrace.h                    |    4 +-
+ arch/riscv/include/asm/rwonce.h                    |   34 +
+ arch/riscv/include/asm/sbi.h                       |   62 ++
+ arch/riscv/include/asm/scs.h                       |    4 +-
+ arch/riscv/include/asm/set_memory.h                |    4 +-
+ arch/riscv/include/asm/swab.h                      |   87 ++
+ arch/riscv/include/asm/thread_info.h               |    4 +-
+ arch/riscv/include/asm/vdso.h                      |    4 +-
+ arch/riscv/include/asm/vdso/getrandom.h            |    4 +-
+ arch/riscv/include/asm/vdso/gettimeofday.h         |    4 +-
+ arch/riscv/include/asm/vdso/processor.h            |    7 +-
+ arch/riscv/include/asm/vdso/vsyscall.h             |    4 +-
+ arch/riscv/include/asm/vendor_extensions/mips.h    |   37 +
+ .../include/asm/vendor_extensions/mips_hwprobe.h   |   22 +
+ arch/riscv/include/asm/vendorid_list.h             |    1 +
+ arch/riscv/include/uapi/asm/hwprobe.h              |    1 +
+ arch/riscv/include/uapi/asm/kvm.h                  |    2 +-
+ arch/riscv/include/uapi/asm/ptrace.h               |    4 +-
+ arch/riscv/include/uapi/asm/sigcontext.h           |    4 +-
+ arch/riscv/include/uapi/asm/vendor/mips.h          |    3 +
+ arch/riscv/kernel/acpi.c                           |    3 +
+ arch/riscv/kernel/alternative.c                    |    5 +
+ arch/riscv/kernel/cpufeature.c                     |    6 +-
+ arch/riscv/kernel/entry.S                          |    1 +
+ arch/riscv/kernel/machine_kexec_file.c             |    2 +-
+ arch/riscv/kernel/pi/Makefile                      |    2 +-
+ arch/riscv/kernel/pi/cmdline_early.c               |    4 +-
+ arch/riscv/kernel/pi/fdt_early.c                   |   40 +
+ arch/riscv/kernel/pi/pi.h                          |    1 +
+ arch/riscv/kernel/probes/simulate-insn.c           |   94 +-
+ arch/riscv/kernel/sbi.c                            |    4 +-
+ arch/riscv/kernel/sys_hwprobe.c                    |   18 +-
+ arch/riscv/kernel/sys_riscv.c                      |    2 +-
+ arch/riscv/kernel/tests/Kconfig.debug              |   12 +
+ arch/riscv/kernel/tests/Makefile                   |    1 +
+ arch/riscv/kernel/tests/kprobes/Makefile           |    1 +
+ arch/riscv/kernel/tests/kprobes/test-kprobes-asm.S |  229 +++++
+ arch/riscv/kernel/tests/kprobes/test-kprobes.c     |   56 ++
+ arch/riscv/kernel/tests/kprobes/test-kprobes.h     |   24 +
+ arch/riscv/kernel/traps_misaligned.c               |  144 +--
+ arch/riscv/kernel/vector.c                         |    2 +-
+ arch/riscv/kernel/vendor_extensions.c              |   10 +
+ arch/riscv/kernel/vendor_extensions/Makefile       |    2 +
+ arch/riscv/kernel/vendor_extensions/mips.c         |   22 +
+ arch/riscv/kernel/vendor_extensions/mips_hwprobe.c |   23 +
+ arch/riscv/kvm/vcpu_insn.c                         |  128 +--
+ arch/riscv/mm/init.c                               |   12 +-
+ drivers/acpi/Kconfig                               |    2 +-
+ drivers/acpi/property.c                            |  128 +--
+ drivers/acpi/riscv/irq.c                           |   75 +-
+ drivers/acpi/scan.c                                |    2 +
+ drivers/base/property.c                            |    2 +-
+ drivers/clk/Kconfig                                |    8 +
+ drivers/clk/Makefile                               |    1 +
+ drivers/clk/clk-rpmi.c                             |  620 ++++++++++++
+ drivers/irqchip/Kconfig                            |    7 +
+ drivers/irqchip/Makefile                           |    1 +
+ drivers/irqchip/irq-riscv-imsic-early.c            |    2 +
+ drivers/irqchip/irq-riscv-rpmi-sysmsi.c            |  328 +++++++
+ drivers/mailbox/Kconfig                            |   11 +
+ drivers/mailbox/Makefile                           |    2 +
+ drivers/mailbox/mailbox.c                          |   65 +-
+ drivers/mailbox/riscv-sbi-mpxy-mbox.c              | 1019 ++++++++++++++++++++
+ drivers/perf/riscv_pmu_sbi.c                       |    8 +-
+ include/asm-generic/rwonce.h                       |    2 +
+ include/linux/byteorder/generic.h                  |   16 +
+ include/linux/mailbox/riscv-rpmi-message.h         |  243 +++++
+ include/linux/mailbox_controller.h                 |    3 +
+ lib/raid6/recov_rvv.c                              |    2 -
+ lib/raid6/rvv.c                                    |   63 +-
+ tools/arch/riscv/include/asm/csr.h                 |    6 +-
+ tools/arch/riscv/include/asm/vdso/processor.h      |    4 +-
+ tools/testing/selftests/riscv/README               |   24 +
+ 118 files changed, 4201 insertions(+), 614 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/clock/riscv,rpmi-clock.yaml
+ create mode 100644 Documentation/devicetree/bindings/clock/riscv,rpmi-mpxy-clock.yaml
+ create mode 100644 Documentation/devicetree/bindings/interrupt-controller/riscv,rpmi-mpxy-system-msi.yaml
+ create mode 100644 Documentation/devicetree/bindings/interrupt-controller/riscv,rpmi-system-msi.yaml
+ create mode 100644 Documentation/devicetree/bindings/mailbox/riscv,rpmi-shmem-mbox.yaml
+ create mode 100644 Documentation/devicetree/bindings/mailbox/riscv,sbi-mpxy-mbox.yaml
+ create mode 100644 arch/riscv/errata/mips/Makefile
+ create mode 100644 arch/riscv/errata/mips/errata.c
+ create mode 100644 arch/riscv/include/asm/errata_list_vendors.h
+ create mode 100644 arch/riscv/include/asm/rwonce.h
+ create mode 100644 arch/riscv/include/asm/swab.h
+ create mode 100644 arch/riscv/include/asm/vendor_extensions/mips.h
+ create mode 100644 arch/riscv/include/asm/vendor_extensions/mips_hwprobe.h
+ create mode 100644 arch/riscv/include/uapi/asm/vendor/mips.h
+ create mode 100644 arch/riscv/kernel/tests/kprobes/Makefile
+ create mode 100644 arch/riscv/kernel/tests/kprobes/test-kprobes-asm.S
+ create mode 100644 arch/riscv/kernel/tests/kprobes/test-kprobes.c
+ create mode 100644 arch/riscv/kernel/tests/kprobes/test-kprobes.h
+ create mode 100644 arch/riscv/kernel/vendor_extensions/mips.c
+ create mode 100644 arch/riscv/kernel/vendor_extensions/mips_hwprobe.c
+ create mode 100644 drivers/clk/clk-rpmi.c
+ create mode 100644 drivers/irqchip/irq-riscv-rpmi-sysmsi.c
+ create mode 100644 drivers/mailbox/riscv-sbi-mpxy-mbox.c
+ create mode 100644 include/linux/mailbox/riscv-rpmi-message.h
+ create mode 100644 tools/testing/selftests/riscv/README
+Merging riscv-dt/riscv-dt-for-next (4cce8b2503ab5 riscv: dts: starfive: add Milk-V Mars CM Lite system-on-module)
+$ git merge -m Merge branch 'riscv-dt-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git riscv-dt/riscv-dt-for-next
+Already up to date.
+Merging riscv-soc/riscv-soc-for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'riscv-soc-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/conor/linux.git riscv-soc/riscv-soc-for-next
+Already up to date.
+Merging s390/for-next (b64a294bf2d68 Merge branch 'features' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/s390/linux.git s390/for-next
+Auto-merging arch/s390/Kconfig
+Auto-merging arch/s390/mm/pgalloc.c
+Auto-merging init/Kconfig
+Merge made by the 'ort' strategy.
+ arch/s390/Kconfig                     |   7 +
+ arch/s390/boot/boot.h                 |   8 +
+ arch/s390/boot/decompressor.c         |   4 +-
+ arch/s390/boot/physmem_info.c         |   4 +-
+ arch/s390/boot/startup.c              |  13 +-
+ arch/s390/configs/debug_defconfig     |   6 +
+ arch/s390/configs/defconfig           |   6 +
+ arch/s390/include/asm/bitops.h        |  88 ++-----
+ arch/s390/include/asm/pgalloc.h       |  30 ++-
+ arch/s390/kernel/debug.c              |  12 +-
+ arch/s390/kernel/diag/diag324.c       |   4 +-
+ arch/s390/kernel/hiperdispatch.c      |   2 +-
+ arch/s390/mm/pgalloc.c                |  19 +-
+ drivers/s390/block/Kconfig            |  12 +-
+ drivers/s390/block/dcssblk.c          |  35 ++-
+ drivers/s390/char/Makefile            |   1 +
+ drivers/s390/char/hmcdrv_dev.c        |  19 +-
+ drivers/s390/char/sclp_cmd.c          | 478 +++-------------------------------
+ drivers/s390/char/sclp_mem.c          | 399 ++++++++++++++++++++++++++++
+ drivers/s390/char/tape_3590.c         |   2 +-
+ drivers/s390/crypto/zcrypt_ep11misc.c |   4 +-
+ include/linux/compiler_types.h        |  23 ++
+ init/Kconfig                          |  10 +
+ 23 files changed, 611 insertions(+), 575 deletions(-)
+ create mode 100644 drivers/s390/char/sclp_mem.c
+Merging sh/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/glaubitz/sh-linux.git sh/for-next
+Already up to date.
+Merging sparc/for-next (fe0126702a40b sparc: Replace deprecated strcpy() with strscpy() in handle_nextprop_quirks())
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/alarsson/linux-sparc.git sparc/for-next
+Merge made by the 'ort' strategy.
+ arch/sparc/include/asm/adi_64.h         |  4 +-
+ arch/sparc/include/asm/auxio.h          |  4 +-
+ arch/sparc/include/asm/auxio_32.h       |  4 +-
+ arch/sparc/include/asm/auxio_64.h       |  4 +-
+ arch/sparc/include/asm/cacheflush_64.h  |  4 +-
+ arch/sparc/include/asm/cpudata.h        |  4 +-
+ arch/sparc/include/asm/cpudata_64.h     |  4 +-
+ arch/sparc/include/asm/delay_64.h       |  4 +-
+ arch/sparc/include/asm/elf_64.h         |  1 +
+ arch/sparc/include/asm/floppy_64.h      |  3 +-
+ arch/sparc/include/asm/ftrace.h         |  2 +-
+ arch/sparc/include/asm/hvtramp.h        |  2 +-
+ arch/sparc/include/asm/hypervisor.h     | 92 ++++++++++++++++-----------------
+ arch/sparc/include/asm/io_64.h          |  6 +--
+ arch/sparc/include/asm/irqflags_32.h    |  4 +-
+ arch/sparc/include/asm/irqflags_64.h    |  4 +-
+ arch/sparc/include/asm/jump_label.h     |  4 +-
+ arch/sparc/include/asm/kdebug_32.h      |  4 +-
+ arch/sparc/include/asm/leon.h           |  8 +--
+ arch/sparc/include/asm/leon_amba.h      |  6 +--
+ arch/sparc/include/asm/mman.h           |  4 +-
+ arch/sparc/include/asm/mmu_64.h         |  4 +-
+ arch/sparc/include/asm/mmu_context_32.h |  4 +-
+ arch/sparc/include/asm/mmu_context_64.h |  4 +-
+ arch/sparc/include/asm/mxcc.h           |  4 +-
+ arch/sparc/include/asm/obio.h           |  4 +-
+ arch/sparc/include/asm/openprom.h       |  4 +-
+ arch/sparc/include/asm/page_32.h        |  8 +--
+ arch/sparc/include/asm/page_64.h        |  8 +--
+ arch/sparc/include/asm/parport_64.h     |  3 +-
+ arch/sparc/include/asm/pcic.h           |  2 +-
+ arch/sparc/include/asm/pgtable_32.h     |  4 +-
+ arch/sparc/include/asm/pgtable_64.h     |  8 +--
+ arch/sparc/include/asm/pgtsrmmu.h       |  6 +--
+ arch/sparc/include/asm/processor_64.h   | 10 ++--
+ arch/sparc/include/asm/psr.h            |  4 +-
+ arch/sparc/include/asm/ptrace.h         | 12 ++---
+ arch/sparc/include/asm/ross.h           |  4 +-
+ arch/sparc/include/asm/sbi.h            |  4 +-
+ arch/sparc/include/asm/sigcontext.h     |  4 +-
+ arch/sparc/include/asm/signal.h         |  6 +--
+ arch/sparc/include/asm/smp_32.h         |  8 +--
+ arch/sparc/include/asm/smp_64.h         |  8 +--
+ arch/sparc/include/asm/spinlock_32.h    |  4 +-
+ arch/sparc/include/asm/spinlock_64.h    |  4 +-
+ arch/sparc/include/asm/spitfire.h       |  4 +-
+ arch/sparc/include/asm/starfire.h       |  2 +-
+ arch/sparc/include/asm/thread_info_32.h |  4 +-
+ arch/sparc/include/asm/thread_info_64.h | 12 ++---
+ arch/sparc/include/asm/trap_block.h     |  4 +-
+ arch/sparc/include/asm/traps.h          |  4 +-
+ arch/sparc/include/asm/tsb.h            |  2 +-
+ arch/sparc/include/asm/ttable.h         |  2 +-
+ arch/sparc/include/asm/turbosparc.h     |  4 +-
+ arch/sparc/include/asm/upa.h            |  4 +-
+ arch/sparc/include/asm/vaddrs.h         |  2 +-
+ arch/sparc/include/asm/viking.h         |  4 +-
+ arch/sparc/include/asm/visasm.h         |  2 +-
+ arch/sparc/include/uapi/asm/ptrace.h    | 24 ++++-----
+ arch/sparc/include/uapi/asm/signal.h    |  4 +-
+ arch/sparc/include/uapi/asm/traps.h     |  4 +-
+ arch/sparc/include/uapi/asm/utrap.h     |  4 +-
+ arch/sparc/kernel/Makefile              |  2 -
+ arch/sparc/kernel/adi_64.c              |  4 +-
+ arch/sparc/kernel/ds.c                  | 27 +++++-----
+ arch/sparc/kernel/module.c              |  3 +-
+ arch/sparc/kernel/of_device_32.c        |  1 +
+ arch/sparc/kernel/of_device_64.c        |  1 +
+ arch/sparc/kernel/pcic.c                |  7 +--
+ arch/sparc/kernel/prom_32.c             | 13 +++--
+ arch/sparc/kernel/prom_64.c             |  8 +--
+ arch/sparc/kernel/prom_common.c         |  7 ++-
+ arch/sparc/lib/M7memcpy.S               | 20 +++----
+ arch/sparc/lib/Makefile                 |  2 +-
+ arch/sparc/lib/Memcpy_utils.S           |  9 ++++
+ arch/sparc/lib/NG4memcpy.S              |  2 +-
+ arch/sparc/lib/NGmemcpy.S               | 29 +++++++----
+ arch/sparc/lib/U1memcpy.S               | 19 +++----
+ arch/sparc/lib/U3memcpy.S               |  2 +-
+ arch/sparc/mm/Makefile                  |  2 -
+ arch/sparc/mm/hugetlbpage.c             | 20 +++++++
+ arch/sparc/prom/Makefile                |  1 -
+ arch/sparc/prom/tree_64.c               |  2 +-
+ drivers/char/hw_random/n2rng.h          |  4 +-
+ 84 files changed, 312 insertions(+), 262 deletions(-)
+Merging uml/next (e66ae377fe219 um: Remove unused ipi_pipe field from cpuinfo_um)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/uml/linux.git uml/next
+Auto-merging arch/um/Kconfig
+Merge made by the 'ort' strategy.
+ arch/um/Kconfig                         |  1 +
+ arch/um/drivers/ssl.c                   |  5 ++++-
+ arch/um/drivers/ubd_kern.c              |  2 +-
+ arch/um/drivers/vector_kern.c           |  2 +-
+ arch/um/drivers/virtio_pcidev.c         |  6 ++++++
+ arch/um/include/asm/mmu_context.h       | 11 ----------
+ arch/um/include/asm/processor-generic.h |  3 ---
+ arch/um/include/shared/as-layout.h      |  5 +++--
+ arch/um/include/shared/skas/stub-data.h |  3 +--
+ arch/um/kernel/dtb.c                    |  2 +-
+ arch/um/kernel/irq.c                    |  5 +++++
+ arch/um/kernel/time.c                   | 37 +++++++++++++++++----------------
+ arch/um/kernel/um_arch.c                |  7 +------
+ arch/um/os-Linux/skas/process.c         |  2 +-
+ arch/x86/um/shared/sysdep/stub_32.h     |  2 +-
+ arch/x86/um/shared/sysdep/stub_64.h     |  2 +-
+ 16 files changed, 46 insertions(+), 49 deletions(-)
+Merging xtensa/xtensa-for-next (4c8bad3ed035a xtensa: use HZ_PER_MHZ in platform_calibrate_ccount)
+$ git merge -m Merge branch 'xtensa-for-next' of https://github.com/jcmvbkbc/linux-xtensa.git xtensa/xtensa-for-next
+Merge made by the 'ort' strategy.
+ arch/xtensa/kernel/platform.c       | 5 +++--
+ arch/xtensa/platforms/iss/simdisk.c | 6 +++++-
+ 2 files changed, 8 insertions(+), 3 deletions(-)
+Merging fs-next (a466035c03fd4 next-20250926/vfs)
+  3245c76d32893 ("Have cc(1) catch attempts to modify ->f_path")
+  9b7a31ff321e5 ("kernel/acct.c: saner struct file treatment")
+$ git merge -m Merge branch 'fs-next' of linux-next fs-next
+Auto-merging include/linux/fs.h
+Merge made by the 'ort' strategy.
+Merging printk/for-next (3cb5302e8c686 Merge branch 'for-6.18' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/printk/linux.git printk/for-next
+Auto-merging init/Kconfig
+Auto-merging kernel/printk/printk_ringbuffer.c
+Merge made by the 'ort' strategy.
+ init/Kconfig                                 |  12 +
+ kernel/printk/.kunitconfig                   |   3 +
+ kernel/printk/Makefile                       |   2 +
+ kernel/printk/printk_ringbuffer.c            |  48 ++--
+ kernel/printk/printk_ringbuffer_kunit_test.c | 327 +++++++++++++++++++++++++++
+ 5 files changed, 378 insertions(+), 14 deletions(-)
+ create mode 100644 kernel/printk/.kunitconfig
+ create mode 100644 kernel/printk/printk_ringbuffer_kunit_test.c
+Merging pci/next (c28eb27d98c2e Merge branch 'pci/misc')
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/pci/pci.git pci/next
+Auto-merging MAINTAINERS
+Auto-merging arch/sparc/kernel/pcic.c
+Merge made by the 'ort' strategy.
+ Documentation/ABI/testing/sysfs-bus-pci            |   9 +
+ Documentation/PCI/endpoint/pci-vntb-howto.rst      |   9 +-
+ Documentation/PCI/pci-error-recovery.rst           |  43 +-
+ Documentation/PCI/pcieaer-howto.rst                |  83 +-
+ .../bindings/pci/amd,versal2-mdb-host.yaml         |  24 +-
+ .../bindings/pci/mediatek-pcie-gen3.yaml           |  35 +
+ .../devicetree/bindings/pci/qcom,pcie-sa8255p.yaml |  74 +-
+ .../devicetree/bindings/pci/qcom,pcie-sm8550.yaml  |   1 +
+ .../bindings/pci/qcom,pcie-x1e80100.yaml           |   3 +-
+ .../bindings/pci/sophgo,sg2042-pcie-host.yaml      |  64 ++
+ .../bindings/pci/st,stm32-pcie-common.yaml         |  33 +
+ .../devicetree/bindings/pci/st,stm32-pcie-ep.yaml  |  73 ++
+ .../bindings/pci/st,stm32-pcie-host.yaml           | 112 +++
+ .../devicetree/bindings/pci/ti,am65-pci-host.yaml  |  28 +-
+ Documentation/driver-api/pin-control.rst           |  57 +-
+ MAINTAINERS                                        |   7 +
+ arch/m68k/kernel/pcibios.c                         |  39 +-
+ arch/mips/pci/pci-legacy.c                         |  38 +-
+ arch/powerpc/kernel/eeh_driver.c                   |   2 +-
+ arch/s390/pci/pci_event.c                          |   3 +
+ arch/sparc/kernel/leon_pci.c                       |  27 -
+ arch/sparc/kernel/pci.c                            |  27 -
+ arch/sparc/kernel/pcic.c                           |  27 -
+ arch/x86/pci/fixup.c                               |  40 +
+ drivers/misc/pci_endpoint_test.c                   |  16 +-
+ .../net/ethernet/qlogic/qlcnic/qlcnic_83xx_hw.c    |   1 -
+ drivers/net/ethernet/qlogic/qlcnic/qlcnic_main.c   |   2 -
+ drivers/net/ethernet/sfc/efx_common.c              |   3 -
+ drivers/net/ethernet/sfc/falcon/efx.c              |   3 -
+ drivers/net/ethernet/sfc/siena/efx_common.c        |   3 -
+ drivers/pci/bus.c                                  |  17 +-
+ drivers/pci/controller/cadence/Kconfig             |  10 +
+ drivers/pci/controller/cadence/Makefile            |   1 +
+ drivers/pci/controller/cadence/pci-j721e.c         |  26 +
+ drivers/pci/controller/cadence/pcie-cadence-ep.c   |  40 +-
+ drivers/pci/controller/cadence/pcie-cadence-host.c |   2 +-
+ drivers/pci/controller/cadence/pcie-cadence.c      |  18 +-
+ drivers/pci/controller/cadence/pcie-cadence.h      |  45 +-
+ drivers/pci/controller/cadence/pcie-sg2042.c       | 134 ++++
+ drivers/pci/controller/dwc/Kconfig                 |  26 +
+ drivers/pci/controller/dwc/Makefile                |   2 +
+ drivers/pci/controller/dwc/pci-dra7xx.c            |   1 -
+ drivers/pci/controller/dwc/pci-exynos.c            |  62 +-
+ drivers/pci/controller/dwc/pci-imx6.c              |  52 +-
+ drivers/pci/controller/dwc/pci-keystone.c          |   5 +-
+ drivers/pci/controller/dwc/pcie-al.c               |   1 +
+ drivers/pci/controller/dwc/pcie-amd-mdb.c          |  52 +-
+ drivers/pci/controller/dwc/pcie-artpec6.c          |   2 -
+ drivers/pci/controller/dwc/pcie-designware-ep.c    |  31 +-
+ drivers/pci/controller/dwc/pcie-designware-host.c  | 151 +++-
+ drivers/pci/controller/dwc/pcie-designware-plat.c  |   1 -
+ drivers/pci/controller/dwc/pcie-designware.c       |  94 +--
+ drivers/pci/controller/dwc/pcie-designware.h       |  55 +-
+ drivers/pci/controller/dwc/pcie-dw-rockchip.c      |   2 -
+ drivers/pci/controller/dwc/pcie-keembay.c          |   1 -
+ drivers/pci/controller/dwc/pcie-qcom-common.c      |  58 +-
+ drivers/pci/controller/dwc/pcie-qcom-common.h      |   2 +-
+ drivers/pci/controller/dwc/pcie-qcom-ep.c          |  23 +-
+ drivers/pci/controller/dwc/pcie-qcom.c             | 211 ++---
+ drivers/pci/controller/dwc/pcie-rcar-gen4.c        |  30 +-
+ drivers/pci/controller/dwc/pcie-stm32-ep.c         | 384 +++++++++
+ drivers/pci/controller/dwc/pcie-stm32.c            | 360 +++++++++
+ drivers/pci/controller/dwc/pcie-stm32.h            |  16 +
+ drivers/pci/controller/dwc/pcie-tegra194.c         |  51 +-
+ drivers/pci/controller/pci-hyperv.c                |   8 +-
+ drivers/pci/controller/pci-tegra.c                 |  29 +-
+ drivers/pci/controller/pci-xgene-msi.c             |   2 +-
+ drivers/pci/controller/pcie-mediatek-gen3.c        |  23 +
+ drivers/pci/controller/pcie-rcar-ep.c              |   2 -
+ drivers/pci/controller/pcie-rcar-host.c            |  42 +-
+ drivers/pci/controller/pcie-rockchip-ep.c          |   1 -
+ drivers/pci/controller/plda/pcie-plda-host.c       |   3 +-
+ drivers/pci/endpoint/functions/pci-epf-test.c      |  38 +-
+ drivers/pci/endpoint/pci-ep-msi.c                  |   2 +-
+ drivers/pci/hotplug/cpqphp_pci.c                   |   8 +-
+ drivers/pci/hotplug/ibmphp_hpc.c                   |   6 +-
+ drivers/pci/iov.c                                  |   5 +
+ drivers/pci/of_property.c                          |  22 +-
+ drivers/pci/p2pdma.c                               |   5 +-
+ drivers/pci/pci-acpi.c                             |   6 +-
+ drivers/pci/pci-driver.c                           |   3 +-
+ drivers/pci/pci-sysfs.c                            |  68 +-
+ drivers/pci/pci.c                                  |  81 +-
+ drivers/pci/pci.h                                  |  96 ++-
+ drivers/pci/pcie/aer.c                             |  46 +-
+ drivers/pci/pcie/aspm.c                            |  45 +-
+ drivers/pci/pcie/err.c                             |  40 +-
+ drivers/pci/probe.c                                | 120 ++-
+ drivers/pci/pwrctrl/slot.c                         |  12 +-
+ drivers/pci/quirks.c                               |   1 +
+ drivers/pci/remove.c                               |   3 +
+ drivers/pci/setup-bus.c                            | 855 +++++++++++----------
+ drivers/pci/setup-res.c                            |  46 +-
+ drivers/pci/switch/switchtec.c                     |  23 +-
+ drivers/pinctrl/core.c                             |  13 +
+ drivers/scsi/lpfc/lpfc_init.c                      |   2 +-
+ drivers/scsi/qla2xxx/qla_os.c                      |   5 -
+ include/linux/pci-p2pdma.h                         |   5 -
+ include/linux/pci.h                                |   7 +-
+ include/linux/pinctrl/consumer.h                   |  10 +
+ include/uapi/linux/pci_regs.h                      |  10 +
+ .../selftests/pci_endpoint/pci_endpoint_test.c     |   4 +
+ 102 files changed, 3256 insertions(+), 1293 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/pci/sophgo,sg2042-pcie-host.yaml
+ create mode 100644 Documentation/devicetree/bindings/pci/st,stm32-pcie-common.yaml
+ create mode 100644 Documentation/devicetree/bindings/pci/st,stm32-pcie-ep.yaml
+ create mode 100644 Documentation/devicetree/bindings/pci/st,stm32-pcie-host.yaml
+ create mode 100644 drivers/pci/controller/cadence/pcie-sg2042.c
+ create mode 100644 drivers/pci/controller/dwc/pcie-stm32-ep.c
+ create mode 100644 drivers/pci/controller/dwc/pcie-stm32.c
+ create mode 100644 drivers/pci/controller/dwc/pcie-stm32.h
+Merging pstore/for-next/pstore (d679c2e1e8d96 pstore/zone: rewrite some comments for better understanding)
+$ git merge -m Merge branch 'for-next/pstore' of https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git pstore/for-next/pstore
+Merge made by the 'ort' strategy.
+ fs/pstore/zone.c | 21 +++++++++++----------
+ 1 file changed, 11 insertions(+), 10 deletions(-)
+Merging hid/for-next (dabac188f8e4e Merge branch 'for-6.18/playstation' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/hid/hid.git hid/for-next
+Merge made by the 'ort' strategy.
+ Documentation/input/event-codes.rst                |   14 +
+ drivers/hid/Kconfig                                |   11 +
+ drivers/hid/Makefile                               |    1 +
+ drivers/hid/hid-asus.c                             |    6 +-
+ drivers/hid/hid-core.c                             |   44 +-
+ drivers/hid/hid-haptic.c                           |  580 +++++++++++
+ drivers/hid/hid-haptic.h                           |  127 +++
+ drivers/hid/hid-ids.h                              |    4 +-
+ drivers/hid/hid-input.c                            |   18 +-
+ drivers/hid/hid-multitouch.c                       |   47 +
+ drivers/hid/hid-playstation.c                      | 1087 +++++++++++---------
+ drivers/hid/hid-quirks.c                           |    2 +
+ drivers/hid/hid-steelseries.c                      |  108 +-
+ drivers/hid/hid-uclogic-params.c                   |   10 +-
+ drivers/hid/hid-universal-pidff.c                  |   59 +-
+ drivers/hid/hidraw.c                               |  262 ++---
+ drivers/hid/i2c-hid/i2c-hid-acpi.c                 |    8 +
+ drivers/hid/i2c-hid/i2c-hid-core.c                 |   28 +-
+ drivers/hid/i2c-hid/i2c-hid.h                      |    2 +
+ drivers/hid/intel-ish-hid/ipc/ipc.c                |   17 +-
+ .../intel-thc-hid/intel-quicki2c/pci-quicki2c.c    |   39 +-
+ .../intel-thc-hid/intel-quicki2c/quicki2c-dev.h    |   24 +-
+ .../hid/intel-thc-hid/intel-thc/intel-thc-dev.c    |    3 +-
+ drivers/hid/usbhid/hid-pidff.c                     |  716 +++++++------
+ drivers/hid/usbhid/hid-pidff.h                     |    2 +-
+ drivers/input/input-mt.c                           |   14 +-
+ include/linux/hid.h                                |   31 +-
+ include/linux/input/mt.h                           |    1 +
+ include/uapi/linux/hidraw.h                        |    2 +
+ include/uapi/linux/input-event-codes.h             |    1 +
+ include/uapi/linux/input.h                         |   22 +-
+ tools/testing/selftests/hid/hid_common.h           |    6 +
+ tools/testing/selftests/hid/hidraw.c               |  473 +++++++++
+ tools/testing/selftests/hid/vmtest.sh              |  714 ++++++++-----
+ 34 files changed, 3166 insertions(+), 1317 deletions(-)
+ create mode 100644 drivers/hid/hid-haptic.c
+ create mode 100644 drivers/hid/hid-haptic.h
+Merging i2c/i2c/for-next (0e301196ecb23 Merge branch 'i2c/for-mergewindow' into i2c/for-next)
+$ git merge -m Merge branch 'i2c/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux.git i2c/i2c/for-next
+Auto-merging Documentation/devicetree/bindings/i2c/nvidia,tegra20-i2c.yaml
+CONFLICT (content): Merge conflict in Documentation/devicetree/bindings/i2c/nvidia,tegra20-i2c.yaml
+Auto-merging drivers/i2c/busses/Kconfig
+Resolved 'Documentation/devicetree/bindings/i2c/nvidia,tegra20-i2c.yaml' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 1d9357344ad51] Merge branch 'i2c/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/devicetree/bindings/eeprom/at24.yaml |  1 +
+ .../devicetree/bindings/i2c/apple,i2c.yaml         | 27 ++++----
+ .../devicetree/bindings/i2c/i2c-exynos5.yaml       |  5 ++
+ .../devicetree/bindings/i2c/i2c-mt65xx.yaml        |  6 ++
+ .../bindings/i2c/nvidia,tegra20-i2c.yaml           |  6 ++
+ .../devicetree/bindings/i2c/qcom,i2c-cci.yaml      | 24 +++++++-
+ .../bindings/i2c/samsung,s3c2410-i2c.yaml          |  2 -
+ .../devicetree/bindings/i2c/spacemit,k1-i2c.yaml   |  2 +-
+ Documentation/i2c/busses/i2c-i801.rst              |  1 +
+ drivers/i2c/busses/Kconfig                         |  1 +
+ drivers/i2c/busses/i2c-designware-master.c         |  9 ++-
+ drivers/i2c/busses/i2c-designware-platdrv.c        | 15 +++--
+ drivers/i2c/busses/i2c-designware-slave.c          |  9 ++-
+ drivers/i2c/busses/i2c-hix5hd2.c                   |  2 +-
+ drivers/i2c/busses/i2c-i801.c                      |  3 +
+ drivers/i2c/busses/i2c-k1.c                        | 71 ++++++++++++++--------
+ drivers/i2c/busses/i2c-mt65xx.c                    | 17 +++---
+ drivers/i2c/busses/i2c-s3c2410.c                   |  1 -
+ drivers/i2c/busses/i2c-sprd.c                      |  2 +-
+ drivers/i2c/busses/i2c-st.c                        |  2 +-
+ drivers/i2c/busses/i2c-tegra.c                     | 26 ++++++++
+ drivers/i2c/busses/i2c-viperboard.c                |  2 +-
+ drivers/i2c/i2c-boardinfo.c                        |  4 +-
+ drivers/i2c/i2c-core-base.c                        |  9 +--
+ drivers/i2c/i2c-core-slave.c                       |  3 +-
+ drivers/i2c/i2c-mux.c                              |  9 +--
+ drivers/i2c/muxes/i2c-mux-pca9541.c                | 12 ++--
+ drivers/i2c/muxes/i2c-mux-pca954x.c                | 50 ++++++++-------
+ include/linux/i2c.h                                |  2 +-
+ include/linux/property.h                           | 10 +++
+ 30 files changed, 218 insertions(+), 115 deletions(-)
+Merging i2c-host/i2c/i2c-host (217f92d91c9fa dt-bindings: i2c: i2c-mt65xx: Document MediaTek MT6878 I2C)
+$ git merge -m Merge branch 'i2c/i2c-host' of https://git.kernel.org/pub/scm/linux/kernel/git/andi.shyti/linux.git i2c-host/i2c/i2c-host
+Already up to date.
+Merging i3c/i3c/next (d6ddd9beb1a5c i3c: fix big-endian FIFO transfers)
+$ git merge -m Merge branch 'i3c/next' of https://git.kernel.org/pub/scm/linux/kernel/git/i3c/linux.git i3c/i3c/next
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/i3c/adi,i3c-master.yaml    |   72 ++
+ .../devicetree/bindings/i3c/renesas,i3c.yaml       |   16 +-
+ MAINTAINERS                                        |    6 +
+ drivers/i3c/internals.h                            |   12 +-
+ drivers/i3c/master.c                               |   78 +-
+ drivers/i3c/master/Kconfig                         |   11 +
+ drivers/i3c/master/Makefile                        |    1 +
+ drivers/i3c/master/adi-i3c-master.c                | 1019 ++++++++++++++++++++
+ drivers/i3c/master/dw-i3c-master.c                 |   23 +
+ drivers/i3c/master/mipi-i3c-hci/cmd_v1.c           |    9 +-
+ drivers/i3c/master/mipi-i3c-hci/cmd_v2.c           |    7 +-
+ drivers/i3c/master/mipi-i3c-hci/core.c             |   74 +-
+ drivers/i3c/master/mipi-i3c-hci/dma.c              |   96 +-
+ drivers/i3c/master/mipi-i3c-hci/ext_caps.c         |   11 +-
+ drivers/i3c/master/mipi-i3c-hci/hci.h              |    6 +-
+ drivers/i3c/master/mipi-i3c-hci/mipi-i3c-hci-pci.c |    3 +
+ drivers/i3c/master/mipi-i3c-hci/pio.c              |   75 +-
+ drivers/i3c/master/renesas-i3c.c                   |    2 +-
+ drivers/i3c/master/svc-i3c-master.c                |   31 +-
+ include/linux/i3c/master.h                         |   26 +
+ 20 files changed, 1410 insertions(+), 168 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/i3c/adi,i3c-master.yaml
+ create mode 100644 drivers/i3c/master/adi-i3c-master.c
+Merging dmi/dmi-for-next (4d1b28a8119c6 firmware: dmi: Add info message for number of populated and total memory slots)
+$ git merge -m Merge branch 'dmi-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging.git dmi/dmi-for-next
+Already up to date.
+Merging hwmon-staging/hwmon-next (76bb6969a8cfc dt-bindings: hwmon: (lm75) allow interrupt for ti,tmp75)
+$ git merge -m Merge branch 'hwmon-next' of https://git.kernel.org/pub/scm/linux/kernel/git/groeck/linux-staging.git hwmon-staging/hwmon-next
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/hwmon/adi,adm1275.yaml     |   9 +
+ .../bindings/hwmon/kontron,sl28cpld-hwmon.yaml     |   1 +
+ .../devicetree/bindings/hwmon/lantiq,cputemp.yaml  |  30 +
+ Documentation/devicetree/bindings/hwmon/lm75.yaml  |   2 +
+ .../devicetree/bindings/hwmon/ltq-cputemp.txt      |  10 -
+ .../bindings/hwmon/pmbus/isil,isl68137.yaml        |   2 +
+ .../devicetree/bindings/hwmon/pwm-fan.yaml         |   9 +
+ .../devicetree/bindings/hwmon/ti,ina2xx.yaml       |  34 +
+ .../devicetree/bindings/hwmon/ti,tmp102.yaml       |   5 +
+ .../devicetree/bindings/trivial-devices.yaml       |  15 +
+ Documentation/hwmon/adm1275.rst                    |  24 +-
+ Documentation/hwmon/asus_ec_sensors.rst            |  12 +
+ Documentation/hwmon/cros_ec_hwmon.rst              |   7 +-
+ Documentation/hwmon/crps.rst                       |   4 +-
+ Documentation/hwmon/dell-smm-hwmon.rst             |  50 +-
+ Documentation/hwmon/gpd-fan.rst                    |  78 +++
+ Documentation/hwmon/hwmon-kernel-api.rst           |  13 +
+ Documentation/hwmon/ina238.rst                     |  64 +-
+ Documentation/hwmon/index.rst                      |   4 +
+ Documentation/hwmon/isl68137.rst                   |  20 +
+ Documentation/hwmon/lm75.rst                       |   6 +-
+ Documentation/hwmon/mp2869.rst                     | 175 +++++
+ Documentation/hwmon/mp29502.rst                    |  93 +++
+ Documentation/hwmon/mp5990.rst                     |  30 +-
+ Documentation/hwmon/sa67.rst                       |  41 ++
+ Documentation/hwmon/sht21.rst                      |  26 +-
+ MAINTAINERS                                        |  26 +-
+ drivers/hwmon/Kconfig                              |  40 +-
+ drivers/hwmon/Makefile                             |   2 +
+ drivers/hwmon/asus-ec-sensors.c                    | 340 +++++++---
+ drivers/hwmon/coretemp.c                           |  76 ++-
+ drivers/hwmon/cros_ec_hwmon.c                      | 313 +++++++++
+ drivers/hwmon/dell-smm-hwmon.c                     |  99 ++-
+ drivers/hwmon/gpd-fan.c                            | 715 +++++++++++++++++++++
+ drivers/hwmon/hwmon.c                              |  58 +-
+ drivers/hwmon/ina238.c                             | 583 +++++++++--------
+ drivers/hwmon/k10temp.c                            |  10 +
+ drivers/hwmon/lenovo-ec-sensors.c                  |  34 +-
+ drivers/hwmon/lm75.c                               |  13 +
+ drivers/hwmon/ltc4282.c                            |   3 +-
+ drivers/hwmon/mlxreg-fan.c                         |  42 +-
+ drivers/hwmon/nct6775-platform.c                   |   3 +-
+ drivers/hwmon/nzxt-smart2.c                        |   8 +-
+ drivers/hwmon/pmbus/Kconfig                        |  21 +-
+ drivers/hwmon/pmbus/Makefile                       |   2 +
+ drivers/hwmon/pmbus/adm1275.c                      |  11 +-
+ drivers/hwmon/pmbus/isl68137.c                     |   6 +
+ drivers/hwmon/pmbus/mp2869.c                       | 659 +++++++++++++++++++
+ drivers/hwmon/pmbus/mp29502.c                      | 670 +++++++++++++++++++
+ drivers/hwmon/pmbus/mp5990.c                       |  67 +-
+ drivers/hwmon/pwm-fan.c                            |  18 +-
+ drivers/hwmon/sa67mcu-hwmon.c                      | 161 +++++
+ drivers/hwmon/sbtsi_temp.c                         |  46 +-
+ drivers/hwmon/sch56xx-common.c                     |   4 +-
+ drivers/hwmon/sht21.c                              |  15 +-
+ drivers/hwmon/sy7636a-hwmon.c                      |   1 +
+ drivers/hwmon/tmp102.c                             |  22 +-
+ include/linux/hwmon.h                              |   4 +
+ include/linux/platform_data/cros_ec_commands.h     |  29 +-
+ include/trace/events/hwmon.h                       |  10 +-
+ include/uapi/linux/i8k.h                           |   2 +
+ 61 files changed, 4283 insertions(+), 594 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/hwmon/lantiq,cputemp.yaml
+ delete mode 100644 Documentation/devicetree/bindings/hwmon/ltq-cputemp.txt
+ create mode 100644 Documentation/hwmon/gpd-fan.rst
+ create mode 100644 Documentation/hwmon/mp2869.rst
+ create mode 100644 Documentation/hwmon/mp29502.rst
+ create mode 100644 Documentation/hwmon/sa67.rst
+ create mode 100644 drivers/hwmon/gpd-fan.c
+ create mode 100644 drivers/hwmon/pmbus/mp2869.c
+ create mode 100644 drivers/hwmon/pmbus/mp29502.c
+ create mode 100644 drivers/hwmon/sa67mcu-hwmon.c
+Merging jc_docs/docs-next (2cf0dde453d01 Merge branches 'docs-mw' and 'build-script' into docs-next)
+$ git merge -m Merge branch 'docs-next' of git://git.lwn.net/linux.git jc_docs/docs-next
+Auto-merging Documentation/admin-guide/kernel-parameters.txt
+Auto-merging Documentation/admin-guide/mm/damon/usage.rst
+Auto-merging Documentation/admin-guide/perf/hisi-pmu.rst
+Auto-merging Documentation/driver-api/pin-control.rst
+Auto-merging Documentation/filesystems/proc.rst
+Auto-merging Documentation/filesystems/sysfs.rst
+Auto-merging Documentation/networking/can.rst
+Auto-merging Documentation/process/changes.rst
+Auto-merging MAINTAINERS
+Auto-merging Makefile
+Auto-merging fs/btrfs/tree-log.c
+Merge made by the 'ort' strategy.
+ .pylintrc                                          |    2 +-
+ Documentation/.renames.txt                         | 1191 +++++++++++++++
+ Documentation/Makefile                             |  169 +--
+ Documentation/PCI/endpoint/pci-endpoint-cfs.rst    |    4 +-
+ Documentation/PCI/endpoint/pci-endpoint.rst        |    6 +-
+ Documentation/RCU/lockdep.rst                      |    2 +-
+ Documentation/RCU/stallwarn.rst                    |    2 +-
+ Documentation/admin-guide/LSM/SafeSetID.rst        |    2 +-
+ Documentation/admin-guide/RAS/main.rst             |    2 +-
+ Documentation/admin-guide/aoe/udev.txt             |    6 +-
+ Documentation/admin-guide/blockdev/paride.rst      |    2 +-
+ .../admin-guide/device-mapper/vdo-design.rst       |    2 +-
+ Documentation/admin-guide/ext4.rst                 |    2 +-
+ Documentation/admin-guide/hw-vuln/mds.rst          |    2 +-
+ Documentation/admin-guide/hw-vuln/spectre.rst      |    6 +-
+ Documentation/admin-guide/kdump/kdump.rst          |    2 +-
+ Documentation/admin-guide/kernel-parameters.rst    |    4 +-
+ Documentation/admin-guide/kernel-parameters.txt    |   12 +-
+ Documentation/admin-guide/laptops/laptop-mode.rst  |    8 +-
+ Documentation/admin-guide/laptops/sonypi.rst       |    2 +-
+ Documentation/admin-guide/md.rst                   |    2 +-
+ Documentation/admin-guide/media/imx.rst            |    2 +-
+ Documentation/admin-guide/media/si4713.rst         |    6 +-
+ Documentation/admin-guide/mm/damon/usage.rst       |    2 +-
+ Documentation/admin-guide/nfs/nfsroot.rst          |    2 +-
+ Documentation/admin-guide/perf/hisi-pmu.rst        |    4 +-
+ .../admin-guide/quickly-build-trimmed-linux.rst    |    4 +-
+ Documentation/admin-guide/reporting-issues.rst     |    4 +-
+ Documentation/admin-guide/sysctl/fs.rst            |    4 +-
+ Documentation/admin-guide/sysctl/index.rst         |   18 +-
+ .../verify-bugs-and-bisect-regressions.rst         |    2 +-
+ .../arch/arm/stm32/stm32f746-overview.rst          |    2 +-
+ .../arch/arm/stm32/stm32f769-overview.rst          |    2 +-
+ .../arch/arm/stm32/stm32h743-overview.rst          |    2 +-
+ .../arch/arm/stm32/stm32h750-overview.rst          |    2 +-
+ .../arch/arm/stm32/stm32mp13-overview.rst          |    2 +-
+ .../arch/arm/stm32/stm32mp151-overview.rst         |    2 +-
+ Documentation/arch/loongarch/irq-chip-model.rst    |    4 +-
+ .../arch/powerpc/eeh-pci-error-recovery.rst        |    1 -
+ Documentation/arch/x86/cpuinfo.rst                 |    2 +-
+ Documentation/conf.py                              |  139 +-
+ Documentation/core-api/folio_queue.rst             |    2 +-
+ Documentation/core-api/index.rst                   |    1 +
+ Documentation/core-api/irq/irq-affinity.rst        |    6 +-
+ Documentation/core-api/irq/irq-domain.rst          |   38 +-
+ Documentation/core-api/printk-formats.rst          |    2 +-
+ .../core-api/real-time/architecture-porting.rst    |  109 ++
+ Documentation/core-api/real-time/differences.rst   |  242 +++
+ Documentation/core-api/real-time/index.rst         |   16 +
+ Documentation/core-api/real-time/theory.rst        |  116 ++
+ Documentation/dev-tools/autofdo.rst                |    4 +-
+ Documentation/dev-tools/index.rst                  |    1 +
+ Documentation/dev-tools/ktap.rst                   |    5 +-
+ .../dev-tools/lkmm/docs/access-marking.rst         |   11 +
+ Documentation/dev-tools/lkmm/docs/cheatsheet.rst   |   11 +
+ .../dev-tools/lkmm/docs/control-dependencies.rst   |   11 +
+ Documentation/dev-tools/lkmm/docs/explanation.rst  |   11 +
+ Documentation/dev-tools/lkmm/docs/glossary.rst     |   11 +
+ .../dev-tools/lkmm/docs/herd-representation.rst    |   11 +
+ Documentation/dev-tools/lkmm/docs/index.rst        |   21 +
+ Documentation/dev-tools/lkmm/docs/litmus-tests.rst |   11 +
+ Documentation/dev-tools/lkmm/docs/locking.rst      |   11 +
+ Documentation/dev-tools/lkmm/docs/ordering.rst     |   11 +
+ Documentation/dev-tools/lkmm/docs/readme.rst       |   11 +
+ Documentation/dev-tools/lkmm/docs/recipes.rst      |   11 +
+ Documentation/dev-tools/lkmm/docs/references.rst   |   11 +
+ Documentation/dev-tools/lkmm/docs/simple.rst       |   11 +
+ Documentation/dev-tools/lkmm/index.rst             |   15 +
+ Documentation/dev-tools/lkmm/readme.rst            |   11 +
+ .../devicetree/bindings/submitting-patches.rst     |    2 +-
+ Documentation/doc-guide/kernel-doc.rst             |   29 +-
+ Documentation/doc-guide/sphinx.rst                 |    4 +-
+ .../driver-api/cxl/devices/device-types.rst        |    2 +-
+ .../example-configurations/one-dev-per-hb.rst      |    2 +-
+ Documentation/driver-api/device-io.rst             |    4 +-
+ Documentation/driver-api/driver-model/overview.rst |    2 +-
+ Documentation/driver-api/driver-model/platform.rst |    2 +-
+ Documentation/driver-api/eisa.rst                  |    6 +-
+ Documentation/driver-api/i3c/protocol.rst          |    4 +-
+ Documentation/driver-api/ipmi.rst                  |    4 +-
+ Documentation/driver-api/media/tx-rx.rst           |    4 +-
+ Documentation/driver-api/nvdimm/nvdimm.rst         |    2 +-
+ Documentation/driver-api/pin-control.rst           |   10 +-
+ Documentation/driver-api/pm/devices.rst            |    4 +-
+ Documentation/driver-api/scsi.rst                  |    4 +-
+ Documentation/driver-api/spi.rst                   |    2 +-
+ .../thermal/exynos_thermal_emulation.rst           |   14 +-
+ Documentation/driver-api/usb/hotplug.rst           |    2 +-
+ Documentation/driver-api/usb/index.rst             |    1 +
+ Documentation/driver-api/usb/usb.rst               |    4 +-
+ Documentation/fb/fbcon.rst                         |   42 +-
+ .../features/core/eBPF-JIT/arch-support.txt        |    4 +-
+ .../core/mseal_sys_mappings/arch-support.txt       |    2 +-
+ .../core/thread-info-in-task/arch-support.txt      |    2 +-
+ .../features/core/tracehook/arch-support.txt       |    2 +-
+ .../features/perf/kprobes-event/arch-support.txt   |    2 +-
+ .../features/time/clockevents/arch-support.txt     |    2 +-
+ Documentation/filesystems/erofs.rst                |    2 +-
+ Documentation/filesystems/ext4/atomic_writes.rst   |    6 +-
+ Documentation/filesystems/gfs2-glocks.rst          |    2 +-
+ Documentation/filesystems/hpfs.rst                 |    2 +-
+ Documentation/filesystems/iomap/operations.rst     |    2 +-
+ .../filesystems/ocfs2-online-filecheck.rst         |   20 +-
+ Documentation/filesystems/proc.rst                 |   21 -
+ Documentation/filesystems/propagate_umount.txt     |    6 +-
+ Documentation/filesystems/resctrl.rst              |    2 +-
+ Documentation/filesystems/sharedsubtree.rst        | 1349 +++++++++--------
+ Documentation/filesystems/sysfs.rst                |   25 +-
+ .../filesystems/xfs/xfs-online-fsck-design.rst     |    8 +-
+ Documentation/locking/locktypes.rst                |   21 +
+ Documentation/locking/seqlock.rst                  |    2 +
+ Documentation/maintainer/configure-git.rst         |   28 -
+ .../maintainer/maintainer-entry-profile.rst        |    2 +
+ Documentation/mm/physical_memory.rst               |    2 +
+ Documentation/netlink/specs/index.rst              |   13 +
+ Documentation/networking/can.rst                   |    2 +-
+ .../ethernet/ti/am65_nuss_cpsw_switchdev.rst       |    2 +-
+ .../device_drivers/ethernet/ti/cpsw_switchdev.rst  |    2 +-
+ Documentation/networking/index.rst                 |    2 +-
+ Documentation/networking/netlink_spec/.gitignore   |    1 -
+ Documentation/networking/netlink_spec/readme.txt   |    4 -
+ Documentation/networking/rds.rst                   |    2 +-
+ Documentation/power/pci.rst                        |    4 +-
+ Documentation/power/suspend-and-cpuhotplug.rst     |    2 +-
+ Documentation/process/5.Posting.rst                |    7 +-
+ Documentation/process/changes.rst                  |    9 +-
+ Documentation/process/maintainer-pgp-guide.rst     |  158 +-
+ Documentation/process/submitting-patches.rst       |    6 +-
+ Documentation/sphinx/automarkup.py                 |    2 +-
+ Documentation/sphinx/cdomain.py                    |  247 ----
+ Documentation/sphinx/kernel_feat.py                |    4 +-
+ Documentation/sphinx/kernel_include.py             |  534 +++++--
+ Documentation/sphinx/kerneldoc-preamble.sty        |    2 +-
+ Documentation/sphinx/load_config.py                |   60 -
+ Documentation/sphinx/maintainers_include.py        |    4 +-
+ Documentation/sphinx/parallel-wrapper.sh           |   33 -
+ Documentation/sphinx/parse-headers.pl              |  404 -----
+ Documentation/sphinx/parser_yaml.py                |  123 ++
+ Documentation/sphinx/templates/kernel-toc.html     |    3 +-
+ Documentation/sphinx/templates/translations.html   |    4 +-
+ Documentation/staging/remoteproc.rst               |    2 +-
+ Documentation/trace/boottime-trace.rst             |    2 +-
+ Documentation/trace/debugging.rst                  |    2 +-
+ Documentation/trace/events.rst                     |    8 +-
+ Documentation/trace/fprobe.rst                     |    2 +-
+ Documentation/trace/ftrace-uses.rst                |    2 +-
+ Documentation/trace/ftrace.rst                     |   14 +-
+ Documentation/trace/histogram-design.rst           |  151 +-
+ Documentation/trace/histogram.rst                  |   40 +-
+ Documentation/trace/rv/monitor_synthesis.rst       |    2 +-
+ .../translations/it_IT/doc-guide/sphinx.rst        |    4 +-
+ .../translations/it_IT/process/changes.rst         |   14 -
+ .../translations/zh_CN/doc-guide/sphinx.rst        |    4 +-
+ Documentation/translations/zh_CN/how-to.rst        |    2 +-
+ Documentation/userspace-api/media/Makefile         |   64 -
+ .../userspace-api/media/cec/cec-header.rst         |    5 +-
+ .../media/{ => cec}/cec.h.rst.exceptions           |    0
+ .../media/{ => dvb}/ca.h.rst.exceptions            |    0
+ .../media/{ => dvb}/dmx.h.rst.exceptions           |    0
+ .../media/{ => dvb}/frontend.h.rst.exceptions      |    0
+ Documentation/userspace-api/media/dvb/headers.rst  |   17 +-
+ .../media/{ => dvb}/net.h.rst.exceptions           |    0
+ .../userspace-api/media/mediactl/media-header.rst  |    5 +-
+ .../media/{ => mediactl}/media.h.rst.exceptions    |    0
+ .../userspace-api/media/rc/lirc-header.rst         |    4 +-
+ .../media/{ => rc}/lirc.h.rst.exceptions           |    0
+ Documentation/userspace-api/media/v4l/videodev.rst |    4 +-
+ .../media/{ => v4l}/videodev2.h.rst.exceptions     |    0
+ Documentation/userspace-api/netlink/index.rst      |    2 +-
+ .../userspace-api/netlink/netlink-raw.rst          |    6 +-
+ Documentation/userspace-api/netlink/specs.rst      |    2 +-
+ Documentation/virt/kvm/review-checklist.rst        |    2 +-
+ Documentation/w1/masters/ds2482.rst                |    2 +-
+ Documentation/w1/masters/index.rst                 |    2 +-
+ Documentation/w1/slaves/index.rst                  |    2 +-
+ MAINTAINERS                                        |    8 +-
+ Makefile                                           |    4 +-
+ fs/btrfs/tree-log.c                                |    2 +-
+ scripts/check-variable-fonts.sh                    |  115 --
+ scripts/jobserver-exec                             |   88 +-
+ scripts/kernel-doc.py                              |   34 +-
+ scripts/lib/jobserver.py                           |  149 ++
+ scripts/lib/kdoc/kdoc_files.py                     |    5 +-
+ scripts/lib/kdoc/kdoc_output.py                    |   84 +-
+ scripts/lib/kdoc/kdoc_parser.py                    |  851 ++++++-----
+ scripts/selinux/install_policy.sh                  |    2 +-
+ scripts/sphinx-pre-install                         | 1056 --------------
+ scripts/split-man.pl                               |   28 -
+ tools/docs/check-variable-fonts.py                 |   33 +
+ tools/docs/gen-redirects.py                        |   54 +
+ tools/docs/gen-renames.py                          |  130 ++
+ tools/docs/lib/__init__.py                         |    0
+ tools/docs/lib/enrich_formatter.py                 |   70 +
+ tools/docs/lib/latex_fonts.py                      |  167 +++
+ tools/docs/lib/parse_data_structs.py               |  452 ++++++
+ tools/docs/lib/python_version.py                   |  178 +++
+ tools/docs/parse-headers.py                        |   60 +
+ tools/docs/sphinx-build-wrapper                    |  841 +++++++++++
+ tools/docs/sphinx-pre-install                      | 1540 ++++++++++++++++++++
+ tools/net/ynl/pyynl/lib/__init__.py                |    2 +
+ tools/net/ynl/pyynl/lib/doc_generator.py           |  398 +++++
+ tools/net/ynl/pyynl/ynl_gen_rst.py                 |  384 +----
+ 202 files changed, 8347 insertions(+), 4420 deletions(-)
+ create mode 100644 Documentation/.renames.txt
+ create mode 100644 Documentation/core-api/real-time/architecture-porting.rst
+ create mode 100644 Documentation/core-api/real-time/differences.rst
+ create mode 100644 Documentation/core-api/real-time/index.rst
+ create mode 100644 Documentation/core-api/real-time/theory.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/access-marking.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/cheatsheet.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/control-dependencies.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/explanation.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/glossary.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/herd-representation.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/index.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/litmus-tests.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/locking.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/ordering.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/readme.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/recipes.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/references.rst
+ create mode 100644 Documentation/dev-tools/lkmm/docs/simple.rst
+ create mode 100644 Documentation/dev-tools/lkmm/index.rst
+ create mode 100644 Documentation/dev-tools/lkmm/readme.rst
+ create mode 100644 Documentation/netlink/specs/index.rst
+ delete mode 100644 Documentation/networking/netlink_spec/.gitignore
+ delete mode 100644 Documentation/networking/netlink_spec/readme.txt
+ delete mode 100644 Documentation/sphinx/cdomain.py
+ delete mode 100644 Documentation/sphinx/load_config.py
+ delete mode 100644 Documentation/sphinx/parallel-wrapper.sh
+ delete mode 100755 Documentation/sphinx/parse-headers.pl
+ create mode 100755 Documentation/sphinx/parser_yaml.py
+ delete mode 100644 Documentation/userspace-api/media/Makefile
+ rename Documentation/userspace-api/media/{ => cec}/cec.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => dvb}/ca.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => dvb}/dmx.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => dvb}/frontend.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => dvb}/net.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => mediactl}/media.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => rc}/lirc.h.rst.exceptions (100%)
+ rename Documentation/userspace-api/media/{ => v4l}/videodev2.h.rst.exceptions (100%)
+ delete mode 100755 scripts/check-variable-fonts.sh
+ create mode 100755 scripts/lib/jobserver.py
+ delete mode 100755 scripts/sphinx-pre-install
+ delete mode 100755 scripts/split-man.pl
+ create mode 100755 tools/docs/check-variable-fonts.py
+ create mode 100755 tools/docs/gen-redirects.py
+ create mode 100755 tools/docs/gen-renames.py
+ create mode 100644 tools/docs/lib/__init__.py
+ create mode 100644 tools/docs/lib/enrich_formatter.py
+ create mode 100755 tools/docs/lib/latex_fonts.py
+ create mode 100755 tools/docs/lib/parse_data_structs.py
+ create mode 100644 tools/docs/lib/python_version.py
+ create mode 100755 tools/docs/parse-headers.py
+ create mode 100755 tools/docs/sphinx-build-wrapper
+ create mode 100755 tools/docs/sphinx-pre-install
+ create mode 100644 tools/net/ynl/pyynl/lib/doc_generator.py
+Merging v4l-dvb/next (afb100a5ea7a1 media: venus: pm_helpers: add fallback for the opp-table)
+$ git merge -m Merge branch 'next' of git://linuxtv.org/media-ci/media-pending.git v4l-dvb/next
+Auto-merging .mailmap
+Auto-merging Documentation/devicetree/bindings/i2c/qcom,i2c-cci.yaml
+Auto-merging MAINTAINERS
+Auto-merging drivers/media/i2c/gc2145.c
+Auto-merging drivers/media/i2c/imx219.c
+Auto-merging drivers/media/i2c/imx283.c
+Auto-merging drivers/media/i2c/imx290.c
+Auto-merging drivers/media/i2c/imx296.c
+Auto-merging drivers/media/i2c/imx415.c
+Auto-merging drivers/media/i2c/mt9m114.c
+Auto-merging drivers/media/i2c/ov4689.c
+Auto-merging drivers/media/i2c/ov5640.c
+Auto-merging drivers/media/i2c/ov5645.c
+Auto-merging drivers/media/i2c/ov64a40.c
+Auto-merging drivers/media/i2c/ov8858.c
+Auto-merging drivers/media/i2c/vd55g1.c
+Auto-merging drivers/media/i2c/vd56g3.c
+Auto-merging drivers/media/platform/chips-media/wave5/wave5-vpu-dec.c
+Auto-merging drivers/media/platform/chips-media/wave5/wave5-vpu-enc.c
+Auto-merging drivers/media/platform/qcom/venus/firmware.c
+Auto-merging drivers/media/platform/rockchip/rkvdec/rkvdec.c
+Auto-merging drivers/media/platform/verisilicon/hantro_drv.c
+Merge made by the 'ort' strategy.
+ .mailmap                                           |    6 +-
+ Documentation/ABI/testing/debugfs-cec-error-inj    |    2 +-
+ Documentation/admin-guide/bug-hunting.rst          |    2 +-
+ Documentation/admin-guide/media/i2c-cardlist.rst   |    1 -
+ Documentation/admin-guide/media/ivtv.rst           |    2 +-
+ .../devicetree/bindings/i2c/qcom,i2c-cci.yaml      |    6 +-
+ .../devicetree/bindings/media/cec/cec-common.yaml  |    2 +-
+ .../devicetree/bindings/media/cec/cec-gpio.yaml    |    2 +-
+ .../bindings/media/cec/nvidia,tegra114-cec.yaml    |    2 +-
+ .../devicetree/bindings/media/i2c/adi,adv7604.yaml |    2 +-
+ .../devicetree/bindings/media/i2c/mipi-ccs.yaml    |    7 +-
+ .../bindings/media/i2c/ovti,og0ve1b.yaml           |   97 +
+ .../bindings/media/i2c/ovti,ov02a10.yaml           |    3 +-
+ .../devicetree/bindings/media/i2c/ovti,ov2735.yaml |  108 +
+ .../devicetree/bindings/media/i2c/ovti,ov5645.yaml |    6 +-
+ .../devicetree/bindings/media/i2c/ovti,ov6211.yaml |   96 +
+ .../devicetree/bindings/media/i2c/ovti,ov7251.yaml |    6 +-
+ .../devicetree/bindings/media/i2c/ovti,ov8856.yaml |    3 +-
+ .../bindings/media/i2c/samsung,s5k5baf.yaml        |    6 +-
+ .../bindings/media/i2c/samsung,s5k6a3.yaml         |    6 +-
+ .../devicetree/bindings/media/i2c/sony,imx258.yaml |    1 +
+ .../devicetree/bindings/media/i2c/sony,imx274.yaml |    4 +
+ .../devicetree/bindings/media/i2c/sony,imx290.yaml |    5 +-
+ .../bindings/media/i2c/ti,ds90ub960.yaml           |    3 +
+ .../bindings/media/i2c/toshiba,et8ek8.txt          |    8 +-
+ .../bindings/media/nxp,imx-mipi-csi2.yaml          |   18 +-
+ .../bindings/media/qcom,qcm2290-camss.yaml         |  243 +++
+ .../bindings/media/qcom,qcm2290-venus.yaml         |  130 ++
+ .../bindings/media/qcom,qcs8300-camss.yaml         |  336 +++
+ .../bindings/media/qcom,sa8775p-camss.yaml         |  361 ++++
+ .../bindings/media/qcom,sm8550-iris.yaml           |   16 +-
+ .../bindings/media/qcom,sm8750-iris.yaml           |  186 ++
+ .../devicetree/bindings/media/rockchip-isp1.yaml   |   23 +-
+ .../bindings/media/samsung,exynos4212-fimc-is.yaml |    3 +-
+ .../devicetree/bindings/media/samsung,fimc.yaml    |    3 +-
+ .../devicetree/bindings/media/silabs,si470x.yaml   |    2 +-
+ Documentation/driver-api/media/camera-sensor.rst   |   24 +-
+ .../driver-api/media/maintainer-entry-profile.rst  |    4 +-
+ Documentation/driver-api/media/v4l2-fh.rst         |   59 +-
+ .../translations/zh_CN/admin-guide/bug-hunting.rst |    2 +-
+ .../zh_CN/video4linux/v4l2-framework.txt           |   16 +-
+ .../translations/zh_TW/admin-guide/bug-hunting.rst |    2 +-
+ Documentation/userspace-api/media/cec/cec-api.rst  |    2 +-
+ .../userspace-api/media/drivers/camera-sensor.rst  |   16 +-
+ .../userspace-api/media/drivers/cx2341x-uapi.rst   |    2 +-
+ .../media/dvb/fe-diseqc-send-burst.rst             |    2 +-
+ .../userspace-api/media/dvb/fe-set-tone.rst        |    2 +-
+ .../userspace-api/media/dvb/fe-set-voltage.rst     |    2 +-
+ .../media/dvb/fe_property_parameters.rst           |   23 +-
+ .../dvb/frontend-property-terrestrial-systems.rst  |    2 +-
+ Documentation/userspace-api/media/dvb/intro.rst    |    4 +-
+ .../userspace-api/media/dvb/legacy_dvb_audio.rst   |    4 +-
+ .../userspace-api/media/v4l/dev-subdev.rst         |   12 +-
+ .../userspace-api/media/v4l/metafmt-generic.rst    |    8 +-
+ Documentation/userspace-api/media/v4l/v4l2.rst     |    2 +-
+ MAINTAINERS                                        |  150 +-
+ drivers/gpu/drm/display/drm_dp_cec.c               |    2 +-
+ drivers/media/cec/core/cec-core.c                  |    2 +-
+ drivers/media/cec/platform/cec-gpio/cec-gpio.c     |    2 +-
+ drivers/media/cec/platform/stm32/stm32-cec.c       |    1 -
+ .../media/cec/usb/extron-da-hd-4k-plus/Makefile    |    6 -
+ .../extron-da-hd-4k-plus/extron-da-hd-4k-plus.c    |    6 +-
+ drivers/media/cec/usb/pulse8/pulse8-cec.c          |    4 +-
+ drivers/media/cec/usb/rainshadow/rainshadow-cec.c  |    4 +-
+ drivers/media/common/b2c2/flexcop-sram.c           |    2 +-
+ drivers/media/common/b2c2/flexcop.c                |   22 +-
+ drivers/media/common/cx2341x.c                     |    2 +-
+ drivers/media/common/videobuf2/videobuf2-v4l2.c    |   12 +-
+ drivers/media/dvb-frontends/Kconfig                |    4 +-
+ drivers/media/i2c/Kconfig                          |   52 +-
+ drivers/media/i2c/Makefile                         |    5 +-
+ drivers/media/i2c/adv7180.c                        |  338 +--
+ drivers/media/i2c/adv7604.c                        |    2 +-
+ drivers/media/i2c/adv7842.c                        |    2 +-
+ drivers/media/i2c/ar0521.c                         |    9 +-
+ drivers/media/i2c/cx25840/cx25840-core.c           |    4 +-
+ drivers/media/i2c/ds90ub913.c                      |   17 +-
+ drivers/media/i2c/et8ek8/et8ek8_driver.c           |   34 +-
+ drivers/media/i2c/et8ek8/et8ek8_mode.c             |    9 -
+ drivers/media/i2c/et8ek8/et8ek8_reg.h              |    1 -
+ .../i2c/atomisp-gc0310.c => media/i2c/gc0310.c}    |    0
+ drivers/media/i2c/gc05a2.c                         |    8 +-
+ drivers/media/i2c/gc08a3.c                         |    8 +-
+ drivers/media/i2c/gc2145.c                         |    2 +-
+ drivers/media/i2c/hi556.c                          |   92 +-
+ drivers/media/i2c/hi846.c                          |   11 +-
+ drivers/media/i2c/hi847.c                          |   84 +-
+ drivers/media/i2c/imx208.c                         |   91 +-
+ drivers/media/i2c/imx214.c                         |  247 ++-
+ drivers/media/i2c/imx219.c                         |    6 +-
+ drivers/media/i2c/imx258.c                         |  105 +-
+ drivers/media/i2c/imx274.c                         |    2 +
+ drivers/media/i2c/imx283.c                         |    5 +-
+ drivers/media/i2c/imx290.c                         |   27 +-
+ drivers/media/i2c/imx296.c                         |    4 +-
+ drivers/media/i2c/imx319.c                         |   92 +-
+ drivers/media/i2c/imx334.c                         |   15 +-
+ drivers/media/i2c/imx335.c                         |    9 +-
+ drivers/media/i2c/imx355.c                         |   90 +-
+ drivers/media/i2c/imx412.c                         |    9 +-
+ drivers/media/i2c/imx415.c                         |    2 +-
+ drivers/media/i2c/ir-kbd-i2c.c                     |    6 +-
+ drivers/media/i2c/mt9m001.c                        |    5 +-
+ drivers/media/i2c/mt9m111.c                        |    5 +-
+ drivers/media/i2c/mt9m114.c                        |   73 +-
+ drivers/media/i2c/mt9p031.c                        |    9 +-
+ drivers/media/i2c/mt9t112.c                        |   11 +-
+ drivers/media/i2c/mt9v032.c                        |  105 +-
+ drivers/media/i2c/mt9v111.c                        |    9 +-
+ drivers/media/i2c/og01a1b.c                        |  115 +-
+ drivers/media/i2c/og0ve1b.c                        |  816 ++++++++
+ drivers/media/i2c/ov02a10.c                        |   45 +-
+ drivers/media/i2c/ov02c10.c                        |  108 +-
+ drivers/media/i2c/ov02e10.c                        |  107 +-
+ drivers/media/i2c/ov08d10.c                        |   82 +-
+ drivers/media/i2c/ov08x40.c                        |   97 +-
+ drivers/media/i2c/ov13858.c                        |   69 +-
+ drivers/media/i2c/ov13b10.c                        |  110 +-
+ drivers/media/i2c/ov2659.c                         |    5 +-
+ drivers/media/i2c/ov2680.c                         |   29 +-
+ drivers/media/i2c/ov2685.c                         |   16 +-
+ drivers/media/i2c/ov2735.c                         | 1109 ++++++++++
+ drivers/media/i2c/ov2740.c                         |   91 +-
+ drivers/media/i2c/ov4689.c                         |   12 +-
+ drivers/media/i2c/ov5640.c                         |    9 +-
+ drivers/media/i2c/ov5645.c                         |   13 +-
+ drivers/media/i2c/ov5647.c                         |    9 +-
+ drivers/media/i2c/ov5648.c                         |   10 +-
+ drivers/media/i2c/ov5670.c                         |  105 +-
+ drivers/media/i2c/ov5675.c                         |   89 +-
+ drivers/media/i2c/ov5693.c                         |   16 +-
+ drivers/media/i2c/ov5695.c                         |   16 +-
+ drivers/media/i2c/ov6211.c                         |  793 +++++++
+ drivers/media/i2c/ov64a40.c                        |    2 +-
+ drivers/media/i2c/ov6650.c                         | 1149 -----------
+ drivers/media/i2c/ov7251.c                         |   26 +-
+ drivers/media/i2c/ov7740.c                         |   11 +-
+ drivers/media/i2c/ov8856.c                         |   95 +-
+ drivers/media/i2c/ov8858.c                         |    2 +-
+ drivers/media/i2c/ov8865.c                         |   50 +-
+ drivers/media/i2c/ov9282.c                         |    9 +-
+ drivers/media/i2c/ov9640.c                         |    5 +-
+ drivers/media/i2c/ov9650.c                         |    5 +-
+ drivers/media/i2c/ov9734.c                         |   82 +-
+ drivers/media/i2c/rj54n1cb0c.c                     |    9 +-
+ drivers/media/i2c/s5c73m3/s5c73m3-core.c           |   19 +-
+ drivers/media/i2c/s5c73m3/s5c73m3.h                |    2 -
+ drivers/media/i2c/s5k5baf.c                        |   21 +-
+ drivers/media/i2c/s5k6a3.c                         |   20 +-
+ drivers/media/i2c/saa6752hs.c                      |    2 +-
+ drivers/media/i2c/saa7115.c                        |    2 +-
+ drivers/media/i2c/saa7127.c                        |    2 +-
+ drivers/media/i2c/saa717x.c                        |    2 +-
+ drivers/media/i2c/tc358743.c                       |  113 +-
+ drivers/media/i2c/tc358743_regs.h                  |   57 +-
+ drivers/media/i2c/tda9840.c                        |    2 +-
+ drivers/media/i2c/tea6415c.c                       |    2 +-
+ drivers/media/i2c/tea6420.c                        |    2 +-
+ drivers/media/i2c/ths7303.c                        |    2 +-
+ drivers/media/i2c/tlv320aic23b.c                   |    2 +-
+ drivers/media/i2c/upd64031a.c                      |    2 +-
+ drivers/media/i2c/upd64083.c                       |    2 +-
+ drivers/media/i2c/vd55g1.c                         |    4 +-
+ drivers/media/i2c/vd56g3.c                         |    2 +-
+ drivers/media/i2c/vgxy61.c                         |   26 +-
+ drivers/media/i2c/vp27smpx.c                       |    2 +-
+ drivers/media/i2c/wm8739.c                         |    2 +-
+ drivers/media/i2c/wm8775.c                         |    2 +-
+ drivers/media/mc/mc-devnode.c                      |    6 +-
+ drivers/media/mc/mc-entity.c                       |    6 +-
+ drivers/media/mc/mc-request.c                      |    2 +-
+ drivers/media/pci/b2c2/flexcop-pci.c               |    2 +-
+ drivers/media/pci/bt8xx/bttv-driver.c              |   14 +-
+ drivers/media/pci/bt8xx/bttv-vbi.c                 |    6 +-
+ drivers/media/pci/cobalt/cobalt-driver.c           |    2 +-
+ drivers/media/pci/cobalt/cobalt-v4l2.c             |   60 +-
+ drivers/media/pci/cx18/cx18-audio.c                |    2 +-
+ drivers/media/pci/cx18/cx18-audio.h                |    2 +-
+ drivers/media/pci/cx18/cx18-av-audio.c             |    2 +-
+ drivers/media/pci/cx18/cx18-av-core.c              |    2 +-
+ drivers/media/pci/cx18/cx18-av-core.h              |    2 +-
+ drivers/media/pci/cx18/cx18-av-firmware.c          |    2 +-
+ drivers/media/pci/cx18/cx18-av-vbi.c               |    2 +-
+ drivers/media/pci/cx18/cx18-cards.c                |    2 +-
+ drivers/media/pci/cx18/cx18-cards.h                |    2 +-
+ drivers/media/pci/cx18/cx18-controls.c             |    2 +-
+ drivers/media/pci/cx18/cx18-controls.h             |    2 +-
+ drivers/media/pci/cx18/cx18-driver.c               |    2 +-
+ drivers/media/pci/cx18/cx18-driver.h               |    4 +-
+ drivers/media/pci/cx18/cx18-fileops.c              |   13 +-
+ drivers/media/pci/cx18/cx18-fileops.h              |    2 +-
+ drivers/media/pci/cx18/cx18-firmware.c             |    2 +-
+ drivers/media/pci/cx18/cx18-firmware.h             |    2 +-
+ drivers/media/pci/cx18/cx18-gpio.c                 |    2 +-
+ drivers/media/pci/cx18/cx18-gpio.h                 |    2 +-
+ drivers/media/pci/cx18/cx18-i2c.c                  |    2 +-
+ drivers/media/pci/cx18/cx18-i2c.h                  |    2 +-
+ drivers/media/pci/cx18/cx18-io.c                   |    2 +-
+ drivers/media/pci/cx18/cx18-io.h                   |    2 +-
+ drivers/media/pci/cx18/cx18-ioctl.c                |   66 +-
+ drivers/media/pci/cx18/cx18-ioctl.h                |    2 +-
+ drivers/media/pci/cx18/cx18-irq.c                  |    2 +-
+ drivers/media/pci/cx18/cx18-irq.h                  |    2 +-
+ drivers/media/pci/cx18/cx18-mailbox.c              |    2 +-
+ drivers/media/pci/cx18/cx18-mailbox.h              |    2 +-
+ drivers/media/pci/cx18/cx18-queue.c                |   15 +-
+ drivers/media/pci/cx18/cx18-queue.h                |    2 +-
+ drivers/media/pci/cx18/cx18-scb.c                  |    2 +-
+ drivers/media/pci/cx18/cx18-scb.h                  |    2 +-
+ drivers/media/pci/cx18/cx18-streams.c              |    2 +-
+ drivers/media/pci/cx18/cx18-streams.h              |    2 +-
+ drivers/media/pci/cx18/cx18-vbi.c                  |    2 +-
+ drivers/media/pci/cx18/cx18-vbi.h                  |    2 +-
+ drivers/media/pci/cx18/cx18-version.h              |    2 +-
+ drivers/media/pci/cx18/cx18-video.c                |    2 +-
+ drivers/media/pci/cx18/cx18-video.h                |    2 +-
+ drivers/media/pci/cx18/cx23418.h                   |    2 +-
+ drivers/media/pci/intel/ipu6/ipu6-isys-csi2.c      |    2 +-
+ drivers/media/pci/intel/ipu6/ipu6-isys-subdev.c    |    6 +
+ drivers/media/pci/intel/ipu6/ipu6-isys-video.c     |    1 -
+ drivers/media/pci/ivtv/ivtv-alsa-pcm.c             |    2 -
+ drivers/media/pci/ivtv/ivtv-cards.c                |    2 +-
+ drivers/media/pci/ivtv/ivtv-cards.h                |    2 +-
+ drivers/media/pci/ivtv/ivtv-controls.c             |    2 +-
+ drivers/media/pci/ivtv/ivtv-controls.h             |    2 +-
+ drivers/media/pci/ivtv/ivtv-driver.c               |   17 +-
+ drivers/media/pci/ivtv/ivtv-driver.h               |   24 +-
+ drivers/media/pci/ivtv/ivtv-fileops.c              |   42 +-
+ drivers/media/pci/ivtv/ivtv-fileops.h              |    2 +-
+ drivers/media/pci/ivtv/ivtv-firmware.c             |    2 +-
+ drivers/media/pci/ivtv/ivtv-firmware.h             |    2 +-
+ drivers/media/pci/ivtv/ivtv-gpio.c                 |    2 +-
+ drivers/media/pci/ivtv/ivtv-gpio.h                 |    2 +-
+ drivers/media/pci/ivtv/ivtv-i2c.c                  |    2 +-
+ drivers/media/pci/ivtv/ivtv-i2c.h                  |    2 +-
+ drivers/media/pci/ivtv/ivtv-ioctl.c                |  126 +-
+ drivers/media/pci/ivtv/ivtv-ioctl.h                |    2 +-
+ drivers/media/pci/ivtv/ivtv-irq.c                  |    8 +-
+ drivers/media/pci/ivtv/ivtv-irq.h                  |    2 +-
+ drivers/media/pci/ivtv/ivtv-mailbox.c              |    2 +-
+ drivers/media/pci/ivtv/ivtv-mailbox.h              |    2 +-
+ drivers/media/pci/ivtv/ivtv-queue.c                |    2 +-
+ drivers/media/pci/ivtv/ivtv-queue.h                |    2 +-
+ drivers/media/pci/ivtv/ivtv-routing.c              |    2 +-
+ drivers/media/pci/ivtv/ivtv-routing.h              |    2 +-
+ drivers/media/pci/ivtv/ivtv-streams.c              |   17 +-
+ drivers/media/pci/ivtv/ivtv-streams.h              |    2 +-
+ drivers/media/pci/ivtv/ivtv-udma.c                 |    2 +-
+ drivers/media/pci/ivtv/ivtv-udma.h                 |    2 +-
+ drivers/media/pci/ivtv/ivtv-vbi.c                  |    2 +-
+ drivers/media/pci/ivtv/ivtv-vbi.h                  |    2 +-
+ drivers/media/pci/ivtv/ivtv-version.h              |    2 +-
+ drivers/media/pci/ivtv/ivtv-yuv.c                  |    8 +-
+ drivers/media/pci/mgb4/mgb4_trigger.c              |    2 +-
+ drivers/media/pci/mgb4/mgb4_vin.c                  |    3 +-
+ drivers/media/pci/saa7134/saa7134-video.c          |    4 +-
+ drivers/media/pci/saa7164/saa7164-encoder.c        |   30 +-
+ drivers/media/pci/saa7164/saa7164-vbi.c            |   25 +-
+ drivers/media/pci/saa7164/saa7164.h                |   10 +
+ drivers/media/pci/tw68/tw68-core.c                 |    4 +-
+ drivers/media/pci/tw68/tw68-reg.h                  |    2 +-
+ drivers/media/pci/tw68/tw68-risc.c                 |    2 +-
+ drivers/media/pci/tw68/tw68-video.c                |    2 +-
+ drivers/media/pci/tw68/tw68.h                      |    2 +-
+ drivers/media/pci/zoran/zoran.h                    |    6 -
+ drivers/media/pci/zoran/zoran_card.c               |    4 -
+ drivers/media/pci/zoran/zoran_card.h               |    2 -
+ drivers/media/pci/zoran/zoran_driver.c             |   35 +-
+ drivers/media/platform/allegro-dvt/allegro-core.c  |   33 +-
+ .../platform/amlogic/c3/mipi-csi2/c3-mipi-csi2.c   |    7 +-
+ drivers/media/platform/amlogic/meson-ge2d/ge2d.c   |   25 +-
+ drivers/media/platform/amphion/vpu.h               |    2 +-
+ drivers/media/platform/amphion/vpu_v4l2.c          |   22 +-
+ drivers/media/platform/amphion/vpu_v4l2.h          |    8 -
+ drivers/media/platform/aspeed/aspeed-video.c       |  199 +-
+ drivers/media/platform/cadence/cdns-csi2rx.c       |   75 +-
+ .../media/platform/chips-media/coda/coda-common.c  |   50 +-
+ .../platform/chips-media/wave5/wave5-helper.c      |   10 +-
+ .../platform/chips-media/wave5/wave5-helper.h      |    2 +-
+ .../platform/chips-media/wave5/wave5-vpu-dec.c     |   23 +-
+ .../platform/chips-media/wave5/wave5-vpu-enc.c     |   31 +-
+ .../media/platform/chips-media/wave5/wave5-vpu.h   |    5 +
+ .../media/platform/imagination/e5010-jpeg-enc.c    |   23 +-
+ .../media/platform/imagination/e5010-jpeg-enc.h    |    5 +
+ drivers/media/platform/m2m-deinterlace.c           |   26 +-
+ drivers/media/platform/marvell/cafe-driver.c       |    2 +-
+ .../media/platform/mediatek/jpeg/mtk_jpeg_core.c   |   37 +-
+ drivers/media/platform/mediatek/mdp/mtk_mdp_m2m.c  |   29 +-
+ .../media/platform/mediatek/mdp3/mtk-mdp3-comp.c   |    3 +
+ .../media/platform/mediatek/mdp3/mtk-mdp3-core.c   |    2 +-
+ .../media/platform/mediatek/mdp3/mtk-mdp3-m2m.c    |   25 +-
+ .../media/platform/mediatek/mdp3/mtk-mdp3-vpu.c    |    2 +-
+ .../mediatek/vcodec/decoder/mtk_vcodec_dec.c       |   36 +-
+ .../mediatek/vcodec/decoder/mtk_vcodec_dec_drv.c   |    9 +-
+ .../mediatek/vcodec/decoder/mtk_vcodec_dec_drv.h   |    5 +
+ .../mediatek/vcodec/encoder/mtk_vcodec_enc.c       |   37 +-
+ .../mediatek/vcodec/encoder/mtk_vcodec_enc_drv.c   |    9 +-
+ .../mediatek/vcodec/encoder/mtk_vcodec_enc_drv.h   |    4 +-
+ drivers/media/platform/nvidia/tegra-vde/v4l2.c     |   35 +-
+ drivers/media/platform/nxp/dw100/dw100.c           |    7 +-
+ drivers/media/platform/nxp/imx-jpeg/mxc-jpeg.c     |   45 +-
+ drivers/media/platform/nxp/imx-mipi-csis.c         |  353 ++--
+ drivers/media/platform/nxp/imx-pxp.c               |    7 +-
+ .../media/platform/nxp/imx8-isi/imx8-isi-core.c    |    8 +
+ .../media/platform/nxp/imx8-isi/imx8-isi-core.h    |   14 +-
+ drivers/media/platform/nxp/imx8-isi/imx8-isi-hw.c  |    2 +-
+ drivers/media/platform/nxp/imx8-isi/imx8-isi-m2m.c |  292 ++-
+ .../media/platform/nxp/imx8-isi/imx8-isi-pipe.c    |    2 +-
+ .../media/platform/nxp/imx8-isi/imx8-isi-video.c   |  156 +-
+ drivers/media/platform/nxp/mx2_emmaprp.c           |   24 +-
+ drivers/media/platform/qcom/camss/Makefile         |    6 +-
+ drivers/media/platform/qcom/camss/camss-csid-340.c |  190 ++
+ .../camss/{camss-csid-780.c => camss-csid-gen3.c}  |   34 +-
+ .../camss/{camss-csid-780.h => camss-csid-gen3.h}  |    8 +-
+ drivers/media/platform/qcom/camss/camss-csid.h     |    3 +-
+ .../platform/qcom/camss/camss-csiphy-3ph-1-0.c     |  175 ++
+ drivers/media/platform/qcom/camss/camss-vfe-340.c  |  320 +++
+ .../camss/{camss-vfe-780.c => camss-vfe-gen3.c}    |   76 +-
+ drivers/media/platform/qcom/camss/camss-vfe.c      |   28 +-
+ drivers/media/platform/qcom/camss/camss-vfe.h      |    3 +-
+ drivers/media/platform/qcom/camss/camss-video.c    |   43 +-
+ drivers/media/platform/qcom/camss/camss.c          |  705 ++++++-
+ drivers/media/platform/qcom/camss/camss.h          |    4 +-
+ drivers/media/platform/qcom/iris/Makefile          |    5 +-
+ drivers/media/platform/qcom/iris/iris_buffer.c     |  222 +-
+ drivers/media/platform/qcom/iris/iris_buffer.h     |    7 +-
+ drivers/media/platform/qcom/iris/iris_common.c     |  232 +++
+ drivers/media/platform/qcom/iris/iris_common.h     |   18 +
+ drivers/media/platform/qcom/iris/iris_core.c       |   10 +-
+ drivers/media/platform/qcom/iris/iris_core.h       |   20 +-
+ drivers/media/platform/qcom/iris/iris_ctrls.c      |  675 +++++-
+ drivers/media/platform/qcom/iris/iris_ctrls.h      |   15 +
+ drivers/media/platform/qcom/iris/iris_firmware.c   |   15 +-
+ drivers/media/platform/qcom/iris/iris_hfi_common.h |    2 +-
+ .../platform/qcom/iris/iris_hfi_gen1_command.c     |  474 ++++-
+ .../platform/qcom/iris/iris_hfi_gen1_defines.h     |  112 +-
+ .../platform/qcom/iris/iris_hfi_gen1_response.c    |   60 +-
+ .../platform/qcom/iris/iris_hfi_gen2_command.c     |  359 +++-
+ .../platform/qcom/iris/iris_hfi_gen2_defines.h     |   44 +-
+ .../platform/qcom/iris/iris_hfi_gen2_response.c    |   46 +-
+ drivers/media/platform/qcom/iris/iris_instance.h   |   24 +
+ .../platform/qcom/iris/iris_platform_common.h      |   82 +-
+ .../media/platform/qcom/iris/iris_platform_gen2.c  |  609 +++++-
+ .../platform/qcom/iris/iris_platform_qcs8300.h     |  352 +++-
+ .../platform/qcom/iris/iris_platform_sm8250.c      |  236 ++-
+ .../platform/qcom/iris/iris_platform_sm8750.h      |   22 +
+ drivers/media/platform/qcom/iris/iris_probe.c      |   37 +-
+ drivers/media/platform/qcom/iris/iris_state.c      |    9 +-
+ drivers/media/platform/qcom/iris/iris_state.h      |    1 +
+ drivers/media/platform/qcom/iris/iris_utils.c      |   36 +
+ drivers/media/platform/qcom/iris/iris_utils.h      |    2 +
+ drivers/media/platform/qcom/iris/iris_vb2.c        |   58 +-
+ drivers/media/platform/qcom/iris/iris_vdec.c       |  251 +--
+ drivers/media/platform/qcom/iris/iris_vdec.h       |   13 +-
+ drivers/media/platform/qcom/iris/iris_venc.c       |  579 ++++++
+ drivers/media/platform/qcom/iris/iris_venc.h       |   27 +
+ drivers/media/platform/qcom/iris/iris_vidc.c       |  335 ++-
+ drivers/media/platform/qcom/iris/iris_vpu2.c       |    2 +
+ drivers/media/platform/qcom/iris/iris_vpu3x.c      |  202 +-
+ drivers/media/platform/qcom/iris/iris_vpu_buffer.c |  922 ++++++++-
+ drivers/media/platform/qcom/iris/iris_vpu_buffer.h |   24 +-
+ drivers/media/platform/qcom/iris/iris_vpu_common.c |   14 +-
+ drivers/media/platform/qcom/iris/iris_vpu_common.h |    6 +
+ drivers/media/platform/qcom/venus/core.c           |  113 +-
+ drivers/media/platform/qcom/venus/core.h           |   22 +-
+ drivers/media/platform/qcom/venus/firmware.c       |   38 +-
+ drivers/media/platform/qcom/venus/firmware.h       |    2 +
+ drivers/media/platform/qcom/venus/helpers.c        |   12 +-
+ drivers/media/platform/qcom/venus/hfi_msgs.c       |   11 +-
+ drivers/media/platform/qcom/venus/hfi_parser.c     |    2 +-
+ drivers/media/platform/qcom/venus/hfi_platform.c   |   23 +-
+ drivers/media/platform/qcom/venus/hfi_platform.h   |   34 +-
+ .../media/platform/qcom/venus/hfi_platform_v4.c    |  188 +-
+ .../media/platform/qcom/venus/hfi_platform_v6.c    |   33 +-
+ drivers/media/platform/qcom/venus/hfi_venus.c      |   25 +-
+ drivers/media/platform/qcom/venus/hfi_venus_io.h   |    4 +
+ drivers/media/platform/qcom/venus/pm_helpers.c     |   11 +-
+ drivers/media/platform/qcom/venus/vdec.c           |    5 +-
+ drivers/media/platform/qcom/venus/venc.c           |    5 +-
+ drivers/media/platform/raspberrypi/rp1-cfe/csi2.c  |    2 +-
+ .../media/platform/renesas/rcar-vin/rcar-core.c    |    8 +-
+ .../media/platform/renesas/rcar-vin/rcar-v4l2.c    |    2 -
+ drivers/media/platform/renesas/rcar_drif.c         |   12 +-
+ drivers/media/platform/renesas/rcar_fdp1.c         |   27 +-
+ drivers/media/platform/renesas/rcar_jpu.c          |   29 +-
+ drivers/media/platform/renesas/renesas-ceu.c       |   10 +-
+ .../media/platform/renesas/rzg2l-cru/rzg2l-core.c  |    2 -
+ .../media/platform/renesas/rzg2l-cru/rzg2l-cru.h   |    9 -
+ .../media/platform/renesas/rzg2l-cru/rzg2l-video.c |   31 +-
+ drivers/media/platform/renesas/vsp1/vsp1_drv.c     |   14 +-
+ drivers/media/platform/renesas/vsp1/vsp1_histo.c   |    6 +-
+ drivers/media/platform/renesas/vsp1/vsp1_video.c   |   18 +-
+ drivers/media/platform/renesas/vsp1/vsp1_vspx.c    |    1 +
+ drivers/media/platform/rockchip/rga/rga.c          |   30 +-
+ drivers/media/platform/rockchip/rga/rga.h          |    5 +
+ .../media/platform/rockchip/rkisp1/rkisp1-common.h |   17 +-
+ .../media/platform/rockchip/rkisp1/rkisp1-dev.c    |  123 +-
+ drivers/media/platform/rockchip/rkvdec/rkvdec.c    |   21 +-
+ drivers/media/platform/rockchip/rkvdec/rkvdec.h    |    4 +-
+ .../media/platform/samsung/exynos-gsc/gsc-core.h   |    6 +-
+ .../media/platform/samsung/exynos-gsc/gsc-m2m.c    |   37 +-
+ .../media/platform/samsung/exynos4-is/fimc-core.h  |    5 +-
+ .../media/platform/samsung/exynos4-is/fimc-m2m.c   |   19 +-
+ .../platform/samsung/s3c-camif/camif-capture.c     |   26 +-
+ drivers/media/platform/samsung/s5p-g2d/g2d.c       |   40 +-
+ .../media/platform/samsung/s5p-jpeg/jpeg-core.c    |   33 +-
+ drivers/media/platform/samsung/s5p-mfc/s5p_mfc.c   |   17 +-
+ .../platform/samsung/s5p-mfc/s5p_mfc_cmd_v6.c      |   35 +-
+ .../platform/samsung/s5p-mfc/s5p_mfc_common.h      |    6 +-
+ .../media/platform/samsung/s5p-mfc/s5p_mfc_dec.c   |   34 +-
+ .../media/platform/samsung/s5p-mfc/s5p_mfc_enc.c   |   38 +-
+ drivers/media/platform/st/sti/bdisp/bdisp-v4l2.c   |   30 +-
+ .../media/platform/st/sti/delta/delta-mjpeg-dec.c  |   20 +-
+ drivers/media/platform/st/sti/delta/delta-v4l2.c   |   41 +-
+ drivers/media/platform/st/sti/hva/hva-v4l2.c       |   38 +-
+ drivers/media/platform/st/sti/hva/hva.h            |    2 -
+ drivers/media/platform/st/stm32/dma2d/dma2d.c      |   28 +-
+ drivers/media/platform/st/stm32/stm32-csi.c        |    4 +-
+ drivers/media/platform/st/stm32/stm32-dcmi.c       |    4 +-
+ .../platform/sunxi/sun6i-csi/sun6i_csi_capture.c   |   16 +-
+ drivers/media/platform/sunxi/sun8i-di/sun8i-di.c   |   10 +-
+ .../platform/sunxi/sun8i-rotate/sun8i_rotate.c     |   10 +-
+ .../media/platform/synopsys/hdmirx/snps_hdmirx.c   |    8 +-
+ drivers/media/platform/ti/Kconfig                  |    3 +-
+ .../media/platform/ti/j721e-csi2rx/j721e-csi2rx.c  |   67 +-
+ drivers/media/platform/ti/omap/omap_vout.c         |    6 +-
+ drivers/media/platform/ti/omap3isp/ispccdc.c       |    8 +-
+ drivers/media/platform/ti/omap3isp/isph3a_aewb.c   |    2 +-
+ drivers/media/platform/ti/omap3isp/isph3a_af.c     |    2 +-
+ drivers/media/platform/ti/omap3isp/isphist.c       |    2 +-
+ drivers/media/platform/ti/omap3isp/ispstat.c       |    7 -
+ drivers/media/platform/ti/omap3isp/ispstat.h       |    3 -
+ drivers/media/platform/ti/omap3isp/ispvideo.c      |   36 +-
+ drivers/media/platform/ti/omap3isp/ispvideo.h      |    6 +-
+ drivers/media/platform/ti/vpe/vpe.c                |   21 +-
+ drivers/media/platform/verisilicon/hantro.h        |    4 +-
+ drivers/media/platform/verisilicon/hantro_drv.c    |   12 +-
+ drivers/media/platform/verisilicon/hantro_v4l2.c   |   28 +-
+ drivers/media/platform/verisilicon/imx8m_vpu_hw.c  |   20 +-
+ drivers/media/platform/xilinx/xilinx-dma.c         |   10 +-
+ drivers/media/radio/Kconfig                        |   17 -
+ drivers/media/radio/Makefile                       |    1 -
+ drivers/media/radio/radio-aimslab.c                |    2 +-
+ drivers/media/radio/radio-aztech.c                 |    2 +-
+ drivers/media/radio/radio-gemtek.c                 |    2 +-
+ drivers/media/radio/radio-isa.c                    |    2 +-
+ drivers/media/radio/radio-isa.h                    |    2 +-
+ drivers/media/radio/radio-keene.c                  |    4 +-
+ drivers/media/radio/radio-miropcm20.c              |    2 +-
+ drivers/media/radio/radio-raremono.c               |    4 +-
+ drivers/media/radio/radio-rtrack2.c                |    2 +-
+ drivers/media/radio/radio-terratec.c               |    2 +-
+ drivers/media/radio/radio-wl1273.c                 | 2159 --------------------
+ drivers/media/radio/radio-zoltrix.c                |    2 +-
+ drivers/media/radio/si4713/radio-platform-si4713.c |   10 +-
+ drivers/media/rc/imon.c                            |   99 +-
+ drivers/media/rc/lirc_dev.c                        |    9 +-
+ drivers/media/rc/redrat3.c                         |    2 +-
+ drivers/media/test-drivers/vicodec/vicodec-core.c  |   23 +-
+ drivers/media/test-drivers/vim2m.c                 |   23 +-
+ drivers/media/test-drivers/vimc/vimc-capture.c     |    4 +-
+ drivers/media/test-drivers/vimc/vimc-core.c        |    2 -
+ drivers/media/test-drivers/visl/visl-core.c        |    5 +-
+ drivers/media/test-drivers/visl/visl.h             |    7 +-
+ drivers/media/test-drivers/vivid/vivid-cec.c       |   12 +-
+ drivers/media/test-drivers/vivid/vivid-core.c      |  100 +-
+ drivers/media/test-drivers/vivid/vivid-radio-rx.c  |   12 +-
+ drivers/media/test-drivers/vivid/vivid-radio-rx.h  |    8 +-
+ drivers/media/test-drivers/vivid/vivid-radio-tx.c  |    8 +-
+ drivers/media/test-drivers/vivid/vivid-radio-tx.h  |    4 +-
+ drivers/media/test-drivers/vivid/vivid-sdr-cap.c   |   18 +-
+ drivers/media/test-drivers/vivid/vivid-sdr-cap.h   |   18 +-
+ drivers/media/test-drivers/vivid/vivid-vbi-cap.c   |   10 +-
+ drivers/media/test-drivers/vivid/vivid-vbi-cap.h   |    8 +-
+ drivers/media/test-drivers/vivid/vivid-vbi-out.c   |    8 +-
+ drivers/media/test-drivers/vivid/vivid-vbi-out.h   |    6 +-
+ drivers/media/test-drivers/vivid/vivid-vid-cap.c   |   24 +-
+ drivers/media/test-drivers/vivid/vivid-vid-cap.h   |   24 +-
+ .../media/test-drivers/vivid/vivid-vid-common.c    |    8 +-
+ .../media/test-drivers/vivid/vivid-vid-common.h    |    8 +-
+ drivers/media/test-drivers/vivid/vivid-vid-out.c   |   16 +-
+ drivers/media/test-drivers/vivid/vivid-vid-out.h   |   16 +-
+ drivers/media/tuners/xc4000.c                      |    8 +-
+ drivers/media/tuners/xc5000.c                      |   14 +-
+ drivers/media/usb/au0828/au0828-video.c            |    5 +-
+ drivers/media/usb/cx231xx/cx231xx-417.c            |    2 +-
+ drivers/media/usb/em28xx/Kconfig                   |    1 +
+ drivers/media/usb/em28xx/em28xx-dvb.c              |    4 +-
+ drivers/media/usb/gspca/gspca.c                    |   18 +-
+ drivers/media/usb/hdpvr/hdpvr-video.c              |   69 +-
+ drivers/media/usb/pvrusb2/pvrusb2-v4l2.c           |   69 +-
+ drivers/media/usb/stk1160/stk1160-core.c           |    3 +-
+ drivers/media/usb/stk1160/stk1160-video.c          |    7 +-
+ drivers/media/usb/uvc/uvc_ctrl.c                   |   56 +-
+ drivers/media/usb/uvc/uvc_driver.c                 |  115 +-
+ drivers/media/usb/uvc/uvc_entity.c                 |    4 +-
+ drivers/media/usb/uvc/uvc_metadata.c               |   71 +-
+ drivers/media/usb/uvc/uvc_status.c                 |    7 +-
+ drivers/media/usb/uvc/uvc_v4l2.c                   |  128 +-
+ drivers/media/usb/uvc/uvc_video.c                  |   10 +-
+ drivers/media/usb/uvc/uvcvideo.h                   |   21 +-
+ drivers/media/v4l2-core/v4l2-common.c              |   90 +-
+ drivers/media/v4l2-core/v4l2-compat-ioctl32.c      |   11 +-
+ drivers/media/v4l2-core/v4l2-ctrls-api.c           |   13 +-
+ drivers/media/v4l2-core/v4l2-ctrls-core.c          |    2 +-
+ drivers/media/v4l2-core/v4l2-ctrls-defs.c          |    2 +-
+ drivers/media/v4l2-core/v4l2-ctrls-priv.h          |    2 +-
+ drivers/media/v4l2-core/v4l2-ctrls-request.c       |    2 +-
+ drivers/media/v4l2-core/v4l2-dev.c                 |   45 +-
+ drivers/media/v4l2-core/v4l2-device.c              |    2 +-
+ drivers/media/v4l2-core/v4l2-dv-timings.c          |    4 +
+ drivers/media/v4l2-core/v4l2-fh.c                  |   16 +-
+ drivers/media/v4l2-core/v4l2-ioctl.c               |  456 ++---
+ drivers/media/v4l2-core/v4l2-mem2mem.c             |   50 +-
+ drivers/media/v4l2-core/v4l2-subdev.c              |   40 +-
+ drivers/staging/media/atomisp/i2c/Kconfig          |    9 -
+ drivers/staging/media/atomisp/i2c/Makefile         |    1 -
+ drivers/staging/media/atomisp/pci/atomisp_subdev.c |    9 +-
+ .../media/atomisp/pci/runtime/bufq/src/bufq.c      |    4 +-
+ drivers/staging/media/imx/imx-media-csc-scaler.c   |   26 +-
+ drivers/staging/media/imx/imx-media-csi.c          |    8 +-
+ drivers/staging/media/ipu3/ipu3-css.c              |    3 +-
+ drivers/staging/media/ipu3/ipu3-v4l2.c             |    5 +-
+ drivers/staging/media/ipu7/ipu7-isys-csi2.c        |    2 +-
+ drivers/staging/media/ipu7/ipu7-isys-queue.c       |    3 +-
+ drivers/staging/media/ipu7/ipu7-isys-subdev.c      |   35 +-
+ drivers/staging/media/ipu7/ipu7-isys-subdev.h      |    1 -
+ drivers/staging/media/ipu7/ipu7-isys-video.c       |   37 +-
+ drivers/staging/media/ipu7/ipu7.c                  |   29 +-
+ drivers/staging/media/meson/vdec/vdec.c            |   29 +-
+ drivers/staging/media/meson/vdec/vdec.h            |    5 +
+ drivers/staging/media/sunxi/cedrus/cedrus.c        |    8 +-
+ drivers/staging/media/sunxi/cedrus/cedrus.h        |    5 +
+ drivers/staging/media/sunxi/cedrus/cedrus_video.c  |    5 -
+ .../media/sunxi/sun6i-isp/sun6i_isp_capture.c      |   16 +-
+ .../media/sunxi/sun6i-isp/sun6i_isp_params.c       |    6 +-
+ drivers/staging/media/tegra-video/tegra20.c        |    4 +-
+ drivers/staging/most/video/video.c                 |   19 +-
+ drivers/usb/gadget/function/uvc.h                  |    5 +
+ drivers/usb/gadget/function/uvc_v4l2.c             |    8 +-
+ include/dt-bindings/media/tvp5150.h                |    2 +-
+ include/linux/usb/uvc.h                            |   22 +
+ include/linux/videodev2.h                          |    2 +-
+ include/media/cadence/cdns-csi2rx.h                |   19 +
+ include/media/drv-intf/cx25840.h                   |    2 +-
+ include/media/drv-intf/msp3400.h                   |    2 +-
+ include/media/i2c/bt819.h                          |    2 +-
+ include/media/i2c/cs5345.h                         |    2 +-
+ include/media/i2c/cs53l32a.h                       |    2 +-
+ include/media/i2c/m52790.h                         |    2 +-
+ include/media/i2c/mt9v011.h                        |    2 +-
+ include/media/i2c/mt9v022.h                        |   13 -
+ include/media/i2c/mt9v032.h                        |   12 -
+ include/media/i2c/saa7115.h                        |    2 +-
+ include/media/i2c/saa7127.h                        |    2 +-
+ include/media/i2c/ths7303.h                        |    2 +-
+ include/media/i2c/tvaudio.h                        |    2 +-
+ include/media/i2c/upd64031a.h                      |    2 +-
+ include/media/i2c/upd64083.h                       |    2 +-
+ include/media/i2c/wm8775.h                         |    2 +-
+ include/media/media-request.h                      |    2 +-
+ include/media/v4l2-common.h                        |  103 +-
+ include/media/v4l2-ctrls.h                         |    6 +-
+ include/media/v4l2-dev.h                           |    2 +-
+ include/media/v4l2-device.h                        |    2 +-
+ include/media/v4l2-dv-timings.h                    |    1 +
+ include/media/v4l2-fh.h                            |   30 +-
+ include/media/v4l2-ioctl.h                         |  238 +--
+ include/media/v4l2-mem2mem.h                       |   42 +-
+ include/media/v4l2-subdev.h                        |   57 +-
+ include/uapi/linux/aspeed-video.h                  |    7 +
+ include/uapi/linux/ivtv.h                          |    2 +-
+ include/uapi/linux/v4l2-controls.h                 |  121 +-
+ include/uapi/linux/v4l2-dv-timings.h               |    2 +-
+ include/uapi/linux/videodev2.h                     |   20 +-
+ samples/v4l/v4l2-pci-skeleton.c                    |   10 +-
+ 576 files changed, 16902 insertions(+), 9286 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/media/i2c/ovti,og0ve1b.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/i2c/ovti,ov2735.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/i2c/ovti,ov6211.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/qcom,qcm2290-camss.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/qcom,qcm2290-venus.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/qcom,qcs8300-camss.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/qcom,sa8775p-camss.yaml
+ create mode 100644 Documentation/devicetree/bindings/media/qcom,sm8750-iris.yaml
+ rename drivers/{staging/media/atomisp/i2c/atomisp-gc0310.c => media/i2c/gc0310.c} (100%)
+ create mode 100644 drivers/media/i2c/og0ve1b.c
+ create mode 100644 drivers/media/i2c/ov2735.c
+ create mode 100644 drivers/media/i2c/ov6211.c
+ delete mode 100644 drivers/media/i2c/ov6650.c
+ create mode 100644 drivers/media/platform/qcom/camss/camss-csid-340.c
+ rename drivers/media/platform/qcom/camss/{camss-csid-780.c => camss-csid-gen3.c} (88%)
+ rename drivers/media/platform/qcom/camss/{camss-csid-780.h => camss-csid-gen3.h} (84%)
+ create mode 100644 drivers/media/platform/qcom/camss/camss-vfe-340.c
+ rename drivers/media/platform/qcom/camss/{camss-vfe-780.c => camss-vfe-gen3.c} (69%)
+ create mode 100644 drivers/media/platform/qcom/iris/iris_common.c
+ create mode 100644 drivers/media/platform/qcom/iris/iris_common.h
+ create mode 100644 drivers/media/platform/qcom/iris/iris_platform_sm8750.h
+ create mode 100644 drivers/media/platform/qcom/iris/iris_venc.c
+ create mode 100644 drivers/media/platform/qcom/iris/iris_venc.h
+ delete mode 100644 drivers/media/radio/radio-wl1273.c
+ create mode 100644 include/media/cadence/cdns-csi2rx.h
+ delete mode 100644 include/media/i2c/mt9v022.h
+ delete mode 100644 include/media/i2c/mt9v032.h
+$ git am -3 ../patches/0001-fix-up-for-media-cadence-cdns-csi2rx-Support-multipl.patch
+Applying: fix up for "media: cadence: cdns-csi2rx: Support multiple pixels per clockcycle"
+$ git reset HEAD^
+Unstaged changes after reset:
+M	drivers/media/platform/cadence/cdns-csi2rx.c
+$ git add -A .
+$ git commit -v -a --amend
+warning: notes ref refs/notes/commits is invalid
+[master 94a7f9b137ce8] Merge branch 'next' of git://linuxtv.org/media-ci/media-pending.git
+ Date: Mon Sep 29 15:00:24 2025 +0100
+Merging v4l-dvb-next/master (adc218676eef2 Linux 6.12)
+$ git merge -m Merge branch 'master' of git://linuxtv.org/mchehab/media-next.git v4l-dvb-next/master
+Already up to date.
+Merging pm/linux-next (b203b72593954 Merge branch 'pm-tools' into linux-next)
+$ git merge -m Merge branch 'linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/rafael/linux-pm.git pm/linux-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/acpi/property.c
+Auto-merging drivers/acpi/scan.c
+Merge made by the 'ort' strategy.
+ Documentation/ABI/testing/sysfs-devices-power      |   8 +-
+ .../devicetree/bindings/cpufreq/cpufreq-dt.txt     |  61 ---
+ .../bindings/cpufreq/cpufreq-qcom-hw.yaml          |   2 +
+ .../cpufreq/mediatek,mt8196-cpufreq-hw.yaml        |  82 +++
+ .../bindings/thermal/nvidia,tegra124-soctherm.yaml |   2 +
+ .../devicetree/bindings/thermal/qcom-tsens.yaml    |   2 +
+ .../bindings/thermal/renesas,r9a08g045-tsu.yaml    |  93 ++++
+ .../bindings/thermal/renesas,r9a09g047-tsu.yaml    |  87 ++++
+ .../bindings/thermal/rockchip-thermal.yaml         |  15 +
+ MAINTAINERS                                        |  20 +
+ arch/arm64/boot/dts/ti/k3-am62p5.dtsi              |   2 +-
+ arch/x86/kernel/acpi/cstate.c                      |   2 +-
+ drivers/acpi/acpi_dbg.c                            |  26 +-
+ drivers/acpi/acpi_processor.c                      |   4 +-
+ drivers/acpi/acpi_tad.c                            |   3 +
+ drivers/acpi/acpica/acdebug.h                      |   2 +-
+ drivers/acpi/acpica/aclocal.h                      |   2 +-
+ drivers/acpi/acpica/acpredef.h                     |   3 +-
+ drivers/acpi/acpica/dsmethod.c                     |  21 +-
+ drivers/acpi/acpica/evglock.c                      |   4 +
+ drivers/acpi/acpica/psopinfo.c                     |   4 +-
+ drivers/acpi/acpica/tbprint.c                      |   8 +
+ drivers/acpi/apei/einj-core.c                      |  51 +-
+ drivers/acpi/apei/erst-dbg.c                       |   8 +-
+ drivers/acpi/device_sysfs.c                        |   2 +-
+ drivers/acpi/fan_core.c                            |  18 +-
+ drivers/acpi/internal.h                            |   1 +
+ drivers/acpi/pci_irq.c                             |   3 +-
+ drivers/acpi/power.c                               |  90 +++-
+ drivers/acpi/prmt.c                                |  19 +-
+ drivers/acpi/processor_driver.c                    |   6 +-
+ drivers/acpi/processor_idle.c                      | 143 +++---
+ drivers/acpi/processor_thermal.c                   |  52 +-
+ drivers/acpi/property.c                            | 156 +++---
+ drivers/acpi/resource.c                            |  10 +-
+ drivers/acpi/scan.c                                |   3 +
+ drivers/acpi/spcr.c                                |  13 +-
+ drivers/acpi/tables.c                              |   2 +-
+ drivers/acpi/thermal.c                             |   8 +-
+ drivers/acpi/video_detect.c                        |   8 +
+ drivers/base/base.h                                |   8 +
+ drivers/base/power/main.c                          |  32 +-
+ drivers/base/power/runtime.c                       |   3 +-
+ drivers/cpufreq/acpi-cpufreq.c                     |   9 +-
+ drivers/cpufreq/airoha-cpufreq.c                   |   1 +
+ drivers/cpufreq/armada-37xx-cpufreq.c              |   4 +-
+ drivers/cpufreq/brcmstb-avs-cpufreq.c              |   4 +-
+ drivers/cpufreq/cppc_cpufreq.c                     |  16 +-
+ drivers/cpufreq/cpufreq-dt-platdev.c               |   3 +
+ drivers/cpufreq/cpufreq.c                          |  44 +-
+ drivers/cpufreq/cpufreq_conservative.c             |  24 +-
+ drivers/cpufreq/cpufreq_ondemand.c                 |  25 +-
+ drivers/cpufreq/cpufreq_ondemand.h                 |  23 +
+ drivers/cpufreq/freq_table.c                       |  22 +-
+ drivers/cpufreq/intel_pstate.c                     | 192 ++++----
+ drivers/cpufreq/longhaul.c                         |   3 +
+ drivers/cpufreq/mediatek-cpufreq-hw.c              | 132 ++++-
+ drivers/cpufreq/mediatek-cpufreq.c                 |  11 +-
+ drivers/cpufreq/qcom-cpufreq-nvmem.c               |   5 +
+ drivers/cpufreq/s5pv210-cpufreq.c                  |   4 +-
+ drivers/cpufreq/scmi-cpufreq.c                     |  10 +
+ drivers/cpufreq/sh-cpufreq.c                       |   6 +-
+ drivers/cpufreq/speedstep-lib.c                    |  12 +-
+ drivers/cpufreq/speedstep-lib.h                    |  10 +-
+ drivers/cpufreq/tegra186-cpufreq.c                 |   4 +-
+ drivers/cpufreq/ti-cpufreq.c                       |  12 +-
+ drivers/cpufreq/virtual-cpufreq.c                  |   2 +-
+ drivers/cpuidle/cpuidle-qcom-spm.c                 |  11 +-
+ drivers/cpuidle/cpuidle.c                          |   8 +-
+ drivers/cpuidle/governors/menu.c                   |  76 +--
+ drivers/cpuidle/sysfs.c                            |  34 +-
+ drivers/devfreq/event/rockchip-dfi.c               |  91 +++-
+ drivers/devfreq/mtk-cci-devfreq.c                  |   5 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c            |   2 +-
+ drivers/idle/intel_idle.c                          | 256 +++++-----
+ drivers/opp/core.c                                 |  99 ++++
+ drivers/pnp/isapnp/core.c                          |   3 +-
+ drivers/powercap/idle_inject.c                     |   5 +-
+ drivers/thermal/gov_step_wise.c                    |  25 +-
+ drivers/thermal/intel/int340x_thermal/Kconfig      |   1 +
+ drivers/thermal/intel/int340x_thermal/Makefile     |   1 +
+ .../intel/int340x_thermal/acpi_thermal_rel.c       |   3 -
+ .../int340x_thermal/processor_thermal_device.c     |  20 +
+ .../int340x_thermal/processor_thermal_device.h     |   6 +
+ .../int340x_thermal/processor_thermal_device_pci.c |   3 +-
+ .../int340x_thermal/processor_thermal_soc_slider.c | 284 +++++++++++
+ drivers/thermal/k3_j72xx_bandgap.c                 |   4 +
+ drivers/thermal/mediatek/lvts_thermal.c            |   2 +-
+ drivers/thermal/qcom/Kconfig                       |   3 +-
+ drivers/thermal/qcom/lmh.c                         |   4 +-
+ drivers/thermal/renesas/Kconfig                    |  21 +-
+ drivers/thermal/renesas/Makefile                   |   3 +
+ drivers/thermal/renesas/rcar_gen3_thermal.c        |  63 ++-
+ drivers/thermal/renesas/rzg3e_thermal.c            | 547 +++++++++++++++++++++
+ drivers/thermal/renesas/rzg3s_thermal.c            | 272 ++++++++++
+ drivers/thermal/rockchip_thermal.c                 |  50 +-
+ drivers/thermal/tegra/Makefile                     |   1 +
+ drivers/thermal/tegra/soctherm-fuse.c              |  18 +-
+ drivers/thermal/tegra/soctherm.c                   |  13 +
+ drivers/thermal/tegra/soctherm.h                   |  11 +-
+ drivers/thermal/tegra/tegra114-soctherm.c          | 209 ++++++++
+ drivers/thermal/tegra/tegra124-soctherm.c          |   4 +
+ drivers/thermal/tegra/tegra132-soctherm.c          |   4 +
+ drivers/thermal/tegra/tegra210-soctherm.c          |   4 +
+ drivers/thermal/testing/zone.c                     |  31 +-
+ drivers/thermal/thermal-generic-adc.c              |  55 ++-
+ drivers/thermal/thermal_hwmon.c                    |   2 +-
+ include/acpi/acexcep.h                             |  10 +-
+ include/acpi/acpixf.h                              |   8 +-
+ include/acpi/actbl.h                               |   2 +-
+ include/acpi/actbl1.h                              |   1 +
+ include/acpi/actbl2.h                              |  21 +
+ include/acpi/processor.h                           |  34 +-
+ include/dt-bindings/thermal/tegra114-soctherm.h    |  19 +
+ include/linux/cpufreq.h                            |   7 +-
+ include/linux/pm_opp.h                             |  30 ++
+ include/linux/suspend.h                            |   6 +
+ include/soc/rockchip/rk3588_grf.h                  |   8 +-
+ include/soc/rockchip/rockchip_grf.h                |   1 +
+ kernel/power/energy_model.c                        |  11 +-
+ kernel/power/hibernate.c                           |  39 +-
+ kernel/power/process.c                             |   1 -
+ kernel/power/snapshot.c                            |   2 +-
+ kernel/power/suspend.c                             |   1 +
+ kernel/power/swap.c                                |   6 +-
+ rust/kernel/cpufreq.rs                             |   2 +-
+ rust/kernel/cpumask.rs                             |   5 +-
+ rust/kernel/opp.rs                                 |  29 +-
+ .../acpi/os_specific/service_layers/oslinuxtbl.c   |   4 +-
+ tools/power/acpi/tools/acpidump/apdump.c           |   3 +-
+ tools/power/acpi/tools/acpidump/apfiles.c          |   2 +-
+ tools/power/cpupower/lib/cpuidle.c                 |   5 +-
+ tools/power/cpupower/lib/cpupower.c                |   2 +-
+ .../x86/amd_pstate_tracer/amd_pstate_trace.py      |   2 +-
+ tools/power/x86/turbostat/turbostat.c              |   2 +-
+ tools/power/x86/x86_energy_perf_policy/Makefile    |  29 +-
+ .../x86_energy_perf_policy.8                       |  15 +-
+ .../x86_energy_perf_policy.c                       | 137 ++++--
+ .../intel/workload_hint/workload_hint_test.c       |   2 +
+ 139 files changed, 3366 insertions(+), 1001 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/cpufreq/cpufreq-dt.txt
+ create mode 100644 Documentation/devicetree/bindings/cpufreq/mediatek,mt8196-cpufreq-hw.yaml
+ create mode 100644 Documentation/devicetree/bindings/thermal/renesas,r9a08g045-tsu.yaml
+ create mode 100644 Documentation/devicetree/bindings/thermal/renesas,r9a09g047-tsu.yaml
+ create mode 100644 drivers/thermal/intel/int340x_thermal/processor_thermal_soc_slider.c
+ create mode 100644 drivers/thermal/renesas/rzg3e_thermal.c
+ create mode 100644 drivers/thermal/renesas/rzg3s_thermal.c
+ create mode 100644 drivers/thermal/tegra/tegra114-soctherm.c
+ create mode 100644 include/dt-bindings/thermal/tegra114-soctherm.h
+Merging cpufreq-arm/cpufreq/arm/linux-next (ba6018929165f cpufreq: tegra186: Initialize all cores to max frequencies)
+$ git merge -m Merge branch 'cpufreq/arm/linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/vireshk/pm.git cpufreq-arm/cpufreq/arm/linux-next
+Merge made by the 'ort' strategy.
+ drivers/cpufreq/mediatek-cpufreq.c | 14 +++++++++++---
+ drivers/cpufreq/rcpufreq_dt.rs     | 10 +++-------
+ drivers/cpufreq/tegra186-cpufreq.c | 35 +++++++++++++++++++++++++++--------
+ 3 files changed, 41 insertions(+), 18 deletions(-)
+Merging cpupower/cpupower (23199d2aa6dca tools/cpupower: Fix incorrect size in cpuidle_state_disable())
+$ git merge -m Merge branch 'cpupower' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux.git cpupower/cpupower
+Already up to date.
+Merging devfreq/devfreq-next (eddb5ba91b289 PM / devfreq: rockchip-dfi: add support for LPDDR5)
+$ git merge -m Merge branch 'devfreq-next' of https://git.kernel.org/pub/scm/linux/kernel/git/chanwoo/linux.git devfreq/devfreq-next
+Already up to date.
+Merging pmdomain/next (bbc3110823eca pmdomain: thead: Fix error pointer vs NULL bug in th1520_pd_reboot_init())
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/linux-pm.git pmdomain/next
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/clock/marvell,pxa1908.yaml |  30 +-
+ .../bindings/power/amlogic,meson-sec-pwrc.yaml     |   3 +
+ .../bindings/power/mediatek,power-controller.yaml  |  37 ++
+ .../bindings/soc/imx/fsl,imx93-media-blk-ctrl.yaml |  59 ++-
+ MAINTAINERS                                        |   3 +
+ drivers/pmdomain/Kconfig                           |   1 +
+ drivers/pmdomain/Makefile                          |   1 +
+ drivers/pmdomain/amlogic/meson-secure-pwrc.c       |  95 +++++
+ drivers/pmdomain/imx/gpc.c                         |   1 -
+ drivers/pmdomain/imx/imx93-blk-ctrl.c              |  23 +-
+ drivers/pmdomain/marvell/Kconfig                   |  18 +
+ drivers/pmdomain/marvell/Makefile                  |   3 +
+ .../pmdomain/marvell/pxa1908-power-controller.c    | 274 ++++++++++++++
+ drivers/pmdomain/mediatek/airoha-cpu-pmdomain.c    |   8 +-
+ drivers/pmdomain/mediatek/mt6795-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8167-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8173-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8183-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8186-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8188-pm-domains.h      |   6 +
+ drivers/pmdomain/mediatek/mt8192-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8195-pm-domains.h      |   5 +
+ drivers/pmdomain/mediatek/mt8365-pm-domains.h      |  14 +-
+ drivers/pmdomain/mediatek/mtk-pm-domains.c         | 399 +++++++++++++++++----
+ drivers/pmdomain/mediatek/mtk-pm-domains.h         |  74 +++-
+ drivers/pmdomain/qcom/rpmpd.c                      | 112 +++---
+ drivers/pmdomain/rockchip/Kconfig                  |   1 +
+ drivers/pmdomain/thead/th1520-pm-domains.c         |  16 +
+ drivers/pmdomain/ti/ti_sci_pm_domains.c            |  24 +-
+ drivers/power/reset/Kconfig                        |   7 +
+ drivers/power/reset/Makefile                       |   1 +
+ drivers/power/reset/th1520-aon-reboot.c            |  98 +++++
+ include/dt-bindings/power/amlogic,s6-pwrc.h        |  29 ++
+ include/dt-bindings/power/amlogic,s7-pwrc.h        |  20 ++
+ include/dt-bindings/power/amlogic,s7d-pwrc.h       |  27 ++
+ include/dt-bindings/power/marvell,pxa1908-power.h  |  17 +
+ include/dt-bindings/power/qcom,rpmhpd.h            | 233 ++++++++++++
+ include/dt-bindings/power/qcom-rpmpd.h             | 387 +++++---------------
+ 38 files changed, 1590 insertions(+), 466 deletions(-)
+ create mode 100644 drivers/pmdomain/marvell/Kconfig
+ create mode 100644 drivers/pmdomain/marvell/Makefile
+ create mode 100644 drivers/pmdomain/marvell/pxa1908-power-controller.c
+ create mode 100644 drivers/power/reset/th1520-aon-reboot.c
+ create mode 100644 include/dt-bindings/power/amlogic,s6-pwrc.h
+ create mode 100644 include/dt-bindings/power/amlogic,s7-pwrc.h
+ create mode 100644 include/dt-bindings/power/amlogic,s7d-pwrc.h
+ create mode 100644 include/dt-bindings/power/marvell,pxa1908-power.h
+Merging opp/opp/linux-next (05db35963eef7 OPP: Add support to find OPP for a set of keys)
+$ git merge -m Merge branch 'opp/linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/vireshk/pm.git opp/opp/linux-next
+Already up to date.
+Merging thermal/thermal/linux-next (dc67521c20b70 thermal/drivers/renesas/rzg3e: Fix add thermal driver for the Renesas RZ/G3E SoC)
+$ git merge -m Merge branch 'thermal/linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/thermal/linux.git thermal/thermal/linux-next
+Already up to date.
+Merging rdma/for-next (e6d736bd08902 RDMA/ionic: Fix memory leak of admin q_wr)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git rdma/for-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/infiniband/hw/bnxt_re/ib_verbs.c
+Auto-merging drivers/infiniband/hw/bnxt_re/main.c
+CONFLICT (content): Merge conflict in drivers/infiniband/hw/bnxt_re/main.c
+Auto-merging drivers/infiniband/hw/bnxt_re/qplib_fp.c
+Auto-merging drivers/infiniband/hw/bnxt_re/qplib_fp.h
+Auto-merging drivers/infiniband/hw/bnxt_re/qplib_res.c
+Auto-merging drivers/infiniband/hw/erdma/erdma_verbs.c
+Auto-merging drivers/net/ethernet/broadcom/bnxt/bnxt.c
+Resolved 'drivers/infiniband/hw/bnxt_re/main.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master bc9b73496e66d] Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git
+$ git diff -M --stat --summary HEAD^..
+ .../networking/device_drivers/ethernet/index.rst   |    1 +
+ .../device_drivers/ethernet/pensando/ionic.rst     |   10 +
+ .../ethernet/pensando/ionic_rdma.rst               |   52 +
+ MAINTAINERS                                        |    9 +
+ drivers/infiniband/Kconfig                         |    1 +
+ drivers/infiniband/core/addr.c                     |   85 +-
+ drivers/infiniband/core/agent.c                    |    3 +-
+ drivers/infiniband/core/cm.c                       |    4 +-
+ drivers/infiniband/core/cma.c                      |  136 +-
+ drivers/infiniband/core/cma_priv.h                 |    4 +-
+ drivers/infiniband/core/device.c                   |    2 +-
+ drivers/infiniband/core/sa_query.c                 |  283 ++-
+ drivers/infiniband/core/ucma.c                     |  120 +-
+ drivers/infiniband/hw/Makefile                     |    1 +
+ drivers/infiniband/hw/bnxt_re/bnxt_re.h            |   19 +-
+ drivers/infiniband/hw/bnxt_re/debugfs.c            |   37 +
+ drivers/infiniband/hw/bnxt_re/hw_counters.c        |  109 +-
+ drivers/infiniband/hw/bnxt_re/hw_counters.h        |   26 +-
+ drivers/infiniband/hw/bnxt_re/ib_verbs.c           |  156 +-
+ drivers/infiniband/hw/bnxt_re/ib_verbs.h           |   10 +
+ drivers/infiniband/hw/bnxt_re/main.c               |  378 +--
+ drivers/infiniband/hw/bnxt_re/qplib_fp.c           |   13 +-
+ drivers/infiniband/hw/bnxt_re/qplib_fp.h           |    2 +
+ drivers/infiniband/hw/bnxt_re/qplib_rcfw.c         |   10 +-
+ drivers/infiniband/hw/bnxt_re/qplib_rcfw.h         |    1 +
+ drivers/infiniband/hw/bnxt_re/qplib_res.c          |   38 +-
+ drivers/infiniband/hw/bnxt_re/qplib_res.h          |   21 +-
+ drivers/infiniband/hw/bnxt_re/qplib_sp.c           |   98 +-
+ drivers/infiniband/hw/bnxt_re/qplib_sp.h           |    6 +-
+ drivers/infiniband/hw/bnxt_re/roce_hsi.h           |   44 +-
+ drivers/infiniband/hw/cxgb4/device.c               |    5 +-
+ drivers/infiniband/hw/efa/efa_com.c                |   18 +-
+ drivers/infiniband/hw/efa/efa_verbs.c              |    6 +-
+ drivers/infiniband/hw/erdma/erdma_verbs.c          |  110 +-
+ drivers/infiniband/hw/erdma/erdma_verbs.h          |    4 +-
+ drivers/infiniband/hw/hfi1/device.c                |    4 +-
+ drivers/infiniband/hw/hfi1/sdma.c                  |    2 +-
+ drivers/infiniband/hw/hfi1/user_sdma.c             |    4 +-
+ drivers/infiniband/hw/hns/hns_roce_mr.c            |    8 +-
+ drivers/infiniband/hw/ionic/Kconfig                |   15 +
+ drivers/infiniband/hw/ionic/Makefile               |    9 +
+ drivers/infiniband/hw/ionic/ionic_admin.c          | 1229 +++++++++
+ drivers/infiniband/hw/ionic/ionic_controlpath.c    | 2679 ++++++++++++++++++++
+ drivers/infiniband/hw/ionic/ionic_datapath.c       | 1399 ++++++++++
+ drivers/infiniband/hw/ionic/ionic_fw.h             | 1029 ++++++++
+ drivers/infiniband/hw/ionic/ionic_hw_stats.c       |  484 ++++
+ drivers/infiniband/hw/ionic/ionic_ibdev.c          |  440 ++++
+ drivers/infiniband/hw/ionic/ionic_ibdev.h          |  517 ++++
+ drivers/infiniband/hw/ionic/ionic_lif_cfg.c        |  111 +
+ drivers/infiniband/hw/ionic/ionic_lif_cfg.h        |   66 +
+ drivers/infiniband/hw/ionic/ionic_pgtbl.c          |  143 ++
+ drivers/infiniband/hw/ionic/ionic_queue.c          |   52 +
+ drivers/infiniband/hw/ionic/ionic_queue.h          |  234 ++
+ drivers/infiniband/hw/ionic/ionic_res.h            |  154 ++
+ drivers/infiniband/hw/irdma/Kconfig                |    7 +-
+ drivers/infiniband/hw/irdma/Makefile               |    4 +
+ drivers/infiniband/hw/irdma/ctrl.c                 | 1440 ++++++++++-
+ drivers/infiniband/hw/irdma/defs.h                 |  264 +-
+ drivers/infiniband/hw/irdma/hmc.c                  |   18 +-
+ drivers/infiniband/hw/irdma/hmc.h                  |   19 +-
+ drivers/infiniband/hw/irdma/hw.c                   |  365 +--
+ drivers/infiniband/hw/irdma/i40iw_hw.c             |    2 +
+ drivers/infiniband/hw/irdma/i40iw_hw.h             |    2 +
+ drivers/infiniband/hw/irdma/i40iw_if.c             |    3 +
+ drivers/infiniband/hw/irdma/icrdma_hw.c            |    3 +
+ drivers/infiniband/hw/irdma/icrdma_hw.h            |    5 +-
+ drivers/infiniband/hw/irdma/icrdma_if.c            |  343 +++
+ drivers/infiniband/hw/irdma/ig3rdma_hw.c           |  170 ++
+ drivers/infiniband/hw/irdma/ig3rdma_hw.h           |   32 +
+ drivers/infiniband/hw/irdma/ig3rdma_if.c           |  232 ++
+ drivers/infiniband/hw/irdma/irdma.h                |   22 +-
+ drivers/infiniband/hw/irdma/main.c                 |  371 +--
+ drivers/infiniband/hw/irdma/main.h                 |   35 +-
+ drivers/infiniband/hw/irdma/pble.c                 |   20 +-
+ drivers/infiniband/hw/irdma/protos.h               |    1 +
+ drivers/infiniband/hw/irdma/puda.h                 |    4 +-
+ drivers/infiniband/hw/irdma/type.h                 |  221 +-
+ drivers/infiniband/hw/irdma/uda_d.h                |    5 +-
+ drivers/infiniband/hw/irdma/uk.c                   |  303 ++-
+ drivers/infiniband/hw/irdma/user.h                 |  267 +-
+ drivers/infiniband/hw/irdma/utils.c                |  112 +-
+ drivers/infiniband/hw/irdma/verbs.c                |  848 ++++++-
+ drivers/infiniband/hw/irdma/verbs.h                |   50 +-
+ drivers/infiniband/hw/irdma/virtchnl.c             |  618 +++++
+ drivers/infiniband/hw/irdma/virtchnl.h             |  176 ++
+ drivers/infiniband/hw/mana/cq.c                    |   26 +
+ drivers/infiniband/hw/mana/device.c                |    3 +
+ drivers/infiniband/hw/mana/main.c                  |    5 +-
+ drivers/infiniband/hw/mana/mana_ib.h               |   14 +-
+ drivers/infiniband/hw/mana/mr.c                    |    6 +-
+ drivers/infiniband/hw/mana/qp.c                    |    9 +
+ drivers/infiniband/hw/mlx4/mad.c                   |    8 +-
+ drivers/infiniband/hw/mlx4/qp.c                    |    3 +-
+ drivers/infiniband/hw/mlx5/data_direct.c           |    2 +-
+ drivers/infiniband/hw/mlx5/gsi.c                   |   15 +-
+ drivers/infiniband/hw/mlx5/main.c                  |  113 +-
+ drivers/infiniband/hw/mlx5/mlx5_ib.h               |    7 +
+ drivers/infiniband/hw/mlx5/mr.c                    |   11 +-
+ drivers/infiniband/hw/mlx5/umr.c                   |    6 +-
+ drivers/infiniband/sw/rdmavt/qp.c                  |   13 +-
+ drivers/infiniband/sw/rxe/rxe_task.c               |    8 +-
+ drivers/infiniband/sw/siw/siw_verbs.c              |   25 +-
+ drivers/infiniband/ulp/ipoib/ipoib_main.c          |   21 +-
+ drivers/infiniband/ulp/srpt/ib_srpt.c              |   16 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt.c          |    8 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt.h          |    3 +
+ drivers/net/ethernet/broadcom/bnxt/bnxt_ulp.c      |    6 +
+ drivers/net/ethernet/pensando/Kconfig              |    1 +
+ drivers/net/ethernet/pensando/ionic/Makefile       |    2 +-
+ drivers/net/ethernet/pensando/ionic/ionic.h        |    7 -
+ drivers/net/ethernet/pensando/ionic/ionic_api.h    |  131 +
+ drivers/net/ethernet/pensando/ionic/ionic_aux.c    |  102 +
+ drivers/net/ethernet/pensando/ionic/ionic_aux.h    |   10 +
+ .../net/ethernet/pensando/ionic/ionic_bus_pci.c    |    7 +
+ drivers/net/ethernet/pensando/ionic/ionic_dev.c    |  270 +-
+ drivers/net/ethernet/pensando/ionic/ionic_dev.h    |   28 +-
+ drivers/net/ethernet/pensando/ionic/ionic_if.h     |  118 +-
+ drivers/net/ethernet/pensando/ionic/ionic_lif.c    |   47 +-
+ drivers/net/ethernet/pensando/ionic/ionic_lif.h    |    3 +
+ drivers/net/ethernet/pensando/ionic/ionic_main.c   |    4 +-
+ include/rdma/ib_mad.h                              |    1 +
+ include/rdma/ib_sa.h                               |   37 +
+ include/rdma/rdma_cm.h                             |   21 +-
+ include/uapi/rdma/ib_user_ioctl_verbs.h            |    1 +
+ include/uapi/rdma/ib_user_sa.h                     |   14 +
+ include/uapi/rdma/ionic-abi.h                      |  115 +
+ include/uapi/rdma/irdma-abi.h                      |   16 +-
+ include/uapi/rdma/rdma_user_cm.h                   |   42 +-
+ 128 files changed, 16185 insertions(+), 1483 deletions(-)
+ create mode 100644 Documentation/networking/device_drivers/ethernet/pensando/ionic_rdma.rst
+ create mode 100644 drivers/infiniband/hw/ionic/Kconfig
+ create mode 100644 drivers/infiniband/hw/ionic/Makefile
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_admin.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_controlpath.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_datapath.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_fw.h
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_hw_stats.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_ibdev.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_ibdev.h
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_lif_cfg.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_lif_cfg.h
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_pgtbl.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_queue.c
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_queue.h
+ create mode 100644 drivers/infiniband/hw/ionic/ionic_res.h
+ create mode 100644 drivers/infiniband/hw/irdma/icrdma_if.c
+ create mode 100644 drivers/infiniband/hw/irdma/ig3rdma_hw.c
+ create mode 100644 drivers/infiniband/hw/irdma/ig3rdma_hw.h
+ create mode 100644 drivers/infiniband/hw/irdma/ig3rdma_if.c
+ create mode 100644 drivers/infiniband/hw/irdma/virtchnl.c
+ create mode 100644 drivers/infiniband/hw/irdma/virtchnl.h
+ create mode 100644 drivers/net/ethernet/pensando/ionic/ionic_api.h
+ create mode 100644 drivers/net/ethernet/pensando/ionic/ionic_aux.c
+ create mode 100644 drivers/net/ethernet/pensando/ionic/ionic_aux.h
+ create mode 100644 include/uapi/rdma/ionic-abi.h
+Merging net-next/main (e835faaed2f80 net/mlx5: Expose uar access and odp page fault counters)
+$ git merge -m Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net-next.git net-next/main
+Auto-merging .mailmap
+CONFLICT (content): Merge conflict in .mailmap
+Auto-merging Documentation/devicetree/bindings/net/cdns,macb.yaml
+Auto-merging Documentation/networking/device_drivers/ethernet/index.rst
+CONFLICT (content): Merge conflict in Documentation/networking/device_drivers/ethernet/index.rst
+Auto-merging MAINTAINERS
+Auto-merging arch/riscv/boot/dts/spacemit/k1-bananapi-f3.dts
+CONFLICT (content): Merge conflict in arch/riscv/boot/dts/spacemit/k1-bananapi-f3.dts
+Auto-merging arch/riscv/boot/dts/spacemit/k1-milkv-jupiter.dts
+CONFLICT (content): Merge conflict in arch/riscv/boot/dts/spacemit/k1-milkv-jupiter.dts
+Auto-merging arch/riscv/boot/dts/spacemit/k1.dtsi
+Auto-merging arch/s390/configs/debug_defconfig
+CONFLICT (content): Merge conflict in arch/s390/configs/debug_defconfig
+Auto-merging arch/s390/configs/defconfig
+CONFLICT (content): Merge conflict in arch/s390/configs/defconfig
+Auto-merging drivers/net/ethernet/broadcom/bnxt/bnxt.c
+CONFLICT (content): Merge conflict in drivers/net/ethernet/broadcom/bnxt/bnxt.c
+Auto-merging drivers/net/ethernet/broadcom/bnxt/bnxt.h
+Auto-merging drivers/net/ethernet/cadence/macb.h
+Auto-merging drivers/net/ethernet/cadence/macb_main.c
+Auto-merging drivers/net/ethernet/freescale/enetc/enetc4_pf.c
+Auto-merging drivers/net/ethernet/sfc/falcon/efx.c
+Auto-merging drivers/ptp/ptp_private.h
+Auto-merging include/linux/memcontrol.h
+Auto-merging io_uring/zcrx.c
+Auto-merging mm/memcontrol.c
+Auto-merging net/core/net-sysfs.c
+Auto-merging net/ipv4/inet_timewait_sock.c
+Auto-merging net/ipv4/tcp_metrics.c
+Auto-merging tools/testing/selftests/Makefile
+Auto-merging tools/testing/selftests/wireguard/qemu/kernel.config
+Resolved '.mailmap' using previous resolution.
+Resolved 'Documentation/networking/device_drivers/ethernet/index.rst' using previous resolution.
+Resolved 'arch/riscv/boot/dts/spacemit/k1-bananapi-f3.dts' using previous resolution.
+Resolved 'arch/riscv/boot/dts/spacemit/k1-milkv-jupiter.dts' using previous resolution.
+Resolved 'arch/s390/configs/debug_defconfig' using previous resolution.
+Resolved 'arch/s390/configs/defconfig' using previous resolution.
+Resolved 'drivers/net/ethernet/broadcom/bnxt/bnxt.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master b4455ac063ece] Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net-next.git
+$ git diff -M --stat --summary HEAD^..
+ .mailmap                                           |    3 +
+ .../ABI/testing/sysfs-driver-framer-pef2256        |    8 +
+ Documentation/admin-guide/sysctl/net.rst           |    4 +
+ .../devicetree/bindings/net/airoha,en7581-npu.yaml |   22 +-
+ .../bindings/net/allwinner,sun4i-a10-emac.yaml     |    9 +
+ .../bindings/net/altr,socfpga-stmmac.yaml          |    7 +
+ .../devicetree/bindings/net/apm,xgene-enet.yaml    |  115 +
+ .../bindings/net/apm,xgene-mdio-rgmii.yaml         |   54 +
+ .../devicetree/bindings/net/apm-xgene-enet.txt     |   91 -
+ .../devicetree/bindings/net/apm-xgene-mdio.txt     |   37 -
+ .../bindings/net/brcm,bcm7445-switch-v4.0.txt      |   50 -
+ .../devicetree/bindings/net/cdns,macb.yaml         |    1 +
+ .../devicetree/bindings/net/dsa/microchip,ksz.yaml |   87 +-
+ .../devicetree/bindings/net/dsa/nxp,sja1105.yaml   |    9 +
+ .../bindings/net/ethernet-controller.yaml          |    7 +-
+ .../devicetree/bindings/net/fsl,fman-dtsec.yaml    |    4 -
+ .../devicetree/bindings/net/litex,liteeth.yaml     |   12 +-
+ .../bindings/net/microchip,sparx5-switch.yaml      |   23 +-
+ .../devicetree/bindings/net/nfc/ti,trf7970a.yaml   |    4 +-
+ .../bindings/net/pcs/renesas,rzn1-miic.yaml        |  177 +-
+ .../bindings/net/pse-pd/skyworks,si3474.yaml       |  144 ++
+ .../devicetree/bindings/net/qcom,ipq9574-ppe.yaml  |  533 +++++
+ .../devicetree/bindings/net/realtek,rtl82xx.yaml   |    6 +-
+ .../devicetree/bindings/net/renesas,rzn1-gmac.yaml |    9 +
+ .../bindings/net/renesas,rzv2h-gbeth.yaml          |  178 +-
+ .../devicetree/bindings/net/snps,dwmac.yaml        |    9 +-
+ .../devicetree/bindings/net/spacemit,k1-emac.yaml  |   81 +
+ .../devicetree/bindings/net/ti,icss-iep.yaml       |   10 +-
+ .../devicetree/bindings/net/ti,icssm-prueth.yaml   |  233 ++
+ .../devicetree/bindings/net/ti,pruss-ecap.yaml     |   32 +
+ .../devicetree/bindings/ptp/nxp,ptp-netc.yaml      |   63 +
+ .../devicetree/bindings/soc/ti/ti,pruss.yaml       |    9 +
+ Documentation/netlink/genetlink-legacy.yaml        |    2 +-
+ Documentation/netlink/specs/conntrack.yaml         |    2 +-
+ Documentation/netlink/specs/devlink.yaml           |    7 +
+ Documentation/netlink/specs/ethtool.yaml           |   32 +
+ Documentation/netlink/specs/fou.yaml               |    4 +-
+ Documentation/netlink/specs/mptcp_pm.yaml          |    5 +-
+ Documentation/netlink/specs/netdev.yaml            |   22 +-
+ Documentation/netlink/specs/nftables.yaml          |    2 +-
+ Documentation/netlink/specs/nl80211.yaml           |    2 +-
+ Documentation/netlink/specs/ovs_datapath.yaml      |    2 +-
+ Documentation/netlink/specs/ovs_flow.yaml          |    2 +-
+ Documentation/netlink/specs/ovs_vport.yaml         |    2 +-
+ Documentation/netlink/specs/psp.yaml               |  187 ++
+ Documentation/netlink/specs/rt-addr.yaml           |    2 +-
+ Documentation/netlink/specs/rt-link.yaml           |    8 +-
+ Documentation/netlink/specs/rt-neigh.yaml          |    2 +-
+ Documentation/netlink/specs/rt-route.yaml          |    2 +-
+ Documentation/netlink/specs/rt-rule.yaml           |    2 +-
+ Documentation/netlink/specs/tc.yaml                |    2 +-
+ Documentation/netlink/specs/team.yaml              |    6 +-
+ Documentation/networking/bonding.rst               |  100 +-
+ .../networking/device_drivers/ethernet/index.rst   |    1 +
+ .../ethernet/mellanox/mlx5/counters.rst            |    7 +-
+ .../device_drivers/ethernet/meta/fbnic.rst         |   30 +
+ .../device_drivers/ethernet/qualcomm/ppe/ppe.rst   |  194 ++
+ .../networking/devlink/devlink-health.rst          |    2 +-
+ .../networking/devlink/devlink-params.rst          |    8 +
+ Documentation/networking/devlink/index.rst         |   20 +-
+ Documentation/networking/devlink/mlx5.rst          |  113 +-
+ Documentation/networking/devlink/zl3073x.rst       |   14 +
+ Documentation/networking/dns_resolver.rst          |   52 +-
+ Documentation/networking/ethtool-netlink.rst       |    5 +
+ Documentation/networking/index.rst                 |    1 +
+ Documentation/networking/ip-sysctl.rst             |   71 +-
+ Documentation/networking/mptcp-sysctl.rst          |    8 +-
+ Documentation/networking/mptcp.rst                 |    2 +-
+ .../networking/net_cachelines/tcp_sock.rst         |   18 +-
+ Documentation/networking/psp.rst                   |  183 ++
+ Documentation/networking/rxrpc.rst                 |    9 +-
+ Documentation/networking/segmentation-offloads.rst |   22 +-
+ Documentation/process/maintainer-netdev.rst        |    2 +-
+ MAINTAINERS                                        |   50 +-
+ arch/m68k/coldfire/m5272.c                         |    4 +-
+ arch/mips/bcm47xx/setup.c                          |    4 +-
+ arch/riscv/boot/dts/spacemit/k1-bananapi-f3.dts    |   48 +
+ arch/riscv/boot/dts/spacemit/k1-milkv-jupiter.dts  |   48 +
+ arch/riscv/boot/dts/spacemit/k1-pinctrl.dtsi       |   48 +
+ arch/riscv/boot/dts/spacemit/k1.dtsi               |   22 +
+ arch/s390/configs/debug_defconfig                  |    4 +-
+ arch/s390/configs/defconfig                        |    4 +-
+ drivers/Makefile                                   |    1 +
+ drivers/dibs/Kconfig                               |   23 +
+ drivers/dibs/Makefile                              |    8 +
+ drivers/dibs/dibs_loopback.c                       |  361 ++++
+ drivers/dibs/dibs_loopback.h                       |   57 +
+ drivers/dibs/dibs_main.c                           |  278 +++
+ drivers/dpll/zl3073x/Makefile                      |    2 +-
+ drivers/dpll/zl3073x/core.c                        |  414 +++-
+ drivers/dpll/zl3073x/core.h                        |   33 +
+ drivers/dpll/zl3073x/devlink.c                     |  155 +-
+ drivers/dpll/zl3073x/devlink.h                     |    3 +
+ drivers/dpll/zl3073x/flash.c                       |  666 ++++++
+ drivers/dpll/zl3073x/flash.h                       |   29 +
+ drivers/dpll/zl3073x/fw.c                          |  419 ++++
+ drivers/dpll/zl3073x/fw.h                          |   52 +
+ drivers/dpll/zl3073x/regs.h                        |   51 +
+ drivers/infiniband/hw/mlx5/cq.c                    |    4 +-
+ drivers/infiniband/hw/mlx5/std_types.c             |   27 +-
+ drivers/net/Space.c                                |    3 +-
+ drivers/net/amt.c                                  |    6 +-
+ drivers/net/bonding/bond_3ad.c                     |   31 +
+ drivers/net/bonding/bond_main.c                    |  113 +-
+ drivers/net/bonding/bond_netlink.c                 |   30 +-
+ drivers/net/bonding/bond_options.c                 |   54 +-
+ drivers/net/bonding/bond_sysfs.c                   |    6 +-
+ drivers/net/can/dev/calc_bittiming.c               |   10 +-
+ drivers/net/can/dev/dev.c                          |   80 +-
+ drivers/net/can/dev/netlink.c                      |  628 +++---
+ drivers/net/can/m_can/m_can.c                      |    6 +-
+ drivers/net/can/peak_canfd/peak_canfd.c            |    4 +-
+ drivers/net/can/peak_canfd/peak_canfd_user.h       |    4 +-
+ drivers/net/can/peak_canfd/peak_pciefd_main.c      |    6 +-
+ drivers/net/can/rcar/rcar_can.c                    |  290 +--
+ drivers/net/can/rcar/rcar_canfd.c                  |   84 +-
+ drivers/net/can/sja1000/peak_pci.c                 |    6 +-
+ drivers/net/can/sja1000/peak_pcmcia.c              |    8 +-
+ drivers/net/can/spi/hi311x.c                       |    3 +-
+ drivers/net/can/spi/mcp251x.c                      |    3 +-
+ drivers/net/can/usb/esd_usb.c                      |   64 +-
+ drivers/net/can/usb/peak_usb/pcan_usb.c            |    6 +-
+ drivers/net/can/usb/peak_usb/pcan_usb_core.c       |    6 +-
+ drivers/net/can/usb/peak_usb/pcan_usb_core.h       |    4 +-
+ drivers/net/can/usb/peak_usb/pcan_usb_fd.c         |    3 +-
+ drivers/net/can/usb/peak_usb/pcan_usb_pro.c        |    4 +-
+ drivers/net/can/usb/peak_usb/pcan_usb_pro.h        |    4 +-
+ drivers/net/can/vcan.c                             |    2 +-
+ drivers/net/can/vxcan.c                            |    2 +-
+ drivers/net/dsa/Kconfig                            |   16 +-
+ drivers/net/dsa/Makefile                           |    6 +-
+ drivers/net/dsa/b53/b53_mmap.c                     |   35 +-
+ drivers/net/dsa/dsa_loop.c                         |   77 +-
+ drivers/net/dsa/dsa_loop.h                         |   20 -
+ drivers/net/dsa/dsa_loop_bdinfo.c                  |   36 -
+ drivers/net/{phy/spi_ks8995.c => dsa/ks8995.c}     |  453 +++-
+ drivers/net/dsa/lantiq/Kconfig                     |    7 +
+ drivers/net/dsa/lantiq/Makefile                    |    1 +
+ drivers/net/dsa/{ => lantiq}/lantiq_gswip.c        |  469 ++---
+ drivers/net/dsa/lantiq/lantiq_gswip.h              |  276 +++
+ drivers/net/dsa/{ => lantiq}/lantiq_pce.h          |    9 +-
+ drivers/net/dsa/microchip/ksz_common.c             |   45 +
+ drivers/net/dsa/mv88e6xxx/chip.c                   |   17 +-
+ drivers/net/dsa/mv88e6xxx/chip.h                   |    2 -
+ drivers/net/dsa/mv88e6xxx/hwtstamp.c               |    2 +-
+ drivers/net/dsa/mv88e6xxx/hwtstamp.h               |    1 +
+ drivers/net/dsa/mv88e6xxx/ptp.c                    |   70 +-
+ drivers/net/dsa/mv88e6xxx/ptp.h                    |  133 +-
+ drivers/net/dsa/ocelot/felix.c                     |    4 +
+ drivers/net/dsa/ocelot/felix.h                     |    3 +-
+ drivers/net/dsa/ocelot/felix_vsc9959.c             |    3 +-
+ drivers/net/dsa/realtek/realtek.h                  |    3 -
+ drivers/net/ethernet/Kconfig                       |    1 +
+ drivers/net/ethernet/Makefile                      |    1 +
+ drivers/net/ethernet/airoha/airoha_eth.c           |    7 +-
+ drivers/net/ethernet/airoha/airoha_eth.h           |   27 +-
+ drivers/net/ethernet/airoha/airoha_npu.c           |  198 +-
+ drivers/net/ethernet/airoha/airoha_npu.h           |   36 -
+ drivers/net/ethernet/airoha/airoha_ppe.c           |  226 +-
+ drivers/net/ethernet/airoha/airoha_regs.h          |    4 +-
+ drivers/net/ethernet/amd/pds_core/main.c           |    2 +-
+ drivers/net/ethernet/amd/xgbe/Makefile             |    2 +-
+ drivers/net/ethernet/amd/xgbe/xgbe-common.h        |   22 +-
+ drivers/net/ethernet/amd/xgbe/xgbe-drv.c           |   15 +
+ drivers/net/ethernet/amd/xgbe/xgbe-ethtool.c       |   30 +-
+ drivers/net/ethernet/amd/xgbe/xgbe-i2c.c           |    2 +-
+ drivers/net/ethernet/amd/xgbe/xgbe-phy-v2.c        |    2 +-
+ drivers/net/ethernet/amd/xgbe/xgbe-pps.c           |   74 +
+ drivers/net/ethernet/amd/xgbe/xgbe-ptp.c           |   26 +-
+ drivers/net/ethernet/amd/xgbe/xgbe.h               |   17 +
+ drivers/net/ethernet/broadcom/Kconfig              |    1 +
+ drivers/net/ethernet/broadcom/bnge/bnge.h          |   27 +
+ drivers/net/ethernet/broadcom/bnge/bnge_core.c     |   16 +
+ drivers/net/ethernet/broadcom/bnge/bnge_db.h       |   34 +
+ drivers/net/ethernet/broadcom/bnge/bnge_hwrm_lib.c |  482 +++++
+ drivers/net/ethernet/broadcom/bnge/bnge_hwrm_lib.h |   31 +
+ drivers/net/ethernet/broadcom/bnge/bnge_netdev.c   | 2217 ++++++++++++++++++++
+ drivers/net/ethernet/broadcom/bnge/bnge_netdev.h   |  250 ++-
+ drivers/net/ethernet/broadcom/bnge/bnge_resc.c     |    6 +-
+ drivers/net/ethernet/broadcom/bnge/bnge_resc.h     |    2 +
+ drivers/net/ethernet/broadcom/bnge/bnge_rmem.c     |   67 +-
+ drivers/net/ethernet/broadcom/bnge/bnge_rmem.h     |   14 +
+ drivers/net/ethernet/broadcom/bnxt/bnxt.c          |   77 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt.h          |   12 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_coredump.c |    4 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_coredump.h |    2 +
+ drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c  |   15 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_ethtool.c  |  152 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_ptp.c      |   35 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_ptp.h      |    7 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_sriov.c    |   21 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_sriov.h    |    2 +-
+ drivers/net/ethernet/broadcom/bnxt/bnxt_xdp.c      |    7 +-
+ drivers/net/ethernet/broadcom/tg3.c                |   66 +-
+ drivers/net/ethernet/cadence/macb.h                |   67 +
+ drivers/net/ethernet/cadence/macb_main.c           |  301 ++-
+ drivers/net/ethernet/cavium/liquidio/lio_core.c    |    2 +-
+ drivers/net/ethernet/cavium/liquidio/lio_main.c    |    8 +-
+ drivers/net/ethernet/cavium/liquidio/lio_vf_main.c |    3 +-
+ .../net/ethernet/cavium/liquidio/request_manager.c |    2 +-
+ .../ethernet/cavium/liquidio/response_manager.c    |    3 +-
+ .../chelsio/inline_crypto/chtls/chtls_cm.c         |   20 +-
+ .../chelsio/inline_crypto/chtls/chtls_cm.h         |    7 +-
+ .../chelsio/inline_crypto/chtls/chtls_io.c         |    2 +-
+ drivers/net/ethernet/freescale/dpaa2/dpaa2-eth.c   |    2 +-
+ drivers/net/ethernet/freescale/enetc/Kconfig       |    3 +
+ drivers/net/ethernet/freescale/enetc/enetc.c       |  209 +-
+ drivers/net/ethernet/freescale/enetc/enetc.h       |   24 +-
+ drivers/net/ethernet/freescale/enetc/enetc4_hw.h   |    6 +
+ drivers/net/ethernet/freescale/enetc/enetc4_pf.c   |    6 +-
+ .../net/ethernet/freescale/enetc/enetc_ethtool.c   |   90 +-
+ drivers/net/ethernet/freescale/enetc/enetc_hw.h    |    1 +
+ drivers/net/ethernet/freescale/enetc/enetc_ptp.c   |    5 -
+ drivers/net/ethernet/freescale/fec.h               |   11 +-
+ drivers/net/ethernet/freescale/fec_main.c          |   68 +-
+ drivers/net/ethernet/freescale/fman/mac.c          |    2 -
+ .../net/ethernet/fungible/funeth/funeth_ethtool.c  |    3 +-
+ .../net/ethernet/google/gve/gve_buffer_mgmt_dqo.c  |    5 +
+ drivers/net/ethernet/google/gve/gve_rx_dqo.c       |   35 +-
+ drivers/net/ethernet/hisilicon/hibmcge/hbg_main.c  |    2 +-
+ drivers/net/ethernet/hisilicon/hibmcge/hbg_mdio.c  |    3 +-
+ drivers/net/ethernet/hisilicon/hns3/hns3_debugfs.c |    2 +-
+ drivers/net/ethernet/hisilicon/hns3/hns3_ethtool.c |   36 +-
+ .../ethernet/hisilicon/hns3/hns3pf/hclge_main.c    |    7 +-
+ drivers/net/ethernet/huawei/hinic/hinic_devlink.c  |   10 +-
+ drivers/net/ethernet/huawei/hinic3/Makefile        |    6 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_cmdq.c   |  915 ++++++++
+ drivers/net/ethernet/huawei/hinic3/hinic3_cmdq.h   |  156 ++
+ drivers/net/ethernet/huawei/hinic3/hinic3_common.c |   23 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_common.h |   27 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_csr.h    |   79 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_eqs.c    |  776 +++++++
+ drivers/net/ethernet/huawei/hinic3/hinic3_eqs.h    |  122 ++
+ drivers/net/ethernet/huawei/hinic3/hinic3_hw_cfg.c |  211 ++
+ drivers/net/ethernet/huawei/hinic3/hinic3_hw_cfg.h |    4 +
+ .../net/ethernet/huawei/hinic3/hinic3_hw_comm.c    |  394 ++++
+ .../net/ethernet/huawei/hinic3/hinic3_hw_comm.h    |   34 +
+ .../net/ethernet/huawei/hinic3/hinic3_hw_intf.h    |  151 ++
+ drivers/net/ethernet/huawei/hinic3/hinic3_hwdev.c  |  541 ++++-
+ drivers/net/ethernet/huawei/hinic3/hinic3_hwif.c   |  417 +++-
+ drivers/net/ethernet/huawei/hinic3/hinic3_hwif.h   |   32 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_irq.c    |  138 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_lld.c    |    9 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_main.c   |   69 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_mbox.c   |  848 +++++++-
+ drivers/net/ethernet/huawei/hinic3/hinic3_mbox.h   |  126 ++
+ drivers/net/ethernet/huawei/hinic3/hinic3_mgmt.c   |   21 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_mgmt.h   |    2 +
+ .../ethernet/huawei/hinic3/hinic3_mgmt_interface.h |  119 ++
+ .../net/ethernet/huawei/hinic3/hinic3_netdev_ops.c |  426 +++-
+ .../net/ethernet/huawei/hinic3/hinic3_nic_cfg.c    |  152 ++
+ .../net/ethernet/huawei/hinic3/hinic3_nic_cfg.h    |   20 +
+ .../net/ethernet/huawei/hinic3/hinic3_nic_dev.h    |   19 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_nic_io.c |  870 +++++++-
+ drivers/net/ethernet/huawei/hinic3/hinic3_nic_io.h |   39 +-
+ .../net/ethernet/huawei/hinic3/hinic3_pci_id_tbl.h |    9 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_rss.c    |  336 +++
+ drivers/net/ethernet/huawei/hinic3/hinic3_rss.h    |   14 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_rx.c     |  226 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_rx.h     |   38 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_tx.c     |  190 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_tx.h     |   30 +-
+ drivers/net/ethernet/huawei/hinic3/hinic3_wq.c     |  109 +
+ drivers/net/ethernet/huawei/hinic3/hinic3_wq.h     |   19 +-
+ drivers/net/ethernet/ibm/ibmvnic.c                 |   59 +-
+ drivers/net/ethernet/ibm/ibmvnic.h                 |    6 +-
+ drivers/net/ethernet/intel/Kconfig                 |    2 +
+ drivers/net/ethernet/intel/Makefile                |    2 +-
+ drivers/net/ethernet/intel/e1000/e1000.h           |    2 +-
+ drivers/net/ethernet/intel/e1000/e1000_ethtool.c   |    2 +-
+ drivers/net/ethernet/intel/e1000/e1000_hw.c        |    4 +-
+ drivers/net/ethernet/intel/e1000/e1000_main.c      |    3 +-
+ drivers/net/ethernet/intel/e1000e/e1000.h          |    2 +-
+ drivers/net/ethernet/intel/e1000e/ethtool.c        |    2 +-
+ drivers/net/ethernet/intel/e1000e/netdev.c         |    4 +-
+ drivers/net/ethernet/intel/e1000e/nvm.c            |    4 +-
+ drivers/net/ethernet/intel/fm10k/fm10k_common.c    |    5 +-
+ drivers/net/ethernet/intel/fm10k/fm10k_common.h    |    2 +-
+ drivers/net/ethernet/intel/fm10k/fm10k_ethtool.c   |    2 +-
+ drivers/net/ethernet/intel/fm10k/fm10k_main.c      |    2 +-
+ drivers/net/ethernet/intel/fm10k/fm10k_pf.c        |    2 +-
+ drivers/net/ethernet/intel/fm10k/fm10k_vf.c        |    2 +-
+ drivers/net/ethernet/intel/i40e/i40e_main.c        |    2 +-
+ drivers/net/ethernet/intel/i40e/i40e_txrx.c        |   15 +-
+ drivers/net/ethernet/intel/iavf/iavf_main.c        |    2 +-
+ drivers/net/ethernet/intel/ice/Makefile            |    9 +-
+ drivers/net/ethernet/intel/ice/devlink/health.c    |    3 +-
+ drivers/net/ethernet/intel/ice/ice.h               |   40 +-
+ drivers/net/ethernet/intel/ice/ice_adminq_cmd.h    |  117 +-
+ drivers/net/ethernet/intel/ice/ice_base.c          |  390 +++-
+ drivers/net/ethernet/intel/ice/ice_base.h          |    3 +
+ drivers/net/ethernet/intel/ice/ice_common.c        |  143 +-
+ drivers/net/ethernet/intel/ice/ice_common.h        |    8 +-
+ drivers/net/ethernet/intel/ice/ice_debugfs.c       |  633 +-----
+ drivers/net/ethernet/intel/ice/ice_ethtool.c       |   18 +-
+ drivers/net/ethernet/intel/ice/ice_fwlog.c         |  474 -----
+ drivers/net/ethernet/intel/ice/ice_fwlog.h         |   79 -
+ drivers/net/ethernet/intel/ice/ice_hw_autogen.h    |    3 +
+ drivers/net/ethernet/intel/ice/ice_lag.c           | 1006 ++++++---
+ drivers/net/ethernet/intel/ice/ice_lag.h           |   22 +-
+ drivers/net/ethernet/intel/ice/ice_lan_tx_rx.h     |   41 +
+ drivers/net/ethernet/intel/ice/ice_lib.c           |    1 +
+ drivers/net/ethernet/intel/ice/ice_main.c          |  154 +-
+ drivers/net/ethernet/intel/ice/ice_sriov.c         |    2 +-
+ drivers/net/ethernet/intel/ice/ice_sriov.h         |    4 +-
+ drivers/net/ethernet/intel/ice/ice_trace.h         |   10 +-
+ drivers/net/ethernet/intel/ice/ice_txrx.c          |  188 +-
+ drivers/net/ethernet/intel/ice/ice_txrx.h          |   15 +
+ drivers/net/ethernet/intel/ice/ice_txrx_lib.h      |   14 +
+ drivers/net/ethernet/intel/ice/ice_type.h          |   12 +-
+ drivers/net/ethernet/intel/ice/ice_vf_lib.c        |    2 +-
+ drivers/net/ethernet/intel/ice/ice_vf_lib.h        |    2 +-
+ drivers/net/ethernet/intel/ice/ice_xsk.c           |  153 +-
+ drivers/net/ethernet/intel/ice/ice_xsk.h           |   22 +
+ .../{ice_virtchnl_allowlist.c => virt/allowlist.c} |    2 +-
+ .../{ice_virtchnl_allowlist.h => virt/allowlist.h} |    0
+ .../intel/ice/{ice_virtchnl_fdir.c => virt/fdir.c} |    0
+ .../intel/ice/{ice_virtchnl_fdir.h => virt/fdir.h} |    0
+ drivers/net/ethernet/intel/ice/virt/queues.c       |  973 +++++++++
+ drivers/net/ethernet/intel/ice/virt/queues.h       |   20 +
+ drivers/net/ethernet/intel/ice/virt/rss.c          |  719 +++++++
+ drivers/net/ethernet/intel/ice/virt/rss.h          |   18 +
+ .../intel/ice/{ice_virtchnl.c => virt/virtchnl.c}  | 1683 +--------------
+ .../intel/ice/{ice_virtchnl.h => virt/virtchnl.h}  |    0
+ drivers/net/ethernet/intel/idpf/Kconfig            |    2 +-
+ drivers/net/ethernet/intel/idpf/Makefile           |    3 +
+ drivers/net/ethernet/intel/idpf/idpf.h             |   57 +-
+ drivers/net/ethernet/intel/idpf/idpf_dev.c         |   11 +-
+ drivers/net/ethernet/intel/idpf/idpf_ethtool.c     |   64 +-
+ drivers/net/ethernet/intel/idpf/idpf_lan_txrx.h    |    6 +-
+ drivers/net/ethernet/intel/idpf/idpf_lib.c         |  185 +-
+ drivers/net/ethernet/intel/idpf/idpf_main.c        |    1 +
+ drivers/net/ethernet/intel/idpf/idpf_ptp.c         |   11 +-
+ .../net/ethernet/intel/idpf/idpf_singleq_txrx.c    |  110 +-
+ drivers/net/ethernet/intel/idpf/idpf_txrx.c        |  996 ++++++---
+ drivers/net/ethernet/intel/idpf/idpf_txrx.h        |  210 +-
+ drivers/net/ethernet/intel/idpf/idpf_vf_dev.c      |   11 +-
+ drivers/net/ethernet/intel/idpf/idpf_virtchnl.c    | 1311 +++++++-----
+ drivers/net/ethernet/intel/idpf/idpf_virtchnl.h    |   33 +-
+ .../net/ethernet/intel/idpf/idpf_virtchnl_ptp.c    |    4 +
+ drivers/net/ethernet/intel/idpf/xdp.c              |  486 +++++
+ drivers/net/ethernet/intel/idpf/xdp.h              |  175 ++
+ drivers/net/ethernet/intel/idpf/xsk.c              |  633 ++++++
+ drivers/net/ethernet/intel/idpf/xsk.h              |   33 +
+ drivers/net/ethernet/intel/igb/e1000_82575.c       |    4 +-
+ drivers/net/ethernet/intel/igb/e1000_i210.c        |    2 +-
+ drivers/net/ethernet/intel/igb/e1000_nvm.c         |    4 +-
+ drivers/net/ethernet/intel/igb/igb.h               |    2 +-
+ drivers/net/ethernet/intel/igb/igb_ethtool.c       |    8 +-
+ drivers/net/ethernet/intel/igb/igb_main.c          |    3 +-
+ drivers/net/ethernet/intel/igbvf/ethtool.c         |    5 +-
+ drivers/net/ethernet/intel/igc/igc_ethtool.c       |    8 +-
+ drivers/net/ethernet/intel/igc/igc_i225.c          |    2 +-
+ drivers/net/ethernet/intel/igc/igc_nvm.c           |    4 +-
+ drivers/net/ethernet/intel/ixgbe/ixgbe_common.c    |    4 +-
+ drivers/net/ethernet/intel/ixgbe/ixgbe_e610.c      |  128 +-
+ drivers/net/ethernet/intel/ixgbe/ixgbe_e610.h      |    2 +
+ drivers/net/ethernet/intel/ixgbe/ixgbe_ethtool.c   |    2 +-
+ drivers/net/ethernet/intel/ixgbe/ixgbe_main.c      |   10 +
+ drivers/net/ethernet/intel/ixgbe/ixgbe_type.h      |    2 +
+ drivers/net/ethernet/intel/ixgbe/ixgbe_x540.c      |    4 +-
+ drivers/net/ethernet/intel/ixgbe/ixgbe_x550.c      |    4 +-
+ drivers/net/ethernet/intel/ixgbevf/ethtool.c       |    6 +-
+ drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c  |    2 +-
+ drivers/net/ethernet/intel/libie/Kconfig           |    9 +
+ drivers/net/ethernet/intel/libie/Makefile          |    4 +
+ drivers/net/ethernet/intel/libie/fwlog.c           | 1115 ++++++++++
+ drivers/net/ethernet/marvell/mvneta.c              |   15 +-
+ drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c    |   19 +-
+ .../net/ethernet/marvell/octeon_ep/octep_ethtool.c |   10 +
+ .../marvell/octeon_ep_vf/octep_vf_ethtool.c        |   10 +
+ drivers/net/ethernet/marvell/octeontx2/af/cgx.c    |    2 +-
+ drivers/net/ethernet/marvell/octeontx2/af/cgx.h    |    4 -
+ .../net/ethernet/marvell/octeontx2/af/mcs_rvu_if.c |    2 +-
+ drivers/net/ethernet/marvell/octeontx2/af/rvu.c    |    3 +
+ drivers/net/ethernet/marvell/octeontx2/af/rvu.h    |    1 +
+ .../net/ethernet/marvell/octeontx2/af/rvu_cgx.c    |    2 +-
+ .../ethernet/marvell/octeontx2/af/rvu_devlink.c    |   32 +-
+ .../net/ethernet/marvell/octeontx2/af/rvu_nix.c    |   16 +
+ .../net/ethernet/marvell/octeontx2/af/rvu_rep.c    |    2 +-
+ .../ethernet/marvell/octeontx2/nic/cn10k_ipsec.c   |    3 +-
+ .../ethernet/marvell/octeontx2/nic/otx2_ethtool.c  |    3 +-
+ .../net/ethernet/marvell/prestera/prestera_main.c  |    2 +-
+ .../net/ethernet/marvell/prestera/prestera_pci.c   |    2 +-
+ drivers/net/ethernet/mediatek/mtk_wed.c            |   33 +-
+ drivers/net/ethernet/mediatek/mtk_wed.h            |    2 +-
+ drivers/net/ethernet/mellanox/mlx5/core/Kconfig    |   12 +-
+ drivers/net/ethernet/mellanox/mlx5/core/Makefile   |   10 +-
+ drivers/net/ethernet/mellanox/mlx5/core/cq.c       |    1 -
+ drivers/net/ethernet/mellanox/mlx5/core/devlink.c  |  145 +-
+ drivers/net/ethernet/mellanox/mlx5/core/devlink.h  |    5 +
+ .../mellanox/mlx5/core/diag/reporter_vnic.c        |   17 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en.h       |   10 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en/fs.h    |    7 +-
+ .../ethernet/mellanox/mlx5/core/en/hv_vhca_stats.c |    4 +-
+ .../net/ethernet/mellanox/mlx5/core/en/params.c    |   10 +-
+ .../net/ethernet/mellanox/mlx5/core/en/params.h    |    2 +-
+ .../mellanox/mlx5/core/en/pcie_cong_event.c        |   79 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en/ptp.c   |    6 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en/ptp.h   |    1 +
+ .../ethernet/mellanox/mlx5/core/en/rep/bridge.c    |    7 +-
+ .../ethernet/mellanox/mlx5/core/en/reporter_rx.c   |   16 +-
+ .../ethernet/mellanox/mlx5/core/en/reporter_tx.c   |   16 +-
+ .../ethernet/mellanox/mlx5/core/en/tc/ct_fs_hmfs.c |    4 +-
+ .../ethernet/mellanox/mlx5/core/en/tc/ct_fs_smfs.c |    4 +-
+ .../ethernet/mellanox/mlx5/core/en/tc/int_port.c   |    8 +-
+ .../net/ethernet/mellanox/mlx5/core/en/tc_tun.c    |    7 +-
+ .../ethernet/mellanox/mlx5/core/en/tc_tun_encap.c  |    8 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en/trap.c  |    1 +
+ drivers/net/ethernet/mellanox/mlx5/core/en/txrx.h  |    5 +-
+ .../net/ethernet/mellanox/mlx5/core/en/xsk/setup.c |    2 +-
+ .../mellanox/mlx5/core/en_accel/en_accel.h         |   50 +-
+ .../ethernet/mellanox/mlx5/core/en_accel/fs_tcp.c  |    2 +-
+ .../mellanox/mlx5/core/en_accel/ipsec_fs.c         |   44 +-
+ .../mellanox/mlx5/core/en_accel/ipsec_rxtx.h       |    2 +-
+ .../ethernet/mellanox/mlx5/core/en_accel/ktls_rx.c |    9 +-
+ .../ethernet/mellanox/mlx5/core/en_accel/macsec.c  |    2 +-
+ .../net/ethernet/mellanox/mlx5/core/en_accel/psp.c |  952 +++++++++
+ .../net/ethernet/mellanox/mlx5/core/en_accel/psp.h |   61 +
+ .../mellanox/mlx5/core/en_accel/psp_rxtx.c         |  200 ++
+ .../mellanox/mlx5/core/en_accel/psp_rxtx.h         |  121 ++
+ .../net/ethernet/mellanox/mlx5/core/en_common.c    |   49 +-
+ .../net/ethernet/mellanox/mlx5/core/en_ethtool.c   |    5 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_fs.c    |   21 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_main.c  |   93 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_rep.c   |    8 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_rx.c    |   80 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_stats.c |  129 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_stats.h |    3 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_tc.c    |   13 +-
+ drivers/net/ethernet/mellanox/mlx5/core/en_tx.c    |   12 +-
+ drivers/net/ethernet/mellanox/mlx5/core/eq.c       |    8 +-
+ .../mellanox/mlx5/core/esw/acl/egress_lgcy.c       |    4 +-
+ .../ethernet/mellanox/mlx5/core/esw/adj_vport.c    |  209 ++
+ .../net/ethernet/mellanox/mlx5/core/esw/bridge.c   |   47 +-
+ .../ethernet/mellanox/mlx5/core/esw/devlink_port.c |   11 +-
+ .../net/ethernet/mellanox/mlx5/core/esw/vporttbl.c |    4 +-
+ drivers/net/ethernet/mellanox/mlx5/core/eswitch.c  |  238 ++-
+ drivers/net/ethernet/mellanox/mlx5/core/eswitch.h  |   52 +-
+ .../ethernet/mellanox/mlx5/core/eswitch_offloads.c |  126 +-
+ .../net/ethernet/mellanox/mlx5/core/fpga/conn.c    |    1 -
+ drivers/net/ethernet/mellanox/mlx5/core/fs_core.c  |  203 +-
+ drivers/net/ethernet/mellanox/mlx5/core/fs_core.h  |   18 +-
+ drivers/net/ethernet/mellanox/mlx5/core/fw.c       |    6 +
+ drivers/net/ethernet/mellanox/mlx5/core/health.c   |   49 +-
+ .../net/ethernet/mellanox/mlx5/core/irq_affinity.c |    4 +-
+ drivers/net/ethernet/mellanox/mlx5/core/lag/lag.c  |   45 +-
+ drivers/net/ethernet/mellanox/mlx5/core/lag/lag.h  |    1 +
+ drivers/net/ethernet/mellanox/mlx5/core/lib/aso.c  |    8 +-
+ .../net/ethernet/mellanox/mlx5/core/lib/clock.c    |  131 +-
+ .../net/ethernet/mellanox/mlx5/core/lib/crypto.h   |    1 +
+ .../net/ethernet/mellanox/mlx5/core/lib/devcom.c   |   44 +-
+ .../net/ethernet/mellanox/mlx5/core/lib/devcom.h   |   16 +-
+ .../net/ethernet/mellanox/mlx5/core/lib/fs_ttc.c   |  397 +++-
+ .../net/ethernet/mellanox/mlx5/core/lib/fs_ttc.h   |   19 +
+ .../mellanox/mlx5/core/lib/ipsec_fs_roce.c         |    4 +
+ .../ethernet/mellanox/mlx5/core/lib/macsec_fs.c    |   14 +-
+ .../ethernet/mellanox/mlx5/core/lib/macsec_fs.h    |   15 +
+ .../net/ethernet/mellanox/mlx5/core/lib/nv_param.c |  567 +++++
+ .../net/ethernet/mellanox/mlx5/core/lib/nv_param.h |   14 +
+ drivers/net/ethernet/mellanox/mlx5/core/lib/sd.c   |    6 +-
+ drivers/net/ethernet/mellanox/mlx5/core/main.c     |   40 +-
+ .../net/ethernet/mellanox/mlx5/core/mlx5_core.h    |    2 -
+ drivers/net/ethernet/mellanox/mlx5/core/pci_irq.c  |    2 +-
+ .../mlx5/core/sf/dev/diag/dev_tracepoint.h         |    2 +-
+ .../ethernet/mellanox/mlx5/core/steering/hws/cmd.c |   30 +-
+ .../mellanox/mlx5/core/steering/hws/definer.c      |    2 +-
+ .../mellanox/mlx5/core/steering/hws/send.c         |    8 +-
+ .../mellanox/mlx5/core/steering/sws/dr_cmd.c       |   30 +-
+ .../mellanox/mlx5/core/steering/sws/dr_send.c      |    1 -
+ drivers/net/ethernet/mellanox/mlx5/core/vport.c    |   58 +-
+ drivers/net/ethernet/mellanox/mlx5/core/wc.c       |   16 +-
+ drivers/net/ethernet/mellanox/mlxsw/core.c         |    6 +-
+ drivers/net/ethernet/mellanox/mlxsw/spectrum_cnt.c |    3 +-
+ drivers/net/ethernet/meta/fbnic/fbnic.h            |   14 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_csr.h        |   37 +
+ drivers/net/ethernet/meta/fbnic/fbnic_devlink.c    |  249 +++
+ drivers/net/ethernet/meta/fbnic/fbnic_ethtool.c    |  209 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_fw.c         |  482 ++++-
+ drivers/net/ethernet/meta/fbnic/fbnic_fw.h         |   92 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_fw_log.c     |    2 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_fw_log.h     |    2 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_hw_stats.c   |   66 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_hw_stats.h   |   28 +
+ drivers/net/ethernet/meta/fbnic/fbnic_mac.c        |   57 +
+ drivers/net/ethernet/meta/fbnic/fbnic_mac.h        |    6 +
+ drivers/net/ethernet/meta/fbnic/fbnic_netdev.c     |  149 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_netdev.h     |   13 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_pci.c        |   61 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_rpc.c        |  145 +-
+ drivers/net/ethernet/meta/fbnic/fbnic_rpc.h        |    4 +
+ drivers/net/ethernet/meta/fbnic/fbnic_txrx.c       |  997 ++++++---
+ drivers/net/ethernet/meta/fbnic/fbnic_txrx.h       |   33 +-
+ drivers/net/ethernet/microchip/lan865x/lan865x.c   |    2 +
+ drivers/net/ethernet/microchip/sparx5/Kconfig      |    2 +-
+ .../net/ethernet/microchip/sparx5/sparx5_ethtool.c |   18 +
+ drivers/net/ethernet/microsoft/mana/hw_channel.c   |    7 +-
+ drivers/net/ethernet/microsoft/mana/mana_bpf.c     |   46 +-
+ drivers/net/ethernet/microsoft/mana/mana_en.c      |  163 +-
+ drivers/net/ethernet/netronome/nfp/crypto/tls.c    |    9 +-
+ .../net/ethernet/netronome/nfp/flower/metadata.c   |    4 +-
+ drivers/net/ethernet/netronome/nfp/nfd3/dp.c       |   16 +-
+ drivers/net/ethernet/netronome/nfp/nfdk/dp.c       |   16 +-
+ drivers/net/ethernet/netronome/nfp/nfp_main.c      |    2 +-
+ .../net/ethernet/pensando/ionic/ionic_ethtool.c    |    2 +-
+ drivers/net/ethernet/qlogic/qed/qed_devlink.c      |    9 +-
+ drivers/net/ethernet/qlogic/qed/qed_main.c         |    3 +-
+ drivers/net/ethernet/qlogic/qed/qed_ooo.c          |    9 -
+ drivers/net/ethernet/qualcomm/Kconfig              |   15 +
+ drivers/net/ethernet/qualcomm/Makefile             |    1 +
+ drivers/net/ethernet/qualcomm/ppe/Makefile         |    7 +
+ drivers/net/ethernet/qualcomm/ppe/ppe.c            |  239 +++
+ drivers/net/ethernet/qualcomm/ppe/ppe.h            |   39 +
+ drivers/net/ethernet/qualcomm/ppe/ppe_config.c     | 2034 ++++++++++++++++++
+ drivers/net/ethernet/qualcomm/ppe/ppe_config.h     |  317 +++
+ drivers/net/ethernet/qualcomm/ppe/ppe_debugfs.c    |  847 ++++++++
+ drivers/net/ethernet/qualcomm/ppe/ppe_debugfs.h    |   16 +
+ drivers/net/ethernet/qualcomm/ppe/ppe_regs.h       |  591 ++++++
+ drivers/net/ethernet/realtek/Kconfig               |    2 +-
+ drivers/net/ethernet/realtek/r8169_main.c          |   12 +-
+ drivers/net/ethernet/renesas/Makefile              |    1 +
+ drivers/net/ethernet/renesas/ravb_main.c           |    3 +-
+ drivers/net/ethernet/renesas/rcar_gen4_ptp.c       |   76 +-
+ drivers/net/ethernet/renesas/rcar_gen4_ptp.h       |   33 +-
+ drivers/net/ethernet/renesas/rswitch.h             |   43 +-
+ drivers/net/ethernet/renesas/rswitch_l2.c          |  316 +++
+ drivers/net/ethernet/renesas/rswitch_l2.h          |   15 +
+ .../ethernet/renesas/{rswitch.c => rswitch_main.c} |   97 +-
+ drivers/net/ethernet/renesas/rtsn.c                |    3 +-
+ drivers/net/ethernet/renesas/sh_eth.c              |   34 +-
+ drivers/net/ethernet/sfc/ef100_tx.c                |   17 +-
+ drivers/net/ethernet/sfc/efx_channels.c            |    6 +-
+ drivers/net/ethernet/sfc/ethtool.c                 |    3 +-
+ drivers/net/ethernet/sfc/falcon/efx.c              |    5 +-
+ drivers/net/ethernet/sfc/siena/efx_channels.c      |    6 +-
+ drivers/net/ethernet/sfc/siena/ethtool.c           |    3 +-
+ drivers/net/ethernet/sfc/tc_encap_actions.c        |    4 +-
+ drivers/net/ethernet/smsc/smsc911x.c               |   14 +-
+ drivers/net/ethernet/spacemit/Kconfig              |   29 +
+ drivers/net/ethernet/spacemit/Makefile             |    6 +
+ drivers/net/ethernet/spacemit/k1_emac.c            | 2159 +++++++++++++++++++
+ drivers/net/ethernet/spacemit/k1_emac.h            |  416 ++++
+ drivers/net/ethernet/stmicro/stmmac/Kconfig        |   12 +-
+ drivers/net/ethernet/stmicro/stmmac/common.h       |    1 -
+ .../ethernet/stmicro/stmmac/dwmac-dwc-qos-eth.c    |    3 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-imx.c    |   30 +-
+ .../net/ethernet/stmicro/stmmac/dwmac-ingenic.c    |   25 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-intel.c  |   86 +-
+ .../net/ethernet/stmicro/stmmac/dwmac-loongson.c   |   85 +-
+ .../net/ethernet/stmicro/stmmac/dwmac-lpc18xx.c    |    1 -
+ .../net/ethernet/stmicro/stmmac/dwmac-mediatek.c   |   10 +-
+ .../ethernet/stmicro/stmmac/dwmac-renesas-gbeth.c  |  108 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c     |   60 +-
+ .../net/ethernet/stmicro/stmmac/dwmac-socfpga.c    |    2 +-
+ .../net/ethernet/stmicro/stmmac/dwmac-starfive.c   |    6 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-stm32.c  |   94 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-sun8i.c  |   51 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-thead.c  |   24 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac4.h       |    1 +
+ drivers/net/ethernet/stmicro/stmmac/dwmac4_descs.c |    8 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac4_dma.c   |    2 +
+ drivers/net/ethernet/stmicro/stmmac/dwmac_lib.c    |    2 +-
+ drivers/net/ethernet/stmicro/stmmac/hwif.c         |    2 +-
+ drivers/net/ethernet/stmicro/stmmac/stmmac.h       |   17 +-
+ .../net/ethernet/stmicro/stmmac/stmmac_ethtool.c   |   31 +-
+ drivers/net/ethernet/stmicro/stmmac/stmmac_main.c  |  337 ++-
+ drivers/net/ethernet/stmicro/stmmac/stmmac_mdio.c  |  389 ++--
+ drivers/net/ethernet/stmicro/stmmac/stmmac_pci.c   |   78 +-
+ .../net/ethernet/stmicro/stmmac/stmmac_platform.c  |   94 +-
+ drivers/net/ethernet/stmicro/stmmac/stmmac_ptp.c   |   54 +-
+ drivers/net/ethernet/ti/Kconfig                    |   12 +
+ drivers/net/ethernet/ti/Makefile                   |    3 +
+ drivers/net/ethernet/ti/am65-cpsw-ethtool.c        |   25 +-
+ drivers/net/ethernet/ti/am65-cpsw-nuss.c           |    9 +-
+ drivers/net/ethernet/ti/icssg/icss_iep.c           |  101 +
+ drivers/net/ethernet/ti/icssm/icssm_prueth.c       | 1746 +++++++++++++++
+ drivers/net/ethernet/ti/icssm/icssm_prueth.h       |  262 +++
+ drivers/net/ethernet/ti/icssm/icssm_prueth_ptp.h   |   85 +
+ drivers/net/ethernet/ti/icssm/icssm_switch.h       |  257 +++
+ drivers/net/ethernet/wangxun/Kconfig               |    1 +
+ drivers/net/ethernet/wangxun/libwx/wx_ethtool.c    |   88 +-
+ drivers/net/ethernet/wangxun/libwx/wx_ethtool.h    |    1 +
+ drivers/net/ethernet/wangxun/libwx/wx_lib.c        |  103 +-
+ drivers/net/ethernet/wangxun/libwx/wx_type.h       |    5 +
+ drivers/net/ethernet/wangxun/libwx/wx_vf.h         |   72 +-
+ drivers/net/ethernet/wangxun/libwx/wx_vf_lib.c     |    2 +-
+ drivers/net/ethernet/wangxun/libwx/wx_vf_lib.h     |    1 +
+ drivers/net/ethernet/wangxun/ngbe/ngbe_ethtool.c   |    3 +-
+ drivers/net/ethernet/wangxun/ngbe/ngbe_main.c      |    6 +-
+ drivers/net/ethernet/wangxun/ngbevf/ngbevf_main.c  |    5 +
+ drivers/net/ethernet/wangxun/txgbe/txgbe_ethtool.c |    3 +-
+ drivers/net/ethernet/wangxun/txgbe/txgbe_main.c    |    1 +
+ .../net/ethernet/wangxun/txgbevf/txgbevf_main.c    |    5 +
+ drivers/net/ethernet/wiznet/w5100.c                |    2 +-
+ drivers/net/ethernet/xilinx/xilinx_axienet_main.c  |   10 +-
+ drivers/net/fjes/fjes_main.c                       |    5 +-
+ drivers/net/geneve.c                               |    4 +-
+ drivers/net/gtp.c                                  |    7 +-
+ drivers/net/ipvlan/ipvlan_core.c                   |    4 +-
+ drivers/net/macsec.c                               |  173 +-
+ drivers/net/macvlan.c                              |    2 +-
+ drivers/net/mdio/Kconfig                           |    5 -
+ drivers/net/mdio/mdio-bcm-unimac.c                 |    4 +-
+ drivers/net/mdio/of_mdio.c                         |    3 +-
+ drivers/net/netconsole.c                           |   91 +-
+ drivers/net/netdevsim/dev.c                        |    6 +-
+ drivers/net/netdevsim/ethtool.c                    |   25 +-
+ drivers/net/netdevsim/health.c                     |    4 +-
+ drivers/net/pcs/Kconfig                            |   11 +-
+ drivers/net/pcs/pcs-lynx.c                         |   11 +-
+ drivers/net/pcs/pcs-rzn1-miic.c                    |  317 ++-
+ drivers/net/phy/Kconfig                            |   11 +-
+ drivers/net/phy/Makefile                           |    3 +-
+ drivers/net/phy/aquantia/aquantia.h                |   52 +
+ drivers/net/phy/aquantia/aquantia_main.c           |  702 ++++---
+ drivers/net/phy/as21xxx.c                          |    7 +-
+ drivers/net/phy/ax88796b.c                         |    5 +-
+ drivers/net/phy/broadcom.c                         |  147 +-
+ drivers/net/phy/dp83640.c                          |   58 +-
+ drivers/net/phy/fixed_phy.c                        |  219 +-
+ drivers/net/phy/marvell-88x2222.c                  |   13 +-
+ drivers/net/phy/marvell.c                          |   47 +-
+ drivers/net/phy/marvell10g.c                       |    7 +-
+ drivers/net/phy/mdio-boardinfo.c                   |   79 -
+ drivers/net/phy/mdio-boardinfo.h                   |   18 -
+ drivers/net/phy/mdio_bus_provider.c                |   33 -
+ drivers/net/phy/mediatek/mtk-2p5ge.c               |  104 +-
+ drivers/net/phy/micrel.c                           | 1004 ++++++---
+ drivers/net/phy/motorcomm.c                        |  117 ++
+ drivers/net/phy/mscc/mscc.h                        |    3 +
+ drivers/net/phy/mscc/mscc_main.c                   |   40 +
+ drivers/net/phy/mxl-86110.c                        |  392 +++-
+ drivers/net/phy/nxp-c45-tja11xx-macsec.c           |    8 +-
+ drivers/net/phy/phy.c                              |   15 +
+ drivers/net/phy/phy_device.c                       |    4 +-
+ drivers/net/phy/phylink.c                          |   14 +-
+ drivers/net/phy/qcom/at803x.c                      |    9 +-
+ drivers/net/phy/qcom/qca807x.c                     |    7 +-
+ drivers/net/phy/realtek/realtek_main.c             |  263 ++-
+ drivers/net/phy/sfp-bus.c                          |  111 +-
+ drivers/net/phy/sfp.c                              |   61 +-
+ drivers/net/phy/sfp.h                              |    4 +-
+ drivers/net/ppp/Kconfig                            |    3 +-
+ drivers/net/ppp/bsd_comp.c                         |    4 +-
+ drivers/net/ppp/ppp_generic.c                      |  120 +-
+ drivers/net/ppp/ppp_mppe.c                         |  108 +-
+ drivers/net/ppp/pppoe.c                            |  129 +-
+ drivers/net/pse-pd/Kconfig                         |   11 +
+ drivers/net/pse-pd/Makefile                        |    1 +
+ drivers/net/pse-pd/si3474.c                        |  578 +++++
+ drivers/net/tun.c                                  |    4 +-
+ drivers/net/usb/Kconfig                            |    1 +
+ drivers/net/usb/lan78xx.c                          |    6 +
+ drivers/net/virtio_net.c                           |   22 +-
+ drivers/net/vrf.c                                  |    4 +-
+ drivers/net/vxlan/vxlan_core.c                     |    7 +-
+ drivers/net/wan/framer/pef2256/pef2256.c           |   28 +-
+ drivers/net/wireguard/device.c                     |    6 +-
+ drivers/net/wireguard/queueing.h                   |   13 +-
+ drivers/net/wireless/ath/ath10k/leds.c             |    3 +-
+ drivers/net/wireless/ath/ath10k/mac.c              |   12 +-
+ drivers/net/wireless/ath/ath10k/snoc.c             |   14 +-
+ drivers/net/wireless/ath/ath10k/wmi.c              |   39 +-
+ drivers/net/wireless/ath/ath11k/ahb.c              |   17 +-
+ drivers/net/wireless/ath/ath11k/ce.c               |    3 +-
+ drivers/net/wireless/ath/ath11k/core.c             |    6 +-
+ drivers/net/wireless/ath/ath11k/dp_rx.c            |    1 -
+ drivers/net/wireless/ath/ath11k/hal.c              |   16 +
+ drivers/net/wireless/ath/ath11k/hal.h              |    1 +
+ drivers/net/wireless/ath/ath11k/qmi.c              |   19 +-
+ drivers/net/wireless/ath/ath12k/ce.c               |    5 +-
+ drivers/net/wireless/ath/ath12k/core.h             |    7 +-
+ drivers/net/wireless/ath/ath12k/debug.h            |    1 +
+ drivers/net/wireless/ath/ath12k/dp.c               |    2 +
+ drivers/net/wireless/ath/ath12k/dp.h               |   12 +-
+ drivers/net/wireless/ath/ath12k/dp_mon.c           |   56 +-
+ drivers/net/wireless/ath/ath12k/dp_rx.c            |  352 ++--
+ drivers/net/wireless/ath/ath12k/dp_rx.h            |   18 +-
+ drivers/net/wireless/ath/ath12k/hal.h              |    1 +
+ drivers/net/wireless/ath/ath12k/hal_desc.h         |    1 +
+ drivers/net/wireless/ath/ath12k/hal_rx.c           |    3 +
+ drivers/net/wireless/ath/ath12k/hal_rx.h           |   12 +-
+ drivers/net/wireless/ath/ath12k/mac.c              |  117 +-
+ drivers/net/wireless/ath/ath12k/mac.h              |    3 +-
+ drivers/net/wireless/ath/ath12k/qmi.c              |   24 +-
+ drivers/net/wireless/ath/ath12k/qmi.h              |   16 +-
+ drivers/net/wireless/ath/ath12k/wmi.c              |  158 +-
+ drivers/net/wireless/ath/ath12k/wmi.h              |   33 +-
+ drivers/net/wireless/ath/carl9170/rx.c             |    2 +-
+ drivers/net/wireless/ath/wil6210/cfg80211.c        |    1 +
+ .../wireless/broadcom/brcm80211/brcmfmac/bcmsdh.c  |    2 +-
+ .../broadcom/brcm80211/brcmfmac/cfg80211.c         |   23 +
+ .../wireless/broadcom/brcm80211/brcmfmac/chip.c    |    4 +-
+ .../broadcom/brcm80211/brcmfmac/firmware.c         |   14 +-
+ .../wireless/broadcom/brcm80211/brcmfmac/sdio.c    |    8 +-
+ .../broadcom/brcm80211/include/brcm_hw_ids.h       |    1 -
+ drivers/net/wireless/intel/iwlegacy/iwl-spectrum.h |   24 -
+ drivers/net/wireless/intel/iwlwifi/cfg/bz.c        |   18 +-
+ drivers/net/wireless/intel/iwlwifi/cfg/dr.c        |   13 +-
+ drivers/net/wireless/intel/iwlwifi/cfg/rf-gf.c     |   22 +-
+ drivers/net/wireless/intel/iwlwifi/cfg/rf-hr.c     |    2 +-
+ drivers/net/wireless/intel/iwlwifi/cfg/sc.c        |   18 +-
+ drivers/net/wireless/intel/iwlwifi/dvm/eeprom.c    |    2 +-
+ drivers/net/wireless/intel/iwlwifi/dvm/mac80211.c  |   10 +-
+ drivers/net/wireless/intel/iwlwifi/dvm/power.c     |    2 +-
+ drivers/net/wireless/intel/iwlwifi/fw/acpi.c       |    6 +-
+ drivers/net/wireless/intel/iwlwifi/fw/acpi.h       |    2 -
+ drivers/net/wireless/intel/iwlwifi/fw/api/d3.h     |  113 +-
+ .../net/wireless/intel/iwlwifi/fw/api/mac-cfg.h    |    3 +
+ .../net/wireless/intel/iwlwifi/fw/api/offload.h    |    2 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/power.h  |   34 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/rs.h     |   35 +
+ drivers/net/wireless/intel/iwlwifi/fw/dbg.c        |   43 +-
+ drivers/net/wireless/intel/iwlwifi/fw/dump.c       |   54 +-
+ drivers/net/wireless/intel/iwlwifi/fw/error-dump.h |    3 +-
+ drivers/net/wireless/intel/iwlwifi/fw/pnvm.c       |   81 +-
+ drivers/net/wireless/intel/iwlwifi/fw/regulatory.c |   53 +-
+ drivers/net/wireless/intel/iwlwifi/fw/regulatory.h |    1 -
+ drivers/net/wireless/intel/iwlwifi/fw/runtime.h    |    2 -
+ drivers/net/wireless/intel/iwlwifi/fw/uefi.c       |    7 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-config.h    |   40 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-drv.c       |   47 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-io.c        |   95 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-io.h        |    2 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-nvm-parse.c |   80 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-nvm-parse.h |   74 +
+ drivers/net/wireless/intel/iwlwifi/iwl-trans.c     |   71 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-trans.h     |   81 +-
+ drivers/net/wireless/intel/iwlwifi/mei/sap.h       |    2 -
+ drivers/net/wireless/intel/iwlwifi/mld/d3.c        |  555 +++--
+ drivers/net/wireless/intel/iwlwifi/mld/debugfs.c   |    8 +-
+ drivers/net/wireless/intel/iwlwifi/mld/iface.c     |   39 +-
+ drivers/net/wireless/intel/iwlwifi/mld/iface.h     |    5 +-
+ drivers/net/wireless/intel/iwlwifi/mld/key.c       |   38 +
+ drivers/net/wireless/intel/iwlwifi/mld/key.h       |    7 +
+ drivers/net/wireless/intel/iwlwifi/mld/link.c      |   26 +-
+ drivers/net/wireless/intel/iwlwifi/mld/link.h      |    2 +
+ drivers/net/wireless/intel/iwlwifi/mld/mac80211.c  |   19 +-
+ drivers/net/wireless/intel/iwlwifi/mld/mld.c       |    4 +
+ drivers/net/wireless/intel/iwlwifi/mld/mlo.c       |   34 +-
+ drivers/net/wireless/intel/iwlwifi/mld/notif.c     |    1 -
+ .../net/wireless/intel/iwlwifi/mld/regulatory.c    |   28 +-
+ drivers/net/wireless/intel/iwlwifi/mld/roc.c       |   10 +-
+ drivers/net/wireless/intel/iwlwifi/mld/rx.c        |   26 +-
+ drivers/net/wireless/intel/iwlwifi/mld/scan.c      |    4 +-
+ drivers/net/wireless/intel/iwlwifi/mld/sta.c       |    8 +-
+ drivers/net/wireless/intel/iwlwifi/mld/stats.c     |   11 +-
+ drivers/net/wireless/intel/iwlwifi/mld/tlc.c       |   75 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/coex.c      |  131 --
+ drivers/net/wireless/intel/iwlwifi/mvm/constants.h |   20 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/d3.c        |  382 +---
+ .../net/wireless/intel/iwlwifi/mvm/debugfs-vif.c   |   94 -
+ drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c   |    3 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/fw.c        |    2 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/link.c      |  809 -------
+ drivers/net/wireless/intel/iwlwifi/mvm/mac-ctxt.c  |   38 -
+ drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c  |  124 +-
+ .../net/wireless/intel/iwlwifi/mvm/mld-mac80211.c  |  138 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/mld-sta.c   |    2 -
+ drivers/net/wireless/intel/iwlwifi/mvm/mvm.h       |  136 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/ops.c       |   53 -
+ drivers/net/wireless/intel/iwlwifi/mvm/rx.c        |  133 --
+ drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c      |   23 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/scan.c      |  101 -
+ drivers/net/wireless/intel/iwlwifi/mvm/sta.c       |   89 -
+ drivers/net/wireless/intel/iwlwifi/mvm/sta.h       |   24 -
+ .../net/wireless/intel/iwlwifi/mvm/tests/Makefile  |    2 +-
+ .../net/wireless/intel/iwlwifi/mvm/tests/links.c   |  433 ----
+ .../net/wireless/intel/iwlwifi/mvm/time-event.c    |    3 -
+ drivers/net/wireless/intel/iwlwifi/mvm/tx.c        |    8 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/utils.c     |   10 -
+ drivers/net/wireless/intel/iwlwifi/pcie/drv.c      |    9 +-
+ .../wireless/intel/iwlwifi/pcie/gen1_2/internal.h  |   53 +-
+ .../intel/iwlwifi/pcie/gen1_2/trans-gen2.c         |    2 +-
+ .../net/wireless/intel/iwlwifi/pcie/gen1_2/trans.c |  237 ++-
+ .../net/wireless/intel/iwlwifi/pcie/gen1_2/tx.c    |    5 +-
+ drivers/net/wireless/intel/iwlwifi/tests/Makefile  |    2 +-
+ .../net/wireless/intel/iwlwifi/tests/nvm_parse.c   |   72 +
+ drivers/net/wireless/intersil/p54/txrx.c           |    2 +-
+ drivers/net/wireless/marvell/libertas/if_sdio.c    |    3 +-
+ drivers/net/wireless/marvell/libertas/if_spi.c     |    3 +-
+ drivers/net/wireless/marvell/libertas_tf/main.c    |    2 +-
+ drivers/net/wireless/marvell/mwifiex/cfg80211.c    |    7 +-
+ drivers/net/wireless/marvell/mwifiex/main.c        |    5 +
+ drivers/net/wireless/marvell/mwifiex/main.h        |    3 +
+ drivers/net/wireless/marvell/mwifiex/sta_cmd.c     |  113 +
+ drivers/net/wireless/marvell/mwifiex/sta_ioctl.c   |   58 +-
+ drivers/net/wireless/mediatek/mt76/agg-rx.c        |    2 +
+ drivers/net/wireless/mediatek/mt76/channel.c       |   13 +-
+ drivers/net/wireless/mediatek/mt76/dma.c           |  231 +-
+ drivers/net/wireless/mediatek/mt76/dma.h           |   29 +-
+ drivers/net/wireless/mediatek/mt76/eeprom.c        |    9 +-
+ drivers/net/wireless/mediatek/mt76/mac80211.c      |   59 +
+ drivers/net/wireless/mediatek/mt76/mt76.h          |   75 +-
+ drivers/net/wireless/mediatek/mt76/mt7603/eeprom.c |    3 +-
+ drivers/net/wireless/mediatek/mt76/mt7603/soc.c    |    2 +-
+ drivers/net/wireless/mediatek/mt76/mt7615/eeprom.c |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7615/init.c   |    5 +-
+ .../net/wireless/mediatek/mt76/mt76_connac3_mac.h  |    7 +
+ .../net/wireless/mediatek/mt76/mt76_connac_mcu.c   |   25 +
+ drivers/net/wireless/mediatek/mt76/mt76x0/eeprom.c |    6 +-
+ drivers/net/wireless/mediatek/mt76/mt76x2/eeprom.c |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7915/dma.c    |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7915/eeprom.c |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7915/eeprom.h |    6 +-
+ drivers/net/wireless/mediatek/mt76/mt7915/init.c   |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7915/mcu.c    |   29 +-
+ drivers/net/wireless/mediatek/mt76/mt7915/mmio.c   |    6 +-
+ drivers/net/wireless/mediatek/mt76/mt7921/init.c   |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7921/main.c   |    2 +
+ drivers/net/wireless/mediatek/mt76/mt7921/usb.c    |    3 +
+ drivers/net/wireless/mediatek/mt76/mt7925/init.c   |    4 +-
+ drivers/net/wireless/mediatek/mt76/mt7925/mac.c    |    5 +-
+ drivers/net/wireless/mediatek/mt76/mt7925/main.c   |   67 +-
+ drivers/net/wireless/mediatek/mt76/mt7925/mcu.c    |   28 +-
+ drivers/net/wireless/mediatek/mt76/mt7925/pci.c    |   26 +-
+ drivers/net/wireless/mediatek/mt76/mt7925/usb.c    |    3 +
+ drivers/net/wireless/mediatek/mt76/mt792x.h        |    1 -
+ drivers/net/wireless/mediatek/mt76/mt792x_core.c   |    6 +-
+ drivers/net/wireless/mediatek/mt76/mt792x_dma.c    |    6 +-
+ drivers/net/wireless/mediatek/mt76/mt7996/dma.c    |  324 ++-
+ drivers/net/wireless/mediatek/mt76/mt7996/eeprom.c |    3 +-
+ drivers/net/wireless/mediatek/mt76/mt7996/init.c   |  358 +++-
+ drivers/net/wireless/mediatek/mt76/mt7996/mac.c    |  799 +++++--
+ drivers/net/wireless/mediatek/mt76/mt7996/main.c   |  521 +++--
+ drivers/net/wireless/mediatek/mt76/mt7996/mcu.c    |  308 ++-
+ drivers/net/wireless/mediatek/mt76/mt7996/mcu.h    |   17 +-
+ drivers/net/wireless/mediatek/mt76/mt7996/mmio.c   |   97 +-
+ drivers/net/wireless/mediatek/mt76/mt7996/mt7996.h |  106 +-
+ drivers/net/wireless/mediatek/mt76/mt7996/pci.c    |    3 +-
+ drivers/net/wireless/mediatek/mt76/mt7996/regs.h   |   32 +-
+ drivers/net/wireless/mediatek/mt76/scan.c          |   13 +-
+ drivers/net/wireless/mediatek/mt76/tx.c            |    3 +-
+ drivers/net/wireless/mediatek/mt76/wed.c           |    8 +-
+ drivers/net/wireless/microchip/wilc1000/cfg80211.c |    7 -
+ drivers/net/wireless/ralink/rt2x00/rt2x00dev.c     |    2 +-
+ drivers/net/wireless/realtek/rtl8xxxu/core.c       |   27 +-
+ drivers/net/wireless/realtek/rtlwifi/ps.c          |    2 +-
+ .../net/wireless/realtek/rtlwifi/rtl8192cu/sw.c    |    1 -
+ drivers/net/wireless/realtek/rtw88/led.c           |   13 +-
+ drivers/net/wireless/realtek/rtw88/sdio.c          |    4 +
+ drivers/net/wireless/realtek/rtw89/chan.c          |   11 +-
+ drivers/net/wireless/realtek/rtw89/chan.h          |   10 +-
+ drivers/net/wireless/realtek/rtw89/coex.c          |    5 +-
+ drivers/net/wireless/realtek/rtw89/core.c          |  686 +++++-
+ drivers/net/wireless/realtek/rtw89/core.h          |  150 +-
+ drivers/net/wireless/realtek/rtw89/debug.c         |  125 +-
+ drivers/net/wireless/realtek/rtw89/debug.h         |    1 +
+ drivers/net/wireless/realtek/rtw89/fw.c            |  177 +-
+ drivers/net/wireless/realtek/rtw89/fw.h            |   77 +-
+ drivers/net/wireless/realtek/rtw89/mac.c           |   72 +-
+ drivers/net/wireless/realtek/rtw89/mac.h           |    1 +
+ drivers/net/wireless/realtek/rtw89/mac80211.c      |   35 +
+ drivers/net/wireless/realtek/rtw89/mac_be.c        |    1 +
+ drivers/net/wireless/realtek/rtw89/pci.c           |  466 +++-
+ drivers/net/wireless/realtek/rtw89/pci.h           |  128 +-
+ drivers/net/wireless/realtek/rtw89/pci_be.c        |   18 +-
+ drivers/net/wireless/realtek/rtw89/phy.c           |  476 ++++-
+ drivers/net/wireless/realtek/rtw89/phy.h           |   24 +-
+ drivers/net/wireless/realtek/rtw89/phy_be.c        |    9 +
+ drivers/net/wireless/realtek/rtw89/ps.c            |    3 +
+ drivers/net/wireless/realtek/rtw89/reg.h           |   56 +
+ drivers/net/wireless/realtek/rtw89/rtw8851b.c      |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8851b_rfk.c  |  157 +-
+ drivers/net/wireless/realtek/rtw89/rtw8851be.c     |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8851bu.c     |    3 +
+ drivers/net/wireless/realtek/rtw89/rtw8852a.c      |   46 +-
+ drivers/net/wireless/realtek/rtw89/rtw8852ae.c     |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8852b.c      |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8852be.c     |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8852bt.c     |    1 +
+ drivers/net/wireless/realtek/rtw89/rtw8852bt_rfk.c |   14 +-
+ drivers/net/wireless/realtek/rtw89/rtw8852bte.c    |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8852bu.c     |    2 +
+ drivers/net/wireless/realtek/rtw89/rtw8852c.c      |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8852ce.c     |    4 +
+ drivers/net/wireless/realtek/rtw89/rtw8922a.c      |   11 +-
+ drivers/net/wireless/realtek/rtw89/rtw8922ae.c     |    4 +
+ drivers/net/wireless/realtek/rtw89/sar.c           |   15 +
+ drivers/net/wireless/realtek/rtw89/sar.h           |    1 +
+ drivers/net/wireless/realtek/rtw89/ser.c           |    5 +-
+ drivers/net/wireless/realtek/rtw89/txrx.h          |   38 +-
+ drivers/net/wireless/realtek/rtw89/wow.c           |   79 +-
+ drivers/net/wireless/realtek/rtw89/wow.h           |    6 +
+ drivers/net/wireless/virtual/mac80211_hwsim.c      |  259 ++-
+ drivers/net/wireless/virtual/mac80211_hwsim.h      |    4 +-
+ drivers/net/wwan/iosm/iosm_ipc_pcie.c              |    2 +-
+ drivers/net/wwan/t7xx/t7xx_hif_dpmaif_rx.c         |    3 +-
+ drivers/net/wwan/wwan_hwsim.c                      |    2 +-
+ drivers/nfc/pn533/pn533.c                          |   12 +-
+ drivers/nfc/s3fwrn5/Kconfig                        |    3 +-
+ drivers/nfc/s3fwrn5/firmware.c                     |   17 +-
+ drivers/ptp/Kconfig                                |   13 +-
+ drivers/ptp/Makefile                               |    5 +-
+ drivers/ptp/ptp_chardev.c                          |   62 +-
+ drivers/ptp/ptp_clock.c                            |  150 +-
+ drivers/ptp/ptp_clockmatrix.c                      |    2 +-
+ drivers/ptp/ptp_netc.c                             | 1043 +++++++++
+ drivers/ptp/ptp_ocp.c                              |    6 +-
+ drivers/ptp/ptp_private.h                          |    2 +
+ drivers/ptp/ptp_qoriq.c                            |   24 +-
+ drivers/ptp/ptp_qoriq_debugfs.c                    |  101 -
+ drivers/s390/net/Kconfig                           |    3 +-
+ drivers/s390/net/ism.h                             |   53 +-
+ drivers/s390/net/ism_drv.c                         |  573 ++---
+ drivers/staging/octeon/ethernet-tx.c               |    3 +-
+ drivers/staging/rtl8723bs/os_dep/ioctl_cfg80211.c  |    8 -
+ .../dt-bindings/net/renesas,r9a09g077-pcs-miic.h   |   36 +
+ include/linux/bnxt/hsi.h                           |  376 +++-
+ include/linux/bpf.h                                |    7 +-
+ include/linux/can/bittiming.h                      |   48 +-
+ include/linux/can/dev.h                            |   66 +-
+ include/linux/can/dev/peak_canfd.h                 |    4 +-
+ include/linux/dibs.h                               |  464 ++++
+ include/linux/ethtool.h                            |   27 +-
+ include/linux/filter.h                             |    6 +
+ include/linux/fsl/ptp_qoriq.h                      |   10 -
+ include/linux/ieee80211.h                          |  300 ++-
+ include/linux/if_pppox.h                           |    2 +-
+ include/linux/inet_diag.h                          |   20 +-
+ include/linux/ipv6.h                               |   41 +-
+ include/linux/ism.h                                |   28 +-
+ include/linux/memcontrol.h                         |   45 +-
+ include/linux/micrel_phy.h                         |    1 +
+ include/linux/mlx5/cq.h                            |    1 -
+ include/linux/mlx5/device.h                        |    5 +
+ include/linux/mlx5/driver.h                        |   10 +-
+ include/linux/mlx5/mlx5_ifc.h                      |  269 ++-
+ include/linux/mlx5/qp.h                            |   16 +-
+ include/linux/mlx5/vport.h                         |    2 +
+ include/linux/mmc/sdio_ids.h                       |    2 +-
+ include/linux/net/intel/libie/adminq.h             |   95 +-
+ include/linux/net/intel/libie/fwlog.h              |   85 +
+ include/linux/netdevice.h                          |   41 +-
+ include/linux/netpoll.h                            |    1 -
+ include/linux/phy.h                                |   52 +-
+ include/linux/phy_fixed.h                          |   18 +-
+ include/linux/phylink.h                            |    7 +-
+ include/linux/ptp_clock_kernel.h                   |   32 +
+ include/linux/ptr_ring.h                           |   42 +-
+ include/linux/sfp.h                                |   48 +-
+ include/linux/skbuff.h                             |   52 +-
+ include/linux/skmsg.h                              |    2 +-
+ include/linux/soc/airoha/airoha_offload.h          |  316 +++
+ include/linux/soc/mediatek/mtk_wed.h               |    2 +-
+ include/linux/stmmac.h                             |   35 +-
+ include/linux/tcp.h                                |   52 +-
+ include/linux/udp.h                                |    9 +
+ include/net/act_api.h                              |   14 +-
+ include/net/bond_3ad.h                             |    2 +
+ include/net/bond_options.h                         |    1 +
+ include/net/bonding.h                              |    1 -
+ include/net/cfg80211.h                             |  282 ++-
+ include/net/cls_cgroup.h                           |    2 +-
+ include/net/devlink.h                              |   24 +-
+ include/net/dropreason-core.h                      |    6 +
+ include/net/dst.h                                  |   16 +-
+ include/net/flow.h                                 |   11 +-
+ include/net/genetlink.h                            |    2 +-
+ include/net/gro.h                                  |   32 +-
+ include/net/icmp.h                                 |   10 +-
+ include/net/inet6_hashtables.h                     |   20 +-
+ include/net/inet_connection_sock.h                 |   13 +-
+ include/net/inet_dscp.h                            |    6 +
+ include/net/inet_hashtables.h                      |   40 +-
+ include/net/inet_timewait_sock.h                   |   11 +-
+ include/net/ip.h                                   |   15 +-
+ include/net/ip6_route.h                            |   10 +-
+ include/net/ip_fib.h                               |    2 +-
+ include/net/ip_tunnels.h                           |    4 +-
+ include/net/libeth/xdp.h                           |   11 +-
+ include/net/mac80211.h                             |   10 +
+ include/net/mana/mana.h                            |    4 +
+ include/net/netdev_queues.h                        |    9 +
+ include/net/netfilter/ipv4/nf_reject.h             |    8 -
+ include/net/netfilter/ipv6/nf_reject.h             |   10 -
+ include/net/netfilter/nf_tables.h                  |    2 +
+ include/net/netfilter/nf_tables_core.h             |    2 +-
+ include/net/netns/ipv4.h                           |    3 +
+ include/net/netns/sctp.h                           |    4 +-
+ include/net/nfc/nci_core.h                         |    2 +-
+ include/net/page_pool/helpers.h                    |   17 +
+ include/net/ping.h                                 |    1 -
+ include/net/proto_memory.h                         |    4 +-
+ include/net/psp.h                                  |   12 +
+ include/net/psp/functions.h                        |  209 ++
+ include/net/psp/types.h                            |  184 ++
+ include/net/raw.h                                  |    1 +
+ include/net/request_sock.h                         |    2 +-
+ include/net/route.h                                |    4 +-
+ include/net/rps.h                                  |   92 +-
+ include/net/sctp/auth.h                            |   17 +-
+ include/net/sctp/constants.h                       |    9 +-
+ include/net/sctp/structs.h                         |   33 +-
+ include/net/seg6_hmac.h                            |   20 +-
+ include/net/smc.h                                  |   51 +-
+ include/net/snmp.h                                 |    5 -
+ include/net/sock.h                                 |  137 +-
+ include/net/tc_act/tc_skbmod.h                     |    1 +
+ include/net/tc_act/tc_tunnel_key.h                 |    1 +
+ include/net/tc_act/tc_vlan.h                       |    1 +
+ include/net/tcp.h                                  |  107 +-
+ include/net/tcp_ao.h                               |    1 -
+ include/net/tcp_ecn.h                              |  642 ++++++
+ include/net/timewait_sock.h                        |    7 -
+ include/net/udp.h                                  |   20 +-
+ include/net/xdp.h                                  |   71 +-
+ include/net/xdp_sock_drv.h                         |   21 +-
+ include/trace/events/fib.h                         |    4 +-
+ include/uapi/linux/can/netlink.h                   |   14 +-
+ include/uapi/linux/devlink.h                       |    2 +
+ include/uapi/linux/ethtool.h                       |    1 +
+ include/uapi/linux/ethtool_netlink_generated.h     |   12 +
+ include/uapi/linux/if_bridge.h                     |    3 +
+ include/uapi/linux/if_link.h                       |    3 +
+ include/uapi/linux/mptcp.h                         |   22 +-
+ include/uapi/linux/mptcp_pm.h                      |    4 +-
+ include/uapi/linux/netfilter/nf_tables.h           |    2 +
+ include/uapi/linux/nl80211.h                       |  255 ++-
+ include/uapi/linux/psp.h                           |   66 +
+ include/uapi/linux/ptp_clock.h                     |    4 +
+ include/uapi/linux/stddef.h                        |    2 +
+ include/uapi/linux/tcp.h                           |    9 +
+ io_uring/zcrx.c                                    |    3 +-
+ kernel/bpf/helpers.c                               |   11 +
+ kernel/bpf/log.c                                   |    2 +
+ kernel/bpf/verifier.c                              |   28 +-
+ kernel/time/time.c                                 |    1 +
+ mm/memcontrol.c                                    |   40 +-
+ net/Kconfig                                        |    2 +
+ net/Makefile                                       |    1 +
+ net/batman-adv/Kconfig                             |   13 -
+ net/batman-adv/Makefile                            |    1 -
+ net/batman-adv/bat_iv_ogm.c                        |    5 -
+ net/batman-adv/bridge_loop_avoidance.c             |   34 +
+ net/batman-adv/hard-interface.c                    |    1 +
+ net/batman-adv/hard-interface.h                    |    1 -
+ net/batman-adv/log.h                               |    3 -
+ net/batman-adv/main.c                              |   50 -
+ net/batman-adv/main.h                              |    5 +-
+ net/batman-adv/mesh-interface.c                    |   15 +-
+ net/batman-adv/mesh-interface.h                    |    1 -
+ net/batman-adv/netlink.c                           |   17 -
+ net/batman-adv/netlink.h                           |    1 -
+ net/batman-adv/network-coding.c                    | 1878 -----------------
+ net/batman-adv/network-coding.h                    |  106 -
+ net/batman-adv/originator.c                        |    6 -
+ net/batman-adv/routing.c                           |    9 +-
+ net/batman-adv/send.c                              |   16 +-
+ net/batman-adv/translation-table.c                 |    4 +-
+ net/batman-adv/types.h                             |  216 --
+ net/bpf/test_run.c                                 |   37 +-
+ net/bridge/br.c                                    |   27 +
+ net/bridge/br_cfm.c                                |    6 +-
+ net/bridge/br_fdb.c                                |  114 +-
+ net/bridge/br_forward.c                            |    3 +-
+ net/bridge/br_input.c                              |    8 +
+ net/bridge/br_mrp.c                                |    8 +-
+ net/bridge/br_multicast.c                          |    9 +-
+ net/bridge/br_private.h                            |    3 +
+ net/bridge/br_vlan.c                               |   10 +-
+ net/bridge/netfilter/ebtables.c                    |   14 +-
+ net/bridge/netfilter/nft_meta_bridge.c             |   11 +
+ net/caif/cfctrl.c                                  |    4 +-
+ net/can/af_can.c                                   |    2 +-
+ net/can/isotp.c                                    |    2 +-
+ net/can/raw.c                                      |   67 +-
+ net/ceph/messenger.c                               |    3 +-
+ net/ceph/mon_client.c                              |    2 +-
+ net/core/Makefile                                  |    1 +
+ net/core/datagram.c                                |    2 +-
+ net/core/dev.c                                     |  115 +-
+ net/core/devmem.c                                  |    8 +-
+ net/core/devmem.h                                  |    2 +
+ net/core/dst.c                                     |    2 +-
+ net/core/filter.c                                  |  201 +-
+ net/core/gro.c                                     |    2 +
+ net/core/link_watch.c                              |    4 +-
+ net/core/lwt_bpf.c                                 |    4 +-
+ net/core/net-procfs.c                              |    3 +-
+ net/core/net-sysfs.c                               |    4 +-
+ net/core/netdev-genl.c                             |  122 +-
+ net/core/netdev_queues.c                           |   27 +
+ net/core/netdev_rx_queue.c                         |    9 +
+ net/core/netpoll.c                                 |    3 +-
+ net/core/page_pool.c                               |    6 +
+ net/core/pktgen.c                                  |    7 +-
+ net/core/request_sock.c                            |    4 +-
+ net/core/rtnetlink.c                               |   10 +-
+ net/core/skbuff.c                                  |    8 +-
+ net/core/skmsg.c                                   |    2 +-
+ net/core/sock.c                                    |   94 +-
+ net/core/sock_diag.c                               |    2 +-
+ net/core/xdp.c                                     |   21 +-
+ net/devlink/core.c                                 |    2 +-
+ net/devlink/health.c                               |  109 +-
+ net/devlink/netlink_gen.c                          |    5 +-
+ net/devlink/param.c                                |   10 +
+ net/devlink/port.c                                 |   33 +-
+ net/ethernet/eth.c                                 |    5 +-
+ net/ethtool/common.c                               |   20 +
+ net/ethtool/common.h                               |    2 +
+ net/ethtool/fec.c                                  |   75 +-
+ net/ethtool/ioctl.c                                |   94 +-
+ net/ethtool/rss.c                                  |   42 +-
+ net/ethtool/tsconfig.c                             |   12 +-
+ net/hsr/hsr_slave.c                                |    5 +-
+ net/ipv4/af_inet.c                                 |   12 +-
+ net/ipv4/arp.c                                     |    2 +-
+ net/ipv4/cipso_ipv4.c                              |   13 +-
+ net/ipv4/esp4.c                                    |    4 +-
+ net/ipv4/fib_frontend.c                            |    7 +-
+ net/ipv4/fib_rules.c                               |    4 +-
+ net/ipv4/fou_core.c                                |   32 +-
+ net/ipv4/fou_nl.c                                  |    4 +-
+ net/ipv4/icmp.c                                    |   33 +-
+ net/ipv4/inet_connection_sock.c                    |   42 +-
+ net/ipv4/inet_diag.c                               |  570 +----
+ net/ipv4/inet_fragment.c                           |    2 +-
+ net/ipv4/inet_hashtables.c                         |  108 +-
+ net/ipv4/inet_timewait_sock.c                      |   11 +-
+ net/ipv4/ip_fragment.c                             |    6 +-
+ net/ipv4/ip_gre.c                                  |    4 +-
+ net/ipv4/ip_input.c                                |   40 +-
+ net/ipv4/ip_options.c                              |    5 +-
+ net/ipv4/ip_output.c                               |    8 +-
+ net/ipv4/ipmr.c                                    |    9 +-
+ net/ipv4/netfilter.c                               |    9 +-
+ net/ipv4/netfilter/ipt_rpfilter.c                  |    4 +-
+ net/ipv4/netfilter/nf_dup_ipv4.c                   |    4 +-
+ net/ipv4/netfilter/nf_reject_ipv4.c                |   52 +-
+ net/ipv4/netfilter/nf_socket_ipv4.c                |    3 +-
+ net/ipv4/netfilter/nf_tproxy_ipv4.c                |    5 +-
+ net/ipv4/netfilter/nft_fib_ipv4.c                  |    4 +-
+ net/ipv4/nexthop.c                                 |   42 +-
+ net/ipv4/ping.c                                    |   68 +-
+ net/ipv4/proc.c                                    |   65 +-
+ net/ipv4/raw.c                                     |    7 +-
+ net/ipv4/raw_diag.c                                |   10 +-
+ net/ipv4/route.c                                   |   28 +-
+ net/ipv4/syncookies.c                              |    4 +
+ net/ipv4/sysctl_net_ipv4.c                         |   19 +
+ net/ipv4/tcp.c                                     |  100 +-
+ net/ipv4/tcp_ao.c                                  |    5 +-
+ net/ipv4/tcp_cdg.c                                 |    2 +-
+ net/ipv4/tcp_diag.c                                |  461 +++-
+ net/ipv4/tcp_fastopen.c                            |    7 +-
+ net/ipv4/tcp_input.c                               |  378 +++-
+ net/ipv4/tcp_ipv4.c                                |   89 +-
+ net/ipv4/tcp_metrics.c                             |    6 +-
+ net/ipv4/tcp_minisocks.c                           |   80 +-
+ net/ipv4/tcp_offload.c                             |    4 +-
+ net/ipv4/tcp_output.c                              |  332 ++-
+ net/ipv4/tcp_timer.c                               |    6 +-
+ net/ipv4/udp.c                                     |  171 +-
+ net/ipv4/udp_diag.c                                |   10 +-
+ net/ipv4/udp_offload.c                             |    2 -
+ net/ipv4/udp_tunnel_core.c                         |    3 +-
+ net/ipv4/udp_tunnel_nic.c                          |    2 +-
+ net/ipv4/xfrm4_policy.c                            |    4 +-
+ net/ipv6/Kconfig                                   |    7 +-
+ net/ipv6/addrconf.c                                |    4 +-
+ net/ipv6/af_inet6.c                                |    2 +-
+ net/ipv6/ah6.c                                     |   50 +-
+ net/ipv6/anycast.c                                 |    2 +-
+ net/ipv6/datagram.c                                |    2 +-
+ net/ipv6/esp6.c                                    |    4 +-
+ net/ipv6/icmp.c                                    |    9 +-
+ net/ipv6/inet6_connection_sock.c                   |    2 +-
+ net/ipv6/inet6_hashtables.c                        |   62 +-
+ net/ipv6/ip6_gre.c                                 |   10 +-
+ net/ipv6/ip6_output.c                              |   70 +-
+ net/ipv6/ipv6_sockglue.c                           |    6 +-
+ net/ipv6/mcast.c                                   |   67 +-
+ net/ipv6/ndisc.c                                   |    4 +-
+ net/ipv6/netfilter.c                               |    5 +-
+ net/ipv6/netfilter/nf_reject_ipv6.c                |   67 +-
+ net/ipv6/netfilter/nf_socket_ipv6.c                |    3 +-
+ net/ipv6/netfilter/nf_tproxy_ipv6.c                |    5 +-
+ net/ipv6/output_core.c                             |    8 +-
+ net/ipv6/ping.c                                    |    1 -
+ net/ipv6/proc.c                                    |   91 +-
+ net/ipv6/raw.c                                     |   11 +-
+ net/ipv6/route.c                                   |   14 +-
+ net/ipv6/seg6.c                                    |    7 -
+ net/ipv6/seg6_hmac.c                               |  211 +-
+ net/ipv6/sit.c                                     |  104 +-
+ net/ipv6/syncookies.c                              |    2 +
+ net/ipv6/tcp_ipv6.c                                |   56 +-
+ net/ipv6/tcpv6_offload.c                           |    3 +-
+ net/ipv6/udp.c                                     |   19 +-
+ net/ipv6/udp_offload.c                             |    2 -
+ net/iucv/af_iucv.c                                 |    4 +-
+ net/mac80211/cfg.c                                 |  186 +-
+ net/mac80211/chan.c                                |   11 -
+ net/mac80211/debugfs.c                             |    3 -
+ net/mac80211/debugfs_netdev.c                      |    2 -
+ net/mac80211/debugfs_sta.c                         |    2 -
+ net/mac80211/ethtool.c                             |    6 +-
+ net/mac80211/ieee80211_i.h                         |   17 +-
+ net/mac80211/iface.c                               |   25 +-
+ net/mac80211/main.c                                |   22 +-
+ net/mac80211/mesh.c                                |    3 +
+ net/mac80211/mesh_ps.c                             |    2 +-
+ net/mac80211/mlme.c                                |   91 +-
+ net/mac80211/offchannel.c                          |    5 +-
+ net/mac80211/rate.c                                |   11 +-
+ net/mac80211/rx.c                                  |   40 +-
+ net/mac80211/scan.c                                |   13 +-
+ net/mac80211/sta_info.c                            |   15 +-
+ net/mac80211/status.c                              |   21 +-
+ net/mac80211/tests/Makefile                        |    2 +-
+ net/mac80211/tests/s1g_tim.c                       |  356 ++++
+ net/mac80211/tx.c                                  |  187 +-
+ net/mac80211/util.c                                |   67 +-
+ net/mctp/af_mctp.c                                 |    2 +-
+ net/mptcp/crypto.c                                 |   35 +-
+ net/mptcp/ctrl.c                                   |    9 +-
+ net/mptcp/mib.c                                    |   12 +-
+ net/mptcp/mptcp_diag.c                             |   15 +-
+ net/mptcp/pm.c                                     |   60 +-
+ net/mptcp/pm_kernel.c                              |  569 +++--
+ net/mptcp/pm_netlink.c                             |   11 +-
+ net/mptcp/pm_userspace.c                           |    2 +-
+ net/mptcp/protocol.c                               |   31 +-
+ net/mptcp/protocol.h                               |   25 +-
+ net/mptcp/sockopt.c                                |   22 +-
+ net/mptcp/subflow.c                                |   11 +-
+ net/netfilter/ipset/ip_set_hash_gen.h              |    8 +-
+ net/netfilter/ipvs/ip_vs_conn.c                    |    4 +-
+ net/netfilter/ipvs/ip_vs_core.c                    |   11 +-
+ net/netfilter/ipvs/ip_vs_ctl.c                     |    6 +-
+ net/netfilter/ipvs/ip_vs_est.c                     |   16 +-
+ net/netfilter/ipvs/ip_vs_ftp.c                     |    4 +-
+ net/netfilter/nf_conntrack_ecache.c                |    2 +-
+ net/netfilter/nf_conntrack_netlink.c               |   39 +-
+ net/netfilter/nf_conntrack_standalone.c            |    3 +
+ net/netfilter/nf_tables_api.c                      |   47 +-
+ net/netfilter/nfnetlink.c                          |    2 +
+ net/netfilter/nft_flow_offload.c                   |    4 +-
+ net/netfilter/nft_payload.c                        |   20 +-
+ net/netfilter/nft_set_hash.c                       |  100 +-
+ net/netfilter/nft_set_pipapo.c                     |   96 +-
+ net/netfilter/nft_set_pipapo.h                     |    8 +-
+ net/netfilter/nft_set_pipapo_avx2.c                |  152 +-
+ net/netfilter/nft_set_pipapo_avx2.h                |    4 +
+ net/netfilter/nft_set_rbtree.c                     |   35 +-
+ net/netlink/af_netlink.c                           |    4 +-
+ net/openvswitch/dp_notify.c                        |    2 +-
+ net/openvswitch/flow.c                             |   12 +-
+ net/openvswitch/flow_table.c                       |    7 +-
+ net/packet/af_packet.c                             |  134 +-
+ net/packet/diag.c                                  |    2 +-
+ net/packet/internal.h                              |   14 +-
+ net/phonet/af_phonet.c                             |    4 +-
+ net/phonet/pep.c                                   |    6 +-
+ net/phonet/socket.c                                |   25 +-
+ net/psp/Kconfig                                    |   15 +
+ net/psp/Makefile                                   |    5 +
+ net/psp/psp-nl-gen.c                               |  119 ++
+ net/psp/psp-nl-gen.h                               |   39 +
+ net/psp/psp.h                                      |   54 +
+ net/psp/psp_main.c                                 |  322 +++
+ net/psp/psp_nl.c                                   |  505 +++++
+ net/psp/psp_sock.c                                 |  292 +++
+ net/rds/af_rds.c                                   |    2 +-
+ net/rds/connection.c                               |    9 +-
+ net/rds/ib_mr.h                                    |    1 -
+ net/rds/ib_rdma.c                                  |    3 +-
+ net/rds/ib_recv.c                                  |    2 +-
+ net/rds/message.c                                  |    4 +-
+ net/rds/rds.h                                      |    2 +-
+ net/rds/recv.c                                     |    4 +-
+ net/rds/send.c                                     |    4 +-
+ net/rfkill/input.c                                 |    2 +-
+ net/rxrpc/rxperf.c                                 |    2 +-
+ net/sched/act_api.c                                |   12 +-
+ net/sched/act_simple.c                             |    1 -
+ net/sched/act_skbmod.c                             |   22 +-
+ net/sched/act_tunnel_key.c                         |   16 +-
+ net/sched/act_vlan.c                               |   16 +-
+ net/sched/sch_api.c                                |    4 +-
+ net/sctp/Kconfig                                   |   47 +-
+ net/sctp/auth.c                                    |  166 +-
+ net/sctp/chunk.c                                   |    3 +-
+ net/sctp/diag.c                                    |    2 +-
+ net/sctp/endpointola.c                             |   23 +-
+ net/sctp/proc.c                                    |   12 +-
+ net/sctp/protocol.c                                |   14 +-
+ net/sctp/sm_make_chunk.c                           |   60 +-
+ net/sctp/sm_statefuns.c                            |    5 +-
+ net/sctp/socket.c                                  |   41 +-
+ net/sctp/sysctl.c                                  |   53 +-
+ net/smc/Kconfig                                    |   16 +-
+ net/smc/Makefile                                   |    1 -
+ net/smc/af_smc.c                                   |   30 +-
+ net/smc/smc_clc.c                                  |   73 +-
+ net/smc/smc_core.c                                 |   37 +-
+ net/smc/smc_core.h                                 |    5 +
+ net/smc/smc_diag.c                                 |    2 +-
+ net/smc/smc_ib.c                                   |   18 +-
+ net/smc/smc_ism.c                                  |  233 +-
+ net/smc/smc_ism.h                                  |   36 +-
+ net/smc/smc_loopback.c                             |  425 ----
+ net/smc/smc_loopback.h                             |   60 -
+ net/smc/smc_pnet.c                                 |   70 +-
+ net/smc/smc_tx.c                                   |    3 +
+ net/tipc/socket.c                                  |    6 +-
+ net/tls/tls.h                                      |    3 +-
+ net/tls/tls_device.c                               |   20 +-
+ net/tls/tls_proc.c                                 |   10 +-
+ net/unix/garbage.c                                 |    2 +-
+ net/vmw_vsock/af_vsock.c                           |    9 +-
+ net/vmw_vsock/virtio_transport.c                   |    2 +-
+ net/vmw_vsock/vsock_loopback.c                     |    2 +-
+ net/wireless/chan.c                                |  103 +-
+ net/wireless/core.c                                |    9 +
+ net/wireless/ethtool.c                             |    2 +-
+ net/wireless/nl80211.c                             |  805 ++++++-
+ net/wireless/reg.c                                 |   74 +-
+ net/wireless/scan.c                                |    9 +-
+ net/wireless/trace.h                               |   91 +-
+ net/wireless/util.c                                |   31 +-
+ net/xdp/xsk.c                                      |  113 +-
+ net/xfrm/xfrm_policy.c                             |   16 +-
+ net/xfrm/xfrm_proc.c                               |   12 +-
+ net/xfrm/xfrm_user.c                               |   10 +-
+ rust/kernel/net/phy.rs                             |    7 +-
+ scripts/coccinelle/misc/ptr_err_to_pe.cocci        |   34 +
+ scripts/headers_install.sh                         |    2 +-
+ tools/net/ynl/Makefile.deps                        |    1 +
+ tools/net/ynl/lib/ynl-priv.h                       |   10 +-
+ tools/net/ynl/lib/ynl.c                            |    6 +-
+ tools/net/ynl/pyynl/ethtool.py                     |   14 +-
+ tools/net/ynl/pyynl/lib/__init__.py                |    2 +-
+ tools/net/ynl/pyynl/lib/doc_generator.py           |    4 +
+ tools/net/ynl/pyynl/lib/nlspec.py                  |    2 +-
+ tools/net/ynl/pyynl/lib/ynl.py                     |   45 +-
+ tools/net/ynl/pyynl/ynl_gen_c.py                   |  135 +-
+ tools/testing/selftests/Makefile                   |    2 +-
+ tools/testing/selftests/bpf/bpf_kfuncs.h           |    3 +
+ tools/testing/selftests/bpf/config                 |    1 +
+ tools/testing/selftests/bpf/prog_tests/dynptr.c    |    2 +
+ .../bpf/prog_tests/xdp_context_test_run.c          |  226 +-
+ .../selftests/bpf/prog_tests/xdp_pull_data.c       |  179 ++
+ tools/testing/selftests/bpf/progs/bpf_iter_udp4.c  |    3 +-
+ tools/testing/selftests/bpf/progs/bpf_iter_udp6.c  |    4 +-
+ tools/testing/selftests/bpf/progs/dynptr_fail.c    |  258 +++
+ tools/testing/selftests/bpf/progs/dynptr_success.c |   55 +
+ tools/testing/selftests/bpf/progs/mptcp_subflow.c  |    2 +-
+ tools/testing/selftests/bpf/progs/test_xdp_meta.c  |  419 ++++
+ .../selftests/bpf/progs/test_xdp_pull_data.c       |   48 +
+ .../testing/selftests/drivers/net/bonding/Makefile |    3 +-
+ .../drivers/net/bonding/bond_lacp_prio.sh          |  108 +
+ tools/testing/selftests/drivers/net/config         |    4 +-
+ tools/testing/selftests/drivers/net/hds.py         |   39 +
+ tools/testing/selftests/drivers/net/hw/Makefile    |    2 +
+ tools/testing/selftests/drivers/net/hw/config      |    2 +
+ tools/testing/selftests/drivers/net/hw/devmem.py   |   14 +-
+ tools/testing/selftests/drivers/net/hw/ncdevmem.c  |  866 ++++++--
+ .../selftests/drivers/net/hw/nic_timestamp.py      |  113 +
+ tools/testing/selftests/drivers/net/hw/rss_ctx.py  |   18 +-
+ .../selftests/drivers/net/hw/rss_flow_label.py     |  167 ++
+ tools/testing/selftests/drivers/net/hw/tso.py      |   11 +-
+ .../selftests/drivers/net/lib/py/__init__.py       |    2 +-
+ tools/testing/selftests/drivers/net/lib/py/env.py  |   41 +-
+ .../selftests/drivers/net/lib/sh/lib_netcons.sh    |   10 +-
+ .../drivers/net/mlxsw/devlink_trap_policer.sh      |    9 +-
+ .../selftests/drivers/net/mlxsw/qos_ets_strict.sh  |   12 +-
+ .../drivers/net/mlxsw/qos_max_descriptors.sh       |    9 +-
+ .../selftests/drivers/net/mlxsw/qos_mc_aware.sh    |   12 +-
+ .../selftests/drivers/net/mlxsw/sch_red_core.sh    |    6 +-
+ .../testing/selftests/drivers/net/napi_threaded.py |   34 +-
+ .../selftests/drivers/net/netcons_cmdline.sh       |   51 +-
+ tools/testing/selftests/drivers/net/stats.py       |   35 +-
+ tools/testing/selftests/drivers/net/team/Makefile  |    6 +-
+ tools/testing/selftests/drivers/net/team/config    |    1 +
+ .../testing/selftests/drivers/net/team/options.sh  |  188 ++
+ tools/testing/selftests/drivers/net/xdp.py         |   91 +-
+ tools/testing/selftests/net/.gitignore             |    1 +
+ tools/testing/selftests/net/Makefile               |   11 +-
+ tools/testing/selftests/net/af_unix/Makefile       |    2 +-
+ tools/testing/selftests/net/af_unix/scm_inq.c      |   26 +-
+ tools/testing/selftests/net/af_unix/scm_pidfd.c    |    2 -
+ tools/testing/selftests/net/af_unix/scm_rights.c   |   28 +-
+ tools/testing/selftests/net/bpf_offload.py         |    4 +-
+ tools/testing/selftests/net/cmsg_sender.c          |   10 +-
+ tools/testing/selftests/net/config                 |    1 +
+ tools/testing/selftests/net/fcnal-ipv4.sh          |    2 +
+ tools/testing/selftests/net/fcnal-ipv6.sh          |    2 +
+ tools/testing/selftests/net/fcnal-other.sh         |    2 +
+ tools/testing/selftests/net/fcnal-test.sh          |  435 ++--
+ tools/testing/selftests/net/fdb_notify.sh          |   26 +-
+ tools/testing/selftests/net/forwarding/Makefile    |    5 +-
+ tools/testing/selftests/net/forwarding/README      |   15 +
+ .../net/forwarding/bridge_activity_notify.sh       |  170 ++
+ .../net/forwarding/bridge_fdb_local_vlan_0.sh      |  387 ++++
+ .../net/forwarding/custom_multipath_hash.sh        |    2 +-
+ .../net/forwarding/gre_custom_multipath_hash.sh    |    2 +-
+ .../net/forwarding/ip6_forward_instats_vrf.sh      |    6 +-
+ .../net/forwarding/ip6gre_custom_multipath_hash.sh |    2 +-
+ tools/testing/selftests/net/forwarding/lib.sh      |   50 +-
+ .../net/forwarding/mirror_gre_bridge_1q_lag.sh     |    2 +-
+ .../net/forwarding/mirror_gre_vlan_bridge_1q.sh    |    4 +-
+ .../selftests/net/forwarding/sch_ets_core.sh       |    9 +-
+ tools/testing/selftests/net/forwarding/sch_red.sh  |   12 +-
+ .../selftests/net/forwarding/sch_tbf_core.sh       |    6 +-
+ .../net/forwarding/vxlan_bridge_1q_mc_ul.sh        |  141 +-
+ .../selftests/net/forwarding/vxlan_reserved.sh     |   33 +-
+ tools/testing/selftests/net/gro.c                  |   58 +-
+ tools/testing/selftests/net/gro.sh                 |    2 +-
+ tools/testing/selftests/net/ipv6_fragmentation.c   |  114 +
+ tools/testing/selftests/net/lib.sh                 |   72 +-
+ tools/testing/selftests/net/lib/py/utils.py        |   45 +-
+ tools/testing/selftests/net/lib/sh/defer.sh        |   20 +-
+ tools/testing/selftests/net/lib/xdp_native.bpf.c   |   98 +-
+ tools/testing/selftests/net/mptcp/mptcp_inq.c      |    9 +-
+ tools/testing/selftests/net/mptcp/mptcp_join.sh    |  159 +-
+ tools/testing/selftests/net/mptcp/mptcp_sockopt.c  |    9 +-
+ tools/testing/selftests/net/mptcp/pm_nl_ctl.c      |    9 +-
+ tools/testing/selftests/net/mptcp/userspace_pm.sh  |    2 +-
+ tools/testing/selftests/net/netfilter/config       |    1 +
+ .../selftests/net/netfilter/nft_concat_range.sh    |   56 +-
+ tools/testing/selftests/net/netfilter/nft_nat.sh   |    4 +-
+ tools/testing/selftests/net/netlink-dumps.c        |   43 +-
+ .../testing/selftests/net/openvswitch/ovs-dpctl.py |    2 +-
+ .../selftests/net/packetdrill/ksft_runner.sh       |   47 +-
+ .../selftests/net/packetdrill/tcp_close_no_rst.pkt |   32 +
+ tools/testing/selftests/net/pmtu.sh                |    9 +-
+ tools/testing/selftests/net/psock_tpacket.c        |    4 +-
+ tools/testing/selftests/net/route_hint.sh          |   79 +
+ tools/testing/selftests/net/rps_default_mask.sh    |   12 +-
+ tools/testing/selftests/net/rtnetlink.sh           |   15 +-
+ tools/testing/selftests/net/socket.c               |   11 +-
+ tools/testing/selftests/net/tcp_port_share.c       |  258 +++
+ .../selftests/net/test_bridge_backup_port.sh       |   31 +-
+ .../selftests/net/test_vxlan_fdb_changelink.sh     |    8 +-
+ tools/testing/selftests/net/tfo_passive.sh         |    2 +-
+ tools/testing/selftests/net/tls.c                  |    5 +
+ tools/testing/selftests/net/traceroute.sh          |  250 ++-
+ tools/testing/selftests/net/vlan_bridge_binding.sh |   44 +-
+ tools/testing/selftests/net/ynl.mk                 |    5 +-
+ .../tc-testing/tc-tests/actions/police.json        |    2 +-
+ .../testing/selftests/wireguard/qemu/kernel.config |    7 +-
+ tools/testing/vsock/util.c                         |    1 -
+ 1445 files changed, 75571 insertions(+), 25264 deletions(-)
+ create mode 100644 Documentation/ABI/testing/sysfs-driver-framer-pef2256
+ create mode 100644 Documentation/devicetree/bindings/net/apm,xgene-enet.yaml
+ create mode 100644 Documentation/devicetree/bindings/net/apm,xgene-mdio-rgmii.yaml
+ delete mode 100644 Documentation/devicetree/bindings/net/apm-xgene-enet.txt
+ delete mode 100644 Documentation/devicetree/bindings/net/apm-xgene-mdio.txt
+ delete mode 100644 Documentation/devicetree/bindings/net/brcm,bcm7445-switch-v4.0.txt
+ create mode 100644 Documentation/devicetree/bindings/net/pse-pd/skyworks,si3474.yaml
+ create mode 100644 Documentation/devicetree/bindings/net/qcom,ipq9574-ppe.yaml
+ create mode 100644 Documentation/devicetree/bindings/net/spacemit,k1-emac.yaml
+ create mode 100644 Documentation/devicetree/bindings/net/ti,icssm-prueth.yaml
+ create mode 100644 Documentation/devicetree/bindings/net/ti,pruss-ecap.yaml
+ create mode 100644 Documentation/devicetree/bindings/ptp/nxp,ptp-netc.yaml
+ create mode 100644 Documentation/netlink/specs/psp.yaml
+ create mode 100644 Documentation/networking/device_drivers/ethernet/qualcomm/ppe/ppe.rst
+ create mode 100644 Documentation/networking/psp.rst
+ create mode 100644 drivers/dibs/Kconfig
+ create mode 100644 drivers/dibs/Makefile
+ create mode 100644 drivers/dibs/dibs_loopback.c
+ create mode 100644 drivers/dibs/dibs_loopback.h
+ create mode 100644 drivers/dibs/dibs_main.c
+ create mode 100644 drivers/dpll/zl3073x/flash.c
+ create mode 100644 drivers/dpll/zl3073x/flash.h
+ create mode 100644 drivers/dpll/zl3073x/fw.c
+ create mode 100644 drivers/dpll/zl3073x/fw.h
+ delete mode 100644 drivers/net/dsa/dsa_loop.h
+ delete mode 100644 drivers/net/dsa/dsa_loop_bdinfo.c
+ rename drivers/net/{phy/spi_ks8995.c => dsa/ks8995.c} (50%)
+ create mode 100644 drivers/net/dsa/lantiq/Kconfig
+ create mode 100644 drivers/net/dsa/lantiq/Makefile
+ rename drivers/net/dsa/{ => lantiq}/lantiq_gswip.c (80%)
+ create mode 100644 drivers/net/dsa/lantiq/lantiq_gswip.h
+ rename drivers/net/dsa/{ => lantiq}/lantiq_pce.h (98%)
+ delete mode 100644 drivers/net/ethernet/airoha/airoha_npu.h
+ create mode 100644 drivers/net/ethernet/amd/xgbe/xgbe-pps.c
+ create mode 100644 drivers/net/ethernet/broadcom/bnge/bnge_db.h
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_cmdq.c
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_cmdq.h
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_csr.h
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_eqs.c
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_eqs.h
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_mgmt.c
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_pci_id_tbl.h
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_rss.c
+ create mode 100644 drivers/net/ethernet/huawei/hinic3/hinic3_rss.h
+ delete mode 100644 drivers/net/ethernet/intel/ice/ice_fwlog.c
+ delete mode 100644 drivers/net/ethernet/intel/ice/ice_fwlog.h
+ rename drivers/net/ethernet/intel/ice/{ice_virtchnl_allowlist.c => virt/allowlist.c} (99%)
+ rename drivers/net/ethernet/intel/ice/{ice_virtchnl_allowlist.h => virt/allowlist.h} (100%)
+ rename drivers/net/ethernet/intel/ice/{ice_virtchnl_fdir.c => virt/fdir.c} (100%)
+ rename drivers/net/ethernet/intel/ice/{ice_virtchnl_fdir.h => virt/fdir.h} (100%)
+ create mode 100644 drivers/net/ethernet/intel/ice/virt/queues.c
+ create mode 100644 drivers/net/ethernet/intel/ice/virt/queues.h
+ create mode 100644 drivers/net/ethernet/intel/ice/virt/rss.c
+ create mode 100644 drivers/net/ethernet/intel/ice/virt/rss.h
+ rename drivers/net/ethernet/intel/ice/{ice_virtchnl.c => virt/virtchnl.c} (62%)
+ rename drivers/net/ethernet/intel/ice/{ice_virtchnl.h => virt/virtchnl.h} (100%)
+ create mode 100644 drivers/net/ethernet/intel/idpf/xdp.c
+ create mode 100644 drivers/net/ethernet/intel/idpf/xdp.h
+ create mode 100644 drivers/net/ethernet/intel/idpf/xsk.c
+ create mode 100644 drivers/net/ethernet/intel/idpf/xsk.h
+ create mode 100644 drivers/net/ethernet/intel/libie/fwlog.c
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/en_accel/psp.c
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/en_accel/psp.h
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/en_accel/psp_rxtx.c
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/en_accel/psp_rxtx.h
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/esw/adj_vport.c
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/lib/nv_param.c
+ create mode 100644 drivers/net/ethernet/mellanox/mlx5/core/lib/nv_param.h
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/Makefile
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe.c
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe.h
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe_config.c
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe_config.h
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe_debugfs.c
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe_debugfs.h
+ create mode 100644 drivers/net/ethernet/qualcomm/ppe/ppe_regs.h
+ create mode 100644 drivers/net/ethernet/renesas/rswitch_l2.c
+ create mode 100644 drivers/net/ethernet/renesas/rswitch_l2.h
+ rename drivers/net/ethernet/renesas/{rswitch.c => rswitch_main.c} (95%)
+ create mode 100644 drivers/net/ethernet/spacemit/Kconfig
+ create mode 100644 drivers/net/ethernet/spacemit/Makefile
+ create mode 100644 drivers/net/ethernet/spacemit/k1_emac.c
+ create mode 100644 drivers/net/ethernet/spacemit/k1_emac.h
+ create mode 100644 drivers/net/ethernet/ti/icssm/icssm_prueth.c
+ create mode 100644 drivers/net/ethernet/ti/icssm/icssm_prueth.h
+ create mode 100644 drivers/net/ethernet/ti/icssm/icssm_prueth_ptp.h
+ create mode 100644 drivers/net/ethernet/ti/icssm/icssm_switch.h
+ delete mode 100644 drivers/net/phy/mdio-boardinfo.c
+ delete mode 100644 drivers/net/phy/mdio-boardinfo.h
+ create mode 100644 drivers/net/pse-pd/si3474.c
+ delete mode 100644 drivers/net/wireless/intel/iwlwifi/mvm/tests/links.c
+ create mode 100644 drivers/net/wireless/intel/iwlwifi/tests/nvm_parse.c
+ create mode 100644 drivers/ptp/ptp_netc.c
+ delete mode 100644 drivers/ptp/ptp_qoriq_debugfs.c
+ create mode 100644 include/dt-bindings/net/renesas,r9a09g077-pcs-miic.h
+ create mode 100644 include/linux/dibs.h
+ create mode 100644 include/linux/net/intel/libie/fwlog.h
+ create mode 100644 include/linux/soc/airoha/airoha_offload.h
+ create mode 100644 include/net/psp.h
+ create mode 100644 include/net/psp/functions.h
+ create mode 100644 include/net/psp/types.h
+ create mode 100644 include/net/tcp_ecn.h
+ create mode 100644 include/uapi/linux/psp.h
+ delete mode 100644 net/batman-adv/network-coding.c
+ delete mode 100644 net/batman-adv/network-coding.h
+ create mode 100644 net/core/netdev_queues.c
+ create mode 100644 net/mac80211/tests/s1g_tim.c
+ create mode 100644 net/psp/Kconfig
+ create mode 100644 net/psp/Makefile
+ create mode 100644 net/psp/psp-nl-gen.c
+ create mode 100644 net/psp/psp-nl-gen.h
+ create mode 100644 net/psp/psp.h
+ create mode 100644 net/psp/psp_main.c
+ create mode 100644 net/psp/psp_nl.c
+ create mode 100644 net/psp/psp_sock.c
+ delete mode 100644 net/smc/smc_loopback.c
+ delete mode 100644 net/smc/smc_loopback.h
+ create mode 100644 scripts/coccinelle/misc/ptr_err_to_pe.cocci
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/xdp_pull_data.c
+ create mode 100644 tools/testing/selftests/bpf/progs/test_xdp_pull_data.c
+ create mode 100755 tools/testing/selftests/drivers/net/bonding/bond_lacp_prio.sh
+ create mode 100755 tools/testing/selftests/drivers/net/hw/nic_timestamp.py
+ create mode 100755 tools/testing/selftests/drivers/net/hw/rss_flow_label.py
+ create mode 100755 tools/testing/selftests/drivers/net/team/options.sh
+ create mode 100755 tools/testing/selftests/net/fcnal-ipv4.sh
+ create mode 100755 tools/testing/selftests/net/fcnal-ipv6.sh
+ create mode 100755 tools/testing/selftests/net/fcnal-other.sh
+ create mode 100755 tools/testing/selftests/net/forwarding/bridge_activity_notify.sh
+ create mode 100755 tools/testing/selftests/net/forwarding/bridge_fdb_local_vlan_0.sh
+ create mode 100644 tools/testing/selftests/net/ipv6_fragmentation.c
+ create mode 100644 tools/testing/selftests/net/packetdrill/tcp_close_no_rst.pkt
+ create mode 100755 tools/testing/selftests/net/route_hint.sh
+ create mode 100644 tools/testing/selftests/net/tcp_port_share.c
+Merging bpf-next/for-next (95524d1a6bd69 Merge branch 'bpf-next/master' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf-next.git bpf-next/for-next
+Auto-merging MAINTAINERS
+Auto-merging arch/riscv/Kconfig
+Auto-merging arch/riscv/include/asm/cmpxchg.h
+Auto-merging include/linux/cgroup.h
+Auto-merging kernel/cgroup/cgroup.c
+Auto-merging kernel/events/uprobes.c
+Auto-merging kernel/trace/bpf_trace.c
+Auto-merging net/core/filter.c
+Auto-merging tools/testing/selftests/bpf/bpf_experimental.h
+Merge made by the 'ort' strategy.
+ CREDITS                                            |   6 +
+ Documentation/bpf/kfuncs.rst                       |  19 +-
+ Documentation/bpf/verifier.rst                     | 264 -------
+ MAINTAINERS                                        |   2 -
+ arch/arm64/net/Makefile                            |   2 +-
+ arch/arm64/net/bpf_jit_comp.c                      | 127 +++-
+ arch/arm64/net/bpf_timed_may_goto.S                |  40 +
+ arch/riscv/Kconfig                                 |   1 -
+ arch/riscv/include/asm/cmpxchg.h                   |   6 +-
+ arch/riscv/kernel/setup.c                          |   1 +
+ arch/riscv/net/bpf_jit.h                           |  70 +-
+ arch/riscv/net/bpf_jit_comp64.c                    | 613 ++++++---------
+ arch/s390/net/Makefile                             |   2 +-
+ arch/s390/net/bpf_jit_comp.c                       | 148 ++--
+ arch/s390/net/bpf_timed_may_goto.S                 |  45 ++
+ arch/x86/net/bpf_jit_comp.c                        | 125 ++-
+ crypto/asymmetric_keys/pkcs7_verify.c              |   1 +
+ include/linux/bpf.h                                |  66 +-
+ include/linux/bpf_verifier.h                       |  65 +-
+ include/linux/btf.h                                |   2 +-
+ include/linux/cgroup.h                             |   1 +
+ include/linux/filter.h                             |  11 +-
+ include/linux/rcupdate.h                           |  14 +
+ include/linux/tnum.h                               |   6 +
+ include/linux/verification.h                       |   1 +
+ include/uapi/linux/bpf.h                           |  22 +
+ kernel/bpf/Kconfig                                 |   2 +-
+ kernel/bpf/Makefile                                |   2 +-
+ kernel/bpf/arena.c                                 |  30 +
+ kernel/bpf/arraymap.c                              |  21 +-
+ kernel/bpf/bpf_cgrp_storage.c                      |   6 +-
+ kernel/bpf/bpf_inode_storage.c                     |   6 +-
+ kernel/bpf/bpf_iter.c                              |   6 +-
+ kernel/bpf/bpf_lru_list.c                          |  10 +-
+ kernel/bpf/bpf_struct_ops.c                        |  12 +
+ kernel/bpf/bpf_task_storage.c                      |   6 +-
+ kernel/bpf/btf.c                                   |  95 +--
+ kernel/bpf/cgroup.c                                |  11 +-
+ kernel/bpf/core.c                                  |  60 +-
+ kernel/bpf/cpumap.c                                |   2 +-
+ kernel/bpf/devmap.c                                |   2 +-
+ kernel/bpf/hashtab.c                               |  43 +-
+ kernel/bpf/helpers.c                               | 603 +++++++++++++--
+ kernel/bpf/liveness.c                              | 733 ++++++++++++++++++
+ kernel/bpf/local_storage.c                         |   2 +-
+ kernel/bpf/log.c                                   |  28 +-
+ kernel/bpf/memalloc.c                              |   2 +-
+ kernel/bpf/stackmap.c                              |  16 +-
+ kernel/bpf/syscall.c                               | 125 ++-
+ kernel/bpf/tnum.c                                  |  63 +-
+ kernel/bpf/trampoline.c                            |  18 +-
+ kernel/bpf/verifier.c                              | 841 +++++++++------------
+ kernel/cgroup/cgroup.c                             |  24 +-
+ kernel/events/core.c                               |   4 +
+ kernel/events/uprobes.c                            |   7 +
+ kernel/trace/bpf_trace.c                           | 201 +----
+ net/bpf/test_run.c                                 |  22 +-
+ net/core/filter.c                                  |  18 +-
+ tools/bpf/bpftool/Documentation/bpftool-gen.rst    |  13 +-
+ tools/bpf/bpftool/Documentation/bpftool-prog.rst   |  14 +-
+ tools/bpf/bpftool/Documentation/bpftool-token.rst  |  64 ++
+ tools/bpf/bpftool/Makefile                         |   6 +-
+ tools/bpf/bpftool/bash-completion/bpftool          |  37 +-
+ tools/bpf/bpftool/btf_dumper.c                     |   2 +-
+ tools/bpf/bpftool/cgroup.c                         |   4 +
+ tools/bpf/bpftool/common.c                         |  93 +++
+ tools/bpf/bpftool/feature.c                        |  86 +--
+ tools/bpf/bpftool/gen.c                            |  68 +-
+ tools/bpf/bpftool/link.c                           |  54 +-
+ tools/bpf/bpftool/main.c                           |  29 +-
+ tools/bpf/bpftool/main.h                           |  21 +
+ tools/bpf/bpftool/prog.c                           |  33 +-
+ tools/bpf/bpftool/sign.c                           | 211 ++++++
+ tools/bpf/bpftool/token.c                          | 210 +++++
+ tools/bpf/bpftool/tracelog.c                       |  11 +-
+ tools/include/uapi/linux/bpf.h                     |  22 +
+ tools/lib/bpf/bpf.c                                |   6 +-
+ tools/lib/bpf/bpf.h                                |   5 +-
+ tools/lib/bpf/bpf_gen_internal.h                   |   2 +
+ tools/lib/bpf/gen_loader.c                         |  47 ++
+ tools/lib/bpf/libbpf.c                             | 213 +++++-
+ tools/lib/bpf/libbpf.h                             |  52 +-
+ tools/lib/bpf/libbpf.map                           |   3 +
+ tools/lib/bpf/libbpf_internal.h                    |   4 +
+ tools/lib/bpf/skel_internal.h                      |  76 +-
+ tools/lib/bpf/usdt.bpf.h                           |  44 +-
+ tools/lib/bpf/usdt.c                               |  72 +-
+ tools/testing/selftests/bpf/.gitignore             |   1 +
+ tools/testing/selftests/bpf/DENYLIST.s390x         |   1 -
+ tools/testing/selftests/bpf/Makefile               |  43 +-
+ tools/testing/selftests/bpf/bench.c                |  22 +-
+ tools/testing/selftests/bpf/bench.h                |   1 +
+ .../selftests/bpf/benchs/bench_lpm_trie_map.c      | 555 ++++++++++++++
+ tools/testing/selftests/bpf/benchs/bench_sockmap.c |   5 +-
+ tools/testing/selftests/bpf/benchs/bench_trigger.c |  61 ++
+ .../selftests/bpf/benchs/run_bench_trigger.sh      |   4 +-
+ tools/testing/selftests/bpf/bpf_experimental.h     |  54 ++
+ tools/testing/selftests/bpf/bpf_util.h             |   3 +
+ tools/testing/selftests/bpf/cgroup_helpers.c       |  20 +
+ tools/testing/selftests/bpf/cgroup_helpers.h       |   1 +
+ tools/testing/selftests/bpf/config.aarch64         |  12 -
+ tools/testing/selftests/bpf/config.ppc64el         |   1 -
+ tools/testing/selftests/bpf/config.riscv64         |   1 -
+ tools/testing/selftests/bpf/config.s390x           |  11 -
+ tools/testing/selftests/bpf/config.x86_64          |   5 -
+ tools/testing/selftests/bpf/network_helpers.c      |   2 +-
+ tools/testing/selftests/bpf/prog_tests/align.c     | 178 ++---
+ .../selftests/bpf/prog_tests/arena_spin_lock.c     |  13 +
+ tools/testing/selftests/bpf/prog_tests/atomics.c   |  10 +-
+ .../selftests/bpf/prog_tests/attach_probe.c        |  28 +
+ .../testing/selftests/bpf/prog_tests/bpf_cookie.c  |   3 +-
+ tools/testing/selftests/bpf/prog_tests/btf_dump.c  |   2 +-
+ .../selftests/bpf/prog_tests/cgroup_xattr.c        |   2 +-
+ .../testing/selftests/bpf/prog_tests/cgrp_kfunc.c  |  71 ++
+ tools/testing/selftests/bpf/prog_tests/fd_array.c  |   2 +-
+ .../selftests/bpf/prog_tests/fentry_fexit.c        |  15 +-
+ .../testing/selftests/bpf/prog_tests/fentry_test.c |   9 +-
+ .../testing/selftests/bpf/prog_tests/fexit_test.c  |   9 +-
+ .../testing/selftests/bpf/prog_tests/kernel_flag.c |   2 +-
+ .../selftests/bpf/prog_tests/kprobe_multi_test.c   | 247 +-----
+ tools/testing/selftests/bpf/prog_tests/map_excl.c  |  54 ++
+ .../selftests/bpf/prog_tests/module_attach.c       |   2 +-
+ .../bpf/prog_tests/pinning_devmap_reuse.c          |  50 ++
+ .../bpf/prog_tests/prog_tests_framework.c          | 125 +++
+ .../testing/selftests/bpf/prog_tests/reg_bounds.c  |   4 +-
+ .../selftests/bpf/prog_tests/res_spin_lock.c       |  16 +
+ tools/testing/selftests/bpf/prog_tests/spin_lock.c |  12 +-
+ .../selftests/bpf/prog_tests/stacktrace_build_id.c |   2 +-
+ .../bpf/prog_tests/stacktrace_build_id_nmi.c       |   2 +-
+ .../selftests/bpf/prog_tests/stacktrace_map.c      |  69 +-
+ .../bpf/prog_tests/stacktrace_map_raw_tp.c         |   4 +-
+ .../selftests/bpf/prog_tests/stacktrace_map_skip.c |   2 +-
+ tools/testing/selftests/bpf/prog_tests/stream.c    | 131 ++--
+ .../selftests/bpf/prog_tests/string_kfuncs.c       |   1 +
+ .../selftests/bpf/prog_tests/task_local_data.h     | 386 ++++++++++
+ .../selftests/bpf/prog_tests/task_work_stress.c    | 130 ++++
+ .../prog_tests/test_struct_ops_id_ops_mapping.c    |  74 ++
+ .../bpf/prog_tests/test_task_local_data.c          | 297 ++++++++
+ .../selftests/bpf/prog_tests/test_task_work.c      | 157 ++++
+ .../selftests/bpf/prog_tests/test_veristat.c       |  44 +-
+ tools/testing/selftests/bpf/prog_tests/timer.c     |  34 +
+ .../selftests/bpf/prog_tests/tracing_struct.c      |  29 +
+ tools/testing/selftests/bpf/prog_tests/uprobe.c    | 156 +++-
+ tools/testing/selftests/bpf/prog_tests/usdt.c      |  83 +-
+ tools/testing/selftests/bpf/prog_tests/verifier.c  |   4 +
+ .../selftests/bpf/prog_tests/xdp_devmap_attach.c   |  31 +-
+ tools/testing/selftests/bpf/progs/arena_atomics.c  |   9 +-
+ .../testing/selftests/bpf/progs/arena_spin_lock.c  |   5 +-
+ tools/testing/selftests/bpf/progs/bpf_cc_cubic.c   |   2 +-
+ tools/testing/selftests/bpf/progs/bpf_dctcp.c      |   2 +-
+ tools/testing/selftests/bpf/progs/bpf_misc.h       |  24 +
+ tools/testing/selftests/bpf/progs/bpf_test_utils.h |  18 +
+ .../selftests/bpf/progs/cgroup_read_xattr.c        |   2 +-
+ .../selftests/bpf/progs/cgrp_kfunc_success.c       |  12 +
+ .../selftests/bpf/progs/exceptions_assert.c        |  34 +-
+ .../selftests/bpf/progs/freplace_connect_v4_prog.c |   2 +-
+ .../selftests/bpf/progs/iters_state_safety.c       |   6 +-
+ .../selftests/bpf/progs/iters_task_failure.c       |   4 +-
+ tools/testing/selftests/bpf/progs/iters_testmod.c  |  46 ++
+ .../selftests/bpf/progs/iters_testmod_seq.c        |   6 +-
+ .../testing/selftests/bpf/progs/kprobe_write_ctx.c |  22 +
+ tools/testing/selftests/bpf/progs/loop1.c          |   7 +-
+ tools/testing/selftests/bpf/progs/loop2.c          |   7 +-
+ tools/testing/selftests/bpf/progs/loop3.c          |   7 +-
+ tools/testing/selftests/bpf/progs/loop6.c          |  21 +-
+ tools/testing/selftests/bpf/progs/lpm_trie.h       |  30 +
+ tools/testing/selftests/bpf/progs/lpm_trie_bench.c | 230 ++++++
+ tools/testing/selftests/bpf/progs/lpm_trie_map.c   |  19 +
+ tools/testing/selftests/bpf/progs/map_excl.c       |  34 +
+ .../selftests/bpf/progs/mem_rdonly_untrusted.c     |   4 +-
+ tools/testing/selftests/bpf/progs/rbtree_search.c  |   2 +-
+ .../{test_stacktrace_map.c => stacktrace_map.c}    |   2 +
+ tools/testing/selftests/bpf/progs/stream.c         | 158 ++++
+ .../selftests/bpf/progs/string_kfuncs_failure1.c   |   6 +
+ .../selftests/bpf/progs/string_kfuncs_failure2.c   |   1 +
+ .../selftests/bpf/progs/string_kfuncs_success.c    |   5 +
+ .../bpf/progs/struct_ops_id_ops_mapping1.c         |  59 ++
+ .../bpf/progs/struct_ops_id_ops_mapping2.c         |  59 ++
+ .../selftests/bpf/progs/struct_ops_kptr_return.c   |   2 +-
+ .../selftests/bpf/progs/struct_ops_refcounted.c    |   2 +-
+ .../bpf/progs/tailcall_bpf2bpf_hierarchy1.c        |   3 +
+ .../bpf/progs/tailcall_bpf2bpf_hierarchy2.c        |   3 +
+ .../bpf/progs/tailcall_bpf2bpf_hierarchy3.c        |   3 +
+ .../bpf/progs/tailcall_bpf2bpf_hierarchy_fentry.c  |   3 +
+ .../selftests/bpf/progs/task_local_data.bpf.h      | 237 ++++++
+ tools/testing/selftests/bpf/progs/task_work.c      | 107 +++
+ tools/testing/selftests/bpf/progs/task_work_fail.c |  96 +++
+ .../testing/selftests/bpf/progs/task_work_stress.c |  73 ++
+ .../selftests/bpf/progs/test_cls_redirect.c        |   6 +-
+ .../selftests/bpf/progs/test_cls_redirect_dynptr.c |   2 +-
+ tools/testing/selftests/bpf/progs/test_overhead.c  |   5 +-
+ .../selftests/bpf/progs/test_pinning_devmap.c      |  20 +
+ .../selftests/bpf/progs/test_task_local_data.c     |  65 ++
+ .../selftests/bpf/progs/test_tcp_hdr_options.c     |   5 +-
+ .../selftests/bpf/progs/test_tcpnotify_kern.c      |   1 -
+ tools/testing/selftests/bpf/progs/test_uprobe.c    |  38 +
+ tools/testing/selftests/bpf/progs/test_usdt.c      |  31 +
+ .../selftests/bpf/progs/test_xdp_devmap_tailcall.c |  29 +
+ .../testing/selftests/bpf/progs/timer_interrupt.c  |  48 ++
+ tools/testing/selftests/bpf/progs/tracing_struct.c |  33 +
+ tools/testing/selftests/bpf/progs/trigger_bench.c  |  12 +
+ .../testing/selftests/bpf/progs/uretprobe_stack.c  |   4 +-
+ .../selftests/bpf/progs/verifier_arena_large.c     |   1 +
+ .../testing/selftests/bpf/progs/verifier_bounds.c  |  79 +-
+ .../selftests/bpf/progs/verifier_bpf_fastcall.c    |  27 +-
+ tools/testing/selftests/bpf/progs/verifier_ctx.c   |  32 +-
+ .../selftests/bpf/progs/verifier_global_ptr_args.c |   4 +-
+ tools/testing/selftests/bpf/progs/verifier_ldsx.c  | 178 ++++-
+ .../selftests/bpf/progs/verifier_live_stack.c      | 294 +++++++
+ .../testing/selftests/bpf/progs/verifier_loops1.c  |  21 +
+ .../testing/selftests/bpf/progs/verifier_map_ptr.c |   7 +-
+ .../selftests/bpf/progs/verifier_may_goto_1.c      |  38 +-
+ tools/testing/selftests/bpf/progs/verifier_mul.c   |  38 +
+ .../selftests/bpf/progs/verifier_precision.c       |  16 +-
+ .../selftests/bpf/progs/verifier_scalar_ids.c      |  12 +-
+ tools/testing/selftests/bpf/progs/verifier_sock.c  |  48 +-
+ .../selftests/bpf/progs/verifier_spill_fill.c      |  40 +-
+ .../bpf/progs/verifier_subprog_precision.c         |   6 +-
+ .../testing/selftests/bpf/progs/verifier_var_off.c |   6 +-
+ tools/testing/selftests/bpf/test_kmods/Makefile    |   2 +-
+ .../selftests/bpf/test_kmods/bpf_test_rqspinlock.c | 209 +++++
+ .../testing/selftests/bpf/test_kmods/bpf_testmod.c | 155 ++++
+ .../testing/selftests/bpf/test_kmods/bpf_testmod.h |   6 +
+ .../selftests/bpf/test_kmods/bpf_testmod_kfunc.h   |   4 +
+ tools/testing/selftests/bpf/test_lirc_mode2_user.c |   2 +-
+ tools/testing/selftests/bpf/test_loader.c          | 300 ++++++--
+ tools/testing/selftests/bpf/test_progs.c           |  13 +
+ tools/testing/selftests/bpf/test_progs.h           |  17 +
+ tools/testing/selftests/bpf/test_sockmap.c         |   2 +-
+ tools/testing/selftests/bpf/test_tcpnotify_user.c  |  20 +-
+ tools/testing/selftests/bpf/test_xsk.sh            |   2 +
+ tools/testing/selftests/bpf/testing_helpers.c      |  14 +-
+ tools/testing/selftests/bpf/testing_helpers.h      |   1 +
+ tools/testing/selftests/bpf/trace_helpers.c        | 234 ++++++
+ tools/testing/selftests/bpf/trace_helpers.h        |   3 +
+ tools/testing/selftests/bpf/verifier/bpf_st_mem.c  |   4 +-
+ tools/testing/selftests/bpf/verifier/calls.c       |   8 +-
+ tools/testing/selftests/bpf/verify_sig_setup.sh    |  11 +-
+ tools/testing/selftests/bpf/veristat.c             |  56 +-
+ tools/testing/selftests/bpf/xdping.c               |   2 +-
+ tools/testing/selftests/bpf/xsk.h                  |   4 +-
+ tools/testing/selftests/bpf/xskxceiver.c           |  14 +-
+ 242 files changed, 10344 insertions(+), 2735 deletions(-)
+ create mode 100644 arch/arm64/net/bpf_timed_may_goto.S
+ create mode 100644 arch/s390/net/bpf_timed_may_goto.S
+ create mode 100644 kernel/bpf/liveness.c
+ create mode 100644 tools/bpf/bpftool/Documentation/bpftool-token.rst
+ create mode 100644 tools/bpf/bpftool/sign.c
+ create mode 100644 tools/bpf/bpftool/token.c
+ create mode 100644 tools/testing/selftests/bpf/benchs/bench_lpm_trie_map.c
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/map_excl.c
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/pinning_devmap_reuse.c
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/task_local_data.h
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/task_work_stress.c
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/test_struct_ops_id_ops_mapping.c
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/test_task_local_data.c
+ create mode 100644 tools/testing/selftests/bpf/prog_tests/test_task_work.c
+ create mode 100644 tools/testing/selftests/bpf/progs/bpf_test_utils.h
+ create mode 100644 tools/testing/selftests/bpf/progs/kprobe_write_ctx.c
+ create mode 100644 tools/testing/selftests/bpf/progs/lpm_trie.h
+ create mode 100644 tools/testing/selftests/bpf/progs/lpm_trie_bench.c
+ create mode 100644 tools/testing/selftests/bpf/progs/lpm_trie_map.c
+ create mode 100644 tools/testing/selftests/bpf/progs/map_excl.c
+ rename tools/testing/selftests/bpf/progs/{test_stacktrace_map.c => stacktrace_map.c} (98%)
+ create mode 100644 tools/testing/selftests/bpf/progs/struct_ops_id_ops_mapping1.c
+ create mode 100644 tools/testing/selftests/bpf/progs/struct_ops_id_ops_mapping2.c
+ create mode 100644 tools/testing/selftests/bpf/progs/task_local_data.bpf.h
+ create mode 100644 tools/testing/selftests/bpf/progs/task_work.c
+ create mode 100644 tools/testing/selftests/bpf/progs/task_work_fail.c
+ create mode 100644 tools/testing/selftests/bpf/progs/task_work_stress.c
+ create mode 100644 tools/testing/selftests/bpf/progs/test_pinning_devmap.c
+ create mode 100644 tools/testing/selftests/bpf/progs/test_task_local_data.c
+ create mode 100644 tools/testing/selftests/bpf/progs/test_xdp_devmap_tailcall.c
+ create mode 100644 tools/testing/selftests/bpf/progs/timer_interrupt.c
+ create mode 100644 tools/testing/selftests/bpf/progs/verifier_live_stack.c
+ create mode 100644 tools/testing/selftests/bpf/progs/verifier_mul.c
+ create mode 100644 tools/testing/selftests/bpf/test_kmods/bpf_test_rqspinlock.c
+Merging ipsec-next/master (9f4f591cd5a41 xfrm: xfrm_user: use strscpy() for alg_name)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/klassert/ipsec-next.git ipsec-next/master
+Already up to date.
+Merging mlx5-next/mlx5-next (137d1a6355131 net/mlx5: IFC add balance ID and LAG per MP group bits)
+$ git merge -m Merge branch 'mlx5-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mellanox/linux.git mlx5-next/mlx5-next
+Merge made by the 'ort' strategy.
+ include/linux/mlx5/mlx5_ifc.h | 11 ++++++++---
+ 1 file changed, 8 insertions(+), 3 deletions(-)
+Merging netfilter-next/main (1493c18fe8696 Merge branch 'selftests-mark-auto-deferring-functions-clearly')
+$ git merge -m Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/netfilter/nf-next.git netfilter-next/main
+Already up to date.
+Merging ipvs-next/main (12de5f0f6c2d7 Merge branch 'net-gso-restore-outer-ip-ids-correctly')
+$ git merge -m Merge branch 'main' of https://git.kernel.org/pub/scm/linux/kernel/git/horms/ipvs-next.git ipvs-next/main
+Already up to date.
+Merging bluetooth/master (be812ace0378a Bluetooth: Avoid a couple dozen -Wflex-array-member-not-at-end warnings)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/bluetooth/bluetooth-next.git bluetooth/master
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ MAINTAINERS                       |   7 +
+ drivers/bluetooth/bpa10x.c        |   2 +-
+ drivers/bluetooth/btintel.c       |   3 +
+ drivers/bluetooth/btintel_pcie.c  | 326 +++++++++++++++++++++-----------------
+ drivers/bluetooth/btintel_pcie.h  |   2 +
+ drivers/bluetooth/btmtksdio.c     |   2 +-
+ drivers/bluetooth/btmtkuart.c     |   2 +-
+ drivers/bluetooth/btnxpuart.c     |   2 +-
+ drivers/bluetooth/btusb.c         |  23 +++
+ drivers/bluetooth/h4_recv.h       | 153 ------------------
+ drivers/bluetooth/hci_bcsp.c      |   3 +
+ include/net/bluetooth/bluetooth.h |   3 +-
+ include/net/bluetooth/hci.h       |   1 +
+ include/net/bluetooth/hci_core.h  |  11 +-
+ include/net/bluetooth/hci_drv.h   |   2 +-
+ include/net/bluetooth/mgmt.h      |   9 +-
+ net/bluetooth/hci_conn.c          |  27 ++--
+ net/bluetooth/hci_core.c          |  52 ++++--
+ net/bluetooth/hci_event.c         |  16 +-
+ net/bluetooth/hci_sync.c          |  10 +-
+ net/bluetooth/iso.c               |  34 +++-
+ net/bluetooth/mgmt.c              |  10 +-
+ net/bluetooth/mgmt_config.c       |   4 +-
+ net/bluetooth/sco.c               |   7 +
+ 24 files changed, 344 insertions(+), 367 deletions(-)
+ delete mode 100644 drivers/bluetooth/h4_recv.h
+Merging wireless-next/for-next (94aced6ed9e26 Merge tag 'wireless-next-2025-09-25' of https://git.kernel.org/pub/scm/linux/kernel/git/wireless/wireless-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/wireless/wireless-next.git wireless-next/for-next
+Already up to date.
+Merging ath-next/for-next (1e06a137513df wifi: libertas: WQ_PERCPU added to alloc_workqueue users)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ath/ath.git ath-next/for-next
+Already up to date.
+Merging iwlwifi-next/next (08579b1861a8f wifi: iwlwifi: mld: set wiphy::iftype_ext_capab dynamically)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/iwlwifi/iwlwifi-next.git iwlwifi-next/next
+Auto-merging drivers/net/wireless/intel/iwlwifi/fw/runtime.h
+CONFLICT (content): Merge conflict in drivers/net/wireless/intel/iwlwifi/fw/runtime.h
+Auto-merging drivers/net/wireless/intel/iwlwifi/pcie/drv.c
+Resolved 'drivers/net/wireless/intel/iwlwifi/fw/runtime.h' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master aa5ed8d7afebf] Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/iwlwifi/iwlwifi-next.git
+$ git diff -M --stat --summary HEAD^..
+ drivers/net/wireless/intel/iwlwifi/cfg/bz.c        |   1 +
+ drivers/net/wireless/intel/iwlwifi/cfg/rf-wh.c     |   1 +
+ drivers/net/wireless/intel/iwlwifi/fw/acpi.h       |   1 +
+ drivers/net/wireless/intel/iwlwifi/fw/api/alive.h  |   2 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/cmdhdr.h |   4 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/coex.h   |   4 +-
+ .../net/wireless/intel/iwlwifi/fw/api/commands.h   |   2 +-
+ .../net/wireless/intel/iwlwifi/fw/api/dbg-tlv.h    |  14 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/debug.h  |   2 +-
+ .../net/wireless/intel/iwlwifi/fw/api/location.h   |   8 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/power.h  |   5 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/scan.h   |  78 +++++-----
+ drivers/net/wireless/intel/iwlwifi/fw/api/sta.h    |   6 +-
+ drivers/net/wireless/intel/iwlwifi/fw/api/stats.h  |  39 ++---
+ drivers/net/wireless/intel/iwlwifi/fw/api/tx.h     |   2 +-
+ drivers/net/wireless/intel/iwlwifi/fw/error-dump.h |   4 +-
+ drivers/net/wireless/intel/iwlwifi/fw/file.h       |  74 +++++++---
+ drivers/net/wireless/intel/iwlwifi/fw/img.h        |  12 +-
+ drivers/net/wireless/intel/iwlwifi/fw/runtime.h    |  22 ++-
+ drivers/net/wireless/intel/iwlwifi/iwl-config.h    |   3 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-dbg-tlv.h   |   4 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-drv.c       |  18 +--
+ drivers/net/wireless/intel/iwlwifi/iwl-drv.h       |   3 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-modparams.h |   4 +-
+ drivers/net/wireless/intel/iwlwifi/iwl-nvm-parse.h |  17 ++-
+ drivers/net/wireless/intel/iwlwifi/iwl-op-mode.h   |   1 +
+ drivers/net/wireless/intel/iwlwifi/iwl-trans.h     |   6 +-
+ drivers/net/wireless/intel/iwlwifi/mld/constants.h |   2 +
+ drivers/net/wireless/intel/iwlwifi/mld/fw.c        |   8 +-
+ drivers/net/wireless/intel/iwlwifi/mld/mac80211.c  |  97 ++++++++----
+ drivers/net/wireless/intel/iwlwifi/mld/mld.h       |  15 ++
+ drivers/net/wireless/intel/iwlwifi/mld/mlo.c       |   3 +-
+ drivers/net/wireless/intel/iwlwifi/mvm/fw.c        |   2 +-
+ .../net/wireless/intel/iwlwifi/mvm/mld-mac80211.c  |   3 -
+ drivers/net/wireless/intel/iwlwifi/mvm/mvm.h       |   5 +
+ drivers/net/wireless/intel/iwlwifi/mvm/phy-ctxt.c  |  24 +--
+ drivers/net/wireless/intel/iwlwifi/mvm/rs.c        | 164 ---------------------
+ drivers/net/wireless/intel/iwlwifi/mvm/rs.h        |   3 -
+ drivers/net/wireless/intel/iwlwifi/mvm/utils.c     | 164 +++++++++++++++++++++
+ drivers/net/wireless/intel/iwlwifi/pcie/drv.c      |   3 +
+ drivers/net/wireless/intel/iwlwifi/tests/devinfo.c |  27 ++++
+ 41 files changed, 501 insertions(+), 356 deletions(-)
+Merging wpan-next/master (1dd9291eb9037 ieee802154: Remove WARN_ON() in cfg802154_pernet_exit())
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/wpan/wpan-next.git wpan-next/master
+Merge made by the 'ort' strategy.
+ net/ieee802154/core.c | 49 ++++++++++++++++++++++++++++---------------------
+ 1 file changed, 28 insertions(+), 21 deletions(-)
+Merging wpan-staging/staging (1dd9291eb9037 ieee802154: Remove WARN_ON() in cfg802154_pernet_exit())
+$ git merge -m Merge branch 'staging' of https://git.kernel.org/pub/scm/linux/kernel/git/wpan/wpan-next.git wpan-staging/staging
+Already up to date.
+Merging mtd/mtd/next (9781c381c1595 mtd: core: skip badblocks increment for blocks already known bad)
+$ git merge -m Merge branch 'mtd/next' of https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git mtd/mtd/next
+Merge made by the 'ort' strategy.
+ drivers/mtd/chips/jedec_probe.c |  2 +-
+ drivers/mtd/ftl.c               |  2 +-
+ drivers/mtd/lpddr/lpddr_cmds.c  | 10 +++----
+ drivers/mtd/lpddr/qinfo_probe.c |  4 +--
+ drivers/mtd/mtdcore.c           | 61 ++++++++++++++++++++++++++++++++++++++++-
+ drivers/mtd/mtdoops.c           |  5 ++--
+ drivers/mtd/mtdswap.c           |  4 +--
+ drivers/mtd/nand/raw/nandsim.c  |  7 ++---
+ drivers/mtd/rfd_ftl.c           |  4 +--
+ include/linux/mtd/map.h         |  1 +
+ 10 files changed, 79 insertions(+), 21 deletions(-)
+Merging nand/nand/next (b8df622cf7f68 mtd: rawnand: fsmc: Default to autodetect buswidth)
+$ git merge -m Merge branch 'nand/next' of https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git nand/nand/next
+Auto-merging MAINTAINERS
+Auto-merging drivers/mtd/nand/raw/atmel/nand-controller.c
+Merge made by the 'ort' strategy.
+ .../mtd/loongson,ls1b-nand-controller.yaml         |   56 +-
+ .../devicetree/bindings/mtd/samsung-s3c2410.txt    |   56 -
+ MAINTAINERS                                        |    2 +-
+ drivers/mtd/nand/core.c                            |  131 +++
+ drivers/mtd/nand/ecc-mxic.c                        |   14 +-
+ drivers/mtd/nand/ecc.c                             |    2 +-
+ drivers/mtd/nand/qpic_common.c                     |    6 +-
+ drivers/mtd/nand/raw/Kconfig                       |   34 +-
+ drivers/mtd/nand/raw/Makefile                      |    3 +-
+ drivers/mtd/nand/raw/atmel/nand-controller.c       |   13 +-
+ drivers/mtd/nand/raw/fsmc_nand.c                   |    6 +-
+ drivers/mtd/nand/raw/loongson-nand-controller.c    | 1024 ++++++++++++++++
+ drivers/mtd/nand/raw/loongson1-nand-controller.c   |  836 -------------
+ drivers/mtd/nand/raw/nand_base.c                   |  131 ---
+ drivers/mtd/nand/raw/pl35x-nand-controller.c       |    2 +-
+ drivers/mtd/nand/raw/s3c2410.c                     | 1230 --------------------
+ drivers/mtd/nand/spi/Makefile                      |    2 +-
+ drivers/mtd/nand/spi/core.c                        |    1 +
+ drivers/mtd/nand/spi/fmsh.c                        |   74 ++
+ drivers/mtd/nand/spi/gigadevice.c                  |  107 +-
+ include/linux/mtd/nand-qpic-common.h               |   14 -
+ include/linux/mtd/nand.h                           |    5 +
+ include/linux/mtd/rawnand.h                        |    5 -
+ include/linux/mtd/spinand.h                        |    1 +
+ include/linux/platform_data/mtd-nand-s3c2410.h     |   70 --
+ 25 files changed, 1426 insertions(+), 2399 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/mtd/samsung-s3c2410.txt
+ create mode 100644 drivers/mtd/nand/raw/loongson-nand-controller.c
+ delete mode 100644 drivers/mtd/nand/raw/loongson1-nand-controller.c
+ delete mode 100644 drivers/mtd/nand/raw/s3c2410.c
+ create mode 100644 drivers/mtd/nand/spi/fmsh.c
+ delete mode 100644 include/linux/platform_data/mtd-nand-s3c2410.h
+Merging spi-nor/spi-nor/next (17926cd770ec8 mtd: spi-nor: core: avoid odd length/address writes in 8D-8D-8D mode)
+$ git merge -m Merge branch 'spi-nor/next' of https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git spi-nor/spi-nor/next
+Merge made by the 'ort' strategy.
+ drivers/mtd/spi-nor/core.c | 145 ++++++++++++++++++++++++++++++++++++++++++++-
+ 1 file changed, 143 insertions(+), 2 deletions(-)
+Merging crypto/master (166c83f7789ed dt-bindings: rng: hisi-rng: convert to DT schema)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/herbert/cryptodev-2.6.git crypto/master
+Auto-merging MAINTAINERS
+Auto-merging drivers/char/hw_random/Kconfig
+Auto-merging drivers/crypto/Kconfig
+Auto-merging drivers/crypto/ccp/sev-dev.c
+Auto-merging include/linux/rcupdate.h
+Merge made by the 'ort' strategy.
+ .../ABI/testing/debugfs-driver-qat_telemetry       |  27 ++
+ Documentation/crypto/api-aead.rst                  |   3 +
+ Documentation/crypto/api-akcipher.rst              |   3 +
+ Documentation/crypto/api-digest.rst                |   3 +
+ Documentation/crypto/api-kpp.rst                   |   3 +
+ Documentation/crypto/api-rng.rst                   |   3 +
+ Documentation/crypto/api-sig.rst                   |   3 +
+ Documentation/crypto/api-skcipher.rst              |   3 +
+ .../bindings/crypto/ti,am62l-dthev2.yaml           |  50 +++
+ .../bindings/crypto/xlnx,versal-trng.yaml          |  35 ++
+ Documentation/devicetree/bindings/rng/hisi-rng.txt |  12 -
+ .../devicetree/bindings/rng/hisi-rng.yaml          |  32 ++
+ MAINTAINERS                                        |  13 +
+ arch/arm64/crypto/Kconfig                          |   1 +
+ arch/arm64/crypto/aes-glue.c                       |  21 +-
+ arch/s390/crypto/sha.h                             |   8 +-
+ crypto/842.c                                       |   6 +-
+ crypto/anubis.c                                    |   5 +-
+ crypto/asymmetric_keys/x509_cert_parser.c          |  16 +-
+ crypto/cryptd.c                                    |   3 +-
+ crypto/jitterentropy-kcapi.c                       |   1 +
+ crypto/lz4.c                                       |   6 +-
+ crypto/lz4hc.c                                     |   6 +-
+ crypto/lzo-rle.c                                   |   6 +-
+ crypto/lzo.c                                       |   6 +-
+ drivers/char/hw_random/Kconfig                     |   1 +
+ drivers/char/hw_random/cn10k-rng.c                 |   2 +-
+ drivers/char/hw_random/ks-sa-rng.c                 |   4 +
+ drivers/char/hw_random/timeriomem-rng.c            |   2 +-
+ drivers/crypto/Kconfig                             |  13 +
+ drivers/crypto/Makefile                            |   1 +
+ .../crypto/allwinner/sun8i-ce/sun8i-ce-cipher.c    |  85 ++---
+ drivers/crypto/allwinner/sun8i-ce/sun8i-ce-core.c  |  35 +-
+ drivers/crypto/allwinner/sun8i-ce/sun8i-ce-hash.c  | 147 ++++----
+ drivers/crypto/allwinner/sun8i-ce/sun8i-ce-prng.c  |   1 -
+ drivers/crypto/allwinner/sun8i-ce/sun8i-ce-trng.c  |   1 -
+ drivers/crypto/allwinner/sun8i-ce/sun8i-ce.h       |  27 +-
+ drivers/crypto/aspeed/aspeed-hace-crypto.c         |   2 +-
+ drivers/crypto/atmel-tdes.c                        |   2 +-
+ drivers/crypto/caam/ctrl.c                         |  10 +-
+ drivers/crypto/ccp/hsti.c                          |   8 +-
+ drivers/crypto/ccp/sev-dev.c                       | 131 ++++++-
+ drivers/crypto/ccp/sev-dev.h                       |   6 +-
+ drivers/crypto/chelsio/Kconfig                     |   6 +-
+ drivers/crypto/chelsio/chcr_algo.c                 | 255 +++----------
+ drivers/crypto/chelsio/chcr_crypto.h               |   1 -
+ drivers/crypto/hisilicon/debugfs.c                 |   1 +
+ drivers/crypto/hisilicon/hpre/hpre_main.c          | 199 +++++++---
+ drivers/crypto/hisilicon/qm.c                      | 218 ++++++++---
+ drivers/crypto/hisilicon/sec/sec_drv.c             |   3 +-
+ drivers/crypto/hisilicon/sec2/sec_crypto.c         |   8 +-
+ drivers/crypto/hisilicon/sec2/sec_main.c           | 229 ++++++++----
+ drivers/crypto/hisilicon/zip/dae_main.c            |  19 +-
+ drivers/crypto/hisilicon/zip/zip_main.c            | 242 ++++++++----
+ .../crypto/intel/keembay/keembay-ocs-hcu-core.c    |   5 +-
+ drivers/crypto/intel/qat/Kconfig                   |   7 +-
+ drivers/crypto/intel/qat/qat_common/adf_ctl_drv.c  |  40 +-
+ drivers/crypto/intel/qat/qat_common/adf_gen6_tl.c  | 112 ++++++
+ .../crypto/intel/qat/qat_common/adf_telemetry.c    |  19 +
+ .../crypto/intel/qat/qat_common/adf_telemetry.h    |   5 +
+ .../crypto/intel/qat/qat_common/adf_tl_debugfs.c   |  52 +++
+ .../crypto/intel/qat/qat_common/adf_tl_debugfs.h   |   5 +
+ drivers/crypto/intel/qat/qat_common/qat_algs.c     | 195 +++-------
+ drivers/crypto/intel/qat/qat_common/qat_uclo.c     |   2 +-
+ .../crypto/marvell/octeontx2/otx2_cptpf_ucode.c    |   2 +-
+ drivers/crypto/nx/nx-common-powernv.c              |   6 +-
+ drivers/crypto/nx/nx-common-pseries.c              |   6 +-
+ drivers/crypto/omap-aes.c                          |  15 +-
+ drivers/crypto/omap-aes.h                          |   2 +-
+ drivers/crypto/omap-des.c                          |  17 +-
+ drivers/crypto/omap-sham.c                         |  15 +-
+ drivers/crypto/rockchip/rk3288_crypto_ahash.c      |   2 +-
+ drivers/crypto/starfive/jh7110-aes.c               |  12 +-
+ drivers/crypto/starfive/jh7110-hash.c              |   3 +-
+ drivers/crypto/stm32/stm32-cryp.c                  |   2 +-
+ drivers/crypto/tegra/tegra-se-hash.c               |   3 +-
+ drivers/crypto/tegra/tegra-se-main.c               |   2 +-
+ drivers/crypto/ti/Kconfig                          |  14 +
+ drivers/crypto/ti/Makefile                         |   3 +
+ drivers/crypto/ti/dthev2-aes.c                     | 411 +++++++++++++++++++++
+ drivers/crypto/ti/dthev2-common.c                  | 217 +++++++++++
+ drivers/crypto/ti/dthev2-common.h                  | 101 +++++
+ drivers/crypto/xilinx/Makefile                     |   1 +
+ drivers/crypto/xilinx/xilinx-trng.c                | 405 ++++++++++++++++++++
+ include/crypto/hash.h                              |  16 +-
+ include/crypto/internal/scompress.h                |  11 +-
+ include/linux/hisi_acc_qm.h                        |  22 +-
+ include/linux/psp-sev.h                            |  44 ++-
+ include/linux/rcupdate.h                           |  26 ++
+ include/linux/rhashtable.h                         |  56 +--
+ include/uapi/linux/psp-sev.h                       |  10 +-
+ include/uapi/misc/uacce/hisi_qm.h                  |   1 +
+ kernel/padata.c                                    |  15 +-
+ lib/lzo/lzo1x_compress.c                           |   2 +-
+ lib/lzo/lzo1x_decompress_safe.c                    |   6 +-
+ 95 files changed, 2865 insertions(+), 959 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/crypto/ti,am62l-dthev2.yaml
+ create mode 100644 Documentation/devicetree/bindings/crypto/xlnx,versal-trng.yaml
+ delete mode 100644 Documentation/devicetree/bindings/rng/hisi-rng.txt
+ create mode 100644 Documentation/devicetree/bindings/rng/hisi-rng.yaml
+ create mode 100644 drivers/crypto/ti/Kconfig
+ create mode 100644 drivers/crypto/ti/Makefile
+ create mode 100644 drivers/crypto/ti/dthev2-aes.c
+ create mode 100644 drivers/crypto/ti/dthev2-common.c
+ create mode 100644 drivers/crypto/ti/dthev2-common.h
+ create mode 100644 drivers/crypto/xilinx/xilinx-trng.c
+Merging libcrypto/libcrypto-next (b94bc4398becc crypto: md5 - Implement export_core() and import_core())
+$ git merge -m Merge branch 'libcrypto-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ebiggers/linux.git libcrypto/libcrypto-next
+Auto-merging arch/arm/configs/multi_v7_defconfig
+Auto-merging arch/m68k/configs/amiga_defconfig
+Auto-merging arch/m68k/configs/apollo_defconfig
+Auto-merging arch/m68k/configs/atari_defconfig
+Auto-merging arch/m68k/configs/bvme6000_defconfig
+Auto-merging arch/m68k/configs/hp300_defconfig
+Auto-merging arch/m68k/configs/mac_defconfig
+Auto-merging arch/m68k/configs/multi_defconfig
+Auto-merging arch/m68k/configs/mvme147_defconfig
+Auto-merging arch/m68k/configs/mvme16x_defconfig
+Auto-merging arch/m68k/configs/q40_defconfig
+Auto-merging arch/m68k/configs/sun3_defconfig
+Auto-merging arch/m68k/configs/sun3x_defconfig
+Auto-merging arch/s390/configs/debug_defconfig
+Auto-merging arch/s390/configs/defconfig
+Auto-merging lib/crypto/arm64/sha256.h
+Auto-merging lib/crypto/x86/sha256.h
+Merge made by the 'ort' strategy.
+ arch/arm/configs/exynos_defconfig                  |    1 -
+ arch/arm/configs/milbeaut_m10v_defconfig           |    1 -
+ arch/arm/configs/multi_v7_defconfig                |    1 -
+ arch/arm/configs/omap2plus_defconfig               |    1 -
+ arch/arm/crypto/Kconfig                            |   13 -
+ arch/arm/crypto/Makefile                           |    2 -
+ arch/arm/crypto/curve25519-glue.c                  |  137 ---
+ arch/m68k/configs/amiga_defconfig                  |    1 -
+ arch/m68k/configs/apollo_defconfig                 |    1 -
+ arch/m68k/configs/atari_defconfig                  |    1 -
+ arch/m68k/configs/bvme6000_defconfig               |    1 -
+ arch/m68k/configs/hp300_defconfig                  |    1 -
+ arch/m68k/configs/mac_defconfig                    |    1 -
+ arch/m68k/configs/multi_defconfig                  |    1 -
+ arch/m68k/configs/mvme147_defconfig                |    1 -
+ arch/m68k/configs/mvme16x_defconfig                |    1 -
+ arch/m68k/configs/q40_defconfig                    |    1 -
+ arch/m68k/configs/sun3_defconfig                   |    1 -
+ arch/m68k/configs/sun3x_defconfig                  |    1 -
+ arch/mips/cavium-octeon/Makefile                   |    2 +-
+ arch/mips/cavium-octeon/crypto/Makefile            |    8 -
+ arch/mips/cavium-octeon/crypto/octeon-md5.c        |  214 ----
+ .../cavium-octeon/{crypto => }/octeon-crypto.c     |    0
+ arch/mips/configs/cavium_octeon_defconfig          |    1 -
+ arch/mips/crypto/Kconfig                           |   10 -
+ arch/powerpc/configs/powernv_defconfig             |    1 -
+ arch/powerpc/configs/ppc64_defconfig               |    1 -
+ arch/powerpc/crypto/Kconfig                        |   21 -
+ arch/powerpc/crypto/Makefile                       |    4 -
+ arch/powerpc/crypto/md5-glue.c                     |   99 --
+ arch/s390/configs/debug_defconfig                  |    1 -
+ arch/s390/configs/defconfig                        |    1 -
+ arch/sparc/crypto/Kconfig                          |   10 -
+ arch/sparc/crypto/Makefile                         |    4 -
+ arch/sparc/crypto/md5_glue.c                       |  174 ---
+ arch/x86/crypto/Kconfig                            |   13 -
+ arch/x86/crypto/Makefile                           |    5 -
+ crypto/Kconfig                                     |   14 +-
+ crypto/Makefile                                    |    1 -
+ crypto/chacha.c                                    |  129 +--
+ crypto/curve25519-generic.c                        |   91 --
+ crypto/md5.c                                       |  396 ++++---
+ crypto/testmgr.c                                   |   18 +-
+ crypto/testmgr.h                                   | 1225 --------------------
+ drivers/crypto/hisilicon/Kconfig                   |    1 -
+ drivers/crypto/hisilicon/hpre/hpre_crypto.c        |  403 +------
+ drivers/crypto/img-hash.c                          |    2 +-
+ drivers/net/Kconfig                                |   15 +-
+ include/crypto/chacha.h                            |   37 +-
+ include/crypto/curve25519.h                        |   40 +-
+ include/crypto/internal/blake2s.h                  |   21 -
+ include/crypto/internal/poly1305.h                 |   16 +-
+ include/crypto/md5.h                               |  181 ++-
+ include/crypto/poly1305.h                          |    9 -
+ lib/crypto/Kconfig                                 |  179 ++-
+ lib/crypto/Makefile                                |  169 ++-
+ lib/crypto/arm/Kconfig                             |   24 -
+ lib/crypto/arm/Makefile                            |   26 -
+ lib/crypto/arm/blake2s-core.S                      |    5 +-
+ lib/crypto/arm/blake2s-glue.c                      |    7 -
+ lib/crypto/arm/blake2s.h                           |    5 +
+ lib/crypto/arm/{chacha-glue.c => chacha.h}         |   35 +-
+ .../crypto => lib/crypto/arm}/curve25519-core.S    |    0
+ lib/crypto/arm/curve25519.h                        |   47 +
+ lib/crypto/arm/poly1305-armv4.pl                   |    3 +-
+ lib/crypto/arm/poly1305-glue.c                     |   76 --
+ lib/crypto/arm/poly1305.h                          |   53 +
+ lib/crypto/arm/sha1.h                              |    2 +-
+ lib/crypto/arm/sha256.h                            |   12 +-
+ lib/crypto/arm/sha512.h                            |    7 +-
+ lib/crypto/arm64/Kconfig                           |   14 -
+ lib/crypto/arm64/Makefile                          |   17 -
+ lib/crypto/arm64/{chacha-neon-glue.c => chacha.h}  |   32 +-
+ lib/crypto/arm64/poly1305-armv8.pl                 |    3 +
+ lib/crypto/arm64/poly1305-glue.c                   |   74 --
+ lib/crypto/arm64/poly1305.h                        |   50 +
+ lib/crypto/arm64/sha1.h                            |    2 +-
+ lib/crypto/arm64/sha256.h                          |   12 +-
+ lib/crypto/arm64/sha512.h                          |    7 +-
+ lib/crypto/blake2s-generic.c                       |  111 --
+ lib/crypto/blake2s-selftest.c                      |  651 -----------
+ lib/crypto/blake2s.c                               |  105 +-
+ lib/crypto/chacha-block-generic.c                  |  114 ++
+ lib/crypto/chacha.c                                |  144 +--
+ lib/crypto/curve25519-generic.c                    |   25 -
+ lib/crypto/curve25519.c                            |   69 +-
+ lib/crypto/libchacha.c                             |   35 -
+ lib/crypto/md5.c                                   |  322 +++++
+ lib/crypto/mips/Kconfig                            |   12 -
+ lib/crypto/mips/Makefile                           |   19 -
+ lib/crypto/mips/chacha-glue.c                      |   29 -
+ lib/crypto/mips/chacha.h                           |   14 +
+ lib/crypto/mips/md5.h                              |   65 ++
+ lib/crypto/mips/poly1305-glue.c                    |   33 -
+ lib/crypto/mips/poly1305-mips.pl                   |    8 +-
+ lib/crypto/mips/poly1305.h                         |   14 +
+ lib/crypto/poly1305-generic.c                      |   25 -
+ lib/crypto/poly1305.c                              |   81 +-
+ lib/crypto/powerpc/Kconfig                         |   16 -
+ lib/crypto/powerpc/Makefile                        |    7 -
+ lib/crypto/powerpc/{chacha-p10-glue.c => chacha.h} |   36 +-
+ .../crypto/powerpc}/curve25519-ppc64le_asm.S       |    0
+ .../crypto/powerpc/curve25519.h                    |  124 +-
+ .../crypto => lib/crypto/powerpc}/md5-asm.S        |    0
+ lib/crypto/powerpc/md5.h                           |   12 +
+ .../powerpc/{poly1305-p10-glue.c => poly1305.h}    |   40 +-
+ lib/crypto/riscv/Kconfig                           |    8 -
+ lib/crypto/riscv/Makefile                          |    4 -
+ .../riscv/{chacha-riscv64-glue.c => chacha.h}      |   36 +-
+ lib/crypto/riscv/poly1305-riscv.pl                 |  847 ++++++++++++++
+ lib/crypto/riscv/poly1305.h                        |   14 +
+ lib/crypto/riscv/sha256.h                          |   10 +-
+ lib/crypto/riscv/sha512.h                          |    6 +-
+ lib/crypto/s390/Kconfig                            |    7 -
+ lib/crypto/s390/Makefile                           |    4 -
+ lib/crypto/s390/{chacha-glue.c => chacha.h}        |   29 +-
+ lib/crypto/s390/sha1.h                             |    2 +-
+ lib/crypto/s390/sha256.h                           |    2 +-
+ lib/crypto/s390/sha512.h                           |    2 +-
+ lib/crypto/sparc/md5.h                             |   48 +
+ {arch/sparc/crypto => lib/crypto/sparc}/md5_asm.S  |    0
+ lib/crypto/sparc/sha1.h                            |    2 +-
+ lib/crypto/sparc/sha256.h                          |    2 +-
+ lib/crypto/sparc/sha512.h                          |    2 +-
+ lib/crypto/tests/Kconfig                           |   29 +
+ lib/crypto/tests/Makefile                          |    3 +
+ lib/crypto/tests/blake2s-testvecs.h                |  238 ++++
+ lib/crypto/tests/blake2s_kunit.c                   |  134 +++
+ .../curve25519_kunit.c}                            |  104 +-
+ lib/crypto/tests/md5-testvecs.h                    |  186 +++
+ lib/crypto/tests/md5_kunit.c                       |   39 +
+ lib/crypto/x86/Kconfig                             |   26 -
+ lib/crypto/x86/Makefile                            |   17 -
+ lib/crypto/x86/blake2s-core.S                      |   28 +-
+ lib/crypto/x86/{blake2s-glue.c => blake2s.h}       |   16 +-
+ lib/crypto/x86/{chacha_glue.c => chacha.h}         |   36 +-
+ .../crypto/x86/curve25519.h                        |  127 +-
+ lib/crypto/x86/poly1305-x86_64-cryptogams.pl       |   33 +-
+ lib/crypto/x86/{poly1305_glue.c => poly1305.h}     |   47 +-
+ lib/crypto/x86/sha1.h                              |    2 +-
+ lib/crypto/x86/sha256.h                            |    5 +-
+ lib/crypto/x86/sha512.h                            |    6 +-
+ scripts/crypto/gen-hash-testvecs.py                |   27 +-
+ 143 files changed, 3395 insertions(+), 5041 deletions(-)
+ delete mode 100644 arch/arm/crypto/curve25519-glue.c
+ delete mode 100644 arch/mips/cavium-octeon/crypto/Makefile
+ delete mode 100644 arch/mips/cavium-octeon/crypto/octeon-md5.c
+ rename arch/mips/cavium-octeon/{crypto => }/octeon-crypto.c (100%)
+ delete mode 100644 arch/powerpc/crypto/md5-glue.c
+ delete mode 100644 arch/sparc/crypto/md5_glue.c
+ delete mode 100644 crypto/curve25519-generic.c
+ delete mode 100644 include/crypto/internal/blake2s.h
+ delete mode 100644 lib/crypto/arm/Kconfig
+ delete mode 100644 lib/crypto/arm/Makefile
+ delete mode 100644 lib/crypto/arm/blake2s-glue.c
+ create mode 100644 lib/crypto/arm/blake2s.h
+ rename lib/crypto/arm/{chacha-glue.c => chacha.h} (76%)
+ rename {arch/arm/crypto => lib/crypto/arm}/curve25519-core.S (100%)
+ create mode 100644 lib/crypto/arm/curve25519.h
+ delete mode 100644 lib/crypto/arm/poly1305-glue.c
+ create mode 100644 lib/crypto/arm/poly1305.h
+ delete mode 100644 lib/crypto/arm64/Kconfig
+ delete mode 100644 lib/crypto/arm64/Makefile
+ rename lib/crypto/arm64/{chacha-neon-glue.c => chacha.h} (75%)
+ delete mode 100644 lib/crypto/arm64/poly1305-glue.c
+ create mode 100644 lib/crypto/arm64/poly1305.h
+ delete mode 100644 lib/crypto/blake2s-generic.c
+ delete mode 100644 lib/crypto/blake2s-selftest.c
+ create mode 100644 lib/crypto/chacha-block-generic.c
+ delete mode 100644 lib/crypto/curve25519-generic.c
+ delete mode 100644 lib/crypto/libchacha.c
+ create mode 100644 lib/crypto/md5.c
+ delete mode 100644 lib/crypto/mips/Kconfig
+ delete mode 100644 lib/crypto/mips/Makefile
+ delete mode 100644 lib/crypto/mips/chacha-glue.c
+ create mode 100644 lib/crypto/mips/chacha.h
+ create mode 100644 lib/crypto/mips/md5.h
+ delete mode 100644 lib/crypto/mips/poly1305-glue.c
+ create mode 100644 lib/crypto/mips/poly1305.h
+ delete mode 100644 lib/crypto/poly1305-generic.c
+ delete mode 100644 lib/crypto/powerpc/Kconfig
+ delete mode 100644 lib/crypto/powerpc/Makefile
+ rename lib/crypto/powerpc/{chacha-p10-glue.c => chacha.h} (62%)
+ rename {arch/powerpc/crypto => lib/crypto/powerpc}/curve25519-ppc64le_asm.S (100%)
+ rename arch/powerpc/crypto/curve25519-ppc64le-core.c => lib/crypto/powerpc/curve25519.h (56%)
+ rename {arch/powerpc/crypto => lib/crypto/powerpc}/md5-asm.S (100%)
+ create mode 100644 lib/crypto/powerpc/md5.h
+ rename lib/crypto/powerpc/{poly1305-p10-glue.c => poly1305.h} (63%)
+ delete mode 100644 lib/crypto/riscv/Kconfig
+ delete mode 100644 lib/crypto/riscv/Makefile
+ rename lib/crypto/riscv/{chacha-riscv64-glue.c => chacha.h} (57%)
+ create mode 100644 lib/crypto/riscv/poly1305-riscv.pl
+ create mode 100644 lib/crypto/riscv/poly1305.h
+ delete mode 100644 lib/crypto/s390/Kconfig
+ delete mode 100644 lib/crypto/s390/Makefile
+ rename lib/crypto/s390/{chacha-glue.c => chacha.h} (51%)
+ create mode 100644 lib/crypto/sparc/md5.h
+ rename {arch/sparc/crypto => lib/crypto/sparc}/md5_asm.S (100%)
+ create mode 100644 lib/crypto/tests/blake2s-testvecs.h
+ create mode 100644 lib/crypto/tests/blake2s_kunit.c
+ rename lib/crypto/{curve25519-selftest.c => tests/curve25519_kunit.c} (96%)
+ create mode 100644 lib/crypto/tests/md5-testvecs.h
+ create mode 100644 lib/crypto/tests/md5_kunit.c
+ delete mode 100644 lib/crypto/x86/Kconfig
+ delete mode 100644 lib/crypto/x86/Makefile
+ rename lib/crypto/x86/{blake2s-glue.c => blake2s.h} (83%)
+ rename lib/crypto/x86/{chacha_glue.c => chacha.h} (85%)
+ rename arch/x86/crypto/curve25519-x86_64.c => lib/crypto/x86/curve25519.h (94%)
+ rename lib/crypto/x86/{poly1305_glue.c => poly1305.h} (83%)
+Merging drm/drm-next (62bea0e1d5c71 Merge tag 'drm-habanalabs-next-2025-09-25' of https://github.com/HabanaAI/drivers.accel.habanalabs.kernel into drm-next)
+$ git merge -m Merge branch 'drm-next' of https://gitlab.freedesktop.org/drm/kernel.git drm/drm-next
+Auto-merging .mailmap
+Auto-merging Documentation/devicetree/bindings/vendor-prefixes.yaml
+Auto-merging MAINTAINERS
+Auto-merging drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.h
+Auto-merging drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
+Auto-merging drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
+Auto-merging drivers/gpu/drm/amd/amdgpu/gfx_v11_0.c
+Auto-merging drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+Auto-merging drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.h
+Auto-merging drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_color.c
+Auto-merging drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_plane.c
+Auto-merging drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c
+Auto-merging drivers/gpu/drm/amd/display/dc/dc.h
+Auto-merging drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c
+Auto-merging drivers/gpu/drm/amd/display/dc/hwss/dcn401/dcn401_hwseq.c
+Auto-merging drivers/gpu/drm/amd/pm/swsmu/amdgpu_smu.c
+Auto-merging drivers/gpu/drm/bridge/analogix/anx7625.c
+Auto-merging drivers/gpu/drm/drm_gem.c
+Auto-merging drivers/gpu/drm/drm_gpuvm.c
+Auto-merging drivers/gpu/drm/i915/display/intel_ddi.c
+Auto-merging drivers/gpu/drm/i915/display/intel_dp_aux_backlight.c
+Auto-merging drivers/gpu/drm/i915/gem/i915_gem_pages.c
+Auto-merging drivers/gpu/drm/panthor/panthor_sched.c
+Auto-merging drivers/gpu/drm/xe/abi/guc_actions_abi.h
+Auto-merging drivers/gpu/drm/xe/abi/guc_klvs_abi.h
+Auto-merging drivers/gpu/drm/xe/xe_configfs.c
+Auto-merging drivers/gpu/drm/xe/xe_device_sysfs.c
+CONFLICT (content): Merge conflict in drivers/gpu/drm/xe/xe_device_sysfs.c
+Auto-merging drivers/gpu/drm/xe/xe_exec_queue.c
+Auto-merging drivers/gpu/drm/xe/xe_exec_queue_types.h
+Auto-merging drivers/gpu/drm/xe/xe_gt.c
+Auto-merging drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c
+Auto-merging drivers/gpu/drm/xe/xe_guc.c
+Auto-merging drivers/gpu/drm/xe/xe_guc_submit.c
+CONFLICT (content): Merge conflict in drivers/gpu/drm/xe/xe_guc_submit.c
+Auto-merging drivers/gpu/drm/xe/xe_guc_submit.h
+Auto-merging drivers/gpu/drm/xe/xe_hwmon.c
+Auto-merging drivers/gpu/drm/xe/xe_nvm.c
+Auto-merging drivers/gpu/drm/xe/xe_vm.c
+Auto-merging drivers/hid/i2c-hid/i2c-hid-core.c
+Auto-merging include/linux/hid.h
+Auto-merging include/linux/list.h
+Auto-merging rust/helpers/helpers.c
+Auto-merging rust/kernel/alloc/allocator.rs
+CONFLICT (content): Merge conflict in rust/kernel/alloc/allocator.rs
+Auto-merging rust/kernel/alloc/allocator_test.rs
+Auto-merging rust/kernel/alloc/kbox.rs
+CONFLICT (content): Merge conflict in rust/kernel/alloc/kbox.rs
+Auto-merging rust/kernel/alloc/kvec.rs
+Auto-merging rust/kernel/dma.rs
+Auto-merging rust/kernel/lib.rs
+Resolved 'drivers/gpu/drm/xe/xe_device_sysfs.c' using previous resolution.
+Resolved 'drivers/gpu/drm/xe/xe_guc_submit.c' using previous resolution.
+Resolved 'rust/kernel/alloc/allocator.rs' using previous resolution.
+Resolved 'rust/kernel/alloc/kbox.rs' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 7d22b4597dd8a] Merge branch 'drm-next' of https://gitlab.freedesktop.org/drm/kernel.git
+$ git diff -M --stat --summary HEAD^..
+ .mailmap                                           |    2 +
+ Documentation/ABI/testing/sysfs-class-drm          |    8 +
+ Documentation/accel/amdxdna/amdnpu.rst             |   10 +-
+ Documentation/accel/index.rst                      |    1 +
+ Documentation/accel/rocket/index.rst               |   19 +
+ .../bindings/arm/stm32/st,stm32-syscon.yaml        |   31 +-
+ .../bindings/display/bridge/samsung,mipi-dsim.yaml |   27 +
+ .../bindings/display/bridge/simple-bridge.yaml     |    2 +
+ .../bindings/display/bridge/solomon,ssd2825.yaml   |  141 +
+ .../bindings/display/bridge/waveshare,dsi2dpi.yaml |  103 +
+ .../bindings/display/mayqueen,pixpaper.yaml        |   63 +
+ .../bindings/display/panel/hydis,hv101hd1.yaml     |   60 +
+ .../bindings/display/panel/ilitek,ili9881c.yaml    |    1 +
+ .../bindings/display/panel/panel-lvds.yaml         |    4 +
+ .../bindings/display/panel/panel-simple.yaml       |    6 +
+ .../bindings/display/panel/samsung,atna33xc20.yaml |    4 +
+ .../panel/samsung,s6e8aa5x01-ams561ra01.yaml       |   55 +
+ .../bindings/display/rockchip/rockchip,dw-dp.yaml  |  150 +
+ .../rockchip/rockchip,rk3588-mipi-dsi2.yaml        |    1 +
+ .../display/samsung/samsung,exynos7-decon.yaml     |   21 +
+ .../bindings/display/sitronix,st7567.yaml          |    5 +
+ .../bindings/display/sitronix,st7571.yaml          |    5 +
+ .../devicetree/bindings/display/st,stm32-ltdc.yaml |   55 +-
+ .../bindings/display/st,stm32mp25-lvds.yaml        |   13 +-
+ .../devicetree/bindings/gpu/img,powervr-rogue.yaml |   49 +-
+ .../bindings/npu/rockchip,rk3588-rknn-core.yaml    |  112 +
+ .../devicetree/bindings/vendor-prefixes.yaml       |    4 +
+ .../gpu/amdgpu/amd-hardware-list-info.rst          |    4 +-
+ Documentation/gpu/amdgpu/apu-asic-info-table.csv   |   35 +-
+ Documentation/gpu/amdgpu/debugfs.rst               |    4 +-
+ Documentation/gpu/amdgpu/dgpu-asic-info-table.csv  |   58 +-
+ Documentation/gpu/amdgpu/display/dc-glossary.rst   |    2 +-
+ .../gpu/amdgpu/display/display-contributing.rst    |    4 +-
+ .../gpu/amdgpu/display/programming-model-dcn.rst   |    2 +-
+ Documentation/gpu/amdgpu/driver-core.rst           |    4 +-
+ Documentation/gpu/amdgpu/process-isolation.rst     |    2 +-
+ Documentation/gpu/drm-uapi.rst                     |   47 +-
+ Documentation/gpu/i915.rst                         |    7 -
+ Documentation/gpu/nova/core/todo.rst               |   19 -
+ Documentation/gpu/todo.rst                         |   47 +-
+ Documentation/gpu/xe/index.rst                     |    1 +
+ Documentation/gpu/xe/xe_device.rst                 |   10 +
+ Documentation/gpu/xe/xe_pcode.rst                  |    6 +-
+ MAINTAINERS                                        |   50 +-
+ arch/parisc/include/asm/video.h                    |    2 +-
+ arch/sparc/include/asm/video.h                     |    2 +
+ arch/x86/include/asm/video.h                       |    2 +
+ arch/x86/video/video-common.c                      |   25 +-
+ drivers/accel/Kconfig                              |    1 +
+ drivers/accel/Makefile                             |    1 +
+ drivers/accel/amdxdna/Makefile                     |    1 +
+ drivers/accel/amdxdna/aie2_ctx.c                   |   67 +-
+ drivers/accel/amdxdna/aie2_message.c               |   21 +-
+ drivers/accel/amdxdna/aie2_pci.c                   |  219 +-
+ drivers/accel/amdxdna/aie2_pci.h                   |    5 +-
+ drivers/accel/amdxdna/amdxdna_ctx.c                |   52 +-
+ drivers/accel/amdxdna/amdxdna_ctx.h                |   10 +-
+ drivers/accel/amdxdna/amdxdna_gem.c                |  139 +-
+ drivers/accel/amdxdna/amdxdna_pci_drv.c            |  108 +-
+ drivers/accel/amdxdna/amdxdna_pci_drv.h            |    7 +-
+ drivers/accel/amdxdna/amdxdna_ubuf.c               |  232 ++
+ drivers/accel/amdxdna/amdxdna_ubuf.h               |   19 +
+ drivers/accel/habanalabs/Kconfig                   |   23 +
+ drivers/accel/habanalabs/common/Makefile           |    5 +
+ drivers/accel/habanalabs/common/debugfs.c          |  324 ++
+ drivers/accel/habanalabs/common/device.c           |   23 +
+ drivers/accel/habanalabs/common/habanalabs.h       |   56 +-
+ drivers/accel/habanalabs/common/habanalabs_ioctl.c |    6 +
+ drivers/accel/habanalabs/common/hldio.c            |  437 ++
+ drivers/accel/habanalabs/common/hldio.h            |  146 +
+ drivers/accel/habanalabs/common/memory.c           |    9 +-
+ drivers/accel/habanalabs/common/memory_mgr.c       |    5 -
+ drivers/accel/habanalabs/common/sysfs.c            |   11 +-
+ drivers/accel/habanalabs/gaudi/gaudi.c             |   19 +
+ drivers/accel/habanalabs/gaudi2/gaudi2.c           |  386 +-
+ drivers/accel/habanalabs/gaudi2/gaudi2P.h          |    9 +
+ drivers/accel/habanalabs/gaudi2/gaudi2_coresight.c |    2 +-
+ drivers/accel/ivpu/ivpu_fw.h                       |    2 +-
+ drivers/accel/ivpu/ivpu_hw_btrs.c                  |    3 +-
+ drivers/accel/ivpu/ivpu_hw_btrs.h                  |    2 +-
+ drivers/accel/ivpu/ivpu_ipc.c                      |    1 -
+ drivers/accel/rocket/Kconfig                       |   24 +
+ drivers/accel/rocket/Makefile                      |   10 +
+ drivers/accel/rocket/rocket_core.c                 |  110 +
+ drivers/accel/rocket/rocket_core.h                 |   64 +
+ drivers/accel/rocket/rocket_device.c               |   60 +
+ drivers/accel/rocket/rocket_device.h               |   30 +
+ drivers/accel/rocket/rocket_drv.c                  |  290 ++
+ drivers/accel/rocket/rocket_drv.h                  |   32 +
+ drivers/accel/rocket/rocket_gem.c                  |  181 +
+ drivers/accel/rocket/rocket_gem.h                  |   34 +
+ drivers/accel/rocket/rocket_job.c                  |  637 +++
+ drivers/accel/rocket/rocket_job.h                  |   52 +
+ drivers/accel/rocket/rocket_registers.h            | 4404 ++++++++++++++++++++
+ drivers/gpu/drm/Kconfig                            |    2 +
+ drivers/gpu/drm/Makefile                           |    1 +
+ drivers/gpu/drm/amd/amdgpu/Makefile                |    4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu.h                |   44 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_aca.c            |   53 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd.h         |    8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c   |   22 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_atombios.c       |   34 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_bo_list.c        |   41 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_connectors.c     |   66 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_cper.c           |   14 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_cs.c             |   74 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_debugfs.c        |    8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_device.c         |  275 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_discovery.c      |   35 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_dma_buf.c        |   12 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c            |   37 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_fdinfo.c         |    1 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_fence.c          |    3 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gem.c            |  221 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gem.h            |   17 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gfx.c            |    9 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gfx.h            |    6 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c            |    2 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.h            |   15 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_i2c.c            |   18 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ih.h             |    6 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_job.c            |    5 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_job.h            |   19 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_jpeg.c           |   76 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_jpeg.h           |   10 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_kms.c            |    4 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_mes.c            |   65 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_mes.h            |   31 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_mode.h           |    2 -
+ drivers/gpu/drm/amd/amdgpu/amdgpu_object.c         |   16 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_object.h         |    4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_psp.c            |    8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_psp_ta.c         |   20 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ras.c            |  350 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ras.h            |   28 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ras_eeprom.c     |   15 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_res_cursor.h     |    2 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_reset.c          |    3 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_reset.h          |   13 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ring.c           |    3 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ring.h           |   30 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_rlc.c            |    4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_rlc.h            |    8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_seq64.c          |    8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c            |  130 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.h            |    6 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_umc.c            |    1 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_userq.c          |  366 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_userq.h          |   10 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_userq_fence.c    |   42 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_userq_fence.h    |    1 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_utils.h          |   91 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_uvd.c            |    3 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vce.c            |    5 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vcn.c            |  204 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vcn.h            |   13 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_virt.c           |   55 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_virt.h           |   11 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vkms.c           |    8 -
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c             |  228 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm.h             |   58 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm_cpu.c         |    4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm_pt.c          |    8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm_sdma.c        |   12 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vpe.c            |   31 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vram_mgr.c       |   87 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vram_mgr.h       |   17 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_xcp.c            |   21 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_xcp.h            |    1 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_xgmi.h           |    4 +
+ drivers/gpu/drm/amd/amdgpu/amdgv_sriovmsg.h        |    5 +
+ drivers/gpu/drm/amd/amdgpu/atom.c                  |   26 +
+ drivers/gpu/drm/amd/amdgpu/atom.h                  |    2 +
+ .../gpu/drm/amd/amdgpu/cyan_skillfish_reg_init.c   |   56 +
+ drivers/gpu/drm/amd/amdgpu/dce_v10_0.c             |    3 +-
+ drivers/gpu/drm/amd/amdgpu/dce_v11_0.c             | 3818 -----------------
+ drivers/gpu/drm/amd/amdgpu/dce_v11_0.h             |   32 -
+ drivers/gpu/drm/amd/amdgpu/dce_v6_0.c              |    1 -
+ drivers/gpu/drm/amd/amdgpu/dce_v8_0.c              |    3 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c             |   25 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v11_0.c             |    8 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v12_0.c             |    8 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v6_0.c              |    7 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v7_0.c              |    5 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v8_0.c              |    3 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v9_0.c              |   26 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v9_4_2.c            |   12 +
+ drivers/gpu/drm/amd/amdgpu/gfx_v9_4_2.h            |    1 +
+ drivers/gpu/drm/amd/amdgpu/gfx_v9_4_3.c            |   20 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v10_0.c             |   60 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v11_0.c             |   60 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v12_0.c             |   65 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v6_0.c              |    4 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v7_0.c              |    4 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v8_0.c              |   10 +-
+ drivers/gpu/drm/amd/amdgpu/gmc_v9_0.c              |   69 +-
+ drivers/gpu/drm/amd/amdgpu/ih_v6_0.c               |    3 +-
+ drivers/gpu/drm/amd/amdgpu/ih_v6_1.c               |    3 +-
+ drivers/gpu/drm/amd/amdgpu/ih_v7_0.c               |    3 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v1_0.c             |    2 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v2_0.c             |   58 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v2_0.h             |    6 -
+ drivers/gpu/drm/amd/amdgpu/jpeg_v2_5.c             |    4 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v3_0.c             |    2 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v4_0.c             |    2 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v4_0_3.c           |    4 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v4_0_5.c           |    4 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v5_0_0.c           |    4 +-
+ drivers/gpu/drm/amd/amdgpu/jpeg_v5_0_1.c           |   27 +-
+ drivers/gpu/drm/amd/amdgpu/mes_userqueue.c         |  144 +-
+ drivers/gpu/drm/amd/amdgpu/mes_v11_0.c             |   31 +
+ drivers/gpu/drm/amd/amdgpu/mes_v12_0.c             |  107 +-
+ drivers/gpu/drm/amd/amdgpu/mxgpu_ai.c              |   32 +-
+ drivers/gpu/drm/amd/amdgpu/mxgpu_nv.c              |   47 +-
+ drivers/gpu/drm/amd/amdgpu/mxgpu_nv.h              |    2 +
+ drivers/gpu/drm/amd/amdgpu/nbio_v7_4.c             |    6 +-
+ drivers/gpu/drm/amd/amdgpu/nv.h                    |    1 +
+ drivers/gpu/drm/amd/amdgpu/smu_v11_0_i2c.c         |    5 +-
+ drivers/gpu/drm/amd/amdgpu/soc15.c                 |    1 -
+ drivers/gpu/drm/amd/amdgpu/umc_v12_0.c             |    5 +-
+ drivers/gpu/drm/amd/amdgpu/uvd_v3_1.c              |   29 +-
+ drivers/gpu/drm/amd/amdgpu/uvd_v6_0.c              |    6 +-
+ drivers/gpu/drm/amd/amdgpu/uvd_v7_0.c              |    6 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v1_0.c              |    8 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v2_0.c              |  103 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v2_5.c              |  134 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v3_0.c              |  105 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v4_0.c              |  114 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v4_0_3.c            |  139 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v4_0_5.c            |  108 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v5_0_0.c            |  115 +-
+ drivers/gpu/drm/amd/amdgpu/vcn_v5_0_0.h            |    5 -
+ drivers/gpu/drm/amd/amdgpu/vcn_v5_0_1.c            |   93 +-
+ drivers/gpu/drm/amd/amdgpu/vi.c                    |    7 -
+ drivers/gpu/drm/amd/amdkfd/kfd_chardev.c           |   31 +-
+ drivers/gpu/drm/amd/amdkfd/kfd_kernel_queue.c      |    7 +-
+ drivers/gpu/drm/amd/amdkfd/kfd_migrate.c           |   93 +-
+ drivers/gpu/drm/amd/amdkfd/kfd_priv.h              |    9 +-
+ drivers/gpu/drm/amd/amdkfd/kfd_svm.c               |   38 +-
+ drivers/gpu/drm/amd/amdkfd/kfd_topology.c          |    2 +
+ drivers/gpu/drm/amd/amdxcp/amdgpu_xcp_drv.c        |   56 +-
+ drivers/gpu/drm/amd/amdxcp/amdgpu_xcp_drv.h        |    1 +
+ drivers/gpu/drm/amd/display/Makefile               |    1 +
+ drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c  |  438 +-
+ drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.h  |   24 +
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_color.c    |    2 +-
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_crc.c  |    1 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_crc.h  |    1 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_crtc.c |   16 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_debugfs.c  |   35 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_debugfs.h  |    1 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_hdcp.c |    3 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_hdcp.h |    1 +
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_helpers.c  |    1 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_irq.c  |    1 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_irq.h  |    1 +
+ .../amd/display/amdgpu_dm/amdgpu_dm_irq_params.h   |    1 +
+ .../amd/display/amdgpu_dm/amdgpu_dm_mst_types.c    |   63 +-
+ .../amd/display/amdgpu_dm/amdgpu_dm_mst_types.h    |    3 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_plane.c    |    4 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_pp_smu.c   |    2 +
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_psr.c  |    2 +-
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_psr.h  |    1 +
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_replay.c   |    3 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_replay.h   |    1 +
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_services.c |    1 +
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_trace.h    |    1 +
+ drivers/gpu/drm/amd/display/dc/Makefile            |    1 +
+ drivers/gpu/drm/amd/display/dc/basics/dce_calcs.c  |    2 +-
+ drivers/gpu/drm/amd/display/dc/basics/fixpt31_32.c |    2 +-
+ drivers/gpu/drm/amd/display/dc/basics/vector.c     |    6 +-
+ drivers/gpu/drm/amd/display/dc/clk_mgr/clk_mgr.c   |    2 +-
+ .../amd/display/dc/clk_mgr/dce110/dce110_clk_mgr.c |    2 +-
+ .../drm/amd/display/dc/clk_mgr/dcn301/vg_clk_mgr.c |   16 +
+ .../amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c   |    2 +-
+ .../amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c |    2 +-
+ .../amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c |    2 +-
+ .../amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c |    2 +-
+ .../amd/display/dc/clk_mgr/dcn32/dcn32_clk_mgr.c   |    9 +-
+ .../amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c   |    2 +-
+ .../amd/display/dc/clk_mgr/dcn401/dcn401_clk_mgr.c |    8 +-
+ drivers/gpu/drm/amd/display/dc/core/dc.c           |  181 +-
+ .../gpu/drm/amd/display/dc/core/dc_hw_sequencer.c  |    2 +
+ .../gpu/drm/amd/display/dc/core/dc_link_enc_cfg.c  |    2 +-
+ .../gpu/drm/amd/display/dc/core/dc_link_exports.c  |   10 +-
+ drivers/gpu/drm/amd/display/dc/core/dc_resource.c  |   45 +-
+ drivers/gpu/drm/amd/display/dc/core/dc_stat.c      |    2 +-
+ drivers/gpu/drm/amd/display/dc/core/dc_state.c     |    2 +-
+ drivers/gpu/drm/amd/display/dc/core/dc_stream.c    |    8 +-
+ drivers/gpu/drm/amd/display/dc/dc.h                |   87 +-
+ drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c       |   66 +-
+ drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h       |   36 +-
+ drivers/gpu/drm/amd/display/dc/dc_dp_types.h       |   17 +-
+ drivers/gpu/drm/amd/display/dc/dc_helper.c         |    7 +-
+ drivers/gpu/drm/amd/display/dc/dc_spl_translate.c  |    2 +-
+ drivers/gpu/drm/amd/display/dc/dc_types.h          |   18 +
+ .../drm/amd/display/dc/dccg/dcn401/dcn401_dccg.c   |    2 +-
+ drivers/gpu/drm/amd/display/dc/dce/dce_aux.c       |   17 +-
+ drivers/gpu/drm/amd/display/dc/dce/dce_i2c_hw.c    |    2 +-
+ drivers/gpu/drm/amd/display/dc/dce/dce_i2c_sw.c    |    2 +-
+ drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c      |    2 +-
+ drivers/gpu/drm/amd/display/dc/dce/dmub_replay.c   |   13 +
+ .../amd/display/dc/dio/dcn10/dcn10_link_encoder.c  |    2 +-
+ .../display/dc/dio/dcn10/dcn10_stream_encoder.c    |    2 +-
+ .../display/dc/dio/dcn20/dcn20_stream_encoder.c    |    2 +-
+ .../display/dc/dio/dcn31/dcn31_dio_link_encoder.c  |    2 +-
+ .../dc/dio/dcn314/dcn314_dio_stream_encoder.c      |    2 +-
+ .../dc/dio/dcn32/dcn32_dio_stream_encoder.c        |    2 +-
+ .../dc/dio/dcn35/dcn35_dio_stream_encoder.c        |    4 +-
+ .../dc/dio/dcn401/dcn401_dio_stream_encoder.c      |    2 +-
+ drivers/gpu/drm/amd/display/dc/dm_services.h       |    2 +
+ drivers/gpu/drm/amd/display/dc/dm_services_types.h |    2 +-
+ .../gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c   |    3 +-
+ .../display/dc/dml/dcn20/display_rq_dlg_calc_20.c  |    2 +-
+ .../dc/dml/dcn20/display_rq_dlg_calc_20v2.c        |    2 +-
+ .../display/dc/dml/dcn21/display_rq_dlg_calc_21.c  |    2 +-
+ .../display/dc/dml/dcn30/display_rq_dlg_calc_30.c  |    2 +-
+ .../gpu/drm/amd/display/dc/dml/dcn301/dcn301_fpu.c |   24 +-
+ .../gpu/drm/amd/display/dc/dml/dcn302/dcn302_fpu.c |    2 +-
+ .../gpu/drm/amd/display/dc/dml/dcn303/dcn303_fpu.c |    2 +-
+ .../display/dc/dml/dcn31/display_rq_dlg_calc_31.c  |    2 +-
+ .../dc/dml/dcn314/display_rq_dlg_calc_314.c        |    2 +-
+ .../gpu/drm/amd/display/dc/dml/dcn32/dcn32_fpu.c   |    6 +-
+ .../display/dc/dml/dcn32/display_rq_dlg_calc_32.c  |    1 -
+ .../gpu/drm/amd/display/dc/dml/dcn321/dcn321_fpu.c |    2 +-
+ .../gpu/drm/amd/display/dc/dml/dcn35/dcn35_fpu.c   |    2 +-
+ .../gpu/drm/amd/display/dc/dml/dcn351/dcn351_fpu.c |    2 +-
+ .../drm/amd/display/dc/dml2/display_mode_core.c    |    2 +-
+ .../dc/dml2/dml21/dml21_translation_helper.c       |  421 +-
+ .../drm/amd/display/dc/dml2/dml21/dml21_wrapper.c  |    6 +-
+ .../dc/dml2/dml21/inc/dml_top_dchub_registers.h    |    2 +
+ .../dml2/dml21/inc/dml_top_soc_parameter_types.h   |    2 +
+ .../amd/display/dc/dml2/dml21/inc/dml_top_types.h  |    8 +-
+ .../dml21/src/dml2_core/dml2_core_dcn4_calcs.c     |   28 +-
+ .../dml2/dml21/src/dml2_core/dml2_core_factory.c   |    2 +-
+ .../dml21/src/dml2_core/dml2_core_shared_types.h   |   12 +
+ .../dml2/dml21/src/dml2_dpmm/dml2_dpmm_factory.c   |    2 +-
+ .../dc/dml2/dml21/src/dml2_mcg/dml2_mcg_factory.c  |    2 +-
+ .../dc/dml2/dml21/src/dml2_pmo/dml2_pmo_factory.c  |    2 +-
+ .../amd/display/dc/dml2/dml2_dc_resource_mgmt.c    |    6 +-
+ .../drm/amd/display/dc/dml2/dml2_mall_phantom.c    |    6 +-
+ drivers/gpu/drm/amd/display/dc/dml2/dml2_wrapper.c |    2 +-
+ .../gpu/drm/amd/display/dc/dpp/dcn401/dcn401_dpp.h |   10 +
+ .../amd/display/dc/dpp/dcn401/dcn401_dpp_dscl.c    |   36 +-
+ drivers/gpu/drm/amd/display/dc/dsc/dc_dsc.c        |    5 +
+ .../gpu/drm/amd/display/dc/dsc/dcn20/dcn20_dsc.c   |    3 +-
+ drivers/gpu/drm/amd/display/dc/hdcp/hdcp_msg.c     |    2 +-
+ .../drm/amd/display/dc/hubbub/dcn30/dcn30_hubbub.c |   31 +
+ .../drm/amd/display/dc/hubbub/dcn30/dcn30_hubbub.h |    6 +
+ .../drm/amd/display/dc/hubbub/dcn31/dcn31_hubbub.c |    2 +
+ .../drm/amd/display/dc/hubbub/dcn32/dcn32_hubbub.c |    2 +
+ .../drm/amd/display/dc/hubbub/dcn35/dcn35_hubbub.c |    2 +
+ .../amd/display/dc/hubbub/dcn401/dcn401_hubbub.c   |    2 +
+ .../gpu/drm/amd/display/dc/hubp/dcn10/dcn10_hubp.h |    9 +-
+ .../gpu/drm/amd/display/dc/hubp/dcn20/dcn20_hubp.h |    1 +
+ .../gpu/drm/amd/display/dc/hubp/dcn30/dcn30_hubp.c |   26 +
+ .../gpu/drm/amd/display/dc/hubp/dcn30/dcn30_hubp.h |    8 +-
+ .../gpu/drm/amd/display/dc/hubp/dcn31/dcn31_hubp.c |   15 +
+ .../gpu/drm/amd/display/dc/hubp/dcn31/dcn31_hubp.h |    6 +-
+ .../gpu/drm/amd/display/dc/hubp/dcn32/dcn32_hubp.c |    3 +
+ .../gpu/drm/amd/display/dc/hubp/dcn35/dcn35_hubp.c |    3 +
+ .../drm/amd/display/dc/hubp/dcn401/dcn401_hubp.c   |   41 +
+ .../drm/amd/display/dc/hubp/dcn401/dcn401_hubp.h   |    8 +-
+ .../drm/amd/display/dc/hwss/dce110/dce110_hwseq.c  |   15 +-
+ .../drm/amd/display/dc/hwss/dce110/dce110_hwseq.h  |    7 +
+ .../drm/amd/display/dc/hwss/dcn10/dcn10_hwseq.c    |  138 +-
+ .../drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c    |    4 +-
+ .../drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c    |    2 +-
+ .../drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c    |   50 +-
+ .../drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.h    |    5 +
+ .../gpu/drm/amd/display/dc/hwss/dcn30/dcn30_init.c |    1 +
+ .../drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c    |    2 +-
+ .../gpu/drm/amd/display/dc/hwss/dcn31/dcn31_init.c |    1 +
+ .../drm/amd/display/dc/hwss/dcn314/dcn314_hwseq.c  |    2 +-
+ .../drm/amd/display/dc/hwss/dcn314/dcn314_init.c   |    1 +
+ .../drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c    |    4 +-
+ .../gpu/drm/amd/display/dc/hwss/dcn32/dcn32_init.c |    1 +
+ .../drm/amd/display/dc/hwss/dcn35/dcn35_hwseq.c    |    2 +-
+ .../gpu/drm/amd/display/dc/hwss/dcn35/dcn35_init.c |    1 +
+ .../drm/amd/display/dc/hwss/dcn351/dcn351_init.c   |    1 +
+ .../drm/amd/display/dc/hwss/dcn401/dcn401_hwseq.c  |   45 +-
+ .../drm/amd/display/dc/hwss/dcn401/dcn401_init.c   |    1 +
+ drivers/gpu/drm/amd/display/dc/hwss/hw_sequencer.h |    4 +
+ drivers/gpu/drm/amd/display/dc/inc/core_types.h    |   13 +-
+ drivers/gpu/drm/amd/display/dc/inc/hw/dchubbub.h   |   24 +
+ drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h       |   21 +-
+ drivers/gpu/drm/amd/display/dc/inc/hw/mpc.h        |   26 +-
+ .../drm/amd/display/dc/inc/hw/timing_generator.h   |    1 +
+ .../amd/display/dc/inc/{link.h => link_service.h}  |   11 +-
+ drivers/gpu/drm/amd/display/dc/inc/resource.h      |    1 +
+ .../drm/amd/display/dc/inc/soc_and_ip_translator.h |   24 +
+ .../amd/display/dc/link/accessories/link_dp_cts.c  |   17 +-
+ .../amd/display/dc/link/accessories/link_dp_cts.h  |    2 +-
+ .../display/dc/link/accessories/link_dp_trace.h    |    2 +-
+ .../drm/amd/display/dc/link/hwss/link_hwss_dio.c   |    3 +-
+ .../drm/amd/display/dc/link/hwss/link_hwss_dio.h   |    2 +-
+ .../link/hwss/link_hwss_dio_fixed_vs_pe_retimer.h  |    2 +-
+ .../amd/display/dc/link/hwss/link_hwss_hpo_dp.h    |    2 +-
+ .../hwss/link_hwss_hpo_fixed_vs_pe_retimer_dp.h    |    2 +-
+ .../gpu/drm/amd/display/dc/link/link_detection.c   |    6 +-
+ .../gpu/drm/amd/display/dc/link/link_detection.h   |    2 +-
+ drivers/gpu/drm/amd/display/dc/link/link_dpms.c    |   14 +-
+ drivers/gpu/drm/amd/display/dc/link/link_dpms.h    |    2 +-
+ drivers/gpu/drm/amd/display/dc/link/link_factory.c |    2 +
+ drivers/gpu/drm/amd/display/dc/link/link_factory.h |    2 +-
+ .../gpu/drm/amd/display/dc/link/link_resource.h    |    2 +-
+ .../gpu/drm/amd/display/dc/link/link_validation.c  |    6 +-
+ .../gpu/drm/amd/display/dc/link/link_validation.h  |    2 +-
+ .../drm/amd/display/dc/link/protocols/link_ddc.h   |    2 +-
+ .../display/dc/link/protocols/link_dp_capability.c |   51 +-
+ .../display/dc/link/protocols/link_dp_capability.h |    8 +-
+ .../amd/display/dc/link/protocols/link_dp_dpia.h   |    2 +-
+ .../display/dc/link/protocols/link_dp_dpia_bw.c    |   71 +-
+ .../display/dc/link/protocols/link_dp_dpia_bw.h    |    2 +-
+ .../dc/link/protocols/link_dp_irq_handler.h        |    2 +-
+ .../amd/display/dc/link/protocols/link_dp_phy.h    |    2 +-
+ .../display/dc/link/protocols/link_dp_training.c   |   18 +-
+ .../display/dc/link/protocols/link_dp_training.h   |    2 +-
+ .../drm/amd/display/dc/link/protocols/link_dpcd.h  |    2 +-
+ .../dc/link/protocols/link_edp_panel_control.c     |   12 +-
+ .../dc/link/protocols/link_edp_panel_control.h     |    2 +-
+ .../drm/amd/display/dc/link/protocols/link_hpd.h   |    2 +-
+ .../amd/display/dc/mmhubbub/dcn20/dcn20_mmhubbub.c |    2 +-
+ .../gpu/drm/amd/display/dc/mpc/dcn401/dcn401_mpc.c |    8 -
+ .../gpu/drm/amd/display/dc/mpc/dcn401/dcn401_mpc.h |    5 -
+ .../gpu/drm/amd/display/dc/optc/dcn32/dcn32_optc.h |    1 +
+ .../gpu/drm/amd/display/dc/optc/dcn35/dcn35_optc.c |   18 +
+ .../drm/amd/display/dc/optc/dcn401/dcn401_optc.c   |    5 +
+ .../display/dc/resource/dce112/dce112_resource.c   |   12 +-
+ .../display/dc/resource/dce120/dce120_resource.c   |    8 +-
+ .../amd/display/dc/resource/dce60/dce60_resource.c |   11 +-
+ .../amd/display/dc/resource/dcn20/dcn20_resource.c |    2 +-
+ .../amd/display/dc/resource/dcn30/dcn30_resource.c |    4 +-
+ .../display/dc/resource/dcn302/dcn302_resource.c   |    3 +-
+ .../display/dc/resource/dcn303/dcn303_resource.c   |    2 +-
+ .../amd/display/dc/resource/dcn32/dcn32_resource.c |    4 +-
+ .../amd/display/dc/resource/dcn32/dcn32_resource.h |    3 +-
+ .../display/dc/resource/dcn321/dcn321_resource.c   |    2 +-
+ .../amd/display/dc/resource/dcn35/dcn35_resource.c |    5 +-
+ .../display/dc/resource/dcn351/dcn351_resource.c   |    5 +-
+ .../amd/display/dc/resource/dcn36/dcn36_resource.c |    5 +-
+ .../display/dc/resource/dcn401/dcn401_resource.c   |    6 +-
+ .../display/dc/resource/dcn401/dcn401_resource.h   |    3 +-
+ .../amd/display/dc/soc_and_ip_translator/Makefile  |   19 +
+ .../dcn401/dcn401_soc_and_ip_translator.c          |  304 ++
+ .../dcn401/dcn401_soc_and_ip_translator.h          |   22 +
+ .../dcn42/dcn42_soc_and_ip_translator.c            |   27 +
+ .../dcn42/dcn42_soc_and_ip_translator.h            |   16 +
+ .../soc_and_ip_translator/soc_and_ip_translator.c  |   37 +
+ .../display/dc/virtual/virtual_stream_encoder.c    |    7 +
+ drivers/gpu/drm/amd/display/dmub/dmub_srv.h        |    4 +
+ drivers/gpu/drm/amd/display/dmub/inc/dmub_cmd.h    |  201 +-
+ drivers/gpu/drm/amd/display/dmub/src/dmub_dcn31.c  |    1 +
+ drivers/gpu/drm/amd/display/dmub/src/dmub_dcn32.c  |   53 +-
+ drivers/gpu/drm/amd/display/dmub/src/dmub_dcn32.h  |    8 +-
+ drivers/gpu/drm/amd/display/dmub/src/dmub_dcn35.c  |    7 +-
+ .../gpu/drm/amd/display/dmub/src/dmub_srv_stat.c   |    8 +-
+ drivers/gpu/drm/amd/display/include/dal_asic_id.h  |    5 +
+ .../drm/amd/display/modules/freesync/freesync.c    |    4 +-
+ drivers/gpu/drm/amd/display/modules/hdcp/hdcp.c    |    5 +-
+ drivers/gpu/drm/amd/display/modules/inc/mod_hdcp.h |    1 +
+ drivers/gpu/drm/amd/include/amd_shared.h           |   98 +-
+ drivers/gpu/drm/amd/include/atomfirmware.h         |   30 +-
+ drivers/gpu/drm/amd/include/dm_pp_interface.h      |    1 +
+ drivers/gpu/drm/amd/include/kgd_pp_interface.h     |   85 +
+ drivers/gpu/drm/amd/include/mes_v12_api_def.h      |   30 +
+ drivers/gpu/drm/amd/pm/amdgpu_dpm.c                |   79 +-
+ drivers/gpu/drm/amd/pm/amdgpu_dpm_internal.c       |   94 +-
+ drivers/gpu/drm/amd/pm/amdgpu_pm.c                 |  370 +-
+ drivers/gpu/drm/amd/pm/inc/amdgpu_dpm.h            |    9 +-
+ drivers/gpu/drm/amd/pm/inc/amdgpu_dpm_internal.h   |    6 +-
+ drivers/gpu/drm/amd/pm/legacy-dpm/kv_dpm.c         |    4 +-
+ drivers/gpu/drm/amd/pm/legacy-dpm/legacy_dpm.c     |    9 +-
+ drivers/gpu/drm/amd/pm/legacy-dpm/si_dpm.c         |  126 +-
+ drivers/gpu/drm/amd/pm/legacy-dpm/si_smc.c         |   26 +-
+ drivers/gpu/drm/amd/pm/powerplay/amd_powerplay.c   |   11 +-
+ .../gpu/drm/amd/pm/powerplay/hwmgr/ppatomctrl.c    |    4 +-
+ .../gpu/drm/amd/pm/powerplay/hwmgr/smu10_hwmgr.c   |    2 +-
+ .../gpu/drm/amd/pm/powerplay/smumgr/fiji_smumgr.c  |    5 +-
+ .../drm/amd/pm/powerplay/smumgr/iceland_smumgr.c   |    5 +-
+ .../drm/amd/pm/powerplay/smumgr/polaris10_smumgr.c |    5 +-
+ .../gpu/drm/amd/pm/powerplay/smumgr/smu7_smumgr.c  |    2 +-
+ .../gpu/drm/amd/pm/powerplay/smumgr/tonga_smumgr.c |    5 +-
+ drivers/gpu/drm/amd/pm/swsmu/amdgpu_smu.c          |   97 +-
+ drivers/gpu/drm/amd/pm/swsmu/inc/amdgpu_smu.h      |  129 +-
+ .../amd/pm/swsmu/inc/pmfw_if/smu_v13_0_12_pmfw.h   |   82 +-
+ .../amd/pm/swsmu/inc/pmfw_if/smu_v13_0_12_ppsmc.h  |    6 +-
+ .../amd/pm/swsmu/inc/pmfw_if/smu_v13_0_6_ppsmc.h   |    4 +-
+ drivers/gpu/drm/amd/pm/swsmu/inc/smu_types.h       |    4 +-
+ drivers/gpu/drm/amd/pm/swsmu/smu11/arcturus_ppt.c  |   21 +-
+ drivers/gpu/drm/amd/pm/swsmu/smu11/navi10_ppt.c    |   19 +-
+ .../drm/amd/pm/swsmu/smu11/sienna_cichlid_ppt.c    |   19 +-
+ drivers/gpu/drm/amd/pm/swsmu/smu12/renoir_ppt.c    |    2 +-
+ drivers/gpu/drm/amd/pm/swsmu/smu13/aldebaran_ppt.c |   17 +-
+ .../gpu/drm/amd/pm/swsmu/smu13/smu_v13_0_0_ppt.c   |   19 +-
+ .../gpu/drm/amd/pm/swsmu/smu13/smu_v13_0_12_ppt.c  |  367 +-
+ .../gpu/drm/amd/pm/swsmu/smu13/smu_v13_0_6_ppt.c   |  213 +-
+ .../gpu/drm/amd/pm/swsmu/smu13/smu_v13_0_6_ppt.h   |   11 +
+ .../gpu/drm/amd/pm/swsmu/smu14/smu_v14_0_2_ppt.c   |   19 +-
+ drivers/gpu/drm/amd/pm/swsmu/smu_cmn.c             |   14 +-
+ drivers/gpu/drm/amd/pm/swsmu/smu_cmn.h             |   26 +
+ drivers/gpu/drm/ast/ast_2100.c                     |   46 +-
+ drivers/gpu/drm/ast/ast_drv.h                      |   20 +-
+ drivers/gpu/drm/ast/ast_main.c                     |  126 -
+ drivers/gpu/drm/bridge/Kconfig                     |   29 +-
+ drivers/gpu/drm/bridge/Makefile                    |    2 +
+ drivers/gpu/drm/bridge/adv7511/adv7511.h           |    6 +-
+ drivers/gpu/drm/bridge/adv7511/adv7511_audio.c     |   23 +-
+ drivers/gpu/drm/bridge/adv7511/adv7511_drv.c       |   63 +-
+ drivers/gpu/drm/bridge/analogix/anx7625.c          |    1 +
+ drivers/gpu/drm/bridge/cadence/Kconfig             |    1 +
+ drivers/gpu/drm/bridge/cadence/cdns-dsi-core.c     |  211 +-
+ drivers/gpu/drm/bridge/display-connector.c         |    7 +-
+ drivers/gpu/drm/bridge/imx/imx93-mipi-dsi.c        |   12 +-
+ drivers/gpu/drm/bridge/ite-it6263.c                |   64 +-
+ drivers/gpu/drm/bridge/ite-it6505.c                |   33 +-
+ drivers/gpu/drm/bridge/samsung-dsim.c              |  353 +-
+ drivers/gpu/drm/bridge/simple-bridge.c             |   10 +
+ drivers/gpu/drm/bridge/ssd2825.c                   |  775 ++++
+ drivers/gpu/drm/bridge/synopsys/Kconfig            |    7 +
+ drivers/gpu/drm/bridge/synopsys/Makefile           |    1 +
+ drivers/gpu/drm/bridge/synopsys/dw-dp.c            | 2095 ++++++++++
+ drivers/gpu/drm/bridge/waveshare-dsi.c             |  203 +
+ drivers/gpu/drm/display/drm_bridge_connector.c     |   20 +-
+ drivers/gpu/drm/display/drm_dp_helper.c            |    4 +-
+ drivers/gpu/drm/drm_atomic_helper.c                |    7 +
+ drivers/gpu/drm/drm_atomic_uapi.c                  |   23 +-
+ drivers/gpu/drm/drm_bridge.c                       |    7 +-
+ drivers/gpu/drm/drm_color_mgmt.c                   |   34 +
+ drivers/gpu/drm/drm_drv.c                          |    4 +-
+ drivers/gpu/drm/drm_format_helper.c                |  111 +
+ drivers/gpu/drm/drm_gem.c                          |   88 +-
+ drivers/gpu/drm/drm_gpusvm.c                       |  421 +-
+ drivers/gpu/drm/drm_gpuvm.c                        |  317 +-
+ drivers/gpu/drm/drm_internal.h                     |    4 +
+ drivers/gpu/drm/drm_ioctl.c                        |    1 +
+ drivers/gpu/drm/drm_mipi_dsi.c                     |  119 +-
+ drivers/gpu/drm/drm_of.c                           |    7 +-
+ drivers/gpu/drm/drm_pagemap.c                      |  142 +-
+ drivers/gpu/drm/drm_panel.c                        |   73 +-
+ drivers/gpu/drm/drm_panel_backlight_quirks.c       |  115 +-
+ drivers/gpu/drm/drm_prime.c                        |    6 +-
+ drivers/gpu/drm/drm_probe_helper.c                 |    1 +
+ drivers/gpu/drm/drm_sysfs.c                        |   41 +
+ drivers/gpu/drm/exynos/exynos7_drm_decon.c         |   36 -
+ drivers/gpu/drm/exynos/exynos_drm_dsi.c            |    9 +
+ drivers/gpu/drm/gma500/fbdev.c                     |    2 -
+ drivers/gpu/drm/gud/gud_connector.c                |   25 +-
+ drivers/gpu/drm/gud/gud_drv.c                      |   54 +-
+ drivers/gpu/drm/gud/gud_internal.h                 |   13 +-
+ drivers/gpu/drm/gud/gud_pipe.c                     |   64 +-
+ drivers/gpu/drm/i915/Kconfig.debug                 |    2 +-
+ drivers/gpu/drm/i915/Makefile                      |    2 +
+ drivers/gpu/drm/i915/display/g4x_dp.c              |   51 +-
+ drivers/gpu/drm/i915/display/g4x_hdmi.c            |   15 +-
+ drivers/gpu/drm/i915/display/i9xx_plane.c          |   62 +-
+ drivers/gpu/drm/i915/display/i9xx_plane.h          |    1 +
+ drivers/gpu/drm/i915/display/i9xx_wm.c             |   32 +-
+ drivers/gpu/drm/i915/display/icl_dsi.c             |   59 +-
+ drivers/gpu/drm/i915/display/intel_alpm.c          |  133 +-
+ drivers/gpu/drm/i915/display/intel_backlight.c     |    3 +-
+ drivers/gpu/drm/i915/display/intel_bios.c          |   46 +-
+ drivers/gpu/drm/i915/display/intel_bios.h          |  176 +-
+ drivers/gpu/drm/i915/display/intel_bo.c            |   17 +-
+ drivers/gpu/drm/i915/display/intel_bo.h            |    3 -
+ drivers/gpu/drm/i915/display/intel_bw.c            |    2 +-
+ drivers/gpu/drm/i915/display/intel_cdclk.c         |   56 +-
+ drivers/gpu/drm/i915/display/intel_connector.c     |    2 +-
+ drivers/gpu/drm/i915/display/intel_connector.h     |    1 -
+ drivers/gpu/drm/i915/display/intel_crt.c           |    5 +-
+ drivers/gpu/drm/i915/display/intel_cursor.c        |   28 +-
+ drivers/gpu/drm/i915/display/intel_ddi.c           |  142 +-
+ drivers/gpu/drm/i915/display/intel_display.c       |    9 +
+ .../drm/i915/display/intel_display_conversion.c    |    2 +-
+ .../drm/i915/display/intel_display_conversion.h    |   12 -
+ .../gpu/drm/i915/display/intel_display_debugfs.c   |    6 +-
+ .../i915/display/intel_display_debugfs_params.c    |    7 +-
+ .../gpu/drm/i915/display/intel_display_device.c    |   20 +-
+ .../gpu/drm/i915/display/intel_display_device.h    |    8 +-
+ .../gpu/drm/i915/display/intel_display_driver.c    |    1 +
+ drivers/gpu/drm/i915/display/intel_display_irq.c   |    9 +-
+ .../gpu/drm/i915/display/intel_display_params.c    |    3 +
+ .../gpu/drm/i915/display/intel_display_params.h    |    1 +
+ drivers/gpu/drm/i915/display/intel_display_power.c |   24 +-
+ .../gpu/drm/i915/display/intel_display_power_map.c |   57 +-
+ .../drm/i915/display/intel_display_power_well.c    |   52 +-
+ drivers/gpu/drm/i915/display/intel_display_regs.h  |    2 +
+ drivers/gpu/drm/i915/display/intel_display_types.h |   18 +-
+ drivers/gpu/drm/i915/display/intel_display_wa.c    |   35 +
+ drivers/gpu/drm/i915/display/intel_display_wa.h    |   11 +
+ drivers/gpu/drm/i915/display/intel_dmc.c           |    4 +-
+ drivers/gpu/drm/i915/display/intel_dp.c            |  137 +-
+ drivers/gpu/drm/i915/display/intel_dp.h            |    3 +-
+ .../gpu/drm/i915/display/intel_dp_aux_backlight.c  |   16 -
+ .../gpu/drm/i915/display/intel_dp_link_training.c  |  156 +-
+ .../gpu/drm/i915/display/intel_dp_link_training.h  |    2 +-
+ drivers/gpu/drm/i915/display/intel_dp_mst.c        |   11 +-
+ drivers/gpu/drm/i915/display/intel_dp_test.c       |    4 +-
+ drivers/gpu/drm/i915/display/intel_dpll_mgr.c      |   20 +-
+ drivers/gpu/drm/i915/display/intel_dpt.c           |    4 +-
+ drivers/gpu/drm/i915/display/intel_dsb.c           |   10 +-
+ drivers/gpu/drm/i915/display/intel_dsi_vbt.c       |    2 +-
+ drivers/gpu/drm/i915/display/intel_dsi_vbt_defs.h  |  197 +
+ drivers/gpu/drm/i915/display/intel_encoder.c       |   41 +
+ drivers/gpu/drm/i915/display/intel_encoder.h       |    6 +
+ drivers/gpu/drm/i915/display/intel_fb.c            |   24 +-
+ drivers/gpu/drm/i915/display/intel_fb.h            |    3 +
+ drivers/gpu/drm/i915/display/intel_fb_pin.c        |   39 +-
+ drivers/gpu/drm/i915/display/intel_fbc.c           |   19 +-
+ drivers/gpu/drm/i915/display/intel_fdi.c           |   28 -
+ drivers/gpu/drm/i915/display/intel_fdi.h           |    1 -
+ drivers/gpu/drm/i915/display/intel_global_state.c  |   32 +-
+ drivers/gpu/drm/i915/display/intel_global_state.h  |   36 +-
+ drivers/gpu/drm/i915/display/intel_gmbus.c         |   53 +-
+ drivers/gpu/drm/i915/display/intel_hdcp.c          |   33 +-
+ drivers/gpu/drm/i915/display/intel_hdmi.c          |   24 +-
+ drivers/gpu/drm/i915/display/intel_hotplug.c       |   11 +-
+ drivers/gpu/drm/i915/display/intel_hotplug_irq.c   |    2 +-
+ drivers/gpu/drm/i915/display/intel_link_bw.c       |   34 +-
+ drivers/gpu/drm/i915/display/intel_link_bw.h       |    1 +
+ drivers/gpu/drm/i915/display/intel_lpe_audio.c     |   11 +-
+ drivers/gpu/drm/i915/display/intel_lspcon.c        |   13 +-
+ drivers/gpu/drm/i915/display/intel_lvds.c          |    3 +-
+ drivers/gpu/drm/i915/display/intel_opregion.c      |   14 +-
+ drivers/gpu/drm/i915/display/intel_overlay.c       |    5 +-
+ drivers/gpu/drm/i915/display/intel_panic.c         |   27 +
+ drivers/gpu/drm/i915/display/intel_panic.h         |   14 +
+ drivers/gpu/drm/i915/display/intel_pch.h           |    4 +-
+ drivers/gpu/drm/i915/display/intel_pch_refclk.c    |   14 +-
+ drivers/gpu/drm/i915/display/intel_pfit.c          |   11 +
+ drivers/gpu/drm/i915/display/intel_pfit.h          |   10 +-
+ drivers/gpu/drm/i915/display/intel_plane.c         |   12 +-
+ drivers/gpu/drm/i915/display/intel_plane.h         |    1 -
+ drivers/gpu/drm/i915/display/intel_plane_initial.c |    2 +
+ drivers/gpu/drm/i915/display/intel_pps.c           |   10 +-
+ drivers/gpu/drm/i915/display/intel_psr.c           |  190 +-
+ drivers/gpu/drm/i915/display/intel_psr.h           |    2 +
+ drivers/gpu/drm/i915/display/intel_quirks.c        |    9 +
+ drivers/gpu/drm/i915/display/intel_quirks.h        |    1 +
+ drivers/gpu/drm/i915/display/intel_sdvo.c          |   10 +-
+ drivers/gpu/drm/i915/display/intel_sprite.c        |   51 +-
+ drivers/gpu/drm/i915/display/intel_tc.c            |  179 +-
+ drivers/gpu/drm/i915/display/intel_tc.h            |   72 +-
+ drivers/gpu/drm/i915/display/intel_vblank.c        |   16 +-
+ drivers/gpu/drm/i915/display/intel_vbt_defs.h      |   20 +-
+ drivers/gpu/drm/i915/display/intel_wm.c            |    9 +-
+ drivers/gpu/drm/i915/display/skl_scaler.c          |   53 +-
+ drivers/gpu/drm/i915/display/skl_scaler.h          |   13 +
+ drivers/gpu/drm/i915/display/skl_universal_plane.c |   64 +-
+ drivers/gpu/drm/i915/display/skl_watermark.c       |   20 +-
+ drivers/gpu/drm/i915/display/vlv_dsi.c             |    4 +-
+ drivers/gpu/drm/i915/display/vlv_dsi_pll.c         |   32 +-
+ drivers/gpu/drm/i915/gem/i915_gem_context.c        |   12 +-
+ drivers/gpu/drm/i915/gem/i915_gem_execbuffer.c     |   59 +-
+ drivers/gpu/drm/i915/gem/i915_gem_object.c         |    4 +-
+ drivers/gpu/drm/i915/gem/i915_gem_object.h         |   11 +-
+ drivers/gpu/drm/i915/gem/i915_gem_pages.c          |   40 +-
+ drivers/gpu/drm/i915/gem/i915_gem_shrinker.c       |    4 +-
+ drivers/gpu/drm/i915/gem/i915_gem_wait.c           |    8 +-
+ .../drm/i915/gem/selftests/i915_gem_client_blt.c   |    5 +-
+ drivers/gpu/drm/i915/gem/selftests/i915_gem_mman.c |   70 +-
+ drivers/gpu/drm/i915/gt/intel_context_types.h      |    1 -
+ .../gpu/drm/i915/gt/intel_execlists_submission.c   |    6 +-
+ drivers/gpu/drm/i915/gt/intel_gt_buffer_pool.c     |    1 +
+ drivers/gpu/drm/i915/gt/intel_gt_clock_utils.c     |    2 +-
+ drivers/gpu/drm/i915/gt/intel_gt_debugfs.c         |    5 +-
+ drivers/gpu/drm/i915/gt/intel_gt_mcr.c             |    1 +
+ drivers/gpu/drm/i915/gt/intel_rc6.c                |    2 +-
+ drivers/gpu/drm/i915/gt/intel_reset.c              |    7 +-
+ drivers/gpu/drm/i915/gt/intel_reset_types.h        |    2 +-
+ drivers/gpu/drm/i915/gt/intel_ring_submission.c    |    7 +-
+ drivers/gpu/drm/i915/gt/intel_rps.c                |   13 +-
+ drivers/gpu/drm/i915/gt/intel_timeline.h           |    1 +
+ drivers/gpu/drm/i915/gt/intel_workarounds.c        |   29 +-
+ drivers/gpu/drm/i915/gt/selftest_hangcheck.c       |    2 +-
+ drivers/gpu/drm/i915/gt/selftest_tlb.c             |    6 +-
+ drivers/gpu/drm/i915/gt/sysfs_engines.c            |    1 +
+ drivers/gpu/drm/i915/gt/uc/intel_gsc_proxy.c       |    6 +-
+ .../drm/i915/gt/uc/intel_gsc_uc_heci_cmd_submit.c  |    2 +
+ drivers/gpu/drm/i915/gt/uc/intel_guc.c             |    8 +-
+ drivers/gpu/drm/i915/gt/uc/intel_guc_ct.c          |   14 +-
+ drivers/gpu/drm/i915/gt/uc/intel_guc_ct.h          |    2 +-
+ drivers/gpu/drm/i915/gt/uc/intel_guc_fw.c          |   12 +-
+ drivers/gpu/drm/i915/gt/uc/intel_guc_log.c         |   12 +-
+ drivers/gpu/drm/i915/gt/uc/intel_guc_log.h         |    8 +
+ drivers/gpu/drm/i915/gt/uc/intel_guc_reg.h         |    1 +
+ drivers/gpu/drm/i915/gt/uc/intel_guc_slpc.c        |   15 +-
+ drivers/gpu/drm/i915/gt/uc/intel_guc_submission.c  |   10 +-
+ drivers/gpu/drm/i915/gvt/cmd_parser.c              |    2 +-
+ drivers/gpu/drm/i915/gvt/debugfs.c                 |   12 +-
+ drivers/gpu/drm/i915/gvt/mmio_context.c            |    6 +-
+ drivers/gpu/drm/i915/i915_active.c                 |    5 +-
+ drivers/gpu/drm/i915/i915_debugfs.c                |   23 +-
+ drivers/gpu/drm/i915/i915_debugfs_params.c         |    4 +-
+ drivers/gpu/drm/i915/i915_driver.c                 |   18 +-
+ drivers/gpu/drm/i915/i915_drv.h                    |    8 +-
+ drivers/gpu/drm/i915/i915_gem.c                    |    3 +-
+ drivers/gpu/drm/i915/i915_gpu_error.c              |  108 +-
+ drivers/gpu/drm/i915/i915_gpu_error.h              |    1 +
+ drivers/gpu/drm/i915/i915_irq.c                    |   19 +-
+ drivers/gpu/drm/i915/i915_list_util.h              |   23 +
+ drivers/gpu/drm/i915/i915_ptr_util.h               |   66 +
+ drivers/gpu/drm/i915/i915_reg.h                    |    9 +-
+ drivers/gpu/drm/i915/i915_request.h                |    5 +-
+ drivers/gpu/drm/i915/i915_switcheroo.c             |    9 +-
+ drivers/gpu/drm/i915/i915_timer_util.c             |   36 +
+ drivers/gpu/drm/i915/i915_timer_util.h             |   23 +
+ drivers/gpu/drm/i915/i915_utils.c                  |   30 -
+ drivers/gpu/drm/i915/i915_utils.h                  |  210 -
+ drivers/gpu/drm/i915/i915_vma.h                    |    6 +-
+ drivers/gpu/drm/i915/i915_wait_util.h              |  119 +
+ drivers/gpu/drm/i915/intel_clock_gating.c          |   35 +-
+ drivers/gpu/drm/i915/intel_gvt_mmio_table.c        |  266 +-
+ drivers/gpu/drm/i915/intel_pcode.c                 |    1 +
+ drivers/gpu/drm/i915/intel_uncore.c                |   10 +-
+ drivers/gpu/drm/i915/pxp/intel_pxp.c               |    4 +-
+ drivers/gpu/drm/i915/pxp/intel_pxp_debugfs.c       |    8 +-
+ drivers/gpu/drm/i915/selftests/i915_request.c      |    5 +-
+ drivers/gpu/drm/i915/selftests/i915_selftest.c     |    2 +-
+ drivers/gpu/drm/i915/selftests/igt_spinner.c       |    5 +-
+ drivers/gpu/drm/i915/selftests/intel_uncore.c      |    8 +-
+ drivers/gpu/drm/i915/soc/intel_dram.c              |   97 +-
+ drivers/gpu/drm/i915/soc/intel_dram.h              |   13 +-
+ drivers/gpu/drm/i915/soc/intel_gmch.c              |    3 +-
+ drivers/gpu/drm/i915/vlv_suspend.c                 |    5 +-
+ drivers/gpu/drm/imagination/Kconfig                |    3 +-
+ drivers/gpu/drm/imagination/pvr_device.c           |   22 +-
+ drivers/gpu/drm/imagination/pvr_device.h           |   17 +
+ drivers/gpu/drm/imagination/pvr_drv.c              |   23 +-
+ drivers/gpu/drm/imagination/pvr_power.c            |  168 +-
+ drivers/gpu/drm/imagination/pvr_power.h            |   15 +
+ drivers/gpu/drm/imagination/pvr_vm.c               |   15 +-
+ drivers/gpu/drm/msm/msm_gem_vma.c                  |   36 +-
+ drivers/gpu/drm/mxsfb/lcdif_kms.c                  |    4 +-
+ drivers/gpu/drm/nouveau/Kconfig                    |    8 -
+ drivers/gpu/drm/nouveau/nouveau_chan.h             |    2 -
+ drivers/gpu/drm/nouveau/nouveau_dma.h              |    1 -
+ drivers/gpu/drm/nouveau/nouveau_platform.c         |    5 +-
+ drivers/gpu/drm/nouveau/nouveau_prime.c            |   12 +
+ drivers/gpu/drm/nouveau/nouveau_uvmm.c             |   11 +-
+ drivers/gpu/drm/nouveau/nvkm/core/enum.c           |    2 +-
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/ad102.c    |    4 +-
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/base.c     |    4 +-
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/gb100.c    |    2 +-
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/gb202.c    |    2 +-
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/gh100.c    |    2 +-
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/priv.h     |    1 -
+ .../gpu/drm/nouveau/nvkm/subdev/gsp/rm/r535/gsp.c  |    3 +
+ drivers/gpu/drm/nouveau/nvkm/subdev/gsp/tu102.c    |    6 +-
+ drivers/gpu/drm/nova/driver.rs                     |    4 +-
+ drivers/gpu/drm/nova/file.rs                       |   24 +-
+ drivers/gpu/drm/nova/gem.rs                        |   10 +-
+ drivers/gpu/drm/nova/nova.rs                       |    1 -
+ drivers/gpu/drm/nova/uapi.rs                       |   61 -
+ drivers/gpu/drm/omapdrm/omap_drv.c                 |    6 +-
+ drivers/gpu/drm/panel/Kconfig                      |   26 +-
+ drivers/gpu/drm/panel/Makefile                     |    2 +
+ drivers/gpu/drm/panel/panel-edp.c                  |   55 +-
+ drivers/gpu/drm/panel/panel-himax-hx8279.c         |    2 +-
+ drivers/gpu/drm/panel/panel-hydis-hv101hd1.c       |  188 +
+ drivers/gpu/drm/panel/panel-ilitek-ili9881c.c      |  302 +-
+ drivers/gpu/drm/panel/panel-jdi-lpm102a188a.c      |  196 +-
+ drivers/gpu/drm/panel/panel-lvds.c                 |    2 -
+ drivers/gpu/drm/panel/panel-novatek-nt35560.c      |  198 +-
+ drivers/gpu/drm/panel/panel-novatek-nt36523.c      |  804 ++--
+ drivers/gpu/drm/panel/panel-orisetech-ota5601a.c   |    7 +-
+ .../drm/panel/panel-samsung-s6e88a0-ams427ap24.c   |    2 +
+ .../panel/panel-samsung-s6e8aa5x01-ams561ra01.c    |  981 +++++
+ drivers/gpu/drm/panel/panel-simple.c               |   26 +
+ drivers/gpu/drm/panel/panel-sitronix-st7703.c      |    2 +-
+ drivers/gpu/drm/panel/panel-summit.c               |    2 +
+ drivers/gpu/drm/panfrost/panfrost_perfcnt.c        |    2 -
+ drivers/gpu/drm/panthor/Makefile                   |    1 +
+ drivers/gpu/drm/panthor/panthor_device.c           |    5 +
+ drivers/gpu/drm/panthor/panthor_drv.c              |   25 +-
+ drivers/gpu/drm/panthor/panthor_fw.c               |    5 +
+ drivers/gpu/drm/panthor/panthor_gem.c              |    3 -
+ drivers/gpu/drm/panthor/panthor_gem.h              |   12 -
+ drivers/gpu/drm/panthor/panthor_gpu.c              |  100 +-
+ drivers/gpu/drm/panthor/panthor_hw.c               |  125 +
+ drivers/gpu/drm/panthor/panthor_hw.h               |   11 +
+ drivers/gpu/drm/panthor/panthor_mmu.c              |   76 +-
+ drivers/gpu/drm/panthor/panthor_regs.h             |    3 +
+ drivers/gpu/drm/panthor/panthor_sched.c            |   43 +-
+ drivers/gpu/drm/radeon/atombios_encoders.c         |    2 +-
+ drivers/gpu/drm/radeon/ci_dpm.c                    |   14 +-
+ drivers/gpu/drm/radeon/evergreen_cs.c              |  523 +--
+ drivers/gpu/drm/radeon/ni_dpm.c                    |    2 +-
+ drivers/gpu/drm/radeon/r100.c                      |  215 +-
+ drivers/gpu/drm/radeon/r200.c                      |   34 +-
+ drivers/gpu/drm/radeon/r300.c                      |   66 +-
+ drivers/gpu/drm/radeon/r600_cs.c                   |  449 +-
+ drivers/gpu/drm/radeon/radeon_cs.c                 |    2 +-
+ drivers/gpu/drm/radeon/radeon_device.c             |    4 +-
+ drivers/gpu/drm/radeon/radeon_display.c            |    4 +-
+ drivers/gpu/drm/radeon/radeon_gart.c               |    8 +-
+ drivers/gpu/drm/radeon/radeon_legacy_encoders.c    |   20 +-
+ drivers/gpu/drm/radeon/radeon_pm.c                 |    3 +-
+ drivers/gpu/drm/radeon/radeon_test.c               |    4 +-
+ drivers/gpu/drm/radeon/radeon_vce.c                |    6 +-
+ drivers/gpu/drm/renesas/rcar-du/rcar_lvds.c        |    4 +-
+ drivers/gpu/drm/renesas/rcar-du/rcar_mipi_dsi.c    |  230 +-
+ .../gpu/drm/renesas/rcar-du/rcar_mipi_dsi_regs.h   |  133 +-
+ drivers/gpu/drm/renesas/rz-du/rzg2l_mipi_dsi.c     |    8 +-
+ drivers/gpu/drm/rockchip/Kconfig                   |    9 +
+ drivers/gpu/drm/rockchip/Makefile                  |    1 +
+ drivers/gpu/drm/rockchip/dw-mipi-dsi2-rockchip.c   |   21 +
+ drivers/gpu/drm/rockchip/dw_dp-rockchip.c          |  150 +
+ drivers/gpu/drm/rockchip/rockchip_drm_drv.c        |    1 +
+ drivers/gpu/drm/rockchip/rockchip_drm_drv.h        |    1 +
+ drivers/gpu/drm/scheduler/sched_entity.c           |   14 +-
+ drivers/gpu/drm/scheduler/sched_main.c             |   69 +-
+ drivers/gpu/drm/scheduler/tests/mock_scheduler.c   |    2 +-
+ drivers/gpu/drm/scheduler/tests/sched_tests.h      |    8 +-
+ drivers/gpu/drm/scheduler/tests/tests_basic.c      |    4 +-
+ drivers/gpu/drm/sitronix/st7571-i2c.c              |   45 +-
+ drivers/gpu/drm/solomon/ssd130x-spi.c              |    3 +-
+ drivers/gpu/drm/sti/sti_hqvdp.c                    |    2 +-
+ drivers/gpu/drm/stm/drv.c                          |   12 +-
+ drivers/gpu/drm/stm/ltdc.c                         |  197 +-
+ drivers/gpu/drm/stm/ltdc.h                         |    6 +
+ drivers/gpu/drm/sysfb/drm_sysfb_helper.h           |    2 +-
+ drivers/gpu/drm/sysfb/drm_sysfb_modeset.c          |   23 +-
+ drivers/gpu/drm/sysfb/drm_sysfb_screen_info.c      |   19 +-
+ drivers/gpu/drm/sysfb/simpledrm.c                  |   15 +-
+ drivers/gpu/drm/sysfb/vesadrm.c                    |  153 +-
+ drivers/gpu/drm/tests/drm_exec_test.c              |   22 +-
+ drivers/gpu/drm/tidss/tidss_crtc.c                 |    7 +-
+ drivers/gpu/drm/tidss/tidss_dispc.c                |  310 +-
+ drivers/gpu/drm/tidss/tidss_dispc.h                |    3 +
+ drivers/gpu/drm/tidss/tidss_dispc_regs.h           |   76 +
+ drivers/gpu/drm/tidss/tidss_drv.c                  |    9 +
+ drivers/gpu/drm/tidss/tidss_drv.h                  |    2 +
+ drivers/gpu/drm/tidss/tidss_oldi.c                 |    1 -
+ drivers/gpu/drm/tidss/tidss_plane.h                |    2 +
+ drivers/gpu/drm/tidss/tidss_scale_coefs.h          |    2 +
+ drivers/gpu/drm/tiny/Kconfig                       |   15 +
+ drivers/gpu/drm/tiny/Makefile                      |    1 +
+ drivers/gpu/drm/tiny/bochs.c                       |    2 +-
+ drivers/gpu/drm/tiny/pixpaper.c                    | 1165 ++++++
+ drivers/gpu/drm/tiny/repaper.c                     |   16 +-
+ drivers/gpu/drm/tiny/sharp-memory.c                |   27 +-
+ drivers/gpu/drm/ttm/ttm_bo.c                       |   15 +
+ drivers/gpu/drm/tyr/Kconfig                        |   19 +
+ drivers/gpu/drm/tyr/Makefile                       |    3 +
+ drivers/gpu/drm/tyr/driver.rs                      |  205 +
+ drivers/gpu/drm/tyr/file.rs                        |   56 +
+ drivers/gpu/drm/tyr/gem.rs                         |   18 +
+ drivers/gpu/drm/tyr/gpu.rs                         |  219 +
+ drivers/gpu/drm/tyr/regs.rs                        |  108 +
+ drivers/gpu/drm/tyr/tyr.rs                         |   22 +
+ drivers/gpu/drm/v3d/v3d_drv.c                      |   25 +-
+ drivers/gpu/drm/v3d/v3d_drv.h                      |   33 +-
+ drivers/gpu/drm/v3d/v3d_fence.c                    |   11 +-
+ drivers/gpu/drm/v3d/v3d_gem.c                      |   10 +-
+ drivers/gpu/drm/v3d/v3d_irq.c                      |   68 +-
+ drivers/gpu/drm/v3d/v3d_sched.c                    |   86 +-
+ drivers/gpu/drm/v3d/v3d_submit.c                   |    2 +-
+ drivers/gpu/drm/virtio/virtgpu_display.c           |    3 +-
+ drivers/gpu/drm/virtio/virtgpu_kms.c               |   20 +-
+ drivers/gpu/drm/virtio/virtgpu_object.c            |    4 +-
+ drivers/gpu/drm/virtio/virtgpu_plane.c             |    2 +-
+ drivers/gpu/drm/virtio/virtgpu_vq.c                |    2 +
+ drivers/gpu/drm/vkms/tests/vkms_config_test.c      |   51 +-
+ drivers/gpu/drm/vkms/tests/vkms_format_test.c      |  143 +-
+ drivers/gpu/drm/vkms/vkms_formats.c                |  327 +-
+ drivers/gpu/drm/vkms/vkms_formats.h                |    4 +-
+ drivers/gpu/drm/vkms/vkms_output.c                 |   13 +
+ drivers/gpu/drm/vkms/vkms_plane.c                  |   13 +-
+ drivers/gpu/drm/vkms/vkms_writeback.c              |    2 +
+ drivers/gpu/drm/vmwgfx/vmwgfx_fence.c              |    2 +-
+ drivers/gpu/drm/xe/Kconfig                         |    2 +-
+ drivers/gpu/drm/xe/Kconfig.debug                   |    1 +
+ drivers/gpu/drm/xe/Makefile                        |   16 +-
+ drivers/gpu/drm/xe/abi/guc_actions_abi.h           |   10 +
+ drivers/gpu/drm/xe/abi/guc_actions_slpc_abi.h      |    5 +
+ drivers/gpu/drm/xe/abi/guc_errors_abi.h            |    3 +
+ drivers/gpu/drm/xe/abi/guc_klvs_abi.h              |    2 +
+ .../xe/compat-i915-headers/gem/i915_gem_stolen.h   |   15 +-
+ drivers/gpu/drm/xe/compat-i915-headers/i915_drv.h  |   22 -
+ drivers/gpu/drm/xe/display/ext/i915_utils.c        |    1 +
+ drivers/gpu/drm/xe/display/intel_bo.c              |   91 -
+ drivers/gpu/drm/xe/display/intel_fbdev_fb.c        |   20 +-
+ drivers/gpu/drm/xe/display/xe_display.c            |   39 +-
+ drivers/gpu/drm/xe/display/xe_display_wa.c         |    2 +-
+ drivers/gpu/drm/xe/display/xe_dsb_buffer.c         |   10 +-
+ drivers/gpu/drm/xe/display/xe_fb_pin.c             |   85 +-
+ drivers/gpu/drm/xe/display/xe_hdcp_gsc.c           |    8 +-
+ drivers/gpu/drm/xe/display/xe_panic.c              |   80 +
+ drivers/gpu/drm/xe/display/xe_plane_initial.c      |   13 +-
+ drivers/gpu/drm/xe/instructions/xe_mi_commands.h   |    1 +
+ drivers/gpu/drm/xe/regs/xe_engine_regs.h           |    3 +
+ drivers/gpu/drm/xe/regs/xe_gsc_regs.h              |    2 +
+ drivers/gpu/drm/xe/regs/xe_gt_regs.h               |    3 +-
+ drivers/gpu/drm/xe/regs/xe_hw_error_regs.h         |   20 +
+ drivers/gpu/drm/xe/regs/xe_irq_regs.h              |    1 +
+ drivers/gpu/drm/xe/regs/xe_lrc_layout.h            |    3 -
+ drivers/gpu/drm/xe/regs/xe_pmt.h                   |   10 +
+ drivers/gpu/drm/xe/tests/xe_bo.c                   |   36 +-
+ drivers/gpu/drm/xe/tests/xe_dma_buf.c              |   29 +-
+ drivers/gpu/drm/xe/tests/xe_guc_g2g_test.c         |  776 ++++
+ drivers/gpu/drm/xe/tests/xe_live_test_mod.c        |    2 +
+ drivers/gpu/drm/xe/tests/xe_migrate.c              |   66 +-
+ drivers/gpu/drm/xe/tests/xe_pci.c                  |  232 +-
+ drivers/gpu/drm/xe/tests/xe_pci_test.h             |    6 +-
+ drivers/gpu/drm/xe/tests/xe_wa_test.c              |   90 +-
+ drivers/gpu/drm/xe/xe_assert.h                     |    4 +-
+ drivers/gpu/drm/xe/xe_bb.c                         |   35 +
+ drivers/gpu/drm/xe/xe_bb.h                         |    3 +
+ drivers/gpu/drm/xe/xe_bo.c                         |  916 +++-
+ drivers/gpu/drm/xe/xe_bo.h                         |   82 +-
+ drivers/gpu/drm/xe/xe_bo_types.h                   |   25 +-
+ drivers/gpu/drm/xe/xe_configfs.c                   |  798 +++-
+ drivers/gpu/drm/xe/xe_configfs.h                   |   16 +-
+ drivers/gpu/drm/xe/xe_debugfs.c                    |  142 +
+ drivers/gpu/drm/xe/xe_dep_job_types.h              |   29 +
+ drivers/gpu/drm/xe/xe_dep_scheduler.c              |  143 +
+ drivers/gpu/drm/xe/xe_dep_scheduler.h              |   21 +
+ drivers/gpu/drm/xe/xe_device.c                     |  121 +-
+ drivers/gpu/drm/xe/xe_device.h                     |    1 +
+ drivers/gpu/drm/xe/xe_device_sysfs.c               |  110 +-
+ drivers/gpu/drm/xe/xe_device_types.h               |  102 +-
+ drivers/gpu/drm/xe/xe_dma_buf.c                    |   82 +-
+ drivers/gpu/drm/xe/xe_eu_stall.c                   |    9 +-
+ drivers/gpu/drm/xe/xe_exec.c                       |   31 +-
+ drivers/gpu/drm/xe/xe_exec_queue.c                 |  111 +
+ drivers/gpu/drm/xe/xe_exec_queue.h                 |    5 +
+ drivers/gpu/drm/xe/xe_exec_queue_types.h           |   15 +
+ drivers/gpu/drm/xe/xe_ggtt.c                       |   42 +-
+ drivers/gpu/drm/xe/xe_ggtt.h                       |    5 +-
+ drivers/gpu/drm/xe/xe_gpu_scheduler.c              |   13 +
+ drivers/gpu/drm/xe/xe_gpu_scheduler.h              |    1 +
+ drivers/gpu/drm/xe/xe_gsc.c                        |   14 +-
+ drivers/gpu/drm/xe/xe_gt.c                         |   33 +-
+ drivers/gpu/drm/xe/xe_gt_debugfs.c                 |   49 +-
+ drivers/gpu/drm/xe/xe_gt_freq.c                    |   28 +
+ drivers/gpu/drm/xe/xe_gt_idle.c                    |   21 +-
+ drivers/gpu/drm/xe/xe_gt_idle.h                    |    2 +-
+ drivers/gpu/drm/xe/xe_gt_mcr.c                     |    6 +-
+ drivers/gpu/drm/xe/xe_gt_mcr.h                     |    3 +-
+ drivers/gpu/drm/xe/xe_gt_pagefault.c               |   57 +-
+ drivers/gpu/drm/xe/xe_gt_printk.h                  |   32 +-
+ drivers/gpu/drm/xe/xe_gt_sriov_pf.c                |   24 +-
+ drivers/gpu/drm/xe/xe_gt_sriov_pf_config.c         |   34 +-
+ drivers/gpu/drm/xe/xe_gt_sriov_pf_migration.c      |   24 +-
+ drivers/gpu/drm/xe/xe_gt_sriov_vf.c                |   14 +
+ drivers/gpu/drm/xe/xe_gt_sriov_vf.h                |    1 +
+ drivers/gpu/drm/xe/xe_gt_stats.c                   |   57 +-
+ drivers/gpu/drm/xe/xe_gt_stats.h                   |    1 +
+ drivers/gpu/drm/xe/xe_gt_stats_types.h             |   33 +
+ drivers/gpu/drm/xe/xe_gt_tlb_invalidation.c        |  596 ---
+ drivers/gpu/drm/xe/xe_gt_tlb_invalidation.h        |   40 -
+ drivers/gpu/drm/xe/xe_gt_tlb_invalidation_types.h  |   32 -
+ drivers/gpu/drm/xe/xe_gt_topology.c                |   48 +-
+ drivers/gpu/drm/xe/xe_gt_topology.h                |    4 +
+ drivers/gpu/drm/xe/xe_gt_types.h                   |   33 +-
+ drivers/gpu/drm/xe/xe_guc.c                        |   89 +-
+ drivers/gpu/drm/xe/xe_guc.h                        |    4 +
+ drivers/gpu/drm/xe/xe_guc_ads.c                    |  123 +-
+ drivers/gpu/drm/xe/xe_guc_buf.c                    |    2 +-
+ drivers/gpu/drm/xe/xe_guc_ct.c                     |   63 +-
+ drivers/gpu/drm/xe/xe_guc_ct.h                     |    1 +
+ drivers/gpu/drm/xe/xe_guc_engine_activity.c        |   13 +-
+ drivers/gpu/drm/xe/xe_guc_fwif.h                   |   37 +-
+ drivers/gpu/drm/xe/xe_guc_log.h                    |    2 +-
+ drivers/gpu/drm/xe/xe_guc_pc.c                     |   90 +-
+ drivers/gpu/drm/xe/xe_guc_pc.h                     |    2 +
+ drivers/gpu/drm/xe/xe_guc_pc_types.h               |    2 +
+ drivers/gpu/drm/xe/xe_guc_submit.c                 |  215 +-
+ drivers/gpu/drm/xe/xe_guc_submit.h                 |   10 +
+ drivers/gpu/drm/xe/xe_guc_tlb_inval.c              |  242 ++
+ drivers/gpu/drm/xe/xe_guc_tlb_inval.h              |   19 +
+ drivers/gpu/drm/xe/xe_guc_types.h                  |    6 +
+ drivers/gpu/drm/xe/xe_heci_gsc.c                   |    2 +-
+ drivers/gpu/drm/xe/xe_hmm.c                        |  325 --
+ drivers/gpu/drm/xe/xe_hmm.h                        |   18 -
+ drivers/gpu/drm/xe/xe_hw_engine.c                  |    2 +-
+ drivers/gpu/drm/xe/xe_hw_engine_group.c            |    4 +-
+ drivers/gpu/drm/xe/xe_hw_error.c                   |  182 +
+ drivers/gpu/drm/xe/xe_hw_error.h                   |   15 +
+ drivers/gpu/drm/xe/xe_hwmon.c                      |   18 +-
+ drivers/gpu/drm/xe/xe_i2c.c                        |   20 +-
+ drivers/gpu/drm/xe/xe_i2c.h                        |    2 +
+ drivers/gpu/drm/xe/xe_irq.c                        |    4 +
+ drivers/gpu/drm/xe/xe_late_bind_fw.c               |  464 +++
+ drivers/gpu/drm/xe/xe_late_bind_fw.h               |   17 +
+ drivers/gpu/drm/xe/xe_late_bind_fw_types.h         |   75 +
+ drivers/gpu/drm/xe/xe_lmtt.c                       |   33 +-
+ drivers/gpu/drm/xe/xe_lrc.c                        |  264 +-
+ drivers/gpu/drm/xe/xe_lrc.h                        |    9 +
+ drivers/gpu/drm/xe/xe_migrate.c                    |  465 ++-
+ drivers/gpu/drm/xe/xe_migrate.h                    |   29 +-
+ drivers/gpu/drm/xe/xe_mmio.c                       |   33 -
+ drivers/gpu/drm/xe/xe_mmio_gem.c                   |  226 +
+ drivers/gpu/drm/xe/xe_mmio_gem.h                   |   20 +
+ drivers/gpu/drm/xe/xe_module.c                     |   29 +-
+ drivers/gpu/drm/xe/xe_nvm.c                        |    8 +-
+ drivers/gpu/drm/xe/xe_oa.c                         |   14 +-
+ drivers/gpu/drm/xe/xe_pci.c                        |  116 +-
+ drivers/gpu/drm/xe/xe_pci_types.h                  |    3 +-
+ drivers/gpu/drm/xe/xe_pm.c                         |   31 +-
+ drivers/gpu/drm/xe/xe_printk.h                     |  129 +
+ drivers/gpu/drm/xe/xe_psmi.c                       |  294 ++
+ drivers/gpu/drm/xe/xe_psmi.h                       |   14 +
+ drivers/gpu/drm/xe/xe_pt.c                         |  393 +-
+ drivers/gpu/drm/xe/xe_pt.h                         |    3 +-
+ drivers/gpu/drm/xe/xe_pt_types.h                   |    5 +-
+ drivers/gpu/drm/xe/xe_pxp.c                        |    1 +
+ drivers/gpu/drm/xe/xe_pxp_submit.c                 |   34 +-
+ drivers/gpu/drm/xe/xe_query.c                      |   14 +-
+ drivers/gpu/drm/xe/xe_res_cursor.h                 |   10 +-
+ drivers/gpu/drm/xe/xe_ring_ops.c                   |   22 +-
+ drivers/gpu/drm/xe/xe_rtp.c                        |   13 +
+ drivers/gpu/drm/xe/xe_rtp.h                        |    6 +
+ drivers/gpu/drm/xe/xe_sa.c                         |    1 -
+ drivers/gpu/drm/xe/xe_sa.h                         |   15 +-
+ drivers/gpu/drm/xe/xe_sa_types.h                   |    1 -
+ drivers/gpu/drm/xe/xe_sriov.c                      |   15 +
+ drivers/gpu/drm/xe/xe_sriov.h                      |    1 +
+ drivers/gpu/drm/xe/xe_sriov_vf.c                   |  191 +-
+ drivers/gpu/drm/xe/xe_sriov_vf.h                   |    6 +
+ drivers/gpu/drm/xe/xe_sriov_vf_ccs.c               |  410 ++
+ drivers/gpu/drm/xe/xe_sriov_vf_ccs.h               |   34 +
+ drivers/gpu/drm/xe/xe_sriov_vf_ccs_types.h         |   51 +
+ drivers/gpu/drm/xe/xe_sriov_vf_types.h             |   10 +
+ drivers/gpu/drm/xe/xe_survivability_mode.c         |  180 +-
+ drivers/gpu/drm/xe/xe_survivability_mode.h         |    5 +-
+ drivers/gpu/drm/xe/xe_survivability_mode_types.h   |    8 +
+ drivers/gpu/drm/xe/xe_svm.c                        |  727 +++-
+ drivers/gpu/drm/xe/xe_svm.h                        |   90 +-
+ drivers/gpu/drm/xe/xe_tile.c                       |   62 +-
+ drivers/gpu/drm/xe/xe_tile.h                       |   14 +-
+ drivers/gpu/drm/xe/xe_tile_debugfs.c               |  135 +
+ drivers/gpu/drm/xe/xe_tile_debugfs.h               |   13 +
+ drivers/gpu/drm/xe/xe_tile_printk.h                |  127 +
+ drivers/gpu/drm/xe/xe_tlb_inval.c                  |  433 ++
+ drivers/gpu/drm/xe/xe_tlb_inval.h                  |   46 +
+ drivers/gpu/drm/xe/xe_tlb_inval_job.c              |  268 ++
+ drivers/gpu/drm/xe/xe_tlb_inval_job.h              |   33 +
+ drivers/gpu/drm/xe/xe_tlb_inval_types.h            |  130 +
+ drivers/gpu/drm/xe/xe_trace.h                      |   40 +-
+ drivers/gpu/drm/xe/xe_ttm_stolen_mgr.c             |   12 +-
+ drivers/gpu/drm/xe/xe_ttm_vram_mgr.c               |   22 +-
+ drivers/gpu/drm/xe/xe_ttm_vram_mgr.h               |    3 +-
+ drivers/gpu/drm/xe/xe_tuning.c                     |    2 +-
+ drivers/gpu/drm/xe/xe_uc_fw.c                      |   29 +-
+ drivers/gpu/drm/xe/xe_uc_fw_abi.h                  |  130 +-
+ drivers/gpu/drm/xe/xe_uc_fw_types.h                |    3 +
+ drivers/gpu/drm/xe/xe_userptr.c                    |  319 ++
+ drivers/gpu/drm/xe/xe_userptr.h                    |  107 +
+ drivers/gpu/drm/xe/xe_validation.c                 |  278 ++
+ drivers/gpu/drm/xe/xe_validation.h                 |  192 +
+ drivers/gpu/drm/xe/xe_vm.c                         | 1162 +++---
+ drivers/gpu/drm/xe/xe_vm.h                         |   69 +-
+ drivers/gpu/drm/xe/xe_vm_madvise.c                 |  431 ++
+ drivers/gpu/drm/xe/xe_vm_madvise.h                 |   15 +
+ drivers/gpu/drm/xe/xe_vm_types.h                   |  145 +-
+ drivers/gpu/drm/xe/xe_vram.c                       |  211 +-
+ drivers/gpu/drm/xe/xe_vram.h                       |   11 +
+ drivers/gpu/drm/xe/xe_vram_freq.c                  |    4 +-
+ drivers/gpu/drm/xe/xe_vram_types.h                 |   85 +
+ drivers/gpu/drm/xe/xe_wa.c                         |   88 +-
+ drivers/gpu/drm/xe/xe_wa.h                         |    8 +-
+ drivers/gpu/drm/xe/xe_wa_oob.rules                 |   10 +-
+ drivers/gpu/nova-core/driver.rs                    |   13 +-
+ drivers/gpu/nova-core/falcon.rs                    |  113 +-
+ drivers/gpu/nova-core/falcon/gsp.rs                |   16 +-
+ drivers/gpu/nova-core/falcon/hal.rs                |    2 +-
+ drivers/gpu/nova-core/falcon/hal/ga102.rs          |   47 +-
+ drivers/gpu/nova-core/falcon/sec2.rs               |   13 +-
+ drivers/gpu/nova-core/fb.rs                        |    2 +-
+ drivers/gpu/nova-core/firmware.rs                  |  107 +-
+ drivers/gpu/nova-core/firmware/booter.rs           |  375 ++
+ drivers/gpu/nova-core/firmware/fwsec.rs            |   17 +-
+ drivers/gpu/nova-core/firmware/gsp.rs              |  243 ++
+ drivers/gpu/nova-core/firmware/riscv.rs            |   91 +
+ drivers/gpu/nova-core/gpu.rs                       |  216 +-
+ drivers/gpu/nova-core/gsp.rs                       |   22 +
+ drivers/gpu/nova-core/gsp/boot.rs                  |  137 +
+ drivers/gpu/nova-core/gsp/fw.rs                    |    7 +
+ drivers/gpu/nova-core/gsp/fw/r570_144.rs           |   29 +
+ drivers/gpu/nova-core/gsp/fw/r570_144/bindings.rs  |    1 +
+ drivers/gpu/nova-core/nova_core.rs                 |    1 +
+ drivers/gpu/nova-core/regs.rs                      |   84 +-
+ drivers/gpu/nova-core/regs/macros.rs               |  789 +++-
+ drivers/gpu/nova-core/util.rs                      |   20 -
+ drivers/gpu/nova-core/vbios.rs                     |  176 +-
+ drivers/hid/i2c-hid/i2c-hid-core.c                 |   46 +-
+ drivers/hid/i2c-hid/i2c-hid-of-elan.c              |   11 +-
+ drivers/misc/mei/Kconfig                           |   13 +
+ drivers/misc/mei/Makefile                          |    1 +
+ drivers/misc/mei/bus.c                             |   13 +
+ drivers/misc/mei/mei_lb.c                          |  312 ++
+ drivers/pci/vgaarb.c                               |   31 +-
+ drivers/video/screen_info_generic.c                |   55 +
+ include/drm/bridge/dw_dp.h                         |   20 +
+ include/drm/bridge/samsung-dsim.h                  |   16 +-
+ include/drm/drm_bridge.h                           |   47 +-
+ include/drm/drm_buddy.h                            |    9 -
+ include/drm/drm_color_mgmt.h                       |    1 +
+ include/drm/drm_device.h                           |   14 +-
+ include/drm/drm_format_helper.h                    |    4 +
+ include/drm/drm_gem.h                              |   51 +-
+ include/drm/drm_gpusvm.h                           |  136 +-
+ include/drm/drm_gpuvm.h                            |   68 +-
+ include/drm/drm_mipi_dsi.h                         |  153 +-
+ include/drm/drm_pagemap.h                          |   50 +-
+ include/drm/drm_panel.h                            |   14 +
+ include/drm/drm_utils.h                            |    8 +-
+ include/drm/intel/i915_component.h                 |    1 +
+ include/drm/intel/intel_lb_mei_interface.h         |   70 +
+ include/drm/intel/pciids.h                         |    5 +
+ include/drm/ttm/ttm_bo.h                           |    2 +
+ include/drm/ttm/ttm_resource.h                     |    2 +-
+ include/linux/fbcon.h                              |    7 +
+ include/linux/habanalabs/cpucp_if.h                |    4 +
+ include/linux/hid.h                                |    2 +
+ include/linux/iopoll.h                             |  170 +-
+ include/linux/list.h                               |   14 +
+ include/linux/mei_cl_bus.h                         |    1 +
+ include/linux/overflow.h                           |   70 +
+ include/linux/screen_info.h                        |    2 +
+ include/trace/events/habanalabs.h                  |    2 +-
+ include/uapi/drm/amdgpu_drm.h                      |   72 +-
+ include/uapi/drm/amdxdna_accel.h                   |  136 +
+ include/uapi/drm/drm.h                             |   63 +-
+ include/uapi/drm/drm_mode.h                        |    8 +
+ include/uapi/drm/panthor_drm.h                     |    3 +
+ include/uapi/drm/rocket_accel.h                    |  142 +
+ include/uapi/drm/v3d_drm.h                         |    2 +
+ include/uapi/drm/xe_drm.h                          |  282 +-
+ include/video/pixel_format.h                       |   61 +
+ rust/bindings/bindings_helper.h                    |    2 +
+ rust/helpers/helpers.c                             |    1 +
+ rust/helpers/scatterlist.c                         |   24 +
+ rust/kernel/alloc/allocator.rs                     |   52 +
+ rust/kernel/alloc/allocator/iter.rs                |  102 +
+ rust/kernel/alloc/allocator_test.rs                |   29 +
+ rust/kernel/alloc/kbox.rs                          |   40 +-
+ rust/kernel/alloc/kvec.rs                          |   40 +-
+ rust/kernel/alloc/layout.rs                        |    5 +
+ rust/kernel/devres.rs                              |    6 +-
+ rust/kernel/dma.rs                                 |   86 +-
+ rust/kernel/drm/device.rs                          |    3 +-
+ rust/kernel/drm/driver.rs                          |    5 +-
+ rust/kernel/drm/gem/mod.rs                         |   96 +-
+ rust/kernel/drm/ioctl.rs                           |   11 +-
+ rust/kernel/lib.rs                                 |    2 +
+ rust/kernel/page.rs                                |   87 +-
+ rust/kernel/scatterlist.rs                         |  491 +++
+ rust/kernel/transmute.rs                           |  114 +-
+ rust/kernel/workqueue.rs                           |    9 +-
+ rust/pin-init/README.md                            |   12 +
+ rust/pin-init/examples/error.rs                    |    4 +-
+ rust/pin-init/src/lib.rs                           |    4 +-
+ rust/pin-init/src/macros.rs                        |  239 +-
+ rust/uapi/uapi_helper.h                            |    1 +
+ samples/rust/rust_dma.rs                           |   35 +-
+ samples/rust/rust_driver_pci.rs                    |    2 +-
+ 1159 files changed, 48761 insertions(+), 17930 deletions(-)
+ create mode 100644 Documentation/ABI/testing/sysfs-class-drm
+ create mode 100644 Documentation/accel/rocket/index.rst
+ create mode 100644 Documentation/devicetree/bindings/display/bridge/solomon,ssd2825.yaml
+ create mode 100644 Documentation/devicetree/bindings/display/bridge/waveshare,dsi2dpi.yaml
+ create mode 100644 Documentation/devicetree/bindings/display/mayqueen,pixpaper.yaml
+ create mode 100644 Documentation/devicetree/bindings/display/panel/hydis,hv101hd1.yaml
+ create mode 100644 Documentation/devicetree/bindings/display/panel/samsung,s6e8aa5x01-ams561ra01.yaml
+ create mode 100644 Documentation/devicetree/bindings/display/rockchip/rockchip,dw-dp.yaml
+ create mode 100644 Documentation/devicetree/bindings/npu/rockchip,rk3588-rknn-core.yaml
+ create mode 100644 Documentation/gpu/xe/xe_device.rst
+ create mode 100644 drivers/accel/amdxdna/amdxdna_ubuf.c
+ create mode 100644 drivers/accel/amdxdna/amdxdna_ubuf.h
+ create mode 100644 drivers/accel/habanalabs/common/hldio.c
+ create mode 100644 drivers/accel/habanalabs/common/hldio.h
+ create mode 100644 drivers/accel/rocket/Kconfig
+ create mode 100644 drivers/accel/rocket/Makefile
+ create mode 100644 drivers/accel/rocket/rocket_core.c
+ create mode 100644 drivers/accel/rocket/rocket_core.h
+ create mode 100644 drivers/accel/rocket/rocket_device.c
+ create mode 100644 drivers/accel/rocket/rocket_device.h
+ create mode 100644 drivers/accel/rocket/rocket_drv.c
+ create mode 100644 drivers/accel/rocket/rocket_drv.h
+ create mode 100644 drivers/accel/rocket/rocket_gem.c
+ create mode 100644 drivers/accel/rocket/rocket_gem.h
+ create mode 100644 drivers/accel/rocket/rocket_job.c
+ create mode 100644 drivers/accel/rocket/rocket_job.h
+ create mode 100644 drivers/accel/rocket/rocket_registers.h
+ create mode 100644 drivers/gpu/drm/amd/amdgpu/amdgpu_utils.h
+ create mode 100644 drivers/gpu/drm/amd/amdgpu/cyan_skillfish_reg_init.c
+ delete mode 100644 drivers/gpu/drm/amd/amdgpu/dce_v11_0.c
+ delete mode 100644 drivers/gpu/drm/amd/amdgpu/dce_v11_0.h
+ rename drivers/gpu/drm/amd/display/dc/inc/{link.h => link_service.h} (97%)
+ create mode 100644 drivers/gpu/drm/amd/display/dc/inc/soc_and_ip_translator.h
+ create mode 100644 drivers/gpu/drm/amd/display/dc/soc_and_ip_translator/Makefile
+ create mode 100644 drivers/gpu/drm/amd/display/dc/soc_and_ip_translator/dcn401/dcn401_soc_and_ip_translator.c
+ create mode 100644 drivers/gpu/drm/amd/display/dc/soc_and_ip_translator/dcn401/dcn401_soc_and_ip_translator.h
+ create mode 100644 drivers/gpu/drm/amd/display/dc/soc_and_ip_translator/dcn42/dcn42_soc_and_ip_translator.c
+ create mode 100644 drivers/gpu/drm/amd/display/dc/soc_and_ip_translator/dcn42/dcn42_soc_and_ip_translator.h
+ create mode 100644 drivers/gpu/drm/amd/display/dc/soc_and_ip_translator/soc_and_ip_translator.c
+ create mode 100644 drivers/gpu/drm/bridge/ssd2825.c
+ create mode 100644 drivers/gpu/drm/bridge/synopsys/dw-dp.c
+ create mode 100644 drivers/gpu/drm/bridge/waveshare-dsi.c
+ create mode 100644 drivers/gpu/drm/i915/display/intel_dsi_vbt_defs.h
+ create mode 100644 drivers/gpu/drm/i915/display/intel_panic.c
+ create mode 100644 drivers/gpu/drm/i915/display/intel_panic.h
+ create mode 100644 drivers/gpu/drm/i915/i915_list_util.h
+ create mode 100644 drivers/gpu/drm/i915/i915_ptr_util.h
+ create mode 100644 drivers/gpu/drm/i915/i915_timer_util.c
+ create mode 100644 drivers/gpu/drm/i915/i915_timer_util.h
+ create mode 100644 drivers/gpu/drm/i915/i915_wait_util.h
+ delete mode 100644 drivers/gpu/drm/nova/uapi.rs
+ create mode 100644 drivers/gpu/drm/panel/panel-hydis-hv101hd1.c
+ create mode 100644 drivers/gpu/drm/panel/panel-samsung-s6e8aa5x01-ams561ra01.c
+ create mode 100644 drivers/gpu/drm/panthor/panthor_hw.c
+ create mode 100644 drivers/gpu/drm/panthor/panthor_hw.h
+ create mode 100644 drivers/gpu/drm/rockchip/dw_dp-rockchip.c
+ create mode 100644 drivers/gpu/drm/tiny/pixpaper.c
+ create mode 100644 drivers/gpu/drm/tyr/Kconfig
+ create mode 100644 drivers/gpu/drm/tyr/Makefile
+ create mode 100644 drivers/gpu/drm/tyr/driver.rs
+ create mode 100644 drivers/gpu/drm/tyr/file.rs
+ create mode 100644 drivers/gpu/drm/tyr/gem.rs
+ create mode 100644 drivers/gpu/drm/tyr/gpu.rs
+ create mode 100644 drivers/gpu/drm/tyr/regs.rs
+ create mode 100644 drivers/gpu/drm/tyr/tyr.rs
+ create mode 100644 drivers/gpu/drm/xe/display/xe_panic.c
+ create mode 100644 drivers/gpu/drm/xe/regs/xe_hw_error_regs.h
+ create mode 100644 drivers/gpu/drm/xe/tests/xe_guc_g2g_test.c
+ create mode 100644 drivers/gpu/drm/xe/xe_dep_job_types.h
+ create mode 100644 drivers/gpu/drm/xe/xe_dep_scheduler.c
+ create mode 100644 drivers/gpu/drm/xe/xe_dep_scheduler.h
+ delete mode 100644 drivers/gpu/drm/xe/xe_gt_tlb_invalidation.c
+ delete mode 100644 drivers/gpu/drm/xe/xe_gt_tlb_invalidation.h
+ delete mode 100644 drivers/gpu/drm/xe/xe_gt_tlb_invalidation_types.h
+ create mode 100644 drivers/gpu/drm/xe/xe_guc_tlb_inval.c
+ create mode 100644 drivers/gpu/drm/xe/xe_guc_tlb_inval.h
+ delete mode 100644 drivers/gpu/drm/xe/xe_hmm.c
+ delete mode 100644 drivers/gpu/drm/xe/xe_hmm.h
+ create mode 100644 drivers/gpu/drm/xe/xe_hw_error.c
+ create mode 100644 drivers/gpu/drm/xe/xe_hw_error.h
+ create mode 100644 drivers/gpu/drm/xe/xe_late_bind_fw.c
+ create mode 100644 drivers/gpu/drm/xe/xe_late_bind_fw.h
+ create mode 100644 drivers/gpu/drm/xe/xe_late_bind_fw_types.h
+ create mode 100644 drivers/gpu/drm/xe/xe_mmio_gem.c
+ create mode 100644 drivers/gpu/drm/xe/xe_mmio_gem.h
+ create mode 100644 drivers/gpu/drm/xe/xe_printk.h
+ create mode 100644 drivers/gpu/drm/xe/xe_psmi.c
+ create mode 100644 drivers/gpu/drm/xe/xe_psmi.h
+ create mode 100644 drivers/gpu/drm/xe/xe_sriov_vf_ccs.c
+ create mode 100644 drivers/gpu/drm/xe/xe_sriov_vf_ccs.h
+ create mode 100644 drivers/gpu/drm/xe/xe_sriov_vf_ccs_types.h
+ create mode 100644 drivers/gpu/drm/xe/xe_tile_debugfs.c
+ create mode 100644 drivers/gpu/drm/xe/xe_tile_debugfs.h
+ create mode 100644 drivers/gpu/drm/xe/xe_tile_printk.h
+ create mode 100644 drivers/gpu/drm/xe/xe_tlb_inval.c
+ create mode 100644 drivers/gpu/drm/xe/xe_tlb_inval.h
+ create mode 100644 drivers/gpu/drm/xe/xe_tlb_inval_job.c
+ create mode 100644 drivers/gpu/drm/xe/xe_tlb_inval_job.h
+ create mode 100644 drivers/gpu/drm/xe/xe_tlb_inval_types.h
+ create mode 100644 drivers/gpu/drm/xe/xe_userptr.c
+ create mode 100644 drivers/gpu/drm/xe/xe_userptr.h
+ create mode 100644 drivers/gpu/drm/xe/xe_validation.c
+ create mode 100644 drivers/gpu/drm/xe/xe_validation.h
+ create mode 100644 drivers/gpu/drm/xe/xe_vm_madvise.c
+ create mode 100644 drivers/gpu/drm/xe/xe_vm_madvise.h
+ create mode 100644 drivers/gpu/drm/xe/xe_vram_types.h
+ create mode 100644 drivers/gpu/nova-core/firmware/booter.rs
+ create mode 100644 drivers/gpu/nova-core/firmware/gsp.rs
+ create mode 100644 drivers/gpu/nova-core/firmware/riscv.rs
+ create mode 100644 drivers/gpu/nova-core/gsp.rs
+ create mode 100644 drivers/gpu/nova-core/gsp/boot.rs
+ create mode 100644 drivers/gpu/nova-core/gsp/fw.rs
+ create mode 100644 drivers/gpu/nova-core/gsp/fw/r570_144.rs
+ create mode 100644 drivers/gpu/nova-core/gsp/fw/r570_144/bindings.rs
+ create mode 100644 drivers/misc/mei/mei_lb.c
+ create mode 100644 include/drm/bridge/dw_dp.h
+ create mode 100644 include/drm/intel/intel_lb_mei_interface.h
+ create mode 100644 include/uapi/drm/rocket_accel.h
+ create mode 100644 rust/helpers/scatterlist.c
+ create mode 100644 rust/kernel/alloc/allocator/iter.rs
+ create mode 100644 rust/kernel/scatterlist.rs
+Merging drm-exynos/for-linux-next (d07e4c00696f5 drm/exynos: dsi: add support for exynos7870)
+$ git merge -m Merge branch 'for-linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/daeinki/drm-exynos.git drm-exynos/for-linux-next
+Merge made by the 'ort' strategy.
+$ git am -3 ../patches/0001-Revert-drm-exynos-dsi-add-support-for-exynos7870.patch
+Applying: Revert "drm/exynos: dsi: add support for exynos7870"
+$ git reset HEAD^
+Unstaged changes after reset:
+M	drivers/gpu/drm/exynos/exynos_drm_dsi.c
+$ git add -A .
+$ git commit -v -a --amend
+warning: notes ref refs/notes/commits is invalid
+[master 6daa10c61e116] Merge branch 'for-linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/daeinki/drm-exynos.git
+ Date: Mon Sep 29 15:10:58 2025 +0100
+Merging drm-misc/for-linux-next (0c4932f6ddf81 drm/tiny: pixpaper: Fix missing dependency on DRM_GEM_SHMEM_HELPER)
+$ git merge -m Merge branch 'for-linux-next' of https://gitlab.freedesktop.org/drm/misc/kernel.git drm-misc/for-linux-next
+Already up to date.
+Merging amdgpu/drm-next (df2ba5709416a drm/amd: Add name to modes from amdgpu_connector_add_common_modes())
+$ git merge -m Merge branch 'drm-next' of https://gitlab.freedesktop.org/agd5f/linux.git amdgpu/drm-next
+Auto-merging drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
+Auto-merging drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_color.c
+Auto-merging drivers/gpu/drm/amd/display/dc/dc.h
+Auto-merging drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c
+Auto-merging drivers/gpu/drm/amd/display/dc/hwss/dcn401/dcn401_hwseq.c
+Merge made by the 'ort' strategy.
+ Documentation/gpu/amdgpu/index.rst                 |   1 +
+ Documentation/gpu/amdgpu/userq.rst                 | 203 +++++++++++++++++++++
+ drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gfx_v10.c |   4 +-
+ .../gpu/drm/amd/amdgpu/amdgpu_amdkfd_gfx_v10_3.c   |   4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gfx_v11.c |   4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gfx_v12.c |   4 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c   |  10 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_bo_list.h        |   1 -
+ drivers/gpu/drm/amd/amdgpu/amdgpu_connectors.c     |  41 ++---
+ drivers/gpu/drm/amd/amdgpu/amdgpu_cs.c             |  31 +---
+ drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c            |   2 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_gem.c            |   5 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_hmm.c            |  11 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_hmm.h            |   2 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ids.c            |  66 ++++---
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ids.h            |  11 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c            |   8 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.h            |   5 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_userq.c          |   2 +
+ drivers/gpu/drm/amd/amdgpu/amdgpu_userq_fence.c    |   2 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vcn.h            |   2 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c             |  17 +-
+ drivers/gpu/drm/amd/amdgpu/amdgpu_vm.h             |   2 +-
+ drivers/gpu/drm/amd/amdgpu/atom.c                  |   7 +-
+ drivers/gpu/drm/amd/amdgpu/gfx_v9_4_3.c            |  12 ++
+ drivers/gpu/drm/amd/amdgpu/mes_v11_0.c             |   6 +
+ drivers/gpu/drm/amd/amdgpu/mes_v12_0.c             |   5 +
+ drivers/gpu/drm/amd/amdgpu/vcn_v5_0_1.c            |  78 ++++++--
+ drivers/gpu/drm/amd/amdkfd/kfd_device.c            |  20 +-
+ drivers/gpu/drm/amd/amdkfd/kfd_priv.h              |   2 +
+ drivers/gpu/drm/amd/amdkfd/kfd_process.c           |   4 +
+ drivers/gpu/drm/amd/amdkfd/kfd_svm.c               |   2 +-
+ drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c  |  55 +++++-
+ drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.h  |   2 +
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_color.c    |  86 ++++++---
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_crtc.c |   8 +-
+ .../gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_hdcp.c |  12 +-
+ .../drm/amd/display/amdgpu_dm/amdgpu_dm_services.c |   4 +-
+ .../amd/display/dc/clk_mgr/dce100/dce_clk_mgr.c    |   3 +
+ .../amd/display/dc/clk_mgr/dce60/dce60_clk_mgr.c   |   5 +
+ .../dc/clk_mgr/dcn30/dcn30_clk_mgr_smu_msg.c       |   2 +-
+ .../amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c | 142 +++++++++++++-
+ .../amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.h |   5 +
+ .../dc/clk_mgr/dcn32/dcn32_clk_mgr_smu_msg.c       |   5 +-
+ .../amd/display/dc/clk_mgr/dcn401/dcn401_clk_mgr.c |  26 +--
+ .../dc/clk_mgr/dcn401/dcn401_clk_mgr_smu_msg.c     | 130 ++++++++++++-
+ .../dc/clk_mgr/dcn401/dcn401_clk_mgr_smu_msg.h     |  10 +-
+ drivers/gpu/drm/amd/display/dc/core/dc.c           |  12 +-
+ drivers/gpu/drm/amd/display/dc/core/dc_resource.c  |   6 +
+ drivers/gpu/drm/amd/display/dc/dc.h                |   4 +-
+ drivers/gpu/drm/amd/display/dc/dc_stream.h         |   3 +
+ drivers/gpu/drm/amd/display/dc/dc_types.h          |   1 +
+ .../gpu/drm/amd/display/dc/dccg/dcn35/dcn35_dccg.c |  24 ++-
+ drivers/gpu/drm/amd/display/dc/dce/dmub_replay.c   |   1 +
+ drivers/gpu/drm/amd/display/dc/dm_services.h       |  11 +-
+ .../dc/dml2/dml21/src/dml2_pmo/dml2_pmo_dcn3.c     |  21 ++-
+ .../drm/amd/display/dc/hubbub/dcn32/dcn32_hubbub.c |  38 +++-
+ .../drm/amd/display/dc/hwss/dcn10/dcn10_hwseq.c    |   2 +-
+ .../drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c    |  11 +-
+ .../drm/amd/display/dc/hwss/dcn401/dcn401_hwseq.c  |   8 +-
+ .../dc/link/protocols/link_edp_panel_control.c     |  14 ++
+ .../display/dc/resource/dce100/dce100_resource.c   |  25 ++-
+ .../display/dc/resource/dce100/dce100_resource.h   |   9 +
+ .../amd/display/dc/resource/dce60/dce60_resource.c |  69 +------
+ .../amd/display/dc/resource/dce80/dce80_resource.c |  60 +-----
+ .../display/dc/resource/dcn314/dcn314_resource.c   |   1 +
+ .../amd/display/dc/resource/dcn32/dcn32_resource.c |   1 +
+ .../amd/display/dc/resource/dcn32/dcn32_resource.h |   3 +-
+ drivers/gpu/drm/amd/display/dmub/inc/dmub_cmd.h    |   6 +-
+ drivers/gpu/drm/amd/include/mes_v11_api_def.h      |   3 +-
+ drivers/gpu/drm/amd/include/mes_v12_api_def.h      |   3 +-
+ .../amd/pm/swsmu/inc/pmfw_if/smu_v13_0_12_ppsmc.h  |   3 +-
+ .../amd/pm/{ => swsmu}/inc/smu_v13_0_0_pptable.h   |   0
+ .../gpu/drm/amd/pm/swsmu/smu13/smu_v13_0_12_ppt.c  |   1 +
+ .../gpu/drm/amd/pm/swsmu/smu13/smu_v13_0_6_ppt.c   |   3 +
+ drivers/gpu/drm/amd/ras/rascore/Makefile           |   0
+ drivers/gpu/drm/amd/ras/rascore/ras_core_status.h  |  37 ++++
+ 77 files changed, 1070 insertions(+), 379 deletions(-)
+ create mode 100644 Documentation/gpu/amdgpu/userq.rst
+ rename drivers/gpu/drm/amd/pm/{ => swsmu}/inc/smu_v13_0_0_pptable.h (100%)
+ create mode 100644 drivers/gpu/drm/amd/ras/rascore/Makefile
+ create mode 100644 drivers/gpu/drm/amd/ras/rascore/ras_core_status.h
+Merging drm-intel/for-linux-next (996ad9cd3e1ee Merge drm/drm-next into drm-intel-next)
+$ git merge -m Merge branch 'for-linux-next' of https://gitlab.freedesktop.org/drm/i915/kernel.git drm-intel/for-linux-next
+Merge made by the 'ort' strategy.
+ drivers/gpu/drm/i915/Makefile                      |   1 +
+ drivers/gpu/drm/i915/display/intel_alpm.c          |  29 +--
+ drivers/gpu/drm/i915/display/intel_cdclk.c         |  36 +--
+ drivers/gpu/drm/i915/display/intel_color.c         |   2 +-
+ .../gpu/drm/i915/display/intel_crtc_state_dump.c   |   5 +-
+ drivers/gpu/drm/i915/display/intel_cursor.c        |   2 +-
+ drivers/gpu/drm/i915/display/intel_cx0_phy.c       |  14 +-
+ drivers/gpu/drm/i915/display/intel_display.c       | 142 +++++-------
+ drivers/gpu/drm/i915/display/intel_display.h       |   6 -
+ drivers/gpu/drm/i915/display/intel_display_core.h  |  21 +-
+ .../gpu/drm/i915/display/intel_display_device.c    |  13 ++
+ .../gpu/drm/i915/display/intel_display_device.h    |   6 +-
+ .../gpu/drm/i915/display/intel_display_driver.c    |   1 -
+ drivers/gpu/drm/i915/display/intel_display_irq.c   | 128 ++++++++---
+ drivers/gpu/drm/i915/display/intel_display_irq.h   |   8 +-
+ drivers/gpu/drm/i915/display/intel_display_types.h |   3 +
+ drivers/gpu/drm/i915/display/intel_dmc.c           |   2 +-
+ drivers/gpu/drm/i915/display/intel_dsb.c           |  57 +++--
+ drivers/gpu/drm/i915/display/intel_dsb.h           |   4 +-
+ drivers/gpu/drm/i915/display/intel_fb.c            |   4 +-
+ drivers/gpu/drm/i915/display/intel_fbdev.c         |  59 ++++-
+ drivers/gpu/drm/i915/display/intel_fbdev_fb.c      |  53 ++---
+ drivers/gpu/drm/i915/display/intel_fbdev_fb.h      |  11 +-
+ drivers/gpu/drm/i915/display/intel_hotplug_irq.c   |   3 +
+ drivers/gpu/drm/i915/display/intel_plane.c         |   5 +-
+ drivers/gpu/drm/i915/display/intel_psr.c           |  18 +-
+ drivers/gpu/drm/i915/display/intel_psr.h           |   2 +-
+ drivers/gpu/drm/i915/display/intel_vblank.c        |   2 +-
+ drivers/gpu/drm/i915/display/intel_vrr.c           | 251 +++++++++++++--------
+ drivers/gpu/drm/i915/display/intel_vrr.h           |   3 +-
+ drivers/gpu/drm/i915/display/skl_watermark.c       | 160 +++++++++----
+ drivers/gpu/drm/i915/display/vlv_clock.c           |  88 ++++++++
+ drivers/gpu/drm/i915/display/vlv_clock.h           |  38 ++++
+ drivers/gpu/drm/i915/gem/i915_gem_object.h         |   1 +
+ drivers/gpu/drm/i915/gem/i915_gem_wait.c           |   7 +
+ drivers/gpu/drm/i915/gt/gen2_engine_cs.c           |   8 +-
+ drivers/gpu/drm/i915/gt/intel_rc6.c                |   3 +-
+ drivers/gpu/drm/i915/gt/intel_rps.c                |  18 +-
+ drivers/gpu/drm/i915/gvt/kvmgt.c                   |  31 +--
+ drivers/gpu/drm/i915/gvt/mmio.c                    |   4 +-
+ drivers/gpu/drm/i915/i915_driver.c                 | 133 +++++------
+ drivers/gpu/drm/i915/i915_drv.h                    |   7 +-
+ drivers/gpu/drm/i915/i915_irq.c                    |  99 ++------
+ drivers/gpu/drm/i915/i915_pmu.c                    |   4 +-
+ drivers/gpu/drm/i915/i915_reg_defs.h               |  10 +
+ drivers/gpu/drm/i915/soc/intel_dram.c              |  10 +-
+ .../xe/compat-i915-headers/gem/i915_gem_object.h   |   4 +-
+ .../xe/compat-i915-headers/i915_scheduler_types.h  |  13 --
+ drivers/gpu/drm/xe/display/intel_fbdev_fb.c        |  57 +----
+ drivers/gpu/drm/xe/xe_device_types.h               |   9 -
+ drivers/gpu/drm/xe/xe_pci.c                        |   1 +
+ include/drm/intel/pciids.h                         |   5 +-
+ 52 files changed, 930 insertions(+), 671 deletions(-)
+ create mode 100644 drivers/gpu/drm/i915/display/vlv_clock.c
+ create mode 100644 drivers/gpu/drm/i915/display/vlv_clock.h
+ delete mode 100644 drivers/gpu/drm/xe/compat-i915-headers/i915_scheduler_types.h
+Merging drm-msm/msm-next (b5bad77e1e3c7 drm/msm/registers: Sync GPU registers from mesa)
+$ git merge -m Merge branch 'msm-next' of https://gitlab.freedesktop.org/drm/msm.git drm-msm/msm-next
+Already up to date.
+Merging drm-msm-lumag/msm-next-lumag (a643abb673790 drm/msm/mdp4: remove the use of dev_err_probe())
+$ git merge -m Merge branch 'msm-next-lumag' of https://gitlab.freedesktop.org/lumag/msm.git drm-msm-lumag/msm-next-lumag
+Already up to date.
+Merging drm-rust/drm-rust-next (299eb32863e58 gpu: nova-core: Add base files for r570.144 firmware bindings)
+$ git merge -m Merge branch 'drm-rust-next' of https://gitlab.freedesktop.org/drm/rust/kernel.git drm-rust/drm-rust-next
+Already up to date.
+Merging drm-nova/nova-next (93296e9d9528f gpu: nova-core: vbios: store reference to Device where relevant)
+$ git merge -m Merge branch 'nova-next' of https://gitlab.freedesktop.org/drm/nova.git drm-nova/nova-next
+Already up to date.
+Merging drm-xe/drm-xe-next (662d98b8b3730 drm/xe/hw_engine_group: Fix double write lock release in error path)
+$ git merge -m Merge branch 'drm-xe-next' of https://gitlab.freedesktop.org/drm/xe/kernel.git drm-xe/drm-xe-next
+Auto-merging drivers/gpu/drm/xe/xe_bo_evict.c
+Merge made by the 'ort' strategy.
+ drivers/gpu/drm/xe/tests/xe_dma_buf.c   |  17 +-
+ drivers/gpu/drm/xe/tests/xe_pci.c       |  12 +-
+ drivers/gpu/drm/xe/xe_bo_evict.c        |   9 ++
+ drivers/gpu/drm/xe/xe_configfs.c        |  23 ++-
+ drivers/gpu/drm/xe/xe_device.c          |  63 ++++----
+ drivers/gpu/drm/xe/xe_dma_buf.c         |  41 +++--
+ drivers/gpu/drm/xe/xe_exec.c            |   3 +-
+ drivers/gpu/drm/xe/xe_gt_debugfs.c      | 129 ++++++---------
+ drivers/gpu/drm/xe/xe_gt_debugfs.h      |   1 +
+ drivers/gpu/drm/xe/xe_guc.c             | 271 ++++++++++++++------------------
+ drivers/gpu/drm/xe/xe_guc_pc.c          |  44 ++----
+ drivers/gpu/drm/xe/xe_hw_engine_group.c |   6 +-
+ drivers/gpu/drm/xe/xe_pm.c              |  66 ++++++++
+ drivers/gpu/drm/xe/xe_pm.h              |   2 +
+ drivers/gpu/drm/xe/xe_psmi.c            |   4 +-
+ drivers/gpu/drm/xe/xe_query.c           |  15 +-
+ drivers/gpu/drm/xe/xe_tile_debugfs.c    |   7 +
+ drivers/gpu/drm/xe/xe_vm.c              |   2 +
+ 18 files changed, 373 insertions(+), 342 deletions(-)
+$ git am -3 ../patches/0001-Fix-up-drm-xe-merge.patch
+Applying: Fix up drm-xe merge
+Using index info to reconstruct a base tree...
+M	drivers/gpu/drm/xe/xe_device_sysfs.c
+Falling back to patching base and 3-way merge...
+No changes -- Patch already applied.
+Merging etnaviv/etnaviv/next (6bde14ba5f7ef drm/etnaviv: add optional reset support)
+$ git merge -m Merge branch 'etnaviv/next' of https://git.pengutronix.de/git/lst/linux etnaviv/etnaviv/next
+Already up to date.
+Merging fbdev/for-next (6d85b579a9cab fbdev: Use string choices helpers)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/deller/linux-fbdev.git fbdev/for-next
+Merge made by the 'ort' strategy.
+ drivers/video/fbdev/Kconfig            |   1 +
+ drivers/video/fbdev/core/fb_fillrect.h |   3 +-
+ drivers/video/fbdev/core/fbmon.c       |   7 +-
+ drivers/video/fbdev/nvidia/nvidia.c    |   3 +-
+ drivers/video/fbdev/pxafb.c            |   3 +-
+ drivers/video/fbdev/s3fb.c             | 177 +++++++++++++++++++++++----------
+ drivers/video/fbdev/xen-fbfront.c      |   2 +-
+ 7 files changed, 134 insertions(+), 62 deletions(-)
+Merging regmap/for-next (2988345731978 Merge remote-tracking branch 'regmap/for-6.18' into regmap-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regmap.git regmap/for-next
+Merge made by the 'ort' strategy.
+ drivers/base/regmap/regmap-mmio.c |  1 +
+ drivers/base/regmap/regmap.c      | 13 ++++++++-----
+ 2 files changed, 9 insertions(+), 5 deletions(-)
+Merging sound/for-next (f65dc3b1ab145 ALSA: usb-audio: don't hardcode gain for output channel of Presonus Studio)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/tiwai/sound.git sound/for-next
+Already up to date.
+Merging ieee1394/for-next (40d4c761200b7 firewire: core: fix undefined reference error in ARM EABI)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ieee1394/linux1394.git ieee1394/for-next
+Auto-merging drivers/firewire/core-cdev.c
+Merge made by the 'ort' strategy.
+ drivers/firewire/core-card.c        | 500 +++++++++++++++++++-----------------
+ drivers/firewire/core-cdev.c        |  36 ++-
+ drivers/firewire/core-device.c      |  27 +-
+ drivers/firewire/core-topology.c    |  89 +++----
+ drivers/firewire/core-transaction.c | 130 ++++++----
+ drivers/firewire/core.h             |  22 +-
+ drivers/firewire/ohci.c             | 316 ++++-------------------
+ include/linux/firewire.h            |  33 ++-
+ 8 files changed, 522 insertions(+), 631 deletions(-)
+Merging sound-asoc/for-next (b4f4fd2fac842 Merge remote-tracking branch 'asoc/for-6.18' into asoc-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/sound.git sound-asoc/for-next
+Merge made by the 'ort' strategy.
+Merging modules/modules-next (5eb4b9a4cdbb7 params: Replace deprecated strcpy() with strscpy() and memcpy())
+$ git merge -m Merge branch 'modules-next' of https://git.kernel.org/pub/scm/linux/kernel/git/modules/linux.git modules/modules-next
+Already up to date.
+Merging input/next (db74430a4218f Input: psxpad-spi - add a check for the return value of spi_setup())
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/dtor/input.git input/next
+Auto-merging MAINTAINERS
+Auto-merging drivers/gpio/Kconfig
+Auto-merging drivers/gpio/gpio-regmap.c
+Auto-merging drivers/mfd/Kconfig
+Auto-merging drivers/pinctrl/Kconfig
+Merge made by the 'ort' strategy.
+ .../arm/bcm/raspberrypi,bcm2835-firmware.yaml      |  28 +
+ .../bindings/gpio/maxim,max7360-gpio.yaml          |  83 ++
+ .../devicetree/bindings/input/atmel,maxtouch.yaml  |   3 +-
+ .../devicetree/bindings/input/awinic,aw86927.yaml  |  48 ++
+ .../devicetree/bindings/input/lpc32xx-key.txt      |  34 -
+ .../devicetree/bindings/input/nxp,lpc3220-key.yaml |  61 ++
+ .../bindings/input/qcom,pm8941-pwrkey.yaml         |  42 +-
+ .../devicetree/bindings/input/tca8418_keypad.txt   |  10 -
+ .../devicetree/bindings/input/ti,tca8418.yaml      |  61 ++
+ .../bindings/input/touchscreen/bu21013.txt         |  43 --
+ .../bindings/input/touchscreen/eeti,exc3000.yaml   |  42 +-
+ .../devicetree/bindings/input/touchscreen/eeti.txt |  30 -
+ .../bindings/input/touchscreen/egalax-ts.txt       |  18 -
+ .../bindings/input/touchscreen/fsl,imx6ul-tsc.yaml |  14 +
+ .../bindings/input/touchscreen/goodix.yaml         |   1 -
+ .../bindings/input/touchscreen/himax,hx852es.yaml  |  81 ++
+ .../input/touchscreen/hynitron,cst816x.yaml        |  65 ++
+ .../input/touchscreen/imagis,ist3038c.yaml         |  18 +
+ .../bindings/input/touchscreen/max11801-ts.txt     |  17 -
+ .../bindings/input/touchscreen/maxim,max11801.yaml |  46 ++
+ .../input/touchscreen/raspberrypi,firmware-ts.txt  |  26 -
+ .../input/touchscreen/resistive-adc-touch.yaml     |   2 +-
+ .../bindings/input/touchscreen/rohm,bu21013.yaml   |  95 +++
+ .../bindings/input/touchscreen/semtech,sx8654.yaml |  52 ++
+ .../bindings/input/touchscreen/sx8654.txt          |  23 -
+ .../{ti.tsc2007.yaml => ti,tsc2007.yaml}           |   4 +-
+ .../bindings/input/touchscreen/touchscreen.txt     |   1 -
+ .../bindings/input/touchscreen/touchscreen.yaml    |   4 +
+ .../bindings/input/touchscreen/zeitec,zet6223.yaml |  62 ++
+ .../bindings/input/touchscreen/zet6223.txt         |  30 -
+ .../devicetree/bindings/mfd/maxim,max7360.yaml     | 191 +++++
+ MAINTAINERS                                        |  20 +
+ drivers/gpio/Kconfig                               |  12 +
+ drivers/gpio/Makefile                              |   1 +
+ drivers/gpio/gpio-max7360.c                        | 257 +++++++
+ drivers/gpio/gpio-regmap.c                         |  30 +-
+ drivers/input/ff-core.c                            |   2 +-
+ drivers/input/ff-memless.c                         |   1 +
+ drivers/input/gameport/gameport.c                  |   1 +
+ drivers/input/input-compat.c                       |  30 +
+ drivers/input/input-compat.h                       |   3 +
+ drivers/input/input-poller.c                       |   1 +
+ drivers/input/input.c                              |  36 +-
+ drivers/input/joystick/iforce/iforce-main.c        |   1 +
+ drivers/input/joystick/iforce/iforce-packets.c     |   1 +
+ drivers/input/joystick/psxpad-spi.c                |   6 +-
+ drivers/input/keyboard/Kconfig                     |  30 +-
+ drivers/input/keyboard/Makefile                    |   2 +-
+ drivers/input/keyboard/max7360-keypad.c            | 308 ++++++++
+ drivers/input/keyboard/pxa27x_keypad.c             | 510 +++++--------
+ drivers/input/keyboard/spear-keyboard.c            |  71 +-
+ drivers/input/keyboard/tca6416-keypad.c            | 305 --------
+ drivers/input/keyboard/tca8418_keypad.c            |  13 +-
+ drivers/input/keyboard/twl4030_keypad.c            |  35 +-
+ drivers/input/misc/Kconfig                         |  31 +
+ drivers/input/misc/Makefile                        |   3 +
+ drivers/input/misc/ad714x.c                        |   1 +
+ drivers/input/misc/adxl34x.c                       |   1 +
+ drivers/input/misc/aw86927.c                       | 847 +++++++++++++++++++++
+ drivers/input/misc/cma3000_d0x.c                   |   1 +
+ drivers/input/misc/max7360-rotary.c                | 192 +++++
+ drivers/input/misc/pm8941-pwrkey.c                 |  12 +-
+ drivers/input/misc/tps6594-pwrbutton.c             | 126 +++
+ drivers/input/misc/uinput.c                        |   1 +
+ drivers/input/rmi4/rmi_2d_sensor.c                 |   1 +
+ drivers/input/rmi4/rmi_2d_sensor.h                 |   3 +
+ drivers/input/rmi4/rmi_bus.c                       |   1 +
+ drivers/input/rmi4/rmi_driver.c                    |   1 +
+ drivers/input/serio/hil_mlc.c                      |   1 +
+ drivers/input/serio/hp_sdc.c                       |   1 +
+ drivers/input/serio/i8042.c                        |   1 +
+ drivers/input/serio/libps2.c                       |   1 +
+ drivers/input/serio/ps2-gpio.c                     |   2 +-
+ drivers/input/serio/serio.c                        |   1 +
+ drivers/input/sparse-keymap.c                      |   1 +
+ drivers/input/touch-overlay.c                      |   1 +
+ drivers/input/touchscreen.c                        |   1 +
+ drivers/input/touchscreen/Kconfig                  |  22 +
+ drivers/input/touchscreen/Makefile                 |   2 +
+ drivers/input/touchscreen/ad7879.c                 |   1 +
+ drivers/input/touchscreen/atmel_mxt_ts.c           |  11 +-
+ drivers/input/touchscreen/cyttsp_core.c            |   1 +
+ drivers/input/touchscreen/fsl-imx25-tcq.c          |   1 -
+ drivers/input/touchscreen/goodix_berlin_core.c     |   1 +
+ drivers/input/touchscreen/himax_hx852x.c           | 503 ++++++++++++
+ drivers/input/touchscreen/hynitron-cst816x.c       | 253 ++++++
+ drivers/input/touchscreen/imx6ul_tsc.c             | 121 +--
+ drivers/input/touchscreen/tsc2007_core.c           |  39 +-
+ drivers/input/touchscreen/tsc200x-core.c           |   1 +
+ drivers/input/touchscreen/wm9705.c                 |   1 +
+ drivers/input/touchscreen/wm9712.c                 |   1 +
+ drivers/input/touchscreen/wm9713.c                 |   1 +
+ drivers/input/touchscreen/wm97xx-core.c            |   1 +
+ drivers/mfd/Kconfig                                |  14 +
+ drivers/mfd/Makefile                               |   1 +
+ drivers/mfd/max7360.c                              | 171 +++++
+ drivers/mfd/tps6594-core.c                         |  58 +-
+ drivers/pinctrl/Kconfig                            |  11 +
+ drivers/pinctrl/Makefile                           |   1 +
+ drivers/pinctrl/pinctrl-max7360.c                  | 215 ++++++
+ drivers/pwm/Kconfig                                |  10 +
+ drivers/pwm/Makefile                               |   1 +
+ drivers/pwm/pwm-max7360.c                          | 209 +++++
+ include/linux/gpio/regmap.h                        |  18 +
+ include/linux/mfd/max7360.h                        | 109 +++
+ include/linux/platform_data/keyboard-spear.h       | 164 ----
+ include/linux/platform_data/keypad-pxa27x.h        |  73 --
+ include/linux/tca6416_keypad.h                     |  30 -
+ 108 files changed, 4816 insertions(+), 1371 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/gpio/maxim,max7360-gpio.yaml
+ create mode 100644 Documentation/devicetree/bindings/input/awinic,aw86927.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/lpc32xx-key.txt
+ create mode 100644 Documentation/devicetree/bindings/input/nxp,lpc3220-key.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/tca8418_keypad.txt
+ create mode 100644 Documentation/devicetree/bindings/input/ti,tca8418.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/bu21013.txt
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/eeti.txt
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/egalax-ts.txt
+ create mode 100644 Documentation/devicetree/bindings/input/touchscreen/himax,hx852es.yaml
+ create mode 100644 Documentation/devicetree/bindings/input/touchscreen/hynitron,cst816x.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/max11801-ts.txt
+ create mode 100644 Documentation/devicetree/bindings/input/touchscreen/maxim,max11801.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/raspberrypi,firmware-ts.txt
+ create mode 100644 Documentation/devicetree/bindings/input/touchscreen/rohm,bu21013.yaml
+ create mode 100644 Documentation/devicetree/bindings/input/touchscreen/semtech,sx8654.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/sx8654.txt
+ rename Documentation/devicetree/bindings/input/touchscreen/{ti.tsc2007.yaml => ti,tsc2007.yaml} (95%)
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/touchscreen.txt
+ create mode 100644 Documentation/devicetree/bindings/input/touchscreen/zeitec,zet6223.yaml
+ delete mode 100644 Documentation/devicetree/bindings/input/touchscreen/zet6223.txt
+ create mode 100644 Documentation/devicetree/bindings/mfd/maxim,max7360.yaml
+ create mode 100644 drivers/gpio/gpio-max7360.c
+ create mode 100644 drivers/input/keyboard/max7360-keypad.c
+ delete mode 100644 drivers/input/keyboard/tca6416-keypad.c
+ create mode 100644 drivers/input/misc/aw86927.c
+ create mode 100644 drivers/input/misc/max7360-rotary.c
+ create mode 100644 drivers/input/misc/tps6594-pwrbutton.c
+ create mode 100644 drivers/input/touchscreen/himax_hx852x.c
+ create mode 100644 drivers/input/touchscreen/hynitron-cst816x.c
+ create mode 100644 drivers/mfd/max7360.c
+ create mode 100644 drivers/pinctrl/pinctrl-max7360.c
+ create mode 100644 drivers/pwm/pwm-max7360.c
+ create mode 100644 include/linux/mfd/max7360.h
+ delete mode 100644 include/linux/platform_data/keyboard-spear.h
+ delete mode 100644 include/linux/platform_data/keypad-pxa27x.h
+ delete mode 100644 include/linux/tca6416_keypad.h
+Merging block/for-next (5c85b52fba5a5 Merge branch 'for-6.18/block' into for-next)
+$ git merge -m Merge branch 'for-next' of git://git.kernel.dk/linux-block.git block/for-next
+Auto-merging Documentation/admin-guide/md.rst
+Auto-merging MAINTAINERS
+Auto-merging arch/sparc/include/asm/floppy_64.h
+Auto-merging arch/um/drivers/ubd_kern.c
+Auto-merging block/blk-integrity.c
+Auto-merging drivers/block/zram/zram_drv.c
+Auto-merging drivers/md/md-cluster.c
+Auto-merging drivers/memstick/core/mspro_block.c
+Auto-merging drivers/scsi/BusLogic.c
+Auto-merging fs/bcachefs/journal_io.c
+Auto-merging fs/btrfs/ioctl.c
+Auto-merging fs/fuse/dev_uring.c
+Auto-merging fs/iomap/direct-io.c
+Auto-merging include/linux/blkdev.h
+Auto-merging io_uring/zcrx.c
+Merge made by the 'ort' strategy.
+ Documentation/ABI/stable/sysfs-block            |   14 +-
+ Documentation/admin-guide/md.rst                |   86 +-
+ Documentation/filesystems/locking.rst           |    2 +-
+ Documentation/networking/iou-zcrx.rst           |    2 +-
+ Documentation/scsi/scsi_mid_low_api.rst         |    8 +-
+ MAINTAINERS                                     |    2 +-
+ arch/alpha/include/asm/floppy.h                 |   19 -
+ arch/arm/include/asm/floppy.h                   |    2 -
+ arch/m68k/emu/nfblock.c                         |    4 +-
+ arch/m68k/include/asm/floppy.h                  |    4 -
+ arch/mips/include/asm/floppy.h                  |   15 -
+ arch/parisc/include/asm/floppy.h                |   11 +-
+ arch/powerpc/include/asm/floppy.h               |    5 -
+ arch/sparc/include/asm/floppy_32.h              |    3 -
+ arch/sparc/include/asm/floppy_64.h              |    3 -
+ arch/um/drivers/ubd_kern.c                      |    6 +-
+ arch/x86/include/asm/floppy.h                   |    8 +-
+ block/bfq-iosched.c                             |   22 +-
+ block/bio-integrity.c                           |   25 +-
+ block/bio.c                                     |   78 +-
+ block/blk-cgroup.c                              |   29 +-
+ block/blk-cgroup.h                              |   12 +-
+ block/blk-core.c                                |   19 +-
+ block/blk-crypto-fallback.c                     |   19 +-
+ block/blk-integrity.c                           |   58 -
+ block/blk-iolatency.c                           |   19 +-
+ block/blk-map.c                                 |   13 +-
+ block/blk-merge.c                               |   85 +-
+ block/blk-mq-debugfs.c                          |    1 +
+ block/blk-mq-dma.c                              |  282 +++-
+ block/blk-mq-sched.c                            |   14 +-
+ block/blk-mq-sched.h                            |   13 +-
+ block/blk-mq-sysfs.c                            |    7 +-
+ block/blk-mq-tag.c                              |  128 +-
+ block/blk-mq.c                                  |  175 +--
+ block/blk-mq.h                                  |   22 +-
+ block/blk-settings.c                            |   84 +-
+ block/blk-sysfs.c                               |   70 +-
+ block/blk-throttle.c                            |   15 +-
+ block/blk-throttle.h                            |   18 +-
+ block/blk.h                                     |   46 +-
+ block/elevator.c                                |    3 +-
+ block/elevator.h                                |    2 +-
+ block/fops.c                                    |   10 +-
+ block/ioctl.c                                   |    6 +-
+ block/kyber-iosched.c                           |   19 +-
+ block/mq-deadline.c                             |   20 +-
+ block/partitions/ibm.c                          |    2 +-
+ drivers/ata/libata-scsi.c                       |    4 +-
+ drivers/block/Kconfig                           |   10 +-
+ drivers/block/Makefile                          |    4 +-
+ drivers/block/amiflop.c                         |   10 +-
+ drivers/block/aoe/aoeblk.c                      |    4 +-
+ drivers/block/aoe/aoemain.c                     |    2 +-
+ drivers/block/brd.c                             |   75 +-
+ drivers/block/floppy.c                          |   69 +-
+ drivers/block/mtip32xx/mtip32xx.c               |    6 +-
+ drivers/block/nbd.c                             |   10 +-
+ drivers/block/null_blk/main.c                   |    2 +-
+ drivers/block/rbd.c                             |    2 +-
+ drivers/block/rnbd/rnbd-clt.c                   |    6 +-
+ drivers/block/rnull.rs                          |   80 --
+ drivers/block/rnull/Kconfig                     |   13 +
+ drivers/block/rnull/Makefile                    |    3 +
+ drivers/block/rnull/configfs.rs                 |  262 ++++
+ drivers/block/rnull/rnull.rs                    |  104 ++
+ drivers/block/sunvdc.c                          |    7 +-
+ drivers/block/swim.c                            |    4 +-
+ drivers/block/ublk_drv.c                        |  242 ++--
+ drivers/block/virtio_blk.c                      |    8 +-
+ drivers/block/xen-blkfront.c                    |    4 +-
+ drivers/block/zram/zram_drv.c                   |    2 +-
+ drivers/md/Kconfig                              |   29 +
+ drivers/md/Makefile                             |    4 +-
+ drivers/md/bcache/debug.c                       |    3 +-
+ drivers/md/bcache/io.c                          |    3 +-
+ drivers/md/bcache/journal.c                     |    2 +-
+ drivers/md/bcache/movinggc.c                    |    8 +-
+ drivers/md/bcache/super.c                       |    2 +-
+ drivers/md/bcache/writeback.c                   |    8 +-
+ drivers/md/dm-bufio.c                           |    2 +-
+ drivers/md/dm-flakey.c                          |    2 +-
+ drivers/md/dm-raid.c                            |   18 +-
+ drivers/md/dm-vdo/vio.c                         |    2 +-
+ drivers/md/dm.c                                 |    4 +-
+ drivers/md/md-bitmap.c                          |   89 +-
+ drivers/md/md-bitmap.h                          |  107 +-
+ drivers/md/md-cluster.c                         |    2 +-
+ drivers/md/md-linear.c                          |   14 +-
+ drivers/md/md-llbitmap.c                        | 1626 +++++++++++++++++++++++
+ drivers/md/md.c                                 |  382 +++++-
+ drivers/md/md.h                                 |   24 +-
+ drivers/md/raid0.c                              |   30 +-
+ drivers/md/raid1-10.c                           |    2 +-
+ drivers/md/raid1.c                              |  119 +-
+ drivers/md/raid1.h                              |    4 +-
+ drivers/md/raid10.c                             |  107 +-
+ drivers/md/raid10.h                             |    2 +
+ drivers/md/raid5.c                              |   74 +-
+ drivers/memstick/core/ms_block.c                |    4 +-
+ drivers/memstick/core/mspro_block.c             |    4 +-
+ drivers/message/fusion/mptscsih.c               |    2 +-
+ drivers/message/fusion/mptscsih.h               |    2 +-
+ drivers/mmc/core/block.c                        |    4 +-
+ drivers/mtd/mtd_blkdevs.c                       |    4 +-
+ drivers/mtd/ubi/block.c                         |    4 +-
+ drivers/nvdimm/btt.c                            |    4 +-
+ drivers/nvme/common/auth.c                      |   86 +-
+ drivers/nvme/host/auth.c                        |    5 +-
+ drivers/nvme/host/core.c                        |   23 +-
+ drivers/nvme/host/fc.c                          |   10 +-
+ drivers/nvme/host/ioctl.c                       |    7 +-
+ drivers/nvme/host/nvme.h                        |    2 +-
+ drivers/nvme/host/pci.c                         |  188 +--
+ drivers/nvme/host/tcp.c                         |    3 +
+ drivers/nvme/target/core.c                      |   15 +-
+ drivers/nvme/target/fc.c                        |   35 +-
+ drivers/nvme/target/fcloop.c                    |    8 +-
+ drivers/s390/block/dasd.c                       |   24 +-
+ drivers/scsi/3w-9xxx.c                          |    2 +-
+ drivers/scsi/3w-sas.c                           |    2 +-
+ drivers/scsi/3w-xxxx.c                          |    2 +-
+ drivers/scsi/BusLogic.c                         |    4 +-
+ drivers/scsi/BusLogic.h                         |    2 +-
+ drivers/scsi/aacraid/linit.c                    |    6 +-
+ drivers/scsi/advansys.c                         |    2 +-
+ drivers/scsi/aha152x.c                          |    4 +-
+ drivers/scsi/aha1542.c                          |    2 +-
+ drivers/scsi/aha1740.c                          |    2 +-
+ drivers/scsi/aic7xxx/aic79xx_osm.c              |    4 +-
+ drivers/scsi/aic7xxx/aic7xxx_osm.c              |    4 +-
+ drivers/scsi/arcmsr/arcmsr_hba.c                |    6 +-
+ drivers/scsi/atp870u.c                          |    2 +-
+ drivers/scsi/fdomain.c                          |    4 +-
+ drivers/scsi/imm.c                              |    2 +-
+ drivers/scsi/initio.c                           |    4 +-
+ drivers/scsi/ipr.c                              |    8 +-
+ drivers/scsi/ips.c                              |    2 +-
+ drivers/scsi/ips.h                              |    2 +-
+ drivers/scsi/libsas/sas_scsi_host.c             |    2 +-
+ drivers/scsi/megaraid.c                         |    4 +-
+ drivers/scsi/megaraid.h                         |    2 +-
+ drivers/scsi/megaraid/megaraid_sas_base.c       |    4 +-
+ drivers/scsi/mpi3mr/mpi3mr_os.c                 |    4 +-
+ drivers/scsi/mpt3sas/mpt3sas_scsih.c            |    4 +-
+ drivers/scsi/mvumi.c                            |    2 +-
+ drivers/scsi/myrb.c                             |    2 +-
+ drivers/scsi/pcmcia/sym53c500_cs.c              |    2 +-
+ drivers/scsi/ppa.c                              |    2 +-
+ drivers/scsi/qla1280.c                          |    2 +-
+ drivers/scsi/qlogicfas408.c                     |    2 +-
+ drivers/scsi/qlogicfas408.h                     |    2 +-
+ drivers/scsi/scsicam.c                          |   16 +-
+ drivers/scsi/sd.c                               |    8 +-
+ drivers/scsi/stex.c                             |    2 +-
+ drivers/scsi/storvsc_drv.c                      |    2 +-
+ drivers/scsi/wd719x.c                           |    2 +-
+ drivers/target/target_core_pscsi.c              |    2 +-
+ fs/bcachefs/btree_io.c                          |    2 +-
+ fs/bcachefs/data_update.h                       |    1 -
+ fs/bcachefs/journal.c                           |    6 +-
+ fs/bcachefs/journal_io.c                        |    2 +-
+ fs/bcachefs/super-io.c                          |    2 +-
+ fs/btrfs/ioctl.c                                |    2 +-
+ fs/fuse/dev_uring.c                             |    8 +-
+ fs/iomap/direct-io.c                            |    5 +-
+ fs/squashfs/block.c                             |    2 +-
+ include/linux/bio-integrity.h                   |    1 +
+ include/linux/bio.h                             |   18 +-
+ include/linux/blk-integrity.h                   |   32 +
+ include/linux/blk-mq-dma.h                      |   25 +-
+ include/linux/blk-mq.h                          |    4 +
+ include/linux/blk_types.h                       |   19 +-
+ include/linux/blkdev.h                          |   26 +-
+ include/linux/io_uring/cmd.h                    |   69 +-
+ include/linux/io_uring_types.h                  |   32 +-
+ include/linux/libata.h                          |    2 +-
+ include/linux/poison.h                          |    3 +
+ include/linux/uio.h                             |    2 -
+ include/scsi/libsas.h                           |    2 +-
+ include/scsi/scsi_host.h                        |    2 +-
+ include/scsi/scsicam.h                          |    7 +-
+ include/trace/events/io_uring.h                 |    4 +-
+ include/uapi/linux/io_uring.h                   |   38 +-
+ include/uapi/linux/io_uring/query.h             |   41 +
+ io_uring/Makefile                               |    2 +-
+ io_uring/cancel.c                               |    1 +
+ io_uring/cmd_net.c                              |    3 +-
+ io_uring/fdinfo.c                               |   24 +-
+ io_uring/futex.c                                |   13 +-
+ io_uring/io_uring.c                             |  172 ++-
+ io_uring/io_uring.h                             |  133 +-
+ io_uring/kbuf.c                                 |   67 +-
+ io_uring/kbuf.h                                 |   39 +-
+ io_uring/net.c                                  |  160 ++-
+ io_uring/nop.c                                  |   17 +-
+ io_uring/notif.c                                |    5 +
+ io_uring/opdef.c                                |    1 +
+ io_uring/openclose.c                            |    1 +
+ io_uring/poll.c                                 |    6 +-
+ io_uring/query.c                                |  101 ++
+ io_uring/query.h                                |    9 +
+ io_uring/register.c                             |   60 +-
+ io_uring/rsrc.c                                 |    8 +
+ io_uring/rw.c                                   |   63 +-
+ io_uring/splice.c                               |    1 +
+ io_uring/timeout.c                              |    2 +-
+ io_uring/uring_cmd.c                            |   85 +-
+ io_uring/waitid.c                               |    4 +-
+ io_uring/zcrx.c                                 |  295 ++--
+ io_uring/zcrx.h                                 |   19 +-
+ lib/iov_iter.c                                  |   95 --
+ rust/kernel/block.rs                            |   13 +
+ rust/kernel/block/mq.rs                         |   14 +-
+ rust/kernel/block/mq/gen_disk.rs                |   54 +-
+ rust/kernel/block/mq/operations.rs              |   65 +-
+ rust/kernel/block/mq/raw_writer.rs              |   55 -
+ rust/kernel/block/mq/request.rs                 |   21 +-
+ rust/kernel/configfs.rs                         |    2 +
+ rust/kernel/str.rs                              |  162 ++-
+ samples/rust/rust_configfs.rs                   |    2 +-
+ tools/testing/selftests/ublk/Makefile           |    1 +
+ tools/testing/selftests/ublk/kublk.c            |   32 +-
+ tools/testing/selftests/ublk/test_generic_01.sh |    4 +
+ tools/testing/selftests/ublk/test_generic_02.sh |    4 +
+ tools/testing/selftests/ublk/test_generic_12.sh |    4 +
+ tools/testing/selftests/ublk/test_generic_13.sh |   20 +
+ tools/testing/selftests/ublk/test_null_01.sh    |    4 +
+ tools/testing/selftests/ublk/test_null_02.sh    |    4 +
+ tools/testing/selftests/ublk/test_stress_05.sh  |    4 +
+ 230 files changed, 5571 insertions(+), 2315 deletions(-)
+ delete mode 100644 drivers/block/rnull.rs
+ create mode 100644 drivers/block/rnull/Kconfig
+ create mode 100644 drivers/block/rnull/Makefile
+ create mode 100644 drivers/block/rnull/configfs.rs
+ create mode 100644 drivers/block/rnull/rnull.rs
+ create mode 100644 drivers/md/md-llbitmap.c
+ create mode 100644 include/uapi/linux/io_uring/query.h
+ create mode 100644 io_uring/query.c
+ create mode 100644 io_uring/query.h
+ delete mode 100644 rust/kernel/block/mq/raw_writer.rs
+ create mode 100755 tools/testing/selftests/ublk/test_generic_13.sh
+Merging device-mapper/for-next (55dcfdf8af9c3 dm raid: use proper md_ro_state enumerators)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/device-mapper/linux-dm.git device-mapper/for-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/md/Kconfig
+Auto-merging drivers/md/Makefile
+Auto-merging drivers/md/dm-bufio.c
+Auto-merging drivers/md/dm-integrity.c
+Auto-merging drivers/md/dm-raid.c
+Auto-merging drivers/md/dm.c
+Merge made by the 'ort' strategy.
+ Documentation/admin-guide/device-mapper/delay.rst  |   8 +-
+ .../admin-guide/device-mapper/dm-pcache.rst        | 202 +++++
+ Documentation/admin-guide/device-mapper/index.rst  |   1 +
+ Documentation/admin-guide/device-mapper/vdo.rst    |   1 +
+ MAINTAINERS                                        |   8 +
+ drivers/md/Kconfig                                 |   2 +
+ drivers/md/Makefile                                |   1 +
+ drivers/md/dm-bufio.c                              |  10 +-
+ drivers/md/dm-cache-policy-smq.c                   |   2 +-
+ drivers/md/dm-core.h                               |   2 +
+ drivers/md/dm-ima.c                                |  70 +-
+ drivers/md/dm-integrity.c                          | 359 ++++++---
+ drivers/md/dm-log-writes.c                         |   2 +-
+ drivers/md/dm-pcache/Kconfig                       |  17 +
+ drivers/md/dm-pcache/Makefile                      |   3 +
+ drivers/md/dm-pcache/backing_dev.c                 | 374 +++++++++
+ drivers/md/dm-pcache/backing_dev.h                 | 127 +++
+ drivers/md/dm-pcache/cache.c                       | 445 +++++++++++
+ drivers/md/dm-pcache/cache.h                       | 635 +++++++++++++++
+ drivers/md/dm-pcache/cache_dev.c                   | 303 +++++++
+ drivers/md/dm-pcache/cache_dev.h                   |  70 ++
+ drivers/md/dm-pcache/cache_gc.c                    | 170 ++++
+ drivers/md/dm-pcache/cache_key.c                   | 888 +++++++++++++++++++++
+ drivers/md/dm-pcache/cache_req.c                   | 836 +++++++++++++++++++
+ drivers/md/dm-pcache/cache_segment.c               | 305 +++++++
+ drivers/md/dm-pcache/cache_writeback.c             | 261 ++++++
+ drivers/md/dm-pcache/dm_pcache.c                   | 497 ++++++++++++
+ drivers/md/dm-pcache/dm_pcache.h                   |  67 ++
+ drivers/md/dm-pcache/pcache_internal.h             | 117 +++
+ drivers/md/dm-pcache/segment.c                     |  61 ++
+ drivers/md/dm-pcache/segment.h                     |  74 ++
+ drivers/md/dm-raid.c                               |  13 +-
+ drivers/md/dm-region-hash.c                        |   2 +-
+ drivers/md/dm-switch.c                             |   4 +-
+ drivers/md/dm-target.c                             |   3 +-
+ drivers/md/dm-thin.c                               |   4 +-
+ drivers/md/dm-vdo/data-vio.c                       |  17 +-
+ drivers/md/dm-vdo/indexer/volume-index.c           |   4 +-
+ drivers/md/dm.c                                    |  45 +-
+ 39 files changed, 5829 insertions(+), 181 deletions(-)
+ create mode 100644 Documentation/admin-guide/device-mapper/dm-pcache.rst
+ create mode 100644 drivers/md/dm-pcache/Kconfig
+ create mode 100644 drivers/md/dm-pcache/Makefile
+ create mode 100644 drivers/md/dm-pcache/backing_dev.c
+ create mode 100644 drivers/md/dm-pcache/backing_dev.h
+ create mode 100644 drivers/md/dm-pcache/cache.c
+ create mode 100644 drivers/md/dm-pcache/cache.h
+ create mode 100644 drivers/md/dm-pcache/cache_dev.c
+ create mode 100644 drivers/md/dm-pcache/cache_dev.h
+ create mode 100644 drivers/md/dm-pcache/cache_gc.c
+ create mode 100644 drivers/md/dm-pcache/cache_key.c
+ create mode 100644 drivers/md/dm-pcache/cache_req.c
+ create mode 100644 drivers/md/dm-pcache/cache_segment.c
+ create mode 100644 drivers/md/dm-pcache/cache_writeback.c
+ create mode 100644 drivers/md/dm-pcache/dm_pcache.c
+ create mode 100644 drivers/md/dm-pcache/dm_pcache.h
+ create mode 100644 drivers/md/dm-pcache/pcache_internal.h
+ create mode 100644 drivers/md/dm-pcache/segment.c
+ create mode 100644 drivers/md/dm-pcache/segment.h
+Merging libata/for-next (f145845d8348c dt-bindings: ata: apm,xgene-ahci: Add apm,xgene-ahci-v2 support)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/libata/linux libata/for-next
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/ata/apm,xgene-ahci.yaml     | 21 ++++++++++++++-------
+ Documentation/devicetree/bindings/ata/imx-sata.yaml |  3 +++
+ .../devicetree/bindings/ata/sata_highbank.yaml      |  2 +-
+ 3 files changed, 18 insertions(+), 8 deletions(-)
+Merging pcmcia/pcmcia-next (4a81f78caa53e pcmcia: Add error handling for add_interval() in do_validate_mem())
+$ git merge -m Merge branch 'pcmcia-next' of https://git.kernel.org/pub/scm/linux/kernel/git/brodo/linux.git pcmcia/pcmcia-next
+Already up to date.
+Merging mmc/next (7aada81cd75ad dt-bindings: mmc: samsung,exynos-dw-mshc: add specific compatible for exynos8890)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/mmc.git mmc/next
+Auto-merging drivers/mmc/core/block.c
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/mmc/fsl,esdhc.yaml         |  1 +
+ .../bindings/mmc/mmc-controller-common.yaml        |  8 +++
+ .../bindings/mmc/samsung,exynos-dw-mshc.yaml       |  1 +
+ .../devicetree/bindings/mmc/sdhci-msm.yaml         |  1 +
+ .../devicetree/bindings/mmc/sdhci-pxa.yaml         | 31 ++++++++-
+ drivers/memstick/core/memstick.c                   |  8 ++-
+ drivers/memstick/host/rtsx_usb_ms.c                |  5 +-
+ drivers/misc/cardreader/rtsx_usb.c                 |  7 ++
+ drivers/mmc/core/block.c                           | 46 ++++++-------
+ drivers/mmc/core/bus.c                             | 12 ++++
+ drivers/mmc/core/card.h                            |  9 ++-
+ drivers/mmc/core/core.c                            | 32 +++++++++
+ drivers/mmc/core/core.h                            |  6 ++
+ drivers/mmc/core/host.c                            |  4 ++
+ drivers/mmc/core/mmc.c                             | 70 +++++++++++++++++++-
+ drivers/mmc/core/mmc_ops.c                         | 72 ++++++++++++++++++++
+ drivers/mmc/core/mmc_test.c                        | 10 +--
+ drivers/mmc/core/regulator.c                       | 77 ++++++++++++++++++++++
+ drivers/mmc/core/sd.c                              |  2 +-
+ drivers/mmc/core/sdio.c                            |  6 +-
+ drivers/mmc/core/sdio_bus.c                        |  3 -
+ drivers/mmc/host/Kconfig                           | 14 ++--
+ drivers/mmc/host/alcor.c                           |  8 +--
+ drivers/mmc/host/atmel-mci.c                       |  9 +--
+ drivers/mmc/host/au1xmmc.c                         | 18 ++---
+ drivers/mmc/host/cb710-mmc.c                       | 19 +++---
+ drivers/mmc/host/davinci_mmc.c                     | 16 ++---
+ drivers/mmc/host/dw_mmc-exynos.c                   | 13 +---
+ drivers/mmc/host/dw_mmc-k3.c                       |  9 +--
+ drivers/mmc/host/dw_mmc-pci.c                      |  9 +--
+ drivers/mmc/host/dw_mmc-rockchip.c                 |  9 +--
+ drivers/mmc/host/dw_mmc.h                          |  3 +
+ drivers/mmc/host/meson-mx-sdhc-clkc.c              |  4 +-
+ drivers/mmc/host/mmc_spi.c                         |  4 +-
+ drivers/mmc/host/mmci.c                            |  9 +--
+ drivers/mmc/host/mtk-sd.c                          | 14 ++--
+ drivers/mmc/host/mxs-mmc.c                         |  6 +-
+ drivers/mmc/host/omap_hsmmc.c                      | 13 ++--
+ drivers/mmc/host/renesas_sdhi_core.c               |  6 +-
+ drivers/mmc/host/renesas_sdhi_internal_dmac.c      |  3 +-
+ drivers/mmc/host/rtsx_usb_sdmmc.c                  | 40 ++++++++---
+ drivers/mmc/host/sdhci-acpi.c                      | 18 ++---
+ drivers/mmc/host/sdhci-brcmstb.c                   |  8 +--
+ drivers/mmc/host/sdhci-cadence.c                   | 70 ++++++++++++++++++--
+ drivers/mmc/host/sdhci-esdhc-imx.c                 | 13 +---
+ drivers/mmc/host/sdhci-msm.c                       | 36 ++++++----
+ drivers/mmc/host/sdhci-of-arasan.c                 |  8 +--
+ drivers/mmc/host/sdhci-of-at91.c                   | 12 +---
+ drivers/mmc/host/sdhci-of-dwcmshc.c                | 13 +---
+ drivers/mmc/host/sdhci-of-esdhc.c                  |  8 +--
+ drivers/mmc/host/sdhci-omap.c                      | 18 ++---
+ drivers/mmc/host/sdhci-pci-core.c                  | 15 ++++-
+ drivers/mmc/host/sdhci-pxav3.c                     | 52 ++++++++++++---
+ drivers/mmc/host/sdhci-s3c.c                       | 11 +---
+ drivers/mmc/host/sdhci-spear.c                     |  6 +-
+ drivers/mmc/host/sdhci-sprd.c                      | 10 +--
+ drivers/mmc/host/sdhci-st.c                        |  6 +-
+ drivers/mmc/host/sdhci-tegra.c                     | 13 ++--
+ drivers/mmc/host/sdhci-xenon.c                     | 13 +---
+ drivers/mmc/host/sdhci.h                           |  7 ++
+ drivers/mmc/host/sdhci_am654.c                     | 11 +---
+ drivers/mmc/host/sh_mmcif.c                        | 13 +---
+ drivers/mmc/host/sunxi-mmc.c                       | 11 +---
+ drivers/mmc/host/tmio_mmc.h                        | 15 +++++
+ drivers/mmc/host/tmio_mmc_core.c                   | 33 ++++++++++
+ drivers/mmc/host/toshsd.c                          |  8 +--
+ drivers/mmc/host/via-sdmmc.c                       | 10 +--
+ drivers/mmc/host/wmt-sdmmc.c                       | 16 +----
+ include/linux/mmc/host.h                           | 13 ++++
+ include/linux/platform_data/tmio.h                 |  3 +
+ include/linux/rtsx_usb.h                           | 11 ++++
+ 71 files changed, 754 insertions(+), 364 deletions(-)
+Merging mfd/for-mfd-next (ac41dc6e81e6b mfd: intel-lpss: Add Intel Wildcat Lake LPSS PCI IDs)
+$ git merge -m Merge branch 'for-mfd-next' of https://git.kernel.org/pub/scm/linux/kernel/git/lee/mfd.git mfd/for-mfd-next
+Auto-merging Documentation/devicetree/bindings/hwmon/kontron,sl28cpld-hwmon.yaml
+Auto-merging MAINTAINERS
+Auto-merging drivers/crypto/Kconfig
+Auto-merging drivers/crypto/Makefile
+Auto-merging drivers/mfd/Kconfig
+Auto-merging drivers/mfd/Makefile
+Auto-merging sound/soc/codecs/Kconfig
+Merge made by the 'ort' strategy.
+ .../acer,aspire1-ec.yaml                           |   2 +-
+ .../google,cros-ec.yaml                            |   2 +-
+ .../gw,gsc.yaml}                                   |   2 +-
+ .../huawei,gaokun3-ec.yaml}                        |   2 +-
+ .../kontron,sl28cpld.yaml                          |   9 +-
+ .../lenovo,yoga-c630-ec.yaml                       |   2 +-
+ .../microsoft,surface-sam.yaml                     |   2 +-
+ .../bindings/gpio/kontron,sl28cpld-gpio.yaml       |   2 +-
+ .../bindings/hwmon/kontron,sl28cpld-hwmon.yaml     |   2 +-
+ .../kontron,sl28cpld-intc.yaml                     |   2 +-
+ .../bindings/mfd/aspeed,ast2x00-scu.yaml           |  37 +-
+ .../devicetree/bindings/mfd/aspeed-lpc.yaml        |   3 +
+ .../devicetree/bindings/mfd/fsl,mc13xxx.yaml       | 288 +++++++++++
+ Documentation/devicetree/bindings/mfd/mc13xxx.txt  | 156 ------
+ .../devicetree/bindings/mfd/qnap,ts433-mcu.yaml    |   4 +
+ .../devicetree/bindings/mfd/spacemit,p1.yaml       |  86 ++++
+ Documentation/devicetree/bindings/mfd/syscon.yaml  |   4 +
+ .../devicetree/bindings/misc/aspeed-p2a-ctrl.txt   |  46 --
+ .../bindings/pwm/google,cros-ec-pwm.yaml           |   2 +-
+ .../bindings/pwm/kontron,sl28cpld-pwm.yaml         |   2 +-
+ .../devicetree/bindings/remoteproc/mtk,scp.yaml    |   4 +-
+ .../bindings/sound/google,cros-ec-codec.yaml       |   2 +-
+ .../bindings/watchdog/kontron,sl28cpld-wdt.yaml    |   2 +-
+ MAINTAINERS                                        |  27 +-
+ drivers/char/tpm/Kconfig                           |   9 +
+ drivers/char/tpm/Makefile                          |   1 +
+ drivers/char/tpm/tpm_loongson.c                    |  84 ++++
+ drivers/crypto/Kconfig                             |   1 +
+ drivers/crypto/Makefile                            |   1 +
+ drivers/crypto/loongson/Kconfig                    |   5 +
+ drivers/crypto/loongson/Makefile                   |   1 +
+ drivers/crypto/loongson/loongson-rng.c             | 209 ++++++++
+ drivers/input/misc/mc13783-pwrbutton.c             |   1 -
+ drivers/input/touchscreen/mc13783_ts.c             |   4 -
+ drivers/mfd/88pm886.c                              |   1 +
+ drivers/mfd/Kconfig                                |  66 ++-
+ drivers/mfd/Makefile                               |   6 +
+ drivers/mfd/adp5585.c                              |   1 -
+ drivers/mfd/arizona-irq.c                          |   5 +-
+ drivers/mfd/cs42l43.c                              |  32 +-
+ drivers/mfd/da9063-i2c.c                           |  27 +-
+ drivers/mfd/exynos-lpass.c                         |   1 -
+ drivers/mfd/fsl-imx25-tsadc.c                      |   1 -
+ drivers/mfd/intel-lpss-pci.c                       |  13 +
+ drivers/mfd/intel_soc_pmic_chtdc_ti.c              |   2 +
+ drivers/mfd/kempld-core.c                          |  36 +-
+ drivers/mfd/loongson-se.c                          | 253 ++++++++++
+ drivers/mfd/ls2k-bmc-core.c                        | 528 +++++++++++++++++++++
+ drivers/mfd/macsmc.c                               |   5 +-
+ drivers/mfd/madera-core.c                          |   4 +-
+ drivers/mfd/max77705.c                             |  35 +-
+ drivers/mfd/max8997.c                              |   4 +-
+ drivers/mfd/max8998.c                              |   4 +-
+ drivers/mfd/mfd-core.c                             |   1 +
+ drivers/mfd/nct6694.c                              | 388 +++++++++++++++
+ drivers/mfd/qnap-mcu.c                             |  39 +-
+ drivers/mfd/rohm-bd71828.c                         |  44 +-
+ drivers/mfd/rz-mtu3.c                              |   2 +-
+ drivers/mfd/simple-mfd-i2c.c                       |  19 +
+ drivers/mfd/stm32-lptimer.c                        |   1 -
+ drivers/mfd/stmpe-i2c.c                            |  14 +-
+ drivers/mfd/stmpe-spi.c                            |  14 +-
+ drivers/mfd/stmpe.c                                |   9 +
+ drivers/mfd/sun4i-gpadc.c                          |   1 -
+ drivers/mfd/vexpress-sysreg.c                      |  25 +-
+ drivers/rtc/rtc-mc13xxx.c                          |  13 -
+ include/linux/mfd/arizona/pdata.h                  |   6 +
+ include/linux/mfd/loongson-se.h                    |  53 +++
+ include/linux/mfd/mc13xxx.h                        |   6 -
+ include/linux/mfd/nct6694.h                        | 102 ++++
+ include/linux/mfd/qnap-mcu.h                       |   2 +
+ include/linux/mfd/rohm-bd71828.h                   |  63 +++
+ sound/soc/codecs/Kconfig                           |   1 +
+ sound/soc/codecs/arizona-jack.c                    |  17 +-
+ 74 files changed, 2455 insertions(+), 395 deletions(-)
+ rename Documentation/devicetree/bindings/{platform => embedded-controller}/acer,aspire1-ec.yaml (94%)
+ rename Documentation/devicetree/bindings/{mfd => embedded-controller}/google,cros-ec.yaml (99%)
+ rename Documentation/devicetree/bindings/{mfd/gateworks-gsc.yaml => embedded-controller/gw,gsc.yaml} (98%)
+ rename Documentation/devicetree/bindings/{platform/huawei,gaokun-ec.yaml => embedded-controller/huawei,gaokun3-ec.yaml} (97%)
+ rename Documentation/devicetree/bindings/{mfd => embedded-controller}/kontron,sl28cpld.yaml (94%)
+ rename Documentation/devicetree/bindings/{platform => embedded-controller}/lenovo,yoga-c630-ec.yaml (95%)
+ rename Documentation/devicetree/bindings/{platform => embedded-controller}/microsoft,surface-sam.yaml (92%)
+ create mode 100644 Documentation/devicetree/bindings/mfd/fsl,mc13xxx.yaml
+ delete mode 100644 Documentation/devicetree/bindings/mfd/mc13xxx.txt
+ create mode 100644 Documentation/devicetree/bindings/mfd/spacemit,p1.yaml
+ delete mode 100644 Documentation/devicetree/bindings/misc/aspeed-p2a-ctrl.txt
+ create mode 100644 drivers/char/tpm/tpm_loongson.c
+ create mode 100644 drivers/crypto/loongson/Kconfig
+ create mode 100644 drivers/crypto/loongson/Makefile
+ create mode 100644 drivers/crypto/loongson/loongson-rng.c
+ create mode 100644 drivers/mfd/loongson-se.c
+ create mode 100644 drivers/mfd/ls2k-bmc-core.c
+ create mode 100644 drivers/mfd/nct6694.c
+ create mode 100644 include/linux/mfd/loongson-se.h
+ create mode 100644 include/linux/mfd/nct6694.h
+$ git reset --hard HEAD^
+HEAD is now at 2e5d335a1be1b Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/ulfh/mmc.git
+Merging next-20250916 version of mfd
+$ git merge -m next-20250916/mfd 58cd9c86b24072f0a25b27d602fd36ec8c8222a7
+Auto-merging Documentation/devicetree/bindings/hwmon/kontron,sl28cpld-hwmon.yaml
+Auto-merging MAINTAINERS
+Auto-merging drivers/crypto/Kconfig
+Auto-merging drivers/crypto/Makefile
+Auto-merging drivers/mfd/Kconfig
+Auto-merging drivers/mfd/Makefile
+Auto-merging sound/soc/codecs/Kconfig
+Merge made by the 'ort' strategy.
+ .../acer,aspire1-ec.yaml                           |   2 +-
+ .../google,cros-ec.yaml                            |   2 +-
+ .../gw,gsc.yaml}                                   |   2 +-
+ .../huawei,gaokun3-ec.yaml}                        |   2 +-
+ .../kontron,sl28cpld.yaml                          |   9 +-
+ .../lenovo,yoga-c630-ec.yaml                       |   2 +-
+ .../microsoft,surface-sam.yaml                     |   2 +-
+ .../bindings/gpio/kontron,sl28cpld-gpio.yaml       |   2 +-
+ .../bindings/hwmon/kontron,sl28cpld-hwmon.yaml     |   2 +-
+ .../kontron,sl28cpld-intc.yaml                     |   2 +-
+ .../bindings/mfd/aspeed,ast2x00-scu.yaml           |  37 ++-
+ .../devicetree/bindings/mfd/aspeed-lpc.yaml        |   3 +
+ .../devicetree/bindings/mfd/fsl,mc13xxx.yaml       | 288 +++++++++++++++++++++
+ Documentation/devicetree/bindings/mfd/mc13xxx.txt  | 156 -----------
+ .../devicetree/bindings/mfd/qnap,ts433-mcu.yaml    |   4 +
+ .../devicetree/bindings/mfd/spacemit,p1.yaml       |  86 ++++++
+ Documentation/devicetree/bindings/mfd/syscon.yaml  |   4 +
+ .../devicetree/bindings/misc/aspeed-p2a-ctrl.txt   |  46 ----
+ .../bindings/pwm/google,cros-ec-pwm.yaml           |   2 +-
+ .../bindings/pwm/kontron,sl28cpld-pwm.yaml         |   2 +-
+ .../devicetree/bindings/remoteproc/mtk,scp.yaml    |   4 +-
+ .../bindings/sound/google,cros-ec-codec.yaml       |   2 +-
+ .../bindings/watchdog/kontron,sl28cpld-wdt.yaml    |   2 +-
+ MAINTAINERS                                        |  15 +-
+ drivers/char/tpm/Kconfig                           |   9 +
+ drivers/char/tpm/Makefile                          |   1 +
+ drivers/char/tpm/tpm_loongson.c                    |  84 ++++++
+ drivers/crypto/Kconfig                             |   1 +
+ drivers/crypto/Makefile                            |   1 +
+ drivers/crypto/loongson/Kconfig                    |   5 +
+ drivers/crypto/loongson/Makefile                   |   1 +
+ drivers/crypto/loongson/loongson-rng.c             | 209 +++++++++++++++
+ drivers/mfd/Kconfig                                |  28 +-
+ drivers/mfd/Makefile                               |   2 +
+ drivers/mfd/adp5585.c                              |   1 -
+ drivers/mfd/arizona-irq.c                          |   5 +-
+ drivers/mfd/da9063-i2c.c                           |  27 +-
+ drivers/mfd/exynos-lpass.c                         |   1 -
+ drivers/mfd/fsl-imx25-tsadc.c                      |   1 -
+ drivers/mfd/intel_soc_pmic_chtdc_ti.c              |   2 +
+ drivers/mfd/kempld-core.c                          |  36 +--
+ drivers/mfd/loongson-se.c                          | 253 ++++++++++++++++++
+ drivers/mfd/macsmc.c                               |   5 +-
+ drivers/mfd/madera-core.c                          |   4 +-
+ drivers/mfd/max8997.c                              |   4 +-
+ drivers/mfd/max8998.c                              |   4 +-
+ drivers/mfd/mfd-core.c                             |   1 +
+ drivers/mfd/qnap-mcu.c                             |  39 +--
+ drivers/mfd/rohm-bd71828.c                         |  44 +++-
+ drivers/mfd/simple-mfd-i2c.c                       |  19 ++
+ drivers/mfd/stm32-lptimer.c                        |   1 -
+ drivers/mfd/stmpe-i2c.c                            |  14 +-
+ drivers/mfd/stmpe-spi.c                            |  14 +-
+ drivers/mfd/stmpe.c                                |   3 +
+ drivers/mfd/sun4i-gpadc.c                          |   1 -
+ drivers/mfd/vexpress-sysreg.c                      |  25 +-
+ include/linux/mfd/arizona/pdata.h                  |   6 +
+ include/linux/mfd/loongson-se.h                    |  53 ++++
+ include/linux/mfd/qnap-mcu.h                       |   2 +
+ include/linux/mfd/rohm-bd71828.h                   |  63 +++++
+ sound/soc/codecs/Kconfig                           |   1 +
+ sound/soc/codecs/arizona-jack.c                    |  17 +-
+ 62 files changed, 1350 insertions(+), 315 deletions(-)
+ rename Documentation/devicetree/bindings/{platform => embedded-controller}/acer,aspire1-ec.yaml (94%)
+ rename Documentation/devicetree/bindings/{mfd => embedded-controller}/google,cros-ec.yaml (99%)
+ rename Documentation/devicetree/bindings/{mfd/gateworks-gsc.yaml => embedded-controller/gw,gsc.yaml} (98%)
+ rename Documentation/devicetree/bindings/{platform/huawei,gaokun-ec.yaml => embedded-controller/huawei,gaokun3-ec.yaml} (97%)
+ rename Documentation/devicetree/bindings/{mfd => embedded-controller}/kontron,sl28cpld.yaml (94%)
+ rename Documentation/devicetree/bindings/{platform => embedded-controller}/lenovo,yoga-c630-ec.yaml (95%)
+ rename Documentation/devicetree/bindings/{platform => embedded-controller}/microsoft,surface-sam.yaml (92%)
+ create mode 100644 Documentation/devicetree/bindings/mfd/fsl,mc13xxx.yaml
+ delete mode 100644 Documentation/devicetree/bindings/mfd/mc13xxx.txt
+ create mode 100644 Documentation/devicetree/bindings/mfd/spacemit,p1.yaml
+ delete mode 100644 Documentation/devicetree/bindings/misc/aspeed-p2a-ctrl.txt
+ create mode 100644 drivers/char/tpm/tpm_loongson.c
+ create mode 100644 drivers/crypto/loongson/Kconfig
+ create mode 100644 drivers/crypto/loongson/Makefile
+ create mode 100644 drivers/crypto/loongson/loongson-rng.c
+ create mode 100644 drivers/mfd/loongson-se.c
+ create mode 100644 include/linux/mfd/loongson-se.h
+Merging backlight/for-backlight-next (9f218f9bb9d27 backlight: Do not include <linux/fb.h> in header file)
+$ git merge -m Merge branch 'for-backlight-next' of https://git.kernel.org/pub/scm/linux/kernel/git/lee/backlight.git backlight/for-backlight-next
+Merge made by the 'ort' strategy.
+ drivers/video/backlight/apple_dwi_bl.c      |  1 +
+ drivers/video/backlight/as3711_bl.c         |  1 +
+ drivers/video/backlight/backlight.c         |  1 +
+ drivers/video/backlight/da9052_bl.c         |  1 +
+ drivers/video/backlight/jornada720_bl.c     |  1 +
+ drivers/video/backlight/ktd2801-backlight.c |  1 +
+ drivers/video/backlight/led_bl.c            |  5 +++--
+ drivers/video/backlight/lp855x_bl.c         |  2 +-
+ drivers/video/backlight/mp3309c.c           | 14 +++++++-------
+ drivers/video/backlight/rave-sp-backlight.c |  2 ++
+ drivers/video/backlight/rt4831-backlight.c  |  1 +
+ include/linux/backlight.h                   |  1 -
+ 12 files changed, 20 insertions(+), 11 deletions(-)
+Merging battery/for-next (41307ec7df057 power: supply: qcom_battmgr: handle charging state change notifications)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sre/linux-power-supply.git battery/for-next
+Auto-merging drivers/power/supply/bq27xxx_battery.c
+Merge made by the 'ort' strategy.
+ Documentation/ABI/testing/sysfs-class-power        |  37 ++
+ .../devicetree/bindings/power/supply/bq24190.yaml  |   6 +
+ .../devicetree/bindings/power/supply/bq27xxx.yaml  |  37 +-
+ .../bindings/soc/qcom/qcom,pmic-glink.yaml         |  14 +
+ drivers/mfd/max77705.c                             |   3 +
+ drivers/power/supply/88pm860x_charger.c            |   8 +-
+ drivers/power/supply/Kconfig                       |  16 +
+ drivers/power/supply/Makefile                      |   2 +
+ drivers/power/supply/ab8500_btemp.c                |   3 +-
+ drivers/power/supply/adc-battery-helper.c          | 327 +++++++++++++++++
+ drivers/power/supply/adc-battery-helper.h          |  62 ++++
+ drivers/power/supply/bq2415x_charger.c             |   4 +-
+ drivers/power/supply/bq24190_charger.c             |   2 +-
+ drivers/power/supply/bq27xxx_battery.c             |  17 +-
+ drivers/power/supply/cw2015_battery.c              |   8 +-
+ drivers/power/supply/gpio-charger.c                |   7 +-
+ drivers/power/supply/intel_dc_ti_battery.c         | 389 +++++++++++++++++++++
+ drivers/power/supply/ipaq_micro_battery.c          |   3 +-
+ drivers/power/supply/max77705_charger.c            | 330 ++++++++++-------
+ drivers/power/supply/max77976_charger.c            |  12 +-
+ drivers/power/supply/mt6370-charger.c              |  18 +-
+ drivers/power/supply/power_supply_sysfs.c          |   2 +
+ drivers/power/supply/qcom_battmgr.c                | 324 ++++++++++++++++-
+ drivers/power/supply/rk817_charger.c               |   6 +-
+ drivers/power/supply/rt9467-charger.c              |  47 +--
+ drivers/power/supply/rx51_battery.c                |   2 +-
+ drivers/power/supply/sbs-charger.c                 |  16 +-
+ drivers/power/supply/sbs-manager.c                 |   2 +-
+ drivers/power/supply/ucs1002_power.c               |   2 +-
+ drivers/power/supply/ug3105_battery.c              | 346 ++++--------------
+ include/linux/power/max77705_charger.h             | 144 ++++----
+ include/linux/power_supply.h                       |   2 +
+ 32 files changed, 1609 insertions(+), 589 deletions(-)
+ create mode 100644 drivers/power/supply/adc-battery-helper.c
+ create mode 100644 drivers/power/supply/adc-battery-helper.h
+ create mode 100644 drivers/power/supply/intel_dc_ti_battery.c
+Merging regulator/for-next (e609438851928 regulator: dt-bindings: qcom,sdm845-refgen-regulator: document more platforms)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regulator.git regulator/for-next
+Auto-merging MAINTAINERS
+CONFLICT (content): Merge conflict in MAINTAINERS
+Resolved 'MAINTAINERS' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master fcb10848b4852] Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/regulator.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/devicetree/bindings/mfd/act8945a.txt |  82 --
+ .../power/supply/active-semi,act8945a-charger.yaml |  76 --
+ .../bindings/regulator/active-semi,act8945a.yaml   |  25 +-
+ .../bindings/regulator/maxim,max77838.yaml         |  68 ++
+ .../devicetree/bindings/regulator/nxp,pf0900.yaml  | 163 ++++
+ .../devicetree/bindings/regulator/nxp,pf5300.yaml  |  54 ++
+ ...rrypi,7inch-touchscreen-panel-regulator-v2.yaml |  61 ++
+ ...pberrypi,7inch-touchscreen-panel-regulator.yaml |   7 +-
+ .../bindings/regulator/richtek,rt5133.yaml         | 178 ++++
+ Documentation/power/regulator/consumer.rst         |  30 +-
+ MAINTAINERS                                        |  15 +-
+ drivers/regulator/Kconfig                          |  62 ++
+ drivers/regulator/Makefile                         |   6 +
+ drivers/regulator/bd718x7-regulator.c              |   2 +-
+ drivers/regulator/core.c                           |   4 +-
+ drivers/regulator/max77838-regulator.c             | 221 +++++
+ drivers/regulator/pf0900-regulator.c               | 975 +++++++++++++++++++++
+ drivers/regulator/pf530x-regulator.c               | 375 ++++++++
+ drivers/regulator/qcom-refgen-regulator.c          |   1 -
+ drivers/regulator/rt5133-regulator.c               | 642 ++++++++++++++
+ drivers/regulator/s2dos05-regulator.c              | 165 ++++
+ drivers/regulator/scmi-regulator.c                 |   3 +-
+ drivers/regulator/spacemit-p1.c                    | 157 ++++
+ drivers/regulator/tps6524x-regulator.c             |   1 -
+ drivers/regulator/tps6594-regulator.c              |   2 +-
+ include/linux/regulator/s2dos05.h                  |  73 ++
+ rust/helpers/regulator.c                           |  10 +
+ rust/kernel/regulator.rs                           | 171 ++--
+ 28 files changed, 3351 insertions(+), 278 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/mfd/act8945a.txt
+ delete mode 100644 Documentation/devicetree/bindings/power/supply/active-semi,act8945a-charger.yaml
+ create mode 100644 Documentation/devicetree/bindings/regulator/maxim,max77838.yaml
+ create mode 100644 Documentation/devicetree/bindings/regulator/nxp,pf0900.yaml
+ create mode 100644 Documentation/devicetree/bindings/regulator/nxp,pf5300.yaml
+ create mode 100644 Documentation/devicetree/bindings/regulator/raspberrypi,7inch-touchscreen-panel-regulator-v2.yaml
+ create mode 100644 Documentation/devicetree/bindings/regulator/richtek,rt5133.yaml
+ create mode 100644 drivers/regulator/max77838-regulator.c
+ create mode 100644 drivers/regulator/pf0900-regulator.c
+ create mode 100644 drivers/regulator/pf530x-regulator.c
+ create mode 100644 drivers/regulator/rt5133-regulator.c
+ create mode 100644 drivers/regulator/s2dos05-regulator.c
+ create mode 100644 drivers/regulator/spacemit-p1.c
+ create mode 100644 include/linux/regulator/s2dos05.h
+Merging security/next (54d94c422fed9 lsm: CONFIG_LSM can depend on CONFIG_SECURITY)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/pcmoore/lsm.git security/next
+Auto-merging MAINTAINERS
+Auto-merging security/security.c
+Auto-merging security/selinux/hooks.c
+Merge made by the 'ort' strategy.
+ MAINTAINERS                       |  2 +
+ include/linux/lsm_hooks.h         |  3 ++
+ rust/kernel/cred.rs               |  6 +--
+ security/Kconfig                  |  1 +
+ security/min_addr.c               |  6 +--
+ security/security.c               | 98 +++++++++++++++++++++++++++++++++------
+ security/selinux/hooks.c          | 56 ++++------------------
+ security/selinux/include/objsec.h | 20 ++++++++
+ 8 files changed, 124 insertions(+), 68 deletions(-)
+Merging apparmor/apparmor-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'apparmor-next' of https://git.kernel.org/pub/scm/linux/kernel/git/jj/linux-apparmor apparmor/apparmor-next
+Already up to date.
+Merging integrity/next-integrity (00642a06d60c8 ima: don't clear IMA_DIGSIG flag when setting or removing non-IMA xattr)
+$ git merge -m Merge branch 'next-integrity' of https://git.kernel.org/pub/scm/linux/kernel/git/zohar/linux-integrity integrity/next-integrity
+Auto-merging lib/digsig.c
+Merge made by the 'ort' strategy.
+ lib/Kconfig                           |  3 +--
+ lib/digsig.c                          | 46 +++++------------------------------
+ security/integrity/Kconfig            |  1 +
+ security/integrity/ima/ima_appraise.c | 23 ++++++++++++++----
+ 4 files changed, 26 insertions(+), 47 deletions(-)
+Merging selinux/next (68e1e908cb768 selinux: enable per-file labeling for functionfs)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/pcmoore/selinux.git selinux/next
+Auto-merging security/selinux/hooks.c
+Merge made by the 'ort' strategy.
+ security/selinux/avc.c                     | 13 ++++++-------
+ security/selinux/hooks.c                   | 10 +++++++---
+ security/selinux/include/policycap.h       |  1 +
+ security/selinux/include/policycap_names.h |  1 +
+ security/selinux/include/security.h        |  4 ++--
+ security/selinux/selinuxfs.c               | 18 +++++-------------
+ 6 files changed, 22 insertions(+), 25 deletions(-)
+Merging smack/next (6ddd169d0288e smack: fix kernel-doc warnings for smk_import_valid_label())
+$ git merge -m Merge branch 'next' of https://github.com/cschaufler/smack-next smack/next
+Auto-merging security/smack/smack_lsm.c
+Merge made by the 'ort' strategy.
+ Documentation/admin-guide/LSM/Smack.rst |  16 +-
+ security/smack/smack.h                  |   3 +
+ security/smack/smack_access.c           |  95 ++++++++---
+ security/smack/smack_lsm.c              | 277 +++++++++++++++++++++-----------
+ 4 files changed, 273 insertions(+), 118 deletions(-)
+Merging tomoyo/master (3b3dcf8afa296 net: update dev_put()/dev_hold() debugging)
+$ git merge -m Merge branch 'master' of git://git.code.sf.net/p/tomoyo/tomoyo.git tomoyo/master
+Auto-merging include/linux/netdevice.h
+Auto-merging net/core/dev.c
+Merge made by the 'ort' strategy.
+ include/linux/netdevice.h |  11 +++++
+ net/core/dev.c            | 109 ++++++++++++++++++++++++++++++++++++++++++++++
+ 2 files changed, 120 insertions(+)
+Merging tpmdd/next (688cf647bad9f security: keys: use menuconfig for KEYS symbol)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/jarkko/linux-tpmdd.git tpmdd/next
+Auto-merging drivers/char/tpm/Kconfig
+Merge made by the 'ort' strategy.
+ drivers/char/tpm/Kconfig                  |   3 +-
+ drivers/char/tpm/tpm-chip.c               |  92 +++++-----
+ drivers/char/tpm/tpm-dev-common.c         |   8 +-
+ drivers/char/tpm/tpm-dev.c                |  27 ++-
+ drivers/char/tpm/tpm-dev.h                |   1 +
+ drivers/char/tpm/tpm-interface.c          |  22 ++-
+ drivers/char/tpm/tpm.h                    |   5 +-
+ drivers/char/tpm/tpm2-cmd.c               | 127 ++++---------
+ drivers/char/tpm/tpm2-sessions.c          | 104 ++++-------
+ drivers/char/tpm/tpm2-space.c             |   5 +-
+ drivers/char/tpm/tpm_ppi.c                |  89 ++++++---
+ drivers/char/tpm/tpm_tis_core.c           |   7 +-
+ drivers/char/tpm/tpmrm-dev.c              |  20 ++-
+ include/keys/trusted_tpm.h                |  79 --------
+ include/linux/tpm.h                       |   8 +-
+ security/keys/Kconfig                     |  17 +-
+ security/keys/encrypted-keys/encrypted.c  |  63 ++-----
+ security/keys/trusted-keys/Kconfig        |   5 +-
+ security/keys/trusted-keys/trusted_tpm1.c | 288 +++++++++++-------------------
+ 19 files changed, 369 insertions(+), 601 deletions(-)
+Merging watchdog/master (c64c2a50cdd48 watchdog/hpwdt New maintianer)
+$ git merge -m Merge branch 'master' of git://www.linux-watchdog.org/linux-watchdog-next.git watchdog/master
+Auto-merging Documentation/devicetree/bindings/watchdog/kontron,sl28cpld-wdt.yaml
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ .../bindings/watchdog/kontron,sl28cpld-wdt.yaml    |   7 +-
+ .../devicetree/bindings/watchdog/renesas,wdt.yaml  |  36 ++++-
+ MAINTAINERS                                        |   2 +-
+ drivers/watchdog/intel_oc_wdt.c                    |   8 +-
+ drivers/watchdog/mpc8xxx_wdt.c                     |   2 +
+ drivers/watchdog/rzg2l_wdt.c                       |   4 +-
+ drivers/watchdog/rzv2h_wdt.c                       | 150 ++++++++++++++++++---
+ drivers/watchdog/s3c2410_wdt.c                     |  46 +++++--
+ drivers/watchdog/visconti_wdt.c                    |   5 +-
+ 9 files changed, 212 insertions(+), 48 deletions(-)
+Merging iommu/next (5f4b8c03f4178 Merge branches 'apple/dart', 'ti/omap', 'riscv', 'intel/vt-d' and 'amd/amd-vi' into next)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/iommu/linux.git iommu/next
+Auto-merging MAINTAINERS
+Auto-merging arch/riscv/Kconfig
+Auto-merging drivers/acpi/Kconfig
+Auto-merging drivers/acpi/scan.c
+Auto-merging drivers/crypto/ccp/sev-dev.c
+Merge made by the 'ort' strategy.
+ MAINTAINERS                          |   1 +
+ arch/riscv/Kconfig                   |   1 +
+ drivers/acpi/Kconfig                 |   4 +
+ drivers/acpi/riscv/Kconfig           |   7 +
+ drivers/acpi/riscv/Makefile          |   1 +
+ drivers/acpi/riscv/init.c            |   2 +
+ drivers/acpi/riscv/init.h            |   1 +
+ drivers/acpi/riscv/rimt.c            | 520 +++++++++++++++++++++++++++++++++++
+ drivers/acpi/scan.c                  |   4 +
+ drivers/crypto/ccp/sev-dev.c         |  10 +
+ drivers/iommu/amd/amd_iommu_types.h  |   5 +
+ drivers/iommu/amd/init.c             | 284 +++++++++++++------
+ drivers/iommu/amd/iommu.c            |   5 +-
+ drivers/iommu/apple-dart.c           |  55 ++--
+ drivers/iommu/intel/debugfs.c        |  29 +-
+ drivers/iommu/intel/iommu.c          |   2 +-
+ drivers/iommu/intel/iommu.h          |   7 +-
+ drivers/iommu/intel/perf.c           |  10 +-
+ drivers/iommu/intel/perf.h           |   5 +-
+ drivers/iommu/intel/prq.c            |   7 +-
+ drivers/iommu/io-pgtable-dart.c      | 143 ++++++----
+ drivers/iommu/omap-iommu.c           |   2 +-
+ drivers/iommu/riscv/iommu-platform.c |  17 +-
+ drivers/iommu/riscv/iommu.c          |  10 +
+ include/linux/acpi_rimt.h            |  28 ++
+ include/linux/io-pgtable.h           |   1 +
+ 26 files changed, 961 insertions(+), 200 deletions(-)
+ create mode 100644 drivers/acpi/riscv/Kconfig
+ create mode 100644 drivers/acpi/riscv/rimt.c
+ create mode 100644 include/linux/acpi_rimt.h
+Merging audit/next (26cbca1db23a1 Automated merge of 'dev' into 'next')
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/pcmoore/audit.git audit/next
+Auto-merging include/linux/security.h
+Auto-merging kernel/audit_tree.c
+Auto-merging security/apparmor/lsm.c
+Auto-merging security/security.c
+Auto-merging security/selinux/hooks.c
+Auto-merging security/smack/smack_lsm.c
+Merge made by the 'ort' strategy.
+ include/linux/audit.h        |  25 +++-
+ include/linux/security.h     |   6 +-
+ include/uapi/linux/audit.h   |   2 +
+ kernel/audit.c               | 280 +++++++++++++++++++++++++++++++++++++------
+ kernel/audit.h               |  13 +-
+ kernel/audit_tree.c          |   6 +-
+ kernel/auditfilter.c         |   2 +-
+ kernel/auditsc.c             |  63 +++-------
+ net/netlabel/netlabel_user.c |   8 +-
+ security/apparmor/lsm.c      |   3 +
+ security/security.c          |  18 ++-
+ security/selinux/hooks.c     |   5 +
+ security/smack/smack_lsm.c   |   5 +
+ 13 files changed, 334 insertions(+), 102 deletions(-)
+Merging devicetree/for-next (129b91fc32960 dt-bindings: arm: altera: Drop socfpga-sdram-edac.txt)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/robh/linux.git devicetree/for-next
+Auto-merging Documentation/devicetree/bindings/display/panel/panel-simple.yaml
+Auto-merging Documentation/devicetree/bindings/mmc/mmc-controller-common.yaml
+Auto-merging Documentation/devicetree/bindings/net/ethernet-controller.yaml
+Auto-merging Documentation/devicetree/bindings/submitting-patches.rst
+Auto-merging Documentation/devicetree/bindings/trivial-devices.yaml
+Auto-merging Documentation/devicetree/bindings/vendor-prefixes.yaml
+CONFLICT (content): Merge conflict in Documentation/devicetree/bindings/vendor-prefixes.yaml
+Auto-merging MAINTAINERS
+Resolved 'Documentation/devicetree/bindings/vendor-prefixes.yaml' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 6c2dd90de5ed3] Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/robh/linux.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/devicetree/bindings/.yamllint        |   2 +-
+ .../bindings/arm/altera/socfpga-sdram-edac.txt     |  15 --
+ .../devicetree/bindings/arm/arm,vexpress-juno.yaml |   7 +-
+ .../bindings/arm/cavium,thunder-88xx.yaml          |  19 ++
+ .../devicetree/bindings/arm/cavium-thunder.txt     |  10 -
+ .../devicetree/bindings/arm/cavium-thunder2.txt    |   8 -
+ Documentation/devicetree/bindings/arm/cpus.yaml    |  26 ++
+ .../devicetree/bindings/arm/marvell,berlin.yaml    |  45 ++++
+ .../devicetree/bindings/arm/marvell/98dx3236.txt   |  23 --
+ .../arm/marvell/ap80x-system-controller.txt        |  39 ---
+ .../bindings/arm/marvell/armada-370-xp.txt         |  24 --
+ .../devicetree/bindings/arm/marvell/armada-375.txt |   9 -
+ .../devicetree/bindings/arm/marvell/armada-39x.txt |  31 ---
+ .../arm/marvell/cp110-system-controller.txt        |  43 ----
+ .../devicetree/bindings/arm/marvell/kirkwood.txt   |  27 ---
+ .../arm/marvell/marvell,armada-370-xp.yaml         |  78 ++++++
+ .../bindings/arm/marvell/marvell,armada375.yaml    |  21 ++
+ .../bindings/arm/marvell/marvell,armada390.yaml    |  32 +++
+ .../bindings/arm/marvell/marvell,dove.txt          |   7 -
+ .../bindings/arm/marvell/marvell,dove.yaml         |  35 +++
+ .../bindings/arm/marvell/marvell,kirkwood.txt      | 105 --------
+ .../bindings/arm/marvell/marvell,kirkwood.yaml     | 266 +++++++++++++++++++++
+ .../bindings/arm/marvell/marvell,orion5x.txt       |  25 --
+ .../bindings/arm/marvell/marvell,orion5x.yaml      |  37 +++
+ .../bindings/arm/mediatek/mediatek,audsys.yaml     |  16 +-
+ Documentation/devicetree/bindings/arm/pmu.yaml     |   7 +
+ Documentation/devicetree/bindings/arm/syna.txt     |  89 -------
+ .../display/bridge/ingenic,jz4780-hdmi.yaml        |   3 +
+ .../bindings/display/bridge/ite,it6263.yaml        |   1 +
+ .../bindings/display/bridge/ite,it66121.yaml       |   5 +-
+ .../bindings/display/bridge/lontium,lt9611.yaml    |   5 +-
+ .../bridge/megachips,stdp2690-ge-b850v3-fw.yaml    | 111 +++++++++
+ .../bridge/megachips-stdpxxxx-ge-b850v3-fw.txt     |  91 -------
+ .../bindings/display/bridge/nxp,tda998x.yaml       |   5 +-
+ .../bindings/display/bridge/sil,sii9022.yaml       |   5 +-
+ .../bindings/display/bridge/ti,tdp158.yaml         |   1 +
+ .../bindings/display/connector/dp-connector.yaml   |  52 +++-
+ .../bindings/display/dsi-controller.yaml           |   2 +-
+ .../bindings/display/mediatek/mediatek,dpi.yaml    |   7 +
+ .../bindings/display/mediatek/mediatek,od.yaml     |  14 ++
+ .../bindings/display/mediatek/mediatek,ufoe.yaml   |  15 ++
+ .../bindings/display/panel/panel-simple.yaml       |   4 +
+ .../display/rockchip/rockchip,dw-mipi-dsi.yaml     |   2 +
+ .../bindings/display/samsung/samsung,fimd.yaml     |   1 -
+ .../devicetree/bindings/display/ti/ti,opa362.txt   |  38 ---
+ .../bindings/edac/altr,socfpga-ecc-manager.yaml    |   1 +
+ .../devicetree/bindings/edac/apm,xgene-edac.yaml   | 203 ++++++++++++++++
+ .../devicetree/bindings/edac/apm-xgene-edac.txt    | 112 ---------
+ .../bindings/edac/aspeed,ast2400-sdram-edac.yaml   |  48 ++++
+ .../devicetree/bindings/edac/aspeed-sdram-edac.txt |  28 ---
+ .../devicetree/bindings/example-schema.yaml        |   2 +-
+ .../bindings/fsi/aspeed,ast2400-cf-fsi-master.yaml |  81 +++++++
+ .../devicetree/bindings/fsi/fsi-master-ast-cf.txt  |  36 ---
+ .../devicetree/bindings/fsi/fsi-master-gpio.txt    |  28 ---
+ .../devicetree/bindings/fsi/fsi-master-gpio.yaml   |  63 +++++
+ .../devicetree/bindings/goldfish/pipe.txt          |   2 +-
+ Documentation/devicetree/bindings/gpio/gpio.txt    |  12 +-
+ .../devicetree/bindings/gpu/arm,mali-midgard.yaml  |   6 +-
+ .../bindings/gpu/aspeed,ast2400-gfx.yaml           |  63 +++++
+ .../devicetree/bindings/gpu/aspeed-gfx.txt         |  41 ----
+ .../devicetree/bindings/gpu/nvidia,gk20a.txt       | 115 ---------
+ .../devicetree/bindings/gpu/nvidia,gk20a.yaml      | 171 +++++++++++++
+ .../bindings/interrupt-controller/arm,gic.yaml     |   1 +
+ .../interrupt-controller/chrp,open-pic.yaml        |  17 +-
+ .../interrupt-controller/hisilicon,mbigen-v2.txt   |  84 -------
+ .../interrupt-controller/hisilicon,mbigen-v2.yaml  |  76 ++++++
+ .../interrupt-controller/marvell,cp110-icu.yaml    |   3 +
+ .../bindings/interrupt-controller/qcom,pdc.yaml    |   1 +
+ .../devicetree/bindings/iommu/mediatek,iommu.yaml  |   2 +-
+ Documentation/devicetree/bindings/leds/common.yaml |   2 +-
+ .../bindings/mailbox/brcm,iproc-flexrm-mbox.txt    |  59 -----
+ .../bindings/mailbox/brcm,iproc-flexrm-mbox.yaml   |  63 +++++
+ .../bindings/mailbox/brcm,iproc-pdc-mbox.txt       |  25 --
+ .../bindings/mailbox/brcm,iproc-pdc-mbox.yaml      |  66 +++++
+ .../mailbox/marvell,armada-3700-rwtm-mailbox.txt   |  16 --
+ .../mailbox/marvell,armada-3700-rwtm-mailbox.yaml  |  42 ++++
+ .../bindings/mailbox/mediatek,gce-mailbox.yaml     |  11 -
+ .../bindings/mailbox/rockchip,rk3368-mailbox.yaml  |  56 +++++
+ .../bindings/mailbox/rockchip-mailbox.txt          |  32 ---
+ .../bindings/media/mediatek,mt8173-vpu.yaml        |  74 ++++++
+ .../devicetree/bindings/media/mediatek-mdp.txt     |   3 +-
+ .../devicetree/bindings/media/mediatek-vpu.txt     |  31 ---
+ .../devicetree/bindings/mfd/aspeed-gfx.txt         |  17 --
+ .../devicetree/bindings/mfd/ti,lp87524-q1.yaml     |   2 +-
+ .../devicetree/bindings/mfd/ti,lp87561-q1.yaml     |   2 +-
+ .../devicetree/bindings/mfd/ti,lp87565-q1.yaml     |   2 +-
+ .../bindings/mmc/mmc-controller-common.yaml        |   4 +-
+ .../bindings/net/amlogic,meson-dwmac.yaml          |   2 +-
+ .../bindings/net/ethernet-controller.yaml          |   2 +-
+ .../devicetree/bindings/net/ethernet-phy.yaml      |   2 +-
+ .../devicetree/bindings/net/micrel-ksz90x1.txt     |   4 +-
+ Documentation/devicetree/bindings/net/micrel.txt   |   2 +-
+ .../devicetree/bindings/pci/brcm,iproc-pcie.yaml   |   1 +
+ .../bindings/pci/marvell,armada-3700-pcie.yaml     |   4 +
+ .../bindings/pci/marvell,kirkwood-pcie.yaml        |   3 +
+ .../bindings/pci/socionext,uniphier-pcie.yaml      |   4 +
+ .../devicetree/bindings/pci/ti,j721e-pci-host.yaml |   3 +
+ .../devicetree/bindings/perf/apm,xgene-pmu.yaml    | 142 +++++++++++
+ .../devicetree/bindings/perf/apm-xgene-pmu.txt     | 112 ---------
+ .../bindings/pinctrl/mediatek,mt65xx-pinctrl.yaml  |   2 +
+ .../bindings/pinctrl/mediatek,mt7622-pinctrl.yaml  |   8 +-
+ .../devicetree/bindings/powerpc/fsl/mpic.txt       | 231 ------------------
+ .../regulator/mediatek,mt6331-regulator.yaml       |  19 +-
+ .../regulator/mediatek,mt6332-regulator.yaml       |   7 +
+ .../devicetree/bindings/rng/SUNW,n2-rng.yaml       |  50 ++++
+ .../bindings/rng/sparc_sun_oracle_rng.txt          |  30 ---
+ .../bindings/siox/eckelmann,siox-gpio.txt          |  19 --
+ .../bindings/siox/eckelmann,siox-gpio.yaml         |  48 ++++
+ .../devicetree/bindings/soc/fsl/fsl,vf610-src.yaml |  47 ++++
+ .../bindings/soc/mediatek/mediatek,pwrap.yaml      |  15 ++
+ .../devicetree/bindings/submitting-patches.rst     |   2 +-
+ .../devicetree/bindings/thermal/armada-thermal.txt |  42 ----
+ .../thermal/marvell,armada-ap806-thermal.yaml      |  46 ++++
+ .../thermal/marvell,armada370-thermal.yaml         |  37 +++
+ .../devicetree/bindings/timer/mediatek,timer.yaml  |   1 +
+ .../devicetree/bindings/trivial-devices.yaml       |   2 +
+ .../devicetree/bindings/vendor-prefixes.yaml       |  55 ++++-
+ .../bindings/watchdog/armada-37xx-wdt.txt          |  23 --
+ .../bindings/watchdog/marvell,armada-3700-wdt.yaml |  41 ++++
+ .../bindings/watchdog/moxa,moxart-watchdog.txt     |  15 --
+ .../bindings/watchdog/nuvoton,npcm-wdt.txt         |  30 ---
+ .../bindings/watchdog/nuvoton,npcm750-wdt.yaml     |  60 +++++
+ .../devicetree/bindings/writing-bindings.rst       |   9 +
+ .../devicetree/bindings/writing-schema.rst         |  10 +-
+ Documentation/devicetree/of_unittest.rst           |   4 +-
+ Documentation/devicetree/overlay-notes.rst         |   6 +-
+ Documentation/devicetree/usage-model.rst           |   6 +-
+ MAINTAINERS                                        |  19 +-
+ drivers/irqchip/irq-gic-v3-its-fsl-mc-msi.c        |   2 +-
+ drivers/of/irq.c                                   |  25 +-
+ drivers/pci/msi/irqdomain.c                        |   2 +-
+ include/linux/of.h                                 |   7 +
+ include/linux/of_irq.h                             |   6 -
+ scripts/Makefile.dtbs                              |   1 +
+ scripts/dtc/checks.c                               |  23 +-
+ scripts/dtc/data.c                                 |  47 +++-
+ scripts/dtc/dt_to_config                           |   8 +-
+ scripts/dtc/dtc-lexer.l                            |  15 ++
+ scripts/dtc/dtc.c                                  |   6 +-
+ scripts/dtc/dtc.h                                  |   5 +-
+ scripts/dtc/fdtoverlay.c                           |   8 +
+ scripts/dtc/flattree.c                             |   2 +-
+ scripts/dtc/libfdt/fdt.c                           |   8 +-
+ scripts/dtc/libfdt/fdt.h                           |   4 +-
+ scripts/dtc/libfdt/fdt_overlay.c                   |   8 +-
+ scripts/dtc/libfdt/fdt_rw.c                        |  41 ++--
+ scripts/dtc/libfdt/libfdt.h                        | 181 +++++++++++---
+ scripts/dtc/libfdt/libfdt_internal.h               |  14 +-
+ scripts/dtc/livetree.c                             |  25 +-
+ scripts/dtc/srcpos.c                               |  17 +-
+ scripts/dtc/srcpos.h                               |   1 +
+ scripts/dtc/treesource.c                           |  52 ++--
+ scripts/dtc/util.c                                 |  16 ++
+ scripts/dtc/util.h                                 |   5 +
+ scripts/dtc/version_gen.h                          |   2 +-
+ 155 files changed, 2880 insertions(+), 1927 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/arm/altera/socfpga-sdram-edac.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/cavium,thunder-88xx.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/cavium-thunder.txt
+ delete mode 100644 Documentation/devicetree/bindings/arm/cavium-thunder2.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell,berlin.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/98dx3236.txt
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/armada-370-xp.txt
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/armada-375.txt
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/armada-39x.txt
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/kirkwood.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,armada-370-xp.yaml
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,armada375.yaml
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,armada390.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,dove.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,dove.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,kirkwood.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,kirkwood.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,orion5x.txt
+ create mode 100644 Documentation/devicetree/bindings/arm/marvell/marvell,orion5x.yaml
+ delete mode 100644 Documentation/devicetree/bindings/arm/syna.txt
+ create mode 100644 Documentation/devicetree/bindings/display/bridge/megachips,stdp2690-ge-b850v3-fw.yaml
+ delete mode 100644 Documentation/devicetree/bindings/display/bridge/megachips-stdpxxxx-ge-b850v3-fw.txt
+ delete mode 100644 Documentation/devicetree/bindings/display/ti/ti,opa362.txt
+ create mode 100644 Documentation/devicetree/bindings/edac/apm,xgene-edac.yaml
+ delete mode 100644 Documentation/devicetree/bindings/edac/apm-xgene-edac.txt
+ create mode 100644 Documentation/devicetree/bindings/edac/aspeed,ast2400-sdram-edac.yaml
+ delete mode 100644 Documentation/devicetree/bindings/edac/aspeed-sdram-edac.txt
+ create mode 100644 Documentation/devicetree/bindings/fsi/aspeed,ast2400-cf-fsi-master.yaml
+ delete mode 100644 Documentation/devicetree/bindings/fsi/fsi-master-ast-cf.txt
+ delete mode 100644 Documentation/devicetree/bindings/fsi/fsi-master-gpio.txt
+ create mode 100644 Documentation/devicetree/bindings/fsi/fsi-master-gpio.yaml
+ create mode 100644 Documentation/devicetree/bindings/gpu/aspeed,ast2400-gfx.yaml
+ delete mode 100644 Documentation/devicetree/bindings/gpu/aspeed-gfx.txt
+ delete mode 100644 Documentation/devicetree/bindings/gpu/nvidia,gk20a.txt
+ create mode 100644 Documentation/devicetree/bindings/gpu/nvidia,gk20a.yaml
+ delete mode 100644 Documentation/devicetree/bindings/interrupt-controller/hisilicon,mbigen-v2.txt
+ create mode 100644 Documentation/devicetree/bindings/interrupt-controller/hisilicon,mbigen-v2.yaml
+ delete mode 100644 Documentation/devicetree/bindings/mailbox/brcm,iproc-flexrm-mbox.txt
+ create mode 100644 Documentation/devicetree/bindings/mailbox/brcm,iproc-flexrm-mbox.yaml
+ delete mode 100644 Documentation/devicetree/bindings/mailbox/brcm,iproc-pdc-mbox.txt
+ create mode 100644 Documentation/devicetree/bindings/mailbox/brcm,iproc-pdc-mbox.yaml
+ delete mode 100644 Documentation/devicetree/bindings/mailbox/marvell,armada-3700-rwtm-mailbox.txt
+ create mode 100644 Documentation/devicetree/bindings/mailbox/marvell,armada-3700-rwtm-mailbox.yaml
+ create mode 100644 Documentation/devicetree/bindings/mailbox/rockchip,rk3368-mailbox.yaml
+ delete mode 100644 Documentation/devicetree/bindings/mailbox/rockchip-mailbox.txt
+ create mode 100644 Documentation/devicetree/bindings/media/mediatek,mt8173-vpu.yaml
+ delete mode 100644 Documentation/devicetree/bindings/media/mediatek-vpu.txt
+ delete mode 100644 Documentation/devicetree/bindings/mfd/aspeed-gfx.txt
+ create mode 100644 Documentation/devicetree/bindings/perf/apm,xgene-pmu.yaml
+ delete mode 100644 Documentation/devicetree/bindings/perf/apm-xgene-pmu.txt
+ delete mode 100644 Documentation/devicetree/bindings/powerpc/fsl/mpic.txt
+ create mode 100644 Documentation/devicetree/bindings/rng/SUNW,n2-rng.yaml
+ delete mode 100644 Documentation/devicetree/bindings/rng/sparc_sun_oracle_rng.txt
+ delete mode 100644 Documentation/devicetree/bindings/siox/eckelmann,siox-gpio.txt
+ create mode 100644 Documentation/devicetree/bindings/siox/eckelmann,siox-gpio.yaml
+ create mode 100644 Documentation/devicetree/bindings/soc/fsl/fsl,vf610-src.yaml
+ delete mode 100644 Documentation/devicetree/bindings/thermal/armada-thermal.txt
+ create mode 100644 Documentation/devicetree/bindings/thermal/marvell,armada-ap806-thermal.yaml
+ create mode 100644 Documentation/devicetree/bindings/thermal/marvell,armada370-thermal.yaml
+ delete mode 100644 Documentation/devicetree/bindings/watchdog/armada-37xx-wdt.txt
+ create mode 100644 Documentation/devicetree/bindings/watchdog/marvell,armada-3700-wdt.yaml
+ delete mode 100644 Documentation/devicetree/bindings/watchdog/moxa,moxart-watchdog.txt
+ delete mode 100644 Documentation/devicetree/bindings/watchdog/nuvoton,npcm-wdt.txt
+ create mode 100644 Documentation/devicetree/bindings/watchdog/nuvoton,npcm750-wdt.yaml
+Merging dt-krzk/for-next (7ee0f223cabe9 arm64: dts: toshiba: tmpv7708: Add default GIC address cells)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-dt.git dt-krzk/for-next
+Already up to date.
+Merging mailbox/for-next (5378bdf6a611a mailbox/pcc: support mailbox management of the shared buffer)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/jassibrar/mailbox.git mailbox/for-next
+Already up to date.
+Merging spi/for-next (7e2212429ec9a Merge remote-tracking branch 'spi/for-6.18' into spi-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/broonie/spi.git spi/for-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/spi/Kconfig
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/spi/amlogic,a4-spifc.yaml  |   82 ++
+ .../bindings/spi/atmel,at91rm9200-spi.yaml         |   11 +-
+ .../devicetree/bindings/spi/atmel,quadspi.yaml     |    3 +
+ .../devicetree/bindings/spi/samsung,spi.yaml       |    1 -
+ MAINTAINERS                                        |   25 +-
+ drivers/spi/Kconfig                                |   24 +-
+ drivers/spi/Makefile                               |    2 +
+ drivers/spi/atmel-quadspi.c                        |  134 ++-
+ drivers/spi/spi-altera-platform.c                  |    1 -
+ drivers/spi/spi-amd-pci.c                          |    5 +-
+ drivers/spi/spi-amd.c                              |    2 +-
+ drivers/spi/spi-amlogic-spifc-a4.c                 | 1222 ++++++++++++++++++++
+ drivers/spi/spi-amlogic-spisg.c                    |    4 +-
+ drivers/spi/spi-atmel.c                            |   78 +-
+ drivers/spi/spi-axi-spi-engine.c                   |   17 +-
+ drivers/spi/spi-bcm2835.c                          |    2 +-
+ drivers/spi/spi-cadence-quadspi.c                  |   36 +-
+ drivers/spi/spi-fsl-dspi.c                         |  230 ++--
+ drivers/spi/spi-fsl-lpspi.c                        |    8 +-
+ drivers/spi/spi-ljca.c                             |    2 +-
+ drivers/spi/spi-loopback-test.c                    |   12 +-
+ drivers/spi/spi-microchip-core-qspi.c              |    3 +-
+ drivers/spi/spi-microchip-core.c                   |    3 +-
+ drivers/spi/spi-mt65xx.c                           |   30 +-
+ drivers/spi/spi-mtk-snfi.c                         |    1 -
+ drivers/spi/spi-mxs.c                              |    2 +-
+ drivers/spi/spi-npcm-fiu.c                         |    6 +-
+ drivers/spi/spi-nxp-fspi.c                         |  117 +-
+ .../spi/spi-offload-trigger-adi-util-sigma-delta.c |    5 +-
+ drivers/spi/spi-pl022.c                            |   13 +-
+ drivers/spi/spi-pxa2xx.c                           |    2 +-
+ drivers/spi/spi-qpic-snand.c                       |   58 +-
+ drivers/spi/spi-rb4xx.c                            |   36 +-
+ drivers/spi/spi-rpc-if.c                           |   12 +-
+ drivers/spi/spi-s3c64xx.c                          |   19 +-
+ drivers/spi/spi-sunplus-sp7021.c                   |    6 +-
+ drivers/spi/spi-virtio.c                           |  431 +++++++
+ drivers/spi/spi.c                                  |   85 +-
+ include/linux/adi-axi-common.h                     |   21 +
+ include/linux/spi/spi.h                            |   16 +-
+ include/uapi/linux/virtio_ids.h                    |    1 +
+ include/uapi/linux/virtio_spi.h                    |  181 +++
+ 42 files changed, 2582 insertions(+), 367 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/spi/amlogic,a4-spifc.yaml
+ create mode 100644 drivers/spi/spi-amlogic-spifc-a4.c
+ create mode 100644 drivers/spi/spi-virtio.c
+ create mode 100644 include/uapi/linux/virtio_spi.h
+Merging tip/master (707007037fc6b Merge branch into tip/master: 'x86/tdx')
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git tip/master
+Auto-merging Documentation/admin-guide/kernel-parameters.txt
+Auto-merging Documentation/devicetree/bindings/mfd/aspeed,ast2x00-scu.yaml
+Auto-merging Documentation/devicetree/bindings/timer/mediatek,timer.yaml
+Auto-merging Documentation/filesystems/resctrl.rst
+Auto-merging MAINTAINERS
+Auto-merging arch/Kconfig
+Auto-merging arch/arm/Kconfig
+Auto-merging arch/arm64/Kconfig
+Auto-merging arch/arm64/kernel/vdso32/Makefile
+Auto-merging arch/loongarch/Kconfig
+Auto-merging arch/mips/Kconfig
+Auto-merging arch/powerpc/Kconfig
+Auto-merging arch/powerpc/include/asm/bug.h
+Auto-merging arch/riscv/Kconfig
+CONFLICT (content): Merge conflict in arch/riscv/Kconfig
+Auto-merging arch/riscv/boot/dts/sophgo/sg2042.dtsi
+Auto-merging arch/riscv/include/asm/thread_info.h
+Auto-merging arch/s390/Kconfig
+Auto-merging arch/x86/Kconfig
+Auto-merging arch/x86/crypto/Kconfig
+Auto-merging arch/x86/crypto/Makefile
+Auto-merging arch/x86/include/asm/shstk.h
+Auto-merging arch/x86/kernel/process.c
+Auto-merging arch/x86/kernel/shstk.c
+Auto-merging arch/x86/net/bpf_jit_comp.c
+Auto-merging drivers/crypto/ccp/sev-dev.c
+CONFLICT (content): Merge conflict in drivers/crypto/ccp/sev-dev.c
+Auto-merging drivers/crypto/ccp/sev-dev.h
+Auto-merging drivers/of/irq.c
+Auto-merging drivers/pci/msi/irqdomain.c
+Auto-merging include/linux/compiler_types.h
+Auto-merging include/linux/msi.h
+Auto-merging include/linux/rcupdate.h
+Auto-merging include/linux/rseq.h
+Auto-merging include/linux/uprobes.h
+Auto-merging init/Kconfig
+Auto-merging kernel/bpf/stackmap.c
+Auto-merging kernel/bpf/verifier.c
+Auto-merging kernel/events/core.c
+Auto-merging kernel/events/uprobes.c
+CONFLICT (content): Merge conflict in kernel/events/uprobes.c
+Auto-merging kernel/fork.c
+Auto-merging kernel/panic.c
+Auto-merging kernel/sched/core.c
+Auto-merging kernel/sched/fair.c
+Auto-merging kernel/sched/sched.h
+Auto-merging lib/Kconfig.debug
+Auto-merging rust/helpers/helpers.c
+Auto-merging rust/kernel/block/mq/operations.rs
+CONFLICT (content): Merge conflict in rust/kernel/block/mq/operations.rs
+Auto-merging rust/kernel/block/mq/request.rs
+Auto-merging tools/objtool/check.c
+Auto-merging tools/power/x86/turbostat/turbostat.c
+Auto-merging tools/testing/selftests/bpf/prog_tests/usdt.c
+CONFLICT (content): Merge conflict in tools/testing/selftests/bpf/prog_tests/usdt.c
+Auto-merging tools/testing/selftests/bpf/test_kmods/bpf_testmod.c
+Auto-merging tools/testing/selftests/kselftest.h
+Resolved 'arch/riscv/Kconfig' using previous resolution.
+Resolved 'drivers/crypto/ccp/sev-dev.c' using previous resolution.
+Resolved 'kernel/events/uprobes.c' using previous resolution.
+Resolved 'rust/kernel/block/mq/operations.rs' using previous resolution.
+Resolved 'tools/testing/selftests/bpf/prog_tests/usdt.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 10b4cdffb2942] Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git
+$ git diff -M --stat --summary HEAD^..
+ .../admin-guide/hw-vuln/attack_vector_controls.rst |    1 +
+ Documentation/admin-guide/kernel-parameters.txt    |   37 +-
+ Documentation/arch/x86/tdx.rst                     |   14 +-
+ Documentation/arch/x86/topology.rst                |  191 ++++
+ .../aspeed,ast2500-scu-ic.yaml                     |    6 +-
+ .../devicetree/bindings/timer/faraday,fttmr010.txt |   38 -
+ .../bindings/timer/faraday,fttmr010.yaml           |   89 ++
+ .../devicetree/bindings/timer/fsl,ftm-timer.yaml   |    7 +-
+ .../devicetree/bindings/timer/fsl,timrot.yaml      |   48 +
+ .../devicetree/bindings/timer/fsl,vf610-pit.yaml   |    9 +-
+ .../devicetree/bindings/timer/mediatek,timer.yaml  |    2 +
+ .../bindings/timer/samsung,exynos4210-mct.yaml     |    2 +
+ Documentation/filesystems/resctrl.rst              |  325 ++++++
+ Kbuild                                             |   13 +-
+ MAINTAINERS                                        |   19 +-
+ arch/Kconfig                                       |   44 +-
+ arch/alpha/kernel/asm-offsets.c                    |    1 +
+ arch/arc/kernel/asm-offsets.c                      |    1 +
+ arch/arm/Kconfig                                   |   18 +-
+ arch/arm/include/asm/vdso/vsyscall.h               |    2 -
+ arch/arm/kernel/asm-offsets.c                      |    2 +
+ arch/arm/kernel/vdso.c                             |   10 +-
+ arch/arm/mm/Kconfig                                |    2 -
+ arch/arm/probes/uprobes/core.c                     |    2 +-
+ arch/arm64/Kconfig                                 |   29 +-
+ arch/arm64/include/asm/bug.h                       |    2 +-
+ arch/arm64/include/asm/vdso/compat_barrier.h       |    7 +-
+ arch/arm64/include/asm/vdso/compat_gettimeofday.h  |    6 +-
+ arch/arm64/include/asm/vdso/gettimeofday.h         |    8 +
+ arch/arm64/kernel/asm-offsets.c                    |    1 +
+ arch/arm64/kernel/vdso32/Makefile                  |    1 -
+ arch/csky/kernel/asm-offsets.c                     |    1 +
+ arch/hexagon/kernel/asm-offsets.c                  |    1 +
+ arch/loongarch/Kconfig                             |   22 +-
+ arch/loongarch/include/asm/bug.h                   |   27 +-
+ arch/loongarch/include/asm/thread_info.h           |   76 +-
+ arch/loongarch/kernel/asm-offsets.c                |    2 +
+ arch/loongarch/kernel/time.c                       |    2 -
+ arch/m68k/kernel/asm-offsets.c                     |    1 +
+ arch/microblaze/kernel/asm-offsets.c               |    1 +
+ arch/mips/Kconfig                                  |   17 +-
+ arch/mips/kernel/asm-offsets.c                     |    2 +
+ arch/nios2/kernel/asm-offsets.c                    |    1 +
+ arch/openrisc/kernel/asm-offsets.c                 |    1 +
+ arch/parisc/Kconfig                                |    9 +-
+ arch/parisc/include/asm/bug.h                      |    6 +-
+ arch/parisc/kernel/asm-offsets.c                   |    1 +
+ arch/powerpc/Kconfig                               |   13 +-
+ arch/powerpc/include/asm/bug.h                     |   12 +-
+ arch/powerpc/include/asm/topology.h                |    2 +
+ arch/powerpc/kernel/asm-offsets.c                  |    1 +
+ arch/powerpc/kernel/smp.c                          |   27 +-
+ arch/riscv/Kconfig                                 |   22 +-
+ arch/riscv/boot/dts/sophgo/sg2042.dtsi             |    2 +-
+ arch/riscv/boot/dts/sophgo/sg2044.dtsi             |    2 +-
+ arch/riscv/include/asm/bug.h                       |   10 +-
+ arch/riscv/include/asm/thread_info.h               |   29 +-
+ arch/riscv/kernel/asm-offsets.c                    |    1 +
+ arch/s390/Kconfig                                  |   11 +-
+ arch/s390/include/asm/bug.h                        |   96 +-
+ arch/s390/include/asm/thread_info.h                |   50 +-
+ arch/s390/kernel/asm-offsets.c                     |    1 +
+ arch/s390/kernel/topology.c                        |   20 +-
+ arch/sh/include/asm/bug.h                          |    4 +-
+ arch/sh/kernel/asm-offsets.c                       |    1 +
+ arch/sparc/Kconfig                                 |   20 +-
+ arch/sparc/kernel/asm-offsets.c                    |    1 +
+ arch/um/kernel/asm-offsets.c                       |    2 +
+ arch/x86/Kbuild                                    |    2 +
+ arch/x86/Kconfig                                   |   82 +-
+ arch/x86/Kconfig.assembler                         |   20 -
+ arch/x86/Makefile                                  |   26 +-
+ arch/x86/boot/bitops.h                             |    2 +-
+ arch/x86/boot/boot.h                               |    8 +-
+ arch/x86/boot/compressed/Makefile                  |    2 +-
+ arch/x86/boot/compressed/misc.c                    |    2 +
+ arch/x86/boot/compressed/sev-handle-vc.c           |    3 +
+ arch/x86/boot/compressed/sev.c                     |  132 +--
+ arch/x86/boot/cpuflags.c                           |   13 -
+ arch/x86/boot/startup/Makefile                     |   22 +
+ arch/x86/boot/startup/exports.h                    |   14 +
+ arch/x86/boot/startup/gdt_idt.c                    |    4 +-
+ arch/x86/boot/startup/map_kernel.c                 |    4 +-
+ arch/x86/boot/startup/sev-shared.c                 |  327 ++----
+ arch/x86/boot/startup/sev-startup.c                |  210 +---
+ arch/x86/boot/startup/sme.c                        |   30 +-
+ arch/x86/boot/string.c                             |    4 +-
+ arch/x86/coco/core.c                               |    3 +
+ arch/x86/coco/sev/Makefile                         |    8 +-
+ arch/x86/coco/sev/core.c                           |  276 +++++-
+ arch/x86/coco/sev/{sev-nmi.c => noinstr.c}         |   74 ++
+ arch/x86/coco/sev/vc-handle.c                      |   22 +-
+ arch/x86/coco/sev/vc-shared.c                      |  143 ++-
+ arch/x86/crypto/Kconfig                            |    2 +-
+ arch/x86/crypto/Makefile                           |    6 +-
+ arch/x86/crypto/aes-ctr-avx-x86_64.S               |    2 -
+ arch/x86/crypto/aes-xts-avx-x86_64.S               |    2 -
+ arch/x86/crypto/aesni-intel_glue.c                 |   22 +-
+ arch/x86/crypto/aria-aesni-avx-asm_64.S            |   10 -
+ arch/x86/crypto/aria-aesni-avx2-asm_64.S           |   10 +-
+ arch/x86/crypto/aria_aesni_avx2_glue.c             |    4 +-
+ arch/x86/crypto/aria_aesni_avx_glue.c              |    4 +-
+ arch/x86/entry/calling.h                           |   11 +-
+ arch/x86/entry/entry_64_fred.S                     |   40 +-
+ arch/x86/entry/syscalls/syscall_64.tbl             |    1 +
+ arch/x86/entry/vsyscall/vsyscall_64.c              |   17 +-
+ arch/x86/events/core.c                             |   16 +-
+ arch/x86/events/intel/bts.c                        |    2 +-
+ arch/x86/events/intel/core.c                       |   21 +-
+ arch/x86/hyperv/hv_init.c                          |   69 +-
+ arch/x86/hyperv/ivm.c                              |   15 +
+ arch/x86/include/asm/apic.h                        |   11 +
+ arch/x86/include/asm/apicdef.h                     |    2 +
+ arch/x86/include/asm/archrandom.h                  |    6 +-
+ arch/x86/include/asm/asm.h                         |   12 -
+ arch/x86/include/asm/bitops.h                      |   18 +-
+ arch/x86/include/asm/boot.h                        |    2 +
+ arch/x86/include/asm/bug.h                         |   39 +-
+ arch/x86/include/asm/cfi.h                         |   14 +-
+ arch/x86/include/asm/cmpxchg.h                     |   12 +-
+ arch/x86/include/asm/cmpxchg_32.h                  |    6 +-
+ arch/x86/include/asm/cmpxchg_64.h                  |    3 +-
+ arch/x86/include/asm/cpufeatures.h                 |    1 +
+ arch/x86/include/asm/hypervisor.h                  |    2 +
+ arch/x86/include/asm/ibt.h                         |   10 +-
+ arch/x86/include/asm/idtentry.h                    |    9 +-
+ arch/x86/include/asm/inat.h                        |   15 +
+ arch/x86/include/asm/init.h                        |    6 -
+ arch/x86/include/asm/insn.h                        |   51 +-
+ arch/x86/include/asm/intel-family.h                |    7 +-
+ arch/x86/include/asm/kexec.h                       |   12 +-
+ arch/x86/include/asm/mce.h                         |   11 +-
+ arch/x86/include/asm/mshyperv.h                    |  137 +--
+ arch/x86/include/asm/msr-index.h                   |   30 +-
+ arch/x86/include/asm/mtrr.h                        |   15 +-
+ arch/x86/include/asm/mwait.h                       |    8 +-
+ arch/x86/include/asm/nospec-branch.h               |    1 +
+ arch/x86/include/asm/percpu.h                      |   12 +-
+ arch/x86/include/asm/perf_event.h                  |    8 +-
+ arch/x86/include/asm/processor.h                   |    2 +
+ arch/x86/include/asm/resctrl.h                     |   16 -
+ arch/x86/include/asm/rmwcc.h                       |   26 +-
+ arch/x86/include/asm/segment.h                     |    8 +-
+ arch/x86/include/asm/setup.h                       |    1 +
+ arch/x86/include/asm/sev-common.h                  |    1 +
+ arch/x86/include/asm/sev-internal.h                |   28 +-
+ arch/x86/include/asm/sev.h                         |   44 +-
+ arch/x86/include/asm/shstk.h                       |    4 +
+ arch/x86/include/asm/signal.h                      |    3 +-
+ arch/x86/include/asm/special_insns.h               |   10 +-
+ arch/x86/include/asm/tdx.h                         |   35 +-
+ arch/x86/include/asm/text-patching.h               |   20 +-
+ arch/x86/include/asm/thread_info.h                 |   74 +-
+ arch/x86/include/asm/uaccess.h                     |    7 +-
+ arch/x86/include/asm/uprobes.h                     |    7 +
+ arch/x86/include/uapi/asm/svm.h                    |    4 +
+ arch/x86/kernel/alternative.c                      |  292 +++---
+ arch/x86/kernel/apic/Makefile                      |    1 +
+ arch/x86/kernel/apic/apic.c                        |   87 +-
+ arch/x86/kernel/apic/vector.c                      |   28 +-
+ arch/x86/kernel/apic/x2apic_savic.c                |  428 ++++++++
+ arch/x86/kernel/asm-offsets.c                      |    1 +
+ arch/x86/kernel/cfi.c                              |    2 +-
+ arch/x86/kernel/cpu/Makefile                       |    1 +
+ arch/x86/kernel/cpu/amd.c                          |   17 +
+ arch/x86/kernel/cpu/bhyve.c                        |   66 ++
+ arch/x86/kernel/cpu/bugs.c                         |  424 ++++----
+ arch/x86/kernel/cpu/cacheinfo.c                    |   48 +-
+ arch/x86/kernel/cpu/common.c                       |    1 +
+ arch/x86/kernel/cpu/hypervisor.c                   |    3 +
+ arch/x86/kernel/cpu/mce/amd.c                      |  163 ++-
+ arch/x86/kernel/cpu/mce/core.c                     |  319 +++---
+ arch/x86/kernel/cpu/mce/intel.c                    |   18 +
+ arch/x86/kernel/cpu/mce/internal.h                 |    9 +
+ arch/x86/kernel/cpu/microcode/amd.c                |   73 +-
+ arch/x86/kernel/cpu/microcode/core.c               |   47 +-
+ arch/x86/kernel/cpu/microcode/intel-ucode-defs.h   |   86 +-
+ arch/x86/kernel/cpu/microcode/internal.h           |    9 +
+ arch/x86/kernel/cpu/mshyperv.c                     |   19 +-
+ arch/x86/kernel/cpu/mtrr/cleanup.c                 |   15 +-
+ arch/x86/kernel/cpu/mtrr/mtrr.c                    |   15 +-
+ arch/x86/kernel/cpu/resctrl/core.c                 |   79 +-
+ arch/x86/kernel/cpu/resctrl/internal.h             |   56 +-
+ arch/x86/kernel/cpu/resctrl/monitor.c              |  254 ++++-
+ arch/x86/kernel/cpu/scattered.c                    |    1 +
+ arch/x86/kernel/cpu/sgx/encls.h                    |    6 +-
+ arch/x86/kernel/cpu/topology_amd.c                 |   26 +-
+ arch/x86/kernel/head64.c                           |    5 +-
+ arch/x86/kernel/head_32.S                          |    5 +-
+ arch/x86/kernel/head_64.S                          |   10 +-
+ arch/x86/kernel/irqinit.c                          |    6 +-
+ arch/x86/kernel/machine_kexec_64.c                 |   48 +-
+ arch/x86/kernel/process.c                          |   24 +-
+ arch/x86/kernel/relocate_kernel_64.S               |   36 +-
+ arch/x86/kernel/shstk.c                            |   40 +
+ arch/x86/kernel/smpboot.c                          |    8 +-
+ arch/x86/kernel/traps.c                            |    8 +-
+ arch/x86/kernel/umip.c                             |   15 +-
+ arch/x86/kernel/uprobes.c                          |  635 +++++++++++-
+ arch/x86/kernel/vmlinux.lds.S                      |    9 +-
+ arch/x86/kvm/Kconfig                               |    1 +
+ arch/x86/kvm/emulate.c                             |  506 ++++------
+ arch/x86/kvm/pmu.h                                 |    2 +-
+ arch/x86/kvm/vmx/tdx.c                             |   44 +-
+ arch/x86/kvm/vmx/vmenter.S                         |    4 +
+ arch/x86/kvm/vmx/vmx.c                             |    8 +-
+ arch/x86/lib/bhi.S                                 |   58 +-
+ arch/x86/lib/inat.c                                |   13 +
+ arch/x86/lib/insn.c                                |   35 +-
+ arch/x86/lib/retpoline.S                           |   75 +-
+ arch/x86/lib/x86-opcode-map.txt                    |  111 ++-
+ arch/x86/mm/mem_encrypt_amd.c                      |    6 -
+ arch/x86/mm/mem_encrypt_boot.S                     |    6 +-
+ arch/x86/mm/pat/set_memory.c                       |   20 +-
+ arch/x86/net/bpf_jit_comp.c                        |    6 +-
+ arch/x86/platform/efi/efi_stub_64.S                |    4 +
+ arch/x86/platform/pvh/head.S                       |    2 +-
+ arch/x86/tools/gen-insn-attr-x86.awk               |   44 +
+ arch/x86/tools/relocs.c                            |    8 +-
+ arch/x86/virt/svm/sev.c                            |    7 +-
+ arch/x86/virt/vmx/tdx/tdx.c                        |   80 +-
+ arch/xtensa/kernel/asm-offsets.c                   |    1 +
+ drivers/acpi/arm64/gtdt.c                          |   29 +-
+ drivers/clocksource/Kconfig                        |   13 +-
+ drivers/clocksource/Makefile                       |    3 +-
+ drivers/clocksource/arm_arch_timer.c               |  686 ++-----------
+ drivers/clocksource/arm_arch_timer_mmio.c          |  440 +++++++++
+ drivers/clocksource/arm_global_timer.c             |   44 +-
+ drivers/clocksource/clps711x-timer.c               |   23 +-
+ drivers/clocksource/ingenic-sysost.c               |   27 +-
+ drivers/clocksource/scx200_hrt.c                   |    1 +
+ drivers/clocksource/sh_cmt.c                       |   92 +-
+ drivers/clocksource/timer-cs5535.c                 |    1 +
+ drivers/clocksource/timer-econet-en751221.c        |    2 +-
+ drivers/clocksource/timer-nxp-pit.c                |  382 +++++++
+ drivers/clocksource/timer-nxp-stm.c                |    2 +
+ drivers/clocksource/timer-rtl-otto.c               |   42 +-
+ drivers/clocksource/timer-stm32-lp.c               |    1 +
+ drivers/clocksource/timer-sun5i.c                  |    2 +
+ drivers/clocksource/timer-tegra186.c               |   38 +-
+ drivers/clocksource/timer-ti-dm.c                  |  119 ++-
+ drivers/clocksource/timer-vf-pit.c                 |  194 ----
+ drivers/crypto/ccp/Makefile                        |    3 +-
+ drivers/crypto/ccp/psp-dev.c                       |   20 +
+ drivers/crypto/ccp/psp-dev.h                       |    8 +-
+ drivers/crypto/ccp/sev-dev.c                       |  182 ++++
+ drivers/crypto/ccp/sev-dev.h                       |    3 +
+ drivers/crypto/ccp/sfs.c                           |  311 ++++++
+ drivers/crypto/ccp/sfs.h                           |   47 +
+ drivers/firmware/efi/libstub/x86-stub.c            |    4 +-
+ drivers/irqchip/irq-aspeed-scu-ic.c                |  266 +++--
+ drivers/irqchip/irq-gic-v2m.c                      |   13 +-
+ drivers/irqchip/irq-gic-v3.c                       |    3 +-
+ drivers/irqchip/irq-gic-v5-irs.c                   |    2 +-
+ drivers/irqchip/irq-gic-v5-its.c                   |   26 +-
+ drivers/irqchip/irq-loongson-eiointc.c             |  105 +-
+ drivers/irqchip/irq-loongson-pch-lpc.c             |    9 +-
+ drivers/irqchip/irq-msi-lib.c                      |   14 +
+ drivers/irqchip/irq-nvic.c                         |    3 +-
+ drivers/irqchip/irq-renesas-rza1.c                 |    3 +-
+ drivers/irqchip/irq-renesas-rzg2l.c                |    2 +-
+ drivers/irqchip/irq-sg2042-msi.c                   |   26 +-
+ drivers/irqchip/irq-sifive-plic.c                  |   10 +-
+ drivers/media/rc/pwm-ir-tx.c                       |    5 +-
+ drivers/misc/lkdtm/perms.c                         |    5 +
+ drivers/of/irq.c                                   |    1 +
+ drivers/pci/msi/irqdomain.c                        |   53 +-
+ .../x86/intel/speed_select_if/isst_if_common.c     |    2 +-
+ drivers/platform/x86/intel/tpmi_power_domains.c    |    2 +-
+ fs/resctrl/ctrlmondata.c                           |   26 +-
+ fs/resctrl/internal.h                              |   58 +-
+ fs/resctrl/monitor.c                               | 1012 +++++++++++++++++--
+ fs/resctrl/rdtgroup.c                              |  259 ++++-
+ include/asm-generic/bug.h                          |   13 +-
+ include/asm-generic/thread_info_tif.h              |   48 +
+ include/asm-generic/vdso/vsyscall.h                |    4 -
+ include/clocksource/arm_arch_timer.h               |    5 -
+ .../interrupt-controller/aspeed-scu-ic.h           |   14 +
+ include/linux/cc_platform.h                        |    8 +
+ include/linux/compiler-clang.h                     |    5 -
+ include/linux/compiler-gcc.h                       |    4 -
+ include/linux/compiler_types.h                     |    4 +-
+ include/linux/hrtimer.h                            |   14 +-
+ include/linux/hrtimer_defs.h                       |    2 -
+ include/linux/init.h                               |    8 -
+ include/linux/irq.h                                |    6 +-
+ include/linux/jiffies.h                            |    2 +-
+ include/linux/msi.h                                |    2 +
+ include/linux/objtool.h                            |   10 +
+ include/linux/objtool_types.h                      |    1 +
+ include/linux/perf_event.h                         |    4 +-
+ include/linux/platform_data/dmtimer-omap.h         |    4 +
+ include/linux/preempt.h                            |   11 +-
+ include/linux/psp-platform-access.h                |    2 +
+ include/linux/rcupdate.h                           |    2 +-
+ include/linux/resctrl.h                            |  148 ++-
+ include/linux/resctrl_types.h                      |   18 +-
+ include/linux/rseq.h                               |   11 +-
+ include/linux/sched.h                              |  118 +++
+ include/linux/sched/topology.h                     |   29 +-
+ include/linux/syscalls.h                           |    2 +
+ include/linux/topology.h                           |    2 +-
+ include/linux/uprobes.h                            |   20 +-
+ include/uapi/linux/psp-sfs.h                       |   87 ++
+ include/vdso/datapage.h                            |    9 +-
+ include/vdso/gettime.h                             |    1 +
+ include/vdso/jiffies.h                             |    2 +-
+ init/Kconfig                                       |    2 +-
+ kernel/Kconfig.preempt                             |   13 +
+ kernel/bpf/stackmap.c                              |    4 +-
+ kernel/bpf/verifier.c                              |    1 +
+ kernel/events/callchain.c                          |   42 +-
+ kernel/events/core.c                               |  421 ++++----
+ kernel/events/internal.h                           |    4 +-
+ kernel/events/ring_buffer.c                        |    2 +-
+ kernel/events/uprobes.c                            |  102 +-
+ kernel/fork.c                                      |    1 +
+ kernel/futex/syscalls.c                            |  106 +-
+ kernel/irq/Kconfig                                 |    6 +-
+ kernel/irq/chip.c                                  |   37 +
+ kernel/irq/devres.c                                |  127 ++-
+ kernel/irq/handle.c                                |   49 +-
+ kernel/irq/irq_test.c                              |   55 +-
+ kernel/irq/irqdesc.c                               |    7 -
+ kernel/panic.c                                     |   16 +-
+ kernel/rseq.c                                      |   10 +-
+ kernel/sched/core.c                                |   68 +-
+ kernel/sched/deadline.c                            |   73 +-
+ kernel/sched/fair.c                                |  507 ++++++----
+ kernel/sched/pelt.h                                |    4 +-
+ kernel/sched/rq-offsets.c                          |   12 +
+ kernel/sched/sched.h                               |    7 +-
+ kernel/sched/topology.c                            |   75 +-
+ kernel/seccomp.c                                   |   32 +-
+ kernel/smp.c                                       |   11 +-
+ kernel/softirq.c                                   |  145 ++-
+ kernel/sys_ni.c                                    |    1 +
+ kernel/time/Makefile                               |    2 +-
+ kernel/time/alarmtimer.c                           |    2 +-
+ kernel/time/clockevents.c                          |    2 +-
+ kernel/time/clocksource.c                          |    7 +-
+ kernel/time/hrtimer.c                              |   40 +-
+ kernel/time/itimer.c                               |    3 +-
+ kernel/time/posix-timers.c                         |    7 +-
+ kernel/time/sched_clock.c                          |    4 +-
+ kernel/time/tick-common.c                          |   16 +-
+ kernel/time/tick-internal.h                        |    2 +-
+ kernel/time/timer_list.c                           |    2 -
+ lib/Kconfig.debug                                  |   10 +
+ lib/test_objpool.c                                 |    2 +-
+ lib/vdso/Kconfig                                   |   25 +-
+ lib/vdso/Makefile                                  |    2 +-
+ lib/vdso/datastore.c                               |    6 +-
+ lib/vdso/gettimeofday.c                            |   27 -
+ rust/helpers/atomic.c                              | 1040 ++++++++++++++++++++
+ rust/helpers/barrier.c                             |   18 +
+ rust/helpers/helpers.c                             |    2 +
+ rust/helpers/refcount.c                            |   10 +
+ rust/kernel/block/mq/operations.rs                 |    7 +-
+ rust/kernel/block/mq/request.rs                    |   73 +-
+ rust/kernel/sync.rs                                |    4 +
+ rust/kernel/sync/arc.rs                            |   55 +-
+ rust/kernel/sync/atomic.rs                         |  551 +++++++++++
+ rust/kernel/sync/atomic/internal.rs                |  265 +++++
+ rust/kernel/sync/atomic/ordering.rs                |  104 ++
+ rust/kernel/sync/atomic/predefine.rs               |  169 ++++
+ rust/kernel/sync/barrier.rs                        |   61 ++
+ rust/kernel/sync/refcount.rs                       |  113 +++
+ scripts/atomic/gen-atomics.sh                      |    1 +
+ scripts/atomic/gen-rust-atomic-helpers.sh          |   67 ++
+ scripts/gdb/linux/timerlist.py                     |    2 -
+ sound/core/hrtimer.c                               |    2 +-
+ tools/arch/x86/include/asm/asm.h                   |   12 -
+ tools/arch/x86/include/asm/inat.h                  |   15 +
+ tools/arch/x86/include/asm/insn.h                  |   51 +-
+ tools/arch/x86/include/asm/msr-index.h             |   14 +-
+ tools/arch/x86/lib/inat.c                          |   13 +
+ tools/arch/x86/lib/insn.c                          |   35 +-
+ tools/arch/x86/lib/x86-opcode-map.txt              |  111 ++-
+ tools/arch/x86/tools/gen-insn-attr-x86.awk         |   44 +
+ tools/include/linux/objtool_types.h                |    1 +
+ tools/objtool/arch/x86/decode.c                    |   12 +
+ tools/objtool/builtin-check.c                      |    2 +
+ tools/objtool/check.c                              |   90 +-
+ tools/objtool/include/objtool/arch.h               |    1 +
+ tools/objtool/include/objtool/builtin.h            |    1 +
+ tools/objtool/include/objtool/elf.h                |    1 +
+ tools/objtool/noreturns.h                          |    1 -
+ tools/perf/bench/find-bit-bench.c                  |    2 +-
+ .../util/intel-pt-decoder/intel-pt-insn-decoder.c  |    2 +-
+ tools/power/x86/turbostat/turbostat.c              |    2 +-
+ .../selftests/bpf/prog_tests/uprobe_syscall.c      |  506 +++++++++-
+ tools/testing/selftests/bpf/prog_tests/usdt.c      |   38 +-
+ tools/testing/selftests/bpf/progs/uprobe_syscall.c |    4 +-
+ .../selftests/bpf/progs/uprobe_syscall_executed.c  |   62 +-
+ .../testing/selftests/bpf/test_kmods/bpf_testmod.c |   11 +-
+ tools/testing/selftests/bpf/usdt.h                 |  545 ++++++++++
+ tools/testing/selftests/futex/functional/Makefile  |    8 +-
+ .../selftests/futex/functional/futex_numa.c        |    3 +-
+ .../selftests/futex/functional/futex_numa_mpol.c   |  100 +-
+ .../selftests/futex/functional/futex_priv_hash.c   |   67 +-
+ .../selftests/futex/functional/futex_requeue.c     |   78 +-
+ .../selftests/futex/functional/futex_requeue_pi.c  |  266 +++--
+ .../functional/futex_requeue_pi_mismatched_ops.c   |   86 +-
+ .../functional/futex_requeue_pi_signal_restart.c   |  129 +--
+ .../selftests/futex/functional/futex_wait.c        |  105 +-
+ .../functional/futex_wait_private_mapped_file.c    |   79 +-
+ .../futex/functional/futex_wait_timeout.c          |  139 ++-
+ .../functional/futex_wait_uninitialized_heap.c     |   76 +-
+ .../futex/functional/futex_wait_wouldblock.c       |   76 +-
+ .../selftests/futex/functional/futex_waitv.c       |   99 +-
+ tools/testing/selftests/futex/functional/run.sh    |   64 +-
+ tools/testing/selftests/futex/include/futextest.h  |   11 +
+ tools/testing/selftests/futex/include/logging.h    |  148 ---
+ tools/testing/selftests/kselftest.h                |   14 +
+ tools/testing/selftests/kselftest_harness.h        |   13 +-
+ tools/testing/selftests/pidfd/config               |    1 -
+ tools/testing/selftests/rseq/rseq.c                |    8 +-
+ tools/testing/selftests/seccomp/seccomp_bpf.c      |  111 ++-
+ tools/testing/selftests/vDSO/.gitignore            |    1 -
+ tools/testing/selftests/vDSO/Makefile              |    2 -
+ tools/testing/selftests/vDSO/vdso_call.h           |    7 +-
+ tools/testing/selftests/vDSO/vdso_test_abi.c       |  101 +-
+ .../selftests/vDSO/vdso_test_clock_getres.c        |  123 ---
+ 424 files changed, 15102 insertions(+), 6631 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/timer/faraday,fttmr010.txt
+ create mode 100644 Documentation/devicetree/bindings/timer/faraday,fttmr010.yaml
+ create mode 100644 Documentation/devicetree/bindings/timer/fsl,timrot.yaml
+ create mode 100644 arch/x86/boot/startup/exports.h
+ rename arch/x86/coco/sev/{sev-nmi.c => noinstr.c} (61%)
+ create mode 100644 arch/x86/kernel/apic/x2apic_savic.c
+ create mode 100644 arch/x86/kernel/cpu/bhyve.c
+ create mode 100644 drivers/clocksource/arm_arch_timer_mmio.c
+ create mode 100644 drivers/clocksource/timer-nxp-pit.c
+ delete mode 100644 drivers/clocksource/timer-vf-pit.c
+ create mode 100644 drivers/crypto/ccp/sfs.c
+ create mode 100644 drivers/crypto/ccp/sfs.h
+ create mode 100644 include/asm-generic/thread_info_tif.h
+ create mode 100644 include/uapi/linux/psp-sfs.h
+ create mode 100644 kernel/sched/rq-offsets.c
+ create mode 100644 rust/helpers/atomic.c
+ create mode 100644 rust/helpers/barrier.c
+ create mode 100644 rust/kernel/sync/atomic.rs
+ create mode 100644 rust/kernel/sync/atomic/internal.rs
+ create mode 100644 rust/kernel/sync/atomic/ordering.rs
+ create mode 100644 rust/kernel/sync/atomic/predefine.rs
+ create mode 100644 rust/kernel/sync/barrier.rs
+ create mode 100644 rust/kernel/sync/refcount.rs
+ create mode 100755 scripts/atomic/gen-rust-atomic-helpers.sh
+ create mode 100644 tools/testing/selftests/bpf/usdt.h
+ delete mode 100644 tools/testing/selftests/futex/include/logging.h
+ delete mode 100644 tools/testing/selftests/vDSO/vdso_test_clock_getres.c
+Merging clockevents/timers/drivers/next (45d78cd0bf2c4 dt-bindings: timer: exynos4210-mct: Add compatible for ARTPEC-9 SoC)
+$ git merge -m Merge branch 'timers/drivers/next' of https://git.kernel.org/pub/scm/linux/kernel/git/daniel.lezcano/linux.git clockevents/timers/drivers/next
+Already up to date.
+Merging edac/edac-for-next (5c4a065eebd70 Merge ras/edac-drivers into for-next)
+$ git merge -m Merge branch 'edac-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ras/ras.git edac/edac-for-next
+Auto-merging Documentation/devicetree/bindings/arm/cpus.yaml
+Auto-merging MAINTAINERS
+Auto-merging drivers/cdx/controller/cdx_rpmsg.c
+Auto-merging drivers/edac/altera_edac.c
+Merge made by the 'ort' strategy.
+ Documentation/devicetree/bindings/arm/cpus.yaml    |  17 +
+ .../memory-controllers/xlnx,versal-net-ddrmc5.yaml |  41 +
+ MAINTAINERS                                        |  17 +-
+ drivers/cdx/controller/cdx_controller.c            |   2 +-
+ drivers/cdx/controller/cdx_rpmsg.c                 |   2 +-
+ drivers/cdx/controller/mcdi.c                      |  43 +-
+ drivers/cdx/controller/mcdi_functions.c            |   1 -
+ drivers/cdx/controller/mcdi_functions.h            |   3 +-
+ drivers/cdx/controller/mcdid.h                     |  63 ++
+ drivers/edac/Kconfig                               |  16 +
+ drivers/edac/Makefile                              |   2 +
+ drivers/edac/a72_edac.c                            | 225 +++++
+ drivers/edac/altera_edac.c                         |   4 +-
+ drivers/edac/amd64_edac.c                          |  20 +
+ drivers/edac/amd64_edac.h                          |   2 +-
+ drivers/edac/ecs.c                                 |   0
+ drivers/edac/edac_mc_sysfs.c                       |  24 +
+ drivers/edac/i10nm_base.c                          |  27 +-
+ drivers/edac/ie31200_edac.c                        |   4 +
+ drivers/edac/mem_repair.c                          |   0
+ drivers/edac/scrub.c                               |   0
+ drivers/edac/skx_base.c                            |  33 +-
+ drivers/edac/skx_common.c                          |  54 +-
+ drivers/edac/skx_common.h                          |  28 +-
+ drivers/edac/versalnet_edac.c                      | 960 +++++++++++++++++++++
+ drivers/ras/ras.c                                  |   1 +
+ .../controller => include/linux/cdx}/bitfield.h    |   0
+ include/linux/cdx/edac_cdx_pcol.h                  |  28 +
+ .../cdx/controller => include/linux/cdx}/mcdi.h    |  47 +-
+ 29 files changed, 1553 insertions(+), 111 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/memory-controllers/xlnx,versal-net-ddrmc5.yaml
+ create mode 100644 drivers/cdx/controller/mcdid.h
+ create mode 100644 drivers/edac/a72_edac.c
+ mode change 100755 => 100644 drivers/edac/ecs.c
+ mode change 100755 => 100644 drivers/edac/mem_repair.c
+ mode change 100755 => 100644 drivers/edac/scrub.c
+ create mode 100644 drivers/edac/versalnet_edac.c
+ rename {drivers/cdx/controller => include/linux/cdx}/bitfield.h (100%)
+ create mode 100644 include/linux/cdx/edac_cdx_pcol.h
+ rename {drivers/cdx/controller => include/linux/cdx}/mcdi.h (79%)
+Merging ftrace/for-next (4c064f7ff43b6 Merge probes/for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/trace/linux-trace.git ftrace/for-next
+Merge made by the 'ort' strategy.
+ include/linux/fprobe.h      |   3 +-
+ kernel/trace/fprobe.c       | 161 +++++++++++++++++++++++++-------------------
+ kernel/trace/trace_eprobe.c | 108 ++++++++++++-----------------
+ kernel/trace/trace_probe.c  |   5 +-
+ kernel/trace/trace_probe.h  |   4 +-
+ kernel/trace/trace_uprobe.c |  82 +++++++++-------------
+ 6 files changed, 176 insertions(+), 187 deletions(-)
+Merging rcu/next (1d289fc5691c7 Merge branch 'torture.2025.08.14a' into HEAD)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/rcu/linux rcu/next
+Auto-merging include/linux/list.h
+Merge made by the 'ort' strategy.
+ .../RCU/Design/Requirements/Requirements.rst       |  52 ++++----
+ Documentation/RCU/RTFP.txt                         |   6 +-
+ Documentation/RCU/checklist.rst                    |  27 ++--
+ Documentation/RCU/index.rst                        |   6 +-
+ Documentation/RCU/torture.rst                      |   4 +-
+ Documentation/RCU/whatisRCU.rst                    | 146 ++++++++++++++++-----
+ include/linux/list.h                               |  10 --
+ include/linux/rculist.h                            |  10 ++
+ include/linux/srcu.h                               |  34 +++++
+ include/linux/srcutree.h                           |  49 ++++---
+ kernel/cgroup/dmem.c                               |   1 +
+ kernel/rcu/rcutorture.c                            |  27 +++-
+ kernel/rcu/refscale.c                              |   4 +-
+ kernel/rcu/srcutiny.c                              |   4 +-
+ kernel/rcu/srcutree.c                              |  10 ++
+ kernel/rcu/tasks.h                                 |   4 +-
+ kernel/rcu/tree.c                                  |   9 +-
+ kernel/rcu/tree_plugin.h                           |   5 +-
+ kernel/torture.c                                   |   7 +-
+ tools/testing/selftests/rcutorture/bin/jitter.sh   |  27 +++-
+ tools/testing/selftests/rcutorture/bin/torture.sh  |   1 +
+ 21 files changed, 315 insertions(+), 128 deletions(-)
+Merging paulmck/non-rcu/next (b706eec9304fc Merge branches 'lkmm.2025.07.09a', 'ratelimit.2025.06.24a' and 'stop-machine.2025.07.17a' into HEAD)
+$ git merge -m Merge branch 'non-rcu/next' of https://git.kernel.org/pub/scm/linux/kernel/git/paulmck/linux-rcu.git paulmck/non-rcu/next
+Merge made by the 'ort' strategy.
+Merging kvm/next (a6ad54137af92 Merge branch 'guest-memfd-mmap' into HEAD)
+$ git merge -m Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm.git kvm/next
+Auto-merging arch/arm64/kvm/mmu.c
+CONFLICT (content): Merge conflict in arch/arm64/kvm/mmu.c
+Auto-merging arch/arm64/kvm/nested.c
+Auto-merging arch/x86/kvm/Kconfig
+CONFLICT (content): Merge conflict in arch/x86/kvm/Kconfig
+Auto-merging arch/x86/kvm/svm/svm.c
+Auto-merging arch/x86/kvm/vmx/tdx.c
+Auto-merging arch/x86/kvm/x86.c
+Auto-merging tools/testing/selftests/kvm/Makefile.kvm
+Resolved 'arch/arm64/kvm/mmu.c' using previous resolution.
+Resolved 'arch/x86/kvm/Kconfig' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 9c92adcd0525b] Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/virt/kvm/api.rst                 |   9 +
+ arch/arm64/kvm/Kconfig                         |   1 +
+ arch/arm64/kvm/mmu.c                           | 198 ++++++++++++++++-----
+ arch/arm64/kvm/nested.c                        |  41 ++++-
+ arch/x86/include/asm/kvm-x86-ops.h             |   2 +-
+ arch/x86/include/asm/kvm_host.h                |   6 +-
+ arch/x86/kvm/Kconfig                           |  26 +--
+ arch/x86/kvm/mmu/mmu.c                         | 142 ++++++++-------
+ arch/x86/kvm/mmu/mmu_internal.h                |   2 +-
+ arch/x86/kvm/mmu/tdp_mmu.c                     |   2 +-
+ arch/x86/kvm/svm/sev.c                         |   6 +-
+ arch/x86/kvm/svm/svm.c                         |   2 +-
+ arch/x86/kvm/svm/svm.h                         |   4 +-
+ arch/x86/kvm/vmx/main.c                        |   7 +-
+ arch/x86/kvm/vmx/tdx.c                         |   5 +-
+ arch/x86/kvm/vmx/x86_ops.h                     |   2 +-
+ arch/x86/kvm/x86.c                             |  11 ++
+ include/linux/kvm_host.h                       |  38 ++--
+ include/uapi/linux/kvm.h                       |   2 +
+ tools/testing/selftests/kvm/Makefile.kvm       |   1 +
+ tools/testing/selftests/kvm/guest_memfd_test.c | 236 ++++++++++++++++++++++---
+ virt/kvm/Kconfig                               |  15 +-
+ virt/kvm/Makefile.kvm                          |   2 +-
+ virt/kvm/guest_memfd.c                         |  81 ++++++++-
+ virt/kvm/kvm_main.c                            |  12 +-
+ virt/kvm/kvm_mm.h                              |   4 +-
+ 26 files changed, 648 insertions(+), 209 deletions(-)
+Merging kvm-arm/next (5e2ad9b562250 Merge branch kvmarm-master/fixes into kvmarm-master/next)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/kvmarm/kvmarm.git kvm-arm/next
+Auto-merging arch/arm64/include/asm/kvm_host.h
+Auto-merging arch/arm64/include/asm/kvm_pkvm.h
+Auto-merging arch/arm64/kernel/cpufeature.c
+Auto-merging arch/arm64/kvm/arm.c
+Auto-merging arch/arm64/kvm/debug.c
+Auto-merging arch/arm64/kvm/mmu.c
+Auto-merging arch/arm64/kvm/nested.c
+Auto-merging arch/arm64/kvm/pkvm.c
+Auto-merging arch/arm64/kvm/vgic/vgic-init.c
+Auto-merging arch/x86/kvm/vmx/vmx.c
+Auto-merging include/kvm/arm_vgic.h
+Auto-merging include/linux/arm_ffa.h
+Auto-merging include/linux/kvm_host.h
+Auto-merging tools/testing/selftests/kvm/Makefile.kvm
+Auto-merging virt/kvm/kvm_main.c
+Merge made by the 'ort' strategy.
+ arch/arm64/include/asm/kvm_asm.h                   |   2 +
+ arch/arm64/include/asm/kvm_emulate.h               |  34 +-
+ arch/arm64/include/asm/kvm_host.h                  |   5 +-
+ arch/arm64/include/asm/kvm_nested.h                |  27 +-
+ arch/arm64/include/asm/kvm_pkvm.h                  |   1 +
+ arch/arm64/include/asm/traps.h                     |   1 +
+ arch/arm64/include/asm/vncr_mapping.h              |   2 +
+ arch/arm64/kernel/cpufeature.c                     |  15 +
+ arch/arm64/kernel/image-vars.h                     |   3 +
+ arch/arm64/kernel/traps.c                          |  15 +-
+ arch/arm64/kvm/arm.c                               |  19 +-
+ arch/arm64/kvm/at.c                                | 380 +++++++++++++++------
+ arch/arm64/kvm/config.c                            | 358 ++++++++++++-------
+ arch/arm64/kvm/debug.c                             |  25 +-
+ arch/arm64/kvm/emulate-nested.c                    |   1 +
+ arch/arm64/kvm/handle_exit.c                       |   3 +
+ arch/arm64/kvm/hyp/include/nvhe/pkvm.h             |   4 +-
+ arch/arm64/kvm/hyp/include/nvhe/trap_handler.h     |   3 +-
+ arch/arm64/kvm/hyp/nvhe/Makefile                   |   1 +
+ arch/arm64/kvm/hyp/nvhe/ffa.c                      | 217 ++++++++----
+ arch/arm64/kvm/hyp/nvhe/hyp-main.c                 |  14 +
+ arch/arm64/kvm/hyp/nvhe/mem_protect.c              |   9 +-
+ arch/arm64/kvm/hyp/nvhe/pkvm.c                     | 177 +++++++---
+ arch/arm64/kvm/hyp/nvhe/setup.c                    |  12 +-
+ arch/arm64/kvm/hyp/vgic-v3-sr.c                    |  25 +-
+ arch/arm64/kvm/hyp/vhe/switch.c                    |   7 +
+ arch/arm64/kvm/inject_fault.c                      |  27 +-
+ arch/arm64/kvm/mmu.c                               |  16 +-
+ arch/arm64/kvm/nested.c                            |  78 ++++-
+ arch/arm64/kvm/pkvm.c                              |  76 +++--
+ arch/arm64/kvm/ptdump.c                            |  20 +-
+ arch/arm64/kvm/sys_regs.c                          |  63 +++-
+ arch/arm64/kvm/vgic/vgic-init.c                    |  14 +-
+ arch/arm64/kvm/vgic/vgic-v3.c                      |   8 +
+ arch/arm64/kvm/vgic/vgic-v5.c                      |   2 +-
+ arch/arm64/tools/cpucaps                           |   1 +
+ arch/x86/kvm/vmx/vmx.c                             |   7 +
+ drivers/irqchip/irq-gic-v5.c                       |   7 -
+ include/kvm/arm_vgic.h                             |   2 +-
+ include/linux/arm_ffa.h                            |   1 +
+ include/linux/irqchip/arm-vgic-info.h              |   2 -
+ include/linux/kvm_host.h                           |  11 +-
+ tools/testing/selftests/kvm/Makefile.kvm           |   1 +
+ tools/testing/selftests/kvm/arm64/arch_timer.c     |  13 +-
+ .../selftests/kvm/arm64/arch_timer_edge_cases.c    |  15 +-
+ .../testing/selftests/kvm/arm64/external_aborts.c  |  85 +++++
+ tools/testing/selftests/kvm/arm64/hello_el2.c      |  71 ++++
+ tools/testing/selftests/kvm/arm64/hypercalls.c     |   2 +-
+ tools/testing/selftests/kvm/arm64/kvm-uuid.c       |   2 +-
+ tools/testing/selftests/kvm/arm64/no-vgic-v3.c     |   2 +
+ tools/testing/selftests/kvm/arm64/psci_test.c      |  13 +-
+ tools/testing/selftests/kvm/arm64/set_id_regs.c    |  44 +--
+ tools/testing/selftests/kvm/arm64/smccc_filter.c   |  17 +-
+ tools/testing/selftests/kvm/arm64/vgic_init.c      |   2 +
+ tools/testing/selftests/kvm/arm64/vgic_irq.c       |   4 +-
+ .../testing/selftests/kvm/arm64/vgic_lpi_stress.c  |   8 +-
+ .../selftests/kvm/arm64/vpmu_counter_access.c      |  75 ++--
+ tools/testing/selftests/kvm/dirty_log_perf_test.c  |  35 --
+ tools/testing/selftests/kvm/dirty_log_test.c       |   1 +
+ tools/testing/selftests/kvm/get-reg-list.c         |   9 +-
+ .../selftests/kvm/include/arm64/arch_timer.h       |  24 ++
+ .../selftests/kvm/include/arm64/kvm_util_arch.h    |   5 +-
+ .../selftests/kvm/include/arm64/processor.h        |  84 +++++
+ tools/testing/selftests/kvm/include/arm64/vgic.h   |   3 +
+ tools/testing/selftests/kvm/include/kvm_util.h     |   7 +-
+ tools/testing/selftests/kvm/lib/arm64/processor.c  | 104 +++++-
+ tools/testing/selftests/kvm/lib/arm64/vgic.c       |  66 ++--
+ tools/testing/selftests/kvm/lib/kvm_util.c         |  15 +-
+ tools/testing/selftests/kvm/lib/x86/processor.c    |   2 +-
+ tools/testing/selftests/kvm/s390/cmma_test.c       |   2 +-
+ tools/testing/selftests/kvm/steal_time.c           |   2 +-
+ virt/kvm/kvm_main.c                                |  43 ++-
+ 72 files changed, 1757 insertions(+), 694 deletions(-)
+ create mode 100644 tools/testing/selftests/kvm/arm64/hello_el2.c
+Merging kvms390/next (352ccf890a3e9 KVM: s390: improve interrupt cpu for wakeup)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/kvms390/linux.git kvms390/next
+Auto-merging arch/s390/kvm/interrupt.c
+Merge made by the 'ort' strategy.
+ arch/s390/include/asm/kvm_host.h |  2 +-
+ arch/s390/kvm/interrupt.c        | 20 +++++++++-----------
+ 2 files changed, 10 insertions(+), 12 deletions(-)
+Merging kvm-ppc/topic/ppc-kvm (c17b750b3ad9f Linux 6.17-rc2)
+$ git merge -m Merge branch 'topic/ppc-kvm' of https://git.kernel.org/pub/scm/linux/kernel/git/powerpc/linux.git kvm-ppc/topic/ppc-kvm
+Already up to date.
+Merging kvm-riscv/riscv_kvm_next (dbdadd943a278 RISC-V: KVM: Upgrade the supported SBI version to 3.0)
+$ git merge -m Merge branch 'riscv_kvm_next' of https://github.com/kvm-riscv/linux.git kvm-riscv/riscv_kvm_next
+Auto-merging arch/riscv/include/asm/sbi.h
+Auto-merging arch/riscv/include/uapi/asm/kvm.h
+Auto-merging drivers/perf/riscv_pmu_sbi.c
+Auto-merging tools/testing/selftests/kvm/Makefile.kvm
+Merge made by the 'ort' strategy.
+ arch/riscv/include/asm/kvm_host.h                  |   4 +
+ arch/riscv/include/asm/kvm_vcpu_pmu.h              |   3 +
+ arch/riscv/include/asm/kvm_vcpu_sbi.h              |  25 +-
+ arch/riscv/include/asm/kvm_vcpu_sbi_fwft.h         |  34 ++
+ arch/riscv/include/asm/sbi.h                       |  13 +
+ arch/riscv/include/uapi/asm/kvm.h                  |  21 +
+ arch/riscv/kvm/Makefile                            |   1 +
+ arch/riscv/kvm/gstage.c                            |  27 +-
+ arch/riscv/kvm/main.c                              |  33 +-
+ arch/riscv/kvm/vcpu.c                              |   3 +-
+ arch/riscv/kvm/vcpu_onereg.c                       |  95 ++--
+ arch/riscv/kvm/vcpu_pmu.c                          |  74 ++-
+ arch/riscv/kvm/vcpu_sbi.c                          | 198 ++++++--
+ arch/riscv/kvm/vcpu_sbi_fwft.c                     | 544 +++++++++++++++++++++
+ arch/riscv/kvm/vcpu_sbi_pmu.c                      |   3 +
+ arch/riscv/kvm/vcpu_sbi_sta.c                      |  74 +--
+ arch/riscv/kvm/vmid.c                              |   8 +-
+ drivers/perf/riscv_pmu_sbi.c                       | 191 ++++++--
+ include/linux/perf/riscv_pmu.h                     |   1 +
+ tools/testing/selftests/kvm/Makefile.kvm           |   6 +
+ .../selftests/kvm/access_tracking_perf_test.c      |   1 +
+ .../selftests/kvm/include/riscv/processor.h        |   1 +
+ .../kvm/memslot_modification_stress_test.c         |   1 +
+ tools/testing/selftests/kvm/memslot_perf_test.c    |   1 +
+ tools/testing/selftests/kvm/riscv/get-reg-list.c   |  60 +++
+ tools/testing/selftests/rseq/rseq-riscv.h          |   3 +-
+ 26 files changed, 1200 insertions(+), 225 deletions(-)
+ create mode 100644 arch/riscv/include/asm/kvm_vcpu_sbi_fwft.h
+ create mode 100644 arch/riscv/kvm/vcpu_sbi_fwft.c
+Merging kvm-x86/next (325fbe689e121 Merge branches 'cet', 'ciphertext', 'exports', 'fixes', 'generic', 'guest', 'mmu', 'svm' and 'vmx')
+$ git merge -m Merge branch 'next' of https://github.com/kvm-x86/linux.git kvm-x86/next
+Auto-merging Documentation/admin-guide/kernel-parameters.txt
+Auto-merging arch/s390/include/asm/kvm_host.h
+Auto-merging arch/x86/include/asm/cpufeatures.h
+CONFLICT (content): Merge conflict in arch/x86/include/asm/cpufeatures.h
+Auto-merging arch/x86/include/asm/msr-index.h
+CONFLICT (content): Merge conflict in arch/x86/include/asm/msr-index.h
+Auto-merging arch/x86/kernel/cpu/scattered.c
+Auto-merging arch/x86/kvm/emulate.c
+CONFLICT (content): Merge conflict in arch/x86/kvm/emulate.c
+Auto-merging arch/x86/kvm/pmu.h
+Auto-merging arch/x86/kvm/vmx/tdx.c
+Auto-merging arch/x86/kvm/vmx/vmx.c
+Auto-merging arch/x86/kvm/x86.c
+Auto-merging tools/testing/selftests/kvm/Makefile.kvm
+Auto-merging tools/testing/selftests/kvm/include/kvm_util.h
+Auto-merging tools/testing/selftests/kvm/lib/kvm_util.c
+Auto-merging tools/testing/selftests/kvm/lib/x86/processor.c
+Auto-merging virt/kvm/kvm_main.c
+Resolved 'arch/x86/include/asm/cpufeatures.h' using previous resolution.
+Resolved 'arch/x86/include/asm/msr-index.h' using previous resolution.
+Resolved 'arch/x86/kvm/emulate.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master ca03d513aafc0] Merge branch 'next' of https://github.com/kvm-x86/linux.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/admin-guide/kernel-parameters.txt    |  21 +
+ Documentation/virt/kvm/api.rst                     |  20 +-
+ Documentation/virt/kvm/x86/hypercalls.rst          |   6 +-
+ arch/powerpc/include/asm/Kbuild                    |   1 -
+ arch/powerpc/include/asm/kvm_types.h               |  15 +
+ arch/s390/include/asm/kvm_host.h                   |   2 +
+ arch/s390/kvm/priv.c                               |   8 +
+ arch/x86/include/asm/cpufeatures.h                 |   2 +
+ arch/x86/include/asm/kvm-x86-ops.h                 |   2 +-
+ arch/x86/include/asm/kvm_host.h                    |  83 +-
+ arch/x86/include/asm/kvm_para.h                    |   2 -
+ arch/x86/include/asm/kvm_types.h                   |  10 +
+ arch/x86/include/asm/msr-index.h                   |   3 +
+ arch/x86/include/asm/svm.h                         |   1 +
+ arch/x86/include/asm/vmx.h                         |   9 +
+ arch/x86/include/uapi/asm/kvm.h                    |  34 +
+ arch/x86/include/uapi/asm/vmx.h                    |   6 +-
+ arch/x86/kernel/cpu/scattered.c                    |   1 +
+ arch/x86/kernel/kvm.c                              |  44 +-
+ arch/x86/kvm/cpuid.c                               |  58 +-
+ arch/x86/kvm/emulate.c                             | 163 +++-
+ arch/x86/kvm/hyperv.c                              |  16 +-
+ arch/x86/kvm/ioapic.c                              |  15 +-
+ arch/x86/kvm/irq.c                                 |  91 +-
+ arch/x86/kvm/irq.h                                 |   4 -
+ arch/x86/kvm/kvm_cache_regs.h                      |   3 +-
+ arch/x86/kvm/kvm_emulate.h                         |   3 +-
+ arch/x86/kvm/kvm_onhyperv.c                        |   6 +-
+ arch/x86/kvm/lapic.c                               | 244 ++++--
+ arch/x86/kvm/lapic.h                               |  19 +-
+ arch/x86/kvm/mmu.h                                 |   2 +-
+ arch/x86/kvm/mmu/mmu.c                             | 201 +++--
+ arch/x86/kvm/mmu/mmu_internal.h                    |   6 +-
+ arch/x86/kvm/mmu/mmutrace.h                        |   3 +
+ arch/x86/kvm/mmu/spte.c                            |  10 +-
+ arch/x86/kvm/mmu/tdp_mmu.c                         |  51 +-
+ arch/x86/kvm/mmu/tdp_mmu.h                         |   3 +-
+ arch/x86/kvm/pmu.c                                 | 175 +++-
+ arch/x86/kvm/pmu.h                                 |  60 +-
+ arch/x86/kvm/reverse_cpuid.h                       |   5 +
+ arch/x86/kvm/smm.c                                 |  14 +-
+ arch/x86/kvm/smm.h                                 |   2 +-
+ arch/x86/kvm/svm/avic.c                            | 151 +++-
+ arch/x86/kvm/svm/nested.c                          |  38 +-
+ arch/x86/kvm/svm/pmu.c                             |   8 +-
+ arch/x86/kvm/svm/sev.c                             | 231 +++--
+ arch/x86/kvm/svm/svm.c                             | 236 +++--
+ arch/x86/kvm/svm/svm.h                             |  44 +-
+ arch/x86/kvm/svm/svm_onhyperv.c                    |  28 +-
+ arch/x86/kvm/svm/svm_onhyperv.h                    |  31 +-
+ arch/x86/kvm/trace.h                               |   5 +-
+ arch/x86/kvm/vmx/capabilities.h                    |  12 +-
+ arch/x86/kvm/vmx/main.c                            |  14 +-
+ arch/x86/kvm/vmx/nested.c                          | 215 ++++-
+ arch/x86/kvm/vmx/nested.h                          |   5 +
+ arch/x86/kvm/vmx/pmu_intel.c                       |  79 +-
+ arch/x86/kvm/vmx/tdx.c                             |  28 +-
+ arch/x86/kvm/vmx/vmcs12.c                          |   6 +
+ arch/x86/kvm/vmx/vmcs12.h                          |  14 +-
+ arch/x86/kvm/vmx/vmx.c                             | 233 +++--
+ arch/x86/kvm/vmx/vmx.h                             |  22 +-
+ arch/x86/kvm/vmx/x86_ops.h                         |   2 +-
+ arch/x86/kvm/x86.c                                 | 952 +++++++++++++++------
+ arch/x86/kvm/x86.h                                 |  42 +-
+ drivers/s390/crypto/vfio_ap_ops.c                  |   2 +-
+ include/linux/kvm_types.h                          |  25 +-
+ tools/testing/selftests/kvm/Makefile.kvm           |   1 +
+ tools/testing/selftests/kvm/include/kvm_util.h     |  17 +-
+ tools/testing/selftests/kvm/include/x86/pmu.h      |  26 +
+ .../testing/selftests/kvm/include/x86/processor.h  |  40 +-
+ tools/testing/selftests/kvm/lib/kvm_util.c         |  42 +-
+ tools/testing/selftests/kvm/lib/x86/pmu.c          |  49 ++
+ tools/testing/selftests/kvm/lib/x86/processor.c    |  39 +-
+ .../selftests/kvm/s390/cpumodel_subfuncs_test.c    |   2 +-
+ tools/testing/selftests/kvm/x86/fastops_test.c     |  82 +-
+ tools/testing/selftests/kvm/x86/hyperv_cpuid.c     |   2 +-
+ tools/testing/selftests/kvm/x86/hyperv_features.c  |  16 +-
+ .../testing/selftests/kvm/x86/monitor_mwait_test.c |   8 +-
+ tools/testing/selftests/kvm/x86/msrs_test.c        | 489 +++++++++++
+ .../testing/selftests/kvm/x86/pmu_counters_test.c  |  75 +-
+ .../selftests/kvm/x86/pmu_event_filter_test.c      |   4 +-
+ .../testing/selftests/kvm/x86/vmx_pmu_caps_test.c  |   7 +-
+ tools/testing/selftests/kvm/x86/xapic_state_test.c |   4 +-
+ tools/testing/selftests/kvm/x86/xcr0_cpuid_test.c  |  12 +-
+ virt/kvm/async_pf.c                                |   2 +-
+ virt/kvm/eventfd.c                                 |   2 +-
+ virt/kvm/guest_memfd.c                             |   7 +-
+ virt/kvm/kvm_main.c                                | 127 +--
+ 88 files changed, 3538 insertions(+), 1362 deletions(-)
+ create mode 100644 arch/powerpc/include/asm/kvm_types.h
+ create mode 100644 tools/testing/selftests/kvm/x86/msrs_test.c
+Merging xen-tip/linux-next (9d52b0b41be5b xen: take system_transition_mutex on suspend)
+$ git merge -m Merge branch 'linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/xen/tip.git xen-tip/linux-next
+Auto-merging drivers/xen/gntdev.c
+Merge made by the 'ort' strategy.
+ arch/x86/configs/xen.config        |  1 -
+ arch/x86/include/asm/xen/page.h    | 14 +++++++-------
+ arch/x86/xen/Kconfig               |  7 +------
+ arch/x86/xen/enlighten_pv.c        |  2 +-
+ arch/x86/xen/mmu.c                 |  2 +-
+ arch/x86/xen/p2m.c                 |  4 ++--
+ drivers/xen/balloon.c              |  4 ++--
+ drivers/xen/events/events_base.c   | 37 +++++++++++++++++++++++++++++--------
+ drivers/xen/gntdev-dmabuf.c        |  7 +++----
+ drivers/xen/gntdev-dmabuf.h        |  2 +-
+ drivers/xen/gntdev.c               | 33 ++++++++++++++-------------------
+ drivers/xen/grant-table.c          |  6 +++---
+ drivers/xen/manage.c               | 14 ++++++++++++--
+ drivers/xen/privcmd.c              | 14 ++++++--------
+ drivers/xen/unpopulated-alloc.c    |  4 ++--
+ drivers/xen/xenbus/xenbus_client.c |  2 +-
+ include/xen/grant_table.h          |  4 ++--
+ include/xen/mem-reservation.h      |  4 ++--
+ include/xen/xen-ops.h              |  7 ++++---
+ include/xen/xen.h                  |  9 ++++++++-
+ 20 files changed, 101 insertions(+), 76 deletions(-)
+Merging percpu/for-next (87d6aab2389e5 Merge tag 'for_linus' of git://git.kernel.org/pub/scm/linux/kernel/git/mst/vhost)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/dennis/percpu.git percpu/for-next
+Already up to date.
+Merging workqueues/for-next (8b8cfc05ada8a Merge branch 'for-6.18' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/tj/wq.git workqueues/for-next
+Merge made by the 'ort' strategy.
+ include/linux/workqueue.h | 32 +++++++++----------
+ kernel/workqueue.c        | 80 +++++++++++++++++++++++++++++++----------------
+ 2 files changed, 69 insertions(+), 43 deletions(-)
+Merging sched-ext/for-next (e343e82601f93 Merge branch 'for-6.18' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/tj/sched_ext.git sched-ext/for-next
+Auto-merging kernel/sched/core.c
+Merge made by the 'ort' strategy.
+ include/linux/sched/ext.h                          |    6 +-
+ kernel/sched/build_policy.c                        |    1 +
+ kernel/sched/core.c                                |    2 -
+ kernel/sched/ext.c                                 | 1567 ++++----------------
+ kernel/sched/ext.h                                 |   25 -
+ kernel/sched/ext_idle.c                            |  146 +-
+ kernel/sched/ext_internal.h                        | 1078 ++++++++++++++
+ tools/sched_ext/include/scx/bpf_arena_common.bpf.h |  175 +++
+ tools/sched_ext/include/scx/bpf_arena_common.h     |   33 +
+ tools/sched_ext/include/scx/common.bpf.h           |  104 +-
+ tools/sched_ext/include/scx/common.h               |    5 +-
+ tools/sched_ext/include/scx/compat.bpf.h           |   22 +
+ tools/sched_ext/include/scx/user_exit_info.bpf.h   |   40 +
+ tools/sched_ext/include/scx/user_exit_info.h       |   49 +-
+ .../sched_ext/include/scx/user_exit_info_common.h  |   30 +
+ tools/sched_ext/scx_central.bpf.c                  |    2 +-
+ tools/sched_ext/scx_central.c                      |    1 +
+ tools/sched_ext/scx_flatcg.bpf.c                   |    2 +-
+ tools/sched_ext/scx_flatcg.c                       |    2 +
+ tools/sched_ext/scx_qmap.bpf.c                     |   96 +-
+ tools/sched_ext/scx_qmap.c                         |   12 +-
+ tools/sched_ext/scx_simple.c                       |    2 +
+ 22 files changed, 2000 insertions(+), 1400 deletions(-)
+ create mode 100644 kernel/sched/ext_internal.h
+ create mode 100644 tools/sched_ext/include/scx/bpf_arena_common.bpf.h
+ create mode 100644 tools/sched_ext/include/scx/bpf_arena_common.h
+ create mode 100644 tools/sched_ext/include/scx/user_exit_info.bpf.h
+ create mode 100644 tools/sched_ext/include/scx/user_exit_info_common.h
+Merging drivers-x86/for-next (b8754092dfed4 platform/x86: pcengines-apuv2: Use static device properties)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/pdx86/platform-drivers-x86.git drivers-x86/for-next
+Auto-merging MAINTAINERS
+Auto-merging arch/arm64/boot/dts/qcom/x1e78100-lenovo-thinkpad-t14s.dtsi
+Auto-merging drivers/platform/x86/amd/hsmp/acpi.c
+Auto-merging drivers/platform/x86/intel/int3472/discrete.c
+Auto-merging drivers/platform/x86/intel/pmc/core.c
+Auto-merging drivers/platform/x86/intel/uncore-frequency/uncore-frequency-tpmi.c
+Auto-merging sound/soc/intel/boards/bytcr_wm5102.c
+Merge made by the 'ort' strategy.
+ .../lenovo,thinkpad-t14s-ec.yaml                   |  50 ++
+ MAINTAINERS                                        |  12 +
+ .../dts/qcom/x1e78100-lenovo-thinkpad-t14s.dtsi    |  24 +
+ drivers/platform/arm64/Kconfig                     |  20 +
+ drivers/platform/arm64/Makefile                    |   1 +
+ drivers/platform/arm64/lenovo-thinkpad-t14s.c      | 616 +++++++++++++++++++++
+ drivers/platform/x86/Kconfig                       |  12 +
+ drivers/platform/x86/Makefile                      |   1 +
+ drivers/platform/x86/amd/hsmp/acpi.c               |   4 +-
+ drivers/platform/x86/amd/hsmp/plat.c               |   4 +-
+ drivers/platform/x86/amd/pmf/acpi.c                |  87 ++-
+ drivers/platform/x86/amd/pmf/pmf.h                 |  77 ++-
+ drivers/platform/x86/amd/pmf/spc.c                 |  80 ++-
+ drivers/platform/x86/amd/pmf/sps.c                 |   2 +-
+ drivers/platform/x86/amd/pmf/tee-if.c              |  22 +-
+ drivers/platform/x86/barco-p50-gpio.c              | 104 ++--
+ drivers/platform/x86/dell/dell_rbu.c               |   8 +-
+ drivers/platform/x86/intel/int3472/discrete.c      |  58 +-
+ drivers/platform/x86/intel/pmc/Makefile            |   2 +-
+ drivers/platform/x86/intel/pmc/arl.c               |   4 +
+ drivers/platform/x86/intel/pmc/core.c              | 191 +++++--
+ drivers/platform/x86/intel/pmc/core.h              |  27 +
+ drivers/platform/x86/intel/pmc/lnl.c               |  18 +
+ drivers/platform/x86/intel/pmc/mtl.c               |   2 +
+ drivers/platform/x86/intel/pmc/ptl.c               |  37 +-
+ drivers/platform/x86/intel/pmc/ssram_telemetry.c   |   1 +
+ drivers/platform/x86/intel/pmc/tgl.c               |   4 +-
+ drivers/platform/x86/intel/pmc/wcl.c               | 486 ++++++++++++++++
+ .../intel/uncore-frequency/uncore-frequency-tpmi.c |  76 ++-
+ drivers/platform/x86/lenovo/think-lmi.c            |  94 +++-
+ drivers/platform/x86/lenovo/think-lmi.h            |  14 +
+ drivers/platform/x86/lenovo/wmi-capdata01.c        |   2 +-
+ .../x86/lenovo/yoga-tab2-pro-1380-fastcharger.c    |   5 +
+ drivers/platform/x86/meraki-mx100.c                | 404 +++++++++-----
+ drivers/platform/x86/pcengines-apuv2.c             | 196 ++++---
+ drivers/platform/x86/portwell-ec.c                 | 194 ++++++-
+ drivers/platform/x86/quickstart.c                  |  10 +-
+ drivers/platform/x86/redmi-wmi.c                   | 130 +++++
+ drivers/platform/x86/x86-android-tablets/Makefile  |   2 +-
+ drivers/platform/x86/x86-android-tablets/acer.c    | 247 +++++++++
+ drivers/platform/x86/x86-android-tablets/asus.c    | 108 ++--
+ drivers/platform/x86/x86-android-tablets/core.c    | 121 ++--
+ drivers/platform/x86/x86-android-tablets/dmi.c     |  12 +-
+ drivers/platform/x86/x86-android-tablets/lenovo.c  | 291 +++++-----
+ drivers/platform/x86/x86-android-tablets/other.c   | 338 ++++-------
+ .../x86/x86-android-tablets/shared-psy-info.c      |  34 +-
+ .../x86/x86-android-tablets/shared-psy-info.h      |   8 +-
+ .../x86/x86-android-tablets/vexia_atla10_ec.c      |   2 +-
+ .../x86/x86-android-tablets/x86-android-tablets.h  |  28 +-
+ drivers/platform/x86/xiaomi-wmi.c                  |  10 +-
+ sound/soc/intel/boards/bytcr_wm5102.c              |   2 +-
+ 51 files changed, 3390 insertions(+), 892 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/embedded-controller/lenovo,thinkpad-t14s-ec.yaml
+ create mode 100644 drivers/platform/arm64/lenovo-thinkpad-t14s.c
+ create mode 100644 drivers/platform/x86/intel/pmc/wcl.c
+ create mode 100644 drivers/platform/x86/redmi-wmi.c
+ create mode 100644 drivers/platform/x86/x86-android-tablets/acer.c
+Merging chrome-platform/for-next (48633acccf38d Input: cros_ec_keyb - Defer probe until parent EC device is registered)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/chrome-platform/linux.git chrome-platform/for-next
+Merge made by the 'ort' strategy.
+ drivers/input/keyboard/cros_ec_keyb.c        |  6 ++
+ drivers/platform/chrome/cros_ec.c            | 90 ++++++++++++++++++----------
+ drivers/platform/chrome/cros_ec.h            |  3 +
+ drivers/platform/chrome/cros_ec_chardev.c    | 72 ++++++++++------------
+ drivers/platform/chrome/cros_ec_i2c.c        |  9 +--
+ drivers/platform/chrome/cros_ec_ishtp.c      |  6 +-
+ drivers/platform/chrome/cros_ec_lpc.c        |  6 +-
+ drivers/platform/chrome/cros_ec_proto.c      | 15 +++++
+ drivers/platform/chrome/cros_ec_rpmsg.c      |  6 +-
+ drivers/platform/chrome/cros_ec_spi.c        |  7 +--
+ drivers/platform/chrome/cros_ec_uart.c       |  6 +-
+ drivers/platform/chrome/wilco_ec/telemetry.c |  2 +-
+ include/linux/platform_data/cros_ec_proto.h  | 18 ++++--
+ 13 files changed, 139 insertions(+), 107 deletions(-)
+Merging chrome-platform-firmware/for-firmware-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-firmware-next' of https://git.kernel.org/pub/scm/linux/kernel/git/chrome-platform/linux.git chrome-platform-firmware/for-firmware-next
+Already up to date.
+Merging hsi/for-next (ca50b295fd473 HSI: omap_ssi_port: Remove redundant pm_runtime_mark_last_busy() calls)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sre/linux-hsi.git hsi/for-next
+Merge made by the 'ort' strategy.
+ drivers/hsi/controllers/omap_ssi_port.c | 11 -----------
+ 1 file changed, 11 deletions(-)
+Merging leds-lj/for-leds-next (ef381e17930e9 leds: led-class: Add Device Tree support to led_get())
+$ git merge -m Merge branch 'for-leds-next' of https://git.kernel.org/pub/scm/linux/kernel/git/lee/leds.git leds-lj/for-leds-next
+Merge made by the 'ort' strategy.
+ .../bindings/leds/backlight/led-backlight.yaml     |   6 +-
+ .../devicetree/bindings/leds/issi,is31fl319x.yaml  |   1 -
+ .../devicetree/bindings/leds/leds-consumer.yaml    |  67 ++++++++
+ .../bindings/leds/leds-group-multicolor.yaml       |   5 +-
+ .../bindings/media/video-interface-devices.yaml    |   8 +
+ drivers/leds/Kconfig                               |   2 +-
+ drivers/leds/flash/leds-qcom-flash.c               |  87 ++++++----
+ drivers/leds/led-class.c                           |  17 +-
+ drivers/leds/leds-is31fl319x.c                     |   8 +-
+ drivers/leds/leds-is31fl32xx.c                     |  47 +++++-
+ drivers/leds/leds-lp55xx-common.c                  |   2 +-
+ drivers/leds/leds-max77705.c                       |   2 +-
+ drivers/leds/leds-qnap-mcu.c                       | 175 ++++++++++++++++++++-
+ 13 files changed, 367 insertions(+), 60 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/leds/leds-consumer.yaml
+Merging ipmi/for-next (d46651d4e3c0c ipmi: Add Loongson-2K BMC support)
+$ git merge -m Merge branch 'for-next' of https://github.com/cminyard/linux-ipmi.git ipmi/for-next
+Merge made by the 'ort' strategy.
+ .../bindings/ipmi/aspeed,ast2400-kcs-bmc.yaml      |   3 +
+ drivers/char/ipmi/Kconfig                          |   7 +
+ drivers/char/ipmi/Makefile                         |   1 +
+ drivers/char/ipmi/ipmi_ipmb.c                      |   4 +-
+ drivers/char/ipmi/ipmi_kcs_sm.c                    |  16 +-
+ drivers/char/ipmi/ipmi_msghandler.c                | 611 +++++++++++----------
+ drivers/char/ipmi/ipmi_powernv.c                   |  17 +-
+ drivers/char/ipmi/ipmi_si.h                        |   7 +
+ drivers/char/ipmi/ipmi_si_intf.c                   |  74 ++-
+ drivers/char/ipmi/ipmi_si_ls2k.c                   | 189 +++++++
+ drivers/char/ipmi/ipmi_ssif.c                      |   4 +-
+ include/linux/ipmi_smi.h                           |  11 +-
+ 12 files changed, 603 insertions(+), 341 deletions(-)
+ create mode 100644 drivers/char/ipmi/ipmi_si_ls2k.c
+Merging driver-core/driver-core-next (6d97171ac6585 rust: pci: display symbolic PCI vendor names)
+$ git merge -m Merge branch 'driver-core-next' of https://git.kernel.org/pub/scm/linux/kernel/git/driver-core/driver-core.git driver-core/driver-core-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/gpu/nova-core/driver.rs
+Auto-merging include/linux/property.h
+Auto-merging kernel/events/core.c
+Auto-merging rust/bindings/bindings_helper.h
+Auto-merging rust/helpers/helpers.c
+Auto-merging rust/kernel/devres.rs
+Auto-merging rust/kernel/lib.rs
+Auto-merging samples/rust/rust_dma.rs
+Auto-merging samples/rust/rust_driver_pci.rs
+Merge made by the 'ort' strategy.
+ MAINTAINERS                              |  20 ++
+ drivers/base/auxiliary.c                 |  27 +-
+ drivers/base/core.c                      |  27 +-
+ drivers/base/cpu.c                       |   2 +-
+ drivers/base/faux.c                      |   1 +
+ drivers/base/swnode.c                    |   5 +-
+ drivers/gpu/nova-core/driver.rs          |  33 +-
+ fs/sysfs/file.c                          |  22 +-
+ include/linux/device.h                   |   3 +
+ include/linux/property.h                 |   4 +-
+ include/linux/sysfs.h                    |  11 +-
+ kernel/events/core.c                     |   2 +-
+ rust/bindings/bindings_helper.h          |   2 +
+ rust/helpers/helpers.c                   |   2 +
+ rust/helpers/irq.c                       |   9 +
+ rust/helpers/pci.c                       |  18 +
+ rust/helpers/processor.c                 |   8 +
+ rust/kernel/auxiliary.rs                 |   4 +-
+ rust/kernel/debugfs.rs                   | 594 +++++++++++++++++++++++++++++++
+ rust/kernel/debugfs/callback_adapters.rs | 122 +++++++
+ rust/kernel/debugfs/entry.rs             | 164 +++++++++
+ rust/kernel/debugfs/file_ops.rs          | 247 +++++++++++++
+ rust/kernel/debugfs/traits.rs            | 102 ++++++
+ rust/kernel/device.rs                    |   7 +-
+ rust/kernel/devres.rs                    |   4 +-
+ rust/kernel/io.rs                        |   1 +
+ rust/kernel/io/poll.rs                   | 104 ++++++
+ rust/kernel/irq.rs                       |  24 ++
+ rust/kernel/irq/flags.rs                 | 124 +++++++
+ rust/kernel/irq/request.rs               | 507 ++++++++++++++++++++++++++
+ rust/kernel/lib.rs                       |   3 +
+ rust/kernel/pci.rs                       | 180 +++++++++-
+ rust/kernel/pci/id.rs                    | 578 ++++++++++++++++++++++++++++++
+ rust/kernel/platform.rs                  | 178 ++++++++-
+ rust/kernel/processor.rs                 |  14 +
+ samples/rust/Kconfig                     |  22 ++
+ samples/rust/Makefile                    |   2 +
+ samples/rust/rust_debugfs.rs             | 151 ++++++++
+ samples/rust/rust_debugfs_scoped.rs      | 134 +++++++
+ samples/rust/rust_dma.rs                 |   6 +-
+ samples/rust/rust_driver_auxiliary.rs    |  12 +-
+ samples/rust/rust_driver_pci.rs          |   9 +-
+ samples/rust/rust_driver_platform.rs     |   2 +-
+ 43 files changed, 3392 insertions(+), 99 deletions(-)
+ create mode 100644 rust/helpers/irq.c
+ create mode 100644 rust/helpers/processor.c
+ create mode 100644 rust/kernel/debugfs.rs
+ create mode 100644 rust/kernel/debugfs/callback_adapters.rs
+ create mode 100644 rust/kernel/debugfs/entry.rs
+ create mode 100644 rust/kernel/debugfs/file_ops.rs
+ create mode 100644 rust/kernel/debugfs/traits.rs
+ create mode 100644 rust/kernel/io/poll.rs
+ create mode 100644 rust/kernel/irq.rs
+ create mode 100644 rust/kernel/irq/flags.rs
+ create mode 100644 rust/kernel/irq/request.rs
+ create mode 100644 rust/kernel/pci/id.rs
+ create mode 100644 rust/kernel/processor.rs
+ create mode 100644 samples/rust/rust_debugfs.rs
+ create mode 100644 samples/rust/rust_debugfs_scoped.rs
+Merging usb/usb-next (e40b984b6c4ce usb: vhci-hcd: Prevent suspending virtually attached devices)
+$ git merge -m Merge branch 'usb-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/usb.git usb/usb-next
+Auto-merging CREDITS
+Auto-merging MAINTAINERS
+Auto-merging drivers/gpio/Kconfig
+Auto-merging drivers/gpio/Makefile
+Auto-merging drivers/i2c/busses/Kconfig
+Auto-merging drivers/media/usb/uvc/uvc_driver.c
+Auto-merging drivers/media/usb/uvc/uvc_video.c
+Auto-merging drivers/media/usb/uvc/uvcvideo.h
+Auto-merging drivers/pci/quirks.c
+Auto-merging drivers/usb/gadget/function/f_fs.c
+Merge made by the 'ort' strategy.
+ CREDITS                                            |   5 +
+ .../devicetree/bindings/usb/intel,ixp4xx-udc.yaml  |  39 ++
+ .../bindings/usb/nvidia,tegra20-ehci.txt           |  23 -
+ .../bindings/usb/renesas,rzg3e-xhci.yaml           |  87 +++
+ .../devicetree/bindings/usb/renesas,usbhs.yaml     |  28 +-
+ .../devicetree/bindings/usb/s3c2410-usb.txt        |  22 -
+ .../devicetree/bindings/usb/spacemit,k1-dwc3.yaml  | 121 ++++
+ .../devicetree/bindings/usb/ti,twl4030-usb.yaml    |  74 ++
+ .../devicetree/bindings/usb/ti,twl6030-usb.yaml    |  48 ++
+ .../devicetree/bindings/usb/twlxxxx-usb.txt        |  43 --
+ .../devicetree/bindings/usb/usb251xb.yaml          |   9 +-
+ MAINTAINERS                                        |  12 +-
+ drivers/gpio/Kconfig                               |  11 +
+ drivers/gpio/Makefile                              |   1 +
+ drivers/gpio/gpio-usbio.c                          | 247 +++++++
+ drivers/i2c/busses/Kconfig                         |  11 +
+ drivers/i2c/busses/Makefile                        |   1 +
+ drivers/i2c/busses/i2c-usbio.c                     | 320 +++++++++
+ drivers/media/usb/uvc/uvc_driver.c                 |   4 +-
+ drivers/media/usb/uvc/uvc_video.c                  |  24 +-
+ drivers/media/usb/uvc/uvcvideo.h                   |   4 +-
+ drivers/pci/quirks.c                               |   2 +-
+ drivers/thunderbolt/Kconfig                        |   4 +-
+ drivers/thunderbolt/acpi.c                         |  28 +-
+ drivers/thunderbolt/cap.c                          |  49 +-
+ drivers/thunderbolt/clx.c                          |  12 +-
+ drivers/thunderbolt/ctl.c                          |  33 +-
+ drivers/thunderbolt/ctl.h                          |   1 +
+ drivers/thunderbolt/debugfs.c                      |   3 +-
+ drivers/thunderbolt/dma_port.c                     |  21 +-
+ drivers/thunderbolt/domain.c                       |  73 +-
+ drivers/thunderbolt/eeprom.c                       |   4 +-
+ drivers/thunderbolt/lc.c                           |  58 +-
+ drivers/thunderbolt/nhi.c                          |  20 +-
+ drivers/thunderbolt/nhi_regs.h                     |   6 +
+ drivers/thunderbolt/nvm.c                          |  42 +-
+ drivers/thunderbolt/path.c                         |  14 +-
+ drivers/thunderbolt/property.c                     |  38 +-
+ drivers/thunderbolt/retimer.c                      |   7 +-
+ drivers/thunderbolt/switch.c                       | 140 ++--
+ drivers/thunderbolt/tb.c                           |  32 +-
+ drivers/thunderbolt/tb.h                           |  45 +-
+ drivers/thunderbolt/tmu.c                          |  16 +-
+ drivers/thunderbolt/tunnel.c                       |  90 ++-
+ drivers/thunderbolt/tunnel.h                       |   9 +-
+ drivers/thunderbolt/usb4.c                         | 346 +++++++---
+ drivers/thunderbolt/usb4_port.c                    |   7 +-
+ drivers/thunderbolt/xdomain.c                      |  53 +-
+ drivers/usb/cdns3/cdns3-trace.h                    |  61 --
+ drivers/usb/cdns3/cdnsp-gadget.c                   |   8 +-
+ drivers/usb/cdns3/cdnsp-pci.c                      |   5 +-
+ drivers/usb/cdns3/cdnsp-trace.h                    |  25 -
+ drivers/usb/class/usblp.c                          |   3 +-
+ drivers/usb/core/Makefile                          |   1 +
+ drivers/usb/core/config.c                          |   4 +-
+ drivers/usb/core/driver.c                          |  58 +-
+ drivers/usb/core/generic.c                         |   2 +-
+ drivers/usb/core/offload.c                         | 136 ++++
+ drivers/usb/core/urb.c                             |  14 +-
+ drivers/usb/core/usb.c                             |  51 ++
+ drivers/usb/dwc2/params.c                          |  26 +
+ drivers/usb/dwc3/Kconfig                           |  11 +
+ drivers/usb/dwc3/Makefile                          |   1 +
+ drivers/usb/dwc3/core.c                            |   2 +
+ drivers/usb/dwc3/core.h                            |  26 +
+ drivers/usb/dwc3/debug.h                           |  18 +
+ drivers/usb/dwc3/debugfs.c                         |  12 +-
+ drivers/usb/dwc3/drd.c                             |   1 +
+ drivers/usb/dwc3/dwc3-generic-plat.c               | 166 +++++
+ drivers/usb/dwc3/dwc3-qcom.c                       | 174 ++---
+ drivers/usb/dwc3/gadget.c                          |   1 +
+ drivers/usb/dwc3/trace.h                           |  17 +
+ drivers/usb/gadget/configfs.c                      |   2 +
+ drivers/usb/gadget/function/f_acm.c                |  42 +-
+ drivers/usb/gadget/function/f_ecm.c                |  48 +-
+ drivers/usb/gadget/function/f_fs.c                 |   8 +-
+ drivers/usb/gadget/function/f_hid.c                |   4 +-
+ drivers/usb/gadget/function/f_ncm.c                |  81 +--
+ drivers/usb/gadget/function/f_rndis.c              |  85 +--
+ drivers/usb/gadget/udc/cdns2/cdns2-trace.h         |  69 --
+ drivers/usb/gadget/udc/core.c                      |   4 +
+ drivers/usb/gadget/udc/tegra-xudc.c                |   3 +-
+ drivers/usb/gadget/udc/trace.h                     |   5 +
+ drivers/usb/host/Kconfig                           |   2 +-
+ drivers/usb/host/max3421-hcd.c                     |   2 +-
+ drivers/usb/host/ohci-s3c2410.c                    |   8 -
+ drivers/usb/host/xhci-caps.h                       |   2 +
+ drivers/usb/host/xhci-mem.c                        |  85 ++-
+ drivers/usb/host/xhci-pci.c                        |  44 +-
+ drivers/usb/host/xhci-plat.c                       |  57 +-
+ drivers/usb/host/xhci-plat.h                       |   2 +
+ drivers/usb/host/xhci-rcar-regs.h                  |  49 ++
+ drivers/usb/host/xhci-rcar.c                       | 100 +--
+ drivers/usb/host/xhci-ring.c                       |  30 +-
+ drivers/usb/host/xhci-rzg3e-regs.h                 |  12 +
+ drivers/usb/host/xhci-sideband.c                   |  36 +
+ drivers/usb/host/xhci-tegra.c                      |  84 ++-
+ drivers/usb/host/xhci-trace.h                      |  34 +-
+ drivers/usb/host/xhci.c                            |  16 +-
+ drivers/usb/host/xhci.h                            |   5 +-
+ drivers/usb/misc/Kconfig                           |  19 +-
+ drivers/usb/misc/Makefile                          |   1 +
+ drivers/usb/misc/qcom_eud.c                        |  36 +-
+ drivers/usb/misc/usb251xb.c                        | 108 ++-
+ drivers/usb/misc/usbio.c                           | 749 +++++++++++++++++++++
+ drivers/usb/mon/mon_bin.c                          |  14 +-
+ drivers/usb/musb/musb_dsps.c                       |   2 +-
+ drivers/usb/phy/phy-twl6030-usb.c                  |   3 +-
+ drivers/usb/renesas_usbhs/common.c                 |   4 +
+ drivers/usb/serial/option.c                        |   6 +
+ drivers/usb/serial/oti6858.c                       |   2 +-
+ drivers/usb/storage/realtek_cr.c                   |   4 +-
+ drivers/usb/typec/mux/tusb1046.c                   |   2 +-
+ .../usb/typec/tcpm/qcom/qcom_pmic_typec_pdphy.c    |   2 +-
+ drivers/usb/typec/tcpm/qcom/qcom_pmic_typec_port.c |   2 +-
+ drivers/usb/typec/tcpm/tcpci.c                     |  33 +
+ drivers/usb/typec/tipd/core.c                      | 559 +++++++++++++--
+ drivers/usb/typec/tipd/tps6598x.h                  |   5 +
+ drivers/usb/typec/tipd/trace.h                     |  39 ++
+ drivers/usb/typec/ucsi/debugfs.c                   |  31 +
+ drivers/usb/typec/ucsi/ucsi.c                      |  17 +
+ drivers/usb/typec/ucsi/ucsi.h                      |  13 +
+ drivers/usb/typec/ucsi/ucsi_stm32g0.c              |   7 +-
+ drivers/usb/usbip/vhci_hcd.c                       |  22 +
+ include/linux/thunderbolt.h                        |  25 +-
+ include/linux/usb.h                                |  24 +
+ include/linux/usb/gadget.h                         |  25 +
+ include/linux/usb/typec_mux.h                      |  46 +-
+ include/linux/usb/usbio.h                          | 177 +++++
+ include/linux/usb/xhci-sideband.h                  |   9 +
+ tools/usb/usbip/src/usbipd.c                       |   4 +-
+ 131 files changed, 4793 insertions(+), 1226 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/usb/intel,ixp4xx-udc.yaml
+ delete mode 100644 Documentation/devicetree/bindings/usb/nvidia,tegra20-ehci.txt
+ create mode 100644 Documentation/devicetree/bindings/usb/renesas,rzg3e-xhci.yaml
+ delete mode 100644 Documentation/devicetree/bindings/usb/s3c2410-usb.txt
+ create mode 100644 Documentation/devicetree/bindings/usb/spacemit,k1-dwc3.yaml
+ create mode 100644 Documentation/devicetree/bindings/usb/ti,twl4030-usb.yaml
+ create mode 100644 Documentation/devicetree/bindings/usb/ti,twl6030-usb.yaml
+ delete mode 100644 Documentation/devicetree/bindings/usb/twlxxxx-usb.txt
+ create mode 100644 drivers/gpio/gpio-usbio.c
+ create mode 100644 drivers/i2c/busses/i2c-usbio.c
+ create mode 100644 drivers/usb/core/offload.c
+ create mode 100644 drivers/usb/dwc3/dwc3-generic-plat.c
+ create mode 100644 drivers/usb/host/xhci-rcar-regs.h
+ create mode 100644 drivers/usb/host/xhci-rzg3e-regs.h
+ create mode 100644 drivers/usb/misc/usbio.c
+ create mode 100644 include/linux/usb/usbio.h
+Merging thunderbolt/next (67600ccfc4f38 thunderbolt: Fix use-after-free in tb_dp_dprx_work)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/westeri/thunderbolt.git thunderbolt/next
+Already up to date.
+Merging usb-serial/usb-next (0e0ba0ecec3d6 USB: serial: option: add SIMCom 8230C compositions)
+$ git merge -m Merge branch 'usb-next' of https://git.kernel.org/pub/scm/linux/kernel/git/johan/usb-serial.git usb-serial/usb-next
+Already up to date.
+Merging tty/tty-next (f4abab350840d tty: serial: fix help message for SERIAL_CPM)
+$ git merge -m Merge branch 'tty-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/tty.git tty/tty-next
+Auto-merging drivers/tty/serial/Kconfig
+Auto-merging drivers/tty/serial/qcom_geni_serial.c
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/serial/8250_omap.yaml      |  16 +
+ arch/mips/sgi-ip22/ip22-platform.c                 |  32 ++
+ drivers/s390/char/con3270.c                        |  18 +-
+ drivers/tty/hvc/hvc_console.c                      |   2 +-
+ drivers/tty/mxser.c                                | 265 ++++++---------
+ drivers/tty/n_gsm.c                                |  25 +-
+ drivers/tty/serdev/core.c                          |  11 +-
+ drivers/tty/serial/8250/8250.h                     |   5 +
+ drivers/tty/serial/8250/8250_core.c                |  93 +++---
+ drivers/tty/serial/8250/8250_omap.c                | 183 ++++++-----
+ drivers/tty/serial/8250/8250_platform.c            |  87 ++---
+ drivers/tty/serial/8250/8250_port.c                | 300 +++++++----------
+ drivers/tty/serial/8250/8250_rsa.c                 |   7 +-
+ drivers/tty/serial/Kconfig                         |  12 +-
+ drivers/tty/serial/ip22zilog.c                     | 360 +++++++++------------
+ drivers/tty/serial/max3100.c                       |   2 +-
+ drivers/tty/serial/max310x.c                       |  28 +-
+ drivers/tty/serial/msm_serial.c                    |   2 +-
+ drivers/tty/serial/mvebu-uart.c                    |  10 +-
+ drivers/tty/serial/qcom_geni_serial.c              | 147 +++------
+ drivers/tty/serial/sc16is7xx.c                     |   2 +-
+ drivers/tty/serial/serial_core.c                   | 143 ++++----
+ drivers/tty/sysrq.c                                |   3 +-
+ drivers/tty/tty_port.c                             | 168 +++++-----
+ drivers/tty/vt/consolemap.c                        | 116 +++----
+ drivers/tty/vt/selection.c                         |  20 +-
+ drivers/tty/vt/vc_screen.c                         |  74 ++---
+ drivers/tty/vt/vt.c                                | 247 +++++++-------
+ drivers/tty/vt/vt_ioctl.c                          | 194 +++++------
+ include/linux/console.h                            |   2 +
+ include/linux/console_struct.h                     |   3 +
+ include/linux/serial_core.h                        |  13 +
+ include/linux/tty_port.h                           |  14 +
+ 33 files changed, 1201 insertions(+), 1403 deletions(-)
+Merging char-misc/char-misc-next (22d693e45d4a4 rust: usb: keep usb::Device private for now)
+$ git merge -m Merge branch 'char-misc-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/char-misc.git char-misc/char-misc-next
+Auto-merging Documentation/devicetree/bindings/trivial-devices.yaml
+Auto-merging MAINTAINERS
+Auto-merging drivers/hwtracing/coresight/coresight-trbe.c
+Auto-merging drivers/misc/fastrpc.c
+Auto-merging drivers/misc/ibmasm/ibmasmfs.c
+Auto-merging drivers/misc/mei/bus.c
+Auto-merging rust/bindings/bindings_helper.h
+Auto-merging rust/helpers/helpers.c
+CONFLICT (content): Merge conflict in rust/helpers/helpers.c
+Auto-merging rust/kernel/cred.rs
+Auto-merging rust/kernel/lib.rs
+CONFLICT (content): Merge conflict in rust/kernel/lib.rs
+Auto-merging rust/kernel/page.rs
+Auto-merging rust/uapi/uapi_helper.h
+CONFLICT (content): Merge conflict in rust/uapi/uapi_helper.h
+Auto-merging samples/rust/Kconfig
+Auto-merging samples/rust/Makefile
+Resolved 'rust/helpers/helpers.c' using previous resolution.
+Resolved 'rust/kernel/lib.rs' using previous resolution.
+Resolved 'rust/uapi/uapi_helper.h' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master aea07f3f30e63] Merge branch 'char-misc-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/char-misc.git
+$ git diff -M --stat --summary HEAD^..
+ .../ABI/testing/sysfs-bus-coresight-devices-cti    |    6 +
+ .../sysfs-bus-coresight-devices-dummy-source       |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-etb10  |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-etm3x  |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-etm4x  |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-funnel |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-stm    |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-tmc    |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-tpdm   |    6 +
+ .../ABI/testing/sysfs-bus-coresight-devices-trbe   |    6 +
+ Documentation/ABI/testing/sysfs-bus-counter        |    8 +-
+ .../ABI/testing/sysfs-bus-i2c-devices-m24lr        |  100 +
+ Documentation/ABI/testing/sysfs-bus-iio            |   56 +-
+ Documentation/ABI/testing/sysfs-bus-iio-cros-ec    |   10 -
+ .../devicetree/bindings/arm/arm,coresight-cti.yaml |    4 +
+ .../bindings/arm/arm,coresight-dummy-sink.yaml     |    4 +
+ .../bindings/arm/arm,coresight-dummy-source.yaml   |    4 +
+ .../bindings/arm/arm,coresight-dynamic-funnel.yaml |    4 +
+ .../arm/arm,coresight-dynamic-replicator.yaml      |    4 +
+ .../bindings/arm/arm,coresight-etb10.yaml          |    4 +
+ .../devicetree/bindings/arm/arm,coresight-etm.yaml |    4 +
+ .../bindings/arm/arm,coresight-static-funnel.yaml  |    4 +
+ .../arm/arm,coresight-static-replicator.yaml       |    4 +
+ .../devicetree/bindings/arm/arm,coresight-tmc.yaml |    4 +
+ .../bindings/arm/arm,coresight-tpiu.yaml           |    4 +
+ .../bindings/arm/qcom,coresight-ctcu.yaml          |    4 +
+ .../bindings/arm/qcom,coresight-remote-etm.yaml    |    4 +
+ .../bindings/arm/qcom,coresight-tnoc.yaml          |  113 +
+ .../bindings/arm/qcom,coresight-tpda.yaml          |    4 +
+ .../bindings/arm/qcom,coresight-tpdm.yaml          |    4 +
+ Documentation/devicetree/bindings/eeprom/at25.yaml |    8 +
+ .../devicetree/bindings/eeprom/st,m24lr.yaml       |   52 +
+ .../devicetree/bindings/extcon/extcon-rt8973a.txt  |   23 -
+ .../bindings/extcon/linux,extcon-usb-gpio.yaml     |    6 +
+ .../devicetree/bindings/extcon/maxim,max14526.yaml |   80 +
+ .../bindings/extcon/richtek,rt8973a-muic.yaml      |   49 +
+ .../bindings/iio/accel/adi,adis16240.yaml          |    4 +-
+ .../devicetree/bindings/iio/accel/adi,adxl313.yaml |    2 -
+ .../devicetree/bindings/iio/accel/adi,adxl345.yaml |    2 -
+ .../devicetree/bindings/iio/accel/adi,adxl355.yaml |    2 -
+ .../devicetree/bindings/iio/accel/adi,adxl372.yaml |    5 +-
+ .../bindings/iio/accel/bosch,bma255.yaml           |    1 -
+ .../bindings/iio/accel/bosch,bma400.yaml           |    1 -
+ .../bindings/iio/accel/kionix,kxsd9.yaml           |    1 -
+ .../devicetree/bindings/iio/adc/adi,ad7091r5.yaml  |    1 -
+ .../devicetree/bindings/iio/adc/adi,ad7124.yaml    |   24 +-
+ .../devicetree/bindings/iio/adc/adi,ad7173.yaml    |    1 -
+ .../devicetree/bindings/iio/adc/adi,ad7476.yaml    |  102 +-
+ .../devicetree/bindings/iio/adc/adi,ad7779.yaml    |   44 +-
+ .../devicetree/bindings/iio/adc/adi,ade9000.yaml   |   95 +
+ .../devicetree/bindings/iio/adc/lltc,ltc2496.yaml  |    1 -
+ .../devicetree/bindings/iio/adc/maxim,max1238.yaml |    3 +
+ .../devicetree/bindings/iio/adc/maxim,max1241.yaml |    2 +-
+ .../bindings/iio/adc/qcom,spmi-vadc.yaml           |    1 -
+ .../bindings/iio/adc/rockchip-saradc.yaml          |    3 +
+ .../devicetree/bindings/iio/adc/rohm,bd79104.yaml  |   11 +-
+ .../devicetree/bindings/iio/adc/rohm,bd79112.yaml  |  104 +
+ .../devicetree/bindings/iio/adc/rohm,bd79124.yaml  |    2 +-
+ .../bindings/iio/adc/samsung,exynos-adc.yaml       |   33 +-
+ .../devicetree/bindings/iio/adc/ti,adc128s052.yaml |    1 -
+ .../devicetree/bindings/iio/adc/ti,ads1298.yaml    |    1 -
+ .../bindings/iio/adc/xlnx,zynqmp-ams.yaml          |    3 +-
+ .../bindings/iio/afe/current-sense-amplifier.yaml  |    4 +
+ .../devicetree/bindings/iio/dac/adi,ad5770r.yaml   |    3 +-
+ .../devicetree/bindings/iio/dac/adi,ltc2664.yaml   |    2 +-
+ .../devicetree/bindings/iio/frequency/adf4371.yaml |    3 +-
+ .../devicetree/bindings/iio/imu/adi,adis16460.yaml |    1 -
+ .../devicetree/bindings/iio/imu/adi,adis16480.yaml |    3 +-
+ .../bindings/iio/imu/invensense,icm42600.yaml      |    2 -
+ .../devicetree/bindings/iio/imu/nxp,fxos8700.yaml  |    2 -
+ .../bindings/iio/light/dynaimage,al3010.yaml       |    2 +-
+ .../bindings/iio/light/dynaimage,al3320a.yaml      |    2 +-
+ .../devicetree/bindings/iio/light/st,vl6180.yaml   |    1 -
+ .../bindings/iio/light/vishay,veml6046x00.yaml     |   51 +
+ .../iio/magnetometer/infineon,tlv493d-a1b6.yaml    |   45 +
+ .../iio/magnetometer/voltafield,af8133j.yaml       |    1 -
+ .../devicetree/bindings/iio/pressure/bmp085.yaml   |    1 -
+ .../bindings/iio/pressure/invensense,icp10100.yaml |   52 +
+ .../iio/temperature/microchip,mcp9600.yaml         |   56 +-
+ .../bindings/interconnect/qcom,glymur-rpmh.yaml    |  172 ++
+ .../bindings/interconnect/qcom,osm-l3.yaml         |    5 +
+ .../bindings/mfd/marvell,88pm886-a1.yaml           |    4 +
+ .../devicetree/bindings/misc/qcom,fastrpc.yaml     |    2 +
+ .../bindings/nvmem/airoha,an8855-efuse.yaml        |  123 +
+ .../bindings/nvmem/layouts/kontron,sl28-vpd.yaml   |    7 +-
+ .../bindings/nvmem/nxp,s32g-ocotp-nvmem.yaml       |   45 +
+ .../devicetree/bindings/slimbus/qcom,slim.yaml     |   86 -
+ .../devicetree/bindings/slimbus/slimbus.yaml       |   13 +-
+ .../devicetree/bindings/trivial-devices.yaml       |    2 -
+ .../devicetree/bindings/w1/fsl-imx-owire.yaml      |    4 +
+ Documentation/iio/ad3552r.rst                      |    3 +-
+ Documentation/iio/ade9000.rst                      |  268 +++
+ Documentation/iio/adxl345.rst                      |  443 ++++
+ Documentation/iio/bno055.rst                       |   12 +-
+ Documentation/iio/index.rst                        |    2 +
+ Documentation/netlink/specs/binder.yaml            |   93 +
+ MAINTAINERS                                        |   35 +-
+ arch/sparc/kernel/apc.c                            |    3 +-
+ drivers/android/Kconfig                            |   16 +-
+ drivers/android/Makefile                           |    3 +-
+ drivers/android/binder.c                           |  160 +-
+ drivers/android/binder/Makefile                    |    9 +
+ drivers/android/binder/allocation.rs               |  602 +++++
+ drivers/android/binder/context.rs                  |  180 ++
+ drivers/android/binder/deferred_close.rs           |  204 ++
+ drivers/android/binder/defs.rs                     |  182 ++
+ drivers/android/binder/error.rs                    |   99 +
+ drivers/android/binder/freeze.rs                   |  388 +++
+ drivers/android/binder/node.rs                     | 1131 +++++++++
+ drivers/android/binder/node/wrapper.rs             |   78 +
+ drivers/android/binder/page_range.rs               |  734 ++++++
+ drivers/android/binder/page_range_helper.c         |   24 +
+ drivers/android/binder/page_range_helper.h         |   15 +
+ drivers/android/binder/process.rs                  | 1696 +++++++++++++
+ drivers/android/binder/range_alloc/array.rs        |  251 ++
+ drivers/android/binder/range_alloc/mod.rs          |  329 +++
+ drivers/android/binder/range_alloc/tree.rs         |  488 ++++
+ drivers/android/binder/rust_binder.h               |   23 +
+ drivers/android/binder/rust_binder_events.c        |   59 +
+ drivers/android/binder/rust_binder_events.h        |   36 +
+ drivers/android/binder/rust_binder_internal.h      |   87 +
+ drivers/android/binder/rust_binder_main.rs         |  627 +++++
+ drivers/android/binder/rust_binderfs.c             |  850 +++++++
+ drivers/android/binder/stats.rs                    |   89 +
+ drivers/android/binder/thread.rs                   | 1596 ++++++++++++
+ drivers/android/binder/trace.rs                    |   16 +
+ drivers/android/binder/transaction.rs              |  456 ++++
+ drivers/android/binder_internal.h                  |    4 +-
+ drivers/android/binder_netlink.c                   |   31 +
+ drivers/android/binder_netlink.h                   |   20 +
+ drivers/android/binder_trace.h                     |   37 +
+ drivers/android/binderfs.c                         |    8 +
+ drivers/android/dbitmap.h                          |    1 +
+ drivers/bus/mhi/ep/main.c                          |   37 +-
+ drivers/bus/mhi/host/init.c                        |    5 +-
+ drivers/bus/mhi/host/internal.h                    |    3 +
+ drivers/bus/mhi/host/main.c                        |    1 +
+ drivers/bus/mhi/host/pci_generic.c                 |   85 +-
+ drivers/bus/mhi/host/pm.c                          |   29 +-
+ drivers/cdx/cdx_msi.c                              |    1 +
+ drivers/char/Makefile                              |    1 +
+ drivers/char/adi.c                                 |    2 +-
+ drivers/char/hpet.c                                |    2 +-
+ drivers/char/misc.c                                |   21 +-
+ drivers/{misc => char}/misc_minor_kunit.c          |   95 +-
+ drivers/comedi/Kconfig                             |    9 +
+ drivers/comedi/drivers/Makefile                    |    1 +
+ drivers/comedi/drivers/adl_pci7250.c               |  220 ++
+ drivers/counter/ti-ecap-capture.c                  |   12 +-
+ drivers/extcon/Kconfig                             |   13 +
+ drivers/extcon/Makefile                            |    1 +
+ drivers/extcon/extcon-adc-jack.c                   |    2 +
+ drivers/extcon/extcon-axp288.c                     |    2 +-
+ drivers/extcon/extcon-fsa9480.c                    |    2 +-
+ drivers/extcon/extcon-max14526.c                   |  302 +++
+ drivers/extcon/extcon-qcom-spmi-misc.c             |    2 +-
+ drivers/greybus/svc.c                              |    3 +-
+ drivers/hwtracing/coresight/Kconfig                |   12 +
+ drivers/hwtracing/coresight/Makefile               |    1 +
+ drivers/hwtracing/coresight/coresight-catu.c       |   53 +-
+ drivers/hwtracing/coresight/coresight-catu.h       |    1 +
+ drivers/hwtracing/coresight/coresight-core.c       |   54 +-
+ drivers/hwtracing/coresight/coresight-cpu-debug.c  |   41 +-
+ drivers/hwtracing/coresight/coresight-ctcu-core.c  |   24 +-
+ drivers/hwtracing/coresight/coresight-etb10.c      |   18 +-
+ drivers/hwtracing/coresight/coresight-etm-perf.c   |    4 +-
+ drivers/hwtracing/coresight/coresight-etm3x-core.c |   17 +-
+ drivers/hwtracing/coresight/coresight-etm4x-core.c |   44 +-
+ .../hwtracing/coresight/coresight-etm4x-sysfs.c    |    1 +
+ drivers/hwtracing/coresight/coresight-etm4x.h      |    6 +-
+ drivers/hwtracing/coresight/coresight-funnel.c     |   66 +-
+ drivers/hwtracing/coresight/coresight-replicator.c |   63 +-
+ drivers/hwtracing/coresight/coresight-stm.c        |   42 +-
+ drivers/hwtracing/coresight/coresight-syscfg.c     |    2 +-
+ drivers/hwtracing/coresight/coresight-sysfs.c      |   71 +-
+ drivers/hwtracing/coresight/coresight-tmc-core.c   |   70 +-
+ drivers/hwtracing/coresight/coresight-tmc.h        |    2 +
+ drivers/hwtracing/coresight/coresight-tnoc.c       |  246 ++
+ drivers/hwtracing/coresight/coresight-tpda.c       |    3 +
+ drivers/hwtracing/coresight/coresight-tpiu.c       |   36 +-
+ drivers/hwtracing/coresight/coresight-trbe.c       |    9 +-
+ drivers/hwtracing/coresight/ultrasoc-smb.h         |    1 +
+ drivers/iio/accel/adxl345_core.c                   |  782 +++++-
+ drivers/iio/accel/bma180.c                         |   13 +-
+ drivers/iio/accel/bma220_spi.c                     |    4 +-
+ drivers/iio/accel/bmc150-accel-core.c              |    7 +-
+ drivers/iio/accel/bmi088-accel-core.c              |    3 -
+ drivers/iio/accel/dmard06.c                        |    4 +-
+ drivers/iio/accel/dmard09.c                        |    4 +-
+ drivers/iio/accel/dmard10.c                        |    4 +-
+ drivers/iio/accel/fxls8962af-core.c                |    1 -
+ drivers/iio/accel/kxcjk-1013.c                     |    4 +-
+ drivers/iio/accel/kxsd9.c                          |    3 -
+ drivers/iio/accel/mc3230.c                         |    4 +-
+ drivers/iio/accel/mma7660.c                        |    4 +-
+ drivers/iio/accel/mma8452.c                        |    7 +-
+ drivers/iio/accel/mma9551_core.c                   |    5 +-
+ drivers/iio/accel/msa311.c                         |   16 +-
+ drivers/iio/accel/stk8312.c                        |    4 +-
+ drivers/iio/accel/stk8ba50.c                       |    4 +-
+ drivers/iio/adc/88pm886-gpadc.c                    |  393 +++
+ drivers/iio/adc/Kconfig                            |   54 +
+ drivers/iio/adc/Makefile                           |    4 +
+ drivers/iio/adc/ab8500-gpadc.c                     |    1 -
+ drivers/iio/adc/ad4130.c                           |    3 +-
+ drivers/iio/adc/ad7124.c                           |  563 ++++-
+ drivers/iio/adc/ad7173.c                           |  221 +-
+ drivers/iio/adc/ad7476.c                           |  461 ++--
+ drivers/iio/adc/ad7768-1.c                         |   37 +-
+ drivers/iio/adc/ad7779.c                           |  192 +-
+ drivers/iio/adc/ad7949.c                           |    4 +-
+ drivers/iio/adc/ad799x.c                           |   30 +-
+ drivers/iio/adc/ade9000.c                          | 1799 ++++++++++++++
+ drivers/iio/adc/adi-axi-adc.c                      |    1 +
+ drivers/iio/adc/at91-sama5d2_adc.c                 |   13 +-
+ drivers/iio/adc/bcm_iproc_adc.c                    |    4 +-
+ drivers/iio/adc/cpcap-adc.c                        |    6 +-
+ drivers/iio/adc/da9150-gpadc.c                     |    5 +-
+ drivers/iio/adc/dln2-adc.c                         |    9 +-
+ drivers/iio/adc/exynos_adc.c                       |  286 +--
+ drivers/iio/adc/hx711.c                            |    2 +-
+ drivers/iio/adc/imx7d_adc.c                        |    4 +-
+ drivers/iio/adc/imx8qxp-adc.c                      |    6 +-
+ drivers/iio/adc/imx93_adc.c                        |   26 +-
+ drivers/iio/adc/intel_dc_ti_adc.c                  |  328 +++
+ drivers/iio/adc/mcp3564.c                          |    2 +-
+ drivers/iio/adc/meson_saradc.c                     |    2 +-
+ drivers/iio/adc/mt6577_auxadc.c                    |    3 +-
+ drivers/iio/adc/mxs-lradc-adc.c                    |    4 +-
+ drivers/iio/adc/pac1921.c                          |    3 +-
+ drivers/iio/adc/pac1934.c                          |   11 +-
+ drivers/iio/adc/palmas_gpadc.c                     |    4 +-
+ drivers/iio/adc/rcar-gyroadc.c                     |    8 +-
+ drivers/iio/adc/rn5t618-adc.c                      |    4 +-
+ drivers/iio/adc/rockchip_saradc.c                  |    6 +-
+ drivers/iio/adc/rohm-bd79112.c                     |  556 +++++
+ drivers/iio/adc/rzg2l_adc.c                        |    2 -
+ drivers/iio/adc/spear_adc.c                        |   12 +-
+ drivers/iio/adc/stm32-adc-core.c                   |    1 -
+ drivers/iio/adc/stm32-adc.c                        |    7 -
+ drivers/iio/adc/stm32-dfsdm-adc.c                  |    4 +-
+ drivers/iio/adc/stmpe-adc.c                        |    4 +-
+ drivers/iio/adc/sun4i-gpadc-iio.c                  |    3 -
+ drivers/iio/adc/ti-adc081c.c                       |   40 +-
+ drivers/iio/adc/ti-adc084s021.c                    |    4 +-
+ drivers/iio/adc/ti-adc12138.c                      |   30 +-
+ drivers/iio/adc/ti-adc128s052.c                    |  140 +-
+ drivers/iio/adc/ti-ads1015.c                       |    6 +-
+ drivers/iio/adc/ti-ads1100.c                       |    1 -
+ drivers/iio/adc/ti-ads1119.c                       |   11 +-
+ drivers/iio/adc/ti-ads131e08.c                     |    8 +-
+ drivers/iio/adc/ti-ads7924.c                       |    9 +-
+ drivers/iio/adc/ti-tsc2046.c                       |    6 +-
+ drivers/iio/adc/ti_am335x_adc.c                    |    5 +-
+ drivers/iio/adc/twl4030-madc.c                     |    4 +-
+ drivers/iio/adc/vf610_adc.c                        |    2 +-
+ drivers/iio/adc/viperboard_adc.c                   |    4 +-
+ drivers/iio/buffer/industrialio-buffer-cb.c        |    1 -
+ drivers/iio/chemical/atlas-sensor.c                |    2 -
+ drivers/iio/chemical/bme680_core.c                 |    3 -
+ drivers/iio/chemical/ens160_core.c                 |    3 +-
+ drivers/iio/chemical/scd30_core.c                  |    2 +-
+ .../iio/common/hid-sensors/hid-sensor-trigger.c    |    1 -
+ drivers/iio/common/scmi_sensors/scmi_iio.c         |   10 +-
+ drivers/iio/dac/ad5380.c                           |    4 +-
+ drivers/iio/dac/ad5764.c                           |    4 +-
+ drivers/iio/dac/ad5791.c                           |    4 -
+ drivers/iio/dac/ds4424.c                           |    4 +-
+ drivers/iio/dac/stm32-dac.c                        |   19 +-
+ drivers/iio/dac/ti-dac7311.c                       |    4 +-
+ drivers/iio/frequency/adf4350.c                    |    3 +-
+ drivers/iio/gyro/bmg160_core.c                     |    4 +-
+ drivers/iio/gyro/fxas21002c_core.c                 |    2 -
+ drivers/iio/gyro/mpu3050-core.c                    |    3 -
+ drivers/iio/gyro/mpu3050-i2c.c                     |    1 -
+ drivers/iio/health/afe4403.c                       |   48 +-
+ drivers/iio/health/afe4404.c                       |   48 +-
+ drivers/iio/humidity/am2315.c                      |    4 +-
+ drivers/iio/humidity/dht11.c                       |    4 +-
+ drivers/iio/imu/adis16475.c                        |    1 -
+ drivers/iio/imu/bmi270/bmi270_i2c.c                |    2 +
+ drivers/iio/imu/bmi323/bmi323_core.c               |    3 +-
+ drivers/iio/imu/inv_icm42600/inv_icm42600.h        |    1 -
+ drivers/iio/imu/inv_icm42600/inv_icm42600_accel.c  |   29 +-
+ drivers/iio/imu/inv_icm42600/inv_icm42600_buffer.c |   65 +-
+ drivers/iio/imu/inv_icm42600/inv_icm42600_core.c   |  117 +-
+ drivers/iio/imu/inv_icm42600/inv_icm42600_gyro.c   |   29 +-
+ drivers/iio/imu/inv_icm42600/inv_icm42600_temp.c   |    1 -
+ drivers/iio/imu/inv_mpu6050/inv_mpu_core.c         |    6 -
+ drivers/iio/imu/inv_mpu6050/inv_mpu_trigger.c      |    1 -
+ drivers/iio/imu/kmx61.c                            |    6 +-
+ drivers/iio/imu/st_lsm6dsx/st_lsm6dsx_core.c       |   14 +-
+ drivers/iio/industrialio-core.c                    |   11 +-
+ drivers/iio/inkern.c                               |   81 +-
+ drivers/iio/light/Kconfig                          |   13 +
+ drivers/iio/light/Makefile                         |    1 +
+ drivers/iio/light/acpi-als.c                       |   19 +-
+ drivers/iio/light/adjd_s311.c                      |   12 +-
+ drivers/iio/light/al3000a.c                        |    2 +-
+ drivers/iio/light/apds9306.c                       |    4 +-
+ drivers/iio/light/apds9960.c                       |    1 -
+ drivers/iio/light/bh1745.c                         |    7 +-
+ drivers/iio/light/bh1780.c                         |    1 -
+ drivers/iio/light/gp2ap002.c                       |    2 -
+ drivers/iio/light/hid-sensor-als.c                 |    5 +-
+ drivers/iio/light/isl29028.c                       |   11 +-
+ drivers/iio/light/isl29125.c                       |   14 +-
+ drivers/iio/light/ltr390.c                         |  197 +-
+ drivers/iio/light/ltr501.c                         |    4 +-
+ drivers/iio/light/ltrf216a.c                       |    1 -
+ drivers/iio/light/max44000.c                       |   18 +-
+ drivers/iio/light/opt4001.c                        |    3 +-
+ drivers/iio/light/opt4060.c                        |    7 +-
+ drivers/iio/light/pa12203001.c                     |   11 +-
+ drivers/iio/light/rohm-bu27034.c                   |    3 +-
+ drivers/iio/light/rpr0521.c                        |   10 +-
+ drivers/iio/light/si1145.c                         |    5 +-
+ drivers/iio/light/st_uvis25.h                      |    5 -
+ drivers/iio/light/st_uvis25_core.c                 |   12 +-
+ drivers/iio/light/stk3310.c                        |    4 +-
+ drivers/iio/light/tcs3414.c                        |   15 +-
+ drivers/iio/light/tcs3472.c                        |   14 +-
+ drivers/iio/light/tsl2583.c                        |   12 +-
+ drivers/iio/light/tsl2591.c                        |    2 -
+ drivers/iio/light/us5182d.c                        |   12 +-
+ drivers/iio/light/vcnl4000.c                       |   22 +-
+ drivers/iio/light/vcnl4035.c                       |   11 +-
+ drivers/iio/light/veml6030.c                       |    2 +-
+ drivers/iio/light/veml6040.c                       |    3 +-
+ drivers/iio/light/veml6046x00.c                    | 1030 ++++++++
+ drivers/iio/light/vl6180.c                         |   16 +-
+ drivers/iio/magnetometer/Kconfig                   |   15 +-
+ drivers/iio/magnetometer/Makefile                  |    2 +
+ drivers/iio/magnetometer/ak8974.c                  |    2 -
+ drivers/iio/magnetometer/ak8975.c                  |    1 -
+ drivers/iio/magnetometer/als31300.c                |    5 +-
+ drivers/iio/magnetometer/bmc150_magn.c             |   13 +-
+ drivers/iio/magnetometer/tlv493d.c                 |  526 ++++
+ drivers/iio/magnetometer/tmag5273.c                |    5 +-
+ drivers/iio/magnetometer/yamaha-yas530.c           |    2 -
+ drivers/iio/potentiostat/lmp91000.c                |    4 +-
+ drivers/iio/pressure/bmp280-core.c                 |    8 +-
+ drivers/iio/pressure/dlhl60d.c                     |    4 +-
+ drivers/iio/pressure/icp10100.c                    |    1 -
+ drivers/iio/pressure/mpl115.c                      |    2 -
+ drivers/iio/pressure/zpa2326.c                     |    2 -
+ drivers/iio/proximity/d3323aa.c                    |    3 +-
+ drivers/iio/proximity/hx9023s.c                    |    3 +-
+ drivers/iio/proximity/irsd200.c                    |    6 +-
+ drivers/iio/proximity/mb1232.c                     |   15 +-
+ drivers/iio/proximity/ping.c                       |    4 +-
+ drivers/iio/proximity/pulsedlight-lidar-lite-v2.c  |   16 +-
+ drivers/iio/proximity/srf04.c                      |    8 +-
+ drivers/iio/proximity/srf08.c                      |   18 +-
+ drivers/iio/proximity/sx9500.c                     |   27 +-
+ drivers/iio/proximity/vl53l0x-i2c.c                |   27 +-
+ drivers/iio/temperature/Kconfig                    |    8 +-
+ drivers/iio/temperature/mcp9600.c                  |  151 +-
+ drivers/iio/temperature/mlx90614.c                 |    1 -
+ drivers/iio/temperature/mlx90632.c                 |    5 +-
+ drivers/iio/temperature/mlx90635.c                 |    9 +-
+ drivers/iio/test/Kconfig                           |   12 +
+ drivers/iio/test/Makefile                          |    1 +
+ drivers/iio/test/iio-test-multiply.c               |  212 ++
+ drivers/interconnect/core.c                        |    2 +-
+ drivers/interconnect/qcom/Kconfig                  |    9 +
+ drivers/interconnect/qcom/Makefile                 |    2 +
+ drivers/interconnect/qcom/glymur.c                 | 2543 ++++++++++++++++++++
+ drivers/interconnect/qcom/icc-rpmh.h               |    2 +-
+ drivers/misc/Makefile                              |    1 -
+ drivers/misc/ad525x_dpot.c                         |    7 +-
+ drivers/misc/amd-sbi/Kconfig                       |    1 +
+ drivers/misc/apds990x.c                            |    1 -
+ drivers/misc/cardreader/rts5227.c                  |   13 +-
+ drivers/misc/cardreader/rts5228.c                  |   12 +-
+ drivers/misc/cardreader/rts5249.c                  |   16 +-
+ drivers/misc/cardreader/rts5264.c                  |   20 +-
+ drivers/misc/cardreader/rts5264.h                  |    1 +
+ drivers/misc/cardreader/rtsx_pcr.h                 |    2 +
+ drivers/misc/dw-xdata-pcie.c                       |    5 +-
+ drivers/misc/eeprom/Kconfig                        |   18 +
+ drivers/misc/eeprom/Makefile                       |    1 +
+ drivers/misc/eeprom/at25.c                         |   67 +-
+ drivers/misc/eeprom/m24lr.c                        |  606 +++++
+ drivers/misc/fastrpc.c                             |   54 +-
+ drivers/misc/genwqe/card_ddcb.c                    |    2 +-
+ drivers/misc/hisi_hikey_usb.c                      |    3 +-
+ drivers/misc/ibmasm/ibmasmfs.c                     |   12 +-
+ drivers/misc/lis3lv02d/Kconfig                     |    4 +-
+ drivers/misc/mei/bus-fixup.c                       |    6 +-
+ drivers/misc/mei/bus.c                             |   26 +-
+ drivers/misc/mei/client.c                          |   82 +-
+ drivers/misc/mei/client.h                          |    6 +-
+ drivers/misc/mei/dma-ring.c                        |    8 +-
+ drivers/misc/mei/gsc-me.c                          |   20 +-
+ drivers/misc/mei/hbm.c                             |  121 +-
+ drivers/misc/mei/hw-me.c                           |  153 +-
+ drivers/misc/mei/hw-txe.c                          |   60 +-
+ drivers/misc/mei/hw.h                              |    2 +
+ drivers/misc/mei/init.c                            |   66 +-
+ drivers/misc/mei/interrupt.c                       |   45 +-
+ drivers/misc/mei/main.c                            |  139 +-
+ drivers/misc/mei/mei_dev.h                         |   24 +-
+ drivers/misc/mei/pci-me.c                          |   20 +-
+ drivers/misc/mei/pci-txe.c                         |    4 +-
+ drivers/misc/mei/platform-vsc.c                    |   26 +-
+ drivers/nvmem/Kconfig                              |   21 +
+ drivers/nvmem/Makefile                             |    4 +
+ drivers/nvmem/an8855-efuse.c                       |   68 +
+ drivers/nvmem/s32g-ocotp-nvmem.c                   |  100 +
+ drivers/parisc/eisa_eeprom.c                       |    2 -
+ drivers/peci/controller/peci-npcm.c                |    1 -
+ drivers/pps/kapi.c                                 |    5 +-
+ drivers/pps/pps.c                                  |    5 +-
+ drivers/siox/siox-bus-gpio.c                       |    3 +-
+ drivers/slimbus/Kconfig                            |    7 -
+ drivers/slimbus/Makefile                           |    3 -
+ drivers/slimbus/messaging.c                        |    4 +-
+ drivers/slimbus/qcom-ctrl.c                        |  735 ------
+ drivers/staging/iio/adc/ad7816.c                   |    2 -
+ drivers/uio/uio_aec.c                              |    2 +-
+ drivers/uio/uio_cif.c                              |    2 +-
+ drivers/uio/uio_dmem_genirq.c                      |   23 -
+ drivers/uio/uio_hv_generic.c                       |    7 +-
+ drivers/uio/uio_netx.c                             |    2 +-
+ drivers/uio/uio_pdrv_genirq.c                      |   24 -
+ drivers/uio/uio_sercos3.c                          |    2 +-
+ drivers/w1/masters/matrox_w1.c                     |   10 +-
+ .../dt-bindings/interconnect/qcom,glymur-rpmh.h    |  205 ++
+ include/linux/coresight.h                          |   31 +-
+ include/linux/iio/consumer.h                       |   18 +
+ include/linux/iio/iio.h                            |   20 +-
+ include/linux/iio/types.h                          |    1 +
+ include/linux/mfd/88pm886.h                        |   58 +
+ include/linux/miscdevice.h                         |    9 +
+ include/linux/platform_data/touchscreen-s3c2410.h  |   22 -
+ include/linux/rtsx_pci.h                           |    2 +
+ include/uapi/linux/android/binder.h                |    2 +-
+ include/uapi/linux/android/binder_netlink.h        |   37 +
+ include/uapi/linux/iio/types.h                     |    5 +
+ include/uapi/misc/fastrpc.h                        |    2 +-
+ rust/bindings/bindings_helper.h                    |    8 +
+ rust/helpers/binder.c                              |   26 +
+ rust/helpers/helpers.c                             |    1 +
+ rust/helpers/page.c                                |    8 +
+ rust/helpers/security.c                            |   24 +
+ rust/helpers/usb.c                                 |    8 +
+ rust/kernel/cred.rs                                |    6 +
+ rust/kernel/fs.rs                                  |    3 +
+ rust/kernel/fs/kiocb.rs                            |   68 +
+ rust/kernel/iov.rs                                 |  314 +++
+ rust/kernel/lib.rs                                 |    1 +
+ rust/kernel/miscdevice.rs                          |   63 +-
+ rust/kernel/page.rs                                |    6 +
+ rust/kernel/security.rs                            |   37 +
+ rust/kernel/usb.rs                                 |  456 ++++
+ rust/uapi/uapi_helper.h                            |    1 +
+ samples/rust/Kconfig                               |   11 +
+ samples/rust/Makefile                              |    1 +
+ samples/rust/rust_driver_usb.rs                    |   47 +
+ samples/rust/rust_misc_device.rs                   |   39 +-
+ tools/iio/iio_event_monitor.c                      |   10 +
+ .../selftests/filesystems/binderfs/binderfs_test.c |    1 +
+ 463 files changed, 27303 insertions(+), 3792 deletions(-)
+ create mode 100644 Documentation/ABI/testing/sysfs-bus-i2c-devices-m24lr
+ create mode 100644 Documentation/devicetree/bindings/arm/qcom,coresight-tnoc.yaml
+ create mode 100644 Documentation/devicetree/bindings/eeprom/st,m24lr.yaml
+ delete mode 100644 Documentation/devicetree/bindings/extcon/extcon-rt8973a.txt
+ create mode 100644 Documentation/devicetree/bindings/extcon/maxim,max14526.yaml
+ create mode 100644 Documentation/devicetree/bindings/extcon/richtek,rt8973a-muic.yaml
+ create mode 100644 Documentation/devicetree/bindings/iio/adc/adi,ade9000.yaml
+ create mode 100644 Documentation/devicetree/bindings/iio/adc/rohm,bd79112.yaml
+ create mode 100644 Documentation/devicetree/bindings/iio/light/vishay,veml6046x00.yaml
+ create mode 100644 Documentation/devicetree/bindings/iio/magnetometer/infineon,tlv493d-a1b6.yaml
+ create mode 100644 Documentation/devicetree/bindings/iio/pressure/invensense,icp10100.yaml
+ create mode 100644 Documentation/devicetree/bindings/interconnect/qcom,glymur-rpmh.yaml
+ create mode 100644 Documentation/devicetree/bindings/nvmem/airoha,an8855-efuse.yaml
+ create mode 100644 Documentation/devicetree/bindings/nvmem/nxp,s32g-ocotp-nvmem.yaml
+ delete mode 100644 Documentation/devicetree/bindings/slimbus/qcom,slim.yaml
+ create mode 100644 Documentation/iio/ade9000.rst
+ create mode 100644 Documentation/iio/adxl345.rst
+ create mode 100644 Documentation/netlink/specs/binder.yaml
+ create mode 100644 drivers/android/binder/Makefile
+ create mode 100644 drivers/android/binder/allocation.rs
+ create mode 100644 drivers/android/binder/context.rs
+ create mode 100644 drivers/android/binder/deferred_close.rs
+ create mode 100644 drivers/android/binder/defs.rs
+ create mode 100644 drivers/android/binder/error.rs
+ create mode 100644 drivers/android/binder/freeze.rs
+ create mode 100644 drivers/android/binder/node.rs
+ create mode 100644 drivers/android/binder/node/wrapper.rs
+ create mode 100644 drivers/android/binder/page_range.rs
+ create mode 100644 drivers/android/binder/page_range_helper.c
+ create mode 100644 drivers/android/binder/page_range_helper.h
+ create mode 100644 drivers/android/binder/process.rs
+ create mode 100644 drivers/android/binder/range_alloc/array.rs
+ create mode 100644 drivers/android/binder/range_alloc/mod.rs
+ create mode 100644 drivers/android/binder/range_alloc/tree.rs
+ create mode 100644 drivers/android/binder/rust_binder.h
+ create mode 100644 drivers/android/binder/rust_binder_events.c
+ create mode 100644 drivers/android/binder/rust_binder_events.h
+ create mode 100644 drivers/android/binder/rust_binder_internal.h
+ create mode 100644 drivers/android/binder/rust_binder_main.rs
+ create mode 100644 drivers/android/binder/rust_binderfs.c
+ create mode 100644 drivers/android/binder/stats.rs
+ create mode 100644 drivers/android/binder/thread.rs
+ create mode 100644 drivers/android/binder/trace.rs
+ create mode 100644 drivers/android/binder/transaction.rs
+ create mode 100644 drivers/android/binder_netlink.c
+ create mode 100644 drivers/android/binder_netlink.h
+ rename drivers/{misc => char}/misc_minor_kunit.c (89%)
+ create mode 100644 drivers/comedi/drivers/adl_pci7250.c
+ create mode 100644 drivers/extcon/extcon-max14526.c
+ create mode 100644 drivers/hwtracing/coresight/coresight-tnoc.c
+ create mode 100644 drivers/iio/adc/88pm886-gpadc.c
+ create mode 100644 drivers/iio/adc/ade9000.c
+ create mode 100644 drivers/iio/adc/intel_dc_ti_adc.c
+ create mode 100644 drivers/iio/adc/rohm-bd79112.c
+ create mode 100644 drivers/iio/light/veml6046x00.c
+ create mode 100644 drivers/iio/magnetometer/tlv493d.c
+ create mode 100644 drivers/iio/test/iio-test-multiply.c
+ create mode 100644 drivers/interconnect/qcom/glymur.c
+ create mode 100644 drivers/misc/eeprom/m24lr.c
+ create mode 100644 drivers/nvmem/an8855-efuse.c
+ create mode 100644 drivers/nvmem/s32g-ocotp-nvmem.c
+ delete mode 100644 drivers/slimbus/qcom-ctrl.c
+ create mode 100644 include/dt-bindings/interconnect/qcom,glymur-rpmh.h
+ delete mode 100644 include/linux/platform_data/touchscreen-s3c2410.h
+ create mode 100644 include/uapi/linux/android/binder_netlink.h
+ create mode 100644 rust/helpers/binder.c
+ create mode 100644 rust/helpers/usb.c
+ create mode 100644 rust/kernel/fs/kiocb.rs
+ create mode 100644 rust/kernel/iov.rs
+ create mode 100644 rust/kernel/usb.rs
+ create mode 100644 samples/rust/rust_driver_usb.rs
+Merging accel/habanalabs-next (f03eee5fc9221 Merge tag 'drm-xe-next-fixes-2024-05-02' of https://gitlab.freedesktop.org/drm/xe/kernel into drm-next)
+$ git merge -m Merge branch 'habanalabs-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ogabbay/linux.git accel/habanalabs-next
+Already up to date.
+Merging coresight/next (01f96b812526a coresight: Add label sysfs node support)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/coresight/linux.git coresight/next
+Already up to date.
+Merging fastrpc/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/srini/fastrpc.git fastrpc/for-next
+Already up to date.
+Merging fpga/for-next (4f156ee58bb84 fpga: zynq_fpga: Fix the wrong usage of dma_map_sgtable())
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/fpga/linux-fpga.git fpga/for-next
+Merge made by the 'ort' strategy.
+Merging icc/icc-next (bcdf7a064c3c7 Merge branch 'icc-glymur' into icc-next)
+$ git merge -m Merge branch 'icc-next' of https://git.kernel.org/pub/scm/linux/kernel/git/djakov/icc.git icc/icc-next
+Already up to date.
+Merging iio/togreg (561285d048053 MAINTAINERS: Support ROHM BD79112 ADC)
+$ git merge -m Merge branch 'togreg' of https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git iio/togreg
+Already up to date.
+Merging phy-next/next (bdb978979ed13 phy: rockchip: phy-rockchip-inno-csidphy: add support for rk3588 variant)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/phy/linux-phy.git phy-next/next
+Auto-merging Documentation/devicetree/bindings/phy/qcom,sc8280xp-qmp-pcie-phy.yaml
+Auto-merging Documentation/devicetree/bindings/soc/rockchip/grf.yaml
+Auto-merging drivers/phy/qualcomm/phy-qcom-eusb2-repeater.c
+Auto-merging drivers/phy/qualcomm/phy-qcom-qmp-pcie.c
+Auto-merging drivers/phy/ti/phy-omap-usb2.c
+Auto-merging drivers/phy/ti/phy-ti-pipe3.c
+Merge made by the 'ort' strategy.
+ .../bindings/phy/fsl,imx8mq-usb-phy.yaml           |   1 -
+ .../bindings/phy/phy-rockchip-naneng-combphy.yaml  |   8 +-
+ .../devicetree/bindings/phy/qcom,edp-phy.yaml      |  19 +-
+ .../bindings/phy/qcom,sc8280xp-qmp-pcie-phy.yaml   |   2 +
+ .../phy/qcom,sc8280xp-qmp-usb43dp-phy.yaml         |   7 +-
+ .../bindings/phy/qcom,snps-eusb2-repeater.yaml     |   7 +
+ .../devicetree/bindings/phy/renesas,usb2-phy.yaml  |  17 +
+ .../bindings/phy/rockchip-inno-csi-dphy.yaml       |  65 +-
+ .../bindings/phy/sophgo,cv1800b-usb2-phy.yaml      |  54 ++
+ .../devicetree/bindings/phy/ti,tcan104x-can.yaml   |   1 +
+ .../devicetree/bindings/soc/rockchip/grf.yaml      |   1 +
+ drivers/phy/Kconfig                                |   1 +
+ drivers/phy/Makefile                               |   1 +
+ drivers/phy/allwinner/phy-sun4i-usb.c              |  38 +-
+ drivers/phy/broadcom/phy-brcm-sata.c               |   1 -
+ drivers/phy/broadcom/phy-brcm-usb.c                |   1 -
+ drivers/phy/cadence/cdns-dphy-rx.c                 |   3 +-
+ drivers/phy/cadence/cdns-dphy.c                    | 156 +++--
+ drivers/phy/cadence/phy-cadence-sierra.c           |   1 -
+ drivers/phy/freescale/phy-fsl-lynx-28g.c           |  16 +-
+ drivers/phy/hisilicon/phy-hi6220-usb.c             |   1 -
+ drivers/phy/hisilicon/phy-histb-combphy.c          |   2 +-
+ drivers/phy/ingenic/phy-ingenic-usb.c              |   8 +-
+ drivers/phy/qualcomm/phy-qcom-eusb2-repeater.c     |  15 +
+ drivers/phy/qualcomm/phy-qcom-ipq806x-usb.c        |   1 -
+ drivers/phy/qualcomm/phy-qcom-m31-eusb2.c          |   2 +-
+ drivers/phy/qualcomm/phy-qcom-qmp-combo.c          | 179 ++++-
+ drivers/phy/qualcomm/phy-qcom-qmp-pcie.c           | 149 +++++
+ drivers/phy/qualcomm/phy-qcom-qmp-pcs-v7.h         |   2 +
+ .../phy/qualcomm/phy-qcom-qmp-qserdes-txrx-v7.h    |   4 +-
+ drivers/phy/qualcomm/phy-qcom-qmp-ufs.c            | 159 +++--
+ drivers/phy/renesas/phy-rcar-gen3-usb2.c           | 136 +++-
+ drivers/phy/renesas/r8a779f0-ether-serdes.c        |  97 ++-
+ drivers/phy/rockchip/phy-rockchip-inno-csidphy.c   |  67 +-
+ drivers/phy/rockchip/phy-rockchip-naneng-combphy.c | 723 +++++++++++++--------
+ drivers/phy/rockchip/phy-rockchip-samsung-hdptx.c  |   1 -
+ drivers/phy/rockchip/phy-rockchip-usbdp.c          |   3 +-
+ drivers/phy/samsung/phy-exynos5-usbdrd.c           |   1 -
+ drivers/phy/samsung/phy-samsung-usb2.c             |   1 -
+ drivers/phy/sophgo/Kconfig                         |  19 +
+ drivers/phy/sophgo/Makefile                        |   2 +
+ drivers/phy/sophgo/phy-cv1800-usb2.c               | 170 +++++
+ drivers/phy/ti/Kconfig                             |   2 +-
+ drivers/phy/ti/phy-am654-serdes.c                  |   1 -
+ drivers/phy/ti/phy-dm816x-usb.c                    |   1 -
+ drivers/phy/ti/phy-j721e-wiz.c                     |   1 -
+ drivers/phy/ti/phy-omap-control.c                  |   1 -
+ drivers/phy/ti/phy-omap-usb2.c                     |   1 -
+ drivers/phy/ti/phy-ti-pipe3.c                      |   1 -
+ 49 files changed, 1657 insertions(+), 493 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/phy/sophgo,cv1800b-usb2-phy.yaml
+ create mode 100644 drivers/phy/sophgo/Kconfig
+ create mode 100644 drivers/phy/sophgo/Makefile
+ create mode 100644 drivers/phy/sophgo/phy-cv1800-usb2.c
+Merging soundwire/next (88f5d2a477ec6 soundwire: Use min() to improve code)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/soundwire.git soundwire/next
+Merge made by the 'ort' strategy.
+ drivers/soundwire/bus_type.c | 3 ---
+ drivers/soundwire/debugfs.c  | 2 ++
+ drivers/soundwire/qcom.c     | 5 +----
+ 3 files changed, 3 insertions(+), 7 deletions(-)
+Merging extcon/extcon-next (94d885eb8ffe1 dt-bindings: extcon: linux,extcon-usb-gpio: GPIO must be provided)
+$ git merge -m Merge branch 'extcon-next' of https://git.kernel.org/pub/scm/linux/kernel/git/chanwoo/extcon.git extcon/extcon-next
+Already up to date.
+Merging gnss/gnss-next (1b237f190eb3d Linux 6.17-rc3)
+$ git merge -m Merge branch 'gnss-next' of https://git.kernel.org/pub/scm/linux/kernel/git/johan/gnss.git gnss/gnss-next
+Already up to date.
+Merging vfio/next (407aa63018d15 vfio/nvgrace-gpu: Add GB300 SKU to the devid table)
+$ git merge -m Merge branch 'next' of https://github.com/awilliam/linux-vfio.git vfio/next
+Auto-merging .mailmap
+Auto-merging Documentation/filesystems/proc.rst
+Auto-merging MAINTAINERS
+Auto-merging drivers/cdx/controller/cdx_controller.c
+Auto-merging tools/testing/selftests/Makefile
+Merge made by the 'ort' strategy.
+ .mailmap                                           |   1 +
+ Documentation/filesystems/proc.rst                 |  14 +
+ MAINTAINERS                                        |  14 +-
+ drivers/cdx/Kconfig                                |   1 -
+ drivers/cdx/cdx.c                                  |   4 +-
+ drivers/cdx/controller/Kconfig                     |   1 -
+ drivers/cdx/controller/cdx_controller.c            |   3 +-
+ drivers/dma/idxd/registers.h                       |   4 +
+ drivers/dma/ioat/dma.h                             |   2 +
+ drivers/dma/ioat/hw.h                              |   3 -
+ drivers/vfio/cdx/Makefile                          |   6 +-
+ drivers/vfio/cdx/private.h                         |  14 +
+ drivers/vfio/fsl-mc/Kconfig                        |   5 +-
+ drivers/vfio/fsl-mc/vfio_fsl_mc.c                  |   2 +
+ drivers/vfio/pci/hisilicon/hisi_acc_vfio_pci.c     |   6 +-
+ drivers/vfio/pci/nvgrace-gpu/main.c                |   4 +-
+ drivers/vfio/pci/pds/dirty.c                       |   2 +-
+ drivers/vfio/pci/vfio_pci_intrs.c                  |   9 +-
+ drivers/vfio/platform/Kconfig                      |   5 +-
+ drivers/vfio/platform/reset/Kconfig                |   6 +-
+ .../vfio/platform/reset/vfio_platform_amdxgbe.c    |   2 +
+ .../vfio/platform/reset/vfio_platform_bcmflexrm.c  |   2 +
+ .../platform/reset/vfio_platform_calxedaxgmac.c    |   2 +
+ drivers/vfio/platform/vfio_amba.c                  |   2 +
+ drivers/vfio/vfio_main.c                           |  22 +-
+ tools/arch/x86/include/asm/io.h                    | 101 ++++
+ tools/arch/x86/include/asm/special_insns.h         |  27 +
+ tools/include/asm-generic/io.h                     | 482 +++++++++++++++++
+ tools/include/asm/io.h                             |  11 +
+ tools/include/linux/compiler.h                     |   4 +
+ tools/include/linux/io.h                           |   4 +-
+ tools/include/linux/pci_ids.h                      |   1 +
+ tools/testing/selftests/Makefile                   |   1 +
+ tools/testing/selftests/vfio/.gitignore            |  10 +
+ tools/testing/selftests/vfio/Makefile              |  21 +
+ tools/testing/selftests/vfio/lib/drivers/dsa/dsa.c | 416 +++++++++++++++
+ .../selftests/vfio/lib/drivers/dsa/registers.h     |   1 +
+ tools/testing/selftests/vfio/lib/drivers/ioat/hw.h |   1 +
+ .../testing/selftests/vfio/lib/drivers/ioat/ioat.c | 235 ++++++++
+ .../selftests/vfio/lib/drivers/ioat/registers.h    |   1 +
+ .../testing/selftests/vfio/lib/include/vfio_util.h | 295 ++++++++++
+ tools/testing/selftests/vfio/lib/libvfio.mk        |  24 +
+ tools/testing/selftests/vfio/lib/vfio_pci_device.c | 594 +++++++++++++++++++++
+ tools/testing/selftests/vfio/lib/vfio_pci_driver.c | 126 +++++
+ tools/testing/selftests/vfio/run.sh                | 109 ++++
+ .../testing/selftests/vfio/vfio_dma_mapping_test.c | 199 +++++++
+ .../selftests/vfio/vfio_iommufd_setup_test.c       | 127 +++++
+ .../testing/selftests/vfio/vfio_pci_device_test.c  | 176 ++++++
+ .../testing/selftests/vfio/vfio_pci_driver_test.c  | 244 +++++++++
+ 49 files changed, 3323 insertions(+), 23 deletions(-)
+ create mode 100644 tools/arch/x86/include/asm/io.h
+ create mode 100644 tools/arch/x86/include/asm/special_insns.h
+ create mode 100644 tools/include/asm-generic/io.h
+ create mode 100644 tools/include/asm/io.h
+ create mode 120000 tools/include/linux/pci_ids.h
+ create mode 100644 tools/testing/selftests/vfio/.gitignore
+ create mode 100644 tools/testing/selftests/vfio/Makefile
+ create mode 100644 tools/testing/selftests/vfio/lib/drivers/dsa/dsa.c
+ create mode 120000 tools/testing/selftests/vfio/lib/drivers/dsa/registers.h
+ create mode 120000 tools/testing/selftests/vfio/lib/drivers/ioat/hw.h
+ create mode 100644 tools/testing/selftests/vfio/lib/drivers/ioat/ioat.c
+ create mode 120000 tools/testing/selftests/vfio/lib/drivers/ioat/registers.h
+ create mode 100644 tools/testing/selftests/vfio/lib/include/vfio_util.h
+ create mode 100644 tools/testing/selftests/vfio/lib/libvfio.mk
+ create mode 100644 tools/testing/selftests/vfio/lib/vfio_pci_device.c
+ create mode 100644 tools/testing/selftests/vfio/lib/vfio_pci_driver.c
+ create mode 100755 tools/testing/selftests/vfio/run.sh
+ create mode 100644 tools/testing/selftests/vfio/vfio_dma_mapping_test.c
+ create mode 100644 tools/testing/selftests/vfio/vfio_iommufd_setup_test.c
+ create mode 100644 tools/testing/selftests/vfio/vfio_pci_device_test.c
+ create mode 100644 tools/testing/selftests/vfio/vfio_pci_driver_test.c
+Merging w1/for-next (25fb0ea986dc1 w1: matrox: Remove some deadcode in matrox_w1_remove())
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/krzk/linux-w1.git w1/for-next
+Already up to date.
+Merging spmi/spmi-next (0ff41df1cb268 Linux 6.15)
+$ git merge -m Merge branch 'spmi-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sboyd/spmi.git spmi/spmi-next
+Already up to date.
+Merging staging/staging-next (b76029bdd7105 staging: rtl8723bs: xmit: rephrase comment and drop extra space)
+$ git merge -m Merge branch 'staging-next' of https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/staging.git staging/staging-next
+Auto-merging drivers/staging/axis-fifo/axis-fifo.c
+Auto-merging drivers/staging/octeon/ethernet-tx.c
+Merge made by the 'ort' strategy.
+ drivers/staging/axis-fifo/axis-fifo.c              |  37 ++-
+ .../staging/gpib/agilent_82357a/agilent_82357a.c   |  18 +-
+ .../staging/gpib/agilent_82357a/agilent_82357a.h   |  10 +-
+ drivers/staging/gpib/cb7210/cb7210.h               |   4 +-
+ drivers/staging/gpib/cec/cec_gpib.c                |   2 +-
+ drivers/staging/gpib/common/gpib_os.c              |   2 +-
+ drivers/staging/gpib/common/iblib.c                |   2 +-
+ drivers/staging/gpib/eastwood/fluke_gpib.c         |   2 +-
+ drivers/staging/gpib/fmh_gpib/fmh_gpib.c           |   2 +-
+ drivers/staging/gpib/gpio/gpib_bitbang.c           |  16 +-
+ drivers/staging/gpib/hp_82341/hp_82341.c           |  12 +-
+ drivers/staging/gpib/hp_82341/hp_82341.h           |  40 +--
+ drivers/staging/gpib/include/amccs5933.h           |   4 +-
+ drivers/staging/gpib/include/gpib_types.h          |   3 +-
+ drivers/staging/gpib/include/nec7210.h             |  26 +-
+ drivers/staging/gpib/include/nec7210_registers.h   |   4 +-
+ drivers/staging/gpib/include/plx9050.h             |   8 +-
+ drivers/staging/gpib/include/tms9914.h             |  90 ++---
+ drivers/staging/gpib/include/tnt4882_registers.h   |  22 +-
+ drivers/staging/gpib/ines/ines.h                   |  12 +-
+ drivers/staging/gpib/ines/ines_gpib.c              |   4 +-
+ drivers/staging/gpib/nec7210/nec7210.c             |   6 +-
+ drivers/staging/gpib/ni_usb/ni_usb_gpib.c          |  10 +-
+ drivers/staging/gpib/ni_usb/ni_usb_gpib.h          |  10 +-
+ drivers/staging/gpib/pc2/pc2_gpib.c                |   4 +-
+ drivers/staging/gpib/tms9914/tms9914.c             |  10 +-
+ drivers/staging/gpib/tnt4882/mite.h                |  10 +-
+ drivers/staging/gpib/tnt4882/tnt4882_gpib.c        |   5 +-
+ drivers/staging/octeon/ethernet-tx.c               |  40 ---
+ drivers/staging/octeon/octeon-stubs.h              | 136 ++++----
+ drivers/staging/rtl8723bs/Makefile                 |   2 -
+ drivers/staging/rtl8723bs/core/rtw_ap.c            |   8 +-
+ drivers/staging/rtl8723bs/core/rtw_efuse.c         | 169 +---------
+ drivers/staging/rtl8723bs/core/rtw_mlme.c          | 231 +++++++++----
+ drivers/staging/rtl8723bs/core/rtw_mlme_ext.c      | 130 ++++----
+ drivers/staging/rtl8723bs/core/rtw_pwrctrl.c       |  10 +-
+ drivers/staging/rtl8723bs/core/rtw_recv.c          | 194 ++++++++++-
+ drivers/staging/rtl8723bs/core/rtw_security.c      |  78 +----
+ drivers/staging/rtl8723bs/core/rtw_sta_mgt.c       |   6 +-
+ drivers/staging/rtl8723bs/core/rtw_wlan_util.c     |  60 ++--
+ drivers/staging/rtl8723bs/core/rtw_xmit.c          |   2 +-
+ drivers/staging/rtl8723bs/hal/hal_com_phycfg.c     |   5 +-
+ drivers/staging/rtl8723bs/hal/hal_pwr_seq.c        |   2 +-
+ drivers/staging/rtl8723bs/hal/odm.c                | 152 ---------
+ drivers/staging/rtl8723bs/hal/odm.h                |   6 -
+ drivers/staging/rtl8723bs/hal/rtl8723b_hal_init.c  | 368 +++------------------
+ drivers/staging/rtl8723bs/hal/rtl8723bs_recv.c     |   6 +-
+ drivers/staging/rtl8723bs/hal/rtl8723bs_xmit.c     |   2 +-
+ drivers/staging/rtl8723bs/hal/sdio_halinit.c       |   1 -
+ drivers/staging/rtl8723bs/include/basic_types.h    |  41 +--
+ drivers/staging/rtl8723bs/include/drv_types.h      |   2 -
+ drivers/staging/rtl8723bs/include/hal_intf.h       |   7 +-
+ drivers/staging/rtl8723bs/include/mlme_osdep.h     |  19 --
+ drivers/staging/rtl8723bs/include/recv_osdep.h     |  40 ---
+ drivers/staging/rtl8723bs/include/rtl8723b_hal.h   |   2 -
+ drivers/staging/rtl8723bs/include/rtw_efuse.h      |  15 +-
+ drivers/staging/rtl8723bs/include/rtw_mlme.h       |   1 +
+ drivers/staging/rtl8723bs/include/rtw_mlme_ext.h   |   2 -
+ drivers/staging/rtl8723bs/include/rtw_recv.h       |   4 +
+ drivers/staging/rtl8723bs/os_dep/mlme_linux.c      | 179 ----------
+ drivers/staging/rtl8723bs/os_dep/recv_linux.c      | 225 -------------
+ drivers/staging/sm750fb/sm750.h                    |   6 +-
+ drivers/staging/sm750fb/sm750_accel.c              |   8 +-
+ drivers/staging/sm750fb/sm750_hw.c                 |   4 +-
+ .../staging/vc04_services/vchiq-mmal/mmal-msg.h    |   2 +-
+ .../staging/vc04_services/vchiq-mmal/mmal-vchiq.c  |   2 +-
+ .../staging/vc04_services/vchiq-mmal/mmal-vchiq.h  |   2 +-
+ 67 files changed, 858 insertions(+), 1686 deletions(-)
+ delete mode 100644 drivers/staging/rtl8723bs/include/mlme_osdep.h
+ delete mode 100644 drivers/staging/rtl8723bs/include/recv_osdep.h
+ delete mode 100644 drivers/staging/rtl8723bs/os_dep/mlme_linux.c
+ delete mode 100644 drivers/staging/rtl8723bs/os_dep/recv_linux.c
+Merging counter-next/counter-next (51548c36b37d0 counter: ti-ecap-capture: Use devm_pm_runtime_enable())
+$ git merge -m Merge branch 'counter-next' of https://git.kernel.org/pub/scm/linux/kernel/git/wbg/counter.git counter-next/counter-next
+Already up to date.
+Merging siox/siox/for-next (db418d5f1ca5b siox: bus-gpio: Simplify using devm_siox_* functions)
+$ git merge -m Merge branch 'siox/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ukleinek/linux.git siox/siox/for-next
+Already up to date.
+Merging mux/for-next (59b723cd2adba Linux 6.12-rc6)
+$ git merge -m Merge branch 'for-next' of https://gitlab.com/peda-linux/mux.git mux/for-next
+Already up to date.
+Merging dmaengine/next (cc0bacac6de77 dt-bindings: dma: rz-dmac: Document RZ/G3E family of SoCs)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/vkoul/dmaengine.git dmaengine/next
+Auto-merging drivers/dma/idxd/init.c
+Auto-merging drivers/dma/idxd/registers.h
+Merge made by the 'ort' strategy.
+ .../bindings/dma/nvidia,tegra20-apbdma.yaml        |  12 +-
+ .../devicetree/bindings/dma/renesas,rz-dmac.yaml   |   5 +
+ .../devicetree/bindings/dma/spacemit,k1-pdma.yaml  |  68 +++++
+ .../devicetree/bindings/dma/xilinx/xilinx_dma.txt  |  23 --
+ drivers/dma/Kconfig                                |   2 +-
+ drivers/dma/dw-edma/dw-edma-core.c                 |  22 ++
+ drivers/dma/idxd/defaults.c                        |   6 +-
+ drivers/dma/idxd/init.c                            |   2 +
+ drivers/dma/idxd/registers.h                       |   1 +
+ drivers/dma/imx-sdma.c                             |   2 +-
+ drivers/dma/mmp_pdma.c                             | 293 ++++++++++++++++++---
+ drivers/dma/mv_xor.c                               |   4 +-
+ drivers/dma/ppc4xx/adma.c                          |   4 +-
+ drivers/dma/sh/shdma-base.c                        |  25 +-
+ drivers/dma/sh/shdmac.c                            |  17 +-
+ drivers/dma/xilinx/xilinx_dma.c                    |  94 +++++++
+ drivers/dma/xilinx/zynqmp_dma.c                    |   5 +-
+ include/linux/dmaengine.h                          |   2 +-
+ include/linux/shdma-base.h                         |   2 +-
+ 19 files changed, 504 insertions(+), 85 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/dma/spacemit,k1-pdma.yaml
+Merging cgroup/for-next (32768f03eb469 Merge branch 'for-6.18' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/tj/cgroup.git cgroup/for-next
+Auto-merging include/linux/cgroup.h
+Auto-merging kernel/cgroup/cgroup.c
+Auto-merging kernel/fork.c
+Merge made by the 'ort' strategy.
+ Documentation/admin-guide/cgroup-v2.rst            |  33 +-
+ include/linux/cgroup-defs.h                        |  43 +-
+ include/linux/cgroup.h                             |   5 +
+ include/linux/sched/signal.h                       |   4 +
+ init/init_task.c                                   |   3 +
+ kernel/cgroup/cgroup-internal.h                    |  11 +-
+ kernel/cgroup/cgroup-v1.c                          |  19 +-
+ kernel/cgroup/cgroup.c                             | 199 ++++--
+ kernel/cgroup/cpuset-internal.h                    |   5 +-
+ kernel/cgroup/cpuset-v1.c                          |  12 +-
+ kernel/cgroup/cpuset.c                             | 762 +++++++++++----------
+ kernel/cgroup/debug.c                              |   4 -
+ kernel/cgroup/freezer.c                            |  16 +-
+ kernel/fork.c                                      |   4 +
+ tools/testing/selftests/cgroup/lib/cgroup_util.c   |  12 +
+ .../selftests/cgroup/lib/include/cgroup_util.h     |   1 +
+ tools/testing/selftests/cgroup/test_freezer.c      | 663 ++++++++++++++++++
+ tools/testing/selftests/cgroup/test_pids.c         |   3 +
+ 18 files changed, 1360 insertions(+), 439 deletions(-)
+Merging scsi/for-next (e50b8f02e00d4 Merge branch 'misc' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/jejb/scsi.git scsi/for-next
+Auto-merging drivers/scsi/ipr.c
+Auto-merging drivers/scsi/lpfc/lpfc_init.c
+Auto-merging drivers/scsi/mpi3mr/mpi3mr_os.c
+Auto-merging drivers/scsi/qla2xxx/qla_os.c
+Auto-merging drivers/scsi/sd.c
+Auto-merging include/scsi/libsas.h
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/ufs/qcom,sc7180-ufshc.yaml | 167 ++++++
+ .../devicetree/bindings/ufs/qcom,sm8650-ufshc.yaml | 178 ++++++
+ .../devicetree/bindings/ufs/qcom,ufs-common.yaml   |  67 +++
+ .../devicetree/bindings/ufs/qcom,ufs.yaml          | 185 ++-----
+ drivers/scsi/aic94xx/aic94xx_task.c                |   1 -
+ drivers/scsi/bfa/bfa_core.c                        |   1 -
+ drivers/scsi/csiostor/csio_wr.c                    |   4 +-
+ drivers/scsi/hisi_sas/hisi_sas_main.c              |   2 +-
+ drivers/scsi/hisi_sas/hisi_sas_v2_hw.c             |   6 +-
+ drivers/scsi/hisi_sas/hisi_sas_v3_hw.c             |   6 +-
+ drivers/scsi/hpsa.c                                |  15 +-
+ drivers/scsi/ipr.c                                 |   8 +-
+ drivers/scsi/isci/remote_device.c                  |   2 +-
+ drivers/scsi/libsas/sas_expander.c                 |   5 +-
+ drivers/scsi/lpfc/lpfc.h                           |  50 +-
+ drivers/scsi/lpfc/lpfc_debugfs.c                   | 614 +++++++--------------
+ drivers/scsi/lpfc/lpfc_debugfs.h                   |   5 +-
+ drivers/scsi/lpfc/lpfc_els.c                       |  23 +-
+ drivers/scsi/lpfc/lpfc_hw.h                        |   3 +-
+ drivers/scsi/lpfc/lpfc_hw4.h                       |   6 +-
+ drivers/scsi/lpfc/lpfc_init.c                      |  12 +-
+ drivers/scsi/lpfc/lpfc_nportdisc.c                 |  25 +-
+ drivers/scsi/lpfc/lpfc_nvme.c                      |   8 +-
+ drivers/scsi/lpfc/lpfc_scsi.c                      |  14 +-
+ drivers/scsi/lpfc/lpfc_sli.c                       |  21 +-
+ drivers/scsi/lpfc/lpfc_version.h                   |   2 +-
+ drivers/scsi/mpi3mr/mpi/mpi30_cnfg.h               |  38 +-
+ drivers/scsi/mpi3mr/mpi/mpi30_pci.h                |   2 +
+ drivers/scsi/mpi3mr/mpi/mpi30_sas.h                |   1 +
+ drivers/scsi/mpi3mr/mpi/mpi30_transport.h          |   2 +-
+ drivers/scsi/mpi3mr/mpi3mr.h                       |   8 +-
+ drivers/scsi/mpi3mr/mpi3mr_fw.c                    |  13 +
+ drivers/scsi/mpi3mr/mpi3mr_os.c                    |  28 +-
+ drivers/scsi/mpi3mr/mpi3mr_transport.c             |  11 +-
+ drivers/scsi/mvsas/mv_sas.c                        |   2 +-
+ drivers/scsi/myrs.c                                |   8 +-
+ drivers/scsi/pm8001/pm8001_ctl.c                   |  24 +-
+ drivers/scsi/pm8001/pm8001_hwi.c                   |  11 +-
+ drivers/scsi/pm8001/pm8001_hwi.h                   |   4 +-
+ drivers/scsi/pm8001/pm8001_init.c                  |   1 +
+ drivers/scsi/pm8001/pm8001_sas.c                   |  34 +-
+ drivers/scsi/pm8001/pm8001_sas.h                   |   5 +
+ drivers/scsi/pm8001/pm80xx_hwi.c                   |  10 +-
+ drivers/scsi/pm8001/pm80xx_hwi.h                   |   4 +-
+ drivers/scsi/qla2xxx/qla_bsg.c                     |   4 +-
+ drivers/scsi/qla2xxx/qla_def.h                     |  10 +-
+ drivers/scsi/qla2xxx/qla_edif.c                    |   4 +-
+ drivers/scsi/qla2xxx/qla_init.c                    |   4 +-
+ drivers/scsi/qla2xxx/qla_isr.c                     |  17 +-
+ drivers/scsi/qla2xxx/qla_nvme.c                    |   4 +-
+ drivers/scsi/qla2xxx/qla_os.c                      |  13 +-
+ drivers/scsi/scsi_debug.c                          |  17 +-
+ drivers/scsi/sd.c                                  |  58 +-
+ drivers/target/iscsi/iscsi_target_configfs.c       |   6 +-
+ drivers/target/iscsi/iscsi_target_tmr.c            |   3 +-
+ drivers/ufs/core/ufs_trace.h                       |   1 +
+ drivers/ufs/core/ufs_trace_types.h                 |  24 +
+ drivers/ufs/core/ufshcd.c                          |  39 +-
+ drivers/ufs/host/ufs-exynos.c                      |  10 +-
+ drivers/ufs/host/ufs-mediatek.c                    | 354 ++++++++++--
+ drivers/ufs/host/ufs-mediatek.h                    |   1 +
+ drivers/ufs/host/ufs-qcom.c                        | 205 ++++---
+ drivers/ufs/host/ufs-qcom.h                        |  28 +-
+ include/scsi/libsas.h                              |   8 +
+ include/uapi/scsi/fc/fc_els.h                      |  58 +-
+ include/ufs/ufs.h                                  |  17 -
+ include/ufs/ufs_quirks.h                           |   3 +
+ include/ufs/ufshcd.h                               |  31 +-
+ 68 files changed, 1483 insertions(+), 1072 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/ufs/qcom,sc7180-ufshc.yaml
+ create mode 100644 Documentation/devicetree/bindings/ufs/qcom,sm8650-ufshc.yaml
+ create mode 100644 Documentation/devicetree/bindings/ufs/qcom,ufs-common.yaml
+ create mode 100644 drivers/ufs/core/ufs_trace_types.h
+Merging scsi-mkp/for-next (fb641516a6687 scsi: MAINTAINERS: Update FC element owners)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mkp/scsi.git scsi-mkp/for-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/scsi/storvsc_drv.c
+Auto-merging drivers/ufs/core/ufs-mcq.c
+Auto-merging drivers/ufs/core/ufshcd.c
+Auto-merging drivers/ufs/host/ufs-qcom.c
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/ufs/ufs-common.yaml        | 16 +++++++++
+ MAINTAINERS                                        |  9 ++---
+ drivers/scsi/hpsa.c                                | 38 ++++++++++------------
+ drivers/scsi/libfc/fc_encode.h                     |  2 +-
+ drivers/scsi/mpt3sas/mpt3sas_base.c                |  8 ++++-
+ drivers/scsi/mpt3sas/mpt3sas_base.h                |  4 +--
+ drivers/scsi/mpt3sas/mpt3sas_transport.c           | 11 ++++---
+ drivers/scsi/smartpqi/smartpqi_init.c              | 17 +++++-----
+ drivers/scsi/storvsc_drv.c                         |  4 +--
+ drivers/ufs/core/ufs-mcq.c                         | 11 +++++++
+ drivers/ufs/core/ufs-sysfs.c                       |  2 ++
+ drivers/ufs/core/ufshcd.c                          | 21 ++++++------
+ drivers/ufs/host/ufs-qcom.c                        | 21 ++++++++----
+ drivers/ufs/host/ufshcd-pltfrm.c                   | 33 +++++++++++++++++++
+ drivers/ufs/host/ufshcd-pltfrm.h                   |  1 +
+ include/ufs/ufshcd.h                               |  4 +++
+ 16 files changed, 141 insertions(+), 61 deletions(-)
+Merging vhost/linux-next (bcd630c7edc62 ptr_ring: __ptr_ring_zero_tail micro optimization)
+  4a37c69fc60bf ("ptr_ring: drop duplicated tail zeroing code")
+  b24ecc85ef3dc ("vhost: vringh: Fix copy_to_iter return value check")
+$ git merge -m Merge branch 'linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mst/vhost.git vhost/linux-next
+Auto-merging drivers/net/virtio_net.c
+Auto-merging drivers/vhost/vringh.c
+Auto-merging drivers/virtio/virtio_balloon.c
+Auto-merging drivers/virtio/virtio_ring.c
+CONFLICT (content): Merge conflict in drivers/virtio/virtio_ring.c
+Auto-merging include/linux/ptr_ring.h
+CONFLICT (content): Merge conflict in include/linux/ptr_ring.h
+Resolved 'drivers/virtio/virtio_ring.c' using previous resolution.
+Recorded preimage for 'include/linux/ptr_ring.h'
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+Recorded resolution for 'include/linux/ptr_ring.h'.
+[master e01dea4a17981] Merge branch 'linux-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mst/vhost.git
+$ git diff -M --stat --summary HEAD^..
+ drivers/net/virtio_net.c                 |  28 +-
+ drivers/vdpa/Kconfig                     |   8 +-
+ drivers/vdpa/alibaba/eni_vdpa.c          |   5 +-
+ drivers/vdpa/ifcvf/ifcvf_main.c          |   5 +-
+ drivers/vdpa/mlx5/core/mr.c              |   4 +-
+ drivers/vdpa/mlx5/net/mlx5_vnet.c        |  15 +-
+ drivers/vdpa/octeon_ep/octep_vdpa_main.c |   6 +-
+ drivers/vdpa/pds/vdpa_dev.c              |   5 +-
+ drivers/vdpa/solidrun/snet_main.c        |   8 +-
+ drivers/vdpa/vdpa.c                      |   5 +-
+ drivers/vdpa/vdpa_sim/vdpa_sim.c         |   4 +-
+ drivers/vdpa/vdpa_user/iova_domain.c     | 132 ++++++---
+ drivers/vdpa/vdpa_user/iova_domain.h     |   7 +-
+ drivers/vdpa/vdpa_user/vduse_dev.c       |  79 +++---
+ drivers/vdpa/virtio_pci/vp_vdpa.c        |   5 +-
+ drivers/vhost/vdpa.c                     |   6 +-
+ drivers/vhost/vringh.c                   |   7 +-
+ drivers/virtio/virtio_balloon.c          |   2 +-
+ drivers/virtio/virtio_ring.c             | 459 +++++++++++++++++++------------
+ drivers/virtio/virtio_vdpa.c             |  22 +-
+ include/linux/ptr_ring.h                 |  20 ++
+ include/linux/vdpa.h                     |  25 +-
+ include/linux/virtio.h                   |  46 +++-
+ include/linux/virtio_config.h            |  72 +++++
+ include/linux/virtio_ring.h              |   7 +-
+ 25 files changed, 651 insertions(+), 331 deletions(-)
+Merging rpmsg/for-next (e6e8a72ec5276 Merge branch 'rproc-next' and 'rpmsg-next' into for-next)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/remoteproc/linux.git rpmsg/for-next
+Auto-merging drivers/remoteproc/qcom_q6v5_pas.c
+Merge made by the 'ort' strategy.
+ .../bindings/remoteproc/qcom,milos-pas.yaml        | 198 +++++++++
+ drivers/remoteproc/da8xx_remoteproc.c              |  57 +--
+ drivers/remoteproc/imx_dsp_rproc.c                 |  45 +-
+ drivers/remoteproc/imx_rproc.c                     | 451 ++++++++++++---------
+ drivers/remoteproc/imx_rproc.h                     |   7 +
+ drivers/remoteproc/keystone_remoteproc.c           |  95 ++---
+ drivers/remoteproc/pru_rproc.c                     |   3 +-
+ drivers/remoteproc/qcom_q6v5.c                     |   8 +-
+ drivers/remoteproc/qcom_q6v5_mss.c                 |  11 +-
+ drivers/remoteproc/qcom_q6v5_pas.c                 |  32 +-
+ drivers/remoteproc/ti_k3_common.c                  |  21 +-
+ drivers/remoteproc/ti_k3_dsp_remoteproc.c          |   2 -
+ drivers/remoteproc/ti_k3_r5_remoteproc.c           |   2 -
+ drivers/remoteproc/wkup_m3_rproc.c                 |  69 ++--
+ drivers/rpmsg/qcom_glink_native.c                  |   2 +-
+ drivers/rpmsg/qcom_smd.c                           |   4 +-
+ drivers/rpmsg/rpmsg_char.c                         |   3 +-
+ drivers/rpmsg/rpmsg_core.c                         |   5 +-
+ 18 files changed, 643 insertions(+), 372 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/remoteproc/qcom,milos-pas.yaml
+Merging gpio-brgl/gpio/for-next (bc06114363753 gpio: mpfs: fix setting gpio direction to output)
+$ git merge -m Merge branch 'gpio/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git gpio-brgl/gpio/for-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/gpio/Kconfig
+Auto-merging drivers/gpio/Makefile
+Auto-merging drivers/gpio/gpiolib.c
+Auto-merging drivers/hwmon/Kconfig
+Auto-merging drivers/hwmon/Makefile
+Auto-merging drivers/i2c/busses/Kconfig
+CONFLICT (content): Merge conflict in drivers/i2c/busses/Kconfig
+Auto-merging drivers/i2c/busses/Makefile
+CONFLICT (content): Merge conflict in drivers/i2c/busses/Makefile
+Auto-merging drivers/mfd/Kconfig
+Auto-merging drivers/mfd/Makefile
+Auto-merging drivers/mfd/stmpe.c
+Resolved 'drivers/i2c/busses/Kconfig' using previous resolution.
+Resolved 'drivers/i2c/busses/Makefile' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 2eb66a80b1ed1] Merge branch 'gpio/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git
+$ git diff -M --stat --summary HEAD^..
+ .../devicetree/bindings/gpio/gpio-mmio.yaml        |  36 +-
+ .../devicetree/bindings/gpio/gpio-mxs.yaml         |  80 +-
+ .../devicetree/bindings/gpio/loongson,ls-gpio.yaml |  28 +-
+ .../devicetree/bindings/gpio/maxim,max31910.yaml   |   6 +-
+ .../bindings/gpio/nvidia,tegra186-gpio.yaml        |   2 +
+ .../devicetree/bindings/gpio/spacemit,k1-gpio.yaml |   2 +-
+ .../devicetree/bindings/gpio/trivial-gpio.yaml     |   2 +-
+ .../bindings/pinctrl/fsl,mxs-pinctrl.txt           | 127 ---
+ Documentation/driver-api/gpio/board.rst            |  65 ++
+ Documentation/driver-api/gpio/index.rst            |   1 +
+ Documentation/driver-api/gpio/legacy-boards.rst    | 298 +++++++
+ MAINTAINERS                                        |  12 +
+ drivers/gpio/Kconfig                               |  37 +-
+ drivers/gpio/Makefile                              |   1 +
+ drivers/gpio/TODO                                  |  17 -
+ drivers/gpio/gpio-aggregator.c                     | 410 +++++++--
+ drivers/gpio/gpio-amdpt.c                          |  44 +-
+ drivers/gpio/gpio-ath79.c                          |  88 +-
+ drivers/gpio/gpio-blzp1600.c                       |  39 +-
+ drivers/gpio/gpio-brcmstb.c                        | 114 +--
+ drivers/gpio/gpio-cadence.c                        |   2 +-
+ drivers/gpio/gpio-dwapb.c                          | 160 ++--
+ drivers/gpio/gpio-ep93xx.c                         |  33 +-
+ drivers/gpio/gpio-ftgpio010.c                      |  48 +-
+ drivers/gpio/gpio-ge.c                             |  25 +-
+ drivers/gpio/gpio-grgpio.c                         |  87 +-
+ drivers/gpio/gpio-hisi.c                           |  48 +-
+ drivers/gpio/gpio-hlwd.c                           | 105 +--
+ drivers/gpio/gpio-idt3243x.c                       |  45 +-
+ drivers/gpio/gpio-ixp4xx.c                         |  72 +-
+ drivers/gpio/gpio-loongson-64bit.c                 | 228 ++++-
+ drivers/gpio/gpio-loongson1.c                      |  40 +-
+ drivers/gpio/gpio-menz127.c                        |  31 +-
+ drivers/gpio/gpio-mlxbf.c                          |  25 +-
+ drivers/gpio/gpio-mlxbf2.c                         |  81 +-
+ drivers/gpio/gpio-mlxbf3.c                         | 101 +--
+ drivers/gpio/gpio-mmio.c                           | 363 ++++----
+ drivers/gpio/gpio-mpc8xxx.c                        | 105 ++-
+ drivers/gpio/gpio-mpfs.c                           |   2 +-
+ drivers/gpio/gpio-mt7621.c                         |  80 +-
+ drivers/gpio/gpio-mvebu.c                          |   3 +-
+ drivers/gpio/gpio-mxc.c                            |   2 +-
+ drivers/gpio/gpio-mxs.c                            |  31 +-
+ drivers/gpio/gpio-nct6694.c                        | 499 +++++++++++
+ drivers/gpio/gpio-nomadik.c                        |  27 +-
+ drivers/gpio/gpio-pisosr.c                         |   8 +-
+ drivers/gpio/gpio-rda.c                            |  35 +-
+ drivers/gpio/gpio-realtek-otto.c                   |  41 +-
+ drivers/gpio/gpio-sifive.c                         |  74 +-
+ drivers/gpio/gpio-sim.c                            |   3 +-
+ drivers/gpio/gpio-sodaville.c                      |  20 +-
+ drivers/gpio/gpio-spacemit-k1.c                    |  29 +-
+ drivers/gpio/gpio-stmpe.c                          |  34 +-
+ drivers/gpio/gpio-tb10x.c                          |  74 +-
+ drivers/gpio/gpio-tegra186.c                       |  28 +
+ drivers/gpio/gpio-ts4800.c                         |  39 +-
+ drivers/gpio/gpio-twl4030.c                        |   4 +-
+ drivers/gpio/gpio-vf610.c                          |  31 +-
+ drivers/gpio/gpio-visconti.c                       |  25 +-
+ drivers/gpio/gpio-wm831x.c                         |   5 +-
+ drivers/gpio/gpio-wm8994.c                         |   6 +-
+ drivers/gpio/gpio-xgene-sb.c                       |  58 +-
+ drivers/gpio/gpio-xgs-iproc.c                      |  34 +-
+ drivers/gpio/gpio-xra1403.c                        |   3 +-
+ drivers/gpio/gpiolib-cdev.c                        |  90 +-
+ drivers/gpio/gpiolib-of.c                          |   2 +-
+ drivers/gpio/gpiolib-sysfs.c                       |  46 +-
+ drivers/gpio/gpiolib.c                             | 195 +++--
+ drivers/gpio/gpiolib.h                             |  36 +-
+ drivers/hwmon/Kconfig                              |  10 +
+ drivers/hwmon/Makefile                             |   1 +
+ drivers/hwmon/nct6694-hwmon.c                      | 949 +++++++++++++++++++++
+ drivers/i2c/busses/Kconfig                         |  10 +
+ drivers/i2c/busses/Makefile                        |   1 +
+ drivers/i2c/busses/i2c-nct6694.c                   | 196 +++++
+ drivers/mfd/Kconfig                                |  25 +-
+ drivers/mfd/Makefile                               |   2 +
+ drivers/mfd/nct6694.c                              | 388 +++++++++
+ drivers/mfd/stmpe.c                                |   6 +
+ drivers/net/can/usb/Kconfig                        |  11 +
+ drivers/net/can/usb/Makefile                       |   1 +
+ drivers/net/can/usb/nct6694_canfd.c                | 832 ++++++++++++++++++
+ drivers/pinctrl/nomadik/pinctrl-nomadik.c          |   2 +-
+ drivers/pinctrl/nuvoton/pinctrl-npcm7xx.c          | 181 ++--
+ drivers/pinctrl/nuvoton/pinctrl-npcm8xx.c          | 154 ++--
+ drivers/pinctrl/nuvoton/pinctrl-wpcm450.c          |  46 +-
+ drivers/pinctrl/pinctrl-equilibrium.c              |  26 +-
+ drivers/pinctrl/pinctrl-equilibrium.h              |   2 +-
+ drivers/pinctrl/stm32/pinctrl-stm32-hdp.c          |  32 +-
+ drivers/rtc/Kconfig                                |  10 +
+ drivers/rtc/Makefile                               |   1 +
+ drivers/rtc/rtc-nct6694.c                          | 297 +++++++
+ drivers/watchdog/Kconfig                           |  11 +
+ drivers/watchdog/Makefile                          |   1 +
+ drivers/watchdog/nct6694_wdt.c                     | 307 +++++++
+ include/dt-bindings/gpio/tegra256-gpio.h           |  28 +
+ include/linux/gpio/driver.h                        | 105 ++-
+ include/linux/gpio/forwarder.h                     |  41 +
+ include/linux/gpio/generic.h                       | 102 ++-
+ include/linux/gpio/gpio-nomadik.h                  |   6 +-
+ include/linux/mfd/nct6694.h                        | 102 +++
+ include/linux/string_choices.h                     |   6 +
+ 102 files changed, 6688 insertions(+), 1776 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/pinctrl/fsl,mxs-pinctrl.txt
+ create mode 100644 Documentation/driver-api/gpio/legacy-boards.rst
+ create mode 100644 drivers/gpio/gpio-nct6694.c
+ create mode 100644 drivers/hwmon/nct6694-hwmon.c
+ create mode 100644 drivers/i2c/busses/i2c-nct6694.c
+ create mode 100644 drivers/mfd/nct6694.c
+ create mode 100644 drivers/net/can/usb/nct6694_canfd.c
+ create mode 100644 drivers/rtc/rtc-nct6694.c
+ create mode 100644 drivers/watchdog/nct6694_wdt.c
+ create mode 100644 include/dt-bindings/gpio/tegra256-gpio.h
+ create mode 100644 include/linux/gpio/forwarder.h
+ create mode 100644 include/linux/mfd/nct6694.h
+Merging gpio-intel/for-next (19c839a98c731 gpiolib: acpi: initialize acpi_gpio_info struct)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-gpio-intel.git gpio-intel/for-next
+Already up to date.
+Merging pinctrl/for-next (da3a88e9656c1 pinctrl: use more common syntax for compound literals)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/linusw/linux-pinctrl.git pinctrl/for-next
+Auto-merging Documentation/driver-api/pin-control.rst
+Auto-merging drivers/pinctrl/Kconfig
+Auto-merging drivers/pinctrl/Makefile
+Auto-merging drivers/pinctrl/mediatek/pinctrl-airoha.c
+Auto-merging drivers/pinctrl/meson/pinctrl-amlogic-a4.c
+Auto-merging drivers/pinctrl/nuvoton/pinctrl-npcm7xx.c
+Auto-merging drivers/pinctrl/nuvoton/pinctrl-npcm8xx.c
+Auto-merging drivers/pinctrl/nuvoton/pinctrl-wpcm450.c
+Auto-merging drivers/pinctrl/pinctrl-zynqmp.c
+Auto-merging drivers/pinctrl/stm32/pinctrl-stm32-hdp.c
+Merge made by the 'ort' strategy.
+ .../bindings/pinctrl/brcm,bcm2712c0-pinctrl.yaml   |  137 ++
+ .../bindings/pinctrl/brcm,bcm2835-gpio.txt         |   99 -
+ .../bindings/pinctrl/brcm,bcm2835-gpio.yaml        |  120 ++
+ .../bindings/pinctrl/brcm,iproc-gpio.txt           |  123 --
+ .../bindings/pinctrl/brcm,iproc-gpio.yaml          |  111 ++
+ .../bindings/pinctrl/mediatek,mt8183-pinctrl.yaml  |    2 +
+ .../bindings/pinctrl/nvidia,tegra186-pinmux.yaml   |  285 +++
+ .../bindings/pinctrl/qcom,glymur-tlmm.yaml         |  133 ++
+ .../pinctrl/qcom,sc7280-lpass-lpi-pinctrl.yaml     |   16 +
+ .../pinctrl/qcom,sdm660-lpass-lpi-pinctrl.yaml     |  109 ++
+ .../bindings/pinctrl/raspberrypi,rp1-gpio.yaml     |   35 +-
+ .../pinctrl/samsung,pinctrl-wakeup-interrupt.yaml  |   19 +-
+ .../bindings/pinctrl/samsung,pinctrl.yaml          |    5 +-
+ Documentation/driver-api/pin-control.rst           |    4 +-
+ drivers/base/devres.c                              |   21 +
+ drivers/gpio/gpio-rockchip.c                       |    2 +-
+ drivers/pinctrl/Kconfig                            |   23 +-
+ drivers/pinctrl/Makefile                           |    1 +
+ drivers/pinctrl/bcm/Kconfig                        |   12 +
+ drivers/pinctrl/bcm/Kconfig.stb                    |   10 +
+ drivers/pinctrl/bcm/Makefile                       |    2 +
+ drivers/pinctrl/bcm/pinctrl-bcm2835.c              |    6 +-
+ drivers/pinctrl/bcm/pinctrl-bcm6358.c              |    4 +-
+ drivers/pinctrl/bcm/pinctrl-brcmstb-bcm2712.c      |  747 ++++++++
+ drivers/pinctrl/bcm/pinctrl-brcmstb.c              |  442 +++++
+ drivers/pinctrl/bcm/pinctrl-brcmstb.h              |   93 +
+ drivers/pinctrl/cirrus/pinctrl-madera-core.c       |    4 +-
+ drivers/pinctrl/freescale/pinctrl-imx.c            |   45 +-
+ drivers/pinctrl/mediatek/pinctrl-airoha.c          |   23 +-
+ drivers/pinctrl/mediatek/pinctrl-moore.c           |   12 +-
+ drivers/pinctrl/mediatek/pinctrl-moore.h           |    7 +-
+ drivers/pinctrl/mediatek/pinctrl-mt7622.c          |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-mt7623.c          |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-mt7629.c          |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-mt7981.c          |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-mt7986.c          |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-mt7988.c          |   44 +-
+ drivers/pinctrl/mediatek/pinctrl-mtk-common-v2.h   |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-mtk-common.c      |    2 +-
+ drivers/pinctrl/mediatek/pinctrl-paris.c           |    4 +-
+ drivers/pinctrl/meson/pinctrl-amlogic-a4.c         |    6 +-
+ drivers/pinctrl/meson/pinctrl-meson-g12a.c         |    8 +
+ drivers/pinctrl/meson/pinctrl-meson-gxl.c          |   10 +
+ drivers/pinctrl/meson/pinctrl-meson.c              |    6 +-
+ drivers/pinctrl/mvebu/pinctrl-armada-37xx.c        |    6 +-
+ drivers/pinctrl/nomadik/pinctrl-abx500.c           |    6 +-
+ drivers/pinctrl/nuvoton/pinctrl-ma35.c             |    3 +-
+ drivers/pinctrl/nuvoton/pinctrl-npcm7xx.c          |    8 +-
+ drivers/pinctrl/nuvoton/pinctrl-npcm8xx.c          |    8 +-
+ drivers/pinctrl/nuvoton/pinctrl-wpcm450.c          |    2 +-
+ drivers/pinctrl/pinconf-generic.c                  |    6 +-
+ drivers/pinctrl/pinctrl-amd.c                      |   41 +-
+ drivers/pinctrl/pinctrl-at91-pio4.c                |    2 +-
+ drivers/pinctrl/pinctrl-aw9523.c                   |    6 +-
+ drivers/pinctrl/pinctrl-cy8c95x0.c                 |    2 +-
+ drivers/pinctrl/pinctrl-eic7700.c                  |    2 +-
+ drivers/pinctrl/pinctrl-equilibrium.c              |    6 +-
+ drivers/pinctrl/pinctrl-ingenic.c                  |   53 +-
+ drivers/pinctrl/pinctrl-k210.c                     |    2 +-
+ drivers/pinctrl/pinctrl-keembay.c                  |   30 +-
+ drivers/pinctrl/pinctrl-microchip-sgpio.c          |    6 +-
+ drivers/pinctrl/pinctrl-ocelot.c                   |    4 +-
+ drivers/pinctrl/pinctrl-pic32.c                    |    4 +-
+ drivers/pinctrl/pinctrl-rk805.c                    |    4 +-
+ drivers/pinctrl/pinctrl-rockchip.c                 |    6 +-
+ drivers/pinctrl/pinctrl-rp1.c                      |   96 +-
+ drivers/pinctrl/pinctrl-scmi.c                     |    2 +-
+ drivers/pinctrl/pinctrl-single.c                   |    8 +-
+ drivers/pinctrl/pinctrl-stmfx.c                    |    4 +-
+ drivers/pinctrl/pinctrl-sx150x.c                   |   12 +-
+ drivers/pinctrl/pinctrl-upboard.c                  | 1070 +++++++++++
+ drivers/pinctrl/pinctrl-zynqmp.c                   |    2 +-
+ drivers/pinctrl/pinmux.c                           |   70 +-
+ drivers/pinctrl/pinmux.h                           |    9 +-
+ drivers/pinctrl/qcom/Kconfig                       |   11 +
+ drivers/pinctrl/qcom/Kconfig.msm                   |   10 +
+ drivers/pinctrl/qcom/Makefile                      |    2 +
+ drivers/pinctrl/qcom/pinctrl-glymur.c              | 1777 ++++++++++++++++++
+ drivers/pinctrl/qcom/pinctrl-ipq5018.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-ipq5332.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-ipq5424.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-ipq6018.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-ipq8074.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-ipq9574.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-lpass-lpi.c           |   26 +-
+ drivers/pinctrl/qcom/pinctrl-lpass-lpi.h           |   18 +
+ drivers/pinctrl/qcom/pinctrl-mdm9607.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-mdm9615.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-milos.c               |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm.c                 |   51 +-
+ drivers/pinctrl/qcom/pinctrl-msm.h                 |    5 +
+ drivers/pinctrl/qcom/pinctrl-msm8226.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8660.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8909.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8916.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8917.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8953.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8960.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8976.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8994.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8996.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8998.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-msm8x74.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-qcm2290.c             |    4 +-
+ drivers/pinctrl/qcom/pinctrl-qcs404.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-qcs615.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-qcs8300.c             |    4 +-
+ drivers/pinctrl/qcom/pinctrl-qdu1000.c             |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sa8775p.c             |    4 +-
+ drivers/pinctrl/qcom/pinctrl-sar2130p.c            |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sc7180.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sc7280.c              |    4 +-
+ drivers/pinctrl/qcom/pinctrl-sc8180x.c             |    4 +-
+ drivers/pinctrl/qcom/pinctrl-sc8280xp.c            |    4 +-
+ drivers/pinctrl/qcom/pinctrl-sdm660-lpass-lpi.c    |  160 ++
+ drivers/pinctrl/qcom/pinctrl-sdm660.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sdm670.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sdm845.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sdx55.c               |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sdx65.c               |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sdx75.c               |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm4450.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm6115.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm6125.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm6350.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm6375.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm7150.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm8150.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm8250.c              |   83 +-
+ drivers/pinctrl/qcom/pinctrl-sm8350.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm8450.c              |    4 +-
+ drivers/pinctrl/qcom/pinctrl-sm8550.c              |    2 +-
+ drivers/pinctrl/qcom/pinctrl-sm8650.c              |    4 +-
+ drivers/pinctrl/qcom/pinctrl-sm8750.c              |    4 +-
+ drivers/pinctrl/qcom/pinctrl-spmi-gpio.c           |    8 +-
+ drivers/pinctrl/qcom/pinctrl-spmi-mpp.c            |    8 +-
+ drivers/pinctrl/qcom/pinctrl-ssbi-gpio.c           |    4 +-
+ drivers/pinctrl/qcom/pinctrl-ssbi-mpp.c            |    4 +-
+ drivers/pinctrl/qcom/pinctrl-x1e80100.c            |    2 +-
+ drivers/pinctrl/renesas/Kconfig                    |   13 +
+ drivers/pinctrl/renesas/Makefile                   |    1 +
+ drivers/pinctrl/renesas/pfc-r8a779g0.c             |    2 +-
+ drivers/pinctrl/renesas/pinctrl-rza1.c             |    4 +-
+ drivers/pinctrl/renesas/pinctrl-rza2.c             |    2 +-
+ drivers/pinctrl/renesas/pinctrl-rzg2l.c            |  222 +--
+ drivers/pinctrl/renesas/pinctrl-rzt2h.c            |  813 ++++++++
+ drivers/pinctrl/renesas/pinctrl-rzv2m.c            |    2 +-
+ drivers/pinctrl/renesas/pinctrl.c                  |    3 +-
+ drivers/pinctrl/samsung/pinctrl-exynos-arm64.c     |   50 +
+ drivers/pinctrl/samsung/pinctrl-exynos.h           |   10 +
+ drivers/pinctrl/samsung/pinctrl-samsung.c          |    2 +
+ drivers/pinctrl/samsung/pinctrl-samsung.h          |    5 +-
+ drivers/pinctrl/spacemit/pinctrl-k1.c              |    4 +-
+ drivers/pinctrl/sprd/pinctrl-sprd.c                |    9 +-
+ drivers/pinctrl/stm32/pinctrl-stm32-hdp.c          |    4 +-
+ drivers/pinctrl/stm32/pinctrl-stm32.c              |    2 +-
+ drivers/pinctrl/sunplus/sppctl.c                   |    4 +-
+ drivers/pinctrl/sunxi/pinctrl-sunxi-dt.c           |   11 +-
+ drivers/pinctrl/tegra/Kconfig                      |    4 +
+ drivers/pinctrl/tegra/Makefile                     |    1 +
+ drivers/pinctrl/tegra/pinctrl-tegra186.c           | 1979 ++++++++++++++++++++
+ drivers/soc/tegra/Kconfig                          |    1 +
+ include/linux/device/devres.h                      |    2 +
+ include/linux/pinctrl/pinconf-generic.h            |   12 +-
+ include/linux/pinctrl/pinctrl.h                    |   14 +
+ include/linux/pinctrl/pinmux.h                     |    2 +
+ sound/hda/codecs/side-codecs/cirrus_scodec_test.c  |    2 +-
+ 167 files changed, 8924 insertions(+), 767 deletions(-)
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/brcm,bcm2712c0-pinctrl.yaml
+ delete mode 100644 Documentation/devicetree/bindings/pinctrl/brcm,bcm2835-gpio.txt
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/brcm,bcm2835-gpio.yaml
+ delete mode 100644 Documentation/devicetree/bindings/pinctrl/brcm,iproc-gpio.txt
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/brcm,iproc-gpio.yaml
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/nvidia,tegra186-pinmux.yaml
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/qcom,glymur-tlmm.yaml
+ create mode 100644 Documentation/devicetree/bindings/pinctrl/qcom,sdm660-lpass-lpi-pinctrl.yaml
+ create mode 100644 drivers/pinctrl/bcm/Kconfig.stb
+ create mode 100644 drivers/pinctrl/bcm/pinctrl-brcmstb-bcm2712.c
+ create mode 100644 drivers/pinctrl/bcm/pinctrl-brcmstb.c
+ create mode 100644 drivers/pinctrl/bcm/pinctrl-brcmstb.h
+ create mode 100644 drivers/pinctrl/pinctrl-upboard.c
+ create mode 100644 drivers/pinctrl/qcom/pinctrl-glymur.c
+ create mode 100644 drivers/pinctrl/qcom/pinctrl-sdm660-lpass-lpi.c
+ create mode 100644 drivers/pinctrl/renesas/pinctrl-rzt2h.c
+ create mode 100644 drivers/pinctrl/tegra/pinctrl-tegra186.c
+Merging pinctrl-intel/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/intel.git pinctrl-intel/for-next
+Already up to date.
+Merging pinctrl-renesas/renesas-pinctrl (512bf60226c62 pinctrl: renesas: r8a779g0: Fix trivial typo in SoC type comment)
+$ git merge -m Merge branch 'renesas-pinctrl' of https://git.kernel.org/pub/scm/linux/kernel/git/geert/renesas-drivers.git pinctrl-renesas/renesas-pinctrl
+Already up to date.
+Merging pinctrl-samsung/for-next (d37db94b07819 dt-bindings: pinctrl: samsung: Drop S3C2410)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/pinctrl/samsung.git pinctrl-samsung/for-next
+Already up to date.
+Merging pwm/pwm/for-next (8f2689f194b8d pwm: cros-ec: Avoid -Wflex-array-member-not-at-end warnings)
+$ git merge -m Merge branch 'pwm/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ukleinek/linux.git pwm/pwm/for-next
+Auto-merging drivers/pwm/Kconfig
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/pwm/apple,s5l-fpwm.yaml    |   3 +-
+ .../devicetree/bindings/pwm/fsl,vf610-ftm-pwm.yaml |  11 +-
+ .../bindings/pwm/nxp,lpc1850-sct-pwm.yaml          |   2 +-
+ .../devicetree/bindings/pwm/pwm-samsung.yaml       |   1 +
+ .../devicetree/bindings/timer/renesas,rz-mtu3.yaml |   7 +-
+ drivers/pwm/Kconfig                                |   9 +
+ drivers/pwm/core.c                                 | 108 +++-
+ drivers/pwm/pwm-berlin.c                           |   4 +-
+ drivers/pwm/pwm-cros-ec.c                          |  10 +-
+ drivers/pwm/pwm-fsl-ftm.c                          |  35 +-
+ drivers/pwm/pwm-loongson.c                         |   2 +-
+ drivers/pwm/pwm-mediatek.c                         | 312 ++++++++----
+ drivers/pwm/pwm-pca9685.c                          | 555 +++++++++------------
+ drivers/pwm/pwm-tiecap.c                           |   4 +
+ drivers/pwm/pwm-tiehrpwm.c                         | 154 +++---
+ include/linux/pwm.h                                |   3 +
+ 16 files changed, 683 insertions(+), 537 deletions(-)
+Merging ktest/for-next (a5e71638ddd7f ktest.pl: Add new PATCHCHECK_SKIP option to skip testing individual commits)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/rostedt/linux-ktest.git ktest/for-next
+Already up to date.
+Merging kselftest/next (1969201341548 MAINTAINERS: add myself and Barry to dma_map_benchmark maintainers)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git kselftest/next
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ MAINTAINERS                                        | 5 +++--
+ tools/testing/selftests/kexec/.gitignore           | 2 ++
+ tools/testing/selftests/kselftest_harness/Makefile | 1 +
+ tools/testing/selftests/lib.mk                     | 5 ++++-
+ tools/testing/selftests/watchdog/watchdog-test.c   | 6 ++++++
+ 5 files changed, 16 insertions(+), 3 deletions(-)
+ create mode 100644 tools/testing/selftests/kexec/.gitignore
+Merging kunit/test (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'test' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git kunit/test
+Already up to date.
+Merging kunit-next/kunit (285cae57a5166 kunit: Extend kconfig help text for KUNIT_UML_PCI)
+$ git merge -m Merge branch 'kunit' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git kunit-next/kunit
+Auto-merging drivers/gpu/drm/xe/tests/xe_pci.c
+CONFLICT (content): Merge conflict in drivers/gpu/drm/xe/tests/xe_pci.c
+Auto-merging drivers/gpu/drm/xe/tests/xe_pci_test.h
+Resolved 'drivers/gpu/drm/xe/tests/xe_pci.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 89ef881225ce3] Merge branch 'kunit' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/dev-tools/kunit/usage.rst            | 342 ++++++++++++++++++++-
+ drivers/gpu/drm/xe/tests/xe_pci.c                  |  18 +-
+ drivers/gpu/drm/xe/tests/xe_pci_test.h             |   9 +-
+ include/kunit/test.h                               |  95 +++++-
+ kernel/kcsan/kcsan_test.c                          |   2 +-
+ lib/Makefile                                       |   4 -
+ lib/kunit/Kconfig                                  |  11 +
+ lib/kunit/Makefile                                 |   2 +-
+ lib/kunit/kunit-example-test.c                     | 217 +++++++++++++
+ lib/kunit/test.c                                   |  94 +++++-
+ rust/kernel/kunit.rs                               |  11 +
+ rust/macros/kunit.rs                               |  48 ++-
+ tools/testing/kunit/configs/arch_uml.config        |   5 +-
+ tools/testing/kunit/kunit.py                       |   4 +-
+ tools/testing/kunit/kunit_parser.py                |   8 +-
+ tools/testing/kunit/qemu_configs/mips.py           |  18 ++
+ tools/testing/kunit/qemu_configs/mips64.py         |  19 ++
+ tools/testing/kunit/qemu_configs/mips64el.py       |  19 ++
+ tools/testing/kunit/qemu_configs/mipsel.py         |  18 ++
+ .../test_data/test_is_test_passed-kselftest.log    |   3 +-
+ 20 files changed, 882 insertions(+), 65 deletions(-)
+ create mode 100644 tools/testing/kunit/qemu_configs/mips.py
+ create mode 100644 tools/testing/kunit/qemu_configs/mips64.py
+ create mode 100644 tools/testing/kunit/qemu_configs/mips64el.py
+ create mode 100644 tools/testing/kunit/qemu_configs/mipsel.py
+$ git am -3 ../patches/0001-fix-up-for-kunit-Pass-parameterized-test-context-to-.patch
+Applying: fix up for "kunit: Pass parameterized test context to generate_params()"
+$ git reset HEAD^
+Unstaged changes after reset:
+M	drivers/gpu/drm/xe/tests/xe_pci.c
+M	drivers/gpu/drm/xe/tests/xe_pci_test.h
+$ git add -A .
+$ git commit -v -a --amend
+warning: notes ref refs/notes/commits is invalid
+[master b24f9fa74f1a8] Merge branch 'kunit' of https://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git
+ Date: Mon Sep 29 15:40:37 2025 +0100
+Merging livepatching/for-next (dcf9f31c62b3d Merge tag 'livepatching-for-6.15' of git://git.kernel.org/pub/scm/linux/kernel/git/livepatching/livepatching)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/livepatching/livepatching.git livepatching/for-next
+Already up to date.
+Merging rtc/rtc-next (a6de182daa2b1 rtc: spacemit: support the SpacemiT P1 RTC)
+$ git merge -m Merge branch 'rtc-next' of https://git.kernel.org/pub/scm/linux/kernel/git/abelloni/linux.git rtc/rtc-next
+Auto-merging drivers/rtc/Kconfig
+Auto-merging drivers/rtc/Makefile
+Merge made by the 'ort' strategy.
+ .../devicetree/bindings/rtc/isil,isl12057.txt      |  74 ----
+ .../devicetree/bindings/rtc/nxp,pcf85063.yaml      |  10 -
+ Documentation/devicetree/bindings/rtc/s3c-rtc.yaml |  40 +-
+ .../devicetree/bindings/rtc/trivial-rtc.yaml       |   6 +-
+ drivers/rtc/Kconfig                                |  10 +
+ drivers/rtc/Makefile                               |   1 +
+ drivers/rtc/rtc-efi.c                              |  76 +---
+ drivers/rtc/rtc-meson.c                            |   1 -
+ drivers/rtc/rtc-optee.c                            | 464 +++++++++++++++++++--
+ drivers/rtc/rtc-pcf2127.c                          |   4 +-
+ drivers/rtc/rtc-s3c.c                              |  49 +--
+ drivers/rtc/rtc-s3c.h                              |  19 -
+ drivers/rtc/rtc-spacemit-p1.c                      | 167 ++++++++
+ drivers/rtc/rtc-x1205.c                            |   2 +-
+ 14 files changed, 619 insertions(+), 304 deletions(-)
+ delete mode 100644 Documentation/devicetree/bindings/rtc/isil,isl12057.txt
+ create mode 100644 drivers/rtc/rtc-spacemit-p1.c
+Merging nvdimm/libnvdimm-for-next (a9e6aa994917e nvdimm: ndtest: Return -ENOMEM if devm_kcalloc() fails in ndtest_probe())
+$ git merge -m Merge branch 'libnvdimm-for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/nvdimm/nvdimm.git nvdimm/libnvdimm-for-next
+Merge made by the 'ort' strategy.
+ drivers/acpi/nfit/core.c           |   2 +-
+ drivers/nvdimm/badrange.c          |   3 +-
+ drivers/nvdimm/btt_devs.c          |  24 +++-----
+ drivers/nvdimm/bus.c               |  71 ++++++++--------------
+ drivers/nvdimm/claim.c             |   7 +--
+ drivers/nvdimm/core.c              |  17 +++---
+ drivers/nvdimm/dax_devs.c          |  12 ++--
+ drivers/nvdimm/dimm.c              |   5 +-
+ drivers/nvdimm/dimm_devs.c         |  48 ++++++---------
+ drivers/nvdimm/namespace_devs.c    | 121 +++++++++++++++++++------------------
+ drivers/nvdimm/nd.h                |   3 +
+ drivers/nvdimm/pfn_devs.c          |  61 ++++++++-----------
+ drivers/nvdimm/region.c            |  16 ++---
+ drivers/nvdimm/region_devs.c       | 118 +++++++++++++++---------------------
+ drivers/nvdimm/security.c          |  10 +--
+ tools/testing/nvdimm/test/ndtest.c |  13 +++-
+ 16 files changed, 232 insertions(+), 299 deletions(-)
+Merging at24/at24/for-next (c7ec58c39b025 dt-bindings: eeprom: at24: Add compatible for Giantec GT24C256C)
+$ git merge -m Merge branch 'at24/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git at24/at24/for-next
+Already up to date.
+Merging ntb/ntb-next (68113d2606740 NTB/msi: Remove unused functions)
+$ git merge -m Merge branch 'ntb-next' of https://github.com/jonmason/ntb.git ntb/ntb-next
+Auto-merging MAINTAINERS
+Merge made by the 'ort' strategy.
+ MAINTAINERS                            |   1 +
+ drivers/ntb/hw/amd/ntb_hw_amd.c        |  18 ++++-
+ drivers/ntb/hw/amd/ntb_hw_amd.h        |   1 +
+ drivers/ntb/hw/epf/ntb_hw_epf.c        | 118 +++++++++++++++++++--------------
+ drivers/ntb/hw/mscc/ntb_hw_switchtec.c |  14 +++-
+ drivers/ntb/msi.c                      |  64 ------------------
+ drivers/ntb/ntb_transport.c            |   7 ++
+ include/linux/ntb.h                    |  14 ----
+ 8 files changed, 105 insertions(+), 132 deletions(-)
+Merging seccomp/for-next/seccomp (b0c9bfbab925a selftests/seccomp: Add a test for the WAIT_KILLABLE_RECV fast reply race)
+$ git merge -m Merge branch 'for-next/seccomp' of https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git seccomp/for-next/seccomp
+Auto-merging kernel/seccomp.c
+Auto-merging tools/testing/selftests/seccomp/seccomp_bpf.c
+Merge made by the 'ort' strategy.
+ kernel/seccomp.c                              |  12 +--
+ tools/testing/selftests/seccomp/seccomp_bpf.c | 131 ++++++++++++++++++++++++++
+ 2 files changed, 136 insertions(+), 7 deletions(-)
+Merging slimbus/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/srini/slimbus.git slimbus/for-next
+Already up to date.
+Merging nvmem/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/srini/nvmem.git nvmem/for-next
+Already up to date.
+Merging xarray/main (6684aba0780da XArray: Add extra debugging check to xas_lock and friends)
+$ git merge -m Merge branch 'main' of git://git.infradead.org/users/willy/xarray.git xarray/main
+Auto-merging include/linux/xarray.h
+Auto-merging lib/xarray.c
+Merge made by the 'ort' strategy.
+ include/linux/xarray.h | 60 +++++++++++++++++++++++++++-----------------------
+ lib/xarray.c           |  3 +--
+ 2 files changed, 34 insertions(+), 29 deletions(-)
+Merging hyperv/hyperv-next (553d825fb2f0a x86/hyperv: Switch to msi_create_parent_irq_domain())
+$ git merge -m Merge branch 'hyperv-next' of https://git.kernel.org/pub/scm/linux/kernel/git/hyperv/linux.git hyperv/hyperv-next
+Auto-merging MAINTAINERS
+Auto-merging arch/arm64/kvm/Kconfig
+Auto-merging arch/arm64/kvm/arm.c
+Auto-merging arch/loongarch/kvm/vcpu.c
+Auto-merging arch/riscv/kvm/vcpu.c
+Auto-merging arch/x86/hyperv/ivm.c
+Auto-merging arch/x86/kernel/cpu/mshyperv.c
+Auto-merging arch/x86/kvm/Kconfig
+Auto-merging arch/x86/kvm/vmx/vmx.c
+Auto-merging arch/x86/kvm/x86.c
+Auto-merging include/linux/kvm_host.h
+Auto-merging include/linux/rcupdate.h
+Auto-merging kernel/rcu/tree.c
+Auto-merging virt/kvm/Kconfig
+Merge made by the 'ort' strategy.
+ MAINTAINERS                                 |   2 +-
+ arch/arm64/kvm/Kconfig                      |   2 +-
+ arch/arm64/kvm/arm.c                        |   3 +-
+ arch/loongarch/kvm/Kconfig                  |   2 +-
+ arch/loongarch/kvm/vcpu.c                   |   3 +-
+ arch/riscv/kvm/Kconfig                      |   2 +-
+ arch/riscv/kvm/vcpu.c                       |   3 +-
+ arch/x86/hyperv/irqdomain.c                 | 111 ++++++++++-----
+ arch/x86/hyperv/ivm.c                       | 211 +++++++++++++++++++++++++++-
+ arch/x86/kernel/cpu/mshyperv.c              |  11 +-
+ arch/x86/kvm/Kconfig                        |   2 +-
+ arch/x86/kvm/vmx/vmx.c                      |   1 -
+ arch/x86/kvm/x86.c                          |   3 +-
+ drivers/clocksource/hyperv_timer.c          |  10 +-
+ drivers/hv/Kconfig                          |   2 +
+ drivers/hv/channel.c                        |   2 +-
+ drivers/hv/hv_common.c                      |  22 +--
+ drivers/hv/hv_utils_transport.c             |  10 +-
+ drivers/hv/mshv.h                           |   2 -
+ drivers/hv/mshv_common.c                    |  22 ---
+ drivers/hv/mshv_root_main.c                 |  57 +++-----
+ include/asm-generic/mshyperv.h              |  11 ++
+ include/hyperv/hvhdk_mini.h                 |   1 +
+ include/linux/{entry-kvm.h => entry-virt.h} |  19 +--
+ include/linux/hyperv.h                      |   7 +-
+ include/linux/kvm_host.h                    |  17 ++-
+ include/linux/rcupdate.h                    |   2 +-
+ kernel/entry/Makefile                       |   2 +-
+ kernel/entry/{kvm.c => virt.c}              |  15 +-
+ kernel/rcu/tree.c                           |   6 +-
+ virt/kvm/Kconfig                            |   2 +-
+ 31 files changed, 400 insertions(+), 165 deletions(-)
+ rename include/linux/{entry-kvm.h => entry-virt.h} (83%)
+ rename kernel/entry/{kvm.c => virt.c} (66%)
+Merging auxdisplay/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/andy/linux-auxdisplay.git auxdisplay/for-next
+Already up to date.
+Merging kgdb/kgdb/for-next (fdbdd0ccb30af kdb: remove redundant check for scancode 0xe0)
+$ git merge -m Merge branch 'kgdb/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/danielt/linux.git kgdb/kgdb/for-next
+Merge made by the 'ort' strategy.
+ kernel/debug/gdbstub.c          | 29 +++++++++++++++--------------
+ kernel/debug/kdb/kdb_io.c       | 14 ++++++++------
+ kernel/debug/kdb/kdb_keyboard.c |  3 ---
+ kernel/debug/kdb/kdb_main.c     | 14 +++-----------
+ kernel/debug/kdb/kdb_private.h  |  1 +
+ kernel/debug/kdb/kdb_support.c  | 35 +++++++++++++++++++++++++++++++++--
+ 6 files changed, 60 insertions(+), 36 deletions(-)
+Merging hmm/hmm (19272b37aa4f8 Linux 6.16-rc1)
+$ git merge -m Merge branch 'hmm' of https://git.kernel.org/pub/scm/linux/kernel/git/rdma/rdma.git hmm/hmm
+Already up to date.
+Merging cfi/cfi/next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'cfi/next' of https://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux.git cfi/cfi/next
+Already up to date.
+Merging mhi/mhi-next (54c67740fff73 bus: mhi: host: pci_generic: Set DMA mask for VFs)
+$ git merge -m Merge branch 'mhi-next' of https://git.kernel.org/pub/scm/linux/kernel/git/mani/mhi.git mhi/mhi-next
+Already up to date.
+Merging memblock/for-next (e68f150bc11d0 memblock: drop for_each_free_mem_pfn_range_in_zone_from())
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/rppt/memblock.git memblock/for-next
+Auto-merging mm/memblock.c
+Auto-merging mm/mm_init.c
+Merge made by the 'ort' strategy.
+ .clang-format            |   1 -
+ include/linux/memblock.h |  22 ------
+ mm/memblock.c            |  64 ---------------
+ mm/mm_init.c             | 201 ++++++++++++++++-------------------------------
+ 4 files changed, 67 insertions(+), 221 deletions(-)
+Merging cxl/next (46037455cbb74 Merge branch 'for-6.18/cxl-delay-dport' into cxl-for-next)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/cxl/cxl.git cxl/next
+Auto-merging drivers/base/node.c
+Auto-merging include/acpi/actbl1.h
+Merge made by the 'ort' strategy.
+ Documentation/ABI/testing/debugfs-cxl              |  87 ++++++
+ Documentation/driver-api/cxl/conventions.rst       | 135 +++++++++
+ Documentation/driver-api/cxl/maturity-map.rst      |   2 +-
+ .../driver-api/cxl/platform/bios-and-efi.rst       |   2 +-
+ drivers/acpi/numa/hmat.c                           |  34 ---
+ drivers/base/node.c                                |  38 +++
+ drivers/cxl/acpi.c                                 |  46 +--
+ drivers/cxl/core/cdat.c                            |  36 +--
+ drivers/cxl/core/core.h                            |  12 +-
+ drivers/cxl/core/hdm.c                             | 107 +++++--
+ drivers/cxl/core/memdev.c                          |  60 ++--
+ drivers/cxl/core/pci.c                             |  89 ++++++
+ drivers/cxl/core/port.c                            | 319 ++++++++++++++++-----
+ drivers/cxl/core/region.c                          | 266 ++++++++++++++++-
+ drivers/cxl/cxl.h                                  |  57 +++-
+ drivers/cxl/cxlmem.h                               |   2 +
+ drivers/cxl/cxlpci.h                               |   2 -
+ drivers/cxl/port.c                                 |  47 +--
+ include/acpi/actbl1.h                              |   4 +-
+ include/linux/acpi.h                               |  12 -
+ include/linux/memory.h                             |   6 +-
+ include/linux/node.h                               |   8 +
+ tools/testing/cxl/Kbuild                           |   7 +-
+ tools/testing/cxl/cxl_core_exports.c               |  22 ++
+ tools/testing/cxl/exports.h                        |  13 +
+ tools/testing/cxl/test/cxl.c                       | 133 +++++++--
+ tools/testing/cxl/test/mock.c                      |  96 +++----
+ tools/testing/cxl/test/mock.h                      |   9 +-
+ 28 files changed, 1261 insertions(+), 390 deletions(-)
+ create mode 100644 tools/testing/cxl/exports.h
+Merging zstd/zstd-next (65d1f5507ed2c zstd: Import upstream v1.5.7)
+$ git merge -m Merge branch 'zstd-next' of https://github.com/terrelln/linux.git zstd/zstd-next
+Already up to date.
+Merging efi/next (ea62db903f0ba efi/runtime: Deal with arch_efi_call_virt_setup() returning failure)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/efi/efi.git efi/next
+Auto-merging arch/arm64/kernel/efi.c
+Auto-merging arch/x86/platform/efi/efi_64.c
+Auto-merging include/linux/efi.h
+Merge made by the 'ort' strategy.
+ arch/arm/include/asm/efi.h              |  2 +-
+ arch/arm64/include/asm/efi.h            |  2 +-
+ arch/arm64/kernel/efi.c                 |  3 ++-
+ arch/loongarch/include/asm/efi.h        |  2 +-
+ arch/riscv/include/asm/efi.h            |  2 +-
+ arch/x86/include/asm/efi.h              |  2 +-
+ arch/x86/platform/efi/efi_32.c          |  3 ++-
+ arch/x86/platform/efi/efi_64.c          |  3 ++-
+ arch/x86/platform/uv/bios_uv.c          |  3 ++-
+ drivers/firmware/efi/efi.c              |  3 +++
+ drivers/firmware/efi/riscv-runtime.c    |  3 ++-
+ drivers/firmware/efi/runtime-wrappers.c | 20 +++++++++++++-------
+ include/linux/efi.h                     |  8 ++++----
+ 13 files changed, 35 insertions(+), 21 deletions(-)
+Merging unicode/for-next (6b56a63d286f6 MAINTAINERS: Add Unicode tree)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/krisman/unicode.git unicode/for-next
+Already up to date.
+Merging slab/slab/for-next (ca74b8cadaad4 Merge series "slab: Re-entrant kmalloc_nolock()")
+$ git merge -m Merge branch 'slab/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/vbabka/slab.git slab/slab/for-next
+Auto-merging include/linux/kasan.h
+Auto-merging include/linux/maple_tree.h
+Auto-merging include/linux/memcontrol.h
+Auto-merging include/linux/slab.h
+Auto-merging kernel/bpf/syscall.c
+Auto-merging lib/maple_tree.c
+Auto-merging lib/test_maple_tree.c
+Auto-merging mm/Kconfig
+Auto-merging mm/internal.h
+Auto-merging mm/kasan/common.c
+Auto-merging mm/page_alloc.c
+Auto-merging mm/slab.h
+Auto-merging mm/slub.c
+Auto-merging mm/vma_init.c
+Auto-merging tools/testing/radix-tree/maple.c
+Auto-merging tools/testing/vma/vma_internal.h
+Merge made by the 'ort' strategy.
+ include/linux/gfp.h                 |    2 +-
+ include/linux/kasan.h               |   13 +-
+ include/linux/local_lock.h          |    2 +
+ include/linux/local_lock_internal.h |   16 +-
+ include/linux/maple_tree.h          |    6 +-
+ include/linux/memcontrol.h          |   12 +-
+ include/linux/rtmutex.h             |   10 +
+ include/linux/slab.h                |   51 +
+ kernel/bpf/stream.c                 |    2 +-
+ kernel/bpf/syscall.c                |    2 +-
+ kernel/locking/rtmutex_common.h     |    9 -
+ lib/maple_tree.c                    |  679 ++--------
+ lib/test_maple_tree.c               |  137 --
+ mm/Kconfig                          |    1 +
+ mm/internal.h                       |    4 +
+ mm/kasan/common.c                   |    5 +-
+ mm/page_alloc.c                     |   55 +-
+ mm/slab.h                           |   20 +-
+ mm/slab_common.c                    |   37 +-
+ mm/slub.c                           | 2361 +++++++++++++++++++++++++++++++++--
+ mm/vma_init.c                       |    1 +
+ tools/include/linux/slab.h          |  165 ++-
+ tools/testing/radix-tree/maple.c    |  514 +-------
+ tools/testing/shared/linux.c        |  120 +-
+ tools/testing/shared/maple-shared.h |   11 +
+ tools/testing/shared/maple-shim.c   |    7 +
+ tools/testing/vma/vma_internal.h    |  259 +---
+ 27 files changed, 2909 insertions(+), 1592 deletions(-)
+Merging random/master (3778dcb2dcc1c random: use offstack cpumask when necessary)
+$ git merge -m Merge branch 'master' of https://git.kernel.org/pub/scm/linux/kernel/git/crng/random.git random/master
+Auto-merging drivers/media/test-drivers/vivid/vivid-vid-cap.c
+Merge made by the 'ort' strategy.
+ drivers/char/random.c                            | 23 ++++++++++++++---------
+ drivers/media/test-drivers/vivid/vivid-vid-cap.c |  4 +++-
+ include/linux/prandom.h                          |  6 ------
+ 3 files changed, 17 insertions(+), 16 deletions(-)
+Merging landlock/next (6dde339a3df80 landlock: Minor comments improvements)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/mic/linux.git landlock/next
+Auto-merging fs/namei.c
+Auto-merging include/linux/fs.h
+Auto-merging security/landlock/fs.c
+Merge made by the 'ort' strategy.
+ fs/namei.c                                 |    2 +-
+ include/linux/fs.h                         |    1 +
+ security/landlock/errata/abi-1.h           |   16 +
+ security/landlock/fs.c                     |  194 +++-
+ security/landlock/ruleset.c                |   12 +-
+ security/landlock/ruleset.h                |    2 +-
+ tools/testing/selftests/landlock/fs_test.c | 1317 +++++++++++++++++++++++++++-
+ 7 files changed, 1503 insertions(+), 41 deletions(-)
+ create mode 100644 security/landlock/errata/abi-1.h
+Merging rust/rust-next (f3f6b3664302e gpu: nova-core: use Alignment for alignment-related operations)
+$ git merge -m Merge branch 'rust-next' of https://github.com/Rust-for-Linux/linux.git rust/rust-next
+Auto-merging Documentation/gpu/nova/core/todo.rst
+CONFLICT (modify/delete): drivers/block/rnull.rs deleted in HEAD and modified in rust/rust-next.  Version rust/rust-next of drivers/block/rnull.rs left in tree.
+Auto-merging drivers/gpu/nova-core/fb.rs
+Auto-merging drivers/gpu/nova-core/gpu.rs
+CONFLICT (content): Merge conflict in drivers/gpu/nova-core/gpu.rs
+Auto-merging drivers/gpu/nova-core/regs/macros.rs
+CONFLICT (content): Merge conflict in drivers/gpu/nova-core/regs/macros.rs
+Auto-merging drivers/gpu/nova-core/vbios.rs
+CONFLICT (content): Merge conflict in drivers/gpu/nova-core/vbios.rs
+Auto-merging rust/bindings/bindings_helper.h
+Auto-merging rust/kernel/alloc.rs
+CONFLICT (content): Merge conflict in rust/kernel/alloc.rs
+Auto-merging rust/kernel/alloc/allocator.rs
+CONFLICT (modify/delete): rust/kernel/alloc/allocator_test.rs deleted in rust/rust-next and modified in HEAD.  Version HEAD of rust/kernel/alloc/allocator_test.rs left in tree.
+Auto-merging rust/kernel/alloc/kbox.rs
+Auto-merging rust/kernel/alloc/kvec.rs
+CONFLICT (content): Merge conflict in rust/kernel/alloc/kvec.rs
+Auto-merging rust/kernel/alloc/layout.rs
+Auto-merging rust/kernel/auxiliary.rs
+Auto-merging rust/kernel/block/mq.rs
+CONFLICT (content): Merge conflict in rust/kernel/block/mq.rs
+Auto-merging rust/kernel/block/mq/gen_disk.rs
+CONFLICT (content): Merge conflict in rust/kernel/block/mq/gen_disk.rs
+CONFLICT (modify/delete): rust/kernel/block/mq/raw_writer.rs deleted in HEAD and modified in rust/rust-next.  Version rust/rust-next of rust/kernel/block/mq/raw_writer.rs left in tree.
+Auto-merging rust/kernel/configfs.rs
+Auto-merging rust/kernel/cpufreq.rs
+Auto-merging rust/kernel/device.rs
+CONFLICT (content): Merge conflict in rust/kernel/device.rs
+Auto-merging rust/kernel/dma.rs
+Auto-merging rust/kernel/drm/device.rs
+Auto-merging rust/kernel/drm/driver.rs
+Auto-merging rust/kernel/drm/gem/mod.rs
+Auto-merging rust/kernel/drm/ioctl.rs
+Auto-merging rust/kernel/fs/file.rs
+CONFLICT (content): Merge conflict in rust/kernel/fs/file.rs
+Auto-merging rust/kernel/kunit.rs
+Auto-merging rust/kernel/lib.rs
+CONFLICT (content): Merge conflict in rust/kernel/lib.rs
+Auto-merging rust/kernel/miscdevice.rs
+Auto-merging rust/kernel/net/phy.rs
+Auto-merging rust/kernel/sync/arc.rs
+Auto-merging samples/rust/rust_configfs.rs
+Auto-merging samples/rust/rust_dma.rs
+CONFLICT (content): Merge conflict in samples/rust/rust_dma.rs
+Resolved 'drivers/gpu/nova-core/gpu.rs' using previous resolution.
+Resolved 'drivers/gpu/nova-core/regs/macros.rs' using previous resolution.
+Resolved 'drivers/gpu/nova-core/vbios.rs' using previous resolution.
+Resolved 'rust/kernel/alloc.rs' using previous resolution.
+Resolved 'rust/kernel/alloc/kvec.rs' using previous resolution.
+Resolved 'rust/kernel/block/mq.rs' using previous resolution.
+Resolved 'rust/kernel/block/mq/gen_disk.rs' using previous resolution.
+Resolved 'rust/kernel/device.rs' using previous resolution.
+Resolved 'rust/kernel/fs/file.rs' using previous resolution.
+Resolved 'rust/kernel/lib.rs' using previous resolution.
+Resolved 'samples/rust/rust_dma.rs' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git rm -f rust/kernel/alloc/allocator_test.rs
+rm 'rust/kernel/alloc/allocator_test.rs'
+$ git commit --no-edit -v -a
+[master 49e45fc59987b] Merge branch 'rust-next' of https://github.com/Rust-for-Linux/linux.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/gpu/nova/core/todo.rst |   1 -
+ drivers/block/rnull.rs               |  80 ++++++++++++
+ drivers/gpu/drm/drm_panic_qr.rs      |   2 +-
+ drivers/gpu/nova-core/fb.rs          |   6 +-
+ drivers/gpu/nova-core/gpu.rs         |   5 +-
+ drivers/gpu/nova-core/vbios.rs       |   4 +-
+ rust/Makefile                        |  29 ++---
+ rust/bindgen_parameters              |   5 +
+ rust/bindings/bindings_helper.h      |   1 +
+ rust/bindings/lib.rs                 |   8 ++
+ rust/kernel/acpi.rs                  |   7 +-
+ rust/kernel/alloc.rs                 |  15 +--
+ rust/kernel/alloc/allocator.rs       |   8 ++
+ rust/kernel/alloc/allocator_test.rs  | 154 -----------------------
+ rust/kernel/alloc/kbox.rs            |  92 +++++++++++++-
+ rust/kernel/alloc/kvec.rs            |  24 ++--
+ rust/kernel/alloc/kvec/errors.rs     |   2 +-
+ rust/kernel/alloc/layout.rs          |   2 +-
+ rust/kernel/auxiliary.rs             |   4 +-
+ rust/kernel/block/mq.rs              |   2 +-
+ rust/kernel/block/mq/gen_disk.rs     |   4 +-
+ rust/kernel/block/mq/raw_writer.rs   |  54 +++++++++
+ rust/kernel/configfs.rs              |   4 +-
+ rust/kernel/cpu.rs                   |   1 +
+ rust/kernel/cpufreq.rs               |   6 +-
+ rust/kernel/device.rs                |   6 +-
+ rust/kernel/device/property.rs       |  23 ++--
+ rust/kernel/dma.rs                   |   2 +-
+ rust/kernel/drm/device.rs            |   6 +-
+ rust/kernel/drm/driver.rs            |   2 +-
+ rust/kernel/drm/file.rs              |   2 +-
+ rust/kernel/drm/gem/mod.rs           |   2 +-
+ rust/kernel/drm/ioctl.rs             |   2 +-
+ rust/kernel/error.rs                 |  66 ++++++++--
+ rust/kernel/firmware.rs              |   2 +-
+ rust/kernel/fs/file.rs               |   5 +-
+ rust/kernel/kunit.rs                 |  14 +--
+ rust/kernel/lib.rs                   |   5 +-
+ rust/kernel/list.rs                  | 120 ++++++++++++++++++
+ rust/kernel/miscdevice.rs            |   2 +-
+ rust/kernel/net/phy.rs               |   2 +-
+ rust/kernel/of.rs                    |   2 +-
+ rust/kernel/prelude.rs               |   5 +-
+ rust/kernel/ptr.rs                   | 228 +++++++++++++++++++++++++++++++++++
+ rust/kernel/seq_file.rs              |   6 +-
+ rust/kernel/sync/arc.rs              |   8 +-
+ rust/kernel/sync/aref.rs             |  17 ++-
+ rust/kernel/task.rs                  |   7 +-
+ rust/kernel/time.rs                  | 163 ++++++++++++++++++++++++-
+ rust/kernel/time/hrtimer.rs          | 152 ++++++++++++++++++++++-
+ rust/kernel/time/hrtimer/arc.rs      |   9 +-
+ rust/kernel/time/hrtimer/pin.rs      |   9 +-
+ rust/kernel/time/hrtimer/pin_mut.rs  |  12 +-
+ rust/kernel/time/hrtimer/tbox.rs     |   9 +-
+ rust/macros/quote.rs                 | 104 ++++++++--------
+ rust/uapi/lib.rs                     |   2 +
+ samples/rust/rust_configfs.rs        |   2 +-
+ samples/rust/rust_dma.rs             |   2 +-
+ scripts/generate_rust_analyzer.py    |   4 +-
+ scripts/rustdoc_test_gen.rs          |   2 +-
+ 60 files changed, 1185 insertions(+), 339 deletions(-)
+ create mode 100644 drivers/block/rnull.rs
+ delete mode 100644 rust/kernel/alloc/allocator_test.rs
+ create mode 100644 rust/kernel/block/mq/raw_writer.rs
+ create mode 100644 rust/kernel/ptr.rs
+Merging rust-alloc/alloc-next (fe927defbb4f3 rust: alloc: remove `allocator_test`)
+$ git merge -m Merge branch 'alloc-next' of https://github.com/Rust-for-Linux/linux.git rust-alloc/alloc-next
+Already up to date.
+Merging rust-io/io-next (86731a2a651e5 Linux 6.16-rc3)
+$ git merge -m Merge branch 'io-next' of https://github.com/Rust-for-Linux/linux.git rust-io/io-next
+Already up to date.
+Merging rust-pin-init/pin-init-next (42415d163e5df rust: pin-init: add references to previously initialized fields)
+$ git merge -m Merge branch 'pin-init-next' of https://github.com/Rust-for-Linux/linux.git rust-pin-init/pin-init-next
+Already up to date.
+Merging rust-timekeeping/timekeeping-next (4521438fb076f rust: time: Implement basic arithmetic operations for Delta)
+$ git merge -m Merge branch 'timekeeping-next' of https://github.com/Rust-for-Linux/linux.git rust-timekeeping/timekeeping-next
+Already up to date.
+Merging rust-xarray/xarray-next (fa616196fbea1 MAINTAINERS: add entry for Rust XArray API)
+$ git merge -m Merge branch 'xarray-next' of https://github.com/Rust-for-Linux/linux.git rust-xarray/xarray-next
+Already up to date.
+Merging sysctl/sysctl-next (19272b37aa4f8 Linux 6.16-rc1)
+$ git merge -m Merge branch 'sysctl-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sysctl/sysctl.git sysctl/sysctl-next
+Already up to date.
+Merging execve/for-next/execve (8c94db0ae97c7 binfmt_elf: preserve original ELF e_flags for core dumps)
+$ git merge -m Merge branch 'for-next/execve' of https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git execve/for-next/execve
+Auto-merging arch/riscv/Kconfig
+Auto-merging fs/exec.c
+Auto-merging include/linux/mm_types.h
+Merge made by the 'ort' strategy.
+ arch/riscv/Kconfig       |  1 +
+ fs/Kconfig.binfmt        |  9 +++++++++
+ fs/binfmt_elf.c          | 48 +++++++++++++++++++++++++++++++++++++-----------
+ fs/exec.c                |  2 +-
+ include/linux/mm_types.h |  5 +++++
+ 5 files changed, 53 insertions(+), 12 deletions(-)
+Merging bitmap/bitmap-for-next (2cdae413cd3ee rust: add dynamic ID pool abstraction for bitmap)
+$ git merge -m Merge branch 'bitmap-for-next' of https://github.com/norov/linux.git bitmap/bitmap-for-next
+Auto-merging MAINTAINERS
+Auto-merging drivers/clk/clk-sp7021.c
+Auto-merging drivers/mmc/host/dw_mmc-rockchip.c
+Auto-merging drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c
+Auto-merging drivers/pci/controller/dwc/pcie-dw-rockchip.c
+Auto-merging lib/Kconfig.debug
+Auto-merging lib/Makefile
+Auto-merging rust/bindings/bindings_helper.h
+Auto-merging rust/helpers/helpers.c
+CONFLICT (content): Merge conflict in rust/helpers/helpers.c
+Auto-merging rust/kernel/lib.rs
+Resolved 'rust/helpers/helpers.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 75a436fa97e7c] Merge branch 'bitmap-for-next' of https://github.com/norov/linux.git
+$ git diff -M --stat --summary HEAD^..
+ MAINTAINERS                                        |  16 +
+ arch/arc/include/asm/bitops.h                      |   2 +
+ drivers/clk/clk-sp7021.c                           |  22 +-
+ drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c    | 142 +++--
+ drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c        |  78 ++-
+ drivers/gpu/drm/rockchip/dw_hdmi_qp-rockchip.c     |  68 ++-
+ drivers/gpu/drm/rockchip/inno_hdmi.c               |  11 +-
+ drivers/gpu/drm/rockchip/rockchip_drm_vop2.h       |   1 -
+ drivers/gpu/drm/rockchip/rockchip_lvds.h           |  21 +-
+ drivers/gpu/drm/rockchip/rockchip_vop2_reg.c       |  15 +-
+ .../media/platform/synopsys/hdmirx/snps_hdmirx.h   |   6 +-
+ drivers/mmc/host/dw_mmc-rockchip.c                 |   9 +-
+ drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c     |   3 +-
+ drivers/pci/controller/dwc/pcie-dw-rockchip.c      |  42 +-
+ drivers/pci/controller/pcie-rockchip.h             |  35 +-
+ drivers/phy/rockchip/phy-rockchip-emmc.c           |   3 +-
+ drivers/phy/rockchip/phy-rockchip-pcie.c           |  70 +--
+ drivers/phy/rockchip/phy-rockchip-samsung-dcphy.c  |  11 +-
+ drivers/phy/rockchip/phy-rockchip-usb.c            |  51 +-
+ drivers/soc/rockchip/grf.c                         |  35 +-
+ include/linux/hw_bitfield.h                        |  62 +++
+ lib/Kconfig.debug                                  |  13 +
+ lib/Makefile                                       |   1 +
+ lib/find_bit_benchmark_rust.rs                     | 104 ++++
+ rust/bindings/bindings_helper.h                    |   2 +
+ rust/helpers/bitmap.c                              |   9 +
+ rust/helpers/bitops.c                              |  23 +
+ rust/helpers/helpers.c                             |   2 +
+ rust/kernel/bitmap.rs                              | 600 +++++++++++++++++++++
+ rust/kernel/id_pool.rs                             | 226 ++++++++
+ rust/kernel/lib.rs                                 |   2 +
+ security/Kconfig.hardening                         |  10 +
+ sound/soc/rockchip/rockchip_i2s_tdm.h              |   4 +-
+ 33 files changed, 1361 insertions(+), 338 deletions(-)
+ create mode 100644 include/linux/hw_bitfield.h
+ create mode 100644 lib/find_bit_benchmark_rust.rs
+ create mode 100644 rust/helpers/bitmap.c
+ create mode 100644 rust/helpers/bitops.c
+ create mode 100644 rust/kernel/bitmap.rs
+ create mode 100644 rust/kernel/id_pool.rs
+Merging hte/for-next (9e4259716f60c hte: tegra-194: add missing MODULE_DESCRIPTION() macro)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/pateldipen1984/linux.git hte/for-next
+Already up to date.
+Merging kspp/for-next/kspp (e067972c4d341 Merge branches 'for-linus/hardening', 'for-next/v6.18-rc1/ffs-const' and 'for-next/hardening' into for-next/kspp)
+$ git merge -m Merge branch 'for-next/kspp' of https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git kspp/for-next/kspp
+Auto-merging Makefile
+Auto-merging arch/Kconfig
+Auto-merging arch/arm/Kconfig
+Auto-merging arch/arm64/Kconfig
+Auto-merging arch/arm64/kernel/debug-monitors.c
+Auto-merging arch/arm64/kernel/traps.c
+Auto-merging arch/arm64/kvm/handle_exit.c
+Auto-merging arch/arm64/net/bpf_jit_comp.c
+Auto-merging arch/m68k/include/asm/bitops.h
+Auto-merging arch/riscv/Kconfig
+Auto-merging arch/riscv/net/bpf_jit_comp64.c
+Auto-merging arch/s390/include/asm/bitops.h
+CONFLICT (content): Merge conflict in arch/s390/include/asm/bitops.h
+Auto-merging arch/x86/Kconfig
+Auto-merging arch/x86/include/asm/bitops.h
+Auto-merging arch/x86/include/asm/cfi.h
+Auto-merging arch/x86/kernel/alternative.c
+Auto-merging drivers/pci/pci.c
+Auto-merging include/asm-generic/vmlinux.lds.h
+Auto-merging include/linux/compiler.h
+Auto-merging init/Kconfig
+Auto-merging kernel/Makefile
+Auto-merging lib/Kconfig.debug
+Auto-merging tools/include/linux/cfi_types.h
+Resolved 'arch/s390/include/asm/bitops.h' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 0d84879b29dbd] Merge branch 'for-next/kspp' of https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git
+$ git diff -M --stat --summary HEAD^..
+ Documentation/kbuild/kconfig-language.rst          |  32 ++
+ Makefile                                           |   2 +-
+ arch/Kconfig                                       |  36 +-
+ arch/alpha/include/asm/bitops.h                    |  14 +-
+ arch/arm/Kconfig                                   |   2 +-
+ arch/arm/kernel/hw_breakpoint.c                    |   2 +-
+ arch/arm/mm/Makefile                               |   2 +-
+ arch/arm/mm/cache-fa.S                             |   2 +-
+ arch/arm/mm/cache-v4.S                             |   2 +-
+ arch/arm/mm/cache-v4wb.S                           |   4 +-
+ arch/arm/mm/cache-v4wt.S                           |   2 +-
+ arch/arm/mm/cache-v6.S                             |   2 +-
+ arch/arm/mm/cache-v7.S                             |   2 +-
+ arch/arm/mm/cache-v7m.S                            |   2 +-
+ arch/arm/mm/proc-arm1020.S                         |   2 +-
+ arch/arm/mm/proc-arm1020e.S                        |   2 +-
+ arch/arm/mm/proc-arm1022.S                         |   2 +-
+ arch/arm/mm/proc-arm1026.S                         |   2 +-
+ arch/arm/mm/proc-arm920.S                          |   2 +-
+ arch/arm/mm/proc-arm922.S                          |   2 +-
+ arch/arm/mm/proc-arm925.S                          |   2 +-
+ arch/arm/mm/proc-arm926.S                          |   2 +-
+ arch/arm/mm/proc-arm940.S                          |   2 +-
+ arch/arm/mm/proc-arm946.S                          |   2 +-
+ arch/arm/mm/proc-feroceon.S                        |   2 +-
+ arch/arm/mm/proc-mohawk.S                          |   2 +-
+ arch/arm/mm/proc-xsc3.S                            |   2 +-
+ arch/arm/mm/tlb-v4.S                               |   2 +-
+ arch/arm64/Kconfig                                 |   4 +-
+ arch/arm64/kernel/debug-monitors.c                 |   2 +-
+ arch/arm64/kernel/traps.c                          |   4 +-
+ arch/arm64/kvm/handle_exit.c                       |   2 +-
+ arch/arm64/net/bpf_jit_comp.c                      |   2 +-
+ arch/csky/include/asm/bitops.h                     |   8 +-
+ arch/hexagon/include/asm/bitops.h                  |  10 +-
+ arch/m68k/include/asm/bitops.h                     |  14 +-
+ arch/mips/include/asm/bitops.h                     |   8 +-
+ arch/openrisc/include/asm/bitops/__ffs.h           |   2 +-
+ arch/openrisc/include/asm/bitops/__fls.h           |   2 +-
+ arch/openrisc/include/asm/bitops/ffs.h             |   2 +-
+ arch/openrisc/include/asm/bitops/fls.h             |   2 +-
+ arch/parisc/include/asm/bitops.h                   |   6 +-
+ arch/powerpc/include/asm/bitops.h                  |   4 +-
+ arch/riscv/Kconfig                                 |   6 +-
+ arch/riscv/include/asm/bitops.h                    |   6 +-
+ arch/riscv/include/asm/cfi.h                       |   4 +-
+ arch/riscv/kernel/Makefile                         |   2 +-
+ arch/riscv/net/bpf_jit_comp64.c                    |   4 +-
+ arch/riscv/purgatory/Makefile                      |   2 +-
+ arch/s390/include/asm/bitops.h                     |   2 +-
+ arch/sh/include/asm/bitops.h                       |   4 +-
+ arch/sparc/include/asm/bitops_64.h                 |   8 +-
+ arch/x86/Kconfig                                   |  12 +-
+ arch/x86/include/asm/bitops.h                      |  12 +-
+ arch/x86/include/asm/cfi.h                         |   4 +-
+ arch/x86/kernel/Makefile                           |   2 +-
+ arch/x86/kernel/alternative.c                      |   4 +-
+ arch/x86/kernel/kprobes/core.c                     |   2 +-
+ arch/x86/purgatory/Makefile                        |   2 +-
+ arch/xtensa/include/asm/bitops.h                   |  10 +-
+ drivers/misc/lkdtm/cfi.c                           |   2 +-
+ drivers/misc/lkdtm/fortify.c                       |   6 +
+ drivers/pci/pci.c                                  |   6 +-
+ include/asm-generic/bitops/__ffs.h                 |   2 +-
+ include/asm-generic/bitops/__fls.h                 |   2 +-
+ include/asm-generic/bitops/builtin-__ffs.h         |   2 +-
+ include/asm-generic/bitops/builtin-__fls.h         |   2 +-
+ include/asm-generic/bitops/builtin-fls.h           |   2 +-
+ include/asm-generic/bitops/ffs.h                   |   2 +-
+ include/asm-generic/bitops/fls.h                   |   2 +-
+ include/asm-generic/bitops/fls64.h                 |   4 +-
+ include/asm-generic/vmlinux.lds.h                  |   2 +-
+ include/linux/bitops.h                             |   2 +-
+ include/linux/cfi.h                                |   6 +-
+ include/linux/cfi_types.h                          |   8 +-
+ include/linux/compiler.h                           |   2 +-
+ include/linux/stddef.h                             |  30 +-
+ init/Kconfig                                       |   4 +-
+ kernel/Makefile                                    |   2 +-
+ kernel/configs/hardening.config                    |   4 +-
+ kernel/module/Kconfig                              |   2 +-
+ kernel/module/tree_lookup.c                        |   2 +-
+ lib/Kconfig.debug                                  |  16 +-
+ lib/clz_ctz.c                                      |   8 +-
+ lib/tests/Makefile                                 |   1 +
+ lib/tests/ffs_kunit.c                              | 566 +++++++++++++++++++++
+ scripts/gcc-plugins/gcc-common.h                   |   7 +
+ scripts/kconfig/expr.h                             |   1 +
+ scripts/kconfig/lexer.l                            |   1 +
+ scripts/kconfig/parser.y                           |  47 ++
+ scripts/kconfig/symbol.c                           |   7 +-
+ scripts/kconfig/tests/conftest.py                  |  17 +-
+ scripts/kconfig/tests/err_transitional/Kconfig     |  52 ++
+ scripts/kconfig/tests/err_transitional/__init__.py |  14 +
+ .../kconfig/tests/err_transitional/expected_stderr |   7 +
+ scripts/kconfig/tests/transitional/Kconfig         | 100 ++++
+ scripts/kconfig/tests/transitional/__init__.py     |  18 +
+ scripts/kconfig/tests/transitional/expected_config |  12 +
+ scripts/kconfig/tests/transitional/initial_config  |  16 +
+ tools/include/linux/cfi_types.h                    |   6 +-
+ tools/perf/util/include/linux/linkage.h            |   2 +-
+ 101 files changed, 1115 insertions(+), 171 deletions(-)
+ create mode 100644 lib/tests/ffs_kunit.c
+ create mode 100644 scripts/kconfig/tests/err_transitional/Kconfig
+ create mode 100644 scripts/kconfig/tests/err_transitional/__init__.py
+ create mode 100644 scripts/kconfig/tests/err_transitional/expected_stderr
+ create mode 100644 scripts/kconfig/tests/transitional/Kconfig
+ create mode 100644 scripts/kconfig/tests/transitional/__init__.py
+ create mode 100644 scripts/kconfig/tests/transitional/expected_config
+ create mode 100644 scripts/kconfig/tests/transitional/initial_config
+Merging nolibc/for-next (2d965c1ae4135 tools/nolibc: add stdbool.h to nolibc includes)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/nolibc/linux-nolibc.git nolibc/for-next
+Auto-merging tools/testing/selftests/arm64/abi/tpidr2.c
+Merge made by the 'ort' strategy.
+ tools/include/nolibc/nolibc.h                  |   1 +
+ tools/include/nolibc/poll.h                    |   4 +-
+ tools/include/nolibc/std.h                     |   2 +-
+ tools/include/nolibc/sys.h                     | 105 ++++++++++---------------
+ tools/include/nolibc/sys/random.h              |   4 +-
+ tools/include/nolibc/sys/timerfd.h             |   8 +-
+ tools/include/nolibc/sys/wait.h                |  17 ----
+ tools/include/nolibc/time.h                    |  13 ++-
+ tools/include/nolibc/unistd.h                  |   2 +-
+ tools/testing/selftests/arm64/abi/tpidr2.c     |   6 +-
+ tools/testing/selftests/nolibc/Makefile.nolibc |  17 ++--
+ tools/testing/selftests/nolibc/nolibc-test.c   |   6 +-
+ 12 files changed, 69 insertions(+), 116 deletions(-)
+Merging iommufd/for-next (885add2e6be65 iommufd: Register iommufd mock devices with fwspec)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/jgg/iommufd.git iommufd/for-next
+Merge made by the 'ort' strategy.
+ drivers/iommu/iommu-priv.h                    |  2 ++
+ drivers/iommu/iommu.c                         | 26 ++++++++++++++++++++++++++
+ drivers/iommu/iommufd/selftest.c              |  2 +-
+ tools/testing/selftests/iommu/iommufd_utils.h |  8 +++-----
+ 4 files changed, 32 insertions(+), 6 deletions(-)
+Merging turbostat/next (447c98c1ca4a4 tools/power turbostat: Add idle governor statistics reporting)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/lenb/linux.git turbostat/next
+Auto-merging tools/power/x86/turbostat/turbostat.8
+CONFLICT (content): Merge conflict in tools/power/x86/turbostat/turbostat.8
+Auto-merging tools/power/x86/turbostat/turbostat.c
+CONFLICT (content): Merge conflict in tools/power/x86/turbostat/turbostat.c
+Resolved 'tools/power/x86/turbostat/turbostat.8' using previous resolution.
+Resolved 'tools/power/x86/turbostat/turbostat.c' using previous resolution.
+Automatic merge failed; fix conflicts and then commit the result.
+$ git commit --no-edit -v -a
+[master 0217455716863] Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/lenb/linux.git
+$ git diff -M --stat --summary HEAD^..
+ tools/power/x86/turbostat/turbostat.8 | 17 +++++++----------
+ 1 file changed, 7 insertions(+), 10 deletions(-)
+Merging pwrseq/pwrseq/for-next (8f5ae30d69d75 Linux 6.17-rc1)
+$ git merge -m Merge branch 'pwrseq/for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux.git pwrseq/pwrseq/for-next
+Already up to date.
+Merging capabilities-next/caps-next (d87d3c530e0ce pid: use ns_capable_noaudit() when determining net sysctl permissions)
+$ git merge -m Merge branch 'caps-next' of https://git.kernel.org/pub/scm/linux/kernel/git/sergeh/linux.git capabilities-next/caps-next
+Auto-merging kernel/pid.c
+Merge made by the 'ort' strategy.
+Merging ipe/next (038d61fd64227 Linux 6.16)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/wufan/ipe.git ipe/next
+Already up to date.
+Merging kcsan/next (800348aa34b2b kcsan: test: Replace deprecated strcpy() with strscpy())
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/melver/linux.git kcsan/next
+Auto-merging kernel/kcsan/kcsan_test.c
+Merge made by the 'ort' strategy.
+ kernel/kcsan/kcsan_test.c | 4 ++--
+ 1 file changed, 2 insertions(+), 2 deletions(-)
+Merging crc/crc-next (136d029662cdd Documentation/staging: Fix typo and incorrect citation in crc32.rst)
+$ git merge -m Merge branch 'crc-next' of https://git.kernel.org/pub/scm/linux/kernel/git/ebiggers/linux.git crc/crc-next
+Merge made by the 'ort' strategy.
+ Documentation/staging/crc32.rst       |   4 +-
+ include/kunit/run-in-irq-context.h    | 129 ++++++++++++++++++++++++++++++++++
+ lib/crc/arm/crc-t10dif.h              |   8 +--
+ lib/crc/arm/crc32.h                   |   8 +--
+ lib/crc/arm64/crc-t10dif.h            |   8 +--
+ lib/crc/arm64/crc32.h                 |  11 +--
+ lib/crc/loongarch/crc32.h             |   2 +-
+ lib/crc/mips/crc32.h                  |   2 +-
+ lib/crc/powerpc/crc-t10dif.h          |   7 +-
+ lib/crc/powerpc/crc32.h               |   7 +-
+ lib/crc/sparc/crc32.h                 |   2 +-
+ lib/crc/tests/crc_kunit.c             |  62 +++++++++++++---
+ lib/crc/x86/crc-pclmul-template.h     |   3 +-
+ lib/crc/x86/crc-t10dif.h              |   2 +-
+ lib/crc/x86/crc32.h                   |   4 +-
+ lib/crc/x86/crc64.h                   |   2 +-
+ lib/crypto/tests/hash-test-template.h | 123 ++------------------------------
+ 17 files changed, 219 insertions(+), 165 deletions(-)
+ create mode 100644 include/kunit/run-in-irq-context.h
+Merging fwctl/for-next (479bec4cb39a1 pds_fwctl: Replace kzalloc + copy_from_user with memdup_user in pdsfc_fw_rpc)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/fwctl/fwctl.git fwctl/for-next
+Merge made by the 'ort' strategy.
+ drivers/fwctl/mlx5/main.c |  7 +++++++
+ drivers/fwctl/pds/main.c  | 16 ++++------------
+ 2 files changed, 11 insertions(+), 12 deletions(-)
+Merging devsec-tsm/next (9d948b8804096 Merge branch 'for-6.16/tsm-mr' into tsm-next)
+$ git merge -m Merge branch 'next' of https://git.kernel.org/pub/scm/linux/kernel/git/devsec/tsm.git devsec-tsm/next
+Already up to date.
+Merging hisilicon/for-next (6c177775dcc5e Merge branch 'next/drivers' into for-next)
+$ git merge -m Merge branch 'for-next' of https://github.com/hisilicon/linux-hisi.git hisilicon/for-next
+Merge made by the 'ort' strategy.
+Merging kthread/for-next (d8b4bf4ea04dd kthread: modify kernel-doc function name to match code)
+$ git merge -m Merge branch 'for-next' of https://git.kernel.org/pub/scm/linux/kernel/git/frederic/linux-dynticks.git kthread/for-next
+Already up to date.
diff --git a/arch/Kconfig b/arch/Kconfig
index bae871976d36..ebe08b9186ad 100644
--- a/arch/Kconfig
+++ b/arch/Kconfig
@@ -905,22 +905,26 @@ config PROPELLER_CLANG
 
 	  If unsure, say N.
 
-config ARCH_SUPPORTS_CFI_CLANG
+config ARCH_SUPPORTS_CFI
 	bool
 	help
-	  An architecture should select this option if it can support Clang's
-	  Control-Flow Integrity (CFI) checking.
+	  An architecture should select this option if it can support Kernel
+	  Control-Flow Integrity (CFI) checking (-fsanitize=kcfi).
 
 config ARCH_USES_CFI_TRAPS
 	bool
+	help
+	  An architecture should select this option if it requires the
+	  .kcfi_traps section for KCFI trap handling.
 
-config CFI_CLANG
-	bool "Use Clang's Control Flow Integrity (CFI)"
-	depends on ARCH_SUPPORTS_CFI_CLANG
+config CFI
+	bool "Use Kernel Control Flow Integrity (kCFI)"
+	default CFI_CLANG
+	depends on ARCH_SUPPORTS_CFI
 	depends on $(cc-option,-fsanitize=kcfi)
 	help
-	  This option enables Clang's forward-edge Control Flow Integrity
-	  (CFI) checking, where the compiler injects a runtime check to each
+	  This option enables forward-edge Control Flow Integrity (CFI)
+	  checking, where the compiler injects a runtime check to each
 	  indirect function call to ensure the target is a valid function with
 	  the correct static type. This restricts possible call targets and
 	  makes it more difficult for an attacker to exploit bugs that allow
@@ -929,10 +933,16 @@ config CFI_CLANG
 
 	    https://clang.llvm.org/docs/ControlFlowIntegrity.html
 
+config CFI_CLANG
+	bool
+	transitional
+	help
+	  Transitional config for CFI_CLANG to CFI migration.
+
 config CFI_ICALL_NORMALIZE_INTEGERS
 	bool "Normalize CFI tags for integers"
-	depends on CFI_CLANG
-	depends on HAVE_CFI_ICALL_NORMALIZE_INTEGERS_CLANG
+	depends on CFI
+	depends on HAVE_CFI_ICALL_NORMALIZE_INTEGERS
 	help
 	  This option normalizes the CFI tags for integer types so that all
 	  integer types of the same size and signedness receive the same CFI
@@ -945,7 +955,7 @@ config CFI_ICALL_NORMALIZE_INTEGERS
 
 	  This option is necessary for using CFI with Rust. If unsure, say N.
 
-config HAVE_CFI_ICALL_NORMALIZE_INTEGERS_CLANG
+config HAVE_CFI_ICALL_NORMALIZE_INTEGERS
 	def_bool y
 	depends on $(cc-option,-fsanitize=kcfi -fsanitize-cfi-icall-experimental-normalize-integers)
 	# With GCOV/KASAN we need this fix: https://github.com/llvm/llvm-project/pull/104826
@@ -953,7 +963,7 @@ config HAVE_CFI_ICALL_NORMALIZE_INTEGERS_CLANG
 
 config HAVE_CFI_ICALL_NORMALIZE_INTEGERS_RUSTC
 	def_bool y
-	depends on HAVE_CFI_ICALL_NORMALIZE_INTEGERS_CLANG
+	depends on HAVE_CFI_ICALL_NORMALIZE_INTEGERS
 	depends on RUSTC_VERSION >= 107900
 	# With GCOV/KASAN we need this fix: https://github.com/rust-lang/rust/pull/129373
 	depends on (RUSTC_LLVM_VERSION >= 190103 && RUSTC_VERSION >= 108200) || \
@@ -961,7 +971,7 @@ config HAVE_CFI_ICALL_NORMALIZE_INTEGERS_RUSTC
 
 config CFI_PERMISSIVE
 	bool "Use CFI in permissive mode"
-	depends on CFI_CLANG
+	depends on CFI
 	help
 	  When selected, Control Flow Integrity (CFI) violations result in a
 	  warning instead of a kernel panic. This option should only be used
diff --git a/arch/alpha/include/asm/bitops.h b/arch/alpha/include/asm/bitops.h
index 3e33621922c3..76e4343c090f 100644
--- a/arch/alpha/include/asm/bitops.h
+++ b/arch/alpha/include/asm/bitops.h
@@ -328,7 +328,7 @@ static inline unsigned long ffz_b(unsigned long x)
 	return sum;
 }
 
-static inline unsigned long ffz(unsigned long word)
+static inline unsigned long __attribute_const__ ffz(unsigned long word)
 {
 #if defined(CONFIG_ALPHA_EV6) && defined(CONFIG_ALPHA_EV67)
 	/* Whee.  EV67 can calculate it directly.  */
@@ -348,7 +348,7 @@ static inline unsigned long ffz(unsigned long word)
 /*
  * __ffs = Find First set bit in word.  Undefined if no set bit exists.
  */
-static inline unsigned long __ffs(unsigned long word)
+static inline __attribute_const__ unsigned long __ffs(unsigned long word)
 {
 #if defined(CONFIG_ALPHA_EV6) && defined(CONFIG_ALPHA_EV67)
 	/* Whee.  EV67 can calculate it directly.  */
@@ -373,7 +373,7 @@ static inline unsigned long __ffs(unsigned long word)
  * differs in spirit from the above __ffs.
  */
 
-static inline int ffs(int word)
+static inline __attribute_const__ int ffs(int word)
 {
 	int result = __ffs(word) + 1;
 	return word ? result : 0;
@@ -383,14 +383,14 @@ static inline int ffs(int word)
  * fls: find last bit set.
  */
 #if defined(CONFIG_ALPHA_EV6) && defined(CONFIG_ALPHA_EV67)
-static inline int fls64(unsigned long word)
+static inline __attribute_const__ int fls64(unsigned long word)
 {
 	return 64 - __kernel_ctlz(word);
 }
 #else
 extern const unsigned char __flsm1_tab[256];
 
-static inline int fls64(unsigned long x)
+static inline __attribute_const__ int fls64(unsigned long x)
 {
 	unsigned long t, a, r;
 
@@ -403,12 +403,12 @@ static inline int fls64(unsigned long x)
 }
 #endif
 
-static inline unsigned long __fls(unsigned long x)
+static inline __attribute_const__ unsigned long __fls(unsigned long x)
 {
 	return fls64(x) - 1;
 }
 
-static inline int fls(unsigned int x)
+static inline __attribute_const__ int fls(unsigned int x)
 {
 	return fls64(x);
 }
diff --git a/arch/arc/include/asm/bitops.h b/arch/arc/include/asm/bitops.h
index 5340c2871392..df894235fdbc 100644
--- a/arch/arc/include/asm/bitops.h
+++ b/arch/arc/include/asm/bitops.h
@@ -133,6 +133,8 @@ static inline __attribute__ ((const)) int fls(unsigned int x)
  */
 static inline __attribute__ ((const)) unsigned long __fls(unsigned long x)
 {
+	if (__builtin_constant_p(x))
+		return x ? BITS_PER_LONG - 1 - __builtin_clzl(x) : 0;
 	/* FLS insn has exactly same semantics as the API */
 	return	__builtin_arc_fls(x);
 }
diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 5527935fd15a..2e3f93b690f4 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -38,7 +38,7 @@ config ARM
 	select ARCH_OPTIONAL_KERNEL_RWX_DEFAULT if CPU_V7
 	select ARCH_NEED_CMPXCHG_1_EMU if CPU_V6
 	select ARCH_SUPPORTS_ATOMIC_RMW
-	select ARCH_SUPPORTS_CFI_CLANG
+	select ARCH_SUPPORTS_CFI
 	select ARCH_SUPPORTS_HUGETLBFS if ARM_LPAE
 	select ARCH_SUPPORTS_PER_VMA_LOCK
 	select ARCH_USE_BUILTIN_BSWAP
diff --git a/arch/arm/include/asm/efi.h b/arch/arm/include/asm/efi.h
index e408399d5f0e..0809a69bb579 100644
--- a/arch/arm/include/asm/efi.h
+++ b/arch/arm/include/asm/efi.h
@@ -23,7 +23,7 @@ void arm_efi_init(void);
 int efi_create_mapping(struct mm_struct *mm, efi_memory_desc_t *md);
 int efi_set_mapping_permissions(struct mm_struct *mm, efi_memory_desc_t *md, bool);
 
-#define arch_efi_call_virt_setup()	efi_virtmap_load()
+#define arch_efi_call_virt_setup()	(efi_virtmap_load(), true)
 #define arch_efi_call_virt_teardown()	efi_virtmap_unload()
 
 #ifdef CONFIG_CPU_TTBR0_PAN
diff --git a/arch/arm/kernel/hw_breakpoint.c b/arch/arm/kernel/hw_breakpoint.c
index a12efd0f43e8..cd4b34c96e35 100644
--- a/arch/arm/kernel/hw_breakpoint.c
+++ b/arch/arm/kernel/hw_breakpoint.c
@@ -904,7 +904,7 @@ static void breakpoint_handler(unsigned long unknown, struct pt_regs *regs)
 	watchpoint_single_step_handler(addr);
 }
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 static void hw_breakpoint_cfi_handler(struct pt_regs *regs)
 {
 	/*
diff --git a/arch/arm/mm/Makefile b/arch/arm/mm/Makefile
index a195cd1d3e6d..1e2201013371 100644
--- a/arch/arm/mm/Makefile
+++ b/arch/arm/mm/Makefile
@@ -89,7 +89,7 @@ obj-$(CONFIG_CPU_V6)		+= proc-v6.o
 obj-$(CONFIG_CPU_V6K)		+= proc-v6.o
 obj-$(CONFIG_CPU_V7)		+= proc-v7.o proc-v7-bugs.o
 obj-$(CONFIG_CPU_V7M)		+= proc-v7m.o
-obj-$(CONFIG_CFI_CLANG)		+= proc.o
+obj-$(CONFIG_CFI)		+= proc.o
 
 obj-$(CONFIG_OUTER_CACHE)	+= l2c-common.o
 obj-$(CONFIG_CACHE_B15_RAC)	+= cache-b15-rac.o
diff --git a/arch/arm/mm/cache-fa.S b/arch/arm/mm/cache-fa.S
index 4a3668b52a2d..e1641799569b 100644
--- a/arch/arm/mm/cache-fa.S
+++ b/arch/arm/mm/cache-fa.S
@@ -112,7 +112,7 @@ SYM_FUNC_END(fa_flush_user_cache_range)
  *	- end	 - virtual end address
  */
 SYM_TYPED_FUNC_START(fa_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	fa_coherent_user_range
 #endif
 SYM_FUNC_END(fa_coherent_kern_range)
diff --git a/arch/arm/mm/cache-v4.S b/arch/arm/mm/cache-v4.S
index 0e94e5193dbd..001d7042bd46 100644
--- a/arch/arm/mm/cache-v4.S
+++ b/arch/arm/mm/cache-v4.S
@@ -104,7 +104,7 @@ SYM_FUNC_END(v4_coherent_user_range)
  *	- size	- region size
  */
 SYM_TYPED_FUNC_START(v4_flush_kern_dcache_area)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v4_dma_flush_range
 #endif
 SYM_FUNC_END(v4_flush_kern_dcache_area)
diff --git a/arch/arm/mm/cache-v4wb.S b/arch/arm/mm/cache-v4wb.S
index ce55a2eef5da..874fe5310f9a 100644
--- a/arch/arm/mm/cache-v4wb.S
+++ b/arch/arm/mm/cache-v4wb.S
@@ -136,7 +136,7 @@ SYM_FUNC_END(v4wb_flush_user_cache_range)
  */
 SYM_TYPED_FUNC_START(v4wb_flush_kern_dcache_area)
 	add	r1, r0, r1
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v4wb_coherent_user_range
 #endif
 SYM_FUNC_END(v4wb_flush_kern_dcache_area)
@@ -152,7 +152,7 @@ SYM_FUNC_END(v4wb_flush_kern_dcache_area)
  *	- end	 - virtual end address
  */
 SYM_TYPED_FUNC_START(v4wb_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v4wb_coherent_user_range
 #endif
 SYM_FUNC_END(v4wb_coherent_kern_range)
diff --git a/arch/arm/mm/cache-v4wt.S b/arch/arm/mm/cache-v4wt.S
index a97dc267b3b0..2ee62e4b2b07 100644
--- a/arch/arm/mm/cache-v4wt.S
+++ b/arch/arm/mm/cache-v4wt.S
@@ -108,7 +108,7 @@ SYM_FUNC_END(v4wt_flush_user_cache_range)
  *	- end	 - virtual end address
  */
 SYM_TYPED_FUNC_START(v4wt_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v4wt_coherent_user_range
 #endif
 SYM_FUNC_END(v4wt_coherent_kern_range)
diff --git a/arch/arm/mm/cache-v6.S b/arch/arm/mm/cache-v6.S
index 9f415476e218..5ceea8965ea1 100644
--- a/arch/arm/mm/cache-v6.S
+++ b/arch/arm/mm/cache-v6.S
@@ -117,7 +117,7 @@ SYM_FUNC_END(v6_flush_user_cache_range)
  *	- the Icache does not read data from the write buffer
  */
 SYM_TYPED_FUNC_START(v6_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v6_coherent_user_range
 #endif
 SYM_FUNC_END(v6_coherent_kern_range)
diff --git a/arch/arm/mm/cache-v7.S b/arch/arm/mm/cache-v7.S
index 201ca05436fa..726681fb7d4d 100644
--- a/arch/arm/mm/cache-v7.S
+++ b/arch/arm/mm/cache-v7.S
@@ -261,7 +261,7 @@ SYM_FUNC_END(v7_flush_user_cache_range)
  *	- the Icache does not read data from the write buffer
  */
 SYM_TYPED_FUNC_START(v7_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v7_coherent_user_range
 #endif
 SYM_FUNC_END(v7_coherent_kern_range)
diff --git a/arch/arm/mm/cache-v7m.S b/arch/arm/mm/cache-v7m.S
index 14d719eba729..7f9cfad2ea21 100644
--- a/arch/arm/mm/cache-v7m.S
+++ b/arch/arm/mm/cache-v7m.S
@@ -286,7 +286,7 @@ SYM_FUNC_END(v7m_flush_user_cache_range)
  *	- the Icache does not read data from the write buffer
  */
 SYM_TYPED_FUNC_START(v7m_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	v7m_coherent_user_range
 #endif
 SYM_FUNC_END(v7m_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm1020.S b/arch/arm/mm/proc-arm1020.S
index d0ce3414a13e..4612a4961e81 100644
--- a/arch/arm/mm/proc-arm1020.S
+++ b/arch/arm/mm/proc-arm1020.S
@@ -203,7 +203,7 @@ SYM_FUNC_END(arm1020_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm1020_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm1020_coherent_user_range
 #endif
 SYM_FUNC_END(arm1020_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm1020e.S b/arch/arm/mm/proc-arm1020e.S
index 64f031bf6eff..b4a8a3a8eda3 100644
--- a/arch/arm/mm/proc-arm1020e.S
+++ b/arch/arm/mm/proc-arm1020e.S
@@ -200,7 +200,7 @@ SYM_FUNC_END(arm1020e_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm1020e_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm1020e_coherent_user_range
 #endif
 SYM_FUNC_END(arm1020e_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm1022.S b/arch/arm/mm/proc-arm1022.S
index 42ed5ed07252..709870e99e19 100644
--- a/arch/arm/mm/proc-arm1022.S
+++ b/arch/arm/mm/proc-arm1022.S
@@ -199,7 +199,7 @@ SYM_FUNC_END(arm1022_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm1022_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm1022_coherent_user_range
 #endif
 SYM_FUNC_END(arm1022_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm1026.S b/arch/arm/mm/proc-arm1026.S
index b3ae62cd553a..02f7370a8c5c 100644
--- a/arch/arm/mm/proc-arm1026.S
+++ b/arch/arm/mm/proc-arm1026.S
@@ -194,7 +194,7 @@ SYM_FUNC_END(arm1026_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm1026_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm1026_coherent_user_range
 #endif
 SYM_FUNC_END(arm1026_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm920.S b/arch/arm/mm/proc-arm920.S
index a30df54ad5fa..4727f4b5b6e8 100644
--- a/arch/arm/mm/proc-arm920.S
+++ b/arch/arm/mm/proc-arm920.S
@@ -180,7 +180,7 @@ SYM_FUNC_END(arm920_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm920_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm920_coherent_user_range
 #endif
 SYM_FUNC_END(arm920_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm922.S b/arch/arm/mm/proc-arm922.S
index aac4e048100d..5a4a3f4f2683 100644
--- a/arch/arm/mm/proc-arm922.S
+++ b/arch/arm/mm/proc-arm922.S
@@ -182,7 +182,7 @@ SYM_FUNC_END(arm922_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm922_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm922_coherent_user_range
 #endif
 SYM_FUNC_END(arm922_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm925.S b/arch/arm/mm/proc-arm925.S
index 035941faeb2e..1c4830afe1d3 100644
--- a/arch/arm/mm/proc-arm925.S
+++ b/arch/arm/mm/proc-arm925.S
@@ -229,7 +229,7 @@ SYM_FUNC_END(arm925_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm925_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm925_coherent_user_range
 #endif
 SYM_FUNC_END(arm925_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm926.S b/arch/arm/mm/proc-arm926.S
index 6f43d6af2d9a..a09cc3e02efd 100644
--- a/arch/arm/mm/proc-arm926.S
+++ b/arch/arm/mm/proc-arm926.S
@@ -192,7 +192,7 @@ SYM_FUNC_END(arm926_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm926_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm926_coherent_user_range
 #endif
 SYM_FUNC_END(arm926_coherent_kern_range)
diff --git a/arch/arm/mm/proc-arm940.S b/arch/arm/mm/proc-arm940.S
index 0d30bb25c42b..545c076c36d2 100644
--- a/arch/arm/mm/proc-arm940.S
+++ b/arch/arm/mm/proc-arm940.S
@@ -153,7 +153,7 @@ SYM_FUNC_END(arm940_coherent_kern_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm940_coherent_user_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm940_flush_kern_dcache_area
 #endif
 SYM_FUNC_END(arm940_coherent_user_range)
diff --git a/arch/arm/mm/proc-arm946.S b/arch/arm/mm/proc-arm946.S
index 27750ace2ced..f3d4e18c3fba 100644
--- a/arch/arm/mm/proc-arm946.S
+++ b/arch/arm/mm/proc-arm946.S
@@ -173,7 +173,7 @@ SYM_FUNC_END(arm946_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(arm946_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	arm946_coherent_user_range
 #endif
 SYM_FUNC_END(arm946_coherent_kern_range)
diff --git a/arch/arm/mm/proc-feroceon.S b/arch/arm/mm/proc-feroceon.S
index f67b2ffac854..7f08d06c9625 100644
--- a/arch/arm/mm/proc-feroceon.S
+++ b/arch/arm/mm/proc-feroceon.S
@@ -208,7 +208,7 @@ SYM_FUNC_END(feroceon_flush_user_cache_range)
  */
 	.align	5
 SYM_TYPED_FUNC_START(feroceon_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	feroceon_coherent_user_range
 #endif
 SYM_FUNC_END(feroceon_coherent_kern_range)
diff --git a/arch/arm/mm/proc-mohawk.S b/arch/arm/mm/proc-mohawk.S
index 8e9f38da863a..4669c63e3121 100644
--- a/arch/arm/mm/proc-mohawk.S
+++ b/arch/arm/mm/proc-mohawk.S
@@ -163,7 +163,7 @@ SYM_FUNC_END(mohawk_flush_user_cache_range)
  *	- end	- virtual end address
  */
 SYM_TYPED_FUNC_START(mohawk_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	mohawk_coherent_user_range
 #endif
 SYM_FUNC_END(mohawk_coherent_kern_range)
diff --git a/arch/arm/mm/proc-xsc3.S b/arch/arm/mm/proc-xsc3.S
index 14927b380452..fd25634a2ed5 100644
--- a/arch/arm/mm/proc-xsc3.S
+++ b/arch/arm/mm/proc-xsc3.S
@@ -223,7 +223,7 @@ SYM_FUNC_END(xsc3_flush_user_cache_range)
  *	it also trashes the mini I-cache used by JTAG debuggers.
  */
 SYM_TYPED_FUNC_START(xsc3_coherent_kern_range)
-#ifdef CONFIG_CFI_CLANG /* Fallthrough if !CFI */
+#ifdef CONFIG_CFI /* Fallthrough if !CFI */
 	b	xsc3_coherent_user_range
 #endif
 SYM_FUNC_END(xsc3_coherent_kern_range)
diff --git a/arch/arm/mm/tlb-v4.S b/arch/arm/mm/tlb-v4.S
index 09ff69008d94..079774a02be6 100644
--- a/arch/arm/mm/tlb-v4.S
+++ b/arch/arm/mm/tlb-v4.S
@@ -52,7 +52,7 @@ SYM_FUNC_END(v4_flush_user_tlb_range)
  *	- start - virtual address (may not be aligned)
  *	- end   - virtual address (may not be aligned)
  */
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 SYM_TYPED_FUNC_START(v4_flush_kern_tlb_range)
 	b	.v4_flush_kern_tlb_range
 SYM_FUNC_END(v4_flush_kern_tlb_range)
diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfig
index 2de0f3f57aa9..6663ffd23f25 100644
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@ -100,7 +100,7 @@ config ARM64
 	select ARCH_SUPPORTS_SHADOW_CALL_STACK if CC_HAVE_SHADOW_CALL_STACK
 	select ARCH_SUPPORTS_LTO_CLANG if CPU_LITTLE_ENDIAN
 	select ARCH_SUPPORTS_LTO_CLANG_THIN
-	select ARCH_SUPPORTS_CFI_CLANG
+	select ARCH_SUPPORTS_CFI
 	select ARCH_SUPPORTS_ATOMIC_RMW
 	select ARCH_SUPPORTS_INT128 if CC_HAS_INT128
 	select ARCH_SUPPORTS_NUMA_BALANCING
@@ -214,7 +214,7 @@ config ARM64
 	select HAVE_DYNAMIC_FTRACE_WITH_DIRECT_CALLS \
 		if DYNAMIC_FTRACE_WITH_ARGS && DYNAMIC_FTRACE_WITH_CALL_OPS
 	select HAVE_DYNAMIC_FTRACE_WITH_CALL_OPS \
-		if (DYNAMIC_FTRACE_WITH_ARGS && !CFI_CLANG && \
+		if (DYNAMIC_FTRACE_WITH_ARGS && !CFI && \
 		    (CC_IS_CLANG || !CC_OPTIMIZE_FOR_SIZE))
 	select FTRACE_MCOUNT_USE_PATCHABLE_FUNCTION_ENTRY \
 		if DYNAMIC_FTRACE_WITH_ARGS
diff --git a/arch/arm64/include/asm/efi.h b/arch/arm64/include/asm/efi.h
index bcd5622aa096..decf87777f57 100644
--- a/arch/arm64/include/asm/efi.h
+++ b/arch/arm64/include/asm/efi.h
@@ -37,7 +37,7 @@ int efi_set_mapping_permissions(struct mm_struct *mm, efi_memory_desc_t *md,
 extern u64 *efi_rt_stack_top;
 efi_status_t __efi_rt_asm_wrapper(void *, const char *, ...);
 
-void arch_efi_call_virt_setup(void);
+bool arch_efi_call_virt_setup(void);
 void arch_efi_call_virt_teardown(void);
 
 /*
diff --git a/arch/arm64/kernel/debug-monitors.c b/arch/arm64/kernel/debug-monitors.c
index 85fc162a6f9b..29307642f4c9 100644
--- a/arch/arm64/kernel/debug-monitors.c
+++ b/arch/arm64/kernel/debug-monitors.c
@@ -212,7 +212,7 @@ static int call_el1_break_hook(struct pt_regs *regs, unsigned long esr)
 	if (esr_brk_comment(esr) == BUG_BRK_IMM)
 		return bug_brk_handler(regs, esr);
 
-	if (IS_ENABLED(CONFIG_CFI_CLANG) && esr_is_cfi_brk(esr))
+	if (IS_ENABLED(CONFIG_CFI) && esr_is_cfi_brk(esr))
 		return cfi_brk_handler(regs, esr);
 
 	if (esr_brk_comment(esr) == FAULT_BRK_IMM)
diff --git a/arch/arm64/kernel/efi.c b/arch/arm64/kernel/efi.c
index 6c371b158b99..9b03f3d77a25 100644
--- a/arch/arm64/kernel/efi.c
+++ b/arch/arm64/kernel/efi.c
@@ -167,11 +167,12 @@ asmlinkage efi_status_t efi_handle_corrupted_x18(efi_status_t s, const char *f)
 
 static DEFINE_RAW_SPINLOCK(efi_rt_lock);
 
-void arch_efi_call_virt_setup(void)
+bool arch_efi_call_virt_setup(void)
 {
 	efi_virtmap_load();
 	raw_spin_lock(&efi_rt_lock);
 	__efi_fpsimd_begin();
+	return true;
 }
 
 void arch_efi_call_virt_teardown(void)
diff --git a/arch/arm64/kernel/traps.c b/arch/arm64/kernel/traps.c
index 83e6d1409e1f..681939ef5d16 100644
--- a/arch/arm64/kernel/traps.c
+++ b/arch/arm64/kernel/traps.c
@@ -1018,7 +1018,7 @@ int bug_brk_handler(struct pt_regs *regs, unsigned long esr)
 	return DBG_HOOK_HANDLED;
 }
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 int cfi_brk_handler(struct pt_regs *regs, unsigned long esr)
 {
 	unsigned long target;
@@ -1042,7 +1042,7 @@ int cfi_brk_handler(struct pt_regs *regs, unsigned long esr)
 	arm64_skip_faulting_instruction(regs, AARCH64_INSN_SIZE);
 	return DBG_HOOK_HANDLED;
 }
-#endif /* CONFIG_CFI_CLANG */
+#endif /* CONFIG_CFI */
 
 int reserved_fault_brk_handler(struct pt_regs *regs, unsigned long esr)
 {
diff --git a/arch/arm64/kvm/Kconfig b/arch/arm64/kvm/Kconfig
index bff62e75d681..4f803fd1c99a 100644
--- a/arch/arm64/kvm/Kconfig
+++ b/arch/arm64/kvm/Kconfig
@@ -25,7 +25,7 @@ menuconfig KVM
 	select HAVE_KVM_CPU_RELAX_INTERCEPT
 	select KVM_MMIO
 	select KVM_GENERIC_DIRTYLOG_READ_PROTECT
-	select KVM_XFER_TO_GUEST_WORK
+	select VIRT_XFER_TO_GUEST_WORK
 	select KVM_VFIO
 	select HAVE_KVM_DIRTY_RING_ACQ_REL
 	select NEED_KVM_DIRTY_RING_WITH_BITMAP
diff --git a/arch/arm64/kvm/arm.c b/arch/arm64/kvm/arm.c
index fa79744290f3..f21d1b7f20f8 100644
--- a/arch/arm64/kvm/arm.c
+++ b/arch/arm64/kvm/arm.c
@@ -6,7 +6,6 @@
 
 #include <linux/bug.h>
 #include <linux/cpu_pm.h>
-#include <linux/entry-kvm.h>
 #include <linux/errno.h>
 #include <linux/err.h>
 #include <linux/kvm_host.h>
@@ -1183,7 +1182,7 @@ int kvm_arch_vcpu_ioctl_run(struct kvm_vcpu *vcpu)
 		/*
 		 * Check conditions before entering the guest
 		 */
-		ret = xfer_to_guest_mode_handle_work(vcpu);
+		ret = kvm_xfer_to_guest_mode_handle_work(vcpu);
 		if (!ret)
 			ret = 1;
 
diff --git a/arch/arm64/kvm/handle_exit.c b/arch/arm64/kvm/handle_exit.c
index d449e15680e4..bca8c80e11da 100644
--- a/arch/arm64/kvm/handle_exit.c
+++ b/arch/arm64/kvm/handle_exit.c
@@ -545,7 +545,7 @@ void __noreturn __cold nvhe_hyp_panic_handler(u64 esr, u64 spsr,
 			kvm_err("nVHE hyp BUG at: %s:%u!\n", file, line);
 		else
 			print_nvhe_hyp_panic("BUG", panic_addr);
-	} else if (IS_ENABLED(CONFIG_CFI_CLANG) && esr_is_cfi_brk(esr)) {
+	} else if (IS_ENABLED(CONFIG_CFI) && esr_is_cfi_brk(esr)) {
 		kvm_nvhe_report_cfi_failure(panic_addr);
 	} else if (IS_ENABLED(CONFIG_UBSAN_KVM_EL2) &&
 		   ESR_ELx_EC(esr) == ESR_ELx_EC_BRK64 &&
diff --git a/arch/arm64/net/bpf_jit_comp.c b/arch/arm64/net/bpf_jit_comp.c
index 288d9cc73919..ab83089c3d8f 100644
--- a/arch/arm64/net/bpf_jit_comp.c
+++ b/arch/arm64/net/bpf_jit_comp.c
@@ -185,7 +185,7 @@ static inline void emit_bti(u32 insn, struct jit_ctx *ctx)
 
 static inline void emit_kcfi(u32 hash, struct jit_ctx *ctx)
 {
-	if (IS_ENABLED(CONFIG_CFI_CLANG))
+	if (IS_ENABLED(CONFIG_CFI))
 		emit_u32_data(hash, ctx);
 }
 
diff --git a/arch/csky/include/asm/bitops.h b/arch/csky/include/asm/bitops.h
index 72e1b2aa29a0..80d67eee6e86 100644
--- a/arch/csky/include/asm/bitops.h
+++ b/arch/csky/include/asm/bitops.h
@@ -9,7 +9,7 @@
 /*
  * asm-generic/bitops/ffs.h
  */
-static inline int ffs(int x)
+static inline __attribute_const__ int ffs(int x)
 {
 	if (!x)
 		return 0;
@@ -26,7 +26,7 @@ static inline int ffs(int x)
 /*
  * asm-generic/bitops/__ffs.h
  */
-static __always_inline unsigned long __ffs(unsigned long x)
+static __always_inline __attribute_const__ unsigned long __ffs(unsigned long x)
 {
 	asm volatile (
 		"brev %0\n"
@@ -39,7 +39,7 @@ static __always_inline unsigned long __ffs(unsigned long x)
 /*
  * asm-generic/bitops/fls.h
  */
-static __always_inline int fls(unsigned int x)
+static __always_inline __attribute_const__ int fls(unsigned int x)
 {
 	asm volatile(
 		"ff1 %0\n"
@@ -52,7 +52,7 @@ static __always_inline int fls(unsigned int x)
 /*
  * asm-generic/bitops/__fls.h
  */
-static __always_inline unsigned long __fls(unsigned long x)
+static __always_inline __attribute_const__ unsigned long __fls(unsigned long x)
 {
 	return fls(x) - 1;
 }
diff --git a/arch/hexagon/include/asm/bitops.h b/arch/hexagon/include/asm/bitops.h
index 160d8f37fa1a..b23cb13833af 100644
--- a/arch/hexagon/include/asm/bitops.h
+++ b/arch/hexagon/include/asm/bitops.h
@@ -200,7 +200,7 @@ arch_test_bit_acquire(unsigned long nr, const volatile unsigned long *addr)
  *
  * Undefined if no zero exists, so code should check against ~0UL first.
  */
-static inline long ffz(int x)
+static inline long __attribute_const__ ffz(int x)
 {
 	int r;
 
@@ -217,7 +217,7 @@ static inline long ffz(int x)
  * This is defined the same way as ffs.
  * Note fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
-static inline int fls(unsigned int x)
+static inline __attribute_const__ int fls(unsigned int x)
 {
 	int r;
 
@@ -238,7 +238,7 @@ static inline int fls(unsigned int x)
  * the libc and compiler builtin ffs routines, therefore
  * differs in spirit from the above ffz (man ffs).
  */
-static inline int ffs(int x)
+static inline __attribute_const__ int ffs(int x)
 {
 	int r;
 
@@ -260,7 +260,7 @@ static inline int ffs(int x)
  * bits_per_long assumed to be 32
  * numbering starts at 0 I think (instead of 1 like ffs)
  */
-static inline unsigned long __ffs(unsigned long word)
+static inline __attribute_const__ unsigned long __ffs(unsigned long word)
 {
 	int num;
 
@@ -278,7 +278,7 @@ static inline unsigned long __ffs(unsigned long word)
  * Undefined if no set bit exists, so code should check against 0 first.
  * bits_per_long assumed to be 32
  */
-static inline unsigned long __fls(unsigned long word)
+static inline __attribute_const__ unsigned long __fls(unsigned long word)
 {
 	int num;
 
diff --git a/arch/loongarch/include/asm/efi.h b/arch/loongarch/include/asm/efi.h
index eddc8e79b3fa..84cf2151123f 100644
--- a/arch/loongarch/include/asm/efi.h
+++ b/arch/loongarch/include/asm/efi.h
@@ -14,7 +14,7 @@ void efifb_setup_from_dmi(struct screen_info *si, const char *opt);
 
 #define ARCH_EFI_IRQ_FLAGS_MASK  0x00000004  /* Bit 2: CSR.CRMD.IE */
 
-#define arch_efi_call_virt_setup()
+#define arch_efi_call_virt_setup()	true
 #define arch_efi_call_virt_teardown()
 
 #define EFI_ALLOC_ALIGN		SZ_64K
diff --git a/arch/loongarch/kvm/Kconfig b/arch/loongarch/kvm/Kconfig
index 40eea6da7c25..ae64bbdf83a7 100644
--- a/arch/loongarch/kvm/Kconfig
+++ b/arch/loongarch/kvm/Kconfig
@@ -31,7 +31,7 @@ config KVM
 	select KVM_GENERIC_HARDWARE_ENABLING
 	select KVM_GENERIC_MMU_NOTIFIER
 	select KVM_MMIO
-	select KVM_XFER_TO_GUEST_WORK
+	select VIRT_XFER_TO_GUEST_WORK
 	select SCHED_INFO
 	select GUEST_PERF_EVENTS if PERF_EVENTS
 	help
diff --git a/arch/loongarch/kvm/vcpu.c b/arch/loongarch/kvm/vcpu.c
index 9c802f7103c6..30e3b089a596 100644
--- a/arch/loongarch/kvm/vcpu.c
+++ b/arch/loongarch/kvm/vcpu.c
@@ -4,7 +4,6 @@
  */
 
 #include <linux/kvm_host.h>
-#include <linux/entry-kvm.h>
 #include <asm/fpu.h>
 #include <asm/lbt.h>
 #include <asm/loongarch.h>
@@ -251,7 +250,7 @@ static int kvm_enter_guest_check(struct kvm_vcpu *vcpu)
 	/*
 	 * Check conditions before entering the guest
 	 */
-	ret = xfer_to_guest_mode_handle_work(vcpu);
+	ret = kvm_xfer_to_guest_mode_handle_work(vcpu);
 	if (ret < 0)
 		return ret;
 
diff --git a/arch/m68k/include/asm/bitops.h b/arch/m68k/include/asm/bitops.h
index 50ec92651d5a..e9639e48c6c3 100644
--- a/arch/m68k/include/asm/bitops.h
+++ b/arch/m68k/include/asm/bitops.h
@@ -468,7 +468,7 @@ static inline unsigned long find_next_bit(const unsigned long *vaddr,
  * ffz = Find First Zero in word. Undefined if no zero exists,
  * so code should check against ~0UL first..
  */
-static inline unsigned long ffz(unsigned long word)
+static inline unsigned long __attribute_const__ ffz(unsigned long word)
 {
 	int res;
 
@@ -491,7 +491,7 @@ static inline unsigned long ffz(unsigned long word)
  */
 #if (defined(__mcfisaaplus__) || defined(__mcfisac__)) && \
 	!defined(CONFIG_M68000)
-static inline unsigned long __ffs(unsigned long x)
+static inline __attribute_const__ unsigned long __ffs(unsigned long x)
 {
 	__asm__ __volatile__ ("bitrev %0; ff1 %0"
 		: "=d" (x)
@@ -499,7 +499,7 @@ static inline unsigned long __ffs(unsigned long x)
 	return x;
 }
 
-static inline int ffs(int x)
+static inline __attribute_const__ int ffs(int x)
 {
 	if (!x)
 		return 0;
@@ -521,7 +521,7 @@ static inline int ffs(int x)
  *	the libc and compiler builtin ffs routines, therefore
  *	differs in spirit from the above ffz (man ffs).
  */
-static inline int ffs(int x)
+static inline __attribute_const__ int ffs(int x)
 {
 	int cnt;
 
@@ -531,7 +531,7 @@ static inline int ffs(int x)
 	return 32 - cnt;
 }
 
-static inline unsigned long __ffs(unsigned long x)
+static inline __attribute_const__ unsigned long __ffs(unsigned long x)
 {
 	return ffs(x) - 1;
 }
@@ -539,7 +539,7 @@ static inline unsigned long __ffs(unsigned long x)
 /*
  *	fls: find last bit set.
  */
-static inline int fls(unsigned int x)
+static inline __attribute_const__ int fls(unsigned int x)
 {
 	int cnt;
 
@@ -549,7 +549,7 @@ static inline int fls(unsigned int x)
 	return 32 - cnt;
 }
 
-static inline unsigned long __fls(unsigned long x)
+static inline __attribute_const__ unsigned long __fls(unsigned long x)
 {
 	return fls(x) - 1;
 }
diff --git a/arch/mips/include/asm/bitops.h b/arch/mips/include/asm/bitops.h
index 89f73d1a4ea4..42f88452c920 100644
--- a/arch/mips/include/asm/bitops.h
+++ b/arch/mips/include/asm/bitops.h
@@ -327,7 +327,7 @@ static inline void __clear_bit_unlock(unsigned long nr, volatile unsigned long *
  * Return the bit position (0..63) of the most significant 1 bit in a word
  * Returns -1 if no 1 bit exists
  */
-static __always_inline unsigned long __fls(unsigned long word)
+static __always_inline __attribute_const__ unsigned long __fls(unsigned long word)
 {
 	int num;
 
@@ -393,7 +393,7 @@ static __always_inline unsigned long __fls(unsigned long word)
  * Returns 0..SZLONG-1
  * Undefined if no bit exists, so code should check against 0 first.
  */
-static __always_inline unsigned long __ffs(unsigned long word)
+static __always_inline __attribute_const__ unsigned long __ffs(unsigned long word)
 {
 	return __fls(word & -word);
 }
@@ -405,7 +405,7 @@ static __always_inline unsigned long __ffs(unsigned long word)
  * This is defined the same way as ffs.
  * Note fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
-static inline int fls(unsigned int x)
+static inline __attribute_const__ int fls(unsigned int x)
 {
 	int r;
 
@@ -458,7 +458,7 @@ static inline int fls(unsigned int x)
  * the libc and compiler builtin ffs routines, therefore
  * differs in spirit from the below ffz (man ffs).
  */
-static inline int ffs(int word)
+static inline __attribute_const__ int ffs(int word)
 {
 	if (!word)
 		return 0;
diff --git a/arch/openrisc/include/asm/bitops/__ffs.h b/arch/openrisc/include/asm/bitops/__ffs.h
index 1e224b616fdf..4827b66530b2 100644
--- a/arch/openrisc/include/asm/bitops/__ffs.h
+++ b/arch/openrisc/include/asm/bitops/__ffs.h
@@ -11,7 +11,7 @@
 
 #ifdef CONFIG_OPENRISC_HAVE_INST_FF1
 
-static inline unsigned long __ffs(unsigned long x)
+static inline __attribute_const__ unsigned long __ffs(unsigned long x)
 {
 	int ret;
 
diff --git a/arch/openrisc/include/asm/bitops/__fls.h b/arch/openrisc/include/asm/bitops/__fls.h
index 9658446ad141..637cc76fe4b7 100644
--- a/arch/openrisc/include/asm/bitops/__fls.h
+++ b/arch/openrisc/include/asm/bitops/__fls.h
@@ -11,7 +11,7 @@
 
 #ifdef CONFIG_OPENRISC_HAVE_INST_FL1
 
-static inline unsigned long __fls(unsigned long x)
+static inline __attribute_const__ unsigned long __fls(unsigned long x)
 {
 	int ret;
 
diff --git a/arch/openrisc/include/asm/bitops/ffs.h b/arch/openrisc/include/asm/bitops/ffs.h
index b4c835d6bc84..536a60ab9cc3 100644
--- a/arch/openrisc/include/asm/bitops/ffs.h
+++ b/arch/openrisc/include/asm/bitops/ffs.h
@@ -10,7 +10,7 @@
 
 #ifdef CONFIG_OPENRISC_HAVE_INST_FF1
 
-static inline int ffs(int x)
+static inline __attribute_const__ int ffs(int x)
 {
 	int ret;
 
diff --git a/arch/openrisc/include/asm/bitops/fls.h b/arch/openrisc/include/asm/bitops/fls.h
index 6b77f6556fb9..77da7639bb3e 100644
--- a/arch/openrisc/include/asm/bitops/fls.h
+++ b/arch/openrisc/include/asm/bitops/fls.h
@@ -11,7 +11,7 @@
 
 #ifdef CONFIG_OPENRISC_HAVE_INST_FL1
 
-static inline int fls(unsigned int x)
+static inline __attribute_const__ int fls(unsigned int x)
 {
 	int ret;
 
diff --git a/arch/parisc/include/asm/bitops.h b/arch/parisc/include/asm/bitops.h
index 0ec9cfc5131f..bd1280a8a5ec 100644
--- a/arch/parisc/include/asm/bitops.h
+++ b/arch/parisc/include/asm/bitops.h
@@ -123,7 +123,7 @@ static __inline__ int test_and_change_bit(int nr, volatile unsigned long * addr)
  * cycles for each mispredicted branch.
  */
 
-static __inline__ unsigned long __ffs(unsigned long x)
+static __inline__ __attribute_const__ unsigned long __ffs(unsigned long x)
 {
 	unsigned long ret;
 
@@ -161,7 +161,7 @@ static __inline__ unsigned long __ffs(unsigned long x)
  * This is defined the same way as the libc and compiler builtin
  * ffs routines, therefore differs in spirit from the above ffz (man ffs).
  */
-static __inline__ int ffs(int x)
+static __inline__ __attribute_const__ int ffs(int x)
 {
 	return x ? (__ffs((unsigned long)x) + 1) : 0;
 }
@@ -171,7 +171,7 @@ static __inline__ int ffs(int x)
  * fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
 
-static __inline__ int fls(unsigned int x)
+static __inline__ __attribute_const__ int fls(unsigned int x)
 {
 	int ret;
 	if (!x)
diff --git a/arch/powerpc/include/asm/bitops.h b/arch/powerpc/include/asm/bitops.h
index 671ecc6711e3..0d0470cd5ac3 100644
--- a/arch/powerpc/include/asm/bitops.h
+++ b/arch/powerpc/include/asm/bitops.h
@@ -276,7 +276,7 @@ static inline void arch___clear_bit_unlock(int nr, volatile unsigned long *addr)
  * fls: find last (most-significant) bit set.
  * Note fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
-static __always_inline int fls(unsigned int x)
+static __always_inline __attribute_const__ int fls(unsigned int x)
 {
 	int lz;
 
@@ -294,7 +294,7 @@ static __always_inline int fls(unsigned int x)
  * 32-bit fls calls.
  */
 #ifdef CONFIG_PPC64
-static __always_inline int fls64(__u64 x)
+static __always_inline __attribute_const__ int fls64(__u64 x)
 {
 	int lz;
 
diff --git a/arch/riscv/Kconfig b/arch/riscv/Kconfig
index f336a0c9539c..767132c39681 100644
--- a/arch/riscv/Kconfig
+++ b/arch/riscv/Kconfig
@@ -29,6 +29,7 @@ config RISCV
 	select ARCH_HAS_DEBUG_VIRTUAL if MMU
 	select ARCH_HAS_DEBUG_VM_PGTABLE
 	select ARCH_HAS_DEBUG_WX
+	select ARCH_HAS_ELF_CORE_EFLAGS
 	select ARCH_HAS_FAST_MULTIPLIER
 	select ARCH_HAS_FORTIFY_SOURCE
 	select ARCH_HAS_GCOV_PROFILE_ALL
@@ -62,7 +63,7 @@ config RISCV
 	select ARCH_STACKWALK
 	select ARCH_SUPPORTS_ATOMIC_RMW
 	# clang >= 17: https://github.com/llvm/llvm-project/commit/62fa708ceb027713b386c7e0efda994f8bdc27e2
-	select ARCH_SUPPORTS_CFI_CLANG if CLANG_VERSION >= 170000
+	select ARCH_SUPPORTS_CFI if (!CC_IS_CLANG || CLANG_VERSION >= 170000)
 	select ARCH_SUPPORTS_DEBUG_PAGEALLOC if MMU
 	select ARCH_SUPPORTS_HUGE_PFNMAP if TRANSPARENT_HUGEPAGE
 	select ARCH_SUPPORTS_HUGETLBFS if MMU
@@ -78,7 +79,7 @@ config RISCV
 	select ARCH_USE_MEMTEST
 	select ARCH_USE_QUEUED_RWLOCKS
 	select ARCH_USE_SYM_ANNOTATIONS
-	select ARCH_USES_CFI_TRAPS if CFI_CLANG
+	select ARCH_USES_CFI_TRAPS if CFI
 	select ARCH_WANT_BATCHED_UNMAP_TLB_FLUSH if MMU
 	select ARCH_WANT_DEFAULT_TOPDOWN_MMAP_LAYOUT if MMU
 	select ARCH_WANT_FRAME_POINTERS
@@ -154,7 +155,7 @@ config RISCV
 	select HAVE_DYNAMIC_FTRACE if !XIP_KERNEL && MMU && (CLANG_SUPPORTS_DYNAMIC_FTRACE || GCC_SUPPORTS_DYNAMIC_FTRACE)
 	select FUNCTION_ALIGNMENT_4B if HAVE_DYNAMIC_FTRACE && RISCV_ISA_C
 	select HAVE_DYNAMIC_FTRACE_WITH_DIRECT_CALLS if HAVE_DYNAMIC_FTRACE_WITH_CALL_OPS
-	select HAVE_DYNAMIC_FTRACE_WITH_CALL_OPS if (DYNAMIC_FTRACE_WITH_ARGS && !CFI_CLANG)
+	select HAVE_DYNAMIC_FTRACE_WITH_CALL_OPS if (DYNAMIC_FTRACE_WITH_ARGS && !CFI)
 	select HAVE_DYNAMIC_FTRACE_WITH_ARGS if HAVE_DYNAMIC_FTRACE
 	select HAVE_FTRACE_GRAPH_FUNC
 	select HAVE_FUNCTION_GRAPH_TRACER if HAVE_DYNAMIC_FTRACE_WITH_ARGS
diff --git a/arch/riscv/include/asm/bitops.h b/arch/riscv/include/asm/bitops.h
index d59310f74c2b..77880677b06e 100644
--- a/arch/riscv/include/asm/bitops.h
+++ b/arch/riscv/include/asm/bitops.h
@@ -45,7 +45,7 @@
 #error "Unexpected BITS_PER_LONG"
 #endif
 
-static __always_inline unsigned long variable__ffs(unsigned long word)
+static __always_inline __attribute_const__ unsigned long variable__ffs(unsigned long word)
 {
 	asm goto(ALTERNATIVE("j %l[legacy]", "nop", 0,
 				      RISCV_ISA_EXT_ZBB, 1)
@@ -74,7 +74,7 @@ static __always_inline unsigned long variable__ffs(unsigned long word)
 	 (unsigned long)__builtin_ctzl(word) :	\
 	 variable__ffs(word))
 
-static __always_inline unsigned long variable__fls(unsigned long word)
+static __always_inline __attribute_const__ unsigned long variable__fls(unsigned long word)
 {
 	asm goto(ALTERNATIVE("j %l[legacy]", "nop", 0,
 				      RISCV_ISA_EXT_ZBB, 1)
@@ -103,7 +103,7 @@ static __always_inline unsigned long variable__fls(unsigned long word)
 	 (unsigned long)(BITS_PER_LONG - 1 - __builtin_clzl(word)) :	\
 	 variable__fls(word))
 
-static __always_inline int variable_ffs(int x)
+static __always_inline __attribute_const__ int variable_ffs(int x)
 {
 	asm goto(ALTERNATIVE("j %l[legacy]", "nop", 0,
 				      RISCV_ISA_EXT_ZBB, 1)
diff --git a/arch/riscv/include/asm/cfi.h b/arch/riscv/include/asm/cfi.h
index 4508aaa7a2fd..710aa8192edd 100644
--- a/arch/riscv/include/asm/cfi.h
+++ b/arch/riscv/include/asm/cfi.h
@@ -11,7 +11,7 @@
 
 struct pt_regs;
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 enum bug_trap_type handle_cfi_failure(struct pt_regs *regs);
 #define __bpfcall
 #else
@@ -19,6 +19,6 @@ static inline enum bug_trap_type handle_cfi_failure(struct pt_regs *regs)
 {
 	return BUG_TRAP_TYPE_NONE;
 }
-#endif /* CONFIG_CFI_CLANG */
+#endif /* CONFIG_CFI */
 
 #endif /* _ASM_RISCV_CFI_H */
diff --git a/arch/riscv/include/asm/efi.h b/arch/riscv/include/asm/efi.h
index 46a355913b27..a7b4d719e7be 100644
--- a/arch/riscv/include/asm/efi.h
+++ b/arch/riscv/include/asm/efi.h
@@ -40,7 +40,7 @@ static inline unsigned long efi_get_kimg_min_align(void)
 
 #define EFI_KIMG_PREFERRED_ADDRESS	efi_get_kimg_min_align()
 
-void arch_efi_call_virt_setup(void);
+bool arch_efi_call_virt_setup(void);
 void arch_efi_call_virt_teardown(void);
 
 unsigned long stext_offset(void);
diff --git a/arch/riscv/kernel/Makefile b/arch/riscv/kernel/Makefile
index c7b542573407..f60fce69b725 100644
--- a/arch/riscv/kernel/Makefile
+++ b/arch/riscv/kernel/Makefile
@@ -113,7 +113,7 @@ obj-$(CONFIG_VMCORE_INFO)	+= vmcore_info.o
 
 obj-$(CONFIG_JUMP_LABEL)	+= jump_label.o
 
-obj-$(CONFIG_CFI_CLANG)		+= cfi.o
+obj-$(CONFIG_CFI)		+= cfi.o
 
 obj-$(CONFIG_EFI)		+= efi.o
 obj-$(CONFIG_COMPAT)		+= compat_syscall_table.o
diff --git a/arch/riscv/kvm/Kconfig b/arch/riscv/kvm/Kconfig
index 5a62091b0809..c50328212917 100644
--- a/arch/riscv/kvm/Kconfig
+++ b/arch/riscv/kvm/Kconfig
@@ -30,7 +30,7 @@ config KVM
 	select KVM_GENERIC_DIRTYLOG_READ_PROTECT
 	select KVM_GENERIC_HARDWARE_ENABLING
 	select KVM_MMIO
-	select KVM_XFER_TO_GUEST_WORK
+	select VIRT_XFER_TO_GUEST_WORK
 	select KVM_GENERIC_MMU_NOTIFIER
 	select SCHED_INFO
 	select GUEST_PERF_EVENTS if PERF_EVENTS
diff --git a/arch/riscv/kvm/vcpu.c b/arch/riscv/kvm/vcpu.c
index 47bcf190ccc5..bccb919ca615 100644
--- a/arch/riscv/kvm/vcpu.c
+++ b/arch/riscv/kvm/vcpu.c
@@ -7,7 +7,6 @@
  */
 
 #include <linux/bitops.h>
-#include <linux/entry-kvm.h>
 #include <linux/errno.h>
 #include <linux/err.h>
 #include <linux/kdebug.h>
@@ -911,7 +910,7 @@ int kvm_arch_vcpu_ioctl_run(struct kvm_vcpu *vcpu)
 	run->exit_reason = KVM_EXIT_UNKNOWN;
 	while (ret > 0) {
 		/* Check conditions before entering the guest */
-		ret = xfer_to_guest_mode_handle_work(vcpu);
+		ret = kvm_xfer_to_guest_mode_handle_work(vcpu);
 		if (ret)
 			continue;
 		ret = 1;
diff --git a/arch/riscv/net/bpf_jit_comp64.c b/arch/riscv/net/bpf_jit_comp64.c
index d0d2768d100d..45cbc7c6fe49 100644
--- a/arch/riscv/net/bpf_jit_comp64.c
+++ b/arch/riscv/net/bpf_jit_comp64.c
@@ -18,7 +18,7 @@
 #define RV_MAX_REG_ARGS 8
 #define RV_FENTRY_NINSNS 2
 #define RV_FENTRY_NBYTES (RV_FENTRY_NINSNS * 4)
-#define RV_KCFI_NINSNS (IS_ENABLED(CONFIG_CFI_CLANG) ? 1 : 0)
+#define RV_KCFI_NINSNS (IS_ENABLED(CONFIG_CFI) ? 1 : 0)
 /* imm that allows emit_imm to emit max count insns */
 #define RV_MAX_COUNT_IMM 0x7FFF7FF7FF7FF7FF
 
@@ -469,7 +469,7 @@ static int emit_call(u64 addr, bool fixed_addr, struct rv_jit_context *ctx)
 
 static inline void emit_kcfi(u32 hash, struct rv_jit_context *ctx)
 {
-	if (IS_ENABLED(CONFIG_CFI_CLANG))
+	if (IS_ENABLED(CONFIG_CFI))
 		emit(hash, ctx);
 }
 
diff --git a/arch/riscv/purgatory/Makefile b/arch/riscv/purgatory/Makefile
index 240592e3f5c2..530e497ca2f9 100644
--- a/arch/riscv/purgatory/Makefile
+++ b/arch/riscv/purgatory/Makefile
@@ -71,7 +71,7 @@ ifdef CONFIG_STACKPROTECTOR_STRONG
 PURGATORY_CFLAGS_REMOVE		+= -fstack-protector-strong
 endif
 
-ifdef CONFIG_CFI_CLANG
+ifdef CONFIG_CFI
 PURGATORY_CFLAGS_REMOVE		+= $(CC_FLAGS_CFI)
 endif
 
diff --git a/arch/s390/include/asm/bitops.h b/arch/s390/include/asm/bitops.h
index 1564dd3a5a82..ec945fb60c02 100644
--- a/arch/s390/include/asm/bitops.h
+++ b/arch/s390/include/asm/bitops.h
@@ -189,7 +189,7 @@ static __always_inline __attribute_const__ unsigned long __flogr(unsigned long w
  * This is defined the same way as the libc and
  * compiler builtin ffs routines (man ffs).
  */
-static __always_inline __flatten int ffs(int word)
+static __always_inline __flatten __attribute_const__ int ffs(int word)
 {
 	unsigned int val = (unsigned int)word;
 
diff --git a/arch/sh/include/asm/bitops.h b/arch/sh/include/asm/bitops.h
index 10ceb0d6b5a9..aba3aa96a50e 100644
--- a/arch/sh/include/asm/bitops.h
+++ b/arch/sh/include/asm/bitops.h
@@ -24,7 +24,7 @@
 #include <asm-generic/bitops/non-atomic.h>
 #endif
 
-static inline unsigned long ffz(unsigned long word)
+static inline unsigned long __attribute_const__ ffz(unsigned long word)
 {
 	unsigned long result;
 
@@ -44,7 +44,7 @@ static inline unsigned long ffz(unsigned long word)
  *
  * Undefined if no bit exists, so code should check against 0 first.
  */
-static inline unsigned long __ffs(unsigned long word)
+static inline __attribute_const__ unsigned long __ffs(unsigned long word)
 {
 	unsigned long result;
 
diff --git a/arch/sparc/include/asm/bitops_64.h b/arch/sparc/include/asm/bitops_64.h
index 005a8ae858f1..2c7d33b3ec2e 100644
--- a/arch/sparc/include/asm/bitops_64.h
+++ b/arch/sparc/include/asm/bitops_64.h
@@ -23,8 +23,8 @@ void set_bit(unsigned long nr, volatile unsigned long *addr);
 void clear_bit(unsigned long nr, volatile unsigned long *addr);
 void change_bit(unsigned long nr, volatile unsigned long *addr);
 
-int fls(unsigned int word);
-int __fls(unsigned long word);
+int __attribute_const__ fls(unsigned int word);
+int __attribute_const__ __fls(unsigned long word);
 
 #include <asm-generic/bitops/non-atomic.h>
 
@@ -32,8 +32,8 @@ int __fls(unsigned long word);
 
 #ifdef __KERNEL__
 
-int ffs(int x);
-unsigned long __ffs(unsigned long);
+int __attribute_const__ ffs(int x);
+unsigned long __attribute_const__ __ffs(unsigned long);
 
 #include <asm-generic/bitops/ffz.h>
 #include <asm-generic/bitops/sched.h>
diff --git a/arch/x86/Kconfig b/arch/x86/Kconfig
index 406c6a360ec4..fa3b616af03a 100644
--- a/arch/x86/Kconfig
+++ b/arch/x86/Kconfig
@@ -126,8 +126,8 @@ config X86
 	select ARCH_SUPPORTS_PAGE_TABLE_CHECK	if X86_64
 	select ARCH_SUPPORTS_NUMA_BALANCING	if X86_64
 	select ARCH_SUPPORTS_KMAP_LOCAL_FORCE_MAP	if NR_CPUS <= 4096
-	select ARCH_SUPPORTS_CFI_CLANG		if X86_64
-	select ARCH_USES_CFI_TRAPS		if X86_64 && CFI_CLANG
+	select ARCH_SUPPORTS_CFI		if X86_64
+	select ARCH_USES_CFI_TRAPS		if X86_64 && CFI
 	select ARCH_SUPPORTS_LTO_CLANG
 	select ARCH_SUPPORTS_LTO_CLANG_THIN
 	select ARCH_SUPPORTS_RT
@@ -2397,11 +2397,11 @@ config FUNCTION_PADDING_CFI
 	default  3 if FUNCTION_ALIGNMENT_8B
 	default  0
 
-# Basically: FUNCTION_ALIGNMENT - 5*CFI_CLANG
+# Basically: FUNCTION_ALIGNMENT - 5*CFI
 # except Kconfig can't do arithmetic :/
 config FUNCTION_PADDING_BYTES
 	int
-	default FUNCTION_PADDING_CFI if CFI_CLANG
+	default FUNCTION_PADDING_CFI if CFI
 	default FUNCTION_ALIGNMENT
 
 config CALL_PADDING
@@ -2411,7 +2411,7 @@ config CALL_PADDING
 
 config FINEIBT
 	def_bool y
-	depends on X86_KERNEL_IBT && CFI_CLANG && MITIGATION_RETPOLINE
+	depends on X86_KERNEL_IBT && CFI && MITIGATION_RETPOLINE
 	select CALL_PADDING
 
 config FINEIBT_BHI
@@ -2428,7 +2428,7 @@ config CALL_THUNKS
 
 config PREFIX_SYMBOLS
 	def_bool y
-	depends on CALL_PADDING && !CFI_CLANG
+	depends on CALL_PADDING && !CFI
 
 menuconfig CPU_MITIGATIONS
 	bool "Mitigations for CPU vulnerabilities"
diff --git a/arch/x86/hyperv/irqdomain.c b/arch/x86/hyperv/irqdomain.c
index 090f5ac9f492..c3ba12b1bc07 100644
--- a/arch/x86/hyperv/irqdomain.c
+++ b/arch/x86/hyperv/irqdomain.c
@@ -11,6 +11,7 @@
 #include <linux/pci.h>
 #include <linux/irq.h>
 #include <linux/export.h>
+#include <linux/irqchip/irq-msi-lib.h>
 #include <asm/mshyperv.h>
 
 static int hv_map_interrupt(union hv_device_id device_id, bool level,
@@ -289,59 +290,99 @@ static void hv_teardown_msi_irq(struct pci_dev *dev, struct irq_data *irqd)
 	(void)hv_unmap_msi_interrupt(dev, &old_entry);
 }
 
-static void hv_msi_free_irq(struct irq_domain *domain,
-			    struct msi_domain_info *info, unsigned int virq)
-{
-	struct irq_data *irqd = irq_get_irq_data(virq);
-	struct msi_desc *desc;
-
-	if (!irqd)
-		return;
-
-	desc = irq_data_get_msi_desc(irqd);
-	if (!desc || !desc->irq || WARN_ON_ONCE(!dev_is_pci(desc->dev)))
-		return;
-
-	hv_teardown_msi_irq(to_pci_dev(desc->dev), irqd);
-}
-
 /*
  * IRQ Chip for MSI PCI/PCI-X/PCI-Express Devices,
  * which implement the MSI or MSI-X Capability Structure.
  */
 static struct irq_chip hv_pci_msi_controller = {
 	.name			= "HV-PCI-MSI",
-	.irq_unmask		= pci_msi_unmask_irq,
-	.irq_mask		= pci_msi_mask_irq,
 	.irq_ack		= irq_chip_ack_parent,
-	.irq_retrigger		= irq_chip_retrigger_hierarchy,
 	.irq_compose_msi_msg	= hv_irq_compose_msi_msg,
-	.irq_set_affinity	= msi_domain_set_affinity,
-	.flags			= IRQCHIP_SKIP_SET_WAKE | IRQCHIP_MOVE_DEFERRED,
+	.irq_set_affinity	= irq_chip_set_affinity_parent,
 };
 
-static struct msi_domain_ops pci_msi_domain_ops = {
-	.msi_free		= hv_msi_free_irq,
-	.msi_prepare		= pci_msi_prepare,
+static bool hv_init_dev_msi_info(struct device *dev, struct irq_domain *domain,
+				 struct irq_domain *real_parent, struct msi_domain_info *info)
+{
+	struct irq_chip *chip = info->chip;
+
+	if (!msi_lib_init_dev_msi_info(dev, domain, real_parent, info))
+		return false;
+
+	chip->flags |= IRQCHIP_SKIP_SET_WAKE | IRQCHIP_MOVE_DEFERRED;
+
+	info->ops->msi_prepare = pci_msi_prepare;
+
+	return true;
+}
+
+#define HV_MSI_FLAGS_SUPPORTED	(MSI_GENERIC_FLAGS_MASK | MSI_FLAG_PCI_MSIX)
+#define HV_MSI_FLAGS_REQUIRED	(MSI_FLAG_USE_DEF_DOM_OPS | MSI_FLAG_USE_DEF_CHIP_OPS)
+
+static struct msi_parent_ops hv_msi_parent_ops = {
+	.supported_flags	= HV_MSI_FLAGS_SUPPORTED,
+	.required_flags		= HV_MSI_FLAGS_REQUIRED,
+	.bus_select_token	= DOMAIN_BUS_NEXUS,
+	.bus_select_mask	= MATCH_PCI_MSI,
+	.chip_flags		= MSI_CHIP_FLAG_SET_ACK,
+	.prefix			= "HV-",
+	.init_dev_msi_info	= hv_init_dev_msi_info,
 };
 
-static struct msi_domain_info hv_pci_msi_domain_info = {
-	.flags		= MSI_FLAG_USE_DEF_DOM_OPS | MSI_FLAG_USE_DEF_CHIP_OPS |
-			  MSI_FLAG_PCI_MSIX,
-	.ops		= &pci_msi_domain_ops,
-	.chip		= &hv_pci_msi_controller,
-	.handler	= handle_edge_irq,
-	.handler_name	= "edge",
+static int hv_msi_domain_alloc(struct irq_domain *d, unsigned int virq, unsigned int nr_irqs,
+			       void *arg)
+{
+	/*
+	 * TODO: The allocation bits of hv_irq_compose_msi_msg(), i.e. everything except
+	 * entry_to_msi_msg() should be in here.
+	 */
+
+	int ret;
+
+	ret = irq_domain_alloc_irqs_parent(d, virq, nr_irqs, arg);
+	if (ret)
+		return ret;
+
+	for (int i = 0; i < nr_irqs; ++i) {
+		irq_domain_set_info(d, virq + i, 0, &hv_pci_msi_controller, NULL,
+				    handle_edge_irq, NULL, "edge");
+	}
+	return 0;
+}
+
+static void hv_msi_domain_free(struct irq_domain *d, unsigned int virq, unsigned int nr_irqs)
+{
+	for (int i = 0; i < nr_irqs; ++i) {
+		struct irq_data *irqd = irq_domain_get_irq_data(d, virq);
+		struct msi_desc *desc;
+
+		desc = irq_data_get_msi_desc(irqd);
+		if (!desc || !desc->irq || WARN_ON_ONCE(!dev_is_pci(desc->dev)))
+			continue;
+
+		hv_teardown_msi_irq(to_pci_dev(desc->dev), irqd);
+	}
+	irq_domain_free_irqs_top(d, virq, nr_irqs);
+}
+
+static const struct irq_domain_ops hv_msi_domain_ops = {
+	.select	= msi_lib_irq_domain_select,
+	.alloc	= hv_msi_domain_alloc,
+	.free	= hv_msi_domain_free,
 };
 
 struct irq_domain * __init hv_create_pci_msi_domain(void)
 {
 	struct irq_domain *d = NULL;
-	struct fwnode_handle *fn;
 
-	fn = irq_domain_alloc_named_fwnode("HV-PCI-MSI");
-	if (fn)
-		d = pci_msi_create_irq_domain(fn, &hv_pci_msi_domain_info, x86_vector_domain);
+	struct irq_domain_info info = {
+		.fwnode		= irq_domain_alloc_named_fwnode("HV-PCI-MSI"),
+		.ops		= &hv_msi_domain_ops,
+		.parent		= x86_vector_domain,
+	};
+
+	if (info.fwnode)
+		d = msi_create_parent_irq_domain(&info, &hv_msi_parent_ops);
 
 	/* No point in going further if we can't get an irq domain */
 	BUG_ON(!d);
diff --git a/arch/x86/hyperv/ivm.c b/arch/x86/hyperv/ivm.c
index 21042fa49088..651771534cae 100644
--- a/arch/x86/hyperv/ivm.c
+++ b/arch/x86/hyperv/ivm.c
@@ -477,6 +477,195 @@ void hv_ivm_msr_read(u64 msr, u64 *value)
 		hv_ghcb_msr_read(msr, value);
 }
 
+/*
+ * Keep track of the PFN regions which were shared with the host. The access
+ * must be revoked upon kexec/kdump (see hv_ivm_clear_host_access()).
+ */
+struct hv_enc_pfn_region {
+	struct list_head list;
+	u64 pfn;
+	int count;
+};
+
+static LIST_HEAD(hv_list_enc);
+static DEFINE_RAW_SPINLOCK(hv_list_enc_lock);
+
+static int hv_list_enc_add(const u64 *pfn_list, int count)
+{
+	struct hv_enc_pfn_region *ent;
+	unsigned long flags;
+	u64 pfn;
+	int i;
+
+	for (i = 0; i < count; i++) {
+		pfn = pfn_list[i];
+
+		raw_spin_lock_irqsave(&hv_list_enc_lock, flags);
+		/* Check if the PFN already exists in some region first */
+		list_for_each_entry(ent, &hv_list_enc, list) {
+			if ((ent->pfn <= pfn) && (ent->pfn + ent->count - 1 >= pfn))
+				/* Nothing to do - pfn is already in the list */
+				goto unlock_done;
+		}
+
+		/*
+		 * Check if the PFN is adjacent to an existing region. Growing
+		 * a region can make it adjacent to another one but merging is
+		 * not (yet) implemented for simplicity. A PFN cannot be added
+		 * to two regions to keep the logic in hv_list_enc_remove()
+		 * correct.
+		 */
+		list_for_each_entry(ent, &hv_list_enc, list) {
+			if (ent->pfn + ent->count == pfn) {
+				/* Grow existing region up */
+				ent->count++;
+				goto unlock_done;
+			} else if (pfn + 1 == ent->pfn) {
+				/* Grow existing region down */
+				ent->pfn--;
+				ent->count++;
+				goto unlock_done;
+			}
+		}
+		raw_spin_unlock_irqrestore(&hv_list_enc_lock, flags);
+
+		/* No adjacent region found -- create a new one */
+		ent = kzalloc(sizeof(struct hv_enc_pfn_region), GFP_KERNEL);
+		if (!ent)
+			return -ENOMEM;
+
+		ent->pfn = pfn;
+		ent->count = 1;
+
+		raw_spin_lock_irqsave(&hv_list_enc_lock, flags);
+		list_add(&ent->list, &hv_list_enc);
+
+unlock_done:
+		raw_spin_unlock_irqrestore(&hv_list_enc_lock, flags);
+	}
+
+	return 0;
+}
+
+static int hv_list_enc_remove(const u64 *pfn_list, int count)
+{
+	struct hv_enc_pfn_region *ent, *t;
+	struct hv_enc_pfn_region new_region;
+	unsigned long flags;
+	u64 pfn;
+	int i;
+
+	for (i = 0; i < count; i++) {
+		pfn = pfn_list[i];
+
+		raw_spin_lock_irqsave(&hv_list_enc_lock, flags);
+		list_for_each_entry_safe(ent, t, &hv_list_enc, list) {
+			if (pfn == ent->pfn + ent->count - 1) {
+				/* Removing tail pfn */
+				ent->count--;
+				if (!ent->count) {
+					list_del(&ent->list);
+					kfree(ent);
+				}
+				goto unlock_done;
+			} else if (pfn == ent->pfn) {
+				/* Removing head pfn */
+				ent->count--;
+				ent->pfn++;
+				if (!ent->count) {
+					list_del(&ent->list);
+					kfree(ent);
+				}
+				goto unlock_done;
+			} else if (pfn > ent->pfn && pfn < ent->pfn + ent->count - 1) {
+				/*
+				 * Removing a pfn in the middle. Cut off the tail
+				 * of the existing region and create a template for
+				 * the new one.
+				 */
+				new_region.pfn = pfn + 1;
+				new_region.count = ent->count - (pfn - ent->pfn + 1);
+				ent->count = pfn - ent->pfn;
+				goto unlock_split;
+			}
+
+		}
+unlock_done:
+		raw_spin_unlock_irqrestore(&hv_list_enc_lock, flags);
+		continue;
+
+unlock_split:
+		raw_spin_unlock_irqrestore(&hv_list_enc_lock, flags);
+
+		ent = kzalloc(sizeof(struct hv_enc_pfn_region), GFP_KERNEL);
+		if (!ent)
+			return -ENOMEM;
+
+		ent->pfn = new_region.pfn;
+		ent->count = new_region.count;
+
+		raw_spin_lock_irqsave(&hv_list_enc_lock, flags);
+		list_add(&ent->list, &hv_list_enc);
+		raw_spin_unlock_irqrestore(&hv_list_enc_lock, flags);
+	}
+
+	return 0;
+}
+
+/* Stop new private<->shared conversions */
+static void hv_vtom_kexec_begin(void)
+{
+	if (!IS_ENABLED(CONFIG_KEXEC_CORE))
+		return;
+
+	/*
+	 * Crash kernel reaches here with interrupts disabled: can't wait for
+	 * conversions to finish.
+	 *
+	 * If race happened, just report and proceed.
+	 */
+	if (!set_memory_enc_stop_conversion())
+		pr_warn("Failed to stop shared<->private conversions\n");
+}
+
+static void hv_vtom_kexec_finish(void)
+{
+	struct hv_gpa_range_for_visibility *input;
+	struct hv_enc_pfn_region *ent;
+	unsigned long flags;
+	u64 hv_status;
+	int cur, i;
+
+	local_irq_save(flags);
+	input = *this_cpu_ptr(hyperv_pcpu_input_arg);
+
+	if (unlikely(!input))
+		goto out;
+
+	list_for_each_entry(ent, &hv_list_enc, list) {
+		for (i = 0, cur = 0; i < ent->count; i++) {
+			input->gpa_page_list[cur] = ent->pfn + i;
+			cur++;
+
+			if (cur == HV_MAX_MODIFY_GPA_REP_COUNT || i == ent->count - 1) {
+				input->partition_id = HV_PARTITION_ID_SELF;
+				input->host_visibility = VMBUS_PAGE_NOT_VISIBLE;
+				input->reserved0 = 0;
+				input->reserved1 = 0;
+				hv_status = hv_do_rep_hypercall(
+					HVCALL_MODIFY_SPARSE_GPA_PAGE_HOST_VISIBILITY,
+					cur, 0, input, NULL);
+				WARN_ON_ONCE(!hv_result_success(hv_status));
+				cur = 0;
+			}
+		}
+
+	}
+
+out:
+	local_irq_restore(flags);
+}
+
 /*
  * hv_mark_gpa_visibility - Set pages visible to host via hvcall.
  *
@@ -490,6 +679,7 @@ static int hv_mark_gpa_visibility(u16 count, const u64 pfn[],
 	struct hv_gpa_range_for_visibility *input;
 	u64 hv_status;
 	unsigned long flags;
+	int ret;
 
 	/* no-op if partition isolation is not enabled */
 	if (!hv_is_isolation_supported())
@@ -501,6 +691,13 @@ static int hv_mark_gpa_visibility(u16 count, const u64 pfn[],
 		return -EINVAL;
 	}
 
+	if (visibility == VMBUS_PAGE_NOT_VISIBLE)
+		ret = hv_list_enc_remove(pfn, count);
+	else
+		ret = hv_list_enc_add(pfn, count);
+	if (ret)
+		return ret;
+
 	local_irq_save(flags);
 	input = *this_cpu_ptr(hyperv_pcpu_input_arg);
 
@@ -521,8 +718,18 @@ static int hv_mark_gpa_visibility(u16 count, const u64 pfn[],
 
 	if (hv_result_success(hv_status))
 		return 0;
+
+	if (visibility == VMBUS_PAGE_NOT_VISIBLE)
+		ret = hv_list_enc_add(pfn, count);
 	else
-		return -EFAULT;
+		ret = hv_list_enc_remove(pfn, count);
+	/*
+	 * There's no good way to recover from -ENOMEM here, the accounting is
+	 * wrong either way.
+	 */
+	WARN_ON_ONCE(ret);
+
+	return -EFAULT;
 }
 
 /*
@@ -684,6 +891,8 @@ void __init hv_vtom_init(void)
 	x86_platform.guest.enc_tlb_flush_required = hv_vtom_tlb_flush_required;
 	x86_platform.guest.enc_status_change_prepare = hv_vtom_clear_present;
 	x86_platform.guest.enc_status_change_finish = hv_vtom_set_host_visibility;
+	x86_platform.guest.enc_kexec_begin = hv_vtom_kexec_begin;
+	x86_platform.guest.enc_kexec_finish = hv_vtom_kexec_finish;
 
 	/* Set WB as the default cache mode. */
 	guest_force_mtrr_state(NULL, 0, MTRR_TYPE_WRBACK);
diff --git a/arch/x86/include/asm/bitops.h b/arch/x86/include/asm/bitops.h
index 33153dcd119c..c2ce213f2b9b 100644
--- a/arch/x86/include/asm/bitops.h
+++ b/arch/x86/include/asm/bitops.h
@@ -240,7 +240,7 @@ arch_test_bit_acquire(unsigned long nr, const volatile unsigned long *addr)
 					  variable_test_bit(nr, addr);
 }
 
-static __always_inline unsigned long variable__ffs(unsigned long word)
+static __always_inline __attribute_const__ unsigned long variable__ffs(unsigned long word)
 {
 	asm("tzcnt %1,%0"
 		: "=r" (word)
@@ -259,7 +259,7 @@ static __always_inline unsigned long variable__ffs(unsigned long word)
 	 (unsigned long)__builtin_ctzl(word) :	\
 	 variable__ffs(word))
 
-static __always_inline unsigned long variable_ffz(unsigned long word)
+static __always_inline __attribute_const__ unsigned long variable_ffz(unsigned long word)
 {
 	return variable__ffs(~word);
 }
@@ -281,7 +281,7 @@ static __always_inline unsigned long variable_ffz(unsigned long word)
  *
  * Undefined if no set bit exists, so code should check against 0 first.
  */
-static __always_inline unsigned long __fls(unsigned long word)
+static __always_inline __attribute_const__ unsigned long __fls(unsigned long word)
 {
 	if (__builtin_constant_p(word))
 		return BITS_PER_LONG - 1 - __builtin_clzl(word);
@@ -295,7 +295,7 @@ static __always_inline unsigned long __fls(unsigned long word)
 #undef ADDR
 
 #ifdef __KERNEL__
-static __always_inline int variable_ffs(int x)
+static __always_inline __attribute_const__ int variable_ffs(int x)
 {
 	int r;
 
@@ -349,7 +349,7 @@ static __always_inline int variable_ffs(int x)
  * set bit if value is nonzero. The last (most significant) bit is
  * at position 32.
  */
-static __always_inline int fls(unsigned int x)
+static __always_inline __attribute_const__ int fls(unsigned int x)
 {
 	int r;
 
@@ -394,7 +394,7 @@ static __always_inline int fls(unsigned int x)
  * at position 64.
  */
 #ifdef CONFIG_X86_64
-static __always_inline int fls64(__u64 x)
+static __always_inline __attribute_const__ int fls64(__u64 x)
 {
 	int bitpos = -1;
 
diff --git a/arch/x86/include/asm/cfi.h b/arch/x86/include/asm/cfi.h
index 3fcfdd996962..c40b9ebc1fb4 100644
--- a/arch/x86/include/asm/cfi.h
+++ b/arch/x86/include/asm/cfi.h
@@ -111,7 +111,7 @@ extern bhi_thunk __bhi_args_end[];
 
 struct pt_regs;
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 enum bug_trap_type handle_cfi_failure(struct pt_regs *regs);
 #define __bpfcall
 
@@ -155,7 +155,7 @@ static inline int cfi_get_func_arity(void *func)
 {
 	return 0;
 }
-#endif /* CONFIG_CFI_CLANG */
+#endif /* CONFIG_CFI */
 
 #if HAS_KERNEL_IBT == 1
 #define CFI_NOSEAL(x)	asm(IBT_NOSEAL(__stringify(x)))
diff --git a/arch/x86/include/asm/efi.h b/arch/x86/include/asm/efi.h
index f227a70ac91f..879c8402e024 100644
--- a/arch/x86/include/asm/efi.h
+++ b/arch/x86/include/asm/efi.h
@@ -140,7 +140,7 @@ extern void efi_delete_dummy_variable(void);
 extern void efi_crash_gracefully_on_page_fault(unsigned long phys_addr);
 extern void efi_free_boot_services(void);
 
-void arch_efi_call_virt_setup(void);
+bool arch_efi_call_virt_setup(void);
 void arch_efi_call_virt_teardown(void);
 
 extern u64 efi_setup;
diff --git a/arch/x86/kernel/Makefile b/arch/x86/kernel/Makefile
index 0d2a6d953be9..bc184dd38d99 100644
--- a/arch/x86/kernel/Makefile
+++ b/arch/x86/kernel/Makefile
@@ -148,7 +148,7 @@ obj-$(CONFIG_UNWINDER_ORC)		+= unwind_orc.o
 obj-$(CONFIG_UNWINDER_FRAME_POINTER)	+= unwind_frame.o
 obj-$(CONFIG_UNWINDER_GUESS)		+= unwind_guess.o
 
-obj-$(CONFIG_CFI_CLANG)			+= cfi.o
+obj-$(CONFIG_CFI)			+= cfi.o
 
 obj-$(CONFIG_CALL_THUNKS)		+= callthunks.o
 
diff --git a/arch/x86/kernel/alternative.c b/arch/x86/kernel/alternative.c
index 69fb818df2ee..8ee5ff547357 100644
--- a/arch/x86/kernel/alternative.c
+++ b/arch/x86/kernel/alternative.c
@@ -1180,7 +1180,7 @@ void __init_or_module apply_seal_endbr(s32 *start, s32 *end) { }
 
 #ifdef CONFIG_CFI_AUTO_DEFAULT
 # define __CFI_DEFAULT CFI_AUTO
-#elif defined(CONFIG_CFI_CLANG)
+#elif defined(CONFIG_CFI)
 # define __CFI_DEFAULT CFI_KCFI
 #else
 # define __CFI_DEFAULT CFI_OFF
@@ -1193,7 +1193,7 @@ static bool cfi_debug __ro_after_init;
 bool cfi_bhi __ro_after_init = false;
 #endif
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 u32 cfi_get_func_hash(void *func)
 {
 	u32 hash;
diff --git a/arch/x86/kernel/cpu/mshyperv.c b/arch/x86/kernel/cpu/mshyperv.c
index 3c71effe9ff5..c4febdbcfe4d 100644
--- a/arch/x86/kernel/cpu/mshyperv.c
+++ b/arch/x86/kernel/cpu/mshyperv.c
@@ -572,6 +572,11 @@ static void __init ms_hyperv_init_platform(void)
 	machine_ops.crash_shutdown = hv_machine_crash_shutdown;
 #endif
 #endif
+	/*
+	 * HV_ACCESS_TSC_INVARIANT is always zero for the root partition. Root
+	 * partition doesn't need to write to synthetic MSR to enable invariant
+	 * TSC feature. It sees what the hardware provides.
+	 */
 	if (ms_hyperv.features & HV_ACCESS_TSC_INVARIANT) {
 		/*
 		 * Writing to synthetic MSR 0x40000118 updates/changes the
@@ -643,8 +648,12 @@ static void __init ms_hyperv_init_platform(void)
 	 * TSC should be marked as unstable only after Hyper-V
 	 * clocksource has been initialized. This ensures that the
 	 * stability of the sched_clock is not altered.
+	 *
+	 * HV_ACCESS_TSC_INVARIANT is always zero for the root partition. No
+	 * need to check for it.
 	 */
-	if (!(ms_hyperv.features & HV_ACCESS_TSC_INVARIANT))
+	if (!hv_root_partition() &&
+	    !(ms_hyperv.features & HV_ACCESS_TSC_INVARIANT))
 		mark_tsc_unstable("running on Hyper-V");
 
 	hardlockup_detector_disable();
diff --git a/arch/x86/kernel/kprobes/core.c b/arch/x86/kernel/kprobes/core.c
index 6079d15dab8c..3863d7709386 100644
--- a/arch/x86/kernel/kprobes/core.c
+++ b/arch/x86/kernel/kprobes/core.c
@@ -339,7 +339,7 @@ static bool can_probe(unsigned long paddr)
 	if (is_exception_insn(&insn))
 		return false;
 
-	if (IS_ENABLED(CONFIG_CFI_CLANG)) {
+	if (IS_ENABLED(CONFIG_CFI)) {
 		/*
 		 * The compiler generates the following instruction sequence
 		 * for indirect call checks and cfi.c decodes this;
diff --git a/arch/x86/kvm/Kconfig b/arch/x86/kvm/Kconfig
index 4fcd1e538614..278f08194ec8 100644
--- a/arch/x86/kvm/Kconfig
+++ b/arch/x86/kvm/Kconfig
@@ -40,7 +40,7 @@ config KVM_X86
 	select HAVE_KVM_MSI
 	select HAVE_KVM_CPU_RELAX_INTERCEPT
 	select HAVE_KVM_NO_POLL
-	select KVM_XFER_TO_GUEST_WORK
+	select VIRT_XFER_TO_GUEST_WORK
 	select KVM_GENERIC_DIRTYLOG_READ_PROTECT
 	select KVM_VFIO
 	select HAVE_KVM_PM_NOTIFIER if PM
diff --git a/arch/x86/kvm/vmx/vmx.c b/arch/x86/kvm/vmx/vmx.c
index a2523fcd2375..f87c216d976d 100644
--- a/arch/x86/kvm/vmx/vmx.c
+++ b/arch/x86/kvm/vmx/vmx.c
@@ -28,7 +28,6 @@
 #include <linux/slab.h>
 #include <linux/tboot.h>
 #include <linux/trace_events.h>
-#include <linux/entry-kvm.h>
 
 #include <asm/apic.h>
 #include <asm/asm.h>
diff --git a/arch/x86/kvm/x86.c b/arch/x86/kvm/x86.c
index 4b8138bd4857..42ecd093bb4c 100644
--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@ -59,7 +59,6 @@
 #include <linux/sched/stat.h>
 #include <linux/sched/isolation.h>
 #include <linux/mem_encrypt.h>
-#include <linux/entry-kvm.h>
 #include <linux/suspend.h>
 #include <linux/smp.h>
 
@@ -11635,7 +11634,7 @@ static int vcpu_run(struct kvm_vcpu *vcpu)
 
 		if (__xfer_to_guest_mode_work_pending()) {
 			kvm_vcpu_srcu_read_unlock(vcpu);
-			r = xfer_to_guest_mode_handle_work(vcpu);
+			r = kvm_xfer_to_guest_mode_handle_work(vcpu);
 			kvm_vcpu_srcu_read_lock(vcpu);
 			if (r)
 				return r;
diff --git a/arch/x86/platform/efi/efi_32.c b/arch/x86/platform/efi/efi_32.c
index b2cc7b4552a1..215f16ce84ab 100644
--- a/arch/x86/platform/efi/efi_32.c
+++ b/arch/x86/platform/efi/efi_32.c
@@ -141,10 +141,11 @@ void __init efi_runtime_update_mappings(void)
 	}
 }
 
-void arch_efi_call_virt_setup(void)
+bool arch_efi_call_virt_setup(void)
 {
 	efi_fpu_begin();
 	firmware_restrict_branch_speculation_start();
+	return true;
 }
 
 void arch_efi_call_virt_teardown(void)
diff --git a/arch/x86/platform/efi/efi_64.c b/arch/x86/platform/efi/efi_64.c
index b4409df2105a..d4b1e70f41fa 100644
--- a/arch/x86/platform/efi/efi_64.c
+++ b/arch/x86/platform/efi/efi_64.c
@@ -443,12 +443,13 @@ static void efi_leave_mm(void)
 	unuse_temporary_mm(efi_prev_mm);
 }
 
-void arch_efi_call_virt_setup(void)
+bool arch_efi_call_virt_setup(void)
 {
 	efi_sync_low_kernel_mappings();
 	efi_fpu_begin();
 	firmware_restrict_branch_speculation_start();
 	efi_enter_mm();
+	return true;
 }
 
 void arch_efi_call_virt_teardown(void)
diff --git a/arch/x86/platform/uv/bios_uv.c b/arch/x86/platform/uv/bios_uv.c
index bf31af3d32d6..a442bbe5b1c2 100644
--- a/arch/x86/platform/uv/bios_uv.c
+++ b/arch/x86/platform/uv/bios_uv.c
@@ -32,7 +32,8 @@ static s64 __uv_bios_call(enum uv_bios_cmd which, u64 a1, u64 a2, u64 a3,
 		 */
 		return BIOS_STATUS_UNIMPLEMENTED;
 
-	ret = efi_call_virt_pointer(tab, function, (u64)which, a1, a2, a3, a4, a5);
+	ret = efi_call_virt_pointer(tab, function, BIOS_STATUS_UNIMPLEMENTED,
+				    (u64)which, a1, a2, a3, a4, a5);
 
 	return ret;
 }
diff --git a/arch/x86/purgatory/Makefile b/arch/x86/purgatory/Makefile
index e0a607a14e7e..5ce1d4263000 100644
--- a/arch/x86/purgatory/Makefile
+++ b/arch/x86/purgatory/Makefile
@@ -57,7 +57,7 @@ ifdef CONFIG_MITIGATION_RETPOLINE
 PURGATORY_CFLAGS_REMOVE		+= $(RETPOLINE_CFLAGS)
 endif
 
-ifdef CONFIG_CFI_CLANG
+ifdef CONFIG_CFI
 PURGATORY_CFLAGS_REMOVE		+= $(CC_FLAGS_CFI)
 endif
 
diff --git a/arch/xtensa/include/asm/bitops.h b/arch/xtensa/include/asm/bitops.h
index e02ec5833389..f7390b6761e1 100644
--- a/arch/xtensa/include/asm/bitops.h
+++ b/arch/xtensa/include/asm/bitops.h
@@ -37,7 +37,7 @@ static inline unsigned long __cntlz (unsigned long x)
  * bit 0 is the LSB of addr; bit 32 is the LSB of (addr+1).
  */
 
-static inline int ffz(unsigned long x)
+static inline int __attribute_const__ ffz(unsigned long x)
 {
 	return 31 - __cntlz(~x & -~x);
 }
@@ -46,7 +46,7 @@ static inline int ffz(unsigned long x)
  * __ffs: Find first bit set in word. Return 0 for bit 0
  */
 
-static inline unsigned long __ffs(unsigned long x)
+static inline __attribute_const__ unsigned long __ffs(unsigned long x)
 {
 	return 31 - __cntlz(x & -x);
 }
@@ -57,7 +57,7 @@ static inline unsigned long __ffs(unsigned long x)
  * differs in spirit from the above ffz (man ffs).
  */
 
-static inline int ffs(unsigned long x)
+static inline __attribute_const__ int ffs(unsigned long x)
 {
 	return 32 - __cntlz(x & -x);
 }
@@ -67,7 +67,7 @@ static inline int ffs(unsigned long x)
  * Note fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
 
-static inline int fls (unsigned int x)
+static inline __attribute_const__ int fls (unsigned int x)
 {
 	return 32 - __cntlz(x);
 }
@@ -78,7 +78,7 @@ static inline int fls (unsigned int x)
  *
  * Undefined if no set bit exists, so code should check against 0 first.
  */
-static inline unsigned long __fls(unsigned long word)
+static inline __attribute_const__ unsigned long __fls(unsigned long word)
 {
 	return 31 - __cntlz(word);
 }
diff --git a/drivers/acpi/numa/hmat.c b/drivers/acpi/numa/hmat.c
index 4958301f5417..5a36d57289b4 100644
--- a/drivers/acpi/numa/hmat.c
+++ b/drivers/acpi/numa/hmat.c
@@ -74,7 +74,6 @@ struct memory_target {
 	struct node_cache_attrs cache_attrs;
 	u8 gen_port_device_handle[ACPI_SRAT_DEVICE_HANDLE_SIZE];
 	bool registered;
-	bool ext_updated;	/* externally updated */
 };
 
 struct memory_initiator {
@@ -368,35 +367,6 @@ static void hmat_update_target_access(struct memory_target *target,
 	}
 }
 
-int hmat_update_target_coordinates(int nid, struct access_coordinate *coord,
-				   enum access_coordinate_class access)
-{
-	struct memory_target *target;
-	int pxm;
-
-	if (nid == NUMA_NO_NODE)
-		return -EINVAL;
-
-	pxm = node_to_pxm(nid);
-	guard(mutex)(&target_lock);
-	target = find_mem_target(pxm);
-	if (!target)
-		return -ENODEV;
-
-	hmat_update_target_access(target, ACPI_HMAT_READ_LATENCY,
-				  coord->read_latency, access);
-	hmat_update_target_access(target, ACPI_HMAT_WRITE_LATENCY,
-				  coord->write_latency, access);
-	hmat_update_target_access(target, ACPI_HMAT_READ_BANDWIDTH,
-				  coord->read_bandwidth, access);
-	hmat_update_target_access(target, ACPI_HMAT_WRITE_BANDWIDTH,
-				  coord->write_bandwidth, access);
-	target->ext_updated = true;
-
-	return 0;
-}
-EXPORT_SYMBOL_GPL(hmat_update_target_coordinates);
-
 static __init void hmat_add_locality(struct acpi_hmat_locality *hmat_loc)
 {
 	struct memory_locality *loc;
@@ -773,10 +743,6 @@ static void hmat_update_target_attrs(struct memory_target *target,
 	u32 best = 0;
 	int i;
 
-	/* Don't update if an external agent has changed the data.  */
-	if (target->ext_updated)
-		return;
-
 	/* Don't update for generic port if there's no device handle */
 	if ((access == NODE_ACCESS_CLASS_GENPORT_SINK_LOCAL ||
 	     access == NODE_ACCESS_CLASS_GENPORT_SINK_CPU) &&
diff --git a/drivers/base/node.c b/drivers/base/node.c
index 67b01d579737..3e2329ccb618 100644
--- a/drivers/base/node.c
+++ b/drivers/base/node.c
@@ -248,6 +248,44 @@ void node_set_perf_attrs(unsigned int nid, struct access_coordinate *coord,
 }
 EXPORT_SYMBOL_GPL(node_set_perf_attrs);
 
+/**
+ * node_update_perf_attrs - Update the performance values for given access class
+ * @nid: Node identifier to be updated
+ * @coord: Heterogeneous memory performance coordinates
+ * @access: The access class for the given attributes
+ */
+void node_update_perf_attrs(unsigned int nid, struct access_coordinate *coord,
+			    enum access_coordinate_class access)
+{
+	struct node_access_nodes *access_node;
+	struct node *node;
+	int i;
+
+	if (WARN_ON_ONCE(!node_online(nid)))
+		return;
+
+	node = node_devices[nid];
+	list_for_each_entry(access_node, &node->access_list, list_node) {
+		if (access_node->access != access)
+			continue;
+
+		access_node->coord = *coord;
+		for (i = 0; access_attrs[i]; i++) {
+			sysfs_notify(&access_node->dev.kobj,
+				     NULL, access_attrs[i]->name);
+		}
+		break;
+	}
+
+	/* When setting CPU access coordinates, update mempolicy */
+	if (access != ACCESS_COORDINATE_CPU)
+		return;
+
+	if (mempolicy_set_node_perf(nid, coord))
+		pr_info("failed to set mempolicy attrs for node %d\n", nid);
+}
+EXPORT_SYMBOL_GPL(node_update_perf_attrs);
+
 /**
  * struct node_cache_info - Internal tracking for memory node caches
  * @dev:	Device represeting the cache level
diff --git a/drivers/block/rnull.rs b/drivers/block/rnull.rs
new file mode 100644
index 000000000000..6366da12c5a5
--- /dev/null
+++ b/drivers/block/rnull.rs
@@ -0,0 +1,80 @@
+// SPDX-License-Identifier: GPL-2.0
+
+//! This is a Rust implementation of the C null block driver.
+//!
+//! Supported features:
+//!
+//! - blk-mq interface
+//! - direct completion
+//! - block size 4k
+//!
+//! The driver is not configurable.
+
+use kernel::{
+    alloc::flags,
+    block::mq::{
+        self,
+        gen_disk::{self, GenDisk},
+        Operations, TagSet,
+    },
+    error::Result,
+    new_mutex, pr_info,
+    prelude::*,
+    sync::{Arc, Mutex},
+    types::ARef,
+};
+
+module! {
+    type: NullBlkModule,
+    name: "rnull_mod",
+    authors: ["Andreas Hindborg"],
+    description: "Rust implementation of the C null block driver",
+    license: "GPL v2",
+}
+
+#[pin_data]
+struct NullBlkModule {
+    #[pin]
+    _disk: Mutex<GenDisk<NullBlkDevice>>,
+}
+
+impl kernel::InPlaceModule for NullBlkModule {
+    fn init(_module: &'static ThisModule) -> impl PinInit<Self, Error> {
+        pr_info!("Rust null_blk loaded\n");
+
+        // Use a immediately-called closure as a stable `try` block
+        let disk = /* try */ (|| {
+            let tagset = Arc::pin_init(TagSet::new(1, 256, 1), flags::GFP_KERNEL)?;
+
+            gen_disk::GenDiskBuilder::new()
+                .capacity_sectors(4096 << 11)
+                .logical_block_size(4096)?
+                .physical_block_size(4096)?
+                .rotational(false)
+                .build(fmt!("rnullb{}", 0), tagset)
+        })();
+
+        try_pin_init!(Self {
+            _disk <- new_mutex!(disk?, "nullb:disk"),
+        })
+    }
+}
+
+struct NullBlkDevice;
+
+#[vtable]
+impl Operations for NullBlkDevice {
+    #[inline(always)]
+    fn queue_rq(rq: ARef<mq::Request<Self>>, _is_last: bool) -> Result {
+        mq::Request::end_ok(rq)
+            .map_err(|_e| kernel::error::code::EIO)
+            // We take no refcounts on the request, so we expect to be able to
+            // end the request. The request reference must be unique at this
+            // point, and so `end_ok` cannot fail.
+            .expect("Fatal error - expected to be able to end request");
+
+        Ok(())
+    }
+
+    fn commit_rqs() {}
+}
diff --git a/drivers/char/random.c b/drivers/char/random.c
index b8b24b6ed3fe..d45383d57919 100644
--- a/drivers/char/random.c
+++ b/drivers/char/random.c
@@ -427,7 +427,7 @@ static void _get_random_bytes(void *buf, size_t len)
 
 /*
  * This returns random bytes in arbitrary quantities. The quality of the
- * random bytes is good as /dev/urandom. In order to ensure that the
+ * random bytes is as good as /dev/urandom. In order to ensure that the
  * randomness provided by this function is okay, the function
  * wait_for_random_bytes() should be called and return 0 at least once
  * at any point prior.
@@ -491,7 +491,7 @@ static ssize_t get_random_bytes_user(struct iov_iter *iter)
 
 /*
  * Batched entropy returns random integers. The quality of the random
- * number is good as /dev/urandom. In order to ensure that the randomness
+ * number is as good as /dev/urandom. In order to ensure that the randomness
  * provided by this function is okay, the function wait_for_random_bytes()
  * should be called and return 0 at least once at any point prior.
  */
@@ -1296,6 +1296,7 @@ static void __cold try_to_generate_entropy(void)
 	struct entropy_timer_state *stack = PTR_ALIGN((void *)stack_bytes, SMP_CACHE_BYTES);
 	unsigned int i, num_different = 0;
 	unsigned long last = random_get_entropy();
+	cpumask_var_t timer_cpus;
 	int cpu = -1;
 
 	for (i = 0; i < NUM_TRIAL_SAMPLES - 1; ++i) {
@@ -1310,13 +1311,15 @@ static void __cold try_to_generate_entropy(void)
 
 	atomic_set(&stack->samples, 0);
 	timer_setup_on_stack(&stack->timer, entropy_timer, 0);
+	if (!alloc_cpumask_var(&timer_cpus, GFP_KERNEL))
+		goto out;
+
 	while (!crng_ready() && !signal_pending(current)) {
 		/*
 		 * Check !timer_pending() and then ensure that any previous callback has finished
 		 * executing by checking timer_delete_sync_try(), before queueing the next one.
 		 */
 		if (!timer_pending(&stack->timer) && timer_delete_sync_try(&stack->timer) >= 0) {
-			struct cpumask timer_cpus;
 			unsigned int num_cpus;
 
 			/*
@@ -1326,19 +1329,19 @@ static void __cold try_to_generate_entropy(void)
 			preempt_disable();
 
 			/* Only schedule callbacks on timer CPUs that are online. */
-			cpumask_and(&timer_cpus, housekeeping_cpumask(HK_TYPE_TIMER), cpu_online_mask);
-			num_cpus = cpumask_weight(&timer_cpus);
+			cpumask_and(timer_cpus, housekeeping_cpumask(HK_TYPE_TIMER), cpu_online_mask);
+			num_cpus = cpumask_weight(timer_cpus);
 			/* In very bizarre case of misconfiguration, fallback to all online. */
 			if (unlikely(num_cpus == 0)) {
-				timer_cpus = *cpu_online_mask;
-				num_cpus = cpumask_weight(&timer_cpus);
+				*timer_cpus = *cpu_online_mask;
+				num_cpus = cpumask_weight(timer_cpus);
 			}
 
 			/* Basic CPU round-robin, which avoids the current CPU. */
 			do {
-				cpu = cpumask_next(cpu, &timer_cpus);
+				cpu = cpumask_next(cpu, timer_cpus);
 				if (cpu >= nr_cpu_ids)
-					cpu = cpumask_first(&timer_cpus);
+					cpu = cpumask_first(timer_cpus);
 			} while (cpu == smp_processor_id() && num_cpus > 1);
 
 			/* Expiring the timer at `jiffies` means it's the next tick. */
@@ -1354,6 +1357,8 @@ static void __cold try_to_generate_entropy(void)
 	}
 	mix_pool_bytes(&stack->entropy, sizeof(stack->entropy));
 
+	free_cpumask_var(timer_cpus);
+out:
 	timer_delete_sync(&stack->timer);
 	timer_destroy_on_stack(&stack->timer);
 }
diff --git a/drivers/clk/clk-sp7021.c b/drivers/clk/clk-sp7021.c
index 445e3da50e29..36528a71a2e6 100644
--- a/drivers/clk/clk-sp7021.c
+++ b/drivers/clk/clk-sp7021.c
@@ -7,6 +7,7 @@
 #include <linux/clk-provider.h>
 #include <linux/of.h>
 #include <linux/bitfield.h>
+#include <linux/hw_bitfield.h>
 #include <linux/slab.h>
 #include <linux/io.h>
 #include <linux/err.h>
@@ -38,13 +39,6 @@ enum {
 #define MASK_DIVN	GENMASK(7, 0)
 #define MASK_DIVM	GENMASK(14, 8)
 
-/* HIWORD_MASK FIELD_PREP */
-#define HWM_FIELD_PREP(mask, value)		\
-({						\
-	u64 _m = mask;				\
-	(_m << 16) | FIELD_PREP(_m, value);	\
-})
-
 struct sp_pll {
 	struct clk_hw hw;
 	void __iomem *reg;
@@ -313,15 +307,15 @@ static int plltv_set_rate(struct sp_pll *clk)
 	u32 r0, r1, r2;
 
 	r0  = BIT(clk->bp_bit + 16);
-	r0 |= HWM_FIELD_PREP(MASK_SEL_FRA, clk->p[SEL_FRA]);
-	r0 |= HWM_FIELD_PREP(MASK_SDM_MOD, clk->p[SDM_MOD]);
-	r0 |= HWM_FIELD_PREP(MASK_PH_SEL, clk->p[PH_SEL]);
-	r0 |= HWM_FIELD_PREP(MASK_NFRA, clk->p[NFRA]);
+	r0 |= FIELD_PREP_WM16(MASK_SEL_FRA, clk->p[SEL_FRA]);
+	r0 |= FIELD_PREP_WM16(MASK_SDM_MOD, clk->p[SDM_MOD]);
+	r0 |= FIELD_PREP_WM16(MASK_PH_SEL, clk->p[PH_SEL]);
+	r0 |= FIELD_PREP_WM16(MASK_NFRA, clk->p[NFRA]);
 
-	r1  = HWM_FIELD_PREP(MASK_DIVR, clk->p[DIVR]);
+	r1  = FIELD_PREP_WM16(MASK_DIVR, clk->p[DIVR]);
 
-	r2  = HWM_FIELD_PREP(MASK_DIVN, clk->p[DIVN] - 1);
-	r2 |= HWM_FIELD_PREP(MASK_DIVM, clk->p[DIVM] - 1);
+	r2  = FIELD_PREP_WM16(MASK_DIVN, clk->p[DIVN] - 1);
+	r2 |= FIELD_PREP_WM16(MASK_DIVM, clk->p[DIVM] - 1);
 
 	spin_lock_irqsave(&clk->lock, flags);
 	writel(r0, clk->reg);
diff --git a/drivers/clocksource/hyperv_timer.c b/drivers/clocksource/hyperv_timer.c
index 2edc13ca184e..10356d4ec55c 100644
--- a/drivers/clocksource/hyperv_timer.c
+++ b/drivers/clocksource/hyperv_timer.c
@@ -549,14 +549,22 @@ static void __init hv_init_tsc_clocksource(void)
 	union hv_reference_tsc_msr tsc_msr;
 
 	/*
+	 * When running as a guest partition:
+	 *
 	 * If Hyper-V offers TSC_INVARIANT, then the virtualized TSC correctly
 	 * handles frequency and offset changes due to live migration,
 	 * pause/resume, and other VM management operations.  So lower the
 	 * Hyper-V Reference TSC rating, causing the generic TSC to be used.
 	 * TSC_INVARIANT is not offered on ARM64, so the Hyper-V Reference
 	 * TSC will be preferred over the virtualized ARM64 arch counter.
+	 *
+	 * When running as the root partition:
+	 *
+	 * There is no HV_ACCESS_TSC_INVARIANT feature. Always lower the rating
+	 * of the Hyper-V Reference TSC.
 	 */
-	if (ms_hyperv.features & HV_ACCESS_TSC_INVARIANT) {
+	if ((ms_hyperv.features & HV_ACCESS_TSC_INVARIANT) ||
+	    hv_root_partition()) {
 		hyperv_cs_tsc.rating = 250;
 		hyperv_cs_msr.rating = 245;
 	}
diff --git a/drivers/cxl/acpi.c b/drivers/cxl/acpi.c
index 712624cba2b6..d7a5539d07d4 100644
--- a/drivers/cxl/acpi.c
+++ b/drivers/cxl/acpi.c
@@ -20,8 +20,7 @@ static const guid_t acpi_cxl_qtg_id_guid =
 	GUID_INIT(0xF365F9A6, 0xA7DE, 0x4071,
 		  0xA6, 0x6A, 0xB4, 0x0C, 0x0B, 0x4F, 0x8E, 0x52);
 
-
-static u64 cxl_xor_hpa_to_spa(struct cxl_root_decoder *cxlrd, u64 hpa)
+static u64 cxl_apply_xor_maps(struct cxl_root_decoder *cxlrd, u64 addr)
 {
 	struct cxl_cxims_data *cximsd = cxlrd->platform_data;
 	int hbiw = cxlrd->cxlsd.nr_targets;
@@ -30,19 +29,23 @@ static u64 cxl_xor_hpa_to_spa(struct cxl_root_decoder *cxlrd, u64 hpa)
 
 	/* No xormaps for host bridge interleave ways of 1 or 3 */
 	if (hbiw == 1 || hbiw == 3)
-		return hpa;
+		return addr;
 
 	/*
-	 * For root decoders using xormaps (hbiw: 2,4,6,8,12,16) restore
-	 * the position bit to its value before the xormap was applied at
-	 * HPA->DPA translation.
+	 * In regions using XOR interleave arithmetic the CXL HPA may not
+	 * be the same as the SPA. This helper performs the SPA->CXL HPA
+	 * or the CXL HPA->SPA translation. Since XOR is self-inverting,
+	 * so is this function.
+	 *
+	 * For root decoders using xormaps (hbiw: 2,4,6,8,12,16) applying the
+	 * xormaps will toggle a position bit.
 	 *
 	 * pos is the lowest set bit in an XORMAP
-	 * val is the XORALLBITS(HPA & XORMAP)
+	 * val is the XORALLBITS(addr & XORMAP)
 	 *
 	 * XORALLBITS: The CXL spec (3.1 Table 9-22) defines XORALLBITS
 	 * as an operation that outputs a single bit by XORing all the
-	 * bits in the input (hpa & xormap). Implement XORALLBITS using
+	 * bits in the input (addr & xormap). Implement XORALLBITS using
 	 * hweight64(). If the hamming weight is even the XOR of those
 	 * bits results in val==0, if odd the XOR result is val==1.
 	 */
@@ -51,11 +54,11 @@ static u64 cxl_xor_hpa_to_spa(struct cxl_root_decoder *cxlrd, u64 hpa)
 		if (!cximsd->xormaps[i])
 			continue;
 		pos = __ffs(cximsd->xormaps[i]);
-		val = (hweight64(hpa & cximsd->xormaps[i]) & 1);
-		hpa = (hpa & ~(1ULL << pos)) | (val << pos);
+		val = (hweight64(addr & cximsd->xormaps[i]) & 1);
+		addr = (addr & ~(1ULL << pos)) | (val << pos);
 	}
 
-	return hpa;
+	return addr;
 }
 
 struct cxl_cxims_context {
@@ -113,9 +116,9 @@ static unsigned long cfmws_to_decoder_flags(int restrictions)
 {
 	unsigned long flags = CXL_DECODER_F_ENABLE;
 
-	if (restrictions & ACPI_CEDT_CFMWS_RESTRICT_TYPE2)
+	if (restrictions & ACPI_CEDT_CFMWS_RESTRICT_DEVMEM)
 		flags |= CXL_DECODER_F_TYPE2;
-	if (restrictions & ACPI_CEDT_CFMWS_RESTRICT_TYPE3)
+	if (restrictions & ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM)
 		flags |= CXL_DECODER_F_TYPE3;
 	if (restrictions & ACPI_CEDT_CFMWS_RESTRICT_VOLATILE)
 		flags |= CXL_DECODER_F_RAM;
@@ -398,7 +401,6 @@ DEFINE_FREE(del_cxl_resource, struct resource *, if (_T) del_cxl_resource(_T))
 static int __cxl_parse_cfmws(struct acpi_cedt_cfmws *cfmws,
 			     struct cxl_cfmws_context *ctx)
 {
-	int target_map[CXL_DECODER_MAX_INTERLEAVE];
 	struct cxl_port *root_port = ctx->root_port;
 	struct cxl_cxims_context cxims_ctx;
 	struct device *dev = ctx->dev;
@@ -416,8 +418,6 @@ static int __cxl_parse_cfmws(struct acpi_cedt_cfmws *cfmws,
 	rc = eig_to_granularity(cfmws->granularity, &ig);
 	if (rc)
 		return rc;
-	for (i = 0; i < ways; i++)
-		target_map[i] = cfmws->interleave_targets[i];
 
 	struct resource *res __free(del_cxl_resource) = alloc_cxl_resource(
 		cfmws->base_hpa, cfmws->window_size, ctx->id++);
@@ -443,6 +443,8 @@ static int __cxl_parse_cfmws(struct acpi_cedt_cfmws *cfmws,
 		.end = cfmws->base_hpa + cfmws->window_size - 1,
 	};
 	cxld->interleave_ways = ways;
+	for (i = 0; i < ways; i++)
+		cxld->target_map[i] = cfmws->interleave_targets[i];
 	/*
 	 * Minimize the x1 granularity to advertise support for any
 	 * valid region granularity
@@ -472,10 +474,16 @@ static int __cxl_parse_cfmws(struct acpi_cedt_cfmws *cfmws,
 
 	cxlrd->qos_class = cfmws->qtg_id;
 
-	if (cfmws->interleave_arithmetic == ACPI_CEDT_CFMWS_ARITHMETIC_XOR)
-		cxlrd->hpa_to_spa = cxl_xor_hpa_to_spa;
+	if (cfmws->interleave_arithmetic == ACPI_CEDT_CFMWS_ARITHMETIC_XOR) {
+		cxlrd->ops = kzalloc(sizeof(*cxlrd->ops), GFP_KERNEL);
+		if (!cxlrd->ops)
+			return -ENOMEM;
+
+		cxlrd->ops->hpa_to_spa = cxl_apply_xor_maps;
+		cxlrd->ops->spa_to_hpa = cxl_apply_xor_maps;
+	}
 
-	rc = cxl_decoder_add(cxld, target_map);
+	rc = cxl_decoder_add(cxld);
 	if (rc)
 		return rc;
 
diff --git a/drivers/cxl/core/cdat.c b/drivers/cxl/core/cdat.c
index c0af645425f4..c4bd6e8a0cf0 100644
--- a/drivers/cxl/core/cdat.c
+++ b/drivers/cxl/core/cdat.c
@@ -338,7 +338,7 @@ static int match_cxlrd_hb(struct device *dev, void *data)
 
 	guard(rwsem_read)(&cxl_rwsem.region);
 	for (int i = 0; i < cxlsd->nr_targets; i++) {
-		if (host_bridge == cxlsd->target[i]->dport_dev)
+		if (cxlsd->target[i] && host_bridge == cxlsd->target[i]->dport_dev)
 			return 1;
 	}
 
@@ -440,8 +440,8 @@ static int cdat_sslbis_handler(union acpi_subtable_headers *header, void *arg,
 	} *tbl = (struct acpi_cdat_sslbis_table *)header;
 	int size = sizeof(header->cdat) + sizeof(tbl->sslbis_header);
 	struct acpi_cdat_sslbis *sslbis;
-	struct cxl_port *port = arg;
-	struct device *dev = &port->dev;
+	struct cxl_dport *dport = arg;
+	struct device *dev = &dport->port->dev;
 	int remain, entries, i;
 	u16 len;
 
@@ -467,8 +467,6 @@ static int cdat_sslbis_handler(union acpi_subtable_headers *header, void *arg,
 		u16 y = le16_to_cpu((__force __le16)tbl->entries[i].porty_id);
 		__le64 le_base;
 		__le16 le_val;
-		struct cxl_dport *dport;
-		unsigned long index;
 		u16 dsp_id;
 		u64 val;
 
@@ -499,28 +497,27 @@ static int cdat_sslbis_handler(union acpi_subtable_headers *header, void *arg,
 		val = cdat_normalize(le16_to_cpu(le_val), le64_to_cpu(le_base),
 				     sslbis->data_type);
 
-		xa_for_each(&port->dports, index, dport) {
-			if (dsp_id == ACPI_CDAT_SSLBIS_ANY_PORT ||
-			    dsp_id == dport->port_id) {
-				cxl_access_coordinate_set(dport->coord,
-							  sslbis->data_type,
-							  val);
-			}
+		if (dsp_id == ACPI_CDAT_SSLBIS_ANY_PORT ||
+		    dsp_id == dport->port_id) {
+			cxl_access_coordinate_set(dport->coord,
+						  sslbis->data_type, val);
+			return 0;
 		}
 	}
 
 	return 0;
 }
 
-void cxl_switch_parse_cdat(struct cxl_port *port)
+void cxl_switch_parse_cdat(struct cxl_dport *dport)
 {
+	struct cxl_port *port = dport->port;
 	int rc;
 
 	if (!port->cdat.table)
 		return;
 
 	rc = cdat_table_parse(ACPI_CDAT_TYPE_SSLBIS, cdat_sslbis_handler,
-			      port, port->cdat.table, port->cdat.length);
+			      dport, port->cdat.table, port->cdat.length);
 	rc = cdat_table_parse_output(rc);
 	if (rc)
 		dev_dbg(&port->dev, "Failed to parse SSLBIS: %d\n", rc);
@@ -1075,14 +1072,3 @@ void cxl_region_perf_data_calculate(struct cxl_region *cxlr,
 		cxlr->coord[i].write_bandwidth += perf->coord[i].write_bandwidth;
 	}
 }
-
-int cxl_update_hmat_access_coordinates(int nid, struct cxl_region *cxlr,
-				       enum access_coordinate_class access)
-{
-	return hmat_update_target_coordinates(nid, &cxlr->coord[access], access);
-}
-
-bool cxl_need_node_perf_attrs_update(int nid)
-{
-	return !acpi_node_backed_by_real_pxm(nid);
-}
diff --git a/drivers/cxl/core/core.h b/drivers/cxl/core/core.h
index 2669f251d677..1fb66132b777 100644
--- a/drivers/cxl/core/core.h
+++ b/drivers/cxl/core/core.h
@@ -135,11 +135,12 @@ enum cxl_poison_trace_type {
 	CXL_POISON_TRACE_CLEAR,
 };
 
+enum poison_cmd_enabled_bits;
+bool cxl_memdev_has_poison_cmd(struct cxl_memdev *cxlmd,
+			       enum poison_cmd_enabled_bits cmd);
+
 long cxl_pci_get_latency(struct pci_dev *pdev);
 int cxl_pci_get_bandwidth(struct pci_dev *pdev, struct access_coordinate *c);
-int cxl_update_hmat_access_coordinates(int nid, struct cxl_region *cxlr,
-				       enum access_coordinate_class access);
-bool cxl_need_node_perf_attrs_update(int nid);
 int cxl_port_get_switch_dport_bandwidth(struct cxl_port *port,
 					struct access_coordinate *c);
 
@@ -147,6 +148,11 @@ int cxl_ras_init(void);
 void cxl_ras_exit(void);
 int cxl_gpf_port_setup(struct cxl_dport *dport);
 
+struct cxl_hdm;
+int cxl_hdm_decode_init(struct cxl_dev_state *cxlds, struct cxl_hdm *cxlhdm,
+			struct cxl_endpoint_dvsec_info *info);
+int cxl_port_get_possible_dports(struct cxl_port *port);
+
 #ifdef CONFIG_CXL_FEATURES
 struct cxl_feat_entry *
 cxl_feature_info(struct cxl_features_state *cxlfs, const uuid_t *uuid);
diff --git a/drivers/cxl/core/hdm.c b/drivers/cxl/core/hdm.c
index e9e1d555cec6..d3a094ca01ad 100644
--- a/drivers/cxl/core/hdm.c
+++ b/drivers/cxl/core/hdm.c
@@ -21,12 +21,11 @@ struct cxl_rwsem cxl_rwsem = {
 	.dpa = __RWSEM_INITIALIZER(cxl_rwsem.dpa),
 };
 
-static int add_hdm_decoder(struct cxl_port *port, struct cxl_decoder *cxld,
-			   int *target_map)
+static int add_hdm_decoder(struct cxl_port *port, struct cxl_decoder *cxld)
 {
 	int rc;
 
-	rc = cxl_decoder_add_locked(cxld, target_map);
+	rc = cxl_decoder_add_locked(cxld);
 	if (rc) {
 		put_device(&cxld->dev);
 		dev_err(&port->dev, "Failed to add decoder\n");
@@ -50,12 +49,9 @@ static int add_hdm_decoder(struct cxl_port *port, struct cxl_decoder *cxld,
  * are claimed and passed to the single dport. Disable the range until the first
  * CXL region is enumerated / activated.
  */
-int devm_cxl_add_passthrough_decoder(struct cxl_port *port)
+static int devm_cxl_add_passthrough_decoder(struct cxl_port *port)
 {
 	struct cxl_switch_decoder *cxlsd;
-	struct cxl_dport *dport = NULL;
-	int single_port_map[1];
-	unsigned long index;
 	struct cxl_hdm *cxlhdm = dev_get_drvdata(&port->dev);
 
 	/*
@@ -71,13 +67,8 @@ int devm_cxl_add_passthrough_decoder(struct cxl_port *port)
 
 	device_lock_assert(&port->dev);
 
-	xa_for_each(&port->dports, index, dport)
-		break;
-	single_port_map[0] = dport->port_id;
-
-	return add_hdm_decoder(port, &cxlsd->cxld, single_port_map);
+	return add_hdm_decoder(port, &cxlsd->cxld);
 }
-EXPORT_SYMBOL_NS_GPL(devm_cxl_add_passthrough_decoder, "CXL");
 
 static void parse_hdm_decoder_caps(struct cxl_hdm *cxlhdm)
 {
@@ -147,8 +138,8 @@ static bool should_emulate_decoders(struct cxl_endpoint_dvsec_info *info)
  * @port: cxl_port to map
  * @info: cached DVSEC range register info
  */
-struct cxl_hdm *devm_cxl_setup_hdm(struct cxl_port *port,
-				   struct cxl_endpoint_dvsec_info *info)
+static struct cxl_hdm *devm_cxl_setup_hdm(struct cxl_port *port,
+					  struct cxl_endpoint_dvsec_info *info)
 {
 	struct cxl_register_map *reg_map = &port->reg_map;
 	struct device *dev = &port->dev;
@@ -197,13 +188,12 @@ struct cxl_hdm *devm_cxl_setup_hdm(struct cxl_port *port,
 	 */
 	if (should_emulate_decoders(info)) {
 		dev_dbg(dev, "Fallback map %d range register%s\n", info->ranges,
-			info->ranges > 1 ? "s" : "");
+			str_plural(info->ranges));
 		cxlhdm->decoder_count = info->ranges;
 	}
 
 	return cxlhdm;
 }
-EXPORT_SYMBOL_NS_GPL(devm_cxl_setup_hdm, "CXL");
 
 static void __cxl_dpa_debug(struct seq_file *file, struct resource *r, int depth)
 {
@@ -984,7 +974,7 @@ static int cxl_setup_hdm_decoder_from_dvsec(
 }
 
 static int init_hdm_decoder(struct cxl_port *port, struct cxl_decoder *cxld,
-			    int *target_map, void __iomem *hdm, int which,
+			    void __iomem *hdm, int which,
 			    u64 *dpa_base, struct cxl_endpoint_dvsec_info *info)
 {
 	struct cxl_endpoint_decoder *cxled = NULL;
@@ -1103,7 +1093,7 @@ static int init_hdm_decoder(struct cxl_port *port, struct cxl_decoder *cxld,
 		hi = readl(hdm + CXL_HDM_DECODER0_TL_HIGH(which));
 		target_list.value = (hi << 32) + lo;
 		for (i = 0; i < cxld->interleave_ways; i++)
-			target_map[i] = target_list.target_id[i];
+			cxld->target_map[i] = target_list.target_id[i];
 
 		return 0;
 	}
@@ -1168,8 +1158,8 @@ static void cxl_settle_decoders(struct cxl_hdm *cxlhdm)
  * @cxlhdm: Structure to populate with HDM capabilities
  * @info: cached DVSEC range register info
  */
-int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
-				struct cxl_endpoint_dvsec_info *info)
+static int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
+				       struct cxl_endpoint_dvsec_info *info)
 {
 	void __iomem *hdm = cxlhdm->regs.hdm_decoder;
 	struct cxl_port *port = cxlhdm->port;
@@ -1179,7 +1169,6 @@ int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 	cxl_settle_decoders(cxlhdm);
 
 	for (i = 0; i < cxlhdm->decoder_count; i++) {
-		int target_map[CXL_DECODER_MAX_INTERLEAVE] = { 0 };
 		int rc, target_count = cxlhdm->target_count;
 		struct cxl_decoder *cxld;
 
@@ -1207,8 +1196,7 @@ int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 			cxld = &cxlsd->cxld;
 		}
 
-		rc = init_hdm_decoder(port, cxld, target_map, hdm, i,
-				      &dpa_base, info);
+		rc = init_hdm_decoder(port, cxld, hdm, i, &dpa_base, info);
 		if (rc) {
 			dev_warn(&port->dev,
 				 "Failed to initialize decoder%d.%d\n",
@@ -1216,7 +1204,7 @@ int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 			put_device(&cxld->dev);
 			return rc;
 		}
-		rc = add_hdm_decoder(port, cxld, target_map);
+		rc = add_hdm_decoder(port, cxld);
 		if (rc) {
 			dev_warn(&port->dev,
 				 "Failed to add decoder%d.%d\n", port->id, i);
@@ -1226,4 +1214,71 @@ int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 
 	return 0;
 }
-EXPORT_SYMBOL_NS_GPL(devm_cxl_enumerate_decoders, "CXL");
+
+/**
+ * __devm_cxl_switch_port_decoders_setup - allocate and setup switch decoders
+ * @port: CXL port context
+ *
+ * Return 0 or -errno on error
+ */
+int __devm_cxl_switch_port_decoders_setup(struct cxl_port *port)
+{
+	struct cxl_hdm *cxlhdm;
+
+	if (is_cxl_root(port) || is_cxl_endpoint(port))
+		return -EOPNOTSUPP;
+
+	cxlhdm = devm_cxl_setup_hdm(port, NULL);
+	if (!IS_ERR(cxlhdm))
+		return devm_cxl_enumerate_decoders(cxlhdm, NULL);
+
+	if (PTR_ERR(cxlhdm) != -ENODEV) {
+		dev_err(&port->dev, "Failed to map HDM decoder capability\n");
+		return PTR_ERR(cxlhdm);
+	}
+
+	if (cxl_port_get_possible_dports(port) == 1) {
+		dev_dbg(&port->dev, "Fallback to passthrough decoder\n");
+		return devm_cxl_add_passthrough_decoder(port);
+	}
+
+	dev_err(&port->dev, "HDM decoder capability not found\n");
+	return -ENXIO;
+}
+EXPORT_SYMBOL_NS_GPL(__devm_cxl_switch_port_decoders_setup, "CXL");
+
+/**
+ * devm_cxl_endpoint_decoders_setup - allocate and setup endpoint decoders
+ * @port: CXL port context
+ *
+ * Return 0 or -errno on error
+ */
+int devm_cxl_endpoint_decoders_setup(struct cxl_port *port)
+{
+	struct cxl_memdev *cxlmd = to_cxl_memdev(port->uport_dev);
+	struct cxl_endpoint_dvsec_info info = { .port = port };
+	struct cxl_dev_state *cxlds = cxlmd->cxlds;
+	struct cxl_hdm *cxlhdm;
+	int rc;
+
+	if (!is_cxl_endpoint(port))
+		return -EOPNOTSUPP;
+
+	rc = cxl_dvsec_rr_decode(cxlds, &info);
+	if (rc < 0)
+		return rc;
+
+	cxlhdm = devm_cxl_setup_hdm(port, &info);
+	if (IS_ERR(cxlhdm)) {
+		if (PTR_ERR(cxlhdm) == -ENODEV)
+			dev_err(&port->dev, "HDM decoder registers not found\n");
+		return PTR_ERR(cxlhdm);
+	}
+
+	rc = cxl_hdm_decode_init(cxlds, cxlhdm, &info);
+	if (rc)
+		return rc;
+
+	return devm_cxl_enumerate_decoders(cxlhdm, &info);
+}
+EXPORT_SYMBOL_NS_GPL(devm_cxl_endpoint_decoders_setup, "CXL");
diff --git a/drivers/cxl/core/memdev.c b/drivers/cxl/core/memdev.c
index c569e00a511f..e370d733e440 100644
--- a/drivers/cxl/core/memdev.c
+++ b/drivers/cxl/core/memdev.c
@@ -200,6 +200,14 @@ static ssize_t security_erase_store(struct device *dev,
 static struct device_attribute dev_attr_security_erase =
 	__ATTR(erase, 0200, NULL, security_erase_store);
 
+bool cxl_memdev_has_poison_cmd(struct cxl_memdev *cxlmd,
+			       enum poison_cmd_enabled_bits cmd)
+{
+	struct cxl_memdev_state *mds = to_cxl_memdev_state(cxlmd->cxlds);
+
+	return test_bit(cmd, mds->poison.enabled_cmds);
+}
+
 static int cxl_get_poison_by_memdev(struct cxl_memdev *cxlmd)
 {
 	struct cxl_dev_state *cxlds = cxlmd->cxlds;
@@ -276,7 +284,7 @@ static int cxl_validate_poison_dpa(struct cxl_memdev *cxlmd, u64 dpa)
 	return 0;
 }
 
-int cxl_inject_poison(struct cxl_memdev *cxlmd, u64 dpa)
+int cxl_inject_poison_locked(struct cxl_memdev *cxlmd, u64 dpa)
 {
 	struct cxl_mailbox *cxl_mbox = &cxlmd->cxlds->cxl_mbox;
 	struct cxl_mbox_inject_poison inject;
@@ -288,13 +296,8 @@ int cxl_inject_poison(struct cxl_memdev *cxlmd, u64 dpa)
 	if (!IS_ENABLED(CONFIG_DEBUG_FS))
 		return 0;
 
-	ACQUIRE(rwsem_read_intr, region_rwsem)(&cxl_rwsem.region);
-	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &region_rwsem)))
-		return rc;
-
-	ACQUIRE(rwsem_read_intr, dpa_rwsem)(&cxl_rwsem.dpa);
-	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &dpa_rwsem)))
-		return rc;
+	lockdep_assert_held(&cxl_rwsem.dpa);
+	lockdep_assert_held(&cxl_rwsem.region);
 
 	rc = cxl_validate_poison_dpa(cxlmd, dpa);
 	if (rc)
@@ -324,9 +327,24 @@ int cxl_inject_poison(struct cxl_memdev *cxlmd, u64 dpa)
 
 	return 0;
 }
+
+int cxl_inject_poison(struct cxl_memdev *cxlmd, u64 dpa)
+{
+	int rc;
+
+	ACQUIRE(rwsem_read_intr, region_rwsem)(&cxl_rwsem.region);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &region_rwsem)))
+		return rc;
+
+	ACQUIRE(rwsem_read_intr, dpa_rwsem)(&cxl_rwsem.dpa);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &dpa_rwsem)))
+		return rc;
+
+	return cxl_inject_poison_locked(cxlmd, dpa);
+}
 EXPORT_SYMBOL_NS_GPL(cxl_inject_poison, "CXL");
 
-int cxl_clear_poison(struct cxl_memdev *cxlmd, u64 dpa)
+int cxl_clear_poison_locked(struct cxl_memdev *cxlmd, u64 dpa)
 {
 	struct cxl_mailbox *cxl_mbox = &cxlmd->cxlds->cxl_mbox;
 	struct cxl_mbox_clear_poison clear;
@@ -338,13 +356,8 @@ int cxl_clear_poison(struct cxl_memdev *cxlmd, u64 dpa)
 	if (!IS_ENABLED(CONFIG_DEBUG_FS))
 		return 0;
 
-	ACQUIRE(rwsem_read_intr, region_rwsem)(&cxl_rwsem.region);
-	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &region_rwsem)))
-		return rc;
-
-	ACQUIRE(rwsem_read_intr, dpa_rwsem)(&cxl_rwsem.dpa);
-	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &dpa_rwsem)))
-		return rc;
+	lockdep_assert_held(&cxl_rwsem.dpa);
+	lockdep_assert_held(&cxl_rwsem.region);
 
 	rc = cxl_validate_poison_dpa(cxlmd, dpa);
 	if (rc)
@@ -383,6 +396,21 @@ int cxl_clear_poison(struct cxl_memdev *cxlmd, u64 dpa)
 
 	return 0;
 }
+
+int cxl_clear_poison(struct cxl_memdev *cxlmd, u64 dpa)
+{
+	int rc;
+
+	ACQUIRE(rwsem_read_intr, region_rwsem)(&cxl_rwsem.region);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &region_rwsem)))
+		return rc;
+
+	ACQUIRE(rwsem_read_intr, dpa_rwsem)(&cxl_rwsem.dpa);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &dpa_rwsem)))
+		return rc;
+
+	return cxl_clear_poison_locked(cxlmd, dpa);
+}
 EXPORT_SYMBOL_NS_GPL(cxl_clear_poison, "CXL");
 
 static struct attribute *cxl_memdev_attributes[] = {
diff --git a/drivers/cxl/core/pci.c b/drivers/cxl/core/pci.c
index b50551601c2e..18825e1505d6 100644
--- a/drivers/cxl/core/pci.c
+++ b/drivers/cxl/core/pci.c
@@ -24,6 +24,53 @@ static unsigned short media_ready_timeout = 60;
 module_param(media_ready_timeout, ushort, 0644);
 MODULE_PARM_DESC(media_ready_timeout, "seconds to wait for media ready");
 
+static int pci_get_port_num(struct pci_dev *pdev)
+{
+	u32 lnkcap;
+	int type;
+
+	type = pci_pcie_type(pdev);
+	if (type != PCI_EXP_TYPE_DOWNSTREAM && type != PCI_EXP_TYPE_ROOT_PORT)
+		return -EINVAL;
+
+	if (pci_read_config_dword(pdev, pci_pcie_cap(pdev) + PCI_EXP_LNKCAP,
+				  &lnkcap))
+		return -ENXIO;
+
+	return FIELD_GET(PCI_EXP_LNKCAP_PN, lnkcap);
+}
+
+/**
+ * __devm_cxl_add_dport_by_dev - allocate a dport by dport device
+ * @port: cxl_port that hosts the dport
+ * @dport_dev: 'struct device' of the dport
+ *
+ * Returns the allocated dport on success or ERR_PTR() of -errno on error
+ */
+struct cxl_dport *__devm_cxl_add_dport_by_dev(struct cxl_port *port,
+					      struct device *dport_dev)
+{
+	struct cxl_register_map map;
+	struct pci_dev *pdev;
+	int port_num, rc;
+
+	if (!dev_is_pci(dport_dev))
+		return ERR_PTR(-EINVAL);
+
+	pdev = to_pci_dev(dport_dev);
+	port_num = pci_get_port_num(pdev);
+	if (port_num < 0)
+		return ERR_PTR(port_num);
+
+	rc = cxl_find_regblock(pdev, CXL_REGLOC_RBI_COMPONENT, &map);
+	if (rc)
+		return ERR_PTR(rc);
+
+	device_lock_assert(&port->dev);
+	return devm_cxl_add_dport(port, dport_dev, port_num, map.resource);
+}
+EXPORT_SYMBOL_NS_GPL(__devm_cxl_add_dport_by_dev, "CXL");
+
 struct cxl_walk_context {
 	struct pci_bus *bus;
 	struct cxl_port *port;
@@ -1169,3 +1216,45 @@ int cxl_gpf_port_setup(struct cxl_dport *dport)
 
 	return 0;
 }
+
+static int count_dports(struct pci_dev *pdev, void *data)
+{
+	struct cxl_walk_context *ctx = data;
+	int type = pci_pcie_type(pdev);
+
+	if (pdev->bus != ctx->bus)
+		return 0;
+	if (!pci_is_pcie(pdev))
+		return 0;
+	if (type != ctx->type)
+		return 0;
+
+	ctx->count++;
+	return 0;
+}
+
+int cxl_port_get_possible_dports(struct cxl_port *port)
+{
+	struct pci_bus *bus = cxl_port_to_pci_bus(port);
+	struct cxl_walk_context ctx;
+	int type;
+
+	if (!bus) {
+		dev_err(&port->dev, "No PCI bus found for port %s\n",
+			dev_name(&port->dev));
+		return -ENXIO;
+	}
+
+	if (pci_is_root_bus(bus))
+		type = PCI_EXP_TYPE_ROOT_PORT;
+	else
+		type = PCI_EXP_TYPE_DOWNSTREAM;
+
+	ctx = (struct cxl_walk_context) {
+		.bus = bus,
+		.type = type,
+	};
+	pci_walk_bus(bus, count_dports, &ctx);
+
+	return ctx.count;
+}
diff --git a/drivers/cxl/core/port.c b/drivers/cxl/core/port.c
index 29197376b18e..d5f71eb1ade8 100644
--- a/drivers/cxl/core/port.c
+++ b/drivers/cxl/core/port.c
@@ -33,6 +33,15 @@
 static DEFINE_IDA(cxl_port_ida);
 static DEFINE_XARRAY(cxl_root_buses);
 
+/*
+ * The terminal device in PCI is NULL and @platform_bus
+ * for platform devices (for cxl_test)
+ */
+static bool is_cxl_host_bridge(struct device *dev)
+{
+	return (!dev || dev == &platform_bus);
+}
+
 int cxl_num_decoders_committed(struct cxl_port *port)
 {
 	lockdep_assert_held(&cxl_rwsem.region);
@@ -450,6 +459,7 @@ static void cxl_root_decoder_release(struct device *dev)
 	if (atomic_read(&cxlrd->region_id) >= 0)
 		memregion_free(atomic_read(&cxlrd->region_id));
 	__cxl_decoder_release(&cxlrd->cxlsd.cxld);
+	kfree(cxlrd->ops);
 	kfree(cxlrd);
 }
 
@@ -740,6 +750,7 @@ static struct cxl_port *cxl_port_alloc(struct device *uport_dev,
 	xa_init(&port->dports);
 	xa_init(&port->endpoints);
 	xa_init(&port->regions);
+	port->component_reg_phys = CXL_RESOURCE_NONE;
 
 	device_initialize(dev);
 	lockdep_set_class_and_subclass(&dev->mutex, &cxl_port_key, port->depth);
@@ -858,9 +869,7 @@ static int cxl_port_add(struct cxl_port *port,
 		if (rc)
 			return rc;
 
-		rc = cxl_port_setup_regs(port, component_reg_phys);
-		if (rc)
-			return rc;
+		port->component_reg_phys = component_reg_phys;
 	} else {
 		rc = dev_set_name(dev, "root%d", port->id);
 		if (rc)
@@ -1191,6 +1200,18 @@ __devm_cxl_add_dport(struct cxl_port *port, struct device *dport_dev,
 
 	cxl_debugfs_create_dport_dir(dport);
 
+	/*
+	 * Setup port register if this is the first dport showed up. Having
+	 * a dport also means that there is at least 1 active link.
+	 */
+	if (port->nr_dports == 1 &&
+	    port->component_reg_phys != CXL_RESOURCE_NONE) {
+		rc = cxl_port_setup_regs(port, port->component_reg_phys);
+		if (rc)
+			return ERR_PTR(rc);
+		port->component_reg_phys = CXL_RESOURCE_NONE;
+	}
+
 	return dport;
 }
 
@@ -1348,21 +1369,6 @@ static struct cxl_port *find_cxl_port(struct device *dport_dev,
 	return port;
 }
 
-static struct cxl_port *find_cxl_port_at(struct cxl_port *parent_port,
-					 struct device *dport_dev,
-					 struct cxl_dport **dport)
-{
-	struct cxl_find_port_ctx ctx = {
-		.dport_dev = dport_dev,
-		.parent_port = parent_port,
-		.dport = dport,
-	};
-	struct cxl_port *port;
-
-	port = __find_cxl_port(&ctx);
-	return port;
-}
-
 /*
  * All users of grandparent() are using it to walk PCIe-like switch port
  * hierarchy. A PCIe switch is comprised of a bridge device representing the
@@ -1423,7 +1429,7 @@ EXPORT_SYMBOL_NS_GPL(cxl_endpoint_autoremove, "CXL");
  * through ->remove(). This "bottom-up" removal selectively removes individual
  * child ports manually. This depends on devm_cxl_add_port() to not change is
  * devm action registration order, and for dports to have already been
- * destroyed by reap_dports().
+ * destroyed by del_dports().
  */
 static void delete_switch_port(struct cxl_port *port)
 {
@@ -1432,18 +1438,24 @@ static void delete_switch_port(struct cxl_port *port)
 	devm_release_action(port->dev.parent, unregister_port, port);
 }
 
-static void reap_dports(struct cxl_port *port)
+static void del_dport(struct cxl_dport *dport)
+{
+	struct cxl_port *port = dport->port;
+
+	devm_release_action(&port->dev, cxl_dport_unlink, dport);
+	devm_release_action(&port->dev, cxl_dport_remove, dport);
+	devm_kfree(&port->dev, dport);
+}
+
+static void del_dports(struct cxl_port *port)
 {
 	struct cxl_dport *dport;
 	unsigned long index;
 
 	device_lock_assert(&port->dev);
 
-	xa_for_each(&port->dports, index, dport) {
-		devm_release_action(&port->dev, cxl_dport_unlink, dport);
-		devm_release_action(&port->dev, cxl_dport_remove, dport);
-		devm_kfree(&port->dev, dport);
-	}
+	xa_for_each(&port->dports, index, dport)
+		del_dport(dport);
 }
 
 struct detach_ctx {
@@ -1501,7 +1513,7 @@ static void cxl_detach_ep(void *data)
 			 */
 			died = true;
 			port->dead = true;
-			reap_dports(port);
+			del_dports(port);
 		}
 		device_unlock(&port->dev);
 
@@ -1532,16 +1544,157 @@ static resource_size_t find_component_registers(struct device *dev)
 	return map.resource;
 }
 
+static int match_port_by_uport(struct device *dev, const void *data)
+{
+	const struct device *uport_dev = data;
+	struct cxl_port *port;
+
+	if (!is_cxl_port(dev))
+		return 0;
+
+	port = to_cxl_port(dev);
+	return uport_dev == port->uport_dev;
+}
+
+/*
+ * Function takes a device reference on the port device. Caller should do a
+ * put_device() when done.
+ */
+static struct cxl_port *find_cxl_port_by_uport(struct device *uport_dev)
+{
+	struct device *dev;
+
+	dev = bus_find_device(&cxl_bus_type, NULL, uport_dev, match_port_by_uport);
+	if (dev)
+		return to_cxl_port(dev);
+	return NULL;
+}
+
+static int update_decoder_targets(struct device *dev, void *data)
+{
+	struct cxl_dport *dport = data;
+	struct cxl_switch_decoder *cxlsd;
+	struct cxl_decoder *cxld;
+	int i;
+
+	if (!is_switch_decoder(dev))
+		return 0;
+
+	cxlsd = to_cxl_switch_decoder(dev);
+	cxld = &cxlsd->cxld;
+	guard(rwsem_write)(&cxl_rwsem.region);
+
+	for (i = 0; i < cxld->interleave_ways; i++) {
+		if (cxld->target_map[i] == dport->port_id) {
+			cxlsd->target[i] = dport;
+			dev_dbg(dev, "dport%d found in target list, index %d\n",
+				dport->port_id, i);
+			return 1;
+		}
+	}
+
+	return 0;
+}
+
+DEFINE_FREE(del_cxl_dport, struct cxl_dport *, if (!IS_ERR_OR_NULL(_T)) del_dport(_T))
+static struct cxl_dport *cxl_port_add_dport(struct cxl_port *port,
+					    struct device *dport_dev)
+{
+	struct cxl_dport *dport;
+	int rc;
+
+	device_lock_assert(&port->dev);
+	if (!port->dev.driver)
+		return ERR_PTR(-ENXIO);
+
+	dport = cxl_find_dport_by_dev(port, dport_dev);
+	if (dport) {
+		dev_dbg(&port->dev, "dport%d:%s already exists\n",
+			dport->port_id, dev_name(dport_dev));
+		return ERR_PTR(-EBUSY);
+	}
+
+	struct cxl_dport *new_dport __free(del_cxl_dport) =
+		devm_cxl_add_dport_by_dev(port, dport_dev);
+	if (IS_ERR(new_dport))
+		return new_dport;
+
+	cxl_switch_parse_cdat(new_dport);
+
+	if (ida_is_empty(&port->decoder_ida)) {
+		rc = devm_cxl_switch_port_decoders_setup(port);
+		if (rc)
+			return ERR_PTR(rc);
+		dev_dbg(&port->dev, "first dport%d:%s added with decoders\n",
+			new_dport->port_id, dev_name(dport_dev));
+		return no_free_ptr(new_dport);
+	}
+
+	/* New dport added, update the decoder targets */
+	device_for_each_child(&port->dev, new_dport, update_decoder_targets);
+
+	dev_dbg(&port->dev, "dport%d:%s added\n", new_dport->port_id,
+		dev_name(dport_dev));
+
+	return no_free_ptr(new_dport);
+}
+
+static struct cxl_dport *devm_cxl_create_port(struct device *ep_dev,
+					      struct cxl_port *parent_port,
+					      struct cxl_dport *parent_dport,
+					      struct device *uport_dev,
+					      struct device *dport_dev)
+{
+	resource_size_t component_reg_phys;
+
+	device_lock_assert(&parent_port->dev);
+	if (!parent_port->dev.driver) {
+		dev_warn(ep_dev,
+			 "port %s:%s:%s disabled, failed to enumerate CXL.mem\n",
+			 dev_name(&parent_port->dev), dev_name(uport_dev),
+			 dev_name(dport_dev));
+	}
+
+	struct cxl_port *port __free(put_cxl_port) =
+		find_cxl_port_by_uport(uport_dev);
+	if (!port) {
+		component_reg_phys = find_component_registers(uport_dev);
+		port = devm_cxl_add_port(&parent_port->dev, uport_dev,
+					 component_reg_phys, parent_dport);
+		if (IS_ERR(port))
+			return ERR_CAST(port);
+
+		/*
+		 * retry to make sure a port is found. a port device
+		 * reference is taken.
+		 */
+		port = find_cxl_port_by_uport(uport_dev);
+		if (!port)
+			return ERR_PTR(-ENODEV);
+
+		dev_dbg(ep_dev, "created port %s:%s\n",
+			dev_name(&port->dev), dev_name(port->uport_dev));
+	} else {
+		/*
+		 * Port was created before right before this function is
+		 * called. Signal the caller to deal with it.
+		 */
+		return ERR_PTR(-EAGAIN);
+	}
+
+	guard(device)(&port->dev);
+	return cxl_port_add_dport(port, dport_dev);
+}
+
 static int add_port_attach_ep(struct cxl_memdev *cxlmd,
 			      struct device *uport_dev,
 			      struct device *dport_dev)
 {
 	struct device *dparent = grandparent(dport_dev);
 	struct cxl_dport *dport, *parent_dport;
-	resource_size_t component_reg_phys;
 	int rc;
 
-	if (!dparent) {
+	if (is_cxl_host_bridge(dparent)) {
 		/*
 		 * The iteration reached the topology root without finding the
 		 * CXL-root 'cxl_port' on a previous iteration, fail for now to
@@ -1553,42 +1706,31 @@ static int add_port_attach_ep(struct cxl_memdev *cxlmd,
 	}
 
 	struct cxl_port *parent_port __free(put_cxl_port) =
-		find_cxl_port(dparent, &parent_dport);
+		find_cxl_port_by_uport(dparent->parent);
 	if (!parent_port) {
 		/* iterate to create this parent_port */
 		return -EAGAIN;
 	}
 
-	/*
-	 * Definition with __free() here to keep the sequence of
-	 * dereferencing the device of the port before the parent_port releasing.
-	 */
-	struct cxl_port *port __free(put_cxl_port) = NULL;
 	scoped_guard(device, &parent_port->dev) {
-		if (!parent_port->dev.driver) {
-			dev_warn(&cxlmd->dev,
-				 "port %s:%s disabled, failed to enumerate CXL.mem\n",
-				 dev_name(&parent_port->dev), dev_name(uport_dev));
-			return -ENXIO;
+		parent_dport = cxl_find_dport_by_dev(parent_port, dparent);
+		if (!parent_dport) {
+			parent_dport = cxl_port_add_dport(parent_port, dparent);
+			if (IS_ERR(parent_dport))
+				return PTR_ERR(parent_dport);
 		}
 
-		port = find_cxl_port_at(parent_port, dport_dev, &dport);
-		if (!port) {
-			component_reg_phys = find_component_registers(uport_dev);
-			port = devm_cxl_add_port(&parent_port->dev, uport_dev,
-						 component_reg_phys, parent_dport);
-			if (IS_ERR(port))
-				return PTR_ERR(port);
-
-			/* retry find to pick up the new dport information */
-			port = find_cxl_port_at(parent_port, dport_dev, &dport);
-			if (!port)
-				return -ENXIO;
+		dport = devm_cxl_create_port(&cxlmd->dev, parent_port,
+					     parent_dport, uport_dev,
+					     dport_dev);
+		if (IS_ERR(dport)) {
+			/* Port already exists, restart iteration */
+			if (PTR_ERR(dport) == -EAGAIN)
+				return 0;
+			return PTR_ERR(dport);
 		}
 	}
 
-	dev_dbg(&cxlmd->dev, "add to new port %s:%s\n",
-		dev_name(&port->dev), dev_name(port->uport_dev));
 	rc = cxl_add_ep(dport, &cxlmd->dev);
 	if (rc == -EBUSY) {
 		/*
@@ -1601,6 +1743,25 @@ static int add_port_attach_ep(struct cxl_memdev *cxlmd,
 	return rc;
 }
 
+static struct cxl_dport *find_or_add_dport(struct cxl_port *port,
+					   struct device *dport_dev)
+{
+	struct cxl_dport *dport;
+
+	device_lock_assert(&port->dev);
+	dport = cxl_find_dport_by_dev(port, dport_dev);
+	if (!dport) {
+		dport = cxl_port_add_dport(port, dport_dev);
+		if (IS_ERR(dport))
+			return dport;
+
+		/* New dport added, restart iteration */
+		return ERR_PTR(-EAGAIN);
+	}
+
+	return dport;
+}
+
 int devm_cxl_enumerate_ports(struct cxl_memdev *cxlmd)
 {
 	struct device *dev = &cxlmd->dev;
@@ -1629,11 +1790,7 @@ int devm_cxl_enumerate_ports(struct cxl_memdev *cxlmd)
 		struct device *uport_dev;
 		struct cxl_dport *dport;
 
-		/*
-		 * The terminal "grandparent" in PCI is NULL and @platform_bus
-		 * for platform devices
-		 */
-		if (!dport_dev || dport_dev == &platform_bus)
+		if (is_cxl_host_bridge(dport_dev))
 			return 0;
 
 		uport_dev = dport_dev->parent;
@@ -1647,12 +1804,26 @@ int devm_cxl_enumerate_ports(struct cxl_memdev *cxlmd)
 			dev_name(iter), dev_name(dport_dev),
 			dev_name(uport_dev));
 		struct cxl_port *port __free(put_cxl_port) =
-			find_cxl_port(dport_dev, &dport);
+			find_cxl_port_by_uport(uport_dev);
 		if (port) {
 			dev_dbg(&cxlmd->dev,
 				"found already registered port %s:%s\n",
 				dev_name(&port->dev),
 				dev_name(port->uport_dev));
+
+			/*
+			 * RP port enumerated by cxl_acpi without dport will
+			 * have the dport added here.
+			 */
+			scoped_guard(device, &port->dev) {
+				dport = find_or_add_dport(port, dport_dev);
+				if (IS_ERR(dport)) {
+					if (PTR_ERR(dport) == -EAGAIN)
+						goto retry;
+					return PTR_ERR(dport);
+				}
+			}
+
 			rc = cxl_add_ep(dport, &cxlmd->dev);
 
 			/*
@@ -1704,24 +1875,24 @@ struct cxl_port *cxl_mem_find_port(struct cxl_memdev *cxlmd,
 EXPORT_SYMBOL_NS_GPL(cxl_mem_find_port, "CXL");
 
 static int decoder_populate_targets(struct cxl_switch_decoder *cxlsd,
-				    struct cxl_port *port, int *target_map)
+				    struct cxl_port *port)
 {
+	struct cxl_decoder *cxld = &cxlsd->cxld;
 	int i;
 
-	if (!target_map)
-		return 0;
-
 	device_lock_assert(&port->dev);
 
 	if (xa_empty(&port->dports))
-		return -EINVAL;
+		return 0;
 
 	guard(rwsem_write)(&cxl_rwsem.region);
 	for (i = 0; i < cxlsd->cxld.interleave_ways; i++) {
-		struct cxl_dport *dport = find_dport(port, target_map[i]);
+		struct cxl_dport *dport = find_dport(port, cxld->target_map[i]);
 
-		if (!dport)
-			return -ENXIO;
+		if (!dport) {
+			/* dport may be activated later */
+			continue;
+		}
 		cxlsd->target[i] = dport;
 	}
 
@@ -1910,9 +2081,6 @@ EXPORT_SYMBOL_NS_GPL(cxl_endpoint_decoder_alloc, "CXL");
 /**
  * cxl_decoder_add_locked - Add a decoder with targets
  * @cxld: The cxl decoder allocated by cxl_<type>_decoder_alloc()
- * @target_map: A list of downstream ports that this decoder can direct memory
- *              traffic to. These numbers should correspond with the port number
- *              in the PCIe Link Capabilities structure.
  *
  * Certain types of decoders may not have any targets. The main example of this
  * is an endpoint device. A more awkward example is a hostbridge whose root
@@ -1926,7 +2094,7 @@ EXPORT_SYMBOL_NS_GPL(cxl_endpoint_decoder_alloc, "CXL");
  * Return: Negative error code if the decoder wasn't properly configured; else
  *	   returns 0.
  */
-int cxl_decoder_add_locked(struct cxl_decoder *cxld, int *target_map)
+int cxl_decoder_add_locked(struct cxl_decoder *cxld)
 {
 	struct cxl_port *port;
 	struct device *dev;
@@ -1947,7 +2115,7 @@ int cxl_decoder_add_locked(struct cxl_decoder *cxld, int *target_map)
 	if (!is_endpoint_decoder(dev)) {
 		struct cxl_switch_decoder *cxlsd = to_cxl_switch_decoder(dev);
 
-		rc = decoder_populate_targets(cxlsd, port, target_map);
+		rc = decoder_populate_targets(cxlsd, port);
 		if (rc && (cxld->flags & CXL_DECODER_F_ENABLE)) {
 			dev_err(&port->dev,
 				"Failed to populate active decoder targets\n");
@@ -1966,9 +2134,6 @@ EXPORT_SYMBOL_NS_GPL(cxl_decoder_add_locked, "CXL");
 /**
  * cxl_decoder_add - Add a decoder with targets
  * @cxld: The cxl decoder allocated by cxl_<type>_decoder_alloc()
- * @target_map: A list of downstream ports that this decoder can direct memory
- *              traffic to. These numbers should correspond with the port number
- *              in the PCIe Link Capabilities structure.
  *
  * This is the unlocked variant of cxl_decoder_add_locked().
  * See cxl_decoder_add_locked().
@@ -1976,7 +2141,7 @@ EXPORT_SYMBOL_NS_GPL(cxl_decoder_add_locked, "CXL");
  * Context: Process context. Takes and releases the device lock of the port that
  *	    owns the @cxld.
  */
-int cxl_decoder_add(struct cxl_decoder *cxld, int *target_map)
+int cxl_decoder_add(struct cxl_decoder *cxld)
 {
 	struct cxl_port *port;
 
@@ -1989,7 +2154,7 @@ int cxl_decoder_add(struct cxl_decoder *cxld, int *target_map)
 	port = to_cxl_port(cxld->dev.parent);
 
 	guard(device)(&port->dev);
-	return cxl_decoder_add_locked(cxld, target_map);
+	return cxl_decoder_add_locked(cxld);
 }
 EXPORT_SYMBOL_NS_GPL(cxl_decoder_add, "CXL");
 
diff --git a/drivers/cxl/core/region.c b/drivers/cxl/core/region.c
index 71cc42d05248..e14c1d305b22 100644
--- a/drivers/cxl/core/region.c
+++ b/drivers/cxl/core/region.c
@@ -2,6 +2,7 @@
 /* Copyright(c) 2022 Intel Corporation. All rights reserved. */
 #include <linux/memregion.h>
 #include <linux/genalloc.h>
+#include <linux/debugfs.h>
 #include <linux/device.h>
 #include <linux/module.h>
 #include <linux/memory.h>
@@ -10,6 +11,7 @@
 #include <linux/sort.h>
 #include <linux/idr.h>
 #include <linux/memory-tiers.h>
+#include <linux/string_choices.h>
 #include <cxlmem.h>
 #include <cxl.h>
 #include "core.h"
@@ -30,6 +32,12 @@
  * 3. Decoder targets
  */
 
+/*
+ * nodemask that sets per node when the access_coordinates for the node has
+ * been updated by the CXL memory hotplug notifier.
+ */
+static nodemask_t nodemask_region_seen = NODE_MASK_NONE;
+
 static struct cxl_region *to_cxl_region(struct device *dev);
 
 #define __ACCESS_ATTR_RO(_level, _name) {				\
@@ -1468,9 +1476,7 @@ static int cxl_port_setup_targets(struct cxl_port *port,
 				dev_name(port->uport_dev), dev_name(&port->dev),
 				__func__, cxld->interleave_ways,
 				cxld->interleave_granularity,
-				(cxld->flags & CXL_DECODER_F_ENABLE) ?
-					"enabled" :
-					"disabled",
+				str_enabled_disabled(cxld->flags & CXL_DECODER_F_ENABLE),
 				cxld->hpa_range.start, cxld->hpa_range.end);
 			return -ENXIO;
 		}
@@ -1510,8 +1516,10 @@ static int cxl_port_setup_targets(struct cxl_port *port,
 				cxl_rr->nr_targets_set);
 			return -ENXIO;
 		}
-	} else
+	} else {
 		cxlsd->target[cxl_rr->nr_targets_set] = ep->dport;
+		cxlsd->cxld.target_map[cxl_rr->nr_targets_set] = ep->dport->port_id;
+	}
 	inc = 1;
 out_target_set:
 	cxl_rr->nr_targets_set += inc;
@@ -2442,14 +2450,8 @@ static bool cxl_region_update_coordinates(struct cxl_region *cxlr, int nid)
 
 	for (int i = 0; i < ACCESS_COORDINATE_MAX; i++) {
 		if (cxlr->coord[i].read_bandwidth) {
-			rc = 0;
-			if (cxl_need_node_perf_attrs_update(nid))
-				node_set_perf_attrs(nid, &cxlr->coord[i], i);
-			else
-				rc = cxl_update_hmat_access_coordinates(nid, cxlr, i);
-
-			if (rc == 0)
-				cset++;
+			node_update_perf_attrs(nid, &cxlr->coord[i], i);
+			cset++;
 		}
 	}
 
@@ -2487,6 +2489,10 @@ static int cxl_region_perf_attrs_callback(struct notifier_block *nb,
 	if (nid != region_nid)
 		return NOTIFY_DONE;
 
+	/* No action needed if node bit already set */
+	if (node_test_and_set(nid, nodemask_region_seen))
+		return NOTIFY_DONE;
+
 	if (!cxl_region_update_coordinates(cxlr, nid))
 		return NOTIFY_DONE;
 
@@ -2918,6 +2924,16 @@ static bool cxl_is_hpa_in_chunk(u64 hpa, struct cxl_region *cxlr, int pos)
 	return false;
 }
 
+static bool has_hpa_to_spa(struct cxl_root_decoder *cxlrd)
+{
+	return cxlrd->ops && cxlrd->ops->hpa_to_spa;
+}
+
+static bool has_spa_to_hpa(struct cxl_root_decoder *cxlrd)
+{
+	return cxlrd->ops && cxlrd->ops->spa_to_hpa;
+}
+
 u64 cxl_dpa_to_hpa(struct cxl_region *cxlr, const struct cxl_memdev *cxlmd,
 		   u64 dpa)
 {
@@ -2972,8 +2988,8 @@ u64 cxl_dpa_to_hpa(struct cxl_region *cxlr, const struct cxl_memdev *cxlmd,
 	hpa = hpa_offset + p->res->start + p->cache_size;
 
 	/* Root decoder translation overrides typical modulo decode */
-	if (cxlrd->hpa_to_spa)
-		hpa = cxlrd->hpa_to_spa(cxlrd, hpa);
+	if (has_hpa_to_spa(cxlrd))
+		hpa = cxlrd->ops->hpa_to_spa(cxlrd, hpa);
 
 	if (!cxl_resource_contains_addr(p->res, hpa)) {
 		dev_dbg(&cxlr->dev,
@@ -2982,12 +2998,107 @@ u64 cxl_dpa_to_hpa(struct cxl_region *cxlr, const struct cxl_memdev *cxlmd,
 	}
 
 	/* Simple chunk check, by pos & gran, only applies to modulo decodes */
-	if (!cxlrd->hpa_to_spa && (!cxl_is_hpa_in_chunk(hpa, cxlr, pos)))
+	if (!has_hpa_to_spa(cxlrd) && (!cxl_is_hpa_in_chunk(hpa, cxlr, pos)))
 		return ULLONG_MAX;
 
 	return hpa;
 }
 
+struct dpa_result {
+	struct cxl_memdev *cxlmd;
+	u64 dpa;
+};
+
+static int region_offset_to_dpa_result(struct cxl_region *cxlr, u64 offset,
+				       struct dpa_result *result)
+{
+	struct cxl_region_params *p = &cxlr->params;
+	struct cxl_root_decoder *cxlrd = to_cxl_root_decoder(cxlr->dev.parent);
+	struct cxl_endpoint_decoder *cxled;
+	u64 hpa, hpa_offset, dpa_offset;
+	u64 bits_upper, bits_lower;
+	u64 shifted, rem, temp;
+	u16 eig = 0;
+	u8 eiw = 0;
+	int pos;
+
+	lockdep_assert_held(&cxl_rwsem.region);
+	lockdep_assert_held(&cxl_rwsem.dpa);
+
+	/* Input validation ensures valid ways and gran */
+	granularity_to_eig(p->interleave_granularity, &eig);
+	ways_to_eiw(p->interleave_ways, &eiw);
+
+	/*
+	 * If the root decoder has SPA to CXL HPA callback, use it. Otherwise
+	 * CXL HPA is assumed to equal SPA.
+	 */
+	if (has_spa_to_hpa(cxlrd)) {
+		hpa = cxlrd->ops->spa_to_hpa(cxlrd, p->res->start + offset);
+		hpa_offset = hpa - p->res->start;
+	} else {
+		hpa_offset = offset;
+	}
+	/*
+	 * Interleave position: CXL Spec 3.2 Section 8.2.4.20.13
+	 * eiw < 8
+	 *	Position is in the IW bits at HPA_OFFSET[IG+8+IW-1:IG+8].
+	 *	Per spec "remove IW bits starting with bit position IG+8"
+	 * eiw >= 8
+	 *	Position is not explicitly stored in HPA_OFFSET bits. It is
+	 *	derived from the modulo operation of the upper bits using
+	 *	the total number of interleave ways.
+	 */
+	if (eiw < 8) {
+		pos = (hpa_offset >> (eig + 8)) & GENMASK(eiw - 1, 0);
+	} else {
+		shifted = hpa_offset >> (eig + 8);
+		div64_u64_rem(shifted, p->interleave_ways, &rem);
+		pos = rem;
+	}
+	if (pos < 0 || pos >= p->nr_targets) {
+		dev_dbg(&cxlr->dev, "Invalid position %d for %d targets\n",
+			pos, p->nr_targets);
+		return -ENXIO;
+	}
+
+	/*
+	 * DPA offset: CXL Spec 3.2 Section 8.2.4.20.13
+	 * Lower bits [IG+7:0] pass through unchanged
+	 * (eiw < 8)
+	 *	Per spec: DPAOffset[51:IG+8] = (HPAOffset[51:IG+IW+8] >> IW)
+	 *	Clear the position bits to isolate upper section, then
+	 *	reverse the left shift by eiw that occurred during DPA->HPA
+	 * (eiw >= 8)
+	 *	Per spec: DPAOffset[51:IG+8] = HPAOffset[51:IG+IW] / 3
+	 *	Extract upper bits from the correct bit range and divide by 3
+	 *	to recover the original DPA upper bits
+	 */
+	bits_lower = hpa_offset & GENMASK_ULL(eig + 7, 0);
+	if (eiw < 8) {
+		temp = hpa_offset &= ~((u64)GENMASK(eig + eiw + 8 - 1, 0));
+		dpa_offset = temp >> eiw;
+	} else {
+		bits_upper = div64_u64(hpa_offset >> (eig + eiw), 3);
+		dpa_offset = bits_upper << (eig + 8);
+	}
+	dpa_offset |= bits_lower;
+
+	/* Look-up and return the result: a memdev and a DPA */
+	for (int i = 0; i < p->nr_targets; i++) {
+		cxled = p->targets[i];
+		if (cxled->pos != pos)
+			continue;
+		result->cxlmd = cxled_to_memdev(cxled);
+		result->dpa = cxl_dpa_resource_start(cxled) + dpa_offset;
+
+		return 0;
+	}
+	dev_err(&cxlr->dev, "No device found for position %d\n", pos);
+
+	return -ENXIO;
+}
+
 static struct lock_class_key cxl_pmem_region_key;
 
 static int cxl_pmem_region_alloc(struct cxl_region *cxlr)
@@ -3542,6 +3653,105 @@ static void shutdown_notifiers(void *_cxlr)
 	unregister_mt_adistance_algorithm(&cxlr->adist_notifier);
 }
 
+static void remove_debugfs(void *dentry)
+{
+	debugfs_remove_recursive(dentry);
+}
+
+static int validate_region_offset(struct cxl_region *cxlr, u64 offset)
+{
+	struct cxl_region_params *p = &cxlr->params;
+	resource_size_t region_size;
+	u64 hpa;
+
+	if (offset < p->cache_size) {
+		dev_err(&cxlr->dev,
+			"Offset %#llx is within extended linear cache %pr\n",
+			offset, &p->cache_size);
+		return -EINVAL;
+	}
+
+	region_size = resource_size(p->res);
+	if (offset >= region_size) {
+		dev_err(&cxlr->dev, "Offset %#llx exceeds region size %pr\n",
+			offset, &region_size);
+		return -EINVAL;
+	}
+
+	hpa = p->res->start + offset;
+	if (hpa < p->res->start || hpa > p->res->end) {
+		dev_err(&cxlr->dev, "HPA %#llx not in region %pr\n", hpa,
+			p->res);
+		return -EINVAL;
+	}
+
+	return 0;
+}
+
+static int cxl_region_debugfs_poison_inject(void *data, u64 offset)
+{
+	struct dpa_result result = { .dpa = ULLONG_MAX, .cxlmd = NULL };
+	struct cxl_region *cxlr = data;
+	int rc;
+
+	ACQUIRE(rwsem_read_intr, region_rwsem)(&cxl_rwsem.region);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &region_rwsem)))
+		return rc;
+
+	ACQUIRE(rwsem_read_intr, dpa_rwsem)(&cxl_rwsem.dpa);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &dpa_rwsem)))
+		return rc;
+
+	if (validate_region_offset(cxlr, offset))
+		return -EINVAL;
+
+	rc = region_offset_to_dpa_result(cxlr, offset, &result);
+	if (rc || !result.cxlmd || result.dpa == ULLONG_MAX) {
+		dev_dbg(&cxlr->dev,
+			"Failed to resolve DPA for region offset %#llx rc %d\n",
+			offset, rc);
+
+		return rc ? rc : -EINVAL;
+	}
+
+	return cxl_inject_poison_locked(result.cxlmd, result.dpa);
+}
+
+DEFINE_DEBUGFS_ATTRIBUTE(cxl_poison_inject_fops, NULL,
+			 cxl_region_debugfs_poison_inject, "%llx\n");
+
+static int cxl_region_debugfs_poison_clear(void *data, u64 offset)
+{
+	struct dpa_result result = { .dpa = ULLONG_MAX, .cxlmd = NULL };
+	struct cxl_region *cxlr = data;
+	int rc;
+
+	ACQUIRE(rwsem_read_intr, region_rwsem)(&cxl_rwsem.region);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &region_rwsem)))
+		return rc;
+
+	ACQUIRE(rwsem_read_intr, dpa_rwsem)(&cxl_rwsem.dpa);
+	if ((rc = ACQUIRE_ERR(rwsem_read_intr, &dpa_rwsem)))
+		return rc;
+
+	if (validate_region_offset(cxlr, offset))
+		return -EINVAL;
+
+	rc = region_offset_to_dpa_result(cxlr, offset, &result);
+	if (rc || !result.cxlmd || result.dpa == ULLONG_MAX) {
+		dev_dbg(&cxlr->dev,
+			"Failed to resolve DPA for region offset %#llx rc %d\n",
+			offset, rc);
+
+		return rc ? rc : -EINVAL;
+	}
+
+	return cxl_clear_poison_locked(result.cxlmd, result.dpa);
+}
+
+DEFINE_DEBUGFS_ATTRIBUTE(cxl_poison_clear_fops, NULL,
+			 cxl_region_debugfs_poison_clear, "%llx\n");
+
 static int cxl_region_can_probe(struct cxl_region *cxlr)
 {
 	struct cxl_region_params *p = &cxlr->params;
@@ -3571,6 +3781,7 @@ static int cxl_region_probe(struct device *dev)
 {
 	struct cxl_region *cxlr = to_cxl_region(dev);
 	struct cxl_region_params *p = &cxlr->params;
+	bool poison_supported = true;
 	int rc;
 
 	rc = cxl_region_can_probe(cxlr);
@@ -3594,6 +3805,31 @@ static int cxl_region_probe(struct device *dev)
 	if (rc)
 		return rc;
 
+	/* Create poison attributes if all memdevs support the capabilities */
+	for (int i = 0; i < p->nr_targets; i++) {
+		struct cxl_endpoint_decoder *cxled = p->targets[i];
+		struct cxl_memdev *cxlmd = cxled_to_memdev(cxled);
+
+		if (!cxl_memdev_has_poison_cmd(cxlmd, CXL_POISON_ENABLED_INJECT) ||
+		    !cxl_memdev_has_poison_cmd(cxlmd, CXL_POISON_ENABLED_CLEAR)) {
+			poison_supported = false;
+			break;
+		}
+	}
+
+	if (poison_supported) {
+		struct dentry *dentry;
+
+		dentry = cxl_debugfs_create_dir(dev_name(dev));
+		debugfs_create_file("inject_poison", 0200, dentry, cxlr,
+				    &cxl_poison_inject_fops);
+		debugfs_create_file("clear_poison", 0200, dentry, cxlr,
+				    &cxl_poison_clear_fops);
+		rc = devm_add_action_or_reset(dev, remove_debugfs, dentry);
+		if (rc)
+			return rc;
+	}
+
 	switch (cxlr->mode) {
 	case CXL_PARTMODE_PMEM:
 		rc = devm_cxl_region_edac_register(cxlr);
diff --git a/drivers/cxl/cxl.h b/drivers/cxl/cxl.h
index 847e37be42c4..231ddccf8977 100644
--- a/drivers/cxl/cxl.h
+++ b/drivers/cxl/cxl.h
@@ -357,6 +357,9 @@ enum cxl_decoder_type {
  * @target_type: accelerator vs expander (type2 vs type3) selector
  * @region: currently assigned region for this decoder
  * @flags: memory type capabilities and locking
+ * @target_map: cached copy of hardware port-id list, available at init
+ *              before all @dport objects have been instantiated. While
+ *              dport id is 8bit, CFMWS interleave targets are 32bits.
  * @commit: device/decoder-type specific callback to commit settings to hw
  * @reset: device/decoder-type specific callback to reset hw settings
 */
@@ -369,6 +372,7 @@ struct cxl_decoder {
 	enum cxl_decoder_type target_type;
 	struct cxl_region *region;
 	unsigned long flags;
+	u32 target_map[CXL_DECODER_MAX_INTERLEAVE];
 	int (*commit)(struct cxl_decoder *cxld);
 	void (*reset)(struct cxl_decoder *cxld);
 };
@@ -419,27 +423,35 @@ struct cxl_switch_decoder {
 };
 
 struct cxl_root_decoder;
-typedef u64 (*cxl_hpa_to_spa_fn)(struct cxl_root_decoder *cxlrd, u64 hpa);
+/**
+ * struct cxl_rd_ops - CXL root decoder callback operations
+ * @hpa_to_spa: Convert host physical address to system physical address
+ * @spa_to_hpa: Convert system physical address to host physical address
+ */
+struct cxl_rd_ops {
+	u64 (*hpa_to_spa)(struct cxl_root_decoder *cxlrd, u64 hpa);
+	u64 (*spa_to_hpa)(struct cxl_root_decoder *cxlrd, u64 spa);
+};
 
 /**
  * struct cxl_root_decoder - Static platform CXL address decoder
  * @res: host / parent resource for region allocations
  * @cache_size: extended linear cache size if exists, otherwise zero.
  * @region_id: region id for next region provisioning event
- * @hpa_to_spa: translate CXL host-physical-address to Platform system-physical-address
  * @platform_data: platform specific configuration data
  * @range_lock: sync region autodiscovery by address range
  * @qos_class: QoS performance class cookie
+ * @ops: CXL root decoder operations
  * @cxlsd: base cxl switch decoder
  */
 struct cxl_root_decoder {
 	struct resource *res;
 	resource_size_t cache_size;
 	atomic_t region_id;
-	cxl_hpa_to_spa_fn hpa_to_spa;
 	void *platform_data;
 	struct mutex range_lock;
 	int qos_class;
+	struct cxl_rd_ops *ops;
 	struct cxl_switch_decoder cxlsd;
 };
 
@@ -595,6 +607,7 @@ struct cxl_dax_region {
  * @cdat: Cached CDAT data
  * @cdat_available: Should a CDAT attribute be available in sysfs
  * @pci_latency: Upstream latency in picoseconds
+ * @component_reg_phys: Physical address of component register
  */
 struct cxl_port {
 	struct device dev;
@@ -618,6 +631,7 @@ struct cxl_port {
 	} cdat;
 	bool cdat_available;
 	long pci_latency;
+	resource_size_t component_reg_phys;
 };
 
 /**
@@ -781,9 +795,9 @@ struct cxl_root_decoder *cxl_root_decoder_alloc(struct cxl_port *port,
 						unsigned int nr_targets);
 struct cxl_switch_decoder *cxl_switch_decoder_alloc(struct cxl_port *port,
 						    unsigned int nr_targets);
-int cxl_decoder_add(struct cxl_decoder *cxld, int *target_map);
+int cxl_decoder_add(struct cxl_decoder *cxld);
 struct cxl_endpoint_decoder *cxl_endpoint_decoder_alloc(struct cxl_port *port);
-int cxl_decoder_add_locked(struct cxl_decoder *cxld, int *target_map);
+int cxl_decoder_add_locked(struct cxl_decoder *cxld);
 int cxl_decoder_autoremove(struct device *host, struct cxl_decoder *cxld);
 static inline int cxl_root_decoder_autoremove(struct device *host,
 					      struct cxl_root_decoder *cxlrd)
@@ -806,12 +820,10 @@ struct cxl_endpoint_dvsec_info {
 	struct range dvsec_range[2];
 };
 
-struct cxl_hdm;
-struct cxl_hdm *devm_cxl_setup_hdm(struct cxl_port *port,
-				   struct cxl_endpoint_dvsec_info *info);
-int devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
-				struct cxl_endpoint_dvsec_info *info);
-int devm_cxl_add_passthrough_decoder(struct cxl_port *port);
+int devm_cxl_switch_port_decoders_setup(struct cxl_port *port);
+int __devm_cxl_switch_port_decoders_setup(struct cxl_port *port);
+int devm_cxl_endpoint_decoders_setup(struct cxl_port *port);
+
 struct cxl_dev_state;
 int cxl_dvsec_rr_decode(struct cxl_dev_state *cxlds,
 			struct cxl_endpoint_dvsec_info *info);
@@ -890,7 +902,7 @@ static inline u64 cxl_port_get_spa_cache_alias(struct cxl_port *endpoint,
 #endif
 
 void cxl_endpoint_parse_cdat(struct cxl_port *port);
-void cxl_switch_parse_cdat(struct cxl_port *port);
+void cxl_switch_parse_cdat(struct cxl_dport *dport);
 
 int cxl_endpoint_get_perf_coordinates(struct cxl_port *port,
 				      struct access_coordinate *coord);
@@ -905,6 +917,10 @@ void cxl_coordinates_combine(struct access_coordinate *out,
 			     struct access_coordinate *c2);
 
 bool cxl_endpoint_decoder_reset_detected(struct cxl_port *port);
+struct cxl_dport *devm_cxl_add_dport_by_dev(struct cxl_port *port,
+					    struct device *dport_dev);
+struct cxl_dport *__devm_cxl_add_dport_by_dev(struct cxl_port *port,
+					      struct device *dport_dev);
 
 /*
  * Unit test builds overrides this to __weak, find the 'strong' version
@@ -915,4 +931,21 @@ bool cxl_endpoint_decoder_reset_detected(struct cxl_port *port);
 #endif
 
 u16 cxl_gpf_get_dvsec(struct device *dev);
+
+/*
+ * Declaration for functions that are mocked by cxl_test that are called by
+ * cxl_core. The respective functions are defined as __foo() and called by
+ * cxl_core as foo(). The macros below ensures that those functions would
+ * exist as foo(). See tools/testing/cxl/cxl_core_exports.c and
+ * tools/testing/cxl/exports.h for setting up the mock functions. The dance
+ * is done to avoid a circular dependency where cxl_core calls a function that
+ * ends up being a mock function and goes to * cxl_test where it calls a
+ * cxl_core function.
+ */
+#ifndef CXL_TEST_ENABLE
+#define DECLARE_TESTABLE(x) __##x
+#define devm_cxl_add_dport_by_dev DECLARE_TESTABLE(devm_cxl_add_dport_by_dev)
+#define devm_cxl_switch_port_decoders_setup DECLARE_TESTABLE(devm_cxl_switch_port_decoders_setup)
+#endif
+
 #endif /* __CXL_H__ */
diff --git a/drivers/cxl/cxlmem.h b/drivers/cxl/cxlmem.h
index 751478dfc410..434031a0c1f7 100644
--- a/drivers/cxl/cxlmem.h
+++ b/drivers/cxl/cxlmem.h
@@ -869,6 +869,8 @@ int cxl_mem_get_poison(struct cxl_memdev *cxlmd, u64 offset, u64 len,
 int cxl_trigger_poison_list(struct cxl_memdev *cxlmd);
 int cxl_inject_poison(struct cxl_memdev *cxlmd, u64 dpa);
 int cxl_clear_poison(struct cxl_memdev *cxlmd, u64 dpa);
+int cxl_inject_poison_locked(struct cxl_memdev *cxlmd, u64 dpa);
+int cxl_clear_poison_locked(struct cxl_memdev *cxlmd, u64 dpa);
 
 #ifdef CONFIG_CXL_EDAC_MEM_FEATURES
 int devm_cxl_memdev_edac_register(struct cxl_memdev *cxlmd);
diff --git a/drivers/cxl/cxlpci.h b/drivers/cxl/cxlpci.h
index 54e219b0049e..7ae621e618e7 100644
--- a/drivers/cxl/cxlpci.h
+++ b/drivers/cxl/cxlpci.h
@@ -129,8 +129,6 @@ static inline bool cxl_pci_flit_256(struct pci_dev *pdev)
 
 int devm_cxl_port_enumerate_dports(struct cxl_port *port);
 struct cxl_dev_state;
-int cxl_hdm_decode_init(struct cxl_dev_state *cxlds, struct cxl_hdm *cxlhdm,
-			struct cxl_endpoint_dvsec_info *info);
 void read_cdat_data(struct cxl_port *port);
 void cxl_cor_error_detected(struct pci_dev *pdev);
 pci_ers_result_t cxl_error_detected(struct pci_dev *pdev,
diff --git a/drivers/cxl/port.c b/drivers/cxl/port.c
index cf32dc50b7a6..51c8f2f84717 100644
--- a/drivers/cxl/port.c
+++ b/drivers/cxl/port.c
@@ -59,55 +59,20 @@ static int discover_region(struct device *dev, void *unused)
 
 static int cxl_switch_port_probe(struct cxl_port *port)
 {
-	struct cxl_hdm *cxlhdm;
-	int rc;
+	/* Reset nr_dports for rebind of driver */
+	port->nr_dports = 0;
 
 	/* Cache the data early to ensure is_visible() works */
 	read_cdat_data(port);
 
-	rc = devm_cxl_port_enumerate_dports(port);
-	if (rc < 0)
-		return rc;
-
-	cxl_switch_parse_cdat(port);
-
-	cxlhdm = devm_cxl_setup_hdm(port, NULL);
-	if (!IS_ERR(cxlhdm))
-		return devm_cxl_enumerate_decoders(cxlhdm, NULL);
-
-	if (PTR_ERR(cxlhdm) != -ENODEV) {
-		dev_err(&port->dev, "Failed to map HDM decoder capability\n");
-		return PTR_ERR(cxlhdm);
-	}
-
-	if (rc == 1) {
-		dev_dbg(&port->dev, "Fallback to passthrough decoder\n");
-		return devm_cxl_add_passthrough_decoder(port);
-	}
-
-	dev_err(&port->dev, "HDM decoder capability not found\n");
-	return -ENXIO;
+	return 0;
 }
 
 static int cxl_endpoint_port_probe(struct cxl_port *port)
 {
-	struct cxl_endpoint_dvsec_info info = { .port = port };
 	struct cxl_memdev *cxlmd = to_cxl_memdev(port->uport_dev);
-	struct cxl_dev_state *cxlds = cxlmd->cxlds;
-	struct cxl_hdm *cxlhdm;
 	int rc;
 
-	rc = cxl_dvsec_rr_decode(cxlds, &info);
-	if (rc < 0)
-		return rc;
-
-	cxlhdm = devm_cxl_setup_hdm(port, &info);
-	if (IS_ERR(cxlhdm)) {
-		if (PTR_ERR(cxlhdm) == -ENODEV)
-			dev_err(&port->dev, "HDM decoder registers not found\n");
-		return PTR_ERR(cxlhdm);
-	}
-
 	/* Cache the data early to ensure is_visible() works */
 	read_cdat_data(port);
 	cxl_endpoint_parse_cdat(port);
@@ -117,11 +82,7 @@ static int cxl_endpoint_port_probe(struct cxl_port *port)
 	if (rc)
 		return rc;
 
-	rc = cxl_hdm_decode_init(cxlds, cxlhdm, &info);
-	if (rc)
-		return rc;
-
-	rc = devm_cxl_enumerate_decoders(cxlhdm, &info);
+	rc = devm_cxl_endpoint_decoders_setup(port);
 	if (rc)
 		return rc;
 
diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.c
index 1ce428e2ac8a..fc407d891348 100644
--- a/drivers/firmware/efi/efi.c
+++ b/drivers/firmware/efi/efi.c
@@ -74,6 +74,9 @@ struct mm_struct efi_mm = {
 	.page_table_lock	= __SPIN_LOCK_UNLOCKED(efi_mm.page_table_lock),
 	.mmlist			= LIST_HEAD_INIT(efi_mm.mmlist),
 	.cpu_bitmap		= { [BITS_TO_LONGS(NR_CPUS)] = 0},
+#ifdef CONFIG_SCHED_MM_CID
+	.cpus_allowed_lock	= __RAW_SPIN_LOCK_UNLOCKED(efi_mm.cpus_allowed_lock),
+#endif
 };
 
 struct workqueue_struct *efi_rts_wq;
diff --git a/drivers/firmware/efi/riscv-runtime.c b/drivers/firmware/efi/riscv-runtime.c
index fa71cd898120..07e04b8f982a 100644
--- a/drivers/firmware/efi/riscv-runtime.c
+++ b/drivers/firmware/efi/riscv-runtime.c
@@ -142,10 +142,11 @@ static void efi_virtmap_unload(void)
 	preempt_enable();
 }
 
-void arch_efi_call_virt_setup(void)
+bool arch_efi_call_virt_setup(void)
 {
 	sync_kernel_mappings(efi_mm.pgd);
 	efi_virtmap_load();
+	return true;
 }
 
 void arch_efi_call_virt_teardown(void)
diff --git a/drivers/firmware/efi/runtime-wrappers.c b/drivers/firmware/efi/runtime-wrappers.c
index 708b777857d3..82a27b414485 100644
--- a/drivers/firmware/efi/runtime-wrappers.c
+++ b/drivers/firmware/efi/runtime-wrappers.c
@@ -219,7 +219,10 @@ static void __nocfi efi_call_rts(struct work_struct *work)
 	efi_status_t status = EFI_NOT_FOUND;
 	unsigned long flags;
 
-	arch_efi_call_virt_setup();
+	if (!arch_efi_call_virt_setup()) {
+		status = EFI_NOT_READY;
+		goto out;
+	}
 	flags = efi_call_virt_save_flags();
 
 	switch (efi_rts_work.efi_rts_id) {
@@ -308,6 +311,7 @@ static void __nocfi efi_call_rts(struct work_struct *work)
 	efi_call_virt_check_flags(flags, efi_rts_work.caller);
 	arch_efi_call_virt_teardown();
 
+out:
 	efi_rts_work.status = status;
 	complete(&efi_rts_work.efi_rts_comp);
 }
@@ -444,8 +448,8 @@ virt_efi_set_variable_nb(efi_char16_t *name, efi_guid_t *vendor, u32 attr,
 	if (down_trylock(&efi_runtime_lock))
 		return EFI_NOT_READY;
 
-	status = efi_call_virt_pointer(efi.runtime, set_variable, name, vendor,
-				       attr, data_size, data);
+	status = efi_call_virt_pointer(efi.runtime, set_variable, EFI_NOT_READY,
+				       name, vendor, attr, data_size, data);
 	up(&efi_runtime_lock);
 	return status;
 }
@@ -481,9 +485,9 @@ virt_efi_query_variable_info_nb(u32 attr, u64 *storage_space,
 	if (down_trylock(&efi_runtime_lock))
 		return EFI_NOT_READY;
 
-	status = efi_call_virt_pointer(efi.runtime, query_variable_info, attr,
-				       storage_space, remaining_space,
-				       max_variable_size);
+	status = efi_call_virt_pointer(efi.runtime, query_variable_info,
+				       EFI_NOT_READY, attr, storage_space,
+				       remaining_space, max_variable_size);
 	up(&efi_runtime_lock);
 	return status;
 }
@@ -509,12 +513,14 @@ virt_efi_reset_system(int reset_type, efi_status_t status,
 		return;
 	}
 
-	arch_efi_call_virt_setup();
+	if (!arch_efi_call_virt_setup())
+		goto out;
 	efi_rts_work.efi_rts_id = EFI_RESET_SYSTEM;
 	arch_efi_call_virt(efi.runtime, reset_system, reset_type, status,
 			   data_size, data);
 	arch_efi_call_virt_teardown();
 
+out:
 	up(&efi_runtime_lock);
 }
 
diff --git a/drivers/fwctl/mlx5/main.c b/drivers/fwctl/mlx5/main.c
index 4b379f695eb7..3dacccf7855c 100644
--- a/drivers/fwctl/mlx5/main.c
+++ b/drivers/fwctl/mlx5/main.c
@@ -58,6 +58,9 @@ enum {
 	MLX5_CMD_OP_QUERY_DC_CNAK_TRACE = 0x716,
 	MLX5_CMD_OP_QUERY_NVMF_BACKEND_CONTROLLER = 0x722,
 	MLX5_CMD_OP_QUERY_NVMF_NAMESPACE_CONTEXT = 0x728,
+	MLX5_CMD_OP_QUERY_ADJACENT_FUNCTIONS_ID = 0x730,
+	MLX5_CMD_OP_DELEGATE_VHCA_MANAGEMENT = 0x731,
+	MLX5_CMD_OP_QUERY_DELEGATED_VHCA = 0x732,
 	MLX5_CMD_OP_QUERY_BURST_SIZE = 0x813,
 	MLX5_CMD_OP_QUERY_DIAGNOSTIC_PARAMS = 0x819,
 	MLX5_CMD_OP_SET_DIAGNOSTIC_PARAMS = 0x820,
@@ -188,6 +191,7 @@ static bool mlx5ctl_validate_rpc(const void *in, enum fwctl_rpc_scope scope)
 	 * filter commands manually for now.
 	 */
 	switch (opcode) {
+	case MLX5_CMD_OP_MODIFY_CONG_STATUS:
 	case MLX5_CMD_OP_POSTPONE_CONNECTED_QP_TIMEOUT:
 	case MLX5_CMD_OP_QUERY_ADAPTER:
 	case MLX5_CMD_OP_QUERY_ESW_FUNCTIONS:
@@ -196,6 +200,7 @@ static bool mlx5ctl_validate_rpc(const void *in, enum fwctl_rpc_scope scope)
 	case MLX5_CMD_OP_QUERY_OTHER_HCA_CAP:
 	case MLX5_CMD_OP_QUERY_ROCE_ADDRESS:
 	case MLX5_CMD_OPCODE_QUERY_VUID:
+	case MLX5_CMD_OP_DELEGATE_VHCA_MANAGEMENT:
 	/*
 	 * FW limits SET_HCA_CAP on the tools UID to only the other function
 	 * mode which is used for function pre-configuration
@@ -281,6 +286,8 @@ static bool mlx5ctl_validate_rpc(const void *in, enum fwctl_rpc_scope scope)
 	case MLX5_CMD_OP_QUERY_XRQ:
 	case MLX5_CMD_OP_USER_QUERY_XRQ_DC_PARAMS_ENTRY:
 	case MLX5_CMD_OP_USER_QUERY_XRQ_ERROR_PARAMS:
+	case MLX5_CMD_OP_QUERY_ADJACENT_FUNCTIONS_ID:
+	case MLX5_CMD_OP_QUERY_DELEGATED_VHCA:
 		return scope >= FWCTL_RPC_DEBUG_READ_ONLY;
 
 	case MLX5_CMD_OP_SET_DIAGNOSTIC_PARAMS:
diff --git a/drivers/fwctl/pds/main.c b/drivers/fwctl/pds/main.c
index 8dd659aee256..1809853f6353 100644
--- a/drivers/fwctl/pds/main.c
+++ b/drivers/fwctl/pds/main.c
@@ -6,6 +6,7 @@
 #include <linux/pci.h>
 #include <linux/vmalloc.h>
 #include <linux/bitfield.h>
+#include <linux/string.h>
 
 #include <uapi/fwctl/fwctl.h>
 #include <uapi/fwctl/pds.h>
@@ -366,18 +367,10 @@ static void *pdsfc_fw_rpc(struct fwctl_uctx *uctx, enum fwctl_rpc_scope scope,
 		return ERR_PTR(err);
 
 	if (rpc->in.len > 0) {
-		in_payload = kzalloc(rpc->in.len, GFP_KERNEL);
-		if (!in_payload) {
-			dev_err(dev, "Failed to allocate in_payload\n");
-			err = -ENOMEM;
-			goto err_out;
-		}
-
-		if (copy_from_user(in_payload, u64_to_user_ptr(rpc->in.payload),
-				   rpc->in.len)) {
+		in_payload = memdup_user(u64_to_user_ptr(rpc->in.payload), rpc->in.len);
+		if (IS_ERR(in_payload)) {
 			dev_dbg(dev, "Failed to copy in_payload from user\n");
-			err = -EFAULT;
-			goto err_in_payload;
+			return in_payload;
 		}
 
 		in_payload_dma_addr = dma_map_single(dev->parent, in_payload,
@@ -453,7 +446,6 @@ static void *pdsfc_fw_rpc(struct fwctl_uctx *uctx, enum fwctl_rpc_scope scope,
 				 rpc->in.len, DMA_TO_DEVICE);
 err_in_payload:
 	kfree(in_payload);
-err_out:
 	if (err)
 		return ERR_PTR(err);
 
diff --git a/drivers/gpu/drm/drm_panic_qr.rs b/drivers/gpu/drm/drm_panic_qr.rs
index 50c286c5cee8..ac27e86c601c 100644
--- a/drivers/gpu/drm/drm_panic_qr.rs
+++ b/drivers/gpu/drm/drm_panic_qr.rs
@@ -968,7 +968,7 @@ fn draw_all(&mut self, data: impl Iterator<Item = u8>) {
         // nul-terminated string.
         let url_cstr: &CStr = unsafe { CStr::from_char_ptr(url) };
         let segments = &[
-            &Segment::Binary(url_cstr.as_bytes()),
+            &Segment::Binary(url_cstr.to_bytes()),
             &Segment::Numeric(&data_slice[0..data_len]),
         ];
         match EncodedMsg::new(segments, tmp_slice) {
diff --git a/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c b/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c
index 3398160ad75e..5523911b990d 100644
--- a/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c
+++ b/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c
@@ -7,6 +7,7 @@
  */
 
 #include <linux/clk.h>
+#include <linux/hw_bitfield.h>
 #include <linux/iopoll.h>
 #include <linux/math64.h>
 #include <linux/mfd/syscon.h>
@@ -148,7 +149,7 @@
 #define DW_MIPI_NEEDS_GRF_CLK		BIT(1)
 
 #define PX30_GRF_PD_VO_CON1		0x0438
-#define PX30_DSI_FORCETXSTOPMODE	(0xf << 7)
+#define PX30_DSI_FORCETXSTOPMODE	(0xfUL << 7)
 #define PX30_DSI_FORCERXMODE		BIT(6)
 #define PX30_DSI_TURNDISABLE		BIT(5)
 #define PX30_DSI_LCDC_SEL		BIT(0)
@@ -167,16 +168,16 @@
 #define RK3399_DSI1_LCDC_SEL		BIT(4)
 
 #define RK3399_GRF_SOC_CON22		0x6258
-#define RK3399_DSI0_TURNREQUEST		(0xf << 12)
-#define RK3399_DSI0_TURNDISABLE		(0xf << 8)
-#define RK3399_DSI0_FORCETXSTOPMODE	(0xf << 4)
-#define RK3399_DSI0_FORCERXMODE		(0xf << 0)
+#define RK3399_DSI0_TURNREQUEST		(0xfUL << 12)
+#define RK3399_DSI0_TURNDISABLE		(0xfUL << 8)
+#define RK3399_DSI0_FORCETXSTOPMODE	(0xfUL << 4)
+#define RK3399_DSI0_FORCERXMODE		(0xfUL << 0)
 
 #define RK3399_GRF_SOC_CON23		0x625c
-#define RK3399_DSI1_TURNDISABLE		(0xf << 12)
-#define RK3399_DSI1_FORCETXSTOPMODE	(0xf << 8)
-#define RK3399_DSI1_FORCERXMODE		(0xf << 4)
-#define RK3399_DSI1_ENABLE		(0xf << 0)
+#define RK3399_DSI1_TURNDISABLE		(0xfUL << 12)
+#define RK3399_DSI1_FORCETXSTOPMODE	(0xfUL << 8)
+#define RK3399_DSI1_FORCERXMODE		(0xfUL << 4)
+#define RK3399_DSI1_ENABLE		(0xfUL << 0)
 
 #define RK3399_GRF_SOC_CON24		0x6260
 #define RK3399_TXRX_MASTERSLAVEZ	BIT(7)
@@ -186,8 +187,8 @@
 #define RK3399_TXRX_TURNREQUEST		GENMASK(3, 0)
 
 #define RK3568_GRF_VO_CON2		0x0368
-#define RK3568_DSI0_SKEWCALHS		(0x1f << 11)
-#define RK3568_DSI0_FORCETXSTOPMODE	(0xf << 4)
+#define RK3568_DSI0_SKEWCALHS		(0x1fUL << 11)
+#define RK3568_DSI0_FORCETXSTOPMODE	(0xfUL << 4)
 #define RK3568_DSI0_TURNDISABLE		BIT(2)
 #define RK3568_DSI0_FORCERXMODE		BIT(0)
 
@@ -197,18 +198,16 @@
  * come from. Name GRF_VO_CON3 is assumed.
  */
 #define RK3568_GRF_VO_CON3		0x36c
-#define RK3568_DSI1_SKEWCALHS		(0x1f << 11)
-#define RK3568_DSI1_FORCETXSTOPMODE	(0xf << 4)
+#define RK3568_DSI1_SKEWCALHS		(0x1fUL << 11)
+#define RK3568_DSI1_FORCETXSTOPMODE	(0xfUL << 4)
 #define RK3568_DSI1_TURNDISABLE		BIT(2)
 #define RK3568_DSI1_FORCERXMODE		BIT(0)
 
 #define RV1126_GRF_DSIPHY_CON		0x10220
-#define RV1126_DSI_FORCETXSTOPMODE	(0xf << 4)
+#define RV1126_DSI_FORCETXSTOPMODE	(0xfUL << 4)
 #define RV1126_DSI_TURNDISABLE		BIT(2)
 #define RV1126_DSI_FORCERXMODE		BIT(0)
 
-#define HIWORD_UPDATE(val, mask)	(val | (mask) << 16)
-
 enum {
 	DW_DSI_USAGE_IDLE,
 	DW_DSI_USAGE_DSI,
@@ -1484,14 +1483,13 @@ static const struct rockchip_dw_dsi_chip_data px30_chip_data[] = {
 	{
 		.reg = 0xff450000,
 		.lcdsel_grf_reg = PX30_GRF_PD_VO_CON1,
-		.lcdsel_big = HIWORD_UPDATE(0, PX30_DSI_LCDC_SEL),
-		.lcdsel_lit = HIWORD_UPDATE(PX30_DSI_LCDC_SEL,
-					    PX30_DSI_LCDC_SEL),
+		.lcdsel_big = FIELD_PREP_WM16_CONST(PX30_DSI_LCDC_SEL, 0),
+		.lcdsel_lit = FIELD_PREP_WM16_CONST(PX30_DSI_LCDC_SEL, 1),
 
 		.lanecfg1_grf_reg = PX30_GRF_PD_VO_CON1,
-		.lanecfg1 = HIWORD_UPDATE(0, PX30_DSI_TURNDISABLE |
-					     PX30_DSI_FORCERXMODE |
-					     PX30_DSI_FORCETXSTOPMODE),
+		.lanecfg1 = FIELD_PREP_WM16_CONST((PX30_DSI_TURNDISABLE |
+						PX30_DSI_FORCERXMODE |
+						PX30_DSI_FORCETXSTOPMODE), 0),
 
 		.max_data_lanes = 4,
 	},
@@ -1502,9 +1500,9 @@ static const struct rockchip_dw_dsi_chip_data rk3128_chip_data[] = {
 	{
 		.reg = 0x10110000,
 		.lanecfg1_grf_reg = RK3128_GRF_LVDS_CON0,
-		.lanecfg1 = HIWORD_UPDATE(0, RK3128_DSI_TURNDISABLE |
-					     RK3128_DSI_FORCERXMODE |
-					     RK3128_DSI_FORCETXSTOPMODE),
+		.lanecfg1 = FIELD_PREP_WM16_CONST((RK3128_DSI_TURNDISABLE |
+						RK3128_DSI_FORCERXMODE |
+						RK3128_DSI_FORCETXSTOPMODE), 0),
 		.max_data_lanes = 4,
 	},
 	{ /* sentinel */ }
@@ -1514,16 +1512,16 @@ static const struct rockchip_dw_dsi_chip_data rk3288_chip_data[] = {
 	{
 		.reg = 0xff960000,
 		.lcdsel_grf_reg = RK3288_GRF_SOC_CON6,
-		.lcdsel_big = HIWORD_UPDATE(0, RK3288_DSI0_LCDC_SEL),
-		.lcdsel_lit = HIWORD_UPDATE(RK3288_DSI0_LCDC_SEL, RK3288_DSI0_LCDC_SEL),
+		.lcdsel_big = FIELD_PREP_WM16_CONST(RK3288_DSI0_LCDC_SEL, 0),
+		.lcdsel_lit = FIELD_PREP_WM16_CONST(RK3288_DSI0_LCDC_SEL, 1),
 
 		.max_data_lanes = 4,
 	},
 	{
 		.reg = 0xff964000,
 		.lcdsel_grf_reg = RK3288_GRF_SOC_CON6,
-		.lcdsel_big = HIWORD_UPDATE(0, RK3288_DSI1_LCDC_SEL),
-		.lcdsel_lit = HIWORD_UPDATE(RK3288_DSI1_LCDC_SEL, RK3288_DSI1_LCDC_SEL),
+		.lcdsel_big = FIELD_PREP_WM16_CONST(RK3288_DSI1_LCDC_SEL, 0),
+		.lcdsel_lit = FIELD_PREP_WM16_CONST(RK3288_DSI1_LCDC_SEL, 1),
 
 		.max_data_lanes = 4,
 	},
@@ -1539,13 +1537,13 @@ static int rk3399_dphy_tx1rx1_init(struct phy *phy)
 	 * Assume ISP0 is supplied by the RX0 dphy.
 	 */
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON24,
-		     HIWORD_UPDATE(0, RK3399_TXRX_SRC_SEL_ISP0));
+		     FIELD_PREP_WM16(RK3399_TXRX_SRC_SEL_ISP0, 0));
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON24,
-		     HIWORD_UPDATE(0, RK3399_TXRX_MASTERSLAVEZ));
+		     FIELD_PREP_WM16(RK3399_TXRX_MASTERSLAVEZ, 0));
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON24,
-		     HIWORD_UPDATE(0, RK3399_TXRX_BASEDIR));
+		     FIELD_PREP_WM16(RK3399_TXRX_BASEDIR, 0));
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON23,
-		     HIWORD_UPDATE(0, RK3399_DSI1_ENABLE));
+		     FIELD_PREP_WM16(RK3399_DSI1_ENABLE, 0));
 
 	return 0;
 }
@@ -1559,21 +1557,20 @@ static int rk3399_dphy_tx1rx1_power_on(struct phy *phy)
 	usleep_range(100, 150);
 
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON24,
-		     HIWORD_UPDATE(0, RK3399_TXRX_MASTERSLAVEZ));
+		     FIELD_PREP_WM16(RK3399_TXRX_MASTERSLAVEZ, 0));
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON24,
-		     HIWORD_UPDATE(RK3399_TXRX_BASEDIR, RK3399_TXRX_BASEDIR));
+		     FIELD_PREP_WM16(RK3399_TXRX_BASEDIR, 1));
 
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON23,
-		     HIWORD_UPDATE(0, RK3399_DSI1_FORCERXMODE));
+		     FIELD_PREP_WM16(RK3399_DSI1_FORCERXMODE, 0));
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON23,
-		     HIWORD_UPDATE(0, RK3399_DSI1_FORCETXSTOPMODE));
+		     FIELD_PREP_WM16(RK3399_DSI1_FORCETXSTOPMODE, 0));
 
 	/* Disable lane turn around, which is ignored in receive mode */
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON24,
-		     HIWORD_UPDATE(0, RK3399_TXRX_TURNREQUEST));
+		     FIELD_PREP_WM16(RK3399_TXRX_TURNREQUEST, 0));
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON23,
-		     HIWORD_UPDATE(RK3399_DSI1_TURNDISABLE,
-				   RK3399_DSI1_TURNDISABLE));
+		     FIELD_PREP_WM16(RK3399_DSI1_TURNDISABLE, 0xf));
 	usleep_range(100, 150);
 
 	dsi_write(dsi, DSI_PHY_TST_CTRL0, PHY_TESTCLK | PHY_UNTESTCLR);
@@ -1581,8 +1578,8 @@ static int rk3399_dphy_tx1rx1_power_on(struct phy *phy)
 
 	/* Enable dphy lanes */
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON23,
-		     HIWORD_UPDATE(GENMASK(dsi->dphy_config.lanes - 1, 0),
-				   RK3399_DSI1_ENABLE));
+		     FIELD_PREP_WM16(RK3399_DSI1_ENABLE,
+				  GENMASK(dsi->dphy_config.lanes - 1, 0)));
 
 	usleep_range(100, 150);
 
@@ -1594,7 +1591,7 @@ static int rk3399_dphy_tx1rx1_power_off(struct phy *phy)
 	struct dw_mipi_dsi_rockchip *dsi = phy_get_drvdata(phy);
 
 	regmap_write(dsi->grf_regmap, RK3399_GRF_SOC_CON23,
-		     HIWORD_UPDATE(0, RK3399_DSI1_ENABLE));
+		     FIELD_PREP_WM16(RK3399_DSI1_ENABLE, 0));
 
 	return 0;
 }
@@ -1603,15 +1600,14 @@ static const struct rockchip_dw_dsi_chip_data rk3399_chip_data[] = {
 	{
 		.reg = 0xff960000,
 		.lcdsel_grf_reg = RK3399_GRF_SOC_CON20,
-		.lcdsel_big = HIWORD_UPDATE(0, RK3399_DSI0_LCDC_SEL),
-		.lcdsel_lit = HIWORD_UPDATE(RK3399_DSI0_LCDC_SEL,
-					    RK3399_DSI0_LCDC_SEL),
+		.lcdsel_big = FIELD_PREP_WM16_CONST(RK3399_DSI0_LCDC_SEL, 0),
+		.lcdsel_lit = FIELD_PREP_WM16_CONST(RK3399_DSI0_LCDC_SEL, 1),
 
 		.lanecfg1_grf_reg = RK3399_GRF_SOC_CON22,
-		.lanecfg1 = HIWORD_UPDATE(0, RK3399_DSI0_TURNREQUEST |
-					     RK3399_DSI0_TURNDISABLE |
-					     RK3399_DSI0_FORCETXSTOPMODE |
-					     RK3399_DSI0_FORCERXMODE),
+		.lanecfg1 = FIELD_PREP_WM16_CONST((RK3399_DSI0_TURNREQUEST |
+						RK3399_DSI0_TURNDISABLE |
+						RK3399_DSI0_FORCETXSTOPMODE |
+						RK3399_DSI0_FORCERXMODE), 0),
 
 		.flags = DW_MIPI_NEEDS_PHY_CFG_CLK | DW_MIPI_NEEDS_GRF_CLK,
 		.max_data_lanes = 4,
@@ -1619,25 +1615,23 @@ static const struct rockchip_dw_dsi_chip_data rk3399_chip_data[] = {
 	{
 		.reg = 0xff968000,
 		.lcdsel_grf_reg = RK3399_GRF_SOC_CON20,
-		.lcdsel_big = HIWORD_UPDATE(0, RK3399_DSI1_LCDC_SEL),
-		.lcdsel_lit = HIWORD_UPDATE(RK3399_DSI1_LCDC_SEL,
-					    RK3399_DSI1_LCDC_SEL),
+		.lcdsel_big = FIELD_PREP_WM16_CONST(RK3399_DSI1_LCDC_SEL, 0),
+		.lcdsel_lit = FIELD_PREP_WM16_CONST(RK3399_DSI1_LCDC_SEL, 1),
+
 
 		.lanecfg1_grf_reg = RK3399_GRF_SOC_CON23,
-		.lanecfg1 = HIWORD_UPDATE(0, RK3399_DSI1_TURNDISABLE |
-					     RK3399_DSI1_FORCETXSTOPMODE |
-					     RK3399_DSI1_FORCERXMODE |
-					     RK3399_DSI1_ENABLE),
+		.lanecfg1 = FIELD_PREP_WM16_CONST((RK3399_DSI1_TURNDISABLE |
+						RK3399_DSI1_FORCETXSTOPMODE |
+						RK3399_DSI1_FORCERXMODE |
+						RK3399_DSI1_ENABLE), 0),
 
 		.lanecfg2_grf_reg = RK3399_GRF_SOC_CON24,
-		.lanecfg2 = HIWORD_UPDATE(RK3399_TXRX_MASTERSLAVEZ |
-					  RK3399_TXRX_ENABLECLK,
-					  RK3399_TXRX_MASTERSLAVEZ |
-					  RK3399_TXRX_ENABLECLK |
-					  RK3399_TXRX_BASEDIR),
+		.lanecfg2 = (FIELD_PREP_WM16_CONST(RK3399_TXRX_MASTERSLAVEZ, 1) |
+			     FIELD_PREP_WM16_CONST(RK3399_TXRX_ENABLECLK, 1) |
+			     FIELD_PREP_WM16_CONST(RK3399_TXRX_BASEDIR, 0)),
 
 		.enable_grf_reg = RK3399_GRF_SOC_CON23,
-		.enable = HIWORD_UPDATE(RK3399_DSI1_ENABLE, RK3399_DSI1_ENABLE),
+		.enable = FIELD_PREP_WM16_CONST(RK3399_DSI1_ENABLE, RK3399_DSI1_ENABLE),
 
 		.flags = DW_MIPI_NEEDS_PHY_CFG_CLK | DW_MIPI_NEEDS_GRF_CLK,
 		.max_data_lanes = 4,
@@ -1653,19 +1647,19 @@ static const struct rockchip_dw_dsi_chip_data rk3568_chip_data[] = {
 	{
 		.reg = 0xfe060000,
 		.lanecfg1_grf_reg = RK3568_GRF_VO_CON2,
-		.lanecfg1 = HIWORD_UPDATE(0, RK3568_DSI0_SKEWCALHS |
-					  RK3568_DSI0_FORCETXSTOPMODE |
-					  RK3568_DSI0_TURNDISABLE |
-					  RK3568_DSI0_FORCERXMODE),
+		.lanecfg1 = (FIELD_PREP_WM16_CONST(RK3568_DSI0_SKEWCALHS, 0) |
+			     FIELD_PREP_WM16_CONST(RK3568_DSI0_FORCETXSTOPMODE, 0) |
+			     FIELD_PREP_WM16_CONST(RK3568_DSI0_TURNDISABLE, 0) |
+			     FIELD_PREP_WM16_CONST(RK3568_DSI0_FORCERXMODE, 0)),
 		.max_data_lanes = 4,
 	},
 	{
 		.reg = 0xfe070000,
 		.lanecfg1_grf_reg = RK3568_GRF_VO_CON3,
-		.lanecfg1 = HIWORD_UPDATE(0, RK3568_DSI1_SKEWCALHS |
-					  RK3568_DSI1_FORCETXSTOPMODE |
-					  RK3568_DSI1_TURNDISABLE |
-					  RK3568_DSI1_FORCERXMODE),
+		.lanecfg1 = (FIELD_PREP_WM16_CONST(RK3568_DSI1_SKEWCALHS, 0) |
+			     FIELD_PREP_WM16_CONST(RK3568_DSI1_FORCETXSTOPMODE, 0) |
+			     FIELD_PREP_WM16_CONST(RK3568_DSI1_TURNDISABLE, 0) |
+			     FIELD_PREP_WM16_CONST(RK3568_DSI1_FORCERXMODE, 0)),
 		.max_data_lanes = 4,
 	},
 	{ /* sentinel */ }
@@ -1675,9 +1669,9 @@ static const struct rockchip_dw_dsi_chip_data rv1126_chip_data[] = {
 	{
 		.reg = 0xffb30000,
 		.lanecfg1_grf_reg = RV1126_GRF_DSIPHY_CON,
-		.lanecfg1 = HIWORD_UPDATE(0, RV1126_DSI_TURNDISABLE |
-					     RV1126_DSI_FORCERXMODE |
-					     RV1126_DSI_FORCETXSTOPMODE),
+		.lanecfg1 = (FIELD_PREP_WM16_CONST(RV1126_DSI_TURNDISABLE, 0) |
+			     FIELD_PREP_WM16_CONST(RV1126_DSI_FORCERXMODE, 0) |
+			     FIELD_PREP_WM16_CONST(RV1126_DSI_FORCETXSTOPMODE, 0)),
 		.max_data_lanes = 4,
 	},
 	{ /* sentinel */ }
diff --git a/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c b/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
index acb59b25d928..7b613997bb50 100644
--- a/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
+++ b/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
@@ -4,6 +4,7 @@
  */
 
 #include <linux/clk.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mfd/syscon.h>
 #include <linux/module.h>
 #include <linux/platform_device.h>
@@ -54,8 +55,6 @@
 #define RK3568_HDMI_SDAIN_MSK		BIT(15)
 #define RK3568_HDMI_SCLIN_MSK		BIT(14)
 
-#define HIWORD_UPDATE(val, mask)	(val | (mask) << 16)
-
 /**
  * struct rockchip_hdmi_chip_data - splite the grf setting of kind of chips
  * @lcdsel_grf_reg: grf register offset of lcdc select
@@ -355,17 +354,14 @@ static void dw_hdmi_rk3228_setup_hpd(struct dw_hdmi *dw_hdmi, void *data)
 
 	dw_hdmi_phy_setup_hpd(dw_hdmi, data);
 
-	regmap_write(hdmi->regmap,
-		RK3228_GRF_SOC_CON6,
-		HIWORD_UPDATE(RK3228_HDMI_HPD_VSEL | RK3228_HDMI_SDA_VSEL |
-			      RK3228_HDMI_SCL_VSEL,
-			      RK3228_HDMI_HPD_VSEL | RK3228_HDMI_SDA_VSEL |
-			      RK3228_HDMI_SCL_VSEL));
-
-	regmap_write(hdmi->regmap,
-		RK3228_GRF_SOC_CON2,
-		HIWORD_UPDATE(RK3228_HDMI_SDAIN_MSK | RK3228_HDMI_SCLIN_MSK,
-			      RK3228_HDMI_SDAIN_MSK | RK3228_HDMI_SCLIN_MSK));
+	regmap_write(hdmi->regmap, RK3228_GRF_SOC_CON6,
+		     FIELD_PREP_WM16(RK3228_HDMI_HPD_VSEL, 1) |
+		     FIELD_PREP_WM16(RK3228_HDMI_SDA_VSEL, 1) |
+		     FIELD_PREP_WM16(RK3228_HDMI_SCL_VSEL, 1));
+
+	regmap_write(hdmi->regmap, RK3228_GRF_SOC_CON2,
+		     FIELD_PREP_WM16(RK3228_HDMI_SDAIN_MSK, 1) |
+		     FIELD_PREP_WM16(RK3328_HDMI_SCLIN_MSK, 1));
 }
 
 static enum drm_connector_status
@@ -377,15 +373,13 @@ dw_hdmi_rk3328_read_hpd(struct dw_hdmi *dw_hdmi, void *data)
 	status = dw_hdmi_phy_read_hpd(dw_hdmi, data);
 
 	if (status == connector_status_connected)
-		regmap_write(hdmi->regmap,
-			RK3328_GRF_SOC_CON4,
-			HIWORD_UPDATE(RK3328_HDMI_SDA_5V | RK3328_HDMI_SCL_5V,
-				      RK3328_HDMI_SDA_5V | RK3328_HDMI_SCL_5V));
+		regmap_write(hdmi->regmap, RK3328_GRF_SOC_CON4,
+			     FIELD_PREP_WM16(RK3328_HDMI_SDA_5V, 1) |
+			     FIELD_PREP_WM16(RK3328_HDMI_SCL_5V, 1));
 	else
-		regmap_write(hdmi->regmap,
-			RK3328_GRF_SOC_CON4,
-			HIWORD_UPDATE(0, RK3328_HDMI_SDA_5V |
-					 RK3328_HDMI_SCL_5V));
+		regmap_write(hdmi->regmap, RK3328_GRF_SOC_CON4,
+			     FIELD_PREP_WM16(RK3328_HDMI_SDA_5V, 0) |
+			     FIELD_PREP_WM16(RK3328_HDMI_SCL_5V, 0));
 	return status;
 }
 
@@ -396,21 +390,21 @@ static void dw_hdmi_rk3328_setup_hpd(struct dw_hdmi *dw_hdmi, void *data)
 	dw_hdmi_phy_setup_hpd(dw_hdmi, data);
 
 	/* Enable and map pins to 3V grf-controlled io-voltage */
-	regmap_write(hdmi->regmap,
-		RK3328_GRF_SOC_CON4,
-		HIWORD_UPDATE(0, RK3328_HDMI_HPD_SARADC | RK3328_HDMI_CEC_5V |
-				 RK3328_HDMI_SDA_5V | RK3328_HDMI_SCL_5V |
-				 RK3328_HDMI_HPD_5V));
-	regmap_write(hdmi->regmap,
-		RK3328_GRF_SOC_CON3,
-		HIWORD_UPDATE(0, RK3328_HDMI_SDA5V_GRF | RK3328_HDMI_SCL5V_GRF |
-				 RK3328_HDMI_HPD5V_GRF |
-				 RK3328_HDMI_CEC5V_GRF));
-	regmap_write(hdmi->regmap,
-		RK3328_GRF_SOC_CON2,
-		HIWORD_UPDATE(RK3328_HDMI_SDAIN_MSK | RK3328_HDMI_SCLIN_MSK,
-			      RK3328_HDMI_SDAIN_MSK | RK3328_HDMI_SCLIN_MSK |
-			      RK3328_HDMI_HPD_IOE));
+	regmap_write(hdmi->regmap, RK3328_GRF_SOC_CON4,
+		     FIELD_PREP_WM16(RK3328_HDMI_HPD_SARADC, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_CEC_5V, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_SDA_5V, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_SCL_5V, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_HPD_5V, 0));
+	regmap_write(hdmi->regmap, RK3328_GRF_SOC_CON3,
+		     FIELD_PREP_WM16(RK3328_HDMI_SDA5V_GRF, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_SCL5V_GRF, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_HPD5V_GRF, 0) |
+		     FIELD_PREP_WM16(RK3328_HDMI_CEC5V_GRF, 0));
+	regmap_write(hdmi->regmap, RK3328_GRF_SOC_CON2,
+		     FIELD_PREP_WM16(RK3328_HDMI_SDAIN_MSK, 1) |
+		     FIELD_PREP_WM16(RK3328_HDMI_SCLIN_MSK, 1) |
+		     FIELD_PREP_WM16(RK3328_HDMI_HPD_IOE, 0));
 
 	dw_hdmi_rk3328_read_hpd(dw_hdmi, data);
 }
@@ -438,8 +432,8 @@ static const struct dw_hdmi_plat_data rk3228_hdmi_drv_data = {
 
 static struct rockchip_hdmi_chip_data rk3288_chip_data = {
 	.lcdsel_grf_reg = RK3288_GRF_SOC_CON6,
-	.lcdsel_big = HIWORD_UPDATE(0, RK3288_HDMI_LCDC_SEL),
-	.lcdsel_lit = HIWORD_UPDATE(RK3288_HDMI_LCDC_SEL, RK3288_HDMI_LCDC_SEL),
+	.lcdsel_big = FIELD_PREP_WM16_CONST(RK3288_HDMI_LCDC_SEL, 0),
+	.lcdsel_lit = FIELD_PREP_WM16_CONST(RK3288_HDMI_LCDC_SEL, 1),
 	.max_tmds_clock = 340000,
 };
 
@@ -475,8 +469,8 @@ static const struct dw_hdmi_plat_data rk3328_hdmi_drv_data = {
 
 static struct rockchip_hdmi_chip_data rk3399_chip_data = {
 	.lcdsel_grf_reg = RK3399_GRF_SOC_CON20,
-	.lcdsel_big = HIWORD_UPDATE(0, RK3399_HDMI_LCDC_SEL),
-	.lcdsel_lit = HIWORD_UPDATE(RK3399_HDMI_LCDC_SEL, RK3399_HDMI_LCDC_SEL),
+	.lcdsel_big = FIELD_PREP_WM16_CONST(RK3399_HDMI_LCDC_SEL, 0),
+	.lcdsel_lit = FIELD_PREP_WM16_CONST(RK3399_HDMI_LCDC_SEL, 1),
 	.max_tmds_clock = 594000,
 };
 
@@ -589,10 +583,8 @@ static int dw_hdmi_rockchip_bind(struct device *dev, struct device *master,
 
 	if (hdmi->chip_data == &rk3568_chip_data) {
 		regmap_write(hdmi->regmap, RK3568_GRF_VO_CON1,
-			     HIWORD_UPDATE(RK3568_HDMI_SDAIN_MSK |
-					   RK3568_HDMI_SCLIN_MSK,
-					   RK3568_HDMI_SDAIN_MSK |
-					   RK3568_HDMI_SCLIN_MSK));
+			     FIELD_PREP_WM16(RK3568_HDMI_SDAIN_MSK, 1) |
+			     FIELD_PREP_WM16(RK3568_HDMI_SCLIN_MSK, 1));
 	}
 
 	drm_encoder_helper_add(encoder, &dw_hdmi_rockchip_encoder_helper_funcs);
diff --git a/drivers/gpu/drm/rockchip/dw_hdmi_qp-rockchip.c b/drivers/gpu/drm/rockchip/dw_hdmi_qp-rockchip.c
index 7d531b6f4c09..ed6e8f036f4b 100644
--- a/drivers/gpu/drm/rockchip/dw_hdmi_qp-rockchip.c
+++ b/drivers/gpu/drm/rockchip/dw_hdmi_qp-rockchip.c
@@ -9,6 +9,7 @@
 
 #include <linux/clk.h>
 #include <linux/gpio/consumer.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mfd/syscon.h>
 #include <linux/module.h>
 #include <linux/platform_device.h>
@@ -66,7 +67,8 @@
 #define RK3588_HDMI1_HPD_INT_MSK	BIT(15)
 #define RK3588_HDMI1_HPD_INT_CLR	BIT(14)
 #define RK3588_GRF_SOC_CON7		0x031c
-#define RK3588_SET_HPD_PATH_MASK	GENMASK(13, 12)
+#define RK3588_HPD_HDMI0_IO_EN_MASK	BIT(12)
+#define RK3588_HPD_HDMI1_IO_EN_MASK	BIT(13)
 #define RK3588_GRF_SOC_STATUS1		0x0384
 #define RK3588_HDMI0_LEVEL_INT		BIT(16)
 #define RK3588_HDMI1_LEVEL_INT		BIT(24)
@@ -80,7 +82,6 @@
 #define RK3588_HDMI0_GRANT_SEL		BIT(10)
 #define RK3588_HDMI1_GRANT_SEL		BIT(12)
 
-#define HIWORD_UPDATE(val, mask)	((val) | (mask) << 16)
 #define HOTPLUG_DEBOUNCE_MS		150
 #define MAX_HDMI_PORT_NUM		2
 
@@ -185,11 +186,11 @@ static void dw_hdmi_qp_rk3588_setup_hpd(struct dw_hdmi_qp *dw_hdmi, void *data)
 	u32 val;
 
 	if (hdmi->port_id)
-		val = HIWORD_UPDATE(RK3588_HDMI1_HPD_INT_CLR,
-				    RK3588_HDMI1_HPD_INT_CLR | RK3588_HDMI1_HPD_INT_MSK);
+		val = (FIELD_PREP_WM16(RK3588_HDMI1_HPD_INT_CLR, 1) |
+		       FIELD_PREP_WM16(RK3588_HDMI1_HPD_INT_MSK, 0));
 	else
-		val = HIWORD_UPDATE(RK3588_HDMI0_HPD_INT_CLR,
-				    RK3588_HDMI0_HPD_INT_CLR | RK3588_HDMI0_HPD_INT_MSK);
+		val = (FIELD_PREP_WM16(RK3588_HDMI0_HPD_INT_CLR, 1) |
+		       FIELD_PREP_WM16(RK3588_HDMI0_HPD_INT_MSK, 0));
 
 	regmap_write(hdmi->regmap, RK3588_GRF_SOC_CON2, val);
 }
@@ -218,8 +219,8 @@ static void dw_hdmi_qp_rk3576_setup_hpd(struct dw_hdmi_qp *dw_hdmi, void *data)
 	struct rockchip_hdmi_qp *hdmi = (struct rockchip_hdmi_qp *)data;
 	u32 val;
 
-	val = HIWORD_UPDATE(RK3576_HDMI_HPD_INT_CLR,
-			    RK3576_HDMI_HPD_INT_CLR | RK3576_HDMI_HPD_INT_MSK);
+	val = (FIELD_PREP_WM16(RK3576_HDMI_HPD_INT_CLR, 1) |
+	       FIELD_PREP_WM16(RK3576_HDMI_HPD_INT_MSK, 0));
 
 	regmap_write(hdmi->regmap, RK3576_IOC_MISC_CON0, val);
 	regmap_write(hdmi->regmap, 0xa404, 0xffff0102);
@@ -254,7 +255,7 @@ static irqreturn_t dw_hdmi_qp_rk3576_hardirq(int irq, void *dev_id)
 
 	regmap_read(hdmi->regmap, RK3576_IOC_HDMI_HPD_STATUS, &intr_stat);
 	if (intr_stat) {
-		val = HIWORD_UPDATE(RK3576_HDMI_HPD_INT_MSK, RK3576_HDMI_HPD_INT_MSK);
+		val = FIELD_PREP_WM16(RK3576_HDMI_HPD_INT_MSK, 1);
 
 		regmap_write(hdmi->regmap, RK3576_IOC_MISC_CON0, val);
 		return IRQ_WAKE_THREAD;
@@ -273,12 +274,12 @@ static irqreturn_t dw_hdmi_qp_rk3576_irq(int irq, void *dev_id)
 	if (!intr_stat)
 		return IRQ_NONE;
 
-	val = HIWORD_UPDATE(RK3576_HDMI_HPD_INT_CLR, RK3576_HDMI_HPD_INT_CLR);
+	val = FIELD_PREP_WM16(RK3576_HDMI_HPD_INT_CLR, 1);
 	regmap_write(hdmi->regmap, RK3576_IOC_MISC_CON0, val);
 	mod_delayed_work(system_wq, &hdmi->hpd_work,
 			 msecs_to_jiffies(HOTPLUG_DEBOUNCE_MS));
 
-	val = HIWORD_UPDATE(0, RK3576_HDMI_HPD_INT_MSK);
+	val = FIELD_PREP_WM16(RK3576_HDMI_HPD_INT_MSK, 0);
 	regmap_write(hdmi->regmap, RK3576_IOC_MISC_CON0, val);
 
 	return IRQ_HANDLED;
@@ -293,11 +294,9 @@ static irqreturn_t dw_hdmi_qp_rk3588_hardirq(int irq, void *dev_id)
 
 	if (intr_stat) {
 		if (hdmi->port_id)
-			val = HIWORD_UPDATE(RK3588_HDMI1_HPD_INT_MSK,
-					    RK3588_HDMI1_HPD_INT_MSK);
+			val = FIELD_PREP_WM16(RK3588_HDMI1_HPD_INT_MSK, 1);
 		else
-			val = HIWORD_UPDATE(RK3588_HDMI0_HPD_INT_MSK,
-					    RK3588_HDMI0_HPD_INT_MSK);
+			val = FIELD_PREP_WM16(RK3588_HDMI0_HPD_INT_MSK, 1);
 		regmap_write(hdmi->regmap, RK3588_GRF_SOC_CON2, val);
 		return IRQ_WAKE_THREAD;
 	}
@@ -315,20 +314,18 @@ static irqreturn_t dw_hdmi_qp_rk3588_irq(int irq, void *dev_id)
 		return IRQ_NONE;
 
 	if (hdmi->port_id)
-		val = HIWORD_UPDATE(RK3588_HDMI1_HPD_INT_CLR,
-				    RK3588_HDMI1_HPD_INT_CLR);
+		val = FIELD_PREP_WM16(RK3588_HDMI1_HPD_INT_CLR, 1);
 	else
-		val = HIWORD_UPDATE(RK3588_HDMI0_HPD_INT_CLR,
-				    RK3588_HDMI0_HPD_INT_CLR);
+		val = FIELD_PREP_WM16(RK3588_HDMI0_HPD_INT_CLR, 1);
 	regmap_write(hdmi->regmap, RK3588_GRF_SOC_CON2, val);
 
 	mod_delayed_work(system_wq, &hdmi->hpd_work,
 			 msecs_to_jiffies(HOTPLUG_DEBOUNCE_MS));
 
 	if (hdmi->port_id)
-		val |= HIWORD_UPDATE(0, RK3588_HDMI1_HPD_INT_MSK);
+		val |= FIELD_PREP_WM16(RK3588_HDMI1_HPD_INT_MSK, 0);
 	else
-		val |= HIWORD_UPDATE(0, RK3588_HDMI0_HPD_INT_MSK);
+		val |= FIELD_PREP_WM16(RK3588_HDMI0_HPD_INT_MSK, 0);
 	regmap_write(hdmi->regmap, RK3588_GRF_SOC_CON2, val);
 
 	return IRQ_HANDLED;
@@ -338,14 +335,14 @@ static void dw_hdmi_qp_rk3576_io_init(struct rockchip_hdmi_qp *hdmi)
 {
 	u32 val;
 
-	val = HIWORD_UPDATE(RK3576_SCLIN_MASK, RK3576_SCLIN_MASK) |
-	      HIWORD_UPDATE(RK3576_SDAIN_MASK, RK3576_SDAIN_MASK) |
-	      HIWORD_UPDATE(RK3576_HDMI_GRANT_SEL, RK3576_HDMI_GRANT_SEL) |
-	      HIWORD_UPDATE(RK3576_I2S_SEL_MASK, RK3576_I2S_SEL_MASK);
+	val = FIELD_PREP_WM16(RK3576_SCLIN_MASK, 1) |
+	      FIELD_PREP_WM16(RK3576_SDAIN_MASK, 1) |
+	      FIELD_PREP_WM16(RK3576_HDMI_GRANT_SEL, 1) |
+	      FIELD_PREP_WM16(RK3576_I2S_SEL_MASK, 1);
 
 	regmap_write(hdmi->vo_regmap, RK3576_VO0_GRF_SOC_CON14, val);
 
-	val = HIWORD_UPDATE(0, RK3576_HDMI_HPD_INT_MSK);
+	val = FIELD_PREP_WM16(RK3576_HDMI_HPD_INT_MSK, 0);
 	regmap_write(hdmi->regmap, RK3576_IOC_MISC_CON0, val);
 }
 
@@ -353,27 +350,28 @@ static void dw_hdmi_qp_rk3588_io_init(struct rockchip_hdmi_qp *hdmi)
 {
 	u32 val;
 
-	val = HIWORD_UPDATE(RK3588_SCLIN_MASK, RK3588_SCLIN_MASK) |
-	      HIWORD_UPDATE(RK3588_SDAIN_MASK, RK3588_SDAIN_MASK) |
-	      HIWORD_UPDATE(RK3588_MODE_MASK, RK3588_MODE_MASK) |
-	      HIWORD_UPDATE(RK3588_I2S_SEL_MASK, RK3588_I2S_SEL_MASK);
+	val = FIELD_PREP_WM16(RK3588_SCLIN_MASK, 1) |
+	      FIELD_PREP_WM16(RK3588_SDAIN_MASK, 1) |
+	      FIELD_PREP_WM16(RK3588_MODE_MASK, 1) |
+	      FIELD_PREP_WM16(RK3588_I2S_SEL_MASK, 1);
 	regmap_write(hdmi->vo_regmap,
 		     hdmi->port_id ? RK3588_GRF_VO1_CON6 : RK3588_GRF_VO1_CON3,
 		     val);
 
-	val = HIWORD_UPDATE(RK3588_SET_HPD_PATH_MASK, RK3588_SET_HPD_PATH_MASK);
+	val = FIELD_PREP_WM16(RK3588_HPD_HDMI0_IO_EN_MASK, 1) |
+	      FIELD_PREP_WM16(RK3588_HPD_HDMI1_IO_EN_MASK, 1);
 	regmap_write(hdmi->regmap, RK3588_GRF_SOC_CON7, val);
 
 	if (hdmi->port_id)
-		val = HIWORD_UPDATE(RK3588_HDMI1_GRANT_SEL, RK3588_HDMI1_GRANT_SEL);
+		val = FIELD_PREP_WM16(RK3588_HDMI1_GRANT_SEL, 1);
 	else
-		val = HIWORD_UPDATE(RK3588_HDMI0_GRANT_SEL, RK3588_HDMI0_GRANT_SEL);
+		val = FIELD_PREP_WM16(RK3588_HDMI0_GRANT_SEL, 1);
 	regmap_write(hdmi->vo_regmap, RK3588_GRF_VO1_CON9, val);
 
 	if (hdmi->port_id)
-		val = HIWORD_UPDATE(RK3588_HDMI1_HPD_INT_MSK, RK3588_HDMI1_HPD_INT_MSK);
+		val = FIELD_PREP_WM16(RK3588_HDMI1_HPD_INT_MSK, 1);
 	else
-		val = HIWORD_UPDATE(RK3588_HDMI0_HPD_INT_MSK, RK3588_HDMI0_HPD_INT_MSK);
+		val = FIELD_PREP_WM16(RK3588_HDMI0_HPD_INT_MSK, 1);
 	regmap_write(hdmi->regmap, RK3588_GRF_SOC_CON2, val);
 }
 
diff --git a/drivers/gpu/drm/rockchip/inno_hdmi.c b/drivers/gpu/drm/rockchip/inno_hdmi.c
index 1ab3ad4bde9e..f24827dc1421 100644
--- a/drivers/gpu/drm/rockchip/inno_hdmi.c
+++ b/drivers/gpu/drm/rockchip/inno_hdmi.c
@@ -10,6 +10,7 @@
 #include <linux/delay.h>
 #include <linux/err.h>
 #include <linux/hdmi.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mfd/syscon.h>
 #include <linux/mod_devicetable.h>
 #include <linux/module.h>
@@ -382,8 +383,6 @@ enum {
 #define HDMI_CEC_BUSFREETIME_H		0xdd
 #define HDMI_CEC_LOGICADDR		0xde
 
-#define HIWORD_UPDATE(val, mask)	((val) | (mask) << 16)
-
 #define RK3036_GRF_SOC_CON2	0x148
 #define RK3036_HDMI_PHSYNC	BIT(4)
 #define RK3036_HDMI_PVSYNC	BIT(5)
@@ -756,10 +755,10 @@ static int inno_hdmi_config_video_timing(struct inno_hdmi *hdmi,
 	int value, psync;
 
 	if (hdmi->variant->dev_type == RK3036_HDMI) {
-		psync = mode->flags & DRM_MODE_FLAG_PHSYNC ? RK3036_HDMI_PHSYNC : 0;
-		value = HIWORD_UPDATE(psync, RK3036_HDMI_PHSYNC);
-		psync = mode->flags & DRM_MODE_FLAG_PVSYNC ? RK3036_HDMI_PVSYNC : 0;
-		value |= HIWORD_UPDATE(psync, RK3036_HDMI_PVSYNC);
+		psync = mode->flags & DRM_MODE_FLAG_PHSYNC ? 1 : 0;
+		value = FIELD_PREP_WM16(RK3036_HDMI_PHSYNC, psync);
+		psync = mode->flags & DRM_MODE_FLAG_PVSYNC ? 1 : 0;
+		value |= FIELD_PREP_WM16(RK3036_HDMI_PVSYNC, psync);
 		regmap_write(hdmi->grf, RK3036_GRF_SOC_CON2, value);
 	}
 
diff --git a/drivers/gpu/drm/rockchip/rockchip_drm_vop2.h b/drivers/gpu/drm/rockchip/rockchip_drm_vop2.h
index fa5c56f16047..9124191899ba 100644
--- a/drivers/gpu/drm/rockchip/rockchip_drm_vop2.h
+++ b/drivers/gpu/drm/rockchip/rockchip_drm_vop2.h
@@ -33,7 +33,6 @@
 #define WIN_FEATURE_AFBDC		BIT(0)
 #define WIN_FEATURE_CLUSTER		BIT(1)
 
-#define HIWORD_UPDATE(v, h, l)  ((GENMASK(h, l) << 16) | ((v) << (l)))
 /*
  *  the delay number of a window in different mode.
  */
diff --git a/drivers/gpu/drm/rockchip/rockchip_lvds.h b/drivers/gpu/drm/rockchip/rockchip_lvds.h
index ca83d7b6bea7..2d92447d819b 100644
--- a/drivers/gpu/drm/rockchip/rockchip_lvds.h
+++ b/drivers/gpu/drm/rockchip/rockchip_lvds.h
@@ -9,6 +9,9 @@
 #ifndef _ROCKCHIP_LVDS_
 #define _ROCKCHIP_LVDS_
 
+#include <linux/bits.h>
+#include <linux/hw_bitfield.h>
+
 #define RK3288_LVDS_CH0_REG0			0x00
 #define RK3288_LVDS_CH0_REG0_LVDS_EN		BIT(7)
 #define RK3288_LVDS_CH0_REG0_TTL_EN		BIT(6)
@@ -106,18 +109,16 @@
 #define LVDS_VESA_18				2
 #define LVDS_JEIDA_18				3
 
-#define HIWORD_UPDATE(v, h, l)  ((GENMASK(h, l) << 16) | ((v) << (l)))
-
 #define PX30_LVDS_GRF_PD_VO_CON0		0x434
-#define   PX30_LVDS_TIE_CLKS(val)		HIWORD_UPDATE(val,  8,  8)
-#define   PX30_LVDS_INVERT_CLKS(val)		HIWORD_UPDATE(val,  9,  9)
-#define   PX30_LVDS_INVERT_DCLK(val)		HIWORD_UPDATE(val,  5,  5)
+#define   PX30_LVDS_TIE_CLKS(val)		FIELD_PREP_WM16(BIT(8), (val))
+#define   PX30_LVDS_INVERT_CLKS(val)		FIELD_PREP_WM16(BIT(9), (val))
+#define   PX30_LVDS_INVERT_DCLK(val)		FIELD_PREP_WM16(BIT(5), (val))
 
 #define PX30_LVDS_GRF_PD_VO_CON1		0x438
-#define   PX30_LVDS_FORMAT(val)			HIWORD_UPDATE(val, 14, 13)
-#define   PX30_LVDS_MODE_EN(val)		HIWORD_UPDATE(val, 12, 12)
-#define   PX30_LVDS_MSBSEL(val)			HIWORD_UPDATE(val, 11, 11)
-#define   PX30_LVDS_P2S_EN(val)			HIWORD_UPDATE(val,  6,  6)
-#define   PX30_LVDS_VOP_SEL(val)		HIWORD_UPDATE(val,  1,  1)
+#define   PX30_LVDS_FORMAT(val)			FIELD_PREP_WM16(GENMASK(14, 13), (val))
+#define   PX30_LVDS_MODE_EN(val)		FIELD_PREP_WM16(BIT(12), (val))
+#define   PX30_LVDS_MSBSEL(val)			FIELD_PREP_WM16(BIT(11), (val))
+#define   PX30_LVDS_P2S_EN(val)			FIELD_PREP_WM16(BIT(6), (val))
+#define   PX30_LVDS_VOP_SEL(val)		FIELD_PREP_WM16(BIT(1), (val))
 
 #endif /* _ROCKCHIP_LVDS_ */
diff --git a/drivers/gpu/drm/rockchip/rockchip_vop2_reg.c b/drivers/gpu/drm/rockchip/rockchip_vop2_reg.c
index 45c5e3987813..38c49030c7ab 100644
--- a/drivers/gpu/drm/rockchip/rockchip_vop2_reg.c
+++ b/drivers/gpu/drm/rockchip/rockchip_vop2_reg.c
@@ -7,6 +7,7 @@
 #include <linux/bitfield.h>
 #include <linux/kernel.h>
 #include <linux/component.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mod_devicetable.h>
 #include <linux/platform_device.h>
 #include <linux/of.h>
@@ -1695,8 +1696,9 @@ static unsigned long rk3588_set_intf_mux(struct vop2_video_port *vp, int id, u32
 		die |= RK3588_SYS_DSP_INFACE_EN_HDMI0 |
 			    FIELD_PREP(RK3588_SYS_DSP_INFACE_EN_EDP_HDMI0_MUX, vp->id);
 		val = rk3588_get_hdmi_pol(polflags);
-		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, HIWORD_UPDATE(1, 1, 1));
-		regmap_write(vop2->vo1_grf, RK3588_GRF_VO1_CON0, HIWORD_UPDATE(val, 6, 5));
+		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, FIELD_PREP_WM16(BIT(1), 1));
+		regmap_write(vop2->vo1_grf, RK3588_GRF_VO1_CON0,
+			     FIELD_PREP_WM16(GENMASK(6, 5), val));
 		break;
 	case ROCKCHIP_VOP2_EP_HDMI1:
 		div &= ~RK3588_DSP_IF_EDP_HDMI1_DCLK_DIV;
@@ -1707,8 +1709,9 @@ static unsigned long rk3588_set_intf_mux(struct vop2_video_port *vp, int id, u32
 		die |= RK3588_SYS_DSP_INFACE_EN_HDMI1 |
 			    FIELD_PREP(RK3588_SYS_DSP_INFACE_EN_EDP_HDMI1_MUX, vp->id);
 		val = rk3588_get_hdmi_pol(polflags);
-		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, HIWORD_UPDATE(1, 4, 4));
-		regmap_write(vop2->vo1_grf, RK3588_GRF_VO1_CON0, HIWORD_UPDATE(val, 8, 7));
+		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, FIELD_PREP_WM16(BIT(4), 1));
+		regmap_write(vop2->vo1_grf, RK3588_GRF_VO1_CON0,
+			     FIELD_PREP_WM16(GENMASK(8, 7), val));
 		break;
 	case ROCKCHIP_VOP2_EP_EDP0:
 		div &= ~RK3588_DSP_IF_EDP_HDMI0_DCLK_DIV;
@@ -1718,7 +1721,7 @@ static unsigned long rk3588_set_intf_mux(struct vop2_video_port *vp, int id, u32
 		die &= ~RK3588_SYS_DSP_INFACE_EN_EDP_HDMI0_MUX;
 		die |= RK3588_SYS_DSP_INFACE_EN_EDP0 |
 			   FIELD_PREP(RK3588_SYS_DSP_INFACE_EN_EDP_HDMI0_MUX, vp->id);
-		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, HIWORD_UPDATE(1, 0, 0));
+		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, FIELD_PREP_WM16(BIT(0), 1));
 		break;
 	case ROCKCHIP_VOP2_EP_EDP1:
 		div &= ~RK3588_DSP_IF_EDP_HDMI1_DCLK_DIV;
@@ -1728,7 +1731,7 @@ static unsigned long rk3588_set_intf_mux(struct vop2_video_port *vp, int id, u32
 		die &= ~RK3588_SYS_DSP_INFACE_EN_EDP_HDMI1_MUX;
 		die |= RK3588_SYS_DSP_INFACE_EN_EDP1 |
 			   FIELD_PREP(RK3588_SYS_DSP_INFACE_EN_EDP_HDMI1_MUX, vp->id);
-		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, HIWORD_UPDATE(1, 3, 3));
+		regmap_write(vop2->vop_grf, RK3588_GRF_VOP_CON2, FIELD_PREP_WM16(BIT(3), 1));
 		break;
 	case ROCKCHIP_VOP2_EP_MIPI0:
 		div &= ~RK3588_DSP_IF_MIPI0_PCLK_DIV;
diff --git a/drivers/gpu/nova-core/fb.rs b/drivers/gpu/nova-core/fb.rs
index 68559902ae78..27d9edab8347 100644
--- a/drivers/gpu/nova-core/fb.rs
+++ b/drivers/gpu/nova-core/fb.rs
@@ -3,6 +3,7 @@
 use core::ops::Range;
 
 use kernel::prelude::*;
+use kernel::ptr::{Alignable, Alignment};
 use kernel::sizes::*;
 use kernel::sync::aref::ARef;
 use kernel::{dev_warn, device};
@@ -130,10 +131,9 @@ pub(crate) fn new(chipset: Chipset, bar: &Bar0) -> Result<Self> {
         };
 
         let frts = {
-            const FRTS_DOWN_ALIGN: u64 = SZ_128K as u64;
+            const FRTS_DOWN_ALIGN: Alignment = Alignment::new::<SZ_128K>();
             const FRTS_SIZE: u64 = SZ_1M as u64;
-            // TODO[NUMM]: replace with `align_down` once it lands.
-            let frts_base = (vga_workspace.start & !(FRTS_DOWN_ALIGN - 1)) - FRTS_SIZE;
+            let frts_base = vga_workspace.start.align_down(FRTS_DOWN_ALIGN) - FRTS_SIZE;
 
             frts_base..frts_base + FRTS_SIZE
         };
diff --git a/drivers/gpu/nova-core/gpu.rs b/drivers/gpu/nova-core/gpu.rs
index 5da9ad726483..e422a346481e 100644
--- a/drivers/gpu/nova-core/gpu.rs
+++ b/drivers/gpu/nova-core/gpu.rs
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier: GPL-2.0
 
-use kernel::{device, devres::Devres, error::code::*, pci, prelude::*, sync::Arc};
+use kernel::{device, devres::Devres, error::code::*, fmt, pci, prelude::*, sync::Arc};
 
 use crate::driver::Bar0;
 use crate::falcon::{gsp::Gsp as GspFalcon, sec2::Sec2 as Sec2Falcon, Falcon};
@@ -8,7 +8,8 @@
 use crate::gfw;
 use crate::gsp::Gsp;
 use crate::regs;
-use core::fmt;
+use crate::util;
+use crate::vbios::Vbios;
 
 macro_rules! define_chipset {
     ({ $($variant:ident = $value:expr),* $(,)* }) =>
diff --git a/drivers/gpu/nova-core/vbios.rs b/drivers/gpu/nova-core/vbios.rs
index e6a060714205..71fbe71b84db 100644
--- a/drivers/gpu/nova-core/vbios.rs
+++ b/drivers/gpu/nova-core/vbios.rs
@@ -9,6 +9,7 @@
 use kernel::device;
 use kernel::error::Result;
 use kernel::prelude::*;
+use kernel::ptr::{Alignable, Alignment};
 use kernel::types::ARef;
 
 /// The offset of the VBIOS ROM in the BAR0 space.
@@ -174,8 +175,7 @@ fn next(&mut self) -> Option<Self::Item> {
 
         // Advance to next image (aligned to 512 bytes).
         self.current_offset += image_size;
-        // TODO[NUMM]: replace with `align_up` once it lands.
-        self.current_offset = self.current_offset.next_multiple_of(512);
+        self.current_offset = self.current_offset.align_up(Alignment::new::<512>())?;
 
         Some(Ok(full_image))
     }
diff --git a/drivers/hv/Kconfig b/drivers/hv/Kconfig
index 57623ca7f350..e24f6299c376 100644
--- a/drivers/hv/Kconfig
+++ b/drivers/hv/Kconfig
@@ -10,6 +10,7 @@ config HYPERV
 	select X86_HV_CALLBACK_VECTOR if X86
 	select OF_EARLY_FLATTREE if OF
 	select SYSFB if EFI && !HYPERV_VTL_MODE
+	select IRQ_MSI_LIB if X86
 	help
 	  Select this option to run Linux as a Hyper-V client operating
 	  system.
@@ -66,6 +67,7 @@ config MSHV_ROOT
 	# no particular order, making it impossible to reassemble larger pages
 	depends on PAGE_SIZE_4KB
 	select EVENTFD
+	select VIRT_XFER_TO_GUEST_WORK
 	default n
 	help
 	  Select this option to enable support for booting and running as root
diff --git a/drivers/hv/channel.c b/drivers/hv/channel.c
index 7c7c66e0dc3f..162d6aeece7b 100644
--- a/drivers/hv/channel.c
+++ b/drivers/hv/channel.c
@@ -925,7 +925,7 @@ static int vmbus_close_internal(struct vmbus_channel *channel)
 
 	/* Send a closing message */
 
-	msg = &channel->close_msg.msg;
+	msg = &channel->close_msg;
 
 	msg->header.msgtype = CHANNELMSG_CLOSECHANNEL;
 	msg->child_relid = channel->offermsg.child_relid;
diff --git a/drivers/hv/hv_common.c b/drivers/hv/hv_common.c
index 49898d10faff..e109a620c83f 100644
--- a/drivers/hv/hv_common.c
+++ b/drivers/hv/hv_common.c
@@ -257,7 +257,7 @@ static void hv_kmsg_dump_register(void)
 
 static inline bool hv_output_page_exists(void)
 {
-	return hv_root_partition() || IS_ENABLED(CONFIG_HYPERV_VTL_MODE);
+	return hv_parent_partition() || IS_ENABLED(CONFIG_HYPERV_VTL_MODE);
 }
 
 void __init hv_get_partition_id(void)
@@ -377,7 +377,7 @@ int __init hv_common_init(void)
 		BUG_ON(!hyperv_pcpu_output_arg);
 	}
 
-	if (hv_root_partition()) {
+	if (hv_parent_partition()) {
 		hv_synic_eventring_tail = alloc_percpu(u8 *);
 		BUG_ON(!hv_synic_eventring_tail);
 	}
@@ -531,7 +531,7 @@ int hv_common_cpu_init(unsigned int cpu)
 	if (msr_vp_index > hv_max_vp_index)
 		hv_max_vp_index = msr_vp_index;
 
-	if (hv_root_partition()) {
+	if (hv_parent_partition()) {
 		synic_eventring_tail = (u8 **)this_cpu_ptr(hv_synic_eventring_tail);
 		*synic_eventring_tail = kcalloc(HV_SYNIC_SINT_COUNT,
 						sizeof(u8), flags);
@@ -558,7 +558,7 @@ int hv_common_cpu_die(unsigned int cpu)
 	 * originally allocated memory is reused in hv_common_cpu_init().
 	 */
 
-	if (hv_root_partition()) {
+	if (hv_parent_partition()) {
 		synic_eventring_tail = this_cpu_ptr(hv_synic_eventring_tail);
 		kfree(*synic_eventring_tail);
 		*synic_eventring_tail = NULL;
@@ -729,13 +729,17 @@ void hv_identify_partition_type(void)
 	 * the root partition setting if also a Confidential VM.
 	 */
 	if ((ms_hyperv.priv_high & HV_CREATE_PARTITIONS) &&
-	    (ms_hyperv.priv_high & HV_CPU_MANAGEMENT) &&
 	    !(ms_hyperv.priv_high & HV_ISOLATION)) {
-		pr_info("Hyper-V: running as root partition\n");
-		if (IS_ENABLED(CONFIG_MSHV_ROOT))
-			hv_curr_partition_type = HV_PARTITION_TYPE_ROOT;
-		else
+
+		if (!IS_ENABLED(CONFIG_MSHV_ROOT)) {
 			pr_crit("Hyper-V: CONFIG_MSHV_ROOT not enabled!\n");
+		} else if (ms_hyperv.priv_high & HV_CPU_MANAGEMENT) {
+			pr_info("Hyper-V: running as root partition\n");
+			hv_curr_partition_type = HV_PARTITION_TYPE_ROOT;
+		} else {
+			pr_info("Hyper-V: running as L1VH partition\n");
+			hv_curr_partition_type = HV_PARTITION_TYPE_L1VH;
+		}
 	}
 }
 
diff --git a/drivers/hv/hv_utils_transport.c b/drivers/hv/hv_utils_transport.c
index 832885198643..b3de35ff6334 100644
--- a/drivers/hv/hv_utils_transport.c
+++ b/drivers/hv/hv_utils_transport.c
@@ -129,8 +129,7 @@ static int hvt_op_open(struct inode *inode, struct file *file)
 		 * device gets released.
 		 */
 		hvt->mode = HVUTIL_TRANSPORT_CHARDEV;
-	}
-	else if (hvt->mode == HVUTIL_TRANSPORT_NETLINK) {
+	} else if (hvt->mode == HVUTIL_TRANSPORT_NETLINK) {
 		/*
 		 * We're switching from netlink communication to using char
 		 * device. Issue the reset first.
@@ -195,7 +194,7 @@ static void hvt_cn_callback(struct cn_msg *msg, struct netlink_skb_parms *nsp)
 	}
 	spin_unlock(&hvt_list_lock);
 	if (!hvt_found) {
-		pr_warn("hvt_cn_callback: spurious message received!\n");
+		pr_warn("%s: spurious message received!\n", __func__);
 		return;
 	}
 
@@ -210,7 +209,7 @@ static void hvt_cn_callback(struct cn_msg *msg, struct netlink_skb_parms *nsp)
 	if (hvt->mode == HVUTIL_TRANSPORT_NETLINK)
 		hvt_found->on_msg(msg->data, msg->len);
 	else
-		pr_warn("hvt_cn_callback: unexpected netlink message!\n");
+		pr_warn("%s: unexpected netlink message!\n", __func__);
 	mutex_unlock(&hvt->lock);
 }
 
@@ -260,8 +259,9 @@ int hvutil_transport_send(struct hvutil_transport *hvt, void *msg, int len,
 		hvt->outmsg_len = len;
 		hvt->on_read = on_read_cb;
 		wake_up_interruptible(&hvt->outmsg_q);
-	} else
+	} else {
 		ret = -ENOMEM;
+	}
 out_unlock:
 	mutex_unlock(&hvt->lock);
 	return ret;
diff --git a/drivers/hv/mshv.h b/drivers/hv/mshv.h
index 0340a67acd0a..d4813df92b9c 100644
--- a/drivers/hv/mshv.h
+++ b/drivers/hv/mshv.h
@@ -25,6 +25,4 @@ int hv_call_set_vp_registers(u32 vp_index, u64 partition_id, u16 count,
 int hv_call_get_partition_property(u64 partition_id, u64 property_code,
 				   u64 *property_value);
 
-int mshv_do_pre_guest_mode_work(ulong th_flags);
-
 #endif /* _MSHV_H */
diff --git a/drivers/hv/mshv_common.c b/drivers/hv/mshv_common.c
index 6f227a8a5af7..aa2be51979fd 100644
--- a/drivers/hv/mshv_common.c
+++ b/drivers/hv/mshv_common.c
@@ -138,25 +138,3 @@ int hv_call_get_partition_property(u64 partition_id,
 	return 0;
 }
 EXPORT_SYMBOL_GPL(hv_call_get_partition_property);
-
-/*
- * Handle any pre-processing before going into the guest mode on this cpu, most
- * notably call schedule(). Must be invoked with both preemption and
- * interrupts enabled.
- *
- * Returns: 0 on success, -errno on error.
- */
-int mshv_do_pre_guest_mode_work(ulong th_flags)
-{
-	if (th_flags & (_TIF_SIGPENDING | _TIF_NOTIFY_SIGNAL))
-		return -EINTR;
-
-	if (th_flags & _TIF_NEED_RESCHED)
-		schedule();
-
-	if (th_flags & _TIF_NOTIFY_RESUME)
-		resume_user_mode_work(NULL);
-
-	return 0;
-}
-EXPORT_SYMBOL_GPL(mshv_do_pre_guest_mode_work);
diff --git a/drivers/hv/mshv_root_main.c b/drivers/hv/mshv_root_main.c
index 72df774e410a..e3b2bd417c46 100644
--- a/drivers/hv/mshv_root_main.c
+++ b/drivers/hv/mshv_root_main.c
@@ -8,6 +8,7 @@
  * Authors: Microsoft Linux virtualization team
  */
 
+#include <linux/entry-virt.h>
 #include <linux/kernel.h>
 #include <linux/module.h>
 #include <linux/fs.h>
@@ -37,12 +38,6 @@ MODULE_AUTHOR("Microsoft");
 MODULE_LICENSE("GPL");
 MODULE_DESCRIPTION("Microsoft Hyper-V root partition VMM interface /dev/mshv");
 
-/* TODO move this to mshyperv.h when needed outside driver */
-static inline bool hv_parent_partition(void)
-{
-	return hv_root_partition();
-}
-
 /* TODO move this to another file when debugfs code is added */
 enum hv_stats_vp_counters {			/* HV_THREAD_COUNTER */
 #if defined(CONFIG_X86)
@@ -487,28 +482,6 @@ mshv_vp_wait_for_hv_kick(struct mshv_vp *vp)
 	return 0;
 }
 
-static int mshv_pre_guest_mode_work(struct mshv_vp *vp)
-{
-	const ulong work_flags = _TIF_NOTIFY_SIGNAL | _TIF_SIGPENDING |
-				 _TIF_NEED_RESCHED  | _TIF_NOTIFY_RESUME;
-	ulong th_flags;
-
-	th_flags = read_thread_flags();
-	while (th_flags & work_flags) {
-		int ret;
-
-		/* nb: following will call schedule */
-		ret = mshv_do_pre_guest_mode_work(th_flags);
-
-		if (ret)
-			return ret;
-
-		th_flags = read_thread_flags();
-	}
-
-	return 0;
-}
-
 /* Must be called with interrupts enabled */
 static long mshv_run_vp_with_root_scheduler(struct mshv_vp *vp)
 {
@@ -529,9 +502,11 @@ static long mshv_run_vp_with_root_scheduler(struct mshv_vp *vp)
 		u32 flags = 0;
 		struct hv_output_dispatch_vp output;
 
-		ret = mshv_pre_guest_mode_work(vp);
-		if (ret)
-			break;
+		if (__xfer_to_guest_mode_work_pending()) {
+			ret = xfer_to_guest_mode_handle_work();
+			if (ret)
+				break;
+		}
 
 		if (vp->run.flags.intercept_suspend)
 			flags |= HV_DISPATCH_VP_FLAG_CLEAR_INTERCEPT_SUSPEND;
@@ -2074,9 +2049,13 @@ static int __init hv_retrieve_scheduler_type(enum hv_scheduler_type *out)
 /* Retrieve and stash the supported scheduler type */
 static int __init mshv_retrieve_scheduler_type(struct device *dev)
 {
-	int ret;
+	int ret = 0;
+
+	if (hv_l1vh_partition())
+		hv_scheduler_type = HV_SCHEDULER_TYPE_CORE_SMT;
+	else
+		ret = hv_retrieve_scheduler_type(&hv_scheduler_type);
 
-	ret = hv_retrieve_scheduler_type(&hv_scheduler_type);
 	if (ret)
 		return ret;
 
@@ -2203,9 +2182,6 @@ static int __init mshv_root_partition_init(struct device *dev)
 {
 	int err;
 
-	if (mshv_retrieve_scheduler_type(dev))
-		return -ENODEV;
-
 	err = root_scheduler_init(dev);
 	if (err)
 		return err;
@@ -2227,7 +2203,7 @@ static int __init mshv_parent_partition_init(void)
 	struct device *dev;
 	union hv_hypervisor_version_info version_info;
 
-	if (!hv_root_partition() || is_kdump_kernel())
+	if (!hv_parent_partition() || is_kdump_kernel())
 		return -ENODEV;
 
 	if (hv_get_hypervisor_version(&version_info))
@@ -2264,7 +2240,12 @@ static int __init mshv_parent_partition_init(void)
 
 	mshv_cpuhp_online = ret;
 
-	ret = mshv_root_partition_init(dev);
+	ret = mshv_retrieve_scheduler_type(dev);
+	if (ret)
+		goto remove_cpu_state;
+
+	if (hv_root_partition())
+		ret = mshv_root_partition_init(dev);
 	if (ret)
 		goto remove_cpu_state;
 
diff --git a/drivers/iommu/iommu-priv.h b/drivers/iommu/iommu-priv.h
index e236b932e766..c95394cd03a7 100644
--- a/drivers/iommu/iommu-priv.h
+++ b/drivers/iommu/iommu-priv.h
@@ -37,6 +37,8 @@ void iommu_device_unregister_bus(struct iommu_device *iommu,
 				 const struct bus_type *bus,
 				 struct notifier_block *nb);
 
+int iommu_mock_device_add(struct device *dev, struct iommu_device *iommu);
+
 struct iommu_attach_handle *iommu_attach_handle_get(struct iommu_group *group,
 						    ioasid_t pasid,
 						    unsigned int type);
diff --git a/drivers/iommu/iommu.c b/drivers/iommu/iommu.c
index 060ebe330ee1..ddf398d8bcf9 100644
--- a/drivers/iommu/iommu.c
+++ b/drivers/iommu/iommu.c
@@ -304,6 +304,7 @@ void iommu_device_unregister_bus(struct iommu_device *iommu,
 				 struct notifier_block *nb)
 {
 	bus_unregister_notifier(bus, nb);
+	fwnode_remove_software_node(iommu->fwnode);
 	iommu_device_unregister(iommu);
 }
 EXPORT_SYMBOL_GPL(iommu_device_unregister_bus);
@@ -326,6 +327,12 @@ int iommu_device_register_bus(struct iommu_device *iommu,
 	if (err)
 		return err;
 
+	iommu->fwnode = fwnode_create_software_node(NULL, NULL);
+	if (IS_ERR(iommu->fwnode)) {
+		bus_unregister_notifier(bus, nb);
+		return err;
+	}
+
 	spin_lock(&iommu_device_lock);
 	list_add_tail(&iommu->list, &iommu_device_list);
 	spin_unlock(&iommu_device_lock);
@@ -335,9 +342,28 @@ int iommu_device_register_bus(struct iommu_device *iommu,
 		iommu_device_unregister_bus(iommu, bus, nb);
 		return err;
 	}
+	WRITE_ONCE(iommu->ready, true);
 	return 0;
 }
 EXPORT_SYMBOL_GPL(iommu_device_register_bus);
+
+int iommu_mock_device_add(struct device *dev, struct iommu_device *iommu)
+{
+	int rc;
+
+	mutex_lock(&iommu_probe_device_lock);
+	rc = iommu_fwspec_init(dev, iommu->fwnode);
+	mutex_unlock(&iommu_probe_device_lock);
+
+	if (rc)
+		return rc;
+
+	rc = device_add(dev);
+	if (rc)
+		iommu_fwspec_free(dev);
+	return rc;
+}
+EXPORT_SYMBOL_GPL(iommu_mock_device_add);
 #endif
 
 static struct dev_iommu *dev_iommu_get(struct device *dev)
diff --git a/drivers/iommu/iommufd/selftest.c b/drivers/iommu/iommufd/selftest.c
index 61686603c769..de178827a078 100644
--- a/drivers/iommu/iommufd/selftest.c
+++ b/drivers/iommu/iommufd/selftest.c
@@ -1126,7 +1126,7 @@ static struct mock_dev *mock_dev_create(unsigned long dev_flags)
 		goto err_put;
 	}
 
-	rc = device_add(&mdev->dev);
+	rc = iommu_mock_device_add(&mdev->dev, &mock_iommu.iommu_dev);
 	if (rc)
 		goto err_put;
 	return mdev;
diff --git a/drivers/media/platform/synopsys/hdmirx/snps_hdmirx.h b/drivers/media/platform/synopsys/hdmirx/snps_hdmirx.h
index 220ab99ca611..b13f58e31944 100644
--- a/drivers/media/platform/synopsys/hdmirx/snps_hdmirx.h
+++ b/drivers/media/platform/synopsys/hdmirx/snps_hdmirx.h
@@ -8,10 +8,12 @@
 #ifndef DW_HDMIRX_H
 #define DW_HDMIRX_H
 
+#include <linux/bitfield.h>
 #include <linux/bitops.h>
+#include <linux/hw_bitfield.h>
 
-#define UPDATE(x, h, l)		(((x) << (l)) & GENMASK((h), (l)))
-#define HIWORD_UPDATE(v, h, l)	(((v) << (l)) | (GENMASK((h), (l)) << 16))
+#define UPDATE(x, h, l)		FIELD_PREP(GENMASK((h), (l)), (x))
+#define HIWORD_UPDATE(v, h, l)	FIELD_PREP_WM16(GENMASK((h), (l)), (v))
 
 /* SYS_GRF */
 #define SYS_GRF_SOC_CON1			0x0304
diff --git a/drivers/media/test-drivers/vivid/vivid-vid-cap.c b/drivers/media/test-drivers/vivid/vivid-vid-cap.c
index 8b3162e82032..b95f06a9b5ae 100644
--- a/drivers/media/test-drivers/vivid/vivid-vid-cap.c
+++ b/drivers/media/test-drivers/vivid/vivid-vid-cap.c
@@ -302,8 +302,10 @@ void vivid_update_quality(struct vivid_dev *dev)
 	 */
 	freq_modulus = (dev->tv_freq - 676 /* (43.25-1) * 16 */) % (6 * 16);
 	if (freq_modulus > 2 * 16) {
+		struct rnd_state prng;
+		prandom_seed_state(&prng, dev->tv_freq ^ 0x55);
 		tpg_s_quality(&dev->tpg, TPG_QUAL_NOISE,
-			next_pseudo_random32(dev->tv_freq ^ 0x55) & 0x3f);
+			prandom_u32_state(&prng) & 0x3f);
 		return;
 	}
 	if (freq_modulus < 12 /*0.75 * 16*/ || freq_modulus > 20 /*1.25 * 16*/)
diff --git a/drivers/misc/lkdtm/cfi.c b/drivers/misc/lkdtm/cfi.c
index 6a33889d0902..c3971f7caa65 100644
--- a/drivers/misc/lkdtm/cfi.c
+++ b/drivers/misc/lkdtm/cfi.c
@@ -43,7 +43,7 @@ static void lkdtm_CFI_FORWARD_PROTO(void)
 	lkdtm_indirect_call((void *)lkdtm_increment_int);
 
 	pr_err("FAIL: survived mismatched prototype function call!\n");
-	pr_expected_config(CONFIG_CFI_CLANG);
+	pr_expected_config(CONFIG_CFI);
 }
 
 /*
diff --git a/drivers/misc/lkdtm/fortify.c b/drivers/misc/lkdtm/fortify.c
index 015927665678..00ed2147113e 100644
--- a/drivers/misc/lkdtm/fortify.c
+++ b/drivers/misc/lkdtm/fortify.c
@@ -44,6 +44,9 @@ static void lkdtm_FORTIFY_STR_MEMBER(void)
 	char *src;
 
 	src = kmalloc(size, GFP_KERNEL);
+	if (!src)
+		return;
+
 	strscpy(src, "over ten bytes", size);
 	size = strlen(src) + 1;
 
@@ -109,6 +112,9 @@ static void lkdtm_FORTIFY_MEM_MEMBER(void)
 	char *src;
 
 	src = kmalloc(size, GFP_KERNEL);
+	if (!src)
+		return;
+
 	strscpy(src, "over ten bytes", size);
 	size = strlen(src) + 1;
 
diff --git a/drivers/mmc/host/dw_mmc-rockchip.c b/drivers/mmc/host/dw_mmc-rockchip.c
index d2aec6cf9773..82dd906bb002 100644
--- a/drivers/mmc/host/dw_mmc-rockchip.c
+++ b/drivers/mmc/host/dw_mmc-rockchip.c
@@ -6,6 +6,7 @@
 #include <linux/module.h>
 #include <linux/platform_device.h>
 #include <linux/clk.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mmc/host.h>
 #include <linux/of_address.h>
 #include <linux/mmc/slot-gpio.h>
@@ -24,8 +25,6 @@
 #define ROCKCHIP_MMC_DELAYNUM_OFFSET	2
 #define ROCKCHIP_MMC_DELAYNUM_MASK	(0xff << ROCKCHIP_MMC_DELAYNUM_OFFSET)
 #define ROCKCHIP_MMC_DELAY_ELEMENT_PSEC	60
-#define HIWORD_UPDATE(val, mask, shift) \
-		((val) << (shift) | (mask) << ((shift) + 16))
 
 static const unsigned int freqs[] = { 100000, 200000, 300000, 400000 };
 
@@ -148,9 +147,11 @@ static int rockchip_mmc_set_internal_phase(struct dw_mci *host, bool sample, int
 	raw_value |= nineties;
 
 	if (sample)
-		mci_writel(host, TIMING_CON1, HIWORD_UPDATE(raw_value, 0x07ff, 1));
+		mci_writel(host, TIMING_CON1,
+			   FIELD_PREP_WM16(GENMASK(11, 1), raw_value));
 	else
-		mci_writel(host, TIMING_CON0, HIWORD_UPDATE(raw_value, 0x07ff, 1));
+		mci_writel(host, TIMING_CON0,
+			   FIELD_PREP_WM16(GENMASK(11, 1), raw_value));
 
 	dev_dbg(host->dev, "set %s_phase(%d) delay_nums=%u actual_degrees=%d\n",
 		sample ? "sample" : "drv", degrees, delay_num,
diff --git a/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c b/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c
index 49f92cd79aa8..51ea0caf16c1 100644
--- a/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c
+++ b/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c
@@ -8,6 +8,7 @@
  */
 
 #include <linux/stmmac.h>
+#include <linux/hw_bitfield.h>
 #include <linux/bitops.h>
 #include <linux/clk.h>
 #include <linux/phy.h>
@@ -149,7 +150,7 @@ static int rk_set_clk_mac_speed(struct rk_priv_data *bsp_priv,
 }
 
 #define HIWORD_UPDATE(val, mask, shift) \
-		((val) << (shift) | (mask) << ((shift) + 16))
+		(FIELD_PREP_WM16((mask) << (shift), (val)))
 
 #define GRF_BIT(nr)	(BIT(nr) | BIT(nr+16))
 #define GRF_CLR_BIT(nr)	(BIT(nr+16))
diff --git a/drivers/ntb/hw/amd/ntb_hw_amd.c b/drivers/ntb/hw/amd/ntb_hw_amd.c
index 63ceed89b62e..1a163596ddf5 100644
--- a/drivers/ntb/hw/amd/ntb_hw_amd.c
+++ b/drivers/ntb/hw/amd/ntb_hw_amd.c
@@ -197,13 +197,22 @@ static int amd_ntb_mw_set_trans(struct ntb_dev *ntb, int pidx, int idx,
 
 static int amd_ntb_get_link_status(struct amd_ntb_dev *ndev)
 {
-	struct pci_dev *pdev = NULL;
+	struct pci_dev *pdev = ndev->ntb.pdev;
 	struct pci_dev *pci_swds = NULL;
 	struct pci_dev *pci_swus = NULL;
 	u32 stat;
 	int rc;
 
 	if (ndev->ntb.topo == NTB_TOPO_SEC) {
+		if (ndev->dev_data->is_endpoint) {
+			rc = pcie_capability_read_dword(pdev, PCI_EXP_LNKCTL, &stat);
+			if (rc)
+				return rc;
+
+			ndev->lnk_sta = stat;
+			return 0;
+		}
+
 		/* Locate the pointer to Downstream Switch for this device */
 		pci_swds = pci_upstream_bridge(ndev->ntb.pdev);
 		if (pci_swds) {
@@ -1311,6 +1320,11 @@ static const struct ntb_dev_data dev_data[] = {
 		.mw_count = 2,
 		.mw_idx = 2,
 	},
+	{ /* for device 0x17d7 */
+		.mw_count = 2,
+		.mw_idx = 2,
+		.is_endpoint = true,
+	},
 };
 
 static const struct pci_device_id amd_ntb_pci_tbl[] = {
@@ -1319,6 +1333,8 @@ static const struct pci_device_id amd_ntb_pci_tbl[] = {
 	{ PCI_VDEVICE(AMD, 0x14c0), (kernel_ulong_t)&dev_data[1] },
 	{ PCI_VDEVICE(AMD, 0x14c3), (kernel_ulong_t)&dev_data[1] },
 	{ PCI_VDEVICE(AMD, 0x155a), (kernel_ulong_t)&dev_data[1] },
+	{ PCI_VDEVICE(AMD, 0x17d4), (kernel_ulong_t)&dev_data[1] },
+	{ PCI_VDEVICE(AMD, 0x17d7), (kernel_ulong_t)&dev_data[2] },
 	{ PCI_VDEVICE(HYGON, 0x145b), (kernel_ulong_t)&dev_data[0] },
 	{ 0, }
 };
diff --git a/drivers/ntb/hw/amd/ntb_hw_amd.h b/drivers/ntb/hw/amd/ntb_hw_amd.h
index 5f337b1572a0..e8c3165fa38b 100644
--- a/drivers/ntb/hw/amd/ntb_hw_amd.h
+++ b/drivers/ntb/hw/amd/ntb_hw_amd.h
@@ -168,6 +168,7 @@ enum {
 struct ntb_dev_data {
 	const unsigned char mw_count;
 	const unsigned int mw_idx;
+	const bool is_endpoint;
 };
 
 struct amd_ntb_dev;
diff --git a/drivers/ntb/hw/epf/ntb_hw_epf.c b/drivers/ntb/hw/epf/ntb_hw_epf.c
index 00f0e78f685b..d3ecf25a5162 100644
--- a/drivers/ntb/hw/epf/ntb_hw_epf.c
+++ b/drivers/ntb/hw/epf/ntb_hw_epf.c
@@ -49,6 +49,7 @@
 #define NTB_EPF_COMMAND_TIMEOUT	1000 /* 1 Sec */
 
 enum pci_barno {
+	NO_BAR = -1,
 	BAR_0,
 	BAR_1,
 	BAR_2,
@@ -57,16 +58,26 @@ enum pci_barno {
 	BAR_5,
 };
 
+enum epf_ntb_bar {
+	BAR_CONFIG,
+	BAR_PEER_SPAD,
+	BAR_DB,
+	BAR_MW1,
+	BAR_MW2,
+	BAR_MW3,
+	BAR_MW4,
+	NTB_BAR_NUM,
+};
+
+#define NTB_EPF_MAX_MW_COUNT	(NTB_BAR_NUM - BAR_MW1)
+
 struct ntb_epf_dev {
 	struct ntb_dev ntb;
 	struct device *dev;
 	/* Mutex to protect providing commands to NTB EPF */
 	struct mutex cmd_lock;
 
-	enum pci_barno ctrl_reg_bar;
-	enum pci_barno peer_spad_reg_bar;
-	enum pci_barno db_reg_bar;
-	enum pci_barno mw_bar;
+	const enum pci_barno *barno_map;
 
 	unsigned int mw_count;
 	unsigned int spad_count;
@@ -85,17 +96,6 @@ struct ntb_epf_dev {
 
 #define ntb_ndev(__ntb) container_of(__ntb, struct ntb_epf_dev, ntb)
 
-struct ntb_epf_data {
-	/* BAR that contains both control region and self spad region */
-	enum pci_barno ctrl_reg_bar;
-	/* BAR that contains peer spad region */
-	enum pci_barno peer_spad_reg_bar;
-	/* BAR that contains Doorbell region and Memory window '1' */
-	enum pci_barno db_reg_bar;
-	/* BAR that contains memory windows*/
-	enum pci_barno mw_bar;
-};
-
 static int ntb_epf_send_command(struct ntb_epf_dev *ndev, u32 command,
 				u32 argument)
 {
@@ -144,7 +144,7 @@ static int ntb_epf_mw_to_bar(struct ntb_epf_dev *ndev, int idx)
 		return -EINVAL;
 	}
 
-	return idx + 2;
+	return ndev->barno_map[BAR_MW1 + idx];
 }
 
 static int ntb_epf_mw_count(struct ntb_dev *ntb, int pidx)
@@ -413,7 +413,9 @@ static int ntb_epf_mw_set_trans(struct ntb_dev *ntb, int pidx, int idx,
 		return -EINVAL;
 	}
 
-	bar = idx + ndev->mw_bar;
+	bar = ntb_epf_mw_to_bar(ndev, idx);
+	if (bar < 0)
+		return bar;
 
 	mw_size = pci_resource_len(ntb->pdev, bar);
 
@@ -455,7 +457,9 @@ static int ntb_epf_peer_mw_get_addr(struct ntb_dev *ntb, int idx,
 	if (idx == 0)
 		offset = readl(ndev->ctrl_reg + NTB_EPF_MW1_OFFSET);
 
-	bar = idx + ndev->mw_bar;
+	bar = ntb_epf_mw_to_bar(ndev, idx);
+	if (bar < 0)
+		return bar;
 
 	if (base)
 		*base = pci_resource_start(ndev->ntb.pdev, bar) + offset;
@@ -560,6 +564,11 @@ static int ntb_epf_init_dev(struct ntb_epf_dev *ndev)
 	ndev->mw_count = readl(ndev->ctrl_reg + NTB_EPF_MW_COUNT);
 	ndev->spad_count = readl(ndev->ctrl_reg + NTB_EPF_SPAD_COUNT);
 
+	if (ndev->mw_count > NTB_EPF_MAX_MW_COUNT) {
+		dev_err(dev, "Unsupported MW count: %u\n", ndev->mw_count);
+		return -EINVAL;
+	}
+
 	return 0;
 }
 
@@ -596,14 +605,15 @@ static int ntb_epf_init_pci(struct ntb_epf_dev *ndev,
 		dev_warn(&pdev->dev, "Cannot DMA highmem\n");
 	}
 
-	ndev->ctrl_reg = pci_iomap(pdev, ndev->ctrl_reg_bar, 0);
+	ndev->ctrl_reg = pci_iomap(pdev, ndev->barno_map[BAR_CONFIG], 0);
 	if (!ndev->ctrl_reg) {
 		ret = -EIO;
 		goto err_pci_regions;
 	}
 
-	if (ndev->peer_spad_reg_bar) {
-		ndev->peer_spad_reg = pci_iomap(pdev, ndev->peer_spad_reg_bar, 0);
+	if (ndev->barno_map[BAR_PEER_SPAD] != ndev->barno_map[BAR_CONFIG]) {
+		ndev->peer_spad_reg = pci_iomap(pdev,
+						ndev->barno_map[BAR_PEER_SPAD], 0);
 		if (!ndev->peer_spad_reg) {
 			ret = -EIO;
 			goto err_pci_regions;
@@ -614,7 +624,7 @@ static int ntb_epf_init_pci(struct ntb_epf_dev *ndev,
 		ndev->peer_spad_reg = ndev->ctrl_reg + spad_off  + spad_sz;
 	}
 
-	ndev->db_reg = pci_iomap(pdev, ndev->db_reg_bar, 0);
+	ndev->db_reg = pci_iomap(pdev, ndev->barno_map[BAR_DB], 0);
 	if (!ndev->db_reg) {
 		ret = -EIO;
 		goto err_pci_regions;
@@ -659,12 +669,7 @@ static void ntb_epf_cleanup_isr(struct ntb_epf_dev *ndev)
 static int ntb_epf_pci_probe(struct pci_dev *pdev,
 			     const struct pci_device_id *id)
 {
-	enum pci_barno peer_spad_reg_bar = BAR_1;
-	enum pci_barno ctrl_reg_bar = BAR_0;
-	enum pci_barno db_reg_bar = BAR_2;
-	enum pci_barno mw_bar = BAR_2;
 	struct device *dev = &pdev->dev;
-	struct ntb_epf_data *data;
 	struct ntb_epf_dev *ndev;
 	int ret;
 
@@ -675,18 +680,10 @@ static int ntb_epf_pci_probe(struct pci_dev *pdev,
 	if (!ndev)
 		return -ENOMEM;
 
-	data = (struct ntb_epf_data *)id->driver_data;
-	if (data) {
-		peer_spad_reg_bar = data->peer_spad_reg_bar;
-		ctrl_reg_bar = data->ctrl_reg_bar;
-		db_reg_bar = data->db_reg_bar;
-		mw_bar = data->mw_bar;
-	}
+	ndev->barno_map = (const enum pci_barno *)id->driver_data;
+	if (!ndev->barno_map)
+		return -EINVAL;
 
-	ndev->peer_spad_reg_bar = peer_spad_reg_bar;
-	ndev->ctrl_reg_bar = ctrl_reg_bar;
-	ndev->db_reg_bar = db_reg_bar;
-	ndev->mw_bar = mw_bar;
 	ndev->dev = dev;
 
 	ntb_epf_init_struct(ndev, pdev);
@@ -730,30 +727,51 @@ static void ntb_epf_pci_remove(struct pci_dev *pdev)
 	ntb_epf_deinit_pci(ndev);
 }
 
-static const struct ntb_epf_data j721e_data = {
-	.ctrl_reg_bar = BAR_0,
-	.peer_spad_reg_bar = BAR_1,
-	.db_reg_bar = BAR_2,
-	.mw_bar = BAR_2,
+static const enum pci_barno j721e_map[NTB_BAR_NUM] = {
+	[BAR_CONFIG]	= BAR_0,
+	[BAR_PEER_SPAD]	= BAR_1,
+	[BAR_DB]	= BAR_2,
+	[BAR_MW1]	= BAR_2,
+	[BAR_MW2]	= BAR_3,
+	[BAR_MW3]	= BAR_4,
+	[BAR_MW4]	= BAR_5
 };
 
-static const struct ntb_epf_data mx8_data = {
-	.ctrl_reg_bar = BAR_0,
-	.peer_spad_reg_bar = BAR_0,
-	.db_reg_bar = BAR_2,
-	.mw_bar = BAR_4,
+static const enum pci_barno mx8_map[NTB_BAR_NUM] = {
+	[BAR_CONFIG]	= BAR_0,
+	[BAR_PEER_SPAD]	= BAR_0,
+	[BAR_DB]	= BAR_2,
+	[BAR_MW1]	= BAR_4,
+	[BAR_MW2]	= BAR_5,
+	[BAR_MW3]	= NO_BAR,
+	[BAR_MW4]	= NO_BAR
+};
+
+static const enum pci_barno rcar_barno[NTB_BAR_NUM] = {
+	[BAR_CONFIG]	= BAR_0,
+	[BAR_PEER_SPAD]	= BAR_0,
+	[BAR_DB]	= BAR_4,
+	[BAR_MW1]	= BAR_2,
+	[BAR_MW2]	= NO_BAR,
+	[BAR_MW3]	= NO_BAR,
+	[BAR_MW4]	= NO_BAR,
 };
 
 static const struct pci_device_id ntb_epf_pci_tbl[] = {
 	{
 		PCI_DEVICE(PCI_VENDOR_ID_TI, PCI_DEVICE_ID_TI_J721E),
 		.class = PCI_CLASS_MEMORY_RAM << 8, .class_mask = 0xffff00,
-		.driver_data = (kernel_ulong_t)&j721e_data,
+		.driver_data = (kernel_ulong_t)j721e_map,
 	},
 	{
 		PCI_DEVICE(PCI_VENDOR_ID_FREESCALE, 0x0809),
 		.class = PCI_CLASS_MEMORY_RAM << 8, .class_mask = 0xffff00,
-		.driver_data = (kernel_ulong_t)&mx8_data,
+		.driver_data = (kernel_ulong_t)mx8_map,
+	},
+	{
+		PCI_DEVICE(PCI_VENDOR_ID_RENESAS, 0x0030),
+		.class = PCI_CLASS_MEMORY_RAM << 8, .class_mask = 0xffff00,
+		.driver_data = (kernel_ulong_t)rcar_barno,
 	},
 	{ },
 };
diff --git a/drivers/ntb/hw/mscc/ntb_hw_switchtec.c b/drivers/ntb/hw/mscc/ntb_hw_switchtec.c
index f851397b65d6..e38540b92716 100644
--- a/drivers/ntb/hw/mscc/ntb_hw_switchtec.c
+++ b/drivers/ntb/hw/mscc/ntb_hw_switchtec.c
@@ -29,7 +29,7 @@ MODULE_PARM_DESC(use_lut_mws,
 		 "Enable the use of the LUT based memory windows");
 
 #define SWITCHTEC_NTB_MAGIC 0x45CC0001
-#define MAX_MWS     128
+#define MAX_MWS     256
 
 struct shared_mw {
 	u32 magic;
@@ -1202,7 +1202,8 @@ static void switchtec_ntb_init_mw(struct switchtec_ntb *sndev)
 				       sndev->mmio_self_ctrl);
 
 	sndev->nr_lut_mw = ioread16(&sndev->mmio_self_ctrl->lut_table_entries);
-	sndev->nr_lut_mw = rounddown_pow_of_two(sndev->nr_lut_mw);
+	if (sndev->nr_lut_mw)
+		sndev->nr_lut_mw = rounddown_pow_of_two(sndev->nr_lut_mw);
 
 	dev_dbg(&sndev->stdev->dev, "MWs: %d direct, %d lut\n",
 		sndev->nr_direct_mw, sndev->nr_lut_mw);
@@ -1212,7 +1213,8 @@ static void switchtec_ntb_init_mw(struct switchtec_ntb *sndev)
 
 	sndev->peer_nr_lut_mw =
 		ioread16(&sndev->mmio_peer_ctrl->lut_table_entries);
-	sndev->peer_nr_lut_mw = rounddown_pow_of_two(sndev->peer_nr_lut_mw);
+	if (sndev->peer_nr_lut_mw)
+		sndev->peer_nr_lut_mw = rounddown_pow_of_two(sndev->peer_nr_lut_mw);
 
 	dev_dbg(&sndev->stdev->dev, "Peer MWs: %d direct, %d lut\n",
 		sndev->peer_nr_direct_mw, sndev->peer_nr_lut_mw);
@@ -1314,6 +1316,12 @@ static void switchtec_ntb_init_shared(struct switchtec_ntb *sndev)
 	for (i = 0; i < sndev->nr_lut_mw; i++) {
 		int idx = sndev->nr_direct_mw + i;
 
+		if (idx >= MAX_MWS) {
+			dev_err(&sndev->stdev->dev,
+				"Total number of MW cannot be bigger than %d", MAX_MWS);
+			break;
+		}
+
 		sndev->self_shared->mw_sizes[idx] = LUT_SIZE;
 	}
 }
diff --git a/drivers/ntb/msi.c b/drivers/ntb/msi.c
index 368f6d894bba..6817d504c12a 100644
--- a/drivers/ntb/msi.c
+++ b/drivers/ntb/msi.c
@@ -315,37 +315,6 @@ int ntbm_msi_request_threaded_irq(struct ntb_dev *ntb, irq_handler_t handler,
 }
 EXPORT_SYMBOL(ntbm_msi_request_threaded_irq);
 
-static int ntbm_msi_callback_match(struct device *dev, void *res, void *data)
-{
-	struct ntb_dev *ntb = dev_ntb(dev);
-	struct ntb_msi_devres *dr = res;
-
-	return dr->ntb == ntb && dr->entry == data;
-}
-
-/**
- * ntbm_msi_free_irq() - free an interrupt
- * @ntb:	NTB device context
- * @irq:	Interrupt line to free
- * @dev_id:	Device identity to free
- *
- * This function should be used to manually free IRQs allocated with
- * ntbm_request_[threaded_]irq().
- */
-void ntbm_msi_free_irq(struct ntb_dev *ntb, unsigned int irq, void *dev_id)
-{
-	struct msi_desc *entry = irq_get_msi_desc(irq);
-
-	entry->write_msi_msg = NULL;
-	entry->write_msi_msg_data = NULL;
-
-	WARN_ON(devres_destroy(&ntb->dev, ntbm_msi_callback_release,
-			       ntbm_msi_callback_match, entry));
-
-	devm_free_irq(&ntb->dev, irq, dev_id);
-}
-EXPORT_SYMBOL(ntbm_msi_free_irq);
-
 /**
  * ntb_msi_peer_trigger() - Trigger an interrupt handler on a peer
  * @ntb:	NTB device context
@@ -373,36 +342,3 @@ int ntb_msi_peer_trigger(struct ntb_dev *ntb, int peer,
 	return 0;
 }
 EXPORT_SYMBOL(ntb_msi_peer_trigger);
-
-/**
- * ntb_msi_peer_addr() - Get the DMA address to trigger a peer's MSI interrupt
- * @ntb:	NTB device context
- * @peer:	Peer index
- * @desc:	MSI descriptor data which triggers the interrupt
- * @msi_addr:   Physical address to trigger the interrupt
- *
- * This function allows using DMA engines to trigger an interrupt
- * (for example, trigger an interrupt to process the data after
- * sending it). To trigger the interrupt, write @desc.data to the address
- * returned in @msi_addr
- *
- * Return: Zero on success, otherwise a negative error number.
- */
-int ntb_msi_peer_addr(struct ntb_dev *ntb, int peer,
-		      struct ntb_msi_desc *desc,
-		      phys_addr_t *msi_addr)
-{
-	int peer_widx = ntb_peer_mw_count(ntb) - 1 - peer;
-	phys_addr_t mw_phys_addr;
-	int ret;
-
-	ret = ntb_peer_mw_get_addr(ntb, peer_widx, &mw_phys_addr, NULL);
-	if (ret)
-		return ret;
-
-	if (msi_addr)
-		*msi_addr = mw_phys_addr + desc->addr_offset;
-
-	return 0;
-}
-EXPORT_SYMBOL(ntb_msi_peer_addr);
diff --git a/drivers/ntb/ntb_transport.c b/drivers/ntb/ntb_transport.c
index 4f775c3e218f..eb875e3db2e3 100644
--- a/drivers/ntb/ntb_transport.c
+++ b/drivers/ntb/ntb_transport.c
@@ -59,6 +59,7 @@
 #include <linux/slab.h>
 #include <linux/types.h>
 #include <linux/uaccess.h>
+#include <linux/mutex.h>
 #include "linux/ntb.h"
 #include "linux/ntb_transport.h"
 
@@ -241,6 +242,9 @@ struct ntb_transport_ctx {
 	struct work_struct link_cleanup;
 
 	struct dentry *debugfs_node_dir;
+
+	/* Make sure workq of link event be executed serially */
+	struct mutex link_event_lock;
 };
 
 enum {
@@ -1024,6 +1028,7 @@ static void ntb_transport_link_cleanup_work(struct work_struct *work)
 	struct ntb_transport_ctx *nt =
 		container_of(work, struct ntb_transport_ctx, link_cleanup);
 
+	guard(mutex)(&nt->link_event_lock);
 	ntb_transport_link_cleanup(nt);
 }
 
@@ -1047,6 +1052,8 @@ static void ntb_transport_link_work(struct work_struct *work)
 	u32 val;
 	int rc = 0, i, spad;
 
+	guard(mutex)(&nt->link_event_lock);
+
 	/* send the local info, in the opposite order of the way we read it */
 
 	if (nt->use_msi) {
diff --git a/drivers/pci/controller/dwc/pcie-dw-rockchip.c b/drivers/pci/controller/dwc/pcie-dw-rockchip.c
index c045353fa493..3e2752c7dd09 100644
--- a/drivers/pci/controller/dwc/pcie-dw-rockchip.c
+++ b/drivers/pci/controller/dwc/pcie-dw-rockchip.c
@@ -11,6 +11,7 @@
 #include <linux/bitfield.h>
 #include <linux/clk.h>
 #include <linux/gpio/consumer.h>
+#include <linux/hw_bitfield.h>
 #include <linux/irqchip/chained_irq.h>
 #include <linux/irqdomain.h>
 #include <linux/mfd/syscon.h>
@@ -29,18 +30,18 @@
  * The upper 16 bits of PCIE_CLIENT_CONFIG are a write
  * mask for the lower 16 bits.
  */
-#define HIWORD_UPDATE(mask, val) (((mask) << 16) | (val))
-#define HIWORD_UPDATE_BIT(val)	HIWORD_UPDATE(val, val)
-#define HIWORD_DISABLE_BIT(val)	HIWORD_UPDATE(val, ~val)
 
 #define to_rockchip_pcie(x) dev_get_drvdata((x)->dev)
 
 /* General Control Register */
 #define PCIE_CLIENT_GENERAL_CON		0x0
-#define  PCIE_CLIENT_RC_MODE		HIWORD_UPDATE_BIT(0x40)
-#define  PCIE_CLIENT_EP_MODE		HIWORD_UPDATE(0xf0, 0x0)
-#define  PCIE_CLIENT_ENABLE_LTSSM	HIWORD_UPDATE_BIT(0xc)
-#define  PCIE_CLIENT_DISABLE_LTSSM	HIWORD_UPDATE(0x0c, 0x8)
+#define  PCIE_CLIENT_MODE_MASK		GENMASK(7, 4)
+#define  PCIE_CLIENT_MODE_EP		0x0UL
+#define  PCIE_CLIENT_MODE_RC		0x4UL
+#define  PCIE_CLIENT_SET_MODE(x)	FIELD_PREP_WM16(PCIE_CLIENT_MODE_MASK, (x))
+#define  PCIE_CLIENT_LD_RQ_RST_GRT	FIELD_PREP_WM16(BIT(3), 1)
+#define  PCIE_CLIENT_ENABLE_LTSSM	FIELD_PREP_WM16(BIT(2), 1)
+#define  PCIE_CLIENT_DISABLE_LTSSM	FIELD_PREP_WM16(BIT(2), 0)
 
 /* Interrupt Status Register Related to Legacy Interrupt */
 #define PCIE_CLIENT_INTR_STATUS_LEGACY	0x8
@@ -52,6 +53,11 @@
 
 /* Interrupt Mask Register Related to Legacy Interrupt */
 #define PCIE_CLIENT_INTR_MASK_LEGACY	0x1c
+#define  PCIE_INTR_MASK			GENMASK(7, 0)
+#define  PCIE_INTR_CLAMP(_x)		((BIT((_x)) & PCIE_INTR_MASK))
+#define  PCIE_INTR_LEGACY_MASK(x)	(PCIE_INTR_CLAMP((x)) | \
+					 (PCIE_INTR_CLAMP((x)) << 16))
+#define  PCIE_INTR_LEGACY_UNMASK(x)	(PCIE_INTR_CLAMP((x)) << 16)
 
 /* Interrupt Mask Register Related to Miscellaneous Operation */
 #define PCIE_CLIENT_INTR_MASK_MISC	0x24
@@ -116,14 +122,14 @@ static void rockchip_pcie_intx_handler(struct irq_desc *desc)
 static void rockchip_intx_mask(struct irq_data *data)
 {
 	rockchip_pcie_writel_apb(irq_data_get_irq_chip_data(data),
-				 HIWORD_UPDATE_BIT(BIT(data->hwirq)),
+				 PCIE_INTR_LEGACY_MASK(data->hwirq),
 				 PCIE_CLIENT_INTR_MASK_LEGACY);
 };
 
 static void rockchip_intx_unmask(struct irq_data *data)
 {
 	rockchip_pcie_writel_apb(irq_data_get_irq_chip_data(data),
-				 HIWORD_DISABLE_BIT(BIT(data->hwirq)),
+				 PCIE_INTR_LEGACY_UNMASK(data->hwirq),
 				 PCIE_CLIENT_INTR_MASK_LEGACY);
 };
 
@@ -487,7 +493,7 @@ static irqreturn_t rockchip_pcie_ep_sys_irq_thread(int irq, void *arg)
 		dev_dbg(dev, "hot reset or link-down reset\n");
 		dw_pcie_ep_linkdown(&pci->ep);
 		/* Stop delaying link training. */
-		val = HIWORD_UPDATE_BIT(PCIE_LTSSM_APP_DLY2_DONE);
+		val = FIELD_PREP_WM16(PCIE_LTSSM_APP_DLY2_DONE, 1);
 		rockchip_pcie_writel_apb(rockchip, val,
 					 PCIE_CLIENT_HOT_RESET_CTRL);
 	}
@@ -526,10 +532,11 @@ static int rockchip_pcie_configure_rc(struct platform_device *pdev,
 	}
 
 	/* LTSSM enable control mode */
-	val = HIWORD_UPDATE_BIT(PCIE_LTSSM_ENABLE_ENHANCE);
+	val = FIELD_PREP_WM16(PCIE_LTSSM_ENABLE_ENHANCE, 1);
 	rockchip_pcie_writel_apb(rockchip, val, PCIE_CLIENT_HOT_RESET_CTRL);
 
-	rockchip_pcie_writel_apb(rockchip, PCIE_CLIENT_RC_MODE,
+	rockchip_pcie_writel_apb(rockchip,
+				 PCIE_CLIENT_SET_MODE(PCIE_CLIENT_MODE_RC),
 				 PCIE_CLIENT_GENERAL_CON);
 
 	pp = &rockchip->pci.pp;
@@ -543,7 +550,7 @@ static int rockchip_pcie_configure_rc(struct platform_device *pdev,
 	}
 
 	/* unmask DLL up/down indicator */
-	val = HIWORD_UPDATE(PCIE_RDLH_LINK_UP_CHGED, 0);
+	val = FIELD_PREP_WM16(PCIE_RDLH_LINK_UP_CHGED, 0);
 	rockchip_pcie_writel_apb(rockchip, val, PCIE_CLIENT_INTR_MASK_MISC);
 
 	return ret;
@@ -575,10 +582,12 @@ static int rockchip_pcie_configure_ep(struct platform_device *pdev,
 	 * LTSSM enable control mode, and automatically delay link training on
 	 * hot reset/link-down reset.
 	 */
-	val = HIWORD_UPDATE_BIT(PCIE_LTSSM_ENABLE_ENHANCE | PCIE_LTSSM_APP_DLY2_EN);
+	val = FIELD_PREP_WM16(PCIE_LTSSM_ENABLE_ENHANCE, 1) |
+	      FIELD_PREP_WM16(PCIE_LTSSM_APP_DLY2_EN, 1);
 	rockchip_pcie_writel_apb(rockchip, val, PCIE_CLIENT_HOT_RESET_CTRL);
 
-	rockchip_pcie_writel_apb(rockchip, PCIE_CLIENT_EP_MODE,
+	rockchip_pcie_writel_apb(rockchip,
+				 PCIE_CLIENT_SET_MODE(PCIE_CLIENT_MODE_EP),
 				 PCIE_CLIENT_GENERAL_CON);
 
 	rockchip->pci.ep.ops = &rockchip_pcie_ep_ops;
@@ -602,7 +611,8 @@ static int rockchip_pcie_configure_ep(struct platform_device *pdev,
 	pci_epc_init_notify(rockchip->pci.ep.epc);
 
 	/* unmask DLL up/down indicator and hot reset/link-down reset */
-	val = HIWORD_UPDATE(PCIE_RDLH_LINK_UP_CHGED | PCIE_LINK_REQ_RST_NOT_INT, 0);
+	val = FIELD_PREP_WM16(PCIE_RDLH_LINK_UP_CHGED, 0) |
+	      FIELD_PREP_WM16(PCIE_LINK_REQ_RST_NOT_INT, 0);
 	rockchip_pcie_writel_apb(rockchip, val, PCIE_CLIENT_INTR_MASK_MISC);
 
 	return ret;
diff --git a/drivers/pci/controller/pcie-rockchip.h b/drivers/pci/controller/pcie-rockchip.h
index 72a2c045f6fe..3e82a69b9c00 100644
--- a/drivers/pci/controller/pcie-rockchip.h
+++ b/drivers/pci/controller/pcie-rockchip.h
@@ -12,6 +12,7 @@
 #define _PCIE_ROCKCHIP_H
 
 #include <linux/clk.h>
+#include <linux/hw_bitfield.h>
 #include <linux/kernel.h>
 #include <linux/pci.h>
 #include <linux/pci-ecam.h>
@@ -21,10 +22,10 @@
  * The upper 16 bits of PCIE_CLIENT_CONFIG are a write mask for the lower 16
  * bits.  This allows atomic updates of the register without locking.
  */
-#define HIWORD_UPDATE(mask, val)	(((mask) << 16) | (val))
-#define HIWORD_UPDATE_BIT(val)		HIWORD_UPDATE(val, val)
+#define HWORD_SET_BIT(val)		(FIELD_PREP_WM16_CONST((val), 1))
+#define HWORD_CLR_BIT(val)		(FIELD_PREP_WM16_CONST((val), 0))
 
-#define ENCODE_LANES(x)			((((x) >> 1) & 3) << 4)
+#define ENCODE_LANES(x)			((((x) >> 1) & 3))
 #define MAX_LANE_NUM			4
 #define MAX_REGION_LIMIT		32
 #define MIN_EP_APERTURE			28
@@ -32,21 +33,21 @@
 
 #define PCIE_CLIENT_BASE		0x0
 #define PCIE_CLIENT_CONFIG		(PCIE_CLIENT_BASE + 0x00)
-#define   PCIE_CLIENT_CONF_ENABLE	  HIWORD_UPDATE_BIT(0x0001)
-#define   PCIE_CLIENT_CONF_DISABLE       HIWORD_UPDATE(0x0001, 0)
-#define   PCIE_CLIENT_LINK_TRAIN_ENABLE	  HIWORD_UPDATE_BIT(0x0002)
-#define   PCIE_CLIENT_LINK_TRAIN_DISABLE  HIWORD_UPDATE(0x0002, 0)
-#define   PCIE_CLIENT_ARI_ENABLE	  HIWORD_UPDATE_BIT(0x0008)
-#define   PCIE_CLIENT_CONF_LANE_NUM(x)	  HIWORD_UPDATE(0x0030, ENCODE_LANES(x))
-#define   PCIE_CLIENT_MODE_RC		  HIWORD_UPDATE_BIT(0x0040)
-#define   PCIE_CLIENT_MODE_EP            HIWORD_UPDATE(0x0040, 0)
-#define   PCIE_CLIENT_GEN_SEL_1		  HIWORD_UPDATE(0x0080, 0)
-#define   PCIE_CLIENT_GEN_SEL_2		  HIWORD_UPDATE_BIT(0x0080)
+#define   PCIE_CLIENT_CONF_ENABLE		HWORD_SET_BIT(0x0001)
+#define   PCIE_CLIENT_CONF_DISABLE		HWORD_CLR_BIT(0x0001)
+#define   PCIE_CLIENT_LINK_TRAIN_ENABLE		HWORD_SET_BIT(0x0002)
+#define   PCIE_CLIENT_LINK_TRAIN_DISABLE	HWORD_CLR_BIT(0x0002)
+#define   PCIE_CLIENT_ARI_ENABLE		HWORD_SET_BIT(0x0008)
+#define   PCIE_CLIENT_CONF_LANE_NUM(x)		FIELD_PREP_WM16(0x0030, ENCODE_LANES(x))
+#define   PCIE_CLIENT_MODE_RC			HWORD_SET_BIT(0x0040)
+#define   PCIE_CLIENT_MODE_EP			HWORD_CLR_BIT(0x0040)
+#define   PCIE_CLIENT_GEN_SEL_1			HWORD_CLR_BIT(0x0080)
+#define   PCIE_CLIENT_GEN_SEL_2			HWORD_SET_BIT(0x0080)
 #define PCIE_CLIENT_LEGACY_INT_CTRL	(PCIE_CLIENT_BASE + 0x0c)
-#define   PCIE_CLIENT_INT_IN_ASSERT		HIWORD_UPDATE_BIT(0x0002)
-#define   PCIE_CLIENT_INT_IN_DEASSERT		HIWORD_UPDATE(0x0002, 0)
-#define   PCIE_CLIENT_INT_PEND_ST_PEND		HIWORD_UPDATE_BIT(0x0001)
-#define   PCIE_CLIENT_INT_PEND_ST_NORMAL	HIWORD_UPDATE(0x0001, 0)
+#define   PCIE_CLIENT_INT_IN_ASSERT		HWORD_SET_BIT(0x0002)
+#define   PCIE_CLIENT_INT_IN_DEASSERT		HWORD_CLR_BIT(0x0002)
+#define   PCIE_CLIENT_INT_PEND_ST_PEND		HWORD_SET_BIT(0x0001)
+#define   PCIE_CLIENT_INT_PEND_ST_NORMAL	HWORD_CLR_BIT(0x0001)
 #define PCIE_CLIENT_SIDE_BAND_STATUS	(PCIE_CLIENT_BASE + 0x20)
 #define   PCIE_CLIENT_PHY_ST			BIT(12)
 #define PCIE_CLIENT_DEBUG_OUT_0		(PCIE_CLIENT_BASE + 0x3c)
diff --git a/drivers/pci/pci.c b/drivers/pci/pci.c
index f518cfa266b5..b14dd064006c 100644
--- a/drivers/pci/pci.c
+++ b/drivers/pci/pci.c
@@ -5881,6 +5881,7 @@ int pcie_set_readrq(struct pci_dev *dev, int rq)
 {
 	u16 v;
 	int ret;
+	unsigned int firstbit;
 	struct pci_host_bridge *bridge = pci_find_host_bridge(dev->bus);
 
 	if (rq < 128 || rq > 4096 || !is_power_of_2(rq))
@@ -5898,7 +5899,10 @@ int pcie_set_readrq(struct pci_dev *dev, int rq)
 			rq = mps;
 	}
 
-	v = FIELD_PREP(PCI_EXP_DEVCTL_READRQ, ffs(rq) - 8);
+	firstbit = ffs(rq);
+	if (firstbit < 8)
+		return -EINVAL;
+	v = FIELD_PREP(PCI_EXP_DEVCTL_READRQ, firstbit - 8);
 
 	if (bridge->no_inc_mrrs) {
 		int max_mrrs = pcie_get_readrq(dev);
diff --git a/drivers/phy/rockchip/phy-rockchip-emmc.c b/drivers/phy/rockchip/phy-rockchip-emmc.c
index 20023f6eb994..5187983c58e5 100644
--- a/drivers/phy/rockchip/phy-rockchip-emmc.c
+++ b/drivers/phy/rockchip/phy-rockchip-emmc.c
@@ -8,6 +8,7 @@
 
 #include <linux/clk.h>
 #include <linux/delay.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mfd/syscon.h>
 #include <linux/module.h>
 #include <linux/of.h>
@@ -21,7 +22,7 @@
  * only if BIT(x + 16) set to 1 the BIT(x) can be written.
  */
 #define HIWORD_UPDATE(val, mask, shift) \
-		((val) << (shift) | (mask) << ((shift) + 16))
+		(FIELD_PREP_WM16((mask) << (shift), (val)))
 
 /* Register definition */
 #define GRF_EMMCPHY_CON0		0x0
diff --git a/drivers/phy/rockchip/phy-rockchip-pcie.c b/drivers/phy/rockchip/phy-rockchip-pcie.c
index 4e2dfd01adf2..126306c01454 100644
--- a/drivers/phy/rockchip/phy-rockchip-pcie.c
+++ b/drivers/phy/rockchip/phy-rockchip-pcie.c
@@ -8,6 +8,7 @@
 
 #include <linux/clk.h>
 #include <linux/delay.h>
+#include <linux/hw_bitfield.h>
 #include <linux/io.h>
 #include <linux/mfd/syscon.h>
 #include <linux/module.h>
@@ -18,22 +19,13 @@
 #include <linux/regmap.h>
 #include <linux/reset.h>
 
-/*
- * The higher 16-bit of this register is used for write protection
- * only if BIT(x + 16) set to 1 the BIT(x) can be written.
- */
-#define HIWORD_UPDATE(val, mask, shift) \
-		((val) << (shift) | (mask) << ((shift) + 16))
 
 #define PHY_MAX_LANE_NUM      4
-#define PHY_CFG_DATA_SHIFT    7
-#define PHY_CFG_ADDR_SHIFT    1
-#define PHY_CFG_DATA_MASK     0xf
-#define PHY_CFG_ADDR_MASK     0x3f
+#define PHY_CFG_DATA_MASK     GENMASK(10, 7)
+#define PHY_CFG_ADDR_MASK     GENMASK(6, 1)
 #define PHY_CFG_WR_ENABLE     1
 #define PHY_CFG_WR_DISABLE    0
-#define PHY_CFG_WR_SHIFT      0
-#define PHY_CFG_WR_MASK       1
+#define PHY_CFG_WR_MASK       BIT(0)
 #define PHY_CFG_PLL_LOCK      0x10
 #define PHY_CFG_CLK_TEST      0x10
 #define PHY_CFG_CLK_SCC       0x12
@@ -48,11 +40,7 @@
 #define PHY_LANE_RX_DET_SHIFT 11
 #define PHY_LANE_RX_DET_TH    0x1
 #define PHY_LANE_IDLE_OFF     0x1
-#define PHY_LANE_IDLE_MASK    0x1
-#define PHY_LANE_IDLE_A_SHIFT 3
-#define PHY_LANE_IDLE_B_SHIFT 4
-#define PHY_LANE_IDLE_C_SHIFT 5
-#define PHY_LANE_IDLE_D_SHIFT 6
+#define PHY_LANE_IDLE_MASK    BIT(3)
 
 struct rockchip_pcie_data {
 	unsigned int pcie_conf;
@@ -99,22 +87,14 @@ static inline void phy_wr_cfg(struct rockchip_pcie_phy *rk_phy,
 			      u32 addr, u32 data)
 {
 	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_conf,
-		     HIWORD_UPDATE(data,
-				   PHY_CFG_DATA_MASK,
-				   PHY_CFG_DATA_SHIFT) |
-		     HIWORD_UPDATE(addr,
-				   PHY_CFG_ADDR_MASK,
-				   PHY_CFG_ADDR_SHIFT));
+		     FIELD_PREP_WM16(PHY_CFG_DATA_MASK, data) |
+		     FIELD_PREP_WM16(PHY_CFG_ADDR_MASK, addr));
 	udelay(1);
 	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_conf,
-		     HIWORD_UPDATE(PHY_CFG_WR_ENABLE,
-				   PHY_CFG_WR_MASK,
-				   PHY_CFG_WR_SHIFT));
+		     FIELD_PREP_WM16(PHY_CFG_WR_MASK, PHY_CFG_WR_ENABLE));
 	udelay(1);
 	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_conf,
-		     HIWORD_UPDATE(PHY_CFG_WR_DISABLE,
-				   PHY_CFG_WR_MASK,
-				   PHY_CFG_WR_SHIFT));
+		     FIELD_PREP_WM16(PHY_CFG_WR_MASK, PHY_CFG_WR_DISABLE));
 }
 
 static int rockchip_pcie_phy_power_off(struct phy *phy)
@@ -125,11 +105,9 @@ static int rockchip_pcie_phy_power_off(struct phy *phy)
 
 	guard(mutex)(&rk_phy->pcie_mutex);
 
-	regmap_write(rk_phy->reg_base,
-		     rk_phy->phy_data->pcie_laneoff,
-		     HIWORD_UPDATE(PHY_LANE_IDLE_OFF,
-				   PHY_LANE_IDLE_MASK,
-				   PHY_LANE_IDLE_A_SHIFT + inst->index));
+	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_laneoff,
+		     FIELD_PREP_WM16(PHY_LANE_IDLE_MASK,
+				     PHY_LANE_IDLE_OFF) << inst->index);
 
 	if (--rk_phy->pwr_cnt) {
 		return 0;
@@ -139,11 +117,9 @@ static int rockchip_pcie_phy_power_off(struct phy *phy)
 	if (err) {
 		dev_err(&phy->dev, "assert phy_rst err %d\n", err);
 		rk_phy->pwr_cnt++;
-		regmap_write(rk_phy->reg_base,
-			     rk_phy->phy_data->pcie_laneoff,
-			     HIWORD_UPDATE(!PHY_LANE_IDLE_OFF,
-					   PHY_LANE_IDLE_MASK,
-					   PHY_LANE_IDLE_A_SHIFT + inst->index));
+		regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_laneoff,
+			     FIELD_PREP_WM16(PHY_LANE_IDLE_MASK,
+					     !PHY_LANE_IDLE_OFF) << inst->index);
 		return err;
 	}
 
@@ -159,11 +135,9 @@ static int rockchip_pcie_phy_power_on(struct phy *phy)
 
 	guard(mutex)(&rk_phy->pcie_mutex);
 
-	regmap_write(rk_phy->reg_base,
-		     rk_phy->phy_data->pcie_laneoff,
-		     HIWORD_UPDATE(!PHY_LANE_IDLE_OFF,
-				   PHY_LANE_IDLE_MASK,
-				   PHY_LANE_IDLE_A_SHIFT + inst->index));
+	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_laneoff,
+		     FIELD_PREP_WM16(PHY_LANE_IDLE_MASK,
+				     !PHY_LANE_IDLE_OFF) << inst->index);
 
 	if (rk_phy->pwr_cnt++) {
 		return 0;
@@ -177,9 +151,7 @@ static int rockchip_pcie_phy_power_on(struct phy *phy)
 	}
 
 	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_conf,
-		     HIWORD_UPDATE(PHY_CFG_PLL_LOCK,
-				   PHY_CFG_ADDR_MASK,
-				   PHY_CFG_ADDR_SHIFT));
+		     FIELD_PREP_WM16(PHY_CFG_ADDR_MASK, PHY_CFG_PLL_LOCK));
 
 	/*
 	 * No documented timeout value for phy operation below,
@@ -210,9 +182,7 @@ static int rockchip_pcie_phy_power_on(struct phy *phy)
 	}
 
 	regmap_write(rk_phy->reg_base, rk_phy->phy_data->pcie_conf,
-		     HIWORD_UPDATE(PHY_CFG_PLL_LOCK,
-				   PHY_CFG_ADDR_MASK,
-				   PHY_CFG_ADDR_SHIFT));
+		     FIELD_PREP_WM16(PHY_CFG_ADDR_MASK, PHY_CFG_PLL_LOCK));
 
 	err = regmap_read_poll_timeout(rk_phy->reg_base,
 				       rk_phy->phy_data->pcie_status,
diff --git a/drivers/phy/rockchip/phy-rockchip-samsung-dcphy.c b/drivers/phy/rockchip/phy-rockchip-samsung-dcphy.c
index 28a052e17366..4508a3147272 100644
--- a/drivers/phy/rockchip/phy-rockchip-samsung-dcphy.c
+++ b/drivers/phy/rockchip/phy-rockchip-samsung-dcphy.c
@@ -8,6 +8,7 @@
 #include <dt-bindings/phy/phy.h>
 #include <linux/bitfield.h>
 #include <linux/clk.h>
+#include <linux/hw_bitfield.h>
 #include <linux/init.h>
 #include <linux/kernel.h>
 #include <linux/mfd/syscon.h>
@@ -20,12 +21,6 @@
 #include <linux/regmap.h>
 #include <linux/reset.h>
 
-#define FIELD_PREP_HIWORD(_mask, _val)		\
-	(					\
-		FIELD_PREP((_mask), (_val)) |	\
-		((_mask) << 16)			\
-	)
-
 #define BIAS_CON0		0x0000
 #define I_RES_CNTL_MASK		GENMASK(6, 4)
 #define I_RES_CNTL(x)		FIELD_PREP(I_RES_CNTL_MASK, x)
@@ -252,8 +247,8 @@
 
 /* MIPI_CDPHY_GRF registers */
 #define MIPI_DCPHY_GRF_CON0		0x0000
-#define S_CPHY_MODE			FIELD_PREP_HIWORD(BIT(3), 1)
-#define M_CPHY_MODE			FIELD_PREP_HIWORD(BIT(0), 1)
+#define S_CPHY_MODE			FIELD_PREP_WM16(BIT(3), 1)
+#define M_CPHY_MODE			FIELD_PREP_WM16(BIT(0), 1)
 
 enum hs_drv_res_ohm {
 	STRENGTH_30_OHM = 0x8,
diff --git a/drivers/phy/rockchip/phy-rockchip-usb.c b/drivers/phy/rockchip/phy-rockchip-usb.c
index 666a896c8f0a..c3c30df29c3e 100644
--- a/drivers/phy/rockchip/phy-rockchip-usb.c
+++ b/drivers/phy/rockchip/phy-rockchip-usb.c
@@ -8,6 +8,7 @@
 
 #include <linux/clk.h>
 #include <linux/clk-provider.h>
+#include <linux/hw_bitfield.h>
 #include <linux/io.h>
 #include <linux/kernel.h>
 #include <linux/module.h>
@@ -24,9 +25,6 @@
 
 static int enable_usb_uart;
 
-#define HIWORD_UPDATE(val, mask) \
-		((val) | (mask) << 16)
-
 #define UOC_CON0					0x00
 #define UOC_CON0_SIDDQ					BIT(13)
 #define UOC_CON0_DISABLE				BIT(4)
@@ -38,10 +36,10 @@ static int enable_usb_uart;
 #define UOC_CON3					0x0c
 /* bits present on rk3188 and rk3288 phys */
 #define UOC_CON3_UTMI_TERMSEL_FULLSPEED			BIT(5)
-#define UOC_CON3_UTMI_XCVRSEELCT_FSTRANSC		(1 << 3)
-#define UOC_CON3_UTMI_XCVRSEELCT_MASK			(3 << 3)
-#define UOC_CON3_UTMI_OPMODE_NODRIVING			(1 << 1)
-#define UOC_CON3_UTMI_OPMODE_MASK			(3 << 1)
+#define UOC_CON3_UTMI_XCVRSEELCT_FSTRANSC		1UL
+#define UOC_CON3_UTMI_XCVRSEELCT_MASK			GENMASK(4, 3)
+#define UOC_CON3_UTMI_OPMODE_NODRIVING			1UL
+#define UOC_CON3_UTMI_OPMODE_MASK			GENMASK(2, 1)
 #define UOC_CON3_UTMI_SUSPENDN				BIT(0)
 
 struct rockchip_usb_phys {
@@ -79,7 +77,7 @@ struct rockchip_usb_phy {
 static int rockchip_usb_phy_power(struct rockchip_usb_phy *phy,
 					   bool siddq)
 {
-	u32 val = HIWORD_UPDATE(siddq ? UOC_CON0_SIDDQ : 0, UOC_CON0_SIDDQ);
+	u32 val = FIELD_PREP_WM16(UOC_CON0_SIDDQ, siddq);
 
 	return regmap_write(phy->base->reg_base, phy->reg_offset, val);
 }
@@ -332,29 +330,24 @@ static int __init rockchip_init_usb_uart_common(struct regmap *grf,
 	 * but were not present in the original code.
 	 * Also disable the analog phy components to save power.
 	 */
-	val = HIWORD_UPDATE(UOC_CON0_COMMON_ON_N
-				| UOC_CON0_DISABLE
-				| UOC_CON0_SIDDQ,
-			    UOC_CON0_COMMON_ON_N
-				| UOC_CON0_DISABLE
-				| UOC_CON0_SIDDQ);
+	val = FIELD_PREP_WM16(UOC_CON0_COMMON_ON_N, 1) |
+	      FIELD_PREP_WM16(UOC_CON0_DISABLE, 1) |
+	      FIELD_PREP_WM16(UOC_CON0_SIDDQ, 1);
 	ret = regmap_write(grf, regoffs + UOC_CON0, val);
 	if (ret)
 		return ret;
 
-	val = HIWORD_UPDATE(UOC_CON2_SOFT_CON_SEL,
-			    UOC_CON2_SOFT_CON_SEL);
+	val = FIELD_PREP_WM16(UOC_CON2_SOFT_CON_SEL, 1);
 	ret = regmap_write(grf, regoffs + UOC_CON2, val);
 	if (ret)
 		return ret;
 
-	val = HIWORD_UPDATE(UOC_CON3_UTMI_OPMODE_NODRIVING
-				| UOC_CON3_UTMI_XCVRSEELCT_FSTRANSC
-				| UOC_CON3_UTMI_TERMSEL_FULLSPEED,
-			    UOC_CON3_UTMI_SUSPENDN
-				| UOC_CON3_UTMI_OPMODE_MASK
-				| UOC_CON3_UTMI_XCVRSEELCT_MASK
-				| UOC_CON3_UTMI_TERMSEL_FULLSPEED);
+	val = FIELD_PREP_WM16(UOC_CON3_UTMI_SUSPENDN, 0) |
+	      FIELD_PREP_WM16(UOC_CON3_UTMI_OPMODE_MASK,
+			   UOC_CON3_UTMI_OPMODE_NODRIVING) |
+	      FIELD_PREP_WM16(UOC_CON3_UTMI_XCVRSEELCT_MASK,
+			   UOC_CON3_UTMI_XCVRSEELCT_FSTRANSC) |
+	      FIELD_PREP_WM16(UOC_CON3_UTMI_TERMSEL_FULLSPEED, 1);
 	ret = regmap_write(grf, UOC_CON3, val);
 	if (ret)
 		return ret;
@@ -380,10 +373,8 @@ static int __init rk3188_init_usb_uart(struct regmap *grf,
 	if (ret)
 		return ret;
 
-	val = HIWORD_UPDATE(RK3188_UOC0_CON0_BYPASSSEL
-				| RK3188_UOC0_CON0_BYPASSDMEN,
-			    RK3188_UOC0_CON0_BYPASSSEL
-				| RK3188_UOC0_CON0_BYPASSDMEN);
+	val = FIELD_PREP_WM16(RK3188_UOC0_CON0_BYPASSSEL, 1) |
+	      FIELD_PREP_WM16(RK3188_UOC0_CON0_BYPASSDMEN, 1);
 	ret = regmap_write(grf, RK3188_UOC0_CON0, val);
 	if (ret)
 		return ret;
@@ -430,10 +421,8 @@ static int __init rk3288_init_usb_uart(struct regmap *grf,
 	if (ret)
 		return ret;
 
-	val = HIWORD_UPDATE(RK3288_UOC0_CON3_BYPASSSEL
-				| RK3288_UOC0_CON3_BYPASSDMEN,
-			    RK3288_UOC0_CON3_BYPASSSEL
-				| RK3288_UOC0_CON3_BYPASSDMEN);
+	val = FIELD_PREP_WM16(RK3288_UOC0_CON3_BYPASSSEL, 1) |
+	      FIELD_PREP_WM16(RK3288_UOC0_CON3_BYPASSDMEN, 1);
 	ret = regmap_write(grf, RK3288_UOC0_CON3, val);
 	if (ret)
 		return ret;
diff --git a/drivers/soc/rockchip/grf.c b/drivers/soc/rockchip/grf.c
index 1eab4bb0eacf..344870da7675 100644
--- a/drivers/soc/rockchip/grf.c
+++ b/drivers/soc/rockchip/grf.c
@@ -6,13 +6,12 @@
  */
 
 #include <linux/err.h>
+#include <linux/hw_bitfield.h>
 #include <linux/mfd/syscon.h>
 #include <linux/of.h>
 #include <linux/platform_device.h>
 #include <linux/regmap.h>
 
-#define HIWORD_UPDATE(val, mask, shift) \
-		((val) << (shift) | (mask) << ((shift) + 16))
 
 struct rockchip_grf_value {
 	const char *desc;
@@ -32,7 +31,7 @@ static const struct rockchip_grf_value rk3036_defaults[] __initconst = {
 	 * Disable auto jtag/sdmmc switching that causes issues with the
 	 * clock-framework and the mmc controllers making them unreliable.
 	 */
-	{ "jtag switching", RK3036_GRF_SOC_CON0, HIWORD_UPDATE(0, 1, 11) },
+	{ "jtag switching", RK3036_GRF_SOC_CON0, FIELD_PREP_WM16_CONST(BIT(11), 0) },
 };
 
 static const struct rockchip_grf_info rk3036_grf __initconst = {
@@ -44,8 +43,8 @@ static const struct rockchip_grf_info rk3036_grf __initconst = {
 #define RK3128_GRF_SOC_CON1		0x144
 
 static const struct rockchip_grf_value rk3128_defaults[] __initconst = {
-	{ "jtag switching", RK3128_GRF_SOC_CON0, HIWORD_UPDATE(0, 1, 8) },
-	{ "vpu main clock", RK3128_GRF_SOC_CON1, HIWORD_UPDATE(0, 1, 10) },
+	{ "jtag switching", RK3128_GRF_SOC_CON0, FIELD_PREP_WM16_CONST(BIT(8), 0) },
+	{ "vpu main clock", RK3128_GRF_SOC_CON1, FIELD_PREP_WM16_CONST(BIT(10), 0) },
 };
 
 static const struct rockchip_grf_info rk3128_grf __initconst = {
@@ -56,7 +55,7 @@ static const struct rockchip_grf_info rk3128_grf __initconst = {
 #define RK3228_GRF_SOC_CON6		0x418
 
 static const struct rockchip_grf_value rk3228_defaults[] __initconst = {
-	{ "jtag switching", RK3228_GRF_SOC_CON6, HIWORD_UPDATE(0, 1, 8) },
+	{ "jtag switching", RK3228_GRF_SOC_CON6, FIELD_PREP_WM16_CONST(BIT(8), 0) },
 };
 
 static const struct rockchip_grf_info rk3228_grf __initconst = {
@@ -68,8 +67,8 @@ static const struct rockchip_grf_info rk3228_grf __initconst = {
 #define RK3288_GRF_SOC_CON2		0x24c
 
 static const struct rockchip_grf_value rk3288_defaults[] __initconst = {
-	{ "jtag switching", RK3288_GRF_SOC_CON0, HIWORD_UPDATE(0, 1, 12) },
-	{ "pwm select", RK3288_GRF_SOC_CON2, HIWORD_UPDATE(1, 1, 0) },
+	{ "jtag switching", RK3288_GRF_SOC_CON0, FIELD_PREP_WM16_CONST(BIT(12), 0) },
+	{ "pwm select", RK3288_GRF_SOC_CON2, FIELD_PREP_WM16_CONST(BIT(0), 1) },
 };
 
 static const struct rockchip_grf_info rk3288_grf __initconst = {
@@ -80,7 +79,7 @@ static const struct rockchip_grf_info rk3288_grf __initconst = {
 #define RK3328_GRF_SOC_CON4		0x410
 
 static const struct rockchip_grf_value rk3328_defaults[] __initconst = {
-	{ "jtag switching", RK3328_GRF_SOC_CON4, HIWORD_UPDATE(0, 1, 12) },
+	{ "jtag switching", RK3328_GRF_SOC_CON4, FIELD_PREP_WM16_CONST(BIT(12), 0) },
 };
 
 static const struct rockchip_grf_info rk3328_grf __initconst = {
@@ -91,7 +90,7 @@ static const struct rockchip_grf_info rk3328_grf __initconst = {
 #define RK3368_GRF_SOC_CON15		0x43c
 
 static const struct rockchip_grf_value rk3368_defaults[] __initconst = {
-	{ "jtag switching", RK3368_GRF_SOC_CON15, HIWORD_UPDATE(0, 1, 13) },
+	{ "jtag switching", RK3368_GRF_SOC_CON15, FIELD_PREP_WM16_CONST(BIT(13), 0) },
 };
 
 static const struct rockchip_grf_info rk3368_grf __initconst = {
@@ -102,7 +101,7 @@ static const struct rockchip_grf_info rk3368_grf __initconst = {
 #define RK3399_GRF_SOC_CON7		0xe21c
 
 static const struct rockchip_grf_value rk3399_defaults[] __initconst = {
-	{ "jtag switching", RK3399_GRF_SOC_CON7, HIWORD_UPDATE(0, 1, 12) },
+	{ "jtag switching", RK3399_GRF_SOC_CON7, FIELD_PREP_WM16_CONST(BIT(12), 0) },
 };
 
 static const struct rockchip_grf_info rk3399_grf __initconst = {
@@ -113,9 +112,9 @@ static const struct rockchip_grf_info rk3399_grf __initconst = {
 #define RK3566_GRF_USB3OTG0_CON1	0x0104
 
 static const struct rockchip_grf_value rk3566_defaults[] __initconst = {
-	{ "usb3otg port switch", RK3566_GRF_USB3OTG0_CON1, HIWORD_UPDATE(0, 1, 12) },
-	{ "usb3otg clock switch", RK3566_GRF_USB3OTG0_CON1, HIWORD_UPDATE(1, 1, 7) },
-	{ "usb3otg disable usb3", RK3566_GRF_USB3OTG0_CON1, HIWORD_UPDATE(1, 1, 0) },
+	{ "usb3otg port switch", RK3566_GRF_USB3OTG0_CON1, FIELD_PREP_WM16_CONST(BIT(12), 0) },
+	{ "usb3otg clock switch", RK3566_GRF_USB3OTG0_CON1, FIELD_PREP_WM16_CONST(BIT(7), 1) },
+	{ "usb3otg disable usb3", RK3566_GRF_USB3OTG0_CON1, FIELD_PREP_WM16_CONST(BIT(0), 1) },
 };
 
 static const struct rockchip_grf_info rk3566_pipegrf __initconst = {
@@ -126,8 +125,8 @@ static const struct rockchip_grf_info rk3566_pipegrf __initconst = {
 #define RK3576_SYSGRF_SOC_CON1		0x0004
 
 static const struct rockchip_grf_value rk3576_defaults_sys_grf[] __initconst = {
-	{ "i3c0 weakpull", RK3576_SYSGRF_SOC_CON1, HIWORD_UPDATE(3, 3, 6) },
-	{ "i3c1 weakpull", RK3576_SYSGRF_SOC_CON1, HIWORD_UPDATE(3, 3, 8) },
+	{ "i3c0 weakpull", RK3576_SYSGRF_SOC_CON1, FIELD_PREP_WM16_CONST(GENMASK(7, 6), 3) },
+	{ "i3c1 weakpull", RK3576_SYSGRF_SOC_CON1, FIELD_PREP_WM16_CONST(GENMASK(9, 8), 3) },
 };
 
 static const struct rockchip_grf_info rk3576_sysgrf __initconst = {
@@ -138,7 +137,7 @@ static const struct rockchip_grf_info rk3576_sysgrf __initconst = {
 #define RK3576_IOCGRF_MISC_CON		0x04F0
 
 static const struct rockchip_grf_value rk3576_defaults_ioc_grf[] __initconst = {
-	{ "jtag switching", RK3576_IOCGRF_MISC_CON, HIWORD_UPDATE(0, 1, 1) },
+	{ "jtag switching", RK3576_IOCGRF_MISC_CON, FIELD_PREP_WM16_CONST(BIT(1), 0) },
 };
 
 static const struct rockchip_grf_info rk3576_iocgrf __initconst = {
@@ -149,7 +148,7 @@ static const struct rockchip_grf_info rk3576_iocgrf __initconst = {
 #define RK3588_GRF_SOC_CON6		0x0318
 
 static const struct rockchip_grf_value rk3588_defaults[] __initconst = {
-	{ "jtag switching", RK3588_GRF_SOC_CON6, HIWORD_UPDATE(0, 1, 14) },
+	{ "jtag switching", RK3588_GRF_SOC_CON6, FIELD_PREP_WM16_CONST(BIT(14), 0) },
 };
 
 static const struct rockchip_grf_info rk3588_sysgrf __initconst = {
diff --git a/fs/Kconfig.binfmt b/fs/Kconfig.binfmt
index bd2f530e5740..1949e25c7741 100644
--- a/fs/Kconfig.binfmt
+++ b/fs/Kconfig.binfmt
@@ -184,4 +184,13 @@ config EXEC_KUNIT_TEST
 	  This builds the exec KUnit tests, which tests boundary conditions
 	  of various aspects of the exec internals.
 
+config ARCH_HAS_ELF_CORE_EFLAGS
+	bool
+	depends on BINFMT_ELF && ELF_CORE
+	default n
+	help
+	  Select this option if the architecture makes use of the e_flags
+	  field in the ELF header to store ABI or other architecture-specific
+	  information that should be preserved in core dumps.
+
 endmenu
diff --git a/fs/binfmt_elf.c b/fs/binfmt_elf.c
index 264fba0d44bd..e4653bb99946 100644
--- a/fs/binfmt_elf.c
+++ b/fs/binfmt_elf.c
@@ -103,6 +103,21 @@ static struct linux_binfmt elf_format = {
 
 #define BAD_ADDR(x) (unlikely((unsigned long)(x) >= TASK_SIZE))
 
+static inline void elf_coredump_set_mm_eflags(struct mm_struct *mm, u32 flags)
+{
+#ifdef CONFIG_ARCH_HAS_ELF_CORE_EFLAGS
+	mm->saved_e_flags = flags;
+#endif
+}
+
+static inline u32 elf_coredump_get_mm_eflags(struct mm_struct *mm, u32 flags)
+{
+#ifdef CONFIG_ARCH_HAS_ELF_CORE_EFLAGS
+	flags = mm->saved_e_flags;
+#endif
+	return flags;
+}
+
 /*
  * We need to explicitly zero any trailing portion of the page that follows
  * p_filesz when it ends before the page ends (e.g. bss), otherwise this
@@ -1290,6 +1305,8 @@ static int load_elf_binary(struct linux_binprm *bprm)
 	mm->end_data = end_data;
 	mm->start_stack = bprm->p;
 
+	elf_coredump_set_mm_eflags(mm, elf_ex->e_flags);
+
 	/**
 	 * DOC: "brk" handling
 	 *
@@ -1804,6 +1821,8 @@ static int fill_note_info(struct elfhdr *elf, int phdrs,
 	struct elf_thread_core_info *t;
 	struct elf_prpsinfo *psinfo;
 	struct core_thread *ct;
+	u16 machine;
+	u32 flags;
 
 	psinfo = kmalloc(sizeof(*psinfo), GFP_KERNEL);
 	if (!psinfo)
@@ -1831,30 +1850,37 @@ static int fill_note_info(struct elfhdr *elf, int phdrs,
 		return 0;
 	}
 
-	/*
-	 * Initialize the ELF file header.
-	 */
-	fill_elf_header(elf, phdrs,
-			view->e_machine, view->e_flags);
+	machine = view->e_machine;
+	flags = view->e_flags;
 #else
 	view = NULL;
 	info->thread_notes = 2;
-	fill_elf_header(elf, phdrs, ELF_ARCH, ELF_CORE_EFLAGS);
+	machine = ELF_ARCH;
+	flags = ELF_CORE_EFLAGS;
 #endif
 
+	/*
+	 * Override ELF e_flags with value taken from process,
+	 * if arch needs that.
+	 */
+	flags = elf_coredump_get_mm_eflags(dump_task->mm, flags);
+
+	/*
+	 * Initialize the ELF file header.
+	 */
+	fill_elf_header(elf, phdrs, machine, flags);
+
 	/*
 	 * Allocate a structure for each thread.
 	 */
-	info->thread = kzalloc(offsetof(struct elf_thread_core_info,
-				     notes[info->thread_notes]),
-			    GFP_KERNEL);
+	info->thread = kzalloc(struct_size(info->thread, notes, info->thread_notes),
+			       GFP_KERNEL);
 	if (unlikely(!info->thread))
 		return 0;
 
 	info->thread->task = dump_task;
 	for (ct = dump_task->signal->core_state->dumper.next; ct; ct = ct->next) {
-		t = kzalloc(offsetof(struct elf_thread_core_info,
-				     notes[info->thread_notes]),
+		t = kzalloc(struct_size(t, notes, info->thread_notes),
 			    GFP_KERNEL);
 		if (unlikely(!t))
 			return 0;
diff --git a/fs/exec.c b/fs/exec.c
index 4822777865e5..6b70c6726d31 100644
--- a/fs/exec.c
+++ b/fs/exec.c
@@ -599,7 +599,7 @@ int setup_arg_pages(struct linux_binprm *bprm,
 		    unsigned long stack_top,
 		    int executable_stack)
 {
-	unsigned long ret;
+	int ret;
 	unsigned long stack_shift;
 	struct mm_struct *mm = current->mm;
 	struct vm_area_struct *vma = bprm->vma;
diff --git a/fs/namei.c b/fs/namei.c
index 7377020a2cba..ba29ec7b67c5 100644
--- a/fs/namei.c
+++ b/fs/namei.c
@@ -716,7 +716,7 @@ static bool nd_alloc_stack(struct nameidata *nd)
  * Rename can sometimes move a file or directory outside of a bind
  * mount, path_connected allows those cases to be detected.
  */
-static bool path_connected(struct vfsmount *mnt, struct dentry *dentry)
+bool path_connected(struct vfsmount *mnt, struct dentry *dentry)
 {
 	struct super_block *sb = mnt->mnt_sb;
 
diff --git a/include/acpi/actbl1.h b/include/acpi/actbl1.h
index 0b4c332df25c..7f35eb0e8458 100644
--- a/include/acpi/actbl1.h
+++ b/include/acpi/actbl1.h
@@ -560,8 +560,8 @@ struct acpi_cedt_cfmws_target_element {
 
 /* Values for Restrictions field above */
 
-#define ACPI_CEDT_CFMWS_RESTRICT_TYPE2      (1)
-#define ACPI_CEDT_CFMWS_RESTRICT_TYPE3      (1<<1)
+#define ACPI_CEDT_CFMWS_RESTRICT_DEVMEM      (1)
+#define ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM (1<<1)
 #define ACPI_CEDT_CFMWS_RESTRICT_VOLATILE   (1<<2)
 #define ACPI_CEDT_CFMWS_RESTRICT_PMEM       (1<<3)
 #define ACPI_CEDT_CFMWS_RESTRICT_FIXED      (1<<4)
diff --git a/include/asm-generic/bitops/__ffs.h b/include/asm-generic/bitops/__ffs.h
index 2d08c750c8a7..3a899c626fdc 100644
--- a/include/asm-generic/bitops/__ffs.h
+++ b/include/asm-generic/bitops/__ffs.h
@@ -10,7 +10,7 @@
  *
  * Undefined if no bit exists, so code should check against 0 first.
  */
-static __always_inline unsigned int generic___ffs(unsigned long word)
+static __always_inline __attribute_const__ unsigned int generic___ffs(unsigned long word)
 {
 	unsigned int num = 0;
 
diff --git a/include/asm-generic/bitops/__fls.h b/include/asm-generic/bitops/__fls.h
index e974ec932ec1..35f33780ca6c 100644
--- a/include/asm-generic/bitops/__fls.h
+++ b/include/asm-generic/bitops/__fls.h
@@ -10,7 +10,7 @@
  *
  * Undefined if no set bit exists, so code should check against 0 first.
  */
-static __always_inline unsigned int generic___fls(unsigned long word)
+static __always_inline __attribute_const__ unsigned int generic___fls(unsigned long word)
 {
 	unsigned int num = BITS_PER_LONG - 1;
 
diff --git a/include/asm-generic/bitops/builtin-__ffs.h b/include/asm-generic/bitops/builtin-__ffs.h
index cf4b3d33bf96..d3c3f567045d 100644
--- a/include/asm-generic/bitops/builtin-__ffs.h
+++ b/include/asm-generic/bitops/builtin-__ffs.h
@@ -8,7 +8,7 @@
  *
  * Undefined if no bit exists, so code should check against 0 first.
  */
-static __always_inline unsigned int __ffs(unsigned long word)
+static __always_inline __attribute_const__ unsigned int __ffs(unsigned long word)
 {
 	return __builtin_ctzl(word);
 }
diff --git a/include/asm-generic/bitops/builtin-__fls.h b/include/asm-generic/bitops/builtin-__fls.h
index 6d72fc8a5259..7770c4f1bfcd 100644
--- a/include/asm-generic/bitops/builtin-__fls.h
+++ b/include/asm-generic/bitops/builtin-__fls.h
@@ -8,7 +8,7 @@
  *
  * Undefined if no set bit exists, so code should check against 0 first.
  */
-static __always_inline unsigned int __fls(unsigned long word)
+static __always_inline __attribute_const__ unsigned int __fls(unsigned long word)
 {
 	return (sizeof(word) * 8) - 1 - __builtin_clzl(word);
 }
diff --git a/include/asm-generic/bitops/builtin-fls.h b/include/asm-generic/bitops/builtin-fls.h
index c8455cc28841..be707da8c7cd 100644
--- a/include/asm-generic/bitops/builtin-fls.h
+++ b/include/asm-generic/bitops/builtin-fls.h
@@ -9,7 +9,7 @@
  * This is defined the same way as ffs.
  * Note fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
-static __always_inline int fls(unsigned int x)
+static __always_inline __attribute_const__ int fls(unsigned int x)
 {
 	return x ? sizeof(x) * 8 - __builtin_clz(x) : 0;
 }
diff --git a/include/asm-generic/bitops/ffs.h b/include/asm-generic/bitops/ffs.h
index 4c43f242daeb..5ff2b7fbda6d 100644
--- a/include/asm-generic/bitops/ffs.h
+++ b/include/asm-generic/bitops/ffs.h
@@ -10,7 +10,7 @@
  * the libc and compiler builtin ffs routines, therefore
  * differs in spirit from ffz (man ffs).
  */
-static inline int generic_ffs(int x)
+static inline __attribute_const__ int generic_ffs(int x)
 {
 	int r = 1;
 
diff --git a/include/asm-generic/bitops/fls.h b/include/asm-generic/bitops/fls.h
index 26f3ce1dd6e4..8eed3437edb9 100644
--- a/include/asm-generic/bitops/fls.h
+++ b/include/asm-generic/bitops/fls.h
@@ -10,7 +10,7 @@
  * Note fls(0) = 0, fls(1) = 1, fls(0x80000000) = 32.
  */
 
-static __always_inline int generic_fls(unsigned int x)
+static __always_inline __attribute_const__ int generic_fls(unsigned int x)
 {
 	int r = 32;
 
diff --git a/include/asm-generic/bitops/fls64.h b/include/asm-generic/bitops/fls64.h
index 866f2b2304ff..b5f58dd261a3 100644
--- a/include/asm-generic/bitops/fls64.h
+++ b/include/asm-generic/bitops/fls64.h
@@ -16,7 +16,7 @@
  * at position 64.
  */
 #if BITS_PER_LONG == 32
-static __always_inline int fls64(__u64 x)
+static __always_inline __attribute_const__ int fls64(__u64 x)
 {
 	__u32 h = x >> 32;
 	if (h)
@@ -24,7 +24,7 @@ static __always_inline int fls64(__u64 x)
 	return fls(x);
 }
 #elif BITS_PER_LONG == 64
-static __always_inline int fls64(__u64 x)
+static __always_inline __attribute_const__ int fls64(__u64 x)
 {
 	if (x == 0)
 		return 0;
diff --git a/include/asm-generic/mshyperv.h b/include/asm-generic/mshyperv.h
index a729b77983fa..dbd4c2f3aee3 100644
--- a/include/asm-generic/mshyperv.h
+++ b/include/asm-generic/mshyperv.h
@@ -31,6 +31,7 @@
 enum hv_partition_type {
 	HV_PARTITION_TYPE_GUEST,
 	HV_PARTITION_TYPE_ROOT,
+	HV_PARTITION_TYPE_L1VH,
 };
 
 struct ms_hyperv_info {
@@ -354,12 +355,22 @@ static inline bool hv_root_partition(void)
 {
 	return hv_curr_partition_type == HV_PARTITION_TYPE_ROOT;
 }
+static inline bool hv_l1vh_partition(void)
+{
+	return hv_curr_partition_type == HV_PARTITION_TYPE_L1VH;
+}
+static inline bool hv_parent_partition(void)
+{
+	return hv_root_partition() || hv_l1vh_partition();
+}
 int hv_call_deposit_pages(int node, u64 partition_id, u32 num_pages);
 int hv_call_add_logical_proc(int node, u32 lp_index, u32 acpi_id);
 int hv_call_create_vp(int node, u64 partition_id, u32 vp_index, u32 flags);
 
 #else /* CONFIG_MSHV_ROOT */
 static inline bool hv_root_partition(void) { return false; }
+static inline bool hv_l1vh_partition(void) { return false; }
+static inline bool hv_parent_partition(void) { return false; }
 static inline int hv_call_deposit_pages(int node, u64 partition_id, u32 num_pages)
 {
 	return -EOPNOTSUPP;
diff --git a/include/asm-generic/vmlinux.lds.h b/include/asm-generic/vmlinux.lds.h
index d61a02fce727..8a9a2e732a65 100644
--- a/include/asm-generic/vmlinux.lds.h
+++ b/include/asm-generic/vmlinux.lds.h
@@ -157,7 +157,7 @@ defined(CONFIG_AUTOFDO_CLANG) || defined(CONFIG_PROPELLER_CLANG)
 #define PATCHABLE_DISCARDS	*(__patchable_function_entries)
 #endif
 
-#ifndef CONFIG_ARCH_SUPPORTS_CFI_CLANG
+#ifndef CONFIG_ARCH_SUPPORTS_CFI
 /*
  * Simply points to ftrace_stub, but with the proper protocol.
  * Defined by the linker script in linux/vmlinux.lds.h
diff --git a/include/hyperv/hvhdk_mini.h b/include/hyperv/hvhdk_mini.h
index 42e7876455b5..858f6a3925b3 100644
--- a/include/hyperv/hvhdk_mini.h
+++ b/include/hyperv/hvhdk_mini.h
@@ -301,6 +301,7 @@ struct hv_input_map_device_interrupt {
 /* HV_OUTPUT_MAP_DEVICE_INTERRUPT */
 struct hv_output_map_device_interrupt {
 	struct hv_interrupt_entry interrupt_entry;
+	u64 ext_status_deprecated[5];
 } __packed;
 
 /* HV_INPUT_UNMAP_DEVICE_INTERRUPT */
diff --git a/include/kunit/run-in-irq-context.h b/include/kunit/run-in-irq-context.h
new file mode 100644
index 000000000000..108e96433ea4
--- /dev/null
+++ b/include/kunit/run-in-irq-context.h
@@ -0,0 +1,129 @@
+/* SPDX-License-Identifier: GPL-2.0-or-later */
+/*
+ * Helper function for testing code in interrupt contexts
+ *
+ * Copyright 2025 Google LLC
+ */
+#ifndef _KUNIT_RUN_IN_IRQ_CONTEXT_H
+#define _KUNIT_RUN_IN_IRQ_CONTEXT_H
+
+#include <kunit/test.h>
+#include <linux/timekeeping.h>
+#include <linux/hrtimer.h>
+#include <linux/workqueue.h>
+
+#define KUNIT_IRQ_TEST_HRTIMER_INTERVAL us_to_ktime(5)
+
+struct kunit_irq_test_state {
+	bool (*func)(void *test_specific_state);
+	void *test_specific_state;
+	bool task_func_reported_failure;
+	bool hardirq_func_reported_failure;
+	bool softirq_func_reported_failure;
+	unsigned long hardirq_func_calls;
+	unsigned long softirq_func_calls;
+	struct hrtimer timer;
+	struct work_struct bh_work;
+};
+
+static enum hrtimer_restart kunit_irq_test_timer_func(struct hrtimer *timer)
+{
+	struct kunit_irq_test_state *state =
+		container_of(timer, typeof(*state), timer);
+
+	WARN_ON_ONCE(!in_hardirq());
+	state->hardirq_func_calls++;
+
+	if (!state->func(state->test_specific_state))
+		state->hardirq_func_reported_failure = true;
+
+	hrtimer_forward_now(&state->timer, KUNIT_IRQ_TEST_HRTIMER_INTERVAL);
+	queue_work(system_bh_wq, &state->bh_work);
+	return HRTIMER_RESTART;
+}
+
+static void kunit_irq_test_bh_work_func(struct work_struct *work)
+{
+	struct kunit_irq_test_state *state =
+		container_of(work, typeof(*state), bh_work);
+
+	WARN_ON_ONCE(!in_serving_softirq());
+	state->softirq_func_calls++;
+
+	if (!state->func(state->test_specific_state))
+		state->softirq_func_reported_failure = true;
+}
+
+/*
+ * Helper function which repeatedly runs the given @func in task, softirq, and
+ * hardirq context concurrently, and reports a failure to KUnit if any
+ * invocation of @func in any context returns false.  @func is passed
+ * @test_specific_state as its argument.  At most 3 invocations of @func will
+ * run concurrently: one in each of task, softirq, and hardirq context.
+ *
+ * The main purpose of this interrupt context testing is to validate fallback
+ * code paths that run in contexts where the normal code path cannot be used,
+ * typically due to the FPU or vector registers already being in-use in kernel
+ * mode.  These code paths aren't covered when the test code is executed only by
+ * the KUnit test runner thread in task context.  The reason for the concurrency
+ * is because merely using hardirq context is not sufficient to reach a fallback
+ * code path on some architectures; the hardirq actually has to occur while the
+ * FPU or vector unit was already in-use in kernel mode.
+ *
+ * Another purpose of this testing is to detect issues with the architecture's
+ * irq_fpu_usable() and kernel_fpu_begin/end() or equivalent functions,
+ * especially in softirq context when the softirq may have interrupted a task
+ * already using kernel-mode FPU or vector (if the arch didn't prevent that).
+ * Crypto functions are often executed in softirqs, so this is important.
+ */
+static inline void kunit_run_irq_test(struct kunit *test, bool (*func)(void *),
+				      int max_iterations,
+				      void *test_specific_state)
+{
+	struct kunit_irq_test_state state = {
+		.func = func,
+		.test_specific_state = test_specific_state,
+	};
+	unsigned long end_jiffies;
+
+	/*
+	 * Set up a hrtimer (the way we access hardirq context) and a work
+	 * struct for the BH workqueue (the way we access softirq context).
+	 */
+	hrtimer_setup_on_stack(&state.timer, kunit_irq_test_timer_func,
+			       CLOCK_MONOTONIC, HRTIMER_MODE_REL_HARD);
+	INIT_WORK_ONSTACK(&state.bh_work, kunit_irq_test_bh_work_func);
+
+	/* Run for up to max_iterations or 1 second, whichever comes first. */
+	end_jiffies = jiffies + HZ;
+	hrtimer_start(&state.timer, KUNIT_IRQ_TEST_HRTIMER_INTERVAL,
+		      HRTIMER_MODE_REL_HARD);
+	for (int i = 0; i < max_iterations && !time_after(jiffies, end_jiffies);
+	     i++) {
+		if (!func(test_specific_state))
+			state.task_func_reported_failure = true;
+	}
+
+	/* Cancel the timer and work. */
+	hrtimer_cancel(&state.timer);
+	flush_work(&state.bh_work);
+
+	/* Sanity check: the timer and BH functions should have been run. */
+	KUNIT_EXPECT_GT_MSG(test, state.hardirq_func_calls, 0,
+			    "Timer function was not called");
+	KUNIT_EXPECT_GT_MSG(test, state.softirq_func_calls, 0,
+			    "BH work function was not called");
+
+	/* Check for incorrect hash values reported from any context. */
+	KUNIT_EXPECT_FALSE_MSG(
+		test, state.task_func_reported_failure,
+		"Incorrect hash values reported from task context");
+	KUNIT_EXPECT_FALSE_MSG(
+		test, state.hardirq_func_reported_failure,
+		"Incorrect hash values reported from hardirq context");
+	KUNIT_EXPECT_FALSE_MSG(
+		test, state.softirq_func_reported_failure,
+		"Incorrect hash values reported from softirq context");
+}
+
+#endif /* _KUNIT_RUN_IN_IRQ_CONTEXT_H */
diff --git a/include/linux/acpi.h b/include/linux/acpi.h
index 1c5bb1e887cd..5ff5d99f6ead 100644
--- a/include/linux/acpi.h
+++ b/include/linux/acpi.h
@@ -1595,18 +1595,6 @@ static inline void acpi_use_parent_companion(struct device *dev)
 	ACPI_COMPANION_SET(dev, ACPI_COMPANION(dev->parent));
 }
 
-#ifdef CONFIG_ACPI_HMAT
-int hmat_update_target_coordinates(int nid, struct access_coordinate *coord,
-				   enum access_coordinate_class access);
-#else
-static inline int hmat_update_target_coordinates(int nid,
-						 struct access_coordinate *coord,
-						 enum access_coordinate_class access)
-{
-	return -EOPNOTSUPP;
-}
-#endif
-
 #ifdef CONFIG_ACPI_NUMA
 bool acpi_node_backed_by_real_pxm(int nid);
 #else
diff --git a/include/linux/bitops.h b/include/linux/bitops.h
index 9be2d50da09a..ea7898cc5903 100644
--- a/include/linux/bitops.h
+++ b/include/linux/bitops.h
@@ -267,7 +267,7 @@ static inline int parity8(u8 val)
  * The result is not defined if no bits are set, so check that @word
  * is non-zero before calling this.
  */
-static inline unsigned int __ffs64(u64 word)
+static inline __attribute_const__ unsigned int __ffs64(u64 word)
 {
 #if BITS_PER_LONG == 32
 	if (((u32)word) == 0UL)
diff --git a/include/linux/cfi.h b/include/linux/cfi.h
index 52a98886a455..1fd22ea6eba4 100644
--- a/include/linux/cfi.h
+++ b/include/linux/cfi.h
@@ -11,7 +11,7 @@
 #include <linux/module.h>
 #include <asm/cfi.h>
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 extern bool cfi_warn;
 
 enum bug_trap_type report_cfi_failure(struct pt_regs *regs, unsigned long addr,
@@ -52,7 +52,7 @@ static inline u32 cfi_get_func_hash(void *func)
 extern u32 cfi_bpf_hash;
 extern u32 cfi_bpf_subprog_hash;
 
-#else /* CONFIG_CFI_CLANG */
+#else /* CONFIG_CFI */
 
 static inline int cfi_get_offset(void) { return 0; }
 static inline u32 cfi_get_func_hash(void *func) { return 0; }
@@ -60,7 +60,7 @@ static inline u32 cfi_get_func_hash(void *func) { return 0; }
 #define cfi_bpf_hash 0U
 #define cfi_bpf_subprog_hash 0U
 
-#endif /* CONFIG_CFI_CLANG */
+#endif /* CONFIG_CFI */
 
 #ifdef CONFIG_ARCH_USES_CFI_TRAPS
 bool is_cfi_trap(unsigned long addr);
diff --git a/include/linux/cfi_types.h b/include/linux/cfi_types.h
index 685f7181780f..a86af9bc8bdc 100644
--- a/include/linux/cfi_types.h
+++ b/include/linux/cfi_types.h
@@ -8,7 +8,7 @@
 #ifdef __ASSEMBLY__
 #include <linux/linkage.h>
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 /*
  * Use the __kcfi_typeid_<function> type identifier symbol to
  * annotate indirectly called assembly functions. The compiler emits
@@ -29,12 +29,12 @@
 #define SYM_TYPED_START(name, linkage, align...)	\
 	SYM_TYPED_ENTRY(name, linkage, align)
 
-#else /* CONFIG_CFI_CLANG */
+#else /* CONFIG_CFI */
 
 #define SYM_TYPED_START(name, linkage, align...)	\
 	SYM_START(name, linkage, align)
 
-#endif /* CONFIG_CFI_CLANG */
+#endif /* CONFIG_CFI */
 
 #ifndef SYM_TYPED_FUNC_START
 #define SYM_TYPED_FUNC_START(name) 			\
@@ -43,7 +43,7 @@
 
 #else /* __ASSEMBLY__ */
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 #define DEFINE_CFI_TYPE(name, func)						\
 	/*									\
 	 * Force a reference to the function so the compiler generates		\
diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index 64ff73c533e5..5b45ea7dff3e 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -248,7 +248,7 @@ void ftrace_likely_update(struct ftrace_likely_data *f, int val,
 
 #endif /* __KERNEL__ */
 
-#if defined(CONFIG_CFI_CLANG) && !defined(__DISABLE_EXPORTS) && !defined(BUILD_VDSO)
+#if defined(CONFIG_CFI) && !defined(__DISABLE_EXPORTS) && !defined(BUILD_VDSO)
 /*
  * Force a reference to the external symbol so the compiler generates
  * __kcfi_typid.
diff --git a/include/linux/efi.h b/include/linux/efi.h
index a98cc39e7aaa..325d892e559b 100644
--- a/include/linux/efi.h
+++ b/include/linux/efi.h
@@ -1181,19 +1181,19 @@ static inline void efi_check_for_embedded_firmwares(void) { }
  *    Restores the usual kernel environment once the call has returned.
  */
 
-#define efi_call_virt_pointer(p, f, args...)				\
+#define efi_call_virt_pointer(p, f, busy, args...)			\
 ({									\
-	typeof((p)->f(args)) __s;					\
+	typeof((p)->f(args)) __s = (busy);				\
 	unsigned long __flags;						\
 									\
-	arch_efi_call_virt_setup();					\
+	if (!arch_efi_call_virt_setup()) goto __out;			\
 									\
 	__flags = efi_call_virt_save_flags();				\
 	__s = arch_efi_call_virt(p, f, args);				\
 	efi_call_virt_check_flags(__flags, NULL);			\
 									\
 	arch_efi_call_virt_teardown();					\
-									\
+__out:									\
 	__s;								\
 })
 
diff --git a/include/linux/entry-kvm.h b/include/linux/entry-virt.h
similarity index 83%
rename from include/linux/entry-kvm.h
rename to include/linux/entry-virt.h
index 16149f6625e4..42c89e3e5ca7 100644
--- a/include/linux/entry-kvm.h
+++ b/include/linux/entry-virt.h
@@ -1,6 +1,6 @@
 /* SPDX-License-Identifier: GPL-2.0 */
-#ifndef __LINUX_ENTRYKVM_H
-#define __LINUX_ENTRYKVM_H
+#ifndef __LINUX_ENTRYVIRT_H
+#define __LINUX_ENTRYVIRT_H
 
 #include <linux/static_call_types.h>
 #include <linux/resume_user_mode.h>
@@ -10,7 +10,7 @@
 #include <linux/tick.h>
 
 /* Transfer to guest mode work */
-#ifdef CONFIG_KVM_XFER_TO_GUEST_WORK
+#ifdef CONFIG_VIRT_XFER_TO_GUEST_WORK
 
 #ifndef ARCH_XFER_TO_GUEST_MODE_WORK
 # define ARCH_XFER_TO_GUEST_MODE_WORK	(0)
@@ -21,8 +21,6 @@
 	 _TIF_NOTIFY_SIGNAL | _TIF_NOTIFY_RESUME |			\
 	 ARCH_XFER_TO_GUEST_MODE_WORK)
 
-struct kvm_vcpu;
-
 /**
  * arch_xfer_to_guest_mode_handle_work - Architecture specific xfer to guest
  *					 mode work handling function.
@@ -32,12 +30,10 @@ struct kvm_vcpu;
  * Invoked from xfer_to_guest_mode_handle_work(). Defaults to NOOP. Can be
  * replaced by architecture specific code.
  */
-static inline int arch_xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu,
-						      unsigned long ti_work);
+static inline int arch_xfer_to_guest_mode_handle_work(unsigned long ti_work);
 
 #ifndef arch_xfer_to_guest_mode_work
-static inline int arch_xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu,
-						      unsigned long ti_work)
+static inline int arch_xfer_to_guest_mode_handle_work(unsigned long ti_work)
 {
 	return 0;
 }
@@ -46,11 +42,10 @@ static inline int arch_xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu,
 /**
  * xfer_to_guest_mode_handle_work - Check and handle pending work which needs
  *				    to be handled before going to guest mode
- * @vcpu:	Pointer to current's VCPU data
  *
  * Returns: 0 or an error code
  */
-int xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu);
+int xfer_to_guest_mode_handle_work(void);
 
 /**
  * xfer_to_guest_mode_prepare - Perform last minute preparation work that
@@ -95,6 +90,6 @@ static inline bool xfer_to_guest_mode_work_pending(void)
 	lockdep_assert_irqs_disabled();
 	return __xfer_to_guest_mode_work_pending();
 }
-#endif /* CONFIG_KVM_XFER_TO_GUEST_WORK */
+#endif /* CONFIG_VIRT_XFER_TO_GUEST_WORK */
 
 #endif
diff --git a/include/linux/fs.h b/include/linux/fs.h
index c895146c1444..74e0d599e9fd 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -3269,6 +3269,7 @@ extern struct file * open_exec(const char *);
 /* fs/dcache.c -- generic fs support functions */
 extern bool is_subdir(struct dentry *, struct dentry *);
 extern bool path_is_under(const struct path *, const struct path *);
+bool path_connected(struct vfsmount *mnt, struct dentry *dentry);
 
 extern char *file_path(struct file *, char *, int);
 
diff --git a/include/linux/gfp.h b/include/linux/gfp.h
index 5ebf26fcdcfa..0ceb4e09306c 100644
--- a/include/linux/gfp.h
+++ b/include/linux/gfp.h
@@ -354,7 +354,7 @@ static inline struct page *alloc_page_vma_noprof(gfp_t gfp,
 }
 #define alloc_page_vma(...)			alloc_hooks(alloc_page_vma_noprof(__VA_ARGS__))
 
-struct page *alloc_pages_nolock_noprof(int nid, unsigned int order);
+struct page *alloc_pages_nolock_noprof(gfp_t gfp_flags, int nid, unsigned int order);
 #define alloc_pages_nolock(...)			alloc_hooks(alloc_pages_nolock_noprof(__VA_ARGS__))
 
 extern unsigned long get_free_pages_noprof(gfp_t gfp_mask, unsigned int order);
diff --git a/include/linux/hw_bitfield.h b/include/linux/hw_bitfield.h
new file mode 100644
index 000000000000..df202e167ce4
--- /dev/null
+++ b/include/linux/hw_bitfield.h
@@ -0,0 +1,62 @@
+/* SPDX-License-Identifier: GPL-2.0-or-later */
+/*
+ * Copyright (C) 2025, Collabora Ltd.
+ */
+
+#ifndef _LINUX_HW_BITFIELD_H
+#define _LINUX_HW_BITFIELD_H
+
+#include <linux/bitfield.h>
+#include <linux/build_bug.h>
+#include <linux/limits.h>
+
+/**
+ * FIELD_PREP_WM16() - prepare a bitfield element with a mask in the upper half
+ * @_mask: shifted mask defining the field's length and position
+ * @_val:  value to put in the field
+ *
+ * FIELD_PREP_WM16() masks and shifts up the value, as well as bitwise ORs the
+ * result with the mask shifted up by 16.
+ *
+ * This is useful for a common design of hardware registers where the upper
+ * 16-bit half of a 32-bit register is used as a write-enable mask. In such a
+ * register, a bit in the lower half is only updated if the corresponding bit
+ * in the upper half is high.
+ */
+#define FIELD_PREP_WM16(_mask, _val)					     \
+	({								     \
+		typeof(_val) __val = _val;				     \
+		typeof(_mask) __mask = _mask;				     \
+		__BF_FIELD_CHECK(__mask, ((u16)0U), __val,		     \
+				 "HWORD_UPDATE: ");			     \
+		(((typeof(__mask))(__val) << __bf_shf(__mask)) & (__mask)) | \
+		((__mask) << 16);					     \
+	})
+
+/**
+ * FIELD_PREP_WM16_CONST() - prepare a constant bitfield element with a mask in
+ *                           the upper half
+ * @_mask: shifted mask defining the field's length and position
+ * @_val:  value to put in the field
+ *
+ * FIELD_PREP_WM16_CONST() masks and shifts up the value, as well as bitwise ORs
+ * the result with the mask shifted up by 16.
+ *
+ * This is useful for a common design of hardware registers where the upper
+ * 16-bit half of a 32-bit register is used as a write-enable mask. In such a
+ * register, a bit in the lower half is only updated if the corresponding bit
+ * in the upper half is high.
+ *
+ * Unlike FIELD_PREP_WM16(), this is a constant expression and can therefore
+ * be used in initializers. Error checking is less comfortable for this
+ * version.
+ */
+#define FIELD_PREP_WM16_CONST(_mask, _val)				 \
+	(								 \
+		FIELD_PREP_CONST(_mask, _val) |				 \
+		(BUILD_BUG_ON_ZERO(const_true((u64)(_mask) > U16_MAX)) + \
+		 ((_mask) << 16))					 \
+	)
+
+
+#endif /* _LINUX_HW_BITFIELD_H */
diff --git a/include/linux/hyperv.h b/include/linux/hyperv.h
index a59c5c3e95fb..59826c89171c 100644
--- a/include/linux/hyperv.h
+++ b/include/linux/hyperv.h
@@ -707,11 +707,6 @@ struct vmbus_channel_msginfo {
 	unsigned char msg[];
 };
 
-struct vmbus_close_msg {
-	struct vmbus_channel_msginfo info;
-	struct vmbus_channel_close_channel msg;
-};
-
 enum vmbus_device_type {
 	HV_IDE = 0,
 	HV_SCSI,
@@ -800,7 +795,7 @@ struct vmbus_channel {
 	struct hv_ring_buffer_info outbound;	/* send to parent */
 	struct hv_ring_buffer_info inbound;	/* receive from parent */
 
-	struct vmbus_close_msg close_msg;
+	struct vmbus_channel_close_channel close_msg;
 
 	/* Statistics */
 	u64	interrupts;	/* Host to Guest interrupts */
diff --git a/include/linux/kasan.h b/include/linux/kasan.h
index b509a8d36949..d12e1a5f5a9a 100644
--- a/include/linux/kasan.h
+++ b/include/linux/kasan.h
@@ -200,7 +200,7 @@ static __always_inline bool kasan_slab_pre_free(struct kmem_cache *s,
 }
 
 bool __kasan_slab_free(struct kmem_cache *s, void *object, bool init,
-		       bool still_accessible);
+		       bool still_accessible, bool no_quarantine);
 /**
  * kasan_slab_free - Poison, initialize, and quarantine a slab object.
  * @object: Object to be freed.
@@ -226,11 +226,13 @@ bool __kasan_slab_free(struct kmem_cache *s, void *object, bool init,
  * @Return true if KASAN took ownership of the object; false otherwise.
  */
 static __always_inline bool kasan_slab_free(struct kmem_cache *s,
-						void *object, bool init,
-						bool still_accessible)
+					    void *object, bool init,
+					    bool still_accessible,
+					    bool no_quarantine)
 {
 	if (kasan_enabled())
-		return __kasan_slab_free(s, object, init, still_accessible);
+		return __kasan_slab_free(s, object, init, still_accessible,
+					 no_quarantine);
 	return false;
 }
 
@@ -427,7 +429,8 @@ static inline bool kasan_slab_pre_free(struct kmem_cache *s, void *object)
 }
 
 static inline bool kasan_slab_free(struct kmem_cache *s, void *object,
-				   bool init, bool still_accessible)
+				   bool init, bool still_accessible,
+				   bool no_quarantine)
 {
 	return false;
 }
diff --git a/include/linux/kvm_host.h b/include/linux/kvm_host.h
index 19b8c4bebb9c..fa36e70df088 100644
--- a/include/linux/kvm_host.h
+++ b/include/linux/kvm_host.h
@@ -2,7 +2,7 @@
 #ifndef __KVM_HOST_H
 #define __KVM_HOST_H
 
-
+#include <linux/entry-virt.h>
 #include <linux/types.h>
 #include <linux/hardirq.h>
 #include <linux/list.h>
@@ -2450,13 +2450,24 @@ static inline int kvm_arch_vcpu_run_pid_change(struct kvm_vcpu *vcpu)
 }
 #endif /* CONFIG_HAVE_KVM_VCPU_RUN_PID_CHANGE */
 
-#ifdef CONFIG_KVM_XFER_TO_GUEST_WORK
+#ifdef CONFIG_VIRT_XFER_TO_GUEST_WORK
 static inline void kvm_handle_signal_exit(struct kvm_vcpu *vcpu)
 {
 	vcpu->run->exit_reason = KVM_EXIT_INTR;
 	vcpu->stat.signal_exits++;
 }
-#endif /* CONFIG_KVM_XFER_TO_GUEST_WORK */
+
+static inline int kvm_xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu)
+{
+	int r = xfer_to_guest_mode_handle_work();
+
+	if (r) {
+		WARN_ON_ONCE(r != -EINTR);
+		kvm_handle_signal_exit(vcpu);
+	}
+	return r;
+}
+#endif /* CONFIG_VIRT_XFER_TO_GUEST_WORK */
 
 /*
  * If more than one page is being (un)accounted, @virt must be the address of
diff --git a/include/linux/local_lock.h b/include/linux/local_lock.h
index 2ba846419524..0d91d060e3e9 100644
--- a/include/linux/local_lock.h
+++ b/include/linux/local_lock.h
@@ -66,6 +66,8 @@
  */
 #define local_trylock(lock)		__local_trylock(this_cpu_ptr(lock))
 
+#define local_lock_is_locked(lock)	__local_lock_is_locked(lock)
+
 /**
  * local_trylock_irqsave - Try to acquire a per CPU local lock, save and disable
  *			   interrupts if acquired
diff --git a/include/linux/local_lock_internal.h b/include/linux/local_lock_internal.h
index d80b5306a2c0..a4dc479157b5 100644
--- a/include/linux/local_lock_internal.h
+++ b/include/linux/local_lock_internal.h
@@ -17,7 +17,10 @@ typedef struct {
 
 /* local_trylock() and local_trylock_irqsave() only work with local_trylock_t */
 typedef struct {
-	local_lock_t	llock;
+#ifdef CONFIG_DEBUG_LOCK_ALLOC
+	struct lockdep_map	dep_map;
+	struct task_struct	*owner;
+#endif
 	u8		acquired;
 } local_trylock_t;
 
@@ -31,7 +34,7 @@ typedef struct {
 	.owner = NULL,
 
 # define LOCAL_TRYLOCK_DEBUG_INIT(lockname)		\
-	.llock = { LOCAL_LOCK_DEBUG_INIT((lockname).llock) },
+	LOCAL_LOCK_DEBUG_INIT(lockname)
 
 static inline void local_lock_acquire(local_lock_t *l)
 {
@@ -81,7 +84,7 @@ do {								\
 	local_lock_debug_init(lock);				\
 } while (0)
 
-#define __local_trylock_init(lock) __local_lock_init(lock.llock)
+#define __local_trylock_init(lock) __local_lock_init((local_lock_t *)lock)
 
 #define __spinlock_nested_bh_init(lock)				\
 do {								\
@@ -162,6 +165,9 @@ do {								\
 		!!tl;						\
 	})
 
+/* preemption or migration must be disabled before calling __local_lock_is_locked */
+#define __local_lock_is_locked(lock) READ_ONCE(this_cpu_ptr(lock)->acquired)
+
 #define __local_lock_release(lock)					\
 	do {								\
 		local_trylock_t *tl;					\
@@ -282,4 +288,8 @@ do {								\
 		__local_trylock(lock);				\
 	})
 
+/* migration must be disabled before calling __local_lock_is_locked */
+#define __local_lock_is_locked(__lock)					\
+	(rt_mutex_owner(&this_cpu_ptr(__lock)->lock) == current)
+
 #endif /* CONFIG_PREEMPT_RT */
diff --git a/include/linux/maple_tree.h b/include/linux/maple_tree.h
index 47f9002ae92d..66f98a3da8d8 100644
--- a/include/linux/maple_tree.h
+++ b/include/linux/maple_tree.h
@@ -442,7 +442,9 @@ struct ma_state {
 	struct maple_enode *node;	/* The node containing this entry */
 	unsigned long min;		/* The minimum index of this node - implied pivot min */
 	unsigned long max;		/* The maximum index of this node - implied pivot max */
-	struct maple_alloc *alloc;	/* Allocated nodes for this operation */
+	struct slab_sheaf *sheaf;	/* Allocated nodes for this operation */
+	struct maple_node *alloc;	/* A single allocated node for fast path writes */
+	unsigned long node_request;	/* The number of nodes to allocate for this operation */
 	enum maple_status status;	/* The status of the state (active, start, none, etc) */
 	unsigned char depth;		/* depth of tree descent during write */
 	unsigned char offset;
@@ -493,7 +495,9 @@ struct ma_wr_state {
 		.status = ma_start,					\
 		.min = 0,						\
 		.max = ULONG_MAX,					\
+		.sheaf = NULL,						\
 		.alloc = NULL,						\
+		.node_request = 0,					\
 		.mas_flags = 0,						\
 		.store_type = wr_invalid,				\
 	}
diff --git a/include/linux/memblock.h b/include/linux/memblock.h
index fcda8481de9a..221118b5a16e 100644
--- a/include/linux/memblock.h
+++ b/include/linux/memblock.h
@@ -324,28 +324,6 @@ void __next_mem_pfn_range(int *idx, int nid, unsigned long *out_start_pfn,
 	for (i = -1, __next_mem_pfn_range(&i, nid, p_start, p_end, p_nid); \
 	     i >= 0; __next_mem_pfn_range(&i, nid, p_start, p_end, p_nid))
 
-#ifdef CONFIG_DEFERRED_STRUCT_PAGE_INIT
-void __next_mem_pfn_range_in_zone(u64 *idx, struct zone *zone,
-				  unsigned long *out_spfn,
-				  unsigned long *out_epfn);
-
-/**
- * for_each_free_mem_pfn_range_in_zone_from - iterate through zone specific
- * free memblock areas from a given point
- * @i: u64 used as loop variable
- * @zone: zone in which all of the memory blocks reside
- * @p_start: ptr to phys_addr_t for start address of the range, can be %NULL
- * @p_end: ptr to phys_addr_t for end address of the range, can be %NULL
- *
- * Walks over free (memory && !reserved) areas of memblock in a specific
- * zone, continuing from current position. Available as soon as memblock is
- * initialized.
- */
-#define for_each_free_mem_pfn_range_in_zone_from(i, zone, p_start, p_end) \
-	for (; i != U64_MAX;					  \
-	     __next_mem_pfn_range_in_zone(&i, zone, p_start, p_end))
-
-#endif /* CONFIG_DEFERRED_STRUCT_PAGE_INIT */
 
 /**
  * for_each_free_mem_range - iterate through free memblock areas
diff --git a/include/linux/memcontrol.h b/include/linux/memcontrol.h
index 9dc5b52672a6..16fe0306e50e 100644
--- a/include/linux/memcontrol.h
+++ b/include/linux/memcontrol.h
@@ -341,17 +341,25 @@ enum page_memcg_data_flags {
 	__NR_MEMCG_DATA_FLAGS  = (1UL << 2),
 };
 
+#define __OBJEXTS_ALLOC_FAIL	MEMCG_DATA_OBJEXTS
 #define __FIRST_OBJEXT_FLAG	__NR_MEMCG_DATA_FLAGS
 
 #else /* CONFIG_MEMCG */
 
+#define __OBJEXTS_ALLOC_FAIL	(1UL << 0)
 #define __FIRST_OBJEXT_FLAG	(1UL << 0)
 
 #endif /* CONFIG_MEMCG */
 
 enum objext_flags {
-	/* slabobj_ext vector failed to allocate */
-	OBJEXTS_ALLOC_FAIL = __FIRST_OBJEXT_FLAG,
+	/*
+	 * Use bit 0 with zero other bits to signal that slabobj_ext vector
+	 * failed to allocate. The same bit 0 with valid upper bits means
+	 * MEMCG_DATA_OBJEXTS.
+	 */
+	OBJEXTS_ALLOC_FAIL = __OBJEXTS_ALLOC_FAIL,
+	/* slabobj_ext vector allocated with kmalloc_nolock() */
+	OBJEXTS_NOSPIN_ALLOC = __FIRST_OBJEXT_FLAG,
 	/* the next bit after the last actual flag */
 	__NR_OBJEXTS_FLAGS  = (__FIRST_OBJEXT_FLAG << 1),
 };
diff --git a/include/linux/memory.h b/include/linux/memory.h
index 40eb70ccb09d..0b755d1ef1ec 100644
--- a/include/linux/memory.h
+++ b/include/linux/memory.h
@@ -115,13 +115,13 @@ struct notifier_block;
 struct mem_section;
 
 /*
- * Priorities for the hotplug memory callback routines (stored in decreasing
- * order in the callback chain)
+ * Priorities for the hotplug memory callback routines. Invoked from
+ * high to low. Higher priorities correspond to higher numbers.
  */
 #define DEFAULT_CALLBACK_PRI	0
 #define SLAB_CALLBACK_PRI	1
-#define HMAT_CALLBACK_PRI	2
 #define CXL_CALLBACK_PRI	5
+#define HMAT_CALLBACK_PRI	6
 #define MM_COMPUTE_BATCH_PRI	10
 #define CPUSET_CALLBACK_PRI	10
 #define MEMTIER_HOTPLUG_PRI	100
diff --git a/include/linux/mm_types.h b/include/linux/mm_types.h
index 94f3ee9963a6..90e5790c318f 100644
--- a/include/linux/mm_types.h
+++ b/include/linux/mm_types.h
@@ -1114,6 +1114,11 @@ struct mm_struct {
 
 		unsigned long saved_auxv[AT_VECTOR_SIZE]; /* for /proc/PID/auxv */
 
+#ifdef CONFIG_ARCH_HAS_ELF_CORE_EFLAGS
+		/* the ABI-related flags from the ELF header. Used for core dump */
+		unsigned long saved_e_flags;
+#endif
+
 		struct percpu_counter rss_stat[NR_MM_COUNTERS];
 
 		struct linux_binfmt *binfmt;
diff --git a/include/linux/node.h b/include/linux/node.h
index 2c7529335b21..866e3323f1fd 100644
--- a/include/linux/node.h
+++ b/include/linux/node.h
@@ -85,6 +85,8 @@ struct node_cache_attrs {
 void node_add_cache(unsigned int nid, struct node_cache_attrs *cache_attrs);
 void node_set_perf_attrs(unsigned int nid, struct access_coordinate *coord,
 			 enum access_coordinate_class access);
+void node_update_perf_attrs(unsigned int nid, struct access_coordinate *coord,
+			    enum access_coordinate_class access);
 #else
 static inline void node_add_cache(unsigned int nid,
 				  struct node_cache_attrs *cache_attrs)
@@ -96,6 +98,12 @@ static inline void node_set_perf_attrs(unsigned int nid,
 				       enum access_coordinate_class access)
 {
 }
+
+static inline void node_update_perf_attrs(unsigned int nid,
+					  struct access_coordinate *coord,
+					  enum access_coordinate_class access)
+{
+}
 #endif
 
 struct node {
diff --git a/include/linux/ntb.h b/include/linux/ntb.h
index 191b524e5c0d..8ff9d663096b 100644
--- a/include/linux/ntb.h
+++ b/include/linux/ntb.h
@@ -1647,12 +1647,8 @@ int ntbm_msi_request_threaded_irq(struct ntb_dev *ntb, irq_handler_t handler,
 				  irq_handler_t thread_fn,
 				  const char *name, void *dev_id,
 				  struct ntb_msi_desc *msi_desc);
-void ntbm_msi_free_irq(struct ntb_dev *ntb, unsigned int irq, void *dev_id);
 int ntb_msi_peer_trigger(struct ntb_dev *ntb, int peer,
 			 struct ntb_msi_desc *desc);
-int ntb_msi_peer_addr(struct ntb_dev *ntb, int peer,
-		      struct ntb_msi_desc *desc,
-		      phys_addr_t *msi_addr);
 
 #else /* not CONFIG_NTB_MSI */
 
@@ -1674,21 +1670,11 @@ static inline int ntbm_msi_request_threaded_irq(struct ntb_dev *ntb,
 {
 	return -EOPNOTSUPP;
 }
-static inline void ntbm_msi_free_irq(struct ntb_dev *ntb, unsigned int irq,
-				     void *dev_id) {}
 static inline int ntb_msi_peer_trigger(struct ntb_dev *ntb, int peer,
 				       struct ntb_msi_desc *desc)
 {
 	return -EOPNOTSUPP;
 }
-static inline int ntb_msi_peer_addr(struct ntb_dev *ntb, int peer,
-				    struct ntb_msi_desc *desc,
-				    phys_addr_t *msi_addr)
-{
-	return -EOPNOTSUPP;
-
-}
-
 #endif /* CONFIG_NTB_MSI */
 
 static inline int ntbm_msi_request_irq(struct ntb_dev *ntb,
diff --git a/include/linux/prandom.h b/include/linux/prandom.h
index f2ed5b72b3d6..ff7dcc3fa105 100644
--- a/include/linux/prandom.h
+++ b/include/linux/prandom.h
@@ -47,10 +47,4 @@ static inline void prandom_seed_state(struct rnd_state *state, u64 seed)
 	state->s4 = __seed(i, 128U);
 }
 
-/* Pseudo random number generator from numerical recipes. */
-static inline u32 next_pseudo_random32(u32 seed)
-{
-	return seed * 1664525 + 1013904223;
-}
-
 #endif
diff --git a/include/linux/rcupdate.h b/include/linux/rcupdate.h
index 621b200d9b87..c5b30054cd01 100644
--- a/include/linux/rcupdate.h
+++ b/include/linux/rcupdate.h
@@ -129,7 +129,7 @@ static inline void rcu_sysrq_start(void) { }
 static inline void rcu_sysrq_end(void) { }
 #endif /* #else #ifdef CONFIG_RCU_STALL_COMMON */
 
-#if defined(CONFIG_NO_HZ_FULL) && (!defined(CONFIG_GENERIC_ENTRY) || !defined(CONFIG_KVM_XFER_TO_GUEST_WORK))
+#if defined(CONFIG_NO_HZ_FULL) && (!defined(CONFIG_GENERIC_ENTRY) || !defined(CONFIG_VIRT_XFER_TO_GUEST_WORK))
 void rcu_irq_work_resched(void);
 #else
 static __always_inline void rcu_irq_work_resched(void) { }
diff --git a/include/linux/rtmutex.h b/include/linux/rtmutex.h
index fa9f1021541e..ede4c6bf6f22 100644
--- a/include/linux/rtmutex.h
+++ b/include/linux/rtmutex.h
@@ -44,6 +44,16 @@ static inline bool rt_mutex_base_is_locked(struct rt_mutex_base *lock)
 	return READ_ONCE(lock->owner) != NULL;
 }
 
+#ifdef CONFIG_RT_MUTEXES
+#define RT_MUTEX_HAS_WAITERS	1UL
+
+static inline struct task_struct *rt_mutex_owner(struct rt_mutex_base *lock)
+{
+	unsigned long owner = (unsigned long) READ_ONCE(lock->owner);
+
+	return (struct task_struct *) (owner & ~RT_MUTEX_HAS_WAITERS);
+}
+#endif
 extern void rt_mutex_base_init(struct rt_mutex_base *rtb);
 
 /**
diff --git a/include/linux/slab.h b/include/linux/slab.h
index 6dc300bac2a1..cf443f064a66 100644
--- a/include/linux/slab.h
+++ b/include/linux/slab.h
@@ -335,6 +335,37 @@ struct kmem_cache_args {
 	 * %NULL means no constructor.
 	 */
 	void (*ctor)(void *);
+	/**
+	 * @sheaf_capacity: Enable sheaves of given capacity for the cache.
+	 *
+	 * With a non-zero value, allocations from the cache go through caching
+	 * arrays called sheaves. Each cpu has a main sheaf that's always
+	 * present, and a spare sheaf that may be not present. When both become
+	 * empty, there's an attempt to replace an empty sheaf with a full sheaf
+	 * from the per-node barn.
+	 *
+	 * When no full sheaf is available, and gfp flags allow blocking, a
+	 * sheaf is allocated and filled from slab(s) using bulk allocation.
+	 * Otherwise the allocation falls back to the normal operation
+	 * allocating a single object from a slab.
+	 *
+	 * Analogically when freeing and both percpu sheaves are full, the barn
+	 * may replace it with an empty sheaf, unless it's over capacity. In
+	 * that case a sheaf is bulk freed to slab pages.
+	 *
+	 * The sheaves do not enforce NUMA placement of objects, so allocations
+	 * via kmem_cache_alloc_node() with a node specified other than
+	 * NUMA_NO_NODE will bypass them.
+	 *
+	 * Bulk allocation and free operations also try to use the cpu sheaves
+	 * and barn, but fallback to using slab pages directly.
+	 *
+	 * When slub_debug is enabled for the cache, the sheaf_capacity argument
+	 * is ignored.
+	 *
+	 * %0 means no sheaves will be created.
+	 */
+	unsigned int sheaf_capacity;
 };
 
 struct kmem_cache *__kmem_cache_create_args(const char *name,
@@ -474,6 +505,7 @@ void * __must_check krealloc_node_align_noprof(const void *objp, size_t new_size
 #define krealloc(...)			krealloc_node(__VA_ARGS__, NUMA_NO_NODE)
 
 void kfree(const void *objp);
+void kfree_nolock(const void *objp);
 void kfree_sensitive(const void *objp);
 size_t __ksize(const void *objp);
 
@@ -802,6 +834,22 @@ void *kmem_cache_alloc_node_noprof(struct kmem_cache *s, gfp_t flags,
 				   int node) __assume_slab_alignment __malloc;
 #define kmem_cache_alloc_node(...)	alloc_hooks(kmem_cache_alloc_node_noprof(__VA_ARGS__))
 
+struct slab_sheaf *
+kmem_cache_prefill_sheaf(struct kmem_cache *s, gfp_t gfp, unsigned int size);
+
+int kmem_cache_refill_sheaf(struct kmem_cache *s, gfp_t gfp,
+		struct slab_sheaf **sheafp, unsigned int size);
+
+void kmem_cache_return_sheaf(struct kmem_cache *s, gfp_t gfp,
+				       struct slab_sheaf *sheaf);
+
+void *kmem_cache_alloc_from_sheaf_noprof(struct kmem_cache *cachep, gfp_t gfp,
+			struct slab_sheaf *sheaf) __assume_slab_alignment __malloc;
+#define kmem_cache_alloc_from_sheaf(...)	\
+			alloc_hooks(kmem_cache_alloc_from_sheaf_noprof(__VA_ARGS__))
+
+unsigned int kmem_cache_sheaf_size(struct slab_sheaf *sheaf);
+
 /*
  * These macros allow declaring a kmem_buckets * parameter alongside size, which
  * can be compiled out with CONFIG_SLAB_BUCKETS=n so that a large number of call
@@ -914,6 +962,9 @@ static __always_inline __alloc_size(1) void *kmalloc_noprof(size_t size, gfp_t f
 }
 #define kmalloc(...)				alloc_hooks(kmalloc_noprof(__VA_ARGS__))
 
+void *kmalloc_nolock_noprof(size_t size, gfp_t gfp_flags, int node);
+#define kmalloc_nolock(...)			alloc_hooks(kmalloc_nolock_noprof(__VA_ARGS__))
+
 #define kmem_buckets_alloc(_b, _size, _flags)	\
 	alloc_hooks(__kmalloc_node_noprof(PASS_BUCKET_PARAMS(_size, _b), _flags, NUMA_NO_NODE))
 
diff --git a/include/linux/stddef.h b/include/linux/stddef.h
index dab49e2ec8c0..80b6bfb944f0 100644
--- a/include/linux/stddef.h
+++ b/include/linux/stddef.h
@@ -94,7 +94,8 @@ enum {
 	__DECLARE_FLEX_ARRAY(TYPE, NAME)
 
 /**
- * TRAILING_OVERLAP() - Overlap a flexible-array member with trailing members.
+ * __TRAILING_OVERLAP() - Overlap a flexible-array member with trailing
+ *			  members.
  *
  * Creates a union between a flexible-array member (FAM) in a struct and a set
  * of additional members that would otherwise follow it.
@@ -102,15 +103,30 @@ enum {
  * @TYPE: Flexible structure type name, including "struct" keyword.
  * @NAME: Name for a variable to define.
  * @FAM: The flexible-array member within @TYPE
+ * @ATTRS: Any struct attributes (usually empty)
  * @MEMBERS: Trailing overlapping members.
  */
-#define TRAILING_OVERLAP(TYPE, NAME, FAM, MEMBERS)				\
+#define __TRAILING_OVERLAP(TYPE, NAME, FAM, ATTRS, MEMBERS)			\
 	union {									\
 		TYPE NAME;							\
 		struct {							\
-			unsigned char __offset_to_##FAM[offsetof(TYPE, FAM)];	\
+			unsigned char __offset_to_FAM[offsetof(TYPE, FAM)];	\
 			MEMBERS							\
-		};								\
+		} ATTRS;							\
 	}
 
+/**
+ * TRAILING_OVERLAP() - Overlap a flexible-array member with trailing members.
+ *
+ * Creates a union between a flexible-array member (FAM) in a struct and a set
+ * of additional members that would otherwise follow it.
+ *
+ * @TYPE: Flexible structure type name, including "struct" keyword.
+ * @NAME: Name for a variable to define.
+ * @FAM: The flexible-array member within @TYPE
+ * @MEMBERS: Trailing overlapping members.
+ */
+#define TRAILING_OVERLAP(TYPE, NAME, FAM, MEMBERS)				\
+	__TRAILING_OVERLAP(TYPE, NAME, FAM, /* no attrs */, MEMBERS)
+
 #endif
diff --git a/include/linux/xarray.h b/include/linux/xarray.h
index be850174e802..2587225a3cbc 100644
--- a/include/linux/xarray.h
+++ b/include/linux/xarray.h
@@ -1413,16 +1413,44 @@ struct xa_state {
 			order - (order % XA_CHUNK_SHIFT),	\
 			(1U << (order % XA_CHUNK_SHIFT)) - 1)
 
+/**
+ * xas_invalid() - Is the xas in a retry or error state?
+ * @xas: XArray operation state.
+ *
+ * Return: %true if the xas cannot be used for operations.
+ */
+static inline bool xas_invalid(const struct xa_state *xas)
+{
+	return (unsigned long)xas->xa_node & 3;
+}
+
+/**
+ * xas_valid() - Is the xas a valid cursor into the array?
+ * @xas: XArray operation state.
+ *
+ * Return: %true if the xas can be used for operations.
+ */
+static inline bool xas_valid(const struct xa_state *xas)
+{
+	return !xas_invalid(xas);
+}
+
+static inline struct xa_state *XAS_INVALID(struct xa_state *xas)
+{
+	XA_NODE_BUG_ON(xas->xa_node, xas_valid(xas));
+	return xas;
+}
+
 #define xas_marked(xas, mark)	xa_marked((xas)->xa, (mark))
-#define xas_trylock(xas)	xa_trylock((xas)->xa)
-#define xas_lock(xas)		xa_lock((xas)->xa)
+#define xas_trylock(xas)	xa_trylock(XAS_INVALID(xas)->xa)
+#define xas_lock(xas)		xa_lock(XAS_INVALID(xas)->xa)
 #define xas_unlock(xas)		xa_unlock((xas)->xa)
-#define xas_lock_bh(xas)	xa_lock_bh((xas)->xa)
+#define xas_lock_bh(xas)	xa_lock_bh(XAS_INVALID(xas)->xa)
 #define xas_unlock_bh(xas)	xa_unlock_bh((xas)->xa)
-#define xas_lock_irq(xas)	xa_lock_irq((xas)->xa)
+#define xas_lock_irq(xas)	xa_lock_irq(XAS_INVALID(xas)->xa)
 #define xas_unlock_irq(xas)	xa_unlock_irq((xas)->xa)
 #define xas_lock_irqsave(xas, flags) \
-				xa_lock_irqsave((xas)->xa, flags)
+				xa_lock_irqsave(XAS_INVALID(xas)->xa, flags)
 #define xas_unlock_irqrestore(xas, flags) \
 				xa_unlock_irqrestore((xas)->xa, flags)
 
@@ -1451,28 +1479,6 @@ static inline void xas_set_err(struct xa_state *xas, long err)
 	xas->xa_node = XA_ERROR(err);
 }
 
-/**
- * xas_invalid() - Is the xas in a retry or error state?
- * @xas: XArray operation state.
- *
- * Return: %true if the xas cannot be used for operations.
- */
-static inline bool xas_invalid(const struct xa_state *xas)
-{
-	return (unsigned long)xas->xa_node & 3;
-}
-
-/**
- * xas_valid() - Is the xas a valid cursor into the array?
- * @xas: XArray operation state.
- *
- * Return: %true if the xas can be used for operations.
- */
-static inline bool xas_valid(const struct xa_state *xas)
-{
-	return !xas_invalid(xas);
-}
-
 /**
  * xas_is_node() - Does the xas point to a node?
  * @xas: XArray operation state.
diff --git a/init/Kconfig b/init/Kconfig
index 14d2a34f42a9..d295e79d3547 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -2093,8 +2093,8 @@ config RUST
 	depends on !GCC_PLUGIN_RANDSTRUCT
 	depends on !RANDSTRUCT
 	depends on !DEBUG_INFO_BTF || (PAHOLE_HAS_LANG_EXCLUDE && !LTO)
-	depends on !CFI_CLANG || HAVE_CFI_ICALL_NORMALIZE_INTEGERS_RUSTC
-	select CFI_ICALL_NORMALIZE_INTEGERS if CFI_CLANG
+	depends on !CFI || HAVE_CFI_ICALL_NORMALIZE_INTEGERS_RUSTC
+	select CFI_ICALL_NORMALIZE_INTEGERS if CFI
 	depends on !CALL_PADDING || RUSTC_VERSION >= 108100
 	depends on !KASAN_SW_TAGS
 	depends on !(MITIGATION_RETHUNK && KASAN) || RUSTC_VERSION >= 108300
diff --git a/kernel/Makefile b/kernel/Makefile
index 3077b9992c51..df3dd8291bb6 100644
--- a/kernel/Makefile
+++ b/kernel/Makefile
@@ -123,7 +123,7 @@ obj-$(CONFIG_KCSAN) += kcsan/
 obj-$(CONFIG_SHADOW_CALL_STACK) += scs.o
 obj-$(CONFIG_HAVE_STATIC_CALL) += static_call.o
 obj-$(CONFIG_HAVE_STATIC_CALL_INLINE) += static_call_inline.o
-obj-$(CONFIG_CFI_CLANG) += cfi.o
+obj-$(CONFIG_CFI) += cfi.o
 
 obj-$(CONFIG_PERF_EVENTS) += events/
 
diff --git a/kernel/bpf/stream.c b/kernel/bpf/stream.c
index ab592db4a4bf..eb6c5a21c2ef 100644
--- a/kernel/bpf/stream.c
+++ b/kernel/bpf/stream.c
@@ -83,7 +83,7 @@ static struct bpf_stream_page *bpf_stream_page_replace(void)
 	struct bpf_stream_page *stream_page, *old_stream_page;
 	struct page *page;
 
-	page = alloc_pages_nolock(NUMA_NO_NODE, 0);
+	page = alloc_pages_nolock(/* Don't account */ 0, NUMA_NO_NODE, 0);
 	if (!page)
 		return NULL;
 	stream_page = page_address(page);
diff --git a/kernel/bpf/syscall.c b/kernel/bpf/syscall.c
index a48fa86f82a7..2a9456a3e730 100644
--- a/kernel/bpf/syscall.c
+++ b/kernel/bpf/syscall.c
@@ -583,7 +583,7 @@ static bool can_alloc_pages(void)
 static struct page *__bpf_alloc_page(int nid)
 {
 	if (!can_alloc_pages())
-		return alloc_pages_nolock(nid, 0);
+		return alloc_pages_nolock(__GFP_ACCOUNT, nid, 0);
 
 	return alloc_pages_node(nid,
 				GFP_KERNEL | __GFP_ZERO | __GFP_ACCOUNT
diff --git a/kernel/configs/hardening.config b/kernel/configs/hardening.config
index 64caaf997fc0..7c3924614e01 100644
--- a/kernel/configs/hardening.config
+++ b/kernel/configs/hardening.config
@@ -93,8 +93,8 @@ CONFIG_SECCOMP_FILTER=y
 # Provides some protections against SYN flooding.
 CONFIG_SYN_COOKIES=y
 
-# Enable Kernel Control Flow Integrity (currently Clang only).
-CONFIG_CFI_CLANG=y
+# Enable Kernel Control Flow Integrity.
+CONFIG_CFI=y
 # CONFIG_CFI_PERMISSIVE is not set
 
 # Attack surface reduction: do not autoload TTY line disciplines.
diff --git a/kernel/debug/gdbstub.c b/kernel/debug/gdbstub.c
index f625172d4b67..22fe969c5d2e 100644
--- a/kernel/debug/gdbstub.c
+++ b/kernel/debug/gdbstub.c
@@ -30,6 +30,7 @@
 #include <linux/kgdb.h>
 #include <linux/kdb.h>
 #include <linux/serial_core.h>
+#include <linux/string.h>
 #include <linux/reboot.h>
 #include <linux/uaccess.h>
 #include <asm/cacheflush.h>
@@ -547,7 +548,7 @@ static void gdb_cmd_setregs(struct kgdb_state *ks)
 		error_packet(remcom_out_buffer, -EINVAL);
 	} else {
 		gdb_regs_to_pt_regs(gdb_regs, ks->linux_regs);
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 	}
 }
 
@@ -577,7 +578,7 @@ static void gdb_cmd_memwrite(struct kgdb_state *ks)
 	if (err)
 		error_packet(remcom_out_buffer, err);
 	else
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 }
 
 #if DBG_MAX_REG_NUM > 0
@@ -630,7 +631,7 @@ static void gdb_cmd_reg_set(struct kgdb_state *ks)
 	i = i / 2;
 	kgdb_hex2mem(ptr, (char *)gdb_regs, i);
 	dbg_set_reg(regnum, gdb_regs, ks->linux_regs);
-	strcpy(remcom_out_buffer, "OK");
+	strscpy(remcom_out_buffer, "OK");
 }
 #endif /* DBG_MAX_REG_NUM > 0 */
 
@@ -642,7 +643,7 @@ static void gdb_cmd_binwrite(struct kgdb_state *ks)
 	if (err)
 		error_packet(remcom_out_buffer, err);
 	else
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 }
 
 /* Handle the 'D' or 'k', detach or kill packets */
@@ -656,7 +657,7 @@ static void gdb_cmd_detachkill(struct kgdb_state *ks)
 		if (error < 0) {
 			error_packet(remcom_out_buffer, error);
 		} else {
-			strcpy(remcom_out_buffer, "OK");
+			strscpy(remcom_out_buffer, "OK");
 			kgdb_connected = 0;
 		}
 		put_packet(remcom_out_buffer);
@@ -676,7 +677,7 @@ static int gdb_cmd_reboot(struct kgdb_state *ks)
 	/* For now, only honor R0 */
 	if (strcmp(remcom_in_buffer, "R0") == 0) {
 		printk(KERN_CRIT "Executing emergency reboot\n");
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 		put_packet(remcom_out_buffer);
 
 		/*
@@ -739,7 +740,7 @@ static void gdb_cmd_query(struct kgdb_state *ks)
 
 	case 'C':
 		/* Current thread id */
-		strcpy(remcom_out_buffer, "QC");
+		strscpy(remcom_out_buffer, "QC");
 		ks->threadid = shadow_pid(current->pid);
 		int_to_threadref(thref, ks->threadid);
 		pack_threadid(remcom_out_buffer + 2, thref);
@@ -773,7 +774,7 @@ static void gdb_cmd_query(struct kgdb_state *ks)
 			int len = strlen(remcom_in_buffer + 6);
 
 			if ((len % 2) != 0) {
-				strcpy(remcom_out_buffer, "E01");
+				strscpy(remcom_out_buffer, "E01");
 				break;
 			}
 			kgdb_hex2mem(remcom_in_buffer + 6,
@@ -785,14 +786,14 @@ static void gdb_cmd_query(struct kgdb_state *ks)
 			kdb_parse(remcom_out_buffer);
 			kdb_common_deinit_state();
 
-			strcpy(remcom_out_buffer, "OK");
+			strscpy(remcom_out_buffer, "OK");
 		}
 		break;
 #endif
 #ifdef CONFIG_HAVE_ARCH_KGDB_QXFER_PKT
 	case 'S':
 		if (!strncmp(remcom_in_buffer, "qSupported:", 11))
-			strcpy(remcom_out_buffer, kgdb_arch_gdb_stub_feature);
+			strscpy(remcom_out_buffer, kgdb_arch_gdb_stub_feature);
 		break;
 	case 'X':
 		if (!strncmp(remcom_in_buffer, "qXfer:", 6))
@@ -822,7 +823,7 @@ static void gdb_cmd_task(struct kgdb_state *ks)
 		}
 		kgdb_usethread = thread;
 		ks->kgdb_usethreadid = ks->threadid;
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 		break;
 	case 'c':
 		ptr = &remcom_in_buffer[2];
@@ -837,7 +838,7 @@ static void gdb_cmd_task(struct kgdb_state *ks)
 			}
 			kgdb_contthread = thread;
 		}
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 		break;
 	}
 }
@@ -851,7 +852,7 @@ static void gdb_cmd_thread(struct kgdb_state *ks)
 	kgdb_hex2long(&ptr, &ks->threadid);
 	thread = getthread(ks->linux_regs, ks->threadid);
 	if (thread)
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 	else
 		error_packet(remcom_out_buffer, -EINVAL);
 }
@@ -913,7 +914,7 @@ static void gdb_cmd_break(struct kgdb_state *ks)
 			(int) length, *bpt_type - '0');
 
 	if (error == 0)
-		strcpy(remcom_out_buffer, "OK");
+		strscpy(remcom_out_buffer, "OK");
 	else
 		error_packet(remcom_out_buffer, error);
 }
diff --git a/kernel/debug/kdb/kdb_io.c b/kernel/debug/kdb/kdb_io.c
index 9b11b10b120c..b12b9db75c1d 100644
--- a/kernel/debug/kdb/kdb_io.c
+++ b/kernel/debug/kdb/kdb_io.c
@@ -714,8 +714,8 @@ int vkdb_printf(enum kdb_msgsrc src, const char *fmt, va_list ap)
 		 * it, depending on the results of the search.
 		 */
 		cp++;	 	     /* to byte after the newline */
-		replaced_byte = *cp; /* remember what/where it was */
-		cphold = cp;
+		replaced_byte = *cp; /* remember what it was */
+		cphold = cp;	     /* remember where it was */
 		*cp = '\0';	     /* end the string for our search */
 
 		/*
@@ -732,8 +732,9 @@ int vkdb_printf(enum kdb_msgsrc src, const char *fmt, va_list ap)
 			 * Shift the buffer left.
 			 */
 			*cphold = replaced_byte;
-			strcpy(kdb_buffer, cphold);
-			len = strlen(kdb_buffer);
+			len = strlen(cphold);
+			/* Use memmove() because the buffers overlap */
+			memmove(kdb_buffer, cphold, len + 1);
 			next_avail = kdb_buffer + len;
 			size_avail = sizeof(kdb_buffer) - len;
 			goto kdb_print_out;
@@ -872,8 +873,9 @@ int vkdb_printf(enum kdb_msgsrc src, const char *fmt, va_list ap)
 	 */
 	if (kdb_grepping_flag && !suspend_grep) {
 		*cphold = replaced_byte;
-		strcpy(kdb_buffer, cphold);
-		len = strlen(kdb_buffer);
+		len = strlen(cphold);
+		/* Use memmove() because the buffers overlap */
+		memmove(kdb_buffer, cphold, len + 1);
 		next_avail = kdb_buffer + len;
 		size_avail = sizeof(kdb_buffer) - len;
 	}
diff --git a/kernel/debug/kdb/kdb_keyboard.c b/kernel/debug/kdb/kdb_keyboard.c
index 3a74604fdb8a..386d30e530b7 100644
--- a/kernel/debug/kdb/kdb_keyboard.c
+++ b/kernel/debug/kdb/kdb_keyboard.c
@@ -145,9 +145,6 @@ int kdb_get_kbd_char(void)
 		return CTRL('F');
 	}
 
-	if (scancode == 0xe0)
-		return -1;
-
 	/*
 	 * For Japanese 86/106 keyboards
 	 * 	See comment in drivers/char/pc_keyb.c.
diff --git a/kernel/debug/kdb/kdb_main.c b/kernel/debug/kdb/kdb_main.c
index 7a4d2d4689a5..dddf2b5aad57 100644
--- a/kernel/debug/kdb/kdb_main.c
+++ b/kernel/debug/kdb/kdb_main.c
@@ -721,20 +721,12 @@ static int kdb_defcmd(int argc, const char **argv)
 	mp->name = kdb_strdup(argv[1], GFP_KDB);
 	if (!mp->name)
 		goto fail_name;
-	mp->usage = kdb_strdup(argv[2], GFP_KDB);
+	mp->usage = kdb_strdup_dequote(argv[2], GFP_KDB);
 	if (!mp->usage)
 		goto fail_usage;
-	mp->help = kdb_strdup(argv[3], GFP_KDB);
+	mp->help = kdb_strdup_dequote(argv[3], GFP_KDB);
 	if (!mp->help)
 		goto fail_help;
-	if (mp->usage[0] == '"') {
-		strcpy(mp->usage, argv[2]+1);
-		mp->usage[strlen(mp->usage)-1] = '\0';
-	}
-	if (mp->help[0] == '"') {
-		strcpy(mp->help, argv[3]+1);
-		mp->help[strlen(mp->help)-1] = '\0';
-	}
 
 	INIT_LIST_HEAD(&kdb_macro->statements);
 	defcmd_in_progress = true;
@@ -860,7 +852,7 @@ static void parse_grep(const char *str)
 		kdb_printf("search string too long\n");
 		return;
 	}
-	strcpy(kdb_grep_string, cp);
+	memcpy(kdb_grep_string, cp, len + 1);
 	kdb_grepping_flag++;
 	return;
 }
diff --git a/kernel/debug/kdb/kdb_private.h b/kernel/debug/kdb/kdb_private.h
index d2520d72b1f5..a2fc7d2bc9fc 100644
--- a/kernel/debug/kdb/kdb_private.h
+++ b/kernel/debug/kdb/kdb_private.h
@@ -110,6 +110,7 @@ extern int kdbgetaddrarg(int, const char **, int*, unsigned long *,
 extern int kdbgetsymval(const char *, kdb_symtab_t *);
 extern int kdbnearsym(unsigned long, kdb_symtab_t *);
 extern char *kdb_strdup(const char *str, gfp_t type);
+extern char *kdb_strdup_dequote(const char *str, gfp_t type);
 extern void kdb_symbol_print(unsigned long, const kdb_symtab_t *, unsigned int);
 
 /* Routine for debugging the debugger state. */
diff --git a/kernel/debug/kdb/kdb_support.c b/kernel/debug/kdb/kdb_support.c
index 05b137e7dcb9..56f7b906e7cc 100644
--- a/kernel/debug/kdb/kdb_support.c
+++ b/kernel/debug/kdb/kdb_support.c
@@ -23,6 +23,7 @@
 #include <linux/uaccess.h>
 #include <linux/kdb.h>
 #include <linux/slab.h>
+#include <linux/string.h>
 #include <linux/ctype.h>
 #include "kdb_private.h"
 
@@ -246,11 +247,41 @@ void kdb_symbol_print(unsigned long addr, const kdb_symtab_t *symtab_p,
  */
 char *kdb_strdup(const char *str, gfp_t type)
 {
-	int n = strlen(str)+1;
+	size_t n = strlen(str) + 1;
 	char *s = kmalloc(n, type);
 	if (!s)
 		return NULL;
-	return strcpy(s, str);
+	memcpy(s, str, n);
+	return s;
+}
+
+/*
+ * kdb_strdup_dequote - same as kdb_strdup(), but trims surrounding quotes from
+ *			the input string if present.
+ * Remarks:
+ *	Quotes are only removed if there is both a leading and a trailing quote.
+ */
+char *kdb_strdup_dequote(const char *str, gfp_t type)
+{
+	size_t len = strlen(str);
+	char *s;
+
+	if (str[0] == '"' && len > 1 && str[len - 1] == '"') {
+		/* trim both leading and trailing quotes */
+		str++;
+		len -= 2;
+	}
+
+	len++; /* add space for NUL terminator */
+
+	s = kmalloc(len, type);
+	if (!s)
+		return NULL;
+
+	memcpy(s, str, len - 1);
+	s[len - 1] = '\0';
+
+	return s;
 }
 
 /*
diff --git a/kernel/entry/Makefile b/kernel/entry/Makefile
index 77fcd83dd663..2333d70802e4 100644
--- a/kernel/entry/Makefile
+++ b/kernel/entry/Makefile
@@ -14,4 +14,4 @@ CFLAGS_common.o		+= -fno-stack-protector
 
 obj-$(CONFIG_GENERIC_IRQ_ENTRY) 	+= common.o
 obj-$(CONFIG_GENERIC_SYSCALL) 		+= syscall-common.o syscall_user_dispatch.o
-obj-$(CONFIG_KVM_XFER_TO_GUEST_WORK)	+= kvm.o
+obj-$(CONFIG_VIRT_XFER_TO_GUEST_WORK)	+= virt.o
diff --git a/kernel/entry/kvm.c b/kernel/entry/virt.c
similarity index 66%
rename from kernel/entry/kvm.c
rename to kernel/entry/virt.c
index 8485f63863af..c52f99249763 100644
--- a/kernel/entry/kvm.c
+++ b/kernel/entry/virt.c
@@ -1,17 +1,14 @@
 // SPDX-License-Identifier: GPL-2.0
 
-#include <linux/entry-kvm.h>
-#include <linux/kvm_host.h>
+#include <linux/entry-virt.h>
 
-static int xfer_to_guest_mode_work(struct kvm_vcpu *vcpu, unsigned long ti_work)
+static int xfer_to_guest_mode_work(unsigned long ti_work)
 {
 	do {
 		int ret;
 
-		if (ti_work & (_TIF_SIGPENDING | _TIF_NOTIFY_SIGNAL)) {
-			kvm_handle_signal_exit(vcpu);
+		if (ti_work & (_TIF_SIGPENDING | _TIF_NOTIFY_SIGNAL))
 			return -EINTR;
-		}
 
 		if (ti_work & (_TIF_NEED_RESCHED | _TIF_NEED_RESCHED_LAZY))
 			schedule();
@@ -19,7 +16,7 @@ static int xfer_to_guest_mode_work(struct kvm_vcpu *vcpu, unsigned long ti_work)
 		if (ti_work & _TIF_NOTIFY_RESUME)
 			resume_user_mode_work(NULL);
 
-		ret = arch_xfer_to_guest_mode_handle_work(vcpu, ti_work);
+		ret = arch_xfer_to_guest_mode_handle_work(ti_work);
 		if (ret)
 			return ret;
 
@@ -28,7 +25,7 @@ static int xfer_to_guest_mode_work(struct kvm_vcpu *vcpu, unsigned long ti_work)
 	return 0;
 }
 
-int xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu)
+int xfer_to_guest_mode_handle_work(void)
 {
 	unsigned long ti_work;
 
@@ -44,6 +41,6 @@ int xfer_to_guest_mode_handle_work(struct kvm_vcpu *vcpu)
 	if (!(ti_work & XFER_TO_GUEST_MODE_WORK))
 		return 0;
 
-	return xfer_to_guest_mode_work(vcpu, ti_work);
+	return xfer_to_guest_mode_work(ti_work);
 }
 EXPORT_SYMBOL_GPL(xfer_to_guest_mode_handle_work);
diff --git a/kernel/kcsan/kcsan_test.c b/kernel/kcsan/kcsan_test.c
index a13a090bb2a7..219d22857c98 100644
--- a/kernel/kcsan/kcsan_test.c
+++ b/kernel/kcsan/kcsan_test.c
@@ -125,7 +125,7 @@ static void probe_console(void *ignore, const char *buf, size_t len)
 				goto out;
 
 			/* No second line of interest. */
-			strcpy(observed.lines[nlines++], "<none>");
+			strscpy(observed.lines[nlines++], "<none>");
 		}
 	}
 
@@ -231,7 +231,7 @@ static bool __report_matches(const struct expect_report *r)
 
 			if (!r->access[1].fn) {
 				/* Dummy string if no second access is available. */
-				strcpy(cur, "<none>");
+				strscpy(expect[2], "<none>");
 				break;
 			}
 		}
diff --git a/kernel/locking/rtmutex_common.h b/kernel/locking/rtmutex_common.h
index 78dd3d8c6554..cf6ddd1b23a2 100644
--- a/kernel/locking/rtmutex_common.h
+++ b/kernel/locking/rtmutex_common.h
@@ -153,15 +153,6 @@ static inline struct rt_mutex_waiter *task_top_pi_waiter(struct task_struct *p)
 			pi_tree.entry);
 }
 
-#define RT_MUTEX_HAS_WAITERS	1UL
-
-static inline struct task_struct *rt_mutex_owner(struct rt_mutex_base *lock)
-{
-	unsigned long owner = (unsigned long) READ_ONCE(lock->owner);
-
-	return (struct task_struct *) (owner & ~RT_MUTEX_HAS_WAITERS);
-}
-
 /*
  * Constants for rt mutex functions which have a selectable deadlock
  * detection.
diff --git a/kernel/module/Kconfig b/kernel/module/Kconfig
index 39278737bb68..2a1beebf1d37 100644
--- a/kernel/module/Kconfig
+++ b/kernel/module/Kconfig
@@ -460,6 +460,6 @@ config UNUSED_KSYMS_WHITELIST
 
 config MODULES_TREE_LOOKUP
 	def_bool y
-	depends on PERF_EVENTS || TRACING || CFI_CLANG
+	depends on PERF_EVENTS || TRACING || CFI
 
 endif # MODULES
diff --git a/kernel/module/tree_lookup.c b/kernel/module/tree_lookup.c
index d3204c5c74eb..f8e8c126705c 100644
--- a/kernel/module/tree_lookup.c
+++ b/kernel/module/tree_lookup.c
@@ -14,7 +14,7 @@
  * Use a latched RB-tree for __module_address(); this allows us to use
  * RCU lookups of the address from any context.
  *
- * This is conditional on PERF_EVENTS || TRACING || CFI_CLANG because those can
+ * This is conditional on PERF_EVENTS || TRACING || CFI because those can
  * really hit __module_address() hard by doing a lot of stack unwinding;
  * potentially from NMI context.
  */
diff --git a/kernel/rcu/tree.c b/kernel/rcu/tree.c
index 31690ffa452a..8293bae1dec1 100644
--- a/kernel/rcu/tree.c
+++ b/kernel/rcu/tree.c
@@ -573,7 +573,7 @@ void rcutorture_format_gp_seqs(unsigned long long seqs, char *cp, size_t len)
 }
 EXPORT_SYMBOL_GPL(rcutorture_format_gp_seqs);
 
-#if defined(CONFIG_NO_HZ_FULL) && (!defined(CONFIG_GENERIC_ENTRY) || !defined(CONFIG_KVM_XFER_TO_GUEST_WORK))
+#if defined(CONFIG_NO_HZ_FULL) && (!defined(CONFIG_GENERIC_ENTRY) || !defined(CONFIG_VIRT_XFER_TO_GUEST_WORK))
 /*
  * An empty function that will trigger a reschedule on
  * IRQ tail once IRQs get re-enabled on userspace/guest resume.
@@ -602,7 +602,7 @@ noinstr void rcu_irq_work_resched(void)
 	if (IS_ENABLED(CONFIG_GENERIC_ENTRY) && !(current->flags & PF_VCPU))
 		return;
 
-	if (IS_ENABLED(CONFIG_KVM_XFER_TO_GUEST_WORK) && (current->flags & PF_VCPU))
+	if (IS_ENABLED(CONFIG_VIRT_XFER_TO_GUEST_WORK) && (current->flags & PF_VCPU))
 		return;
 
 	instrumentation_begin();
@@ -611,7 +611,7 @@ noinstr void rcu_irq_work_resched(void)
 	}
 	instrumentation_end();
 }
-#endif /* #if defined(CONFIG_NO_HZ_FULL) && (!defined(CONFIG_GENERIC_ENTRY) || !defined(CONFIG_KVM_XFER_TO_GUEST_WORK)) */
+#endif /* #if defined(CONFIG_NO_HZ_FULL) && (!defined(CONFIG_GENERIC_ENTRY) || !defined(CONFIG_VIRT_XFER_TO_GUEST_WORK)) */
 
 #ifdef CONFIG_PROVE_RCU
 /**
diff --git a/kernel/seccomp.c b/kernel/seccomp.c
index 7daf2da09e8e..25f62867a16d 100644
--- a/kernel/seccomp.c
+++ b/kernel/seccomp.c
@@ -1157,7 +1157,7 @@ static void seccomp_handle_addfd(struct seccomp_kaddfd *addfd, struct seccomp_kn
 static bool should_sleep_killable(struct seccomp_filter *match,
 				  struct seccomp_knotif *n)
 {
-	return match->wait_killable_recv && n->state == SECCOMP_NOTIFY_SENT;
+	return match->wait_killable_recv && n->state >= SECCOMP_NOTIFY_SENT;
 }
 
 static int seccomp_do_user_notification(int this_syscall,
@@ -1204,13 +1204,11 @@ static int seccomp_do_user_notification(int this_syscall,
 
 		if (err != 0) {
 			/*
-			 * Check to see if the notifcation got picked up and
-			 * whether we should switch to wait killable.
+			 * Check to see whether we should switch to wait
+			 * killable. Only return the interrupted error if not.
 			 */
-			if (!wait_killable && should_sleep_killable(match, &n))
-				continue;
-
-			goto interrupted;
+			if (!(!wait_killable && should_sleep_killable(match, &n)))
+				goto interrupted;
 		}
 
 		addfd = list_first_entry_or_null(&n.addfd,
diff --git a/lib/Kconfig.debug b/lib/Kconfig.debug
index 9e5ca54a311f..8aaaf72ec4f7 100644
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -2483,6 +2483,20 @@ config STRING_HELPERS_KUNIT_TEST
 	depends on KUNIT
 	default KUNIT_ALL_TESTS
 
+config FFS_KUNIT_TEST
+	tristate "KUnit test ffs-family functions at runtime" if !KUNIT_ALL_TESTS
+	depends on KUNIT
+	default KUNIT_ALL_TESTS
+	help
+	  This builds KUnit tests for ffs-family bit manipulation functions
+	  including ffs(), __ffs(), fls(), __fls(), fls64(), and __ffs64().
+
+	  These tests validate mathematical correctness, edge case handling,
+	  and cross-architecture consistency of bit scanning functions.
+
+	  For more information on KUnit and unit tests in general,
+	  please refer to Documentation/dev-tools/kunit/.
+
 config TEST_KSTRTOX
 	tristate "Test kstrto*() family of functions at runtime"
 
@@ -2611,6 +2625,19 @@ config FIND_BIT_BENCHMARK
 
 	  If unsure, say N.
 
+config FIND_BIT_BENCHMARK_RUST
+	tristate "Test find_bit functions in Rust"
+	depends on RUST
+	help
+	  This builds the "find_bit_benchmark_rust" module. It is a micro
+          benchmark that measures the performance of Rust functions that
+          correspond to the find_*_bit() operations in C. It follows the
+          FIND_BIT_BENCHMARK closely but will in general not yield same
+          numbers due to extra bounds checks and overhead of foreign
+          function calls.
+
+	  If unsure, say N.
+
 config TEST_FIRMWARE
 	tristate "Test firmware loading via userspace interface"
 	depends on FW_LOADER
@@ -2898,7 +2925,7 @@ config FORTIFY_KUNIT_TEST
 config LONGEST_SYM_KUNIT_TEST
 	tristate "Test the longest symbol possible" if !KUNIT_ALL_TESTS
 	depends on KUNIT && KPROBES
-	depends on !PREFIX_SYMBOLS && !CFI_CLANG && !GCOV_KERNEL
+	depends on !PREFIX_SYMBOLS && !CFI && !GCOV_KERNEL
 	default KUNIT_ALL_TESTS
 	help
 	  Tests the longest symbol possible
diff --git a/lib/Makefile b/lib/Makefile
index 15a03f4c16e2..1ab2c4be3b66 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -62,6 +62,7 @@ obj-y += hexdump.o
 obj-$(CONFIG_TEST_HEXDUMP) += test_hexdump.o
 obj-y += kstrtox.o
 obj-$(CONFIG_FIND_BIT_BENCHMARK) += find_bit_benchmark.o
+obj-$(CONFIG_FIND_BIT_BENCHMARK_RUST) += find_bit_benchmark_rust.o
 obj-$(CONFIG_TEST_BPF) += test_bpf.o
 test_dhry-objs := dhry_1.o dhry_2.o dhry_run.o
 obj-$(CONFIG_TEST_DHRY) += test_dhry.o
diff --git a/lib/clz_ctz.c b/lib/clz_ctz.c
index fb8c0c5c2bd2..8778ec44bf63 100644
--- a/lib/clz_ctz.c
+++ b/lib/clz_ctz.c
@@ -15,28 +15,28 @@
 #include <linux/kernel.h>
 
 int __weak __ctzsi2(int val);
-int __weak __ctzsi2(int val)
+int __weak __attribute_const__ __ctzsi2(int val)
 {
 	return __ffs(val);
 }
 EXPORT_SYMBOL(__ctzsi2);
 
 int __weak __clzsi2(int val);
-int __weak __clzsi2(int val)
+int __weak __attribute_const__ __clzsi2(int val)
 {
 	return 32 - fls(val);
 }
 EXPORT_SYMBOL(__clzsi2);
 
 int __weak __clzdi2(u64 val);
-int __weak __clzdi2(u64 val)
+int __weak __attribute_const__ __clzdi2(u64 val)
 {
 	return 64 - fls64(val);
 }
 EXPORT_SYMBOL(__clzdi2);
 
 int __weak __ctzdi2(u64 val);
-int __weak __ctzdi2(u64 val)
+int __weak __attribute_const__ __ctzdi2(u64 val)
 {
 	return __ffs64(val);
 }
diff --git a/lib/crc/arm/crc-t10dif.h b/lib/crc/arm/crc-t10dif.h
index 2edf7e9681d0..63441de5e3f1 100644
--- a/lib/crc/arm/crc-t10dif.h
+++ b/lib/crc/arm/crc-t10dif.h
@@ -5,8 +5,6 @@
  * Copyright (C) 2016 Linaro Ltd <ard.biesheuvel@linaro.org>
  */
 
-#include <crypto/internal/simd.h>
-
 #include <asm/neon.h>
 #include <asm/simd.h>
 
@@ -23,7 +21,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *data, size_t length)
 {
 	if (length >= CRC_T10DIF_PMULL_CHUNK_SIZE) {
 		if (static_branch_likely(&have_pmull)) {
-			if (crypto_simd_usable()) {
+			if (likely(may_use_simd())) {
 				kernel_neon_begin();
 				crc = crc_t10dif_pmull64(crc, data, length);
 				kernel_neon_end();
@@ -31,7 +29,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *data, size_t length)
 			}
 		} else if (length > CRC_T10DIF_PMULL_CHUNK_SIZE &&
 			   static_branch_likely(&have_neon) &&
-			   crypto_simd_usable()) {
+			   likely(may_use_simd())) {
 			u8 buf[16] __aligned(16);
 
 			kernel_neon_begin();
@@ -45,7 +43,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *data, size_t length)
 }
 
 #define crc_t10dif_mod_init_arch crc_t10dif_mod_init_arch
-static inline void crc_t10dif_mod_init_arch(void)
+static void crc_t10dif_mod_init_arch(void)
 {
 	if (elf_hwcap & HWCAP_NEON) {
 		static_branch_enable(&have_neon);
diff --git a/lib/crc/arm/crc32.h b/lib/crc/arm/crc32.h
index 018007e162a2..7b76f52f6907 100644
--- a/lib/crc/arm/crc32.h
+++ b/lib/crc/arm/crc32.h
@@ -7,8 +7,6 @@
 
 #include <linux/cpufeature.h>
 
-#include <crypto/internal/simd.h>
-
 #include <asm/hwcap.h>
 #include <asm/neon.h>
 #include <asm/simd.h>
@@ -34,7 +32,7 @@ static inline u32 crc32_le_scalar(u32 crc, const u8 *p, size_t len)
 static inline u32 crc32_le_arch(u32 crc, const u8 *p, size_t len)
 {
 	if (len >= PMULL_MIN_LEN + 15 &&
-	    static_branch_likely(&have_pmull) && crypto_simd_usable()) {
+	    static_branch_likely(&have_pmull) && likely(may_use_simd())) {
 		size_t n = -(uintptr_t)p & 15;
 
 		/* align p to 16-byte boundary */
@@ -63,7 +61,7 @@ static inline u32 crc32c_scalar(u32 crc, const u8 *p, size_t len)
 static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 {
 	if (len >= PMULL_MIN_LEN + 15 &&
-	    static_branch_likely(&have_pmull) && crypto_simd_usable()) {
+	    static_branch_likely(&have_pmull) && likely(may_use_simd())) {
 		size_t n = -(uintptr_t)p & 15;
 
 		/* align p to 16-byte boundary */
@@ -85,7 +83,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 #define crc32_be_arch crc32_be_base /* not implemented on this arch */
 
 #define crc32_mod_init_arch crc32_mod_init_arch
-static inline void crc32_mod_init_arch(void)
+static void crc32_mod_init_arch(void)
 {
 	if (elf_hwcap2 & HWCAP2_CRC32)
 		static_branch_enable(&have_crc32);
diff --git a/lib/crc/arm64/crc-t10dif.h b/lib/crc/arm64/crc-t10dif.h
index c4521a7f1ee9..f88db2971805 100644
--- a/lib/crc/arm64/crc-t10dif.h
+++ b/lib/crc/arm64/crc-t10dif.h
@@ -7,8 +7,6 @@
 
 #include <linux/cpufeature.h>
 
-#include <crypto/internal/simd.h>
-
 #include <asm/neon.h>
 #include <asm/simd.h>
 
@@ -25,7 +23,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *data, size_t length)
 {
 	if (length >= CRC_T10DIF_PMULL_CHUNK_SIZE) {
 		if (static_branch_likely(&have_pmull)) {
-			if (crypto_simd_usable()) {
+			if (likely(may_use_simd())) {
 				kernel_neon_begin();
 				crc = crc_t10dif_pmull_p64(crc, data, length);
 				kernel_neon_end();
@@ -33,7 +31,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *data, size_t length)
 			}
 		} else if (length > CRC_T10DIF_PMULL_CHUNK_SIZE &&
 			   static_branch_likely(&have_asimd) &&
-			   crypto_simd_usable()) {
+			   likely(may_use_simd())) {
 			u8 buf[16];
 
 			kernel_neon_begin();
@@ -47,7 +45,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *data, size_t length)
 }
 
 #define crc_t10dif_mod_init_arch crc_t10dif_mod_init_arch
-static inline void crc_t10dif_mod_init_arch(void)
+static void crc_t10dif_mod_init_arch(void)
 {
 	if (cpu_have_named_feature(ASIMD)) {
 		static_branch_enable(&have_asimd);
diff --git a/lib/crc/arm64/crc32.h b/lib/crc/arm64/crc32.h
index 6e5dec45f05d..31e649cd40a2 100644
--- a/lib/crc/arm64/crc32.h
+++ b/lib/crc/arm64/crc32.h
@@ -5,8 +5,6 @@
 #include <asm/neon.h>
 #include <asm/simd.h>
 
-#include <crypto/internal/simd.h>
-
 // The minimum input length to consider the 4-way interleaved code path
 static const size_t min_len = 1024;
 
@@ -23,7 +21,8 @@ static inline u32 crc32_le_arch(u32 crc, const u8 *p, size_t len)
 	if (!alternative_has_cap_likely(ARM64_HAS_CRC32))
 		return crc32_le_base(crc, p, len);
 
-	if (len >= min_len && cpu_have_named_feature(PMULL) && crypto_simd_usable()) {
+	if (len >= min_len && cpu_have_named_feature(PMULL) &&
+	    likely(may_use_simd())) {
 		kernel_neon_begin();
 		crc = crc32_le_arm64_4way(crc, p, len);
 		kernel_neon_end();
@@ -43,7 +42,8 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 	if (!alternative_has_cap_likely(ARM64_HAS_CRC32))
 		return crc32c_base(crc, p, len);
 
-	if (len >= min_len && cpu_have_named_feature(PMULL) && crypto_simd_usable()) {
+	if (len >= min_len && cpu_have_named_feature(PMULL) &&
+	    likely(may_use_simd())) {
 		kernel_neon_begin();
 		crc = crc32c_le_arm64_4way(crc, p, len);
 		kernel_neon_end();
@@ -63,7 +63,8 @@ static inline u32 crc32_be_arch(u32 crc, const u8 *p, size_t len)
 	if (!alternative_has_cap_likely(ARM64_HAS_CRC32))
 		return crc32_be_base(crc, p, len);
 
-	if (len >= min_len && cpu_have_named_feature(PMULL) && crypto_simd_usable()) {
+	if (len >= min_len && cpu_have_named_feature(PMULL) &&
+	    likely(may_use_simd())) {
 		kernel_neon_begin();
 		crc = crc32_be_arm64_4way(crc, p, len);
 		kernel_neon_end();
diff --git a/lib/crc/loongarch/crc32.h b/lib/crc/loongarch/crc32.h
index 6de5c96594af..d34fa4c68632 100644
--- a/lib/crc/loongarch/crc32.h
+++ b/lib/crc/loongarch/crc32.h
@@ -101,7 +101,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 #define crc32_be_arch crc32_be_base /* not implemented on this arch */
 
 #define crc32_mod_init_arch crc32_mod_init_arch
-static inline void crc32_mod_init_arch(void)
+static void crc32_mod_init_arch(void)
 {
 	if (cpu_has_crc32)
 		static_branch_enable(&have_crc32);
diff --git a/lib/crc/mips/crc32.h b/lib/crc/mips/crc32.h
index 11cb272c63a6..3100354a049e 100644
--- a/lib/crc/mips/crc32.h
+++ b/lib/crc/mips/crc32.h
@@ -148,7 +148,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 #define crc32_be_arch crc32_be_base /* not implemented on this arch */
 
 #define crc32_mod_init_arch crc32_mod_init_arch
-static inline void crc32_mod_init_arch(void)
+static void crc32_mod_init_arch(void)
 {
 	if (cpu_have_feature(cpu_feature(MIPS_CRC32)))
 		static_branch_enable(&have_crc32);
diff --git a/lib/crc/powerpc/crc-t10dif.h b/lib/crc/powerpc/crc-t10dif.h
index 59e16804a6ea..8f4592a5323d 100644
--- a/lib/crc/powerpc/crc-t10dif.h
+++ b/lib/crc/powerpc/crc-t10dif.h
@@ -6,8 +6,8 @@
  * [based on crc32c-vpmsum_glue.c]
  */
 
+#include <asm/simd.h>
 #include <asm/switch_to.h>
-#include <crypto/internal/simd.h>
 #include <linux/cpufeature.h>
 #include <linux/jump_label.h>
 #include <linux/preempt.h>
@@ -29,7 +29,8 @@ static inline u16 crc_t10dif_arch(u16 crci, const u8 *p, size_t len)
 	u32 crc = crci;
 
 	if (len < (VECTOR_BREAKPOINT + VMX_ALIGN) ||
-	    !static_branch_likely(&have_vec_crypto) || !crypto_simd_usable())
+	    !static_branch_likely(&have_vec_crypto) ||
+	    unlikely(!may_use_simd()))
 		return crc_t10dif_generic(crc, p, len);
 
 	if ((unsigned long)p & VMX_ALIGN_MASK) {
@@ -61,7 +62,7 @@ static inline u16 crc_t10dif_arch(u16 crci, const u8 *p, size_t len)
 }
 
 #define crc_t10dif_mod_init_arch crc_t10dif_mod_init_arch
-static inline void crc_t10dif_mod_init_arch(void)
+static void crc_t10dif_mod_init_arch(void)
 {
 	if (cpu_has_feature(CPU_FTR_ARCH_207S) &&
 	    (cur_cpu_spec->cpu_user_features2 & PPC_FEATURE2_VEC_CRYPTO))
diff --git a/lib/crc/powerpc/crc32.h b/lib/crc/powerpc/crc32.h
index 811cc2e6ed24..0c852272a382 100644
--- a/lib/crc/powerpc/crc32.h
+++ b/lib/crc/powerpc/crc32.h
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier: GPL-2.0-only
+#include <asm/simd.h>
 #include <asm/switch_to.h>
-#include <crypto/internal/simd.h>
 #include <linux/cpufeature.h>
 #include <linux/jump_label.h>
 #include <linux/preempt.h>
@@ -24,7 +24,8 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 	unsigned int tail;
 
 	if (len < (VECTOR_BREAKPOINT + VMX_ALIGN) ||
-	    !static_branch_likely(&have_vec_crypto) || !crypto_simd_usable())
+	    !static_branch_likely(&have_vec_crypto) ||
+	    unlikely(!may_use_simd()))
 		return crc32c_base(crc, p, len);
 
 	if ((unsigned long)p & VMX_ALIGN_MASK) {
@@ -54,7 +55,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 }
 
 #define crc32_mod_init_arch crc32_mod_init_arch
-static inline void crc32_mod_init_arch(void)
+static void crc32_mod_init_arch(void)
 {
 	if (cpu_has_feature(CPU_FTR_ARCH_207S) &&
 	    (cur_cpu_spec->cpu_user_features2 & PPC_FEATURE2_VEC_CRYPTO))
diff --git a/lib/crc/sparc/crc32.h b/lib/crc/sparc/crc32.h
index 60f2765ac015..df7c350acd7b 100644
--- a/lib/crc/sparc/crc32.h
+++ b/lib/crc/sparc/crc32.h
@@ -44,7 +44,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *data, size_t len)
 }
 
 #define crc32_mod_init_arch crc32_mod_init_arch
-static inline void crc32_mod_init_arch(void)
+static void crc32_mod_init_arch(void)
 {
 	unsigned long cfr;
 
diff --git a/lib/crc/tests/crc_kunit.c b/lib/crc/tests/crc_kunit.c
index f08d985d8860..9a450e25ac81 100644
--- a/lib/crc/tests/crc_kunit.c
+++ b/lib/crc/tests/crc_kunit.c
@@ -6,6 +6,7 @@
  *
  * Author: Eric Biggers <ebiggers@google.com>
  */
+#include <kunit/run-in-irq-context.h>
 #include <kunit/test.h>
 #include <linux/crc7.h>
 #include <linux/crc16.h>
@@ -141,6 +142,54 @@ static size_t generate_random_length(size_t max_length)
 	return len % (max_length + 1);
 }
 
+#define IRQ_TEST_DATA_LEN 512
+#define IRQ_TEST_NUM_BUFFERS 3 /* matches max concurrency level */
+
+struct crc_irq_test_state {
+	const struct crc_variant *v;
+	u64 initial_crc;
+	u64 expected_crcs[IRQ_TEST_NUM_BUFFERS];
+	atomic_t seqno;
+};
+
+/*
+ * Compute the CRC of one of the test messages and verify that it matches the
+ * expected CRC from @state->expected_crcs.  To increase the chance of detecting
+ * problems, cycle through multiple messages.
+ */
+static bool crc_irq_test_func(void *state_)
+{
+	struct crc_irq_test_state *state = state_;
+	const struct crc_variant *v = state->v;
+	u32 i = (u32)atomic_inc_return(&state->seqno) % IRQ_TEST_NUM_BUFFERS;
+	u64 actual_crc = v->func(state->initial_crc,
+				 &test_buffer[i * IRQ_TEST_DATA_LEN],
+				 IRQ_TEST_DATA_LEN);
+
+	return actual_crc == state->expected_crcs[i];
+}
+
+/*
+ * Test that if CRCs are computed in task, softirq, and hardirq context
+ * concurrently, then all results are as expected.
+ */
+static void crc_interrupt_context_test(struct kunit *test,
+				       const struct crc_variant *v)
+{
+	struct crc_irq_test_state state = {
+		.v = v,
+		.initial_crc = generate_random_initial_crc(v),
+	};
+
+	for (int i = 0; i < IRQ_TEST_NUM_BUFFERS; i++) {
+		state.expected_crcs[i] = crc_ref(
+			v, state.initial_crc,
+			&test_buffer[i * IRQ_TEST_DATA_LEN], IRQ_TEST_DATA_LEN);
+	}
+
+	kunit_run_irq_test(test, crc_irq_test_func, 100000, &state);
+}
+
 /* Test that v->func gives the same CRCs as a reference implementation. */
 static void crc_test(struct kunit *test, const struct crc_variant *v)
 {
@@ -149,7 +198,6 @@ static void crc_test(struct kunit *test, const struct crc_variant *v)
 	for (i = 0; i < CRC_KUNIT_NUM_TEST_ITERS; i++) {
 		u64 init_crc, expected_crc, actual_crc;
 		size_t len, offset;
-		bool nosimd;
 
 		init_crc = generate_random_initial_crc(v);
 		len = generate_random_length(CRC_KUNIT_MAX_LEN);
@@ -168,22 +216,18 @@ static void crc_test(struct kunit *test, const struct crc_variant *v)
 			/* Refresh the data occasionally. */
 			prandom_bytes_state(&rng, &test_buffer[offset], len);
 
-		nosimd = rand32() % 8 == 0;
-
 		/*
 		 * Compute the CRC, and verify that it equals the CRC computed
 		 * by a simple bit-at-a-time reference implementation.
 		 */
 		expected_crc = crc_ref(v, init_crc, &test_buffer[offset], len);
-		if (nosimd)
-			local_irq_disable();
 		actual_crc = v->func(init_crc, &test_buffer[offset], len);
-		if (nosimd)
-			local_irq_enable();
 		KUNIT_EXPECT_EQ_MSG(test, expected_crc, actual_crc,
-				    "Wrong result with len=%zu offset=%zu nosimd=%d",
-				    len, offset, nosimd);
+				    "Wrong result with len=%zu offset=%zu",
+				    len, offset);
 	}
+
+	crc_interrupt_context_test(test, v);
 }
 
 static __always_inline void
diff --git a/lib/crc/x86/crc-pclmul-template.h b/lib/crc/x86/crc-pclmul-template.h
index 35c950d7010c..02744831c6fa 100644
--- a/lib/crc/x86/crc-pclmul-template.h
+++ b/lib/crc/x86/crc-pclmul-template.h
@@ -12,7 +12,6 @@
 
 #include <asm/cpufeatures.h>
 #include <asm/simd.h>
-#include <crypto/internal/simd.h>
 #include <linux/static_call.h>
 #include "crc-pclmul-consts.h"
 
@@ -57,7 +56,7 @@ static inline bool have_avx512(void)
 #define CRC_PCLMUL(crc, p, len, prefix, consts, have_pclmulqdq)		\
 do {									\
 	if ((len) >= 16 && static_branch_likely(&(have_pclmulqdq)) &&	\
-	    crypto_simd_usable()) {					\
+	    likely(irq_fpu_usable())) {					\
 		const void *consts_ptr;					\
 									\
 		consts_ptr = (consts).fold_across_128_bits_consts;	\
diff --git a/lib/crc/x86/crc-t10dif.h b/lib/crc/x86/crc-t10dif.h
index 2a02a3026f3f..8ee8824da551 100644
--- a/lib/crc/x86/crc-t10dif.h
+++ b/lib/crc/x86/crc-t10dif.h
@@ -19,7 +19,7 @@ static inline u16 crc_t10dif_arch(u16 crc, const u8 *p, size_t len)
 }
 
 #define crc_t10dif_mod_init_arch crc_t10dif_mod_init_arch
-static inline void crc_t10dif_mod_init_arch(void)
+static void crc_t10dif_mod_init_arch(void)
 {
 	if (boot_cpu_has(X86_FEATURE_PCLMULQDQ)) {
 		static_branch_enable(&have_pclmulqdq);
diff --git a/lib/crc/x86/crc32.h b/lib/crc/x86/crc32.h
index cea2c96d08d0..19a5e3c6c73b 100644
--- a/lib/crc/x86/crc32.h
+++ b/lib/crc/x86/crc32.h
@@ -44,7 +44,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 		return crc32c_base(crc, p, len);
 
 	if (IS_ENABLED(CONFIG_X86_64) && len >= CRC32C_PCLMUL_BREAKEVEN &&
-	    static_branch_likely(&have_pclmulqdq) && crypto_simd_usable()) {
+	    static_branch_likely(&have_pclmulqdq) && likely(irq_fpu_usable())) {
 		/*
 		 * Long length, the vector registers are usable, and the CPU is
 		 * 64-bit and supports both CRC32 and PCLMULQDQ instructions.
@@ -106,7 +106,7 @@ static inline u32 crc32c_arch(u32 crc, const u8 *p, size_t len)
 #define crc32_be_arch crc32_be_base /* not implemented on this arch */
 
 #define crc32_mod_init_arch crc32_mod_init_arch
-static inline void crc32_mod_init_arch(void)
+static void crc32_mod_init_arch(void)
 {
 	if (boot_cpu_has(X86_FEATURE_XMM4_2))
 		static_branch_enable(&have_crc32);
diff --git a/lib/crc/x86/crc64.h b/lib/crc/x86/crc64.h
index fde1222c4c58..7d4599319343 100644
--- a/lib/crc/x86/crc64.h
+++ b/lib/crc/x86/crc64.h
@@ -27,7 +27,7 @@ static inline u64 crc64_nvme_arch(u64 crc, const u8 *p, size_t len)
 }
 
 #define crc64_mod_init_arch crc64_mod_init_arch
-static inline void crc64_mod_init_arch(void)
+static void crc64_mod_init_arch(void)
 {
 	if (boot_cpu_has(X86_FEATURE_PCLMULQDQ)) {
 		static_branch_enable(&have_pclmulqdq);
diff --git a/lib/crypto/tests/hash-test-template.h b/lib/crypto/tests/hash-test-template.h
index f437a0a9ac6c..61b43e62779f 100644
--- a/lib/crypto/tests/hash-test-template.h
+++ b/lib/crypto/tests/hash-test-template.h
@@ -5,11 +5,9 @@
  *
  * Copyright 2025 Google LLC
  */
+#include <kunit/run-in-irq-context.h>
 #include <kunit/test.h>
-#include <linux/hrtimer.h>
-#include <linux/timekeeping.h>
 #include <linux/vmalloc.h>
-#include <linux/workqueue.h>
 
 /* test_buf is a guarded buffer, i.e. &test_buf[TEST_BUF_LEN] is not mapped. */
 #define TEST_BUF_LEN 16384
@@ -319,119 +317,6 @@ static void test_hash_ctx_zeroization(struct kunit *test)
 			       "Hash context was not zeroized by finalization");
 }
 
-#define IRQ_TEST_HRTIMER_INTERVAL us_to_ktime(5)
-
-struct hash_irq_test_state {
-	bool (*func)(void *test_specific_state);
-	void *test_specific_state;
-	bool task_func_reported_failure;
-	bool hardirq_func_reported_failure;
-	bool softirq_func_reported_failure;
-	unsigned long hardirq_func_calls;
-	unsigned long softirq_func_calls;
-	struct hrtimer timer;
-	struct work_struct bh_work;
-};
-
-static enum hrtimer_restart hash_irq_test_timer_func(struct hrtimer *timer)
-{
-	struct hash_irq_test_state *state =
-		container_of(timer, typeof(*state), timer);
-
-	WARN_ON_ONCE(!in_hardirq());
-	state->hardirq_func_calls++;
-
-	if (!state->func(state->test_specific_state))
-		state->hardirq_func_reported_failure = true;
-
-	hrtimer_forward_now(&state->timer, IRQ_TEST_HRTIMER_INTERVAL);
-	queue_work(system_bh_wq, &state->bh_work);
-	return HRTIMER_RESTART;
-}
-
-static void hash_irq_test_bh_work_func(struct work_struct *work)
-{
-	struct hash_irq_test_state *state =
-		container_of(work, typeof(*state), bh_work);
-
-	WARN_ON_ONCE(!in_serving_softirq());
-	state->softirq_func_calls++;
-
-	if (!state->func(state->test_specific_state))
-		state->softirq_func_reported_failure = true;
-}
-
-/*
- * Helper function which repeatedly runs the given @func in task, softirq, and
- * hardirq context concurrently, and reports a failure to KUnit if any
- * invocation of @func in any context returns false.  @func is passed
- * @test_specific_state as its argument.  At most 3 invocations of @func will
- * run concurrently: one in each of task, softirq, and hardirq context.
- *
- * The main purpose of this interrupt context testing is to validate fallback
- * code paths that run in contexts where the normal code path cannot be used,
- * typically due to the FPU or vector registers already being in-use in kernel
- * mode.  These code paths aren't covered when the test code is executed only by
- * the KUnit test runner thread in task context.  The reason for the concurrency
- * is because merely using hardirq context is not sufficient to reach a fallback
- * code path on some architectures; the hardirq actually has to occur while the
- * FPU or vector unit was already in-use in kernel mode.
- *
- * Another purpose of this testing is to detect issues with the architecture's
- * irq_fpu_usable() and kernel_fpu_begin/end() or equivalent functions,
- * especially in softirq context when the softirq may have interrupted a task
- * already using kernel-mode FPU or vector (if the arch didn't prevent that).
- * Crypto functions are often executed in softirqs, so this is important.
- */
-static void run_irq_test(struct kunit *test, bool (*func)(void *),
-			 int max_iterations, void *test_specific_state)
-{
-	struct hash_irq_test_state state = {
-		.func = func,
-		.test_specific_state = test_specific_state,
-	};
-	unsigned long end_jiffies;
-
-	/*
-	 * Set up a hrtimer (the way we access hardirq context) and a work
-	 * struct for the BH workqueue (the way we access softirq context).
-	 */
-	hrtimer_setup_on_stack(&state.timer, hash_irq_test_timer_func,
-			       CLOCK_MONOTONIC, HRTIMER_MODE_REL_HARD);
-	INIT_WORK_ONSTACK(&state.bh_work, hash_irq_test_bh_work_func);
-
-	/* Run for up to max_iterations or 1 second, whichever comes first. */
-	end_jiffies = jiffies + HZ;
-	hrtimer_start(&state.timer, IRQ_TEST_HRTIMER_INTERVAL,
-		      HRTIMER_MODE_REL_HARD);
-	for (int i = 0; i < max_iterations && !time_after(jiffies, end_jiffies);
-	     i++) {
-		if (!func(test_specific_state))
-			state.task_func_reported_failure = true;
-	}
-
-	/* Cancel the timer and work. */
-	hrtimer_cancel(&state.timer);
-	flush_work(&state.bh_work);
-
-	/* Sanity check: the timer and BH functions should have been run. */
-	KUNIT_EXPECT_GT_MSG(test, state.hardirq_func_calls, 0,
-			    "Timer function was not called");
-	KUNIT_EXPECT_GT_MSG(test, state.softirq_func_calls, 0,
-			    "BH work function was not called");
-
-	/* Check for incorrect hash values reported from any context. */
-	KUNIT_EXPECT_FALSE_MSG(
-		test, state.task_func_reported_failure,
-		"Incorrect hash values reported from task context");
-	KUNIT_EXPECT_FALSE_MSG(
-		test, state.hardirq_func_reported_failure,
-		"Incorrect hash values reported from hardirq context");
-	KUNIT_EXPECT_FALSE_MSG(
-		test, state.softirq_func_reported_failure,
-		"Incorrect hash values reported from softirq context");
-}
-
 #define IRQ_TEST_DATA_LEN 256
 #define IRQ_TEST_NUM_BUFFERS 3 /* matches max concurrency level */
 
@@ -469,7 +354,7 @@ static void test_hash_interrupt_context_1(struct kunit *test)
 		HASH(&test_buf[i * IRQ_TEST_DATA_LEN], IRQ_TEST_DATA_LEN,
 		     state.expected_hashes[i]);
 
-	run_irq_test(test, hash_irq_test1_func, 100000, &state);
+	kunit_run_irq_test(test, hash_irq_test1_func, 100000, &state);
 }
 
 struct hash_irq_test2_hash_ctx {
@@ -500,7 +385,7 @@ static bool hash_irq_test2_func(void *state_)
 	if (WARN_ON_ONCE(ctx == &state->ctxs[ARRAY_SIZE(state->ctxs)])) {
 		/*
 		 * This should never happen, as the number of contexts is equal
-		 * to the maximum concurrency level of run_irq_test().
+		 * to the maximum concurrency level of kunit_run_irq_test().
 		 */
 		return false;
 	}
@@ -566,7 +451,7 @@ static void test_hash_interrupt_context_2(struct kunit *test)
 		state->update_lens[state->num_steps++] = remaining;
 	state->num_steps += 2; /* for init and final */
 
-	run_irq_test(test, hash_irq_test2_func, 250000, state);
+	kunit_run_irq_test(test, hash_irq_test2_func, 250000, state);
 }
 
 #define UNKEYED_HASH_KUNIT_CASES                     \
diff --git a/lib/find_bit_benchmark_rust.rs b/lib/find_bit_benchmark_rust.rs
new file mode 100644
index 000000000000..6bdc51de2f30
--- /dev/null
+++ b/lib/find_bit_benchmark_rust.rs
@@ -0,0 +1,104 @@
+// SPDX-License-Identifier: GPL-2.0
+//! Benchmark for find_bit-like methods in Bitmap Rust API.
+
+use kernel::alloc::flags::GFP_KERNEL;
+use kernel::bindings;
+use kernel::bitmap::BitmapVec;
+use kernel::error::{code, Result};
+use kernel::prelude::module;
+use kernel::time::{Instant, Monotonic};
+use kernel::ThisModule;
+use kernel::{pr_cont, pr_err};
+
+const BITMAP_LEN: usize = 4096 * 8 * 10;
+// Reciprocal of the fraction of bits that are set in sparse bitmap.
+const SPARSENESS: usize = 500;
+
+/// Test module that benchmarks performance of traversing bitmaps.
+struct Benchmark();
+
+fn test_next_bit(bitmap: &BitmapVec) {
+    let time = Instant::<Monotonic>::now();
+    let mut cnt = 0;
+    let mut i = 0;
+
+    while let Some(index) = bitmap.next_bit(i) {
+        cnt += 1;
+        i = index + 1;
+        // CONFIG_RUST_BITMAP_HARDENED enforces strict bounds.
+        if i == BITMAP_LEN {
+            break;
+        }
+    }
+
+    let delta = time.elapsed();
+    pr_cont!(
+        "\nnext_bit:           {:18} ns, {:6} iterations",
+        delta.as_nanos(),
+        cnt
+    );
+}
+
+fn test_next_zero_bit(bitmap: &BitmapVec) {
+    let time = Instant::<Monotonic>::now();
+    let mut cnt = 0;
+    let mut i = 0;
+
+    while let Some(index) = bitmap.next_zero_bit(i) {
+        cnt += 1;
+        i = index + 1;
+        // CONFIG_RUST_BITMAP_HARDENED enforces strict bounds.
+        if i == BITMAP_LEN {
+            break;
+        }
+    }
+
+    let delta = time.elapsed();
+    pr_cont!(
+        "\nnext_zero_bit:      {:18} ns, {:6} iterations",
+        delta.as_nanos(),
+        cnt
+    );
+}
+
+fn find_bit_test() {
+    pr_err!("Benchmark");
+    pr_cont!("\nStart testing find_bit() Rust with random-filled bitmap");
+
+    let mut bitmap = BitmapVec::new(BITMAP_LEN, GFP_KERNEL).expect("alloc bitmap failed");
+    bitmap.fill_random();
+
+    test_next_bit(&bitmap);
+    test_next_zero_bit(&bitmap);
+
+    pr_cont!("\nStart testing find_bit() Rust with sparse bitmap");
+
+    let mut bitmap = BitmapVec::new(BITMAP_LEN, GFP_KERNEL).expect("alloc sparse bitmap failed");
+    let nbits = BITMAP_LEN / SPARSENESS;
+    for _i in 0..nbits {
+        // SAFETY: __get_random_u32_below is safe to call with any u32 argument.
+        let bit =
+            unsafe { bindings::__get_random_u32_below(BITMAP_LEN.try_into().unwrap()) as usize };
+        bitmap.set_bit(bit);
+    }
+
+    test_next_bit(&bitmap);
+    test_next_zero_bit(&bitmap);
+    pr_cont!("\n");
+}
+
+impl kernel::Module for Benchmark {
+    fn init(_module: &'static ThisModule) -> Result<Self> {
+        find_bit_test();
+        // Return error so test module can be inserted again without rmmod.
+        Err(code::EINVAL)
+    }
+}
+
+module! {
+    type: Benchmark,
+    name: "find_bit_benchmark_rust",
+    authors: ["Burak Emir <bqe@google.com>"],
+    description: "Module with benchmark for bitmap Rust API",
+    license: "GPL v2",
+}
diff --git a/lib/maple_tree.c b/lib/maple_tree.c
index c57a4615bdff..39bb779cb311 100644
--- a/lib/maple_tree.c
+++ b/lib/maple_tree.c
@@ -83,13 +83,9 @@
 
 /*
  * Maple state flags
- * * MA_STATE_BULK		- Bulk insert mode
- * * MA_STATE_REBALANCE		- Indicate a rebalance during bulk insert
  * * MA_STATE_PREALLOC		- Preallocated nodes, WARN_ON allocation
  */
-#define MA_STATE_BULK		1
-#define MA_STATE_REBALANCE	2
-#define MA_STATE_PREALLOC	4
+#define MA_STATE_PREALLOC	1
 
 #define ma_parent_ptr(x) ((struct maple_pnode *)(x))
 #define mas_tree_parent(x) ((unsigned long)(x->tree) | MA_ROOT_PARENT)
@@ -176,26 +172,25 @@ static inline struct maple_node *mt_alloc_one(gfp_t gfp)
 	return kmem_cache_alloc(maple_node_cache, gfp);
 }
 
-static inline int mt_alloc_bulk(gfp_t gfp, size_t size, void **nodes)
+static inline void mt_free_bulk(size_t size, void __rcu **nodes)
 {
-	return kmem_cache_alloc_bulk(maple_node_cache, gfp, size, nodes);
+	kmem_cache_free_bulk(maple_node_cache, size, (void **)nodes);
 }
 
-static inline void mt_free_one(struct maple_node *node)
+static void mt_return_sheaf(struct slab_sheaf *sheaf)
 {
-	kmem_cache_free(maple_node_cache, node);
+	kmem_cache_return_sheaf(maple_node_cache, GFP_NOWAIT, sheaf);
 }
 
-static inline void mt_free_bulk(size_t size, void __rcu **nodes)
+static struct slab_sheaf *mt_get_sheaf(gfp_t gfp, int count)
 {
-	kmem_cache_free_bulk(maple_node_cache, size, (void **)nodes);
+	return kmem_cache_prefill_sheaf(maple_node_cache, gfp, count);
 }
 
-static void mt_free_rcu(struct rcu_head *head)
+static int mt_refill_sheaf(gfp_t gfp, struct slab_sheaf **sheaf,
+		unsigned int size)
 {
-	struct maple_node *node = container_of(head, struct maple_node, rcu);
-
-	kmem_cache_free(maple_node_cache, node);
+	return kmem_cache_refill_sheaf(maple_node_cache, gfp, sheaf, size);
 }
 
 /*
@@ -208,7 +203,7 @@ static void mt_free_rcu(struct rcu_head *head)
 static void ma_free_rcu(struct maple_node *node)
 {
 	WARN_ON(node->parent != ma_parent_ptr(node));
-	call_rcu(&node->rcu, mt_free_rcu);
+	kfree_rcu(node, rcu);
 }
 
 static void mt_set_height(struct maple_tree *mt, unsigned char height)
@@ -590,67 +585,6 @@ static __always_inline bool mte_dead_node(const struct maple_enode *enode)
 	return ma_dead_node(node);
 }
 
-/*
- * mas_allocated() - Get the number of nodes allocated in a maple state.
- * @mas: The maple state
- *
- * The ma_state alloc member is overloaded to hold a pointer to the first
- * allocated node or to the number of requested nodes to allocate.  If bit 0 is
- * set, then the alloc contains the number of requested nodes.  If there is an
- * allocated node, then the total allocated nodes is in that node.
- *
- * Return: The total number of nodes allocated
- */
-static inline unsigned long mas_allocated(const struct ma_state *mas)
-{
-	if (!mas->alloc || ((unsigned long)mas->alloc & 0x1))
-		return 0;
-
-	return mas->alloc->total;
-}
-
-/*
- * mas_set_alloc_req() - Set the requested number of allocations.
- * @mas: the maple state
- * @count: the number of allocations.
- *
- * The requested number of allocations is either in the first allocated node,
- * located in @mas->alloc->request_count, or directly in @mas->alloc if there is
- * no allocated node.  Set the request either in the node or do the necessary
- * encoding to store in @mas->alloc directly.
- */
-static inline void mas_set_alloc_req(struct ma_state *mas, unsigned long count)
-{
-	if (!mas->alloc || ((unsigned long)mas->alloc & 0x1)) {
-		if (!count)
-			mas->alloc = NULL;
-		else
-			mas->alloc = (struct maple_alloc *)(((count) << 1U) | 1U);
-		return;
-	}
-
-	mas->alloc->request_count = count;
-}
-
-/*
- * mas_alloc_req() - get the requested number of allocations.
- * @mas: The maple state
- *
- * The alloc count is either stored directly in @mas, or in
- * @mas->alloc->request_count if there is at least one node allocated.  Decode
- * the request count if it's stored directly in @mas->alloc.
- *
- * Return: The allocation request count.
- */
-static inline unsigned int mas_alloc_req(const struct ma_state *mas)
-{
-	if ((unsigned long)mas->alloc & 0x1)
-		return (unsigned long)(mas->alloc) >> 1;
-	else if (mas->alloc)
-		return mas->alloc->request_count;
-	return 0;
-}
-
 /*
  * ma_pivots() - Get a pointer to the maple node pivots.
  * @node: the maple node
@@ -1031,24 +965,6 @@ static inline void mas_descend(struct ma_state *mas)
 	mas->node = mas_slot(mas, slots, mas->offset);
 }
 
-/*
- * mte_set_gap() - Set a maple node gap.
- * @mn: The encoded maple node
- * @gap: The offset of the gap to set
- * @val: The gap value
- */
-static inline void mte_set_gap(const struct maple_enode *mn,
-				 unsigned char gap, unsigned long val)
-{
-	switch (mte_node_type(mn)) {
-	default:
-		break;
-	case maple_arange_64:
-		mte_to_node(mn)->ma64.gap[gap] = val;
-		break;
-	}
-}
-
 /*
  * mas_ascend() - Walk up a level of the tree.
  * @mas: The maple state
@@ -1152,79 +1068,24 @@ static int mas_ascend(struct ma_state *mas)
  *
  * Return: A pointer to a maple node.
  */
-static inline struct maple_node *mas_pop_node(struct ma_state *mas)
+static __always_inline struct maple_node *mas_pop_node(struct ma_state *mas)
 {
-	struct maple_alloc *ret, *node = mas->alloc;
-	unsigned long total = mas_allocated(mas);
-	unsigned int req = mas_alloc_req(mas);
-
-	/* nothing or a request pending. */
-	if (WARN_ON(!total))
-		return NULL;
+	struct maple_node *ret;
 
-	if (total == 1) {
-		/* single allocation in this ma_state */
+	if (mas->alloc) {
+		ret = mas->alloc;
 		mas->alloc = NULL;
-		ret = node;
-		goto single_node;
+		goto out;
 	}
 
-	if (node->node_count == 1) {
-		/* Single allocation in this node. */
-		mas->alloc = node->slot[0];
-		mas->alloc->total = node->total - 1;
-		ret = node;
-		goto new_head;
-	}
-	node->total--;
-	ret = node->slot[--node->node_count];
-	node->slot[node->node_count] = NULL;
+	if (WARN_ON_ONCE(!mas->sheaf))
+		return NULL;
 
-single_node:
-new_head:
-	if (req) {
-		req++;
-		mas_set_alloc_req(mas, req);
-	}
+	ret = kmem_cache_alloc_from_sheaf(maple_node_cache, GFP_NOWAIT, mas->sheaf);
 
+out:
 	memset(ret, 0, sizeof(*ret));
-	return (struct maple_node *)ret;
-}
-
-/*
- * mas_push_node() - Push a node back on the maple state allocation.
- * @mas: The maple state
- * @used: The used maple node
- *
- * Stores the maple node back into @mas->alloc for reuse.  Updates allocated and
- * requested node count as necessary.
- */
-static inline void mas_push_node(struct ma_state *mas, struct maple_node *used)
-{
-	struct maple_alloc *reuse = (struct maple_alloc *)used;
-	struct maple_alloc *head = mas->alloc;
-	unsigned long count;
-	unsigned int requested = mas_alloc_req(mas);
-
-	count = mas_allocated(mas);
-
-	reuse->request_count = 0;
-	reuse->node_count = 0;
-	if (count) {
-		if (head->node_count < MAPLE_ALLOC_SLOTS) {
-			head->slot[head->node_count++] = reuse;
-			head->total++;
-			goto done;
-		}
-		reuse->slot[0] = head;
-		reuse->node_count = 1;
-	}
-
-	reuse->total = count + 1;
-	mas->alloc = reuse;
-done:
-	if (requested > 1)
-		mas_set_alloc_req(mas, requested - 1);
+	return ret;
 }
 
 /*
@@ -1234,121 +1095,81 @@ static inline void mas_push_node(struct ma_state *mas, struct maple_node *used)
  */
 static inline void mas_alloc_nodes(struct ma_state *mas, gfp_t gfp)
 {
-	struct maple_alloc *node;
-	unsigned long allocated = mas_allocated(mas);
-	unsigned int requested = mas_alloc_req(mas);
-	unsigned int count;
-	void **slots = NULL;
-	unsigned int max_req = 0;
-
-	if (!requested)
+	if (!mas->node_request)
 		return;
 
-	mas_set_alloc_req(mas, 0);
-	if (mas->mas_flags & MA_STATE_PREALLOC) {
-		if (allocated)
+	if (mas->node_request == 1) {
+		if (mas->sheaf)
+			goto use_sheaf;
+
+		if (mas->alloc)
 			return;
-		WARN_ON(!allocated);
-	}
 
-	if (!allocated || mas->alloc->node_count == MAPLE_ALLOC_SLOTS) {
-		node = (struct maple_alloc *)mt_alloc_one(gfp);
-		if (!node)
-			goto nomem_one;
+		mas->alloc = mt_alloc_one(gfp);
+		if (!mas->alloc)
+			goto error;
 
-		if (allocated) {
-			node->slot[0] = mas->alloc;
-			node->node_count = 1;
-		} else {
-			node->node_count = 0;
-		}
+		mas->node_request = 0;
+		return;
+	}
 
-		mas->alloc = node;
-		node->total = ++allocated;
-		node->request_count = 0;
-		requested--;
+use_sheaf:
+	if (unlikely(mas->alloc)) {
+		kfree(mas->alloc);
+		mas->alloc = NULL;
 	}
 
-	node = mas->alloc;
-	while (requested) {
-		max_req = MAPLE_ALLOC_SLOTS - node->node_count;
-		slots = (void **)&node->slot[node->node_count];
-		max_req = min(requested, max_req);
-		count = mt_alloc_bulk(gfp, max_req, slots);
-		if (!count)
-			goto nomem_bulk;
+	if (mas->sheaf) {
+		unsigned long refill;
 
-		if (node->node_count == 0) {
-			node->slot[0]->node_count = 0;
-			node->slot[0]->request_count = 0;
+		refill = mas->node_request;
+		if (kmem_cache_sheaf_size(mas->sheaf) >= refill) {
+			mas->node_request = 0;
+			return;
 		}
 
-		node->node_count += count;
-		allocated += count;
-		/* find a non-full node*/
-		do {
-			node = node->slot[0];
-		} while (unlikely(node->node_count == MAPLE_ALLOC_SLOTS));
-		requested -= count;
-	}
-	mas->alloc->total = allocated;
-	return;
+		if (mt_refill_sheaf(gfp, &mas->sheaf, refill))
+			goto error;
 
-nomem_bulk:
-	/* Clean up potential freed allocations on bulk failure */
-	memset(slots, 0, max_req * sizeof(unsigned long));
-	mas->alloc->total = allocated;
-nomem_one:
-	mas_set_alloc_req(mas, requested);
-	mas_set_err(mas, -ENOMEM);
-}
+		mas->node_request = 0;
+		return;
+	}
 
-/*
- * mas_free() - Free an encoded maple node
- * @mas: The maple state
- * @used: The encoded maple node to free.
- *
- * Uses rcu free if necessary, pushes @used back on the maple state allocations
- * otherwise.
- */
-static inline void mas_free(struct ma_state *mas, struct maple_enode *used)
-{
-	struct maple_node *tmp = mte_to_node(used);
+	mas->sheaf = mt_get_sheaf(gfp, mas->node_request);
+	if (likely(mas->sheaf)) {
+		mas->node_request = 0;
+		return;
+	}
 
-	if (mt_in_rcu(mas->tree))
-		ma_free_rcu(tmp);
-	else
-		mas_push_node(mas, tmp);
+error:
+	mas_set_err(mas, -ENOMEM);
 }
 
-/*
- * mas_node_count_gfp() - Check if enough nodes are allocated and request more
- * if there is not enough nodes.
- * @mas: The maple state
- * @count: The number of nodes needed
- * @gfp: the gfp flags
- */
-static void mas_node_count_gfp(struct ma_state *mas, int count, gfp_t gfp)
+static inline void mas_empty_nodes(struct ma_state *mas)
 {
-	unsigned long allocated = mas_allocated(mas);
+	mas->node_request = 0;
+	if (mas->sheaf) {
+		mt_return_sheaf(mas->sheaf);
+		mas->sheaf = NULL;
+	}
 
-	if (allocated < count) {
-		mas_set_alloc_req(mas, count - allocated);
-		mas_alloc_nodes(mas, gfp);
+	if (mas->alloc) {
+		kfree(mas->alloc);
+		mas->alloc = NULL;
 	}
 }
 
 /*
- * mas_node_count() - Check if enough nodes are allocated and request more if
- * there is not enough nodes.
+ * mas_free() - Free an encoded maple node
  * @mas: The maple state
- * @count: The number of nodes needed
+ * @used: The encoded maple node to free.
  *
- * Note: Uses GFP_NOWAIT | __GFP_NOWARN for gfp flags.
+ * Uses rcu free if necessary, pushes @used back on the maple state allocations
+ * otherwise.
  */
-static void mas_node_count(struct ma_state *mas, int count)
+static inline void mas_free(struct ma_state *mas, struct maple_enode *used)
 {
-	return mas_node_count_gfp(mas, count, GFP_NOWAIT | __GFP_NOWARN);
+	ma_free_rcu(mte_to_node(used));
 }
 
 /*
@@ -1878,21 +1699,7 @@ static inline int mab_calc_split(struct ma_state *mas,
 	 * end on a NULL entry, with the exception of the left-most leaf.  The
 	 * limitation means that the split of a node must be checked for this condition
 	 * and be able to put more data in one direction or the other.
-	 */
-	if (unlikely((mas->mas_flags & MA_STATE_BULK))) {
-		*mid_split = 0;
-		split = b_end - mt_min_slots[bn->type];
-
-		if (!ma_is_leaf(bn->type))
-			return split;
-
-		mas->mas_flags |= MA_STATE_REBALANCE;
-		if (!bn->slot[split])
-			split--;
-		return split;
-	}
-
-	/*
+	 *
 	 * Although extremely rare, it is possible to enter what is known as the 3-way
 	 * split scenario.  The 3-way split comes about by means of a store of a range
 	 * that overwrites the end and beginning of two full nodes.  The result is a set
@@ -2039,27 +1846,6 @@ static inline void mab_mas_cp(struct maple_big_node *b_node,
 	}
 }
 
-/*
- * mas_bulk_rebalance() - Rebalance the end of a tree after a bulk insert.
- * @mas: The maple state
- * @end: The maple node end
- * @mt: The maple node type
- */
-static inline void mas_bulk_rebalance(struct ma_state *mas, unsigned char end,
-				      enum maple_type mt)
-{
-	if (!(mas->mas_flags & MA_STATE_BULK))
-		return;
-
-	if (mte_is_root(mas->node))
-		return;
-
-	if (end > mt_min_slots[mt]) {
-		mas->mas_flags &= ~MA_STATE_REBALANCE;
-		return;
-	}
-}
-
 /*
  * mas_store_b_node() - Store an @entry into the b_node while also copying the
  * data from a maple encoded node.
@@ -2109,9 +1895,6 @@ static noinline_for_kasan void mas_store_b_node(struct ma_wr_state *wr_mas,
 	/* Handle new range ending before old range ends */
 	piv = mas_safe_pivot(mas, wr_mas->pivots, offset_end, wr_mas->type);
 	if (piv > mas->last) {
-		if (piv == ULONG_MAX)
-			mas_bulk_rebalance(mas, b_node->b_end, wr_mas->type);
-
 		if (offset_end != slot)
 			wr_mas->content = mas_slot_locked(mas, wr_mas->slots,
 							  offset_end);
@@ -2523,10 +2306,7 @@ static inline void mas_topiary_node(struct ma_state *mas,
 	enode = tmp_mas->node;
 	tmp = mte_to_node(enode);
 	mte_set_node_dead(enode);
-	if (in_rcu)
-		ma_free_rcu(tmp);
-	else
-		mas_push_node(mas, tmp);
+	ma_free_rcu(tmp);
 }
 
 /*
@@ -3011,126 +2791,6 @@ static inline void mas_rebalance(struct ma_state *mas,
 	return mas_spanning_rebalance(mas, &mast, empty_count);
 }
 
-/*
- * mas_destroy_rebalance() - Rebalance left-most node while destroying the maple
- * state.
- * @mas: The maple state
- * @end: The end of the left-most node.
- *
- * During a mass-insert event (such as forking), it may be necessary to
- * rebalance the left-most node when it is not sufficient.
- */
-static inline void mas_destroy_rebalance(struct ma_state *mas, unsigned char end)
-{
-	enum maple_type mt = mte_node_type(mas->node);
-	struct maple_node reuse, *newnode, *parent, *new_left, *left, *node;
-	struct maple_enode *eparent, *old_eparent;
-	unsigned char offset, tmp, split = mt_slots[mt] / 2;
-	void __rcu **l_slots, **slots;
-	unsigned long *l_pivs, *pivs, gap;
-	bool in_rcu = mt_in_rcu(mas->tree);
-	unsigned char new_height = mas_mt_height(mas);
-
-	MA_STATE(l_mas, mas->tree, mas->index, mas->last);
-
-	l_mas = *mas;
-	mas_prev_sibling(&l_mas);
-
-	/* set up node. */
-	if (in_rcu) {
-		newnode = mas_pop_node(mas);
-	} else {
-		newnode = &reuse;
-	}
-
-	node = mas_mn(mas);
-	newnode->parent = node->parent;
-	slots = ma_slots(newnode, mt);
-	pivs = ma_pivots(newnode, mt);
-	left = mas_mn(&l_mas);
-	l_slots = ma_slots(left, mt);
-	l_pivs = ma_pivots(left, mt);
-	if (!l_slots[split])
-		split++;
-	tmp = mas_data_end(&l_mas) - split;
-
-	memcpy(slots, l_slots + split + 1, sizeof(void *) * tmp);
-	memcpy(pivs, l_pivs + split + 1, sizeof(unsigned long) * tmp);
-	pivs[tmp] = l_mas.max;
-	memcpy(slots + tmp, ma_slots(node, mt), sizeof(void *) * end);
-	memcpy(pivs + tmp, ma_pivots(node, mt), sizeof(unsigned long) * end);
-
-	l_mas.max = l_pivs[split];
-	mas->min = l_mas.max + 1;
-	old_eparent = mt_mk_node(mte_parent(l_mas.node),
-			     mas_parent_type(&l_mas, l_mas.node));
-	tmp += end;
-	if (!in_rcu) {
-		unsigned char max_p = mt_pivots[mt];
-		unsigned char max_s = mt_slots[mt];
-
-		if (tmp < max_p)
-			memset(pivs + tmp, 0,
-			       sizeof(unsigned long) * (max_p - tmp));
-
-		if (tmp < mt_slots[mt])
-			memset(slots + tmp, 0, sizeof(void *) * (max_s - tmp));
-
-		memcpy(node, newnode, sizeof(struct maple_node));
-		ma_set_meta(node, mt, 0, tmp - 1);
-		mte_set_pivot(old_eparent, mte_parent_slot(l_mas.node),
-			      l_pivs[split]);
-
-		/* Remove data from l_pivs. */
-		tmp = split + 1;
-		memset(l_pivs + tmp, 0, sizeof(unsigned long) * (max_p - tmp));
-		memset(l_slots + tmp, 0, sizeof(void *) * (max_s - tmp));
-		ma_set_meta(left, mt, 0, split);
-		eparent = old_eparent;
-
-		goto done;
-	}
-
-	/* RCU requires replacing both l_mas, mas, and parent. */
-	mas->node = mt_mk_node(newnode, mt);
-	ma_set_meta(newnode, mt, 0, tmp);
-
-	new_left = mas_pop_node(mas);
-	new_left->parent = left->parent;
-	mt = mte_node_type(l_mas.node);
-	slots = ma_slots(new_left, mt);
-	pivs = ma_pivots(new_left, mt);
-	memcpy(slots, l_slots, sizeof(void *) * split);
-	memcpy(pivs, l_pivs, sizeof(unsigned long) * split);
-	ma_set_meta(new_left, mt, 0, split);
-	l_mas.node = mt_mk_node(new_left, mt);
-
-	/* replace parent. */
-	offset = mte_parent_slot(mas->node);
-	mt = mas_parent_type(&l_mas, l_mas.node);
-	parent = mas_pop_node(mas);
-	slots = ma_slots(parent, mt);
-	pivs = ma_pivots(parent, mt);
-	memcpy(parent, mte_to_node(old_eparent), sizeof(struct maple_node));
-	rcu_assign_pointer(slots[offset], mas->node);
-	rcu_assign_pointer(slots[offset - 1], l_mas.node);
-	pivs[offset - 1] = l_mas.max;
-	eparent = mt_mk_node(parent, mt);
-done:
-	gap = mas_leaf_max_gap(mas);
-	mte_set_gap(eparent, mte_parent_slot(mas->node), gap);
-	gap = mas_leaf_max_gap(&l_mas);
-	mte_set_gap(eparent, mte_parent_slot(l_mas.node), gap);
-	mas_ascend(mas);
-
-	if (in_rcu) {
-		mas_replace_node(mas, old_eparent, new_height);
-		mas_adopt_children(mas, mas->node);
-	}
-
-	mas_update_gap(mas);
-}
-
 /*
  * mas_split_final_node() - Split the final node in a subtree operation.
  * @mast: the maple subtree state
@@ -3837,8 +3497,6 @@ static inline void mas_wr_node_store(struct ma_wr_state *wr_mas,
 
 	if (mas->last == wr_mas->end_piv)
 		offset_end++; /* don't copy this offset */
-	else if (unlikely(wr_mas->r_max == ULONG_MAX))
-		mas_bulk_rebalance(mas, mas->end, wr_mas->type);
 
 	/* set up node. */
 	if (in_rcu) {
@@ -4174,7 +3832,7 @@ static inline void mas_wr_prealloc_setup(struct ma_wr_state *wr_mas)
  *
  * Return: Number of nodes required for preallocation.
  */
-static inline int mas_prealloc_calc(struct ma_wr_state *wr_mas, void *entry)
+static inline void mas_prealloc_calc(struct ma_wr_state *wr_mas, void *entry)
 {
 	struct ma_state *mas = wr_mas->mas;
 	unsigned char height = mas_mt_height(mas);
@@ -4220,7 +3878,7 @@ static inline int mas_prealloc_calc(struct ma_wr_state *wr_mas, void *entry)
 		WARN_ON_ONCE(1);
 	}
 
-	return ret;
+	mas->node_request = ret;
 }
 
 /*
@@ -4255,7 +3913,7 @@ static inline enum store_type mas_wr_store_type(struct ma_wr_state *wr_mas)
 	new_end = mas_wr_new_end(wr_mas);
 	/* Potential spanning rebalance collapsing a node */
 	if (new_end < mt_min_slots[wr_mas->type]) {
-		if (!mte_is_root(mas->node) && !(mas->mas_flags & MA_STATE_BULK))
+		if (!mte_is_root(mas->node))
 			return  wr_rebalance;
 		return wr_node_store;
 	}
@@ -4281,15 +3939,15 @@ static inline enum store_type mas_wr_store_type(struct ma_wr_state *wr_mas)
  */
 static inline void mas_wr_preallocate(struct ma_wr_state *wr_mas, void *entry)
 {
-	int request;
+	struct ma_state *mas = wr_mas->mas;
 
 	mas_wr_prealloc_setup(wr_mas);
-	wr_mas->mas->store_type = mas_wr_store_type(wr_mas);
-	request = mas_prealloc_calc(wr_mas, entry);
-	if (!request)
+	mas->store_type = mas_wr_store_type(wr_mas);
+	mas_prealloc_calc(wr_mas, entry);
+	if (!mas->node_request)
 		return;
 
-	mas_node_count(wr_mas->mas, request);
+	mas_alloc_nodes(mas, GFP_NOWAIT);
 }
 
 /**
@@ -5281,7 +4939,7 @@ static void mt_free_walk(struct rcu_head *head)
 	mt_free_bulk(node->slot_len, slots);
 
 free_leaf:
-	mt_free_rcu(&node->rcu);
+	kfree(node);
 }
 
 static inline void __rcu **mte_destroy_descend(struct maple_enode **enode,
@@ -5365,7 +5023,7 @@ static void mt_destroy_walk(struct maple_enode *enode, struct maple_tree *mt,
 
 free_leaf:
 	if (free)
-		mt_free_rcu(&node->rcu);
+		kfree(node);
 	else
 		mt_clear_meta(mt, node, node->type);
 }
@@ -5402,7 +5060,6 @@ static inline void mte_destroy_walk(struct maple_enode *enode,
  */
 void *mas_store(struct ma_state *mas, void *entry)
 {
-	int request;
 	MA_WR_STATE(wr_mas, mas, entry);
 
 	trace_ma_write(__func__, mas, 0, entry);
@@ -5432,11 +5089,11 @@ void *mas_store(struct ma_state *mas, void *entry)
 		return wr_mas.content;
 	}
 
-	request = mas_prealloc_calc(&wr_mas, entry);
-	if (!request)
+	mas_prealloc_calc(&wr_mas, entry);
+	if (!mas->node_request)
 		goto store;
 
-	mas_node_count(mas, request);
+	mas_alloc_nodes(mas, GFP_NOWAIT);
 	if (mas_is_err(mas))
 		return NULL;
 
@@ -5524,20 +5181,19 @@ EXPORT_SYMBOL_GPL(mas_store_prealloc);
 int mas_preallocate(struct ma_state *mas, void *entry, gfp_t gfp)
 {
 	MA_WR_STATE(wr_mas, mas, entry);
-	int ret = 0;
-	int request;
 
 	mas_wr_prealloc_setup(&wr_mas);
 	mas->store_type = mas_wr_store_type(&wr_mas);
-	request = mas_prealloc_calc(&wr_mas, entry);
-	if (!request)
+	mas_prealloc_calc(&wr_mas, entry);
+	if (!mas->node_request)
 		goto set_flag;
 
 	mas->mas_flags &= ~MA_STATE_PREALLOC;
-	mas_node_count_gfp(mas, request, gfp);
+	mas_alloc_nodes(mas, gfp);
 	if (mas_is_err(mas)) {
-		mas_set_alloc_req(mas, 0);
-		ret = xa_err(mas->node);
+		int ret = xa_err(mas->node);
+
+		mas->node_request = 0;
 		mas_destroy(mas);
 		mas_reset(mas);
 		return ret;
@@ -5545,7 +5201,7 @@ int mas_preallocate(struct ma_state *mas, void *entry, gfp_t gfp)
 
 set_flag:
 	mas->mas_flags |= MA_STATE_PREALLOC;
-	return ret;
+	return 0;
 }
 EXPORT_SYMBOL_GPL(mas_preallocate);
 
@@ -5559,109 +5215,11 @@ EXPORT_SYMBOL_GPL(mas_preallocate);
  */
 void mas_destroy(struct ma_state *mas)
 {
-	struct maple_alloc *node;
-	unsigned long total;
-
-	/*
-	 * When using mas_for_each() to insert an expected number of elements,
-	 * it is possible that the number inserted is less than the expected
-	 * number.  To fix an invalid final node, a check is performed here to
-	 * rebalance the previous node with the final node.
-	 */
-	if (mas->mas_flags & MA_STATE_REBALANCE) {
-		unsigned char end;
-		if (mas_is_err(mas))
-			mas_reset(mas);
-		mas_start(mas);
-		mtree_range_walk(mas);
-		end = mas->end + 1;
-		if (end < mt_min_slot_count(mas->node) - 1)
-			mas_destroy_rebalance(mas, end);
-
-		mas->mas_flags &= ~MA_STATE_REBALANCE;
-	}
-	mas->mas_flags &= ~(MA_STATE_BULK|MA_STATE_PREALLOC);
-
-	total = mas_allocated(mas);
-	while (total) {
-		node = mas->alloc;
-		mas->alloc = node->slot[0];
-		if (node->node_count > 1) {
-			size_t count = node->node_count - 1;
-
-			mt_free_bulk(count, (void __rcu **)&node->slot[1]);
-			total -= count;
-		}
-		mt_free_one(ma_mnode_ptr(node));
-		total--;
-	}
-
-	mas->alloc = NULL;
+	mas->mas_flags &= ~MA_STATE_PREALLOC;
+	mas_empty_nodes(mas);
 }
 EXPORT_SYMBOL_GPL(mas_destroy);
 
-/*
- * mas_expected_entries() - Set the expected number of entries that will be inserted.
- * @mas: The maple state
- * @nr_entries: The number of expected entries.
- *
- * This will attempt to pre-allocate enough nodes to store the expected number
- * of entries.  The allocations will occur using the bulk allocator interface
- * for speed.  Please call mas_destroy() on the @mas after inserting the entries
- * to ensure any unused nodes are freed.
- *
- * Return: 0 on success, -ENOMEM if memory could not be allocated.
- */
-int mas_expected_entries(struct ma_state *mas, unsigned long nr_entries)
-{
-	int nonleaf_cap = MAPLE_ARANGE64_SLOTS - 2;
-	struct maple_enode *enode = mas->node;
-	int nr_nodes;
-	int ret;
-
-	/*
-	 * Sometimes it is necessary to duplicate a tree to a new tree, such as
-	 * forking a process and duplicating the VMAs from one tree to a new
-	 * tree.  When such a situation arises, it is known that the new tree is
-	 * not going to be used until the entire tree is populated.  For
-	 * performance reasons, it is best to use a bulk load with RCU disabled.
-	 * This allows for optimistic splitting that favours the left and reuse
-	 * of nodes during the operation.
-	 */
-
-	/* Optimize splitting for bulk insert in-order */
-	mas->mas_flags |= MA_STATE_BULK;
-
-	/*
-	 * Avoid overflow, assume a gap between each entry and a trailing null.
-	 * If this is wrong, it just means allocation can happen during
-	 * insertion of entries.
-	 */
-	nr_nodes = max(nr_entries, nr_entries * 2 + 1);
-	if (!mt_is_alloc(mas->tree))
-		nonleaf_cap = MAPLE_RANGE64_SLOTS - 2;
-
-	/* Leaves; reduce slots to keep space for expansion */
-	nr_nodes = DIV_ROUND_UP(nr_nodes, MAPLE_RANGE64_SLOTS - 2);
-	/* Internal nodes */
-	nr_nodes += DIV_ROUND_UP(nr_nodes, nonleaf_cap);
-	/* Add working room for split (2 nodes) + new parents */
-	mas_node_count_gfp(mas, nr_nodes + 3, GFP_KERNEL);
-
-	/* Detect if allocations run out */
-	mas->mas_flags |= MA_STATE_PREALLOC;
-
-	if (!mas_is_err(mas))
-		return 0;
-
-	ret = xa_err(mas->node);
-	mas->node = enode;
-	mas_destroy(mas);
-	return ret;
-
-}
-EXPORT_SYMBOL_GPL(mas_expected_entries);
-
 static void mas_may_activate(struct ma_state *mas)
 {
 	if (!mas->node) {
@@ -6293,7 +5851,7 @@ bool mas_nomem(struct ma_state *mas, gfp_t gfp)
 		mas_alloc_nodes(mas, gfp);
 	}
 
-	if (!mas_allocated(mas))
+	if (!mas->sheaf && !mas->alloc)
 		return false;
 
 	mas->status = ma_start;
@@ -6302,9 +5860,14 @@ bool mas_nomem(struct ma_state *mas, gfp_t gfp)
 
 void __init maple_tree_init(void)
 {
+	struct kmem_cache_args args = {
+		.align  = sizeof(struct maple_node),
+		.sheaf_capacity = 32,
+	};
+
 	maple_node_cache = kmem_cache_create("maple_node",
-			sizeof(struct maple_node), sizeof(struct maple_node),
-			SLAB_PANIC, NULL);
+			sizeof(struct maple_node), &args,
+			SLAB_PANIC);
 }
 
 /**
@@ -6637,7 +6200,7 @@ static void mas_dup_free(struct ma_state *mas)
 	}
 
 	node = mte_to_node(mas->node);
-	mt_free_one(node);
+	kfree(node);
 }
 
 /*
@@ -6678,7 +6241,7 @@ static inline void mas_dup_alloc(struct ma_state *mas, struct ma_state *new_mas,
 	struct maple_node *node = mte_to_node(mas->node);
 	struct maple_node *new_node = mte_to_node(new_mas->node);
 	enum maple_type type;
-	unsigned char request, count, i;
+	unsigned char count, i;
 	void __rcu **slots;
 	void __rcu **new_slots;
 	unsigned long val;
@@ -6686,20 +6249,17 @@ static inline void mas_dup_alloc(struct ma_state *mas, struct ma_state *new_mas,
 	/* Allocate memory for child nodes. */
 	type = mte_node_type(mas->node);
 	new_slots = ma_slots(new_node, type);
-	request = mas_data_end(mas) + 1;
-	count = mt_alloc_bulk(gfp, request, (void **)new_slots);
-	if (unlikely(count < request)) {
-		memset(new_slots, 0, request * sizeof(void *));
-		mas_set_err(mas, -ENOMEM);
+	count = mas->node_request = mas_data_end(mas) + 1;
+	mas_alloc_nodes(mas, gfp);
+	if (unlikely(mas_is_err(mas)))
 		return;
-	}
 
-	/* Restore node type information in slots. */
 	slots = ma_slots(node, type);
 	for (i = 0; i < count; i++) {
 		val = (unsigned long)mt_slot_locked(mas->tree, slots, i);
 		val &= MAPLE_NODE_MASK;
-		((unsigned long *)new_slots)[i] |= val;
+		new_slots[i] = ma_mnode_ptr((unsigned long)mas_pop_node(mas) |
+					    val);
 	}
 }
 
@@ -6753,7 +6313,7 @@ static inline void mas_dup_build(struct ma_state *mas, struct ma_state *new_mas,
 			/* Only allocate child nodes for non-leaf nodes. */
 			mas_dup_alloc(mas, new_mas, gfp);
 			if (unlikely(mas_is_err(mas)))
-				return;
+				goto empty_mas;
 		} else {
 			/*
 			 * This is the last leaf node and duplication is
@@ -6786,6 +6346,8 @@ static inline void mas_dup_build(struct ma_state *mas, struct ma_state *new_mas,
 	/* Make them the same height */
 	new_mas->tree->ma_flags = mas->tree->ma_flags;
 	rcu_assign_pointer(new_mas->tree->ma_root, root);
+empty_mas:
+	mas_empty_nodes(mas);
 }
 
 /**
@@ -7683,8 +7245,9 @@ void mas_dump(const struct ma_state *mas)
 
 	pr_err("[%u/%u] index=%lx last=%lx\n", mas->offset, mas->end,
 	       mas->index, mas->last);
-	pr_err("     min=%lx max=%lx alloc=" PTR_FMT ", depth=%u, flags=%x\n",
-	       mas->min, mas->max, mas->alloc, mas->depth, mas->mas_flags);
+	pr_err("     min=%lx max=%lx sheaf=" PTR_FMT ", request %lu depth=%u, flags=%x\n",
+	       mas->min, mas->max, mas->sheaf, mas->node_request, mas->depth,
+	       mas->mas_flags);
 	if (mas->index > mas->last)
 		pr_err("Check index & last\n");
 }
diff --git a/lib/test_maple_tree.c b/lib/test_maple_tree.c
index 1433ecc854cb..a182e48b5f5e 100644
--- a/lib/test_maple_tree.c
+++ b/lib/test_maple_tree.c
@@ -2746,139 +2746,6 @@ static noinline void __init check_fuzzer(struct maple_tree *mt)
 	mtree_test_erase(mt, ULONG_MAX - 10);
 }
 
-/* duplicate the tree with a specific gap */
-static noinline void __init check_dup_gaps(struct maple_tree *mt,
-				    unsigned long nr_entries, bool zero_start,
-				    unsigned long gap)
-{
-	unsigned long i = 0;
-	struct maple_tree newmt;
-	int ret;
-	void *tmp;
-	MA_STATE(mas, mt, 0, 0);
-	MA_STATE(newmas, &newmt, 0, 0);
-	struct rw_semaphore newmt_lock;
-
-	init_rwsem(&newmt_lock);
-	mt_set_external_lock(&newmt, &newmt_lock);
-
-	if (!zero_start)
-		i = 1;
-
-	mt_zero_nr_tallocated();
-	for (; i <= nr_entries; i++)
-		mtree_store_range(mt, i*10, (i+1)*10 - gap,
-				  xa_mk_value(i), GFP_KERNEL);
-
-	mt_init_flags(&newmt, MT_FLAGS_ALLOC_RANGE | MT_FLAGS_LOCK_EXTERN);
-	mt_set_non_kernel(99999);
-	down_write(&newmt_lock);
-	ret = mas_expected_entries(&newmas, nr_entries);
-	mt_set_non_kernel(0);
-	MT_BUG_ON(mt, ret != 0);
-
-	rcu_read_lock();
-	mas_for_each(&mas, tmp, ULONG_MAX) {
-		newmas.index = mas.index;
-		newmas.last = mas.last;
-		mas_store(&newmas, tmp);
-	}
-	rcu_read_unlock();
-	mas_destroy(&newmas);
-
-	__mt_destroy(&newmt);
-	up_write(&newmt_lock);
-}
-
-/* Duplicate many sizes of trees.  Mainly to test expected entry values */
-static noinline void __init check_dup(struct maple_tree *mt)
-{
-	int i;
-	int big_start = 100010;
-
-	/* Check with a value at zero */
-	for (i = 10; i < 1000; i++) {
-		mt_init_flags(mt, MT_FLAGS_ALLOC_RANGE);
-		check_dup_gaps(mt, i, true, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-	}
-
-	cond_resched();
-	mt_cache_shrink();
-	/* Check with a value at zero, no gap */
-	for (i = 1000; i < 2000; i++) {
-		mt_init_flags(mt, MT_FLAGS_ALLOC_RANGE);
-		check_dup_gaps(mt, i, true, 0);
-		mtree_destroy(mt);
-		rcu_barrier();
-	}
-
-	cond_resched();
-	mt_cache_shrink();
-	/* Check with a value at zero and unreasonably large */
-	for (i = big_start; i < big_start + 10; i++) {
-		mt_init_flags(mt, MT_FLAGS_ALLOC_RANGE);
-		check_dup_gaps(mt, i, true, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-	}
-
-	cond_resched();
-	mt_cache_shrink();
-	/* Small to medium size not starting at zero*/
-	for (i = 200; i < 1000; i++) {
-		mt_init_flags(mt, MT_FLAGS_ALLOC_RANGE);
-		check_dup_gaps(mt, i, false, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-	}
-
-	cond_resched();
-	mt_cache_shrink();
-	/* Unreasonably large not starting at zero*/
-	for (i = big_start; i < big_start + 10; i++) {
-		mt_init_flags(mt, MT_FLAGS_ALLOC_RANGE);
-		check_dup_gaps(mt, i, false, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-		cond_resched();
-		mt_cache_shrink();
-	}
-
-	/* Check non-allocation tree not starting at zero */
-	for (i = 1500; i < 3000; i++) {
-		mt_init_flags(mt, 0);
-		check_dup_gaps(mt, i, false, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-		cond_resched();
-		if (i % 2 == 0)
-			mt_cache_shrink();
-	}
-
-	mt_cache_shrink();
-	/* Check non-allocation tree starting at zero */
-	for (i = 200; i < 1000; i++) {
-		mt_init_flags(mt, 0);
-		check_dup_gaps(mt, i, true, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-		cond_resched();
-	}
-
-	mt_cache_shrink();
-	/* Unreasonably large */
-	for (i = big_start + 5; i < big_start + 10; i++) {
-		mt_init_flags(mt, 0);
-		check_dup_gaps(mt, i, true, 5);
-		mtree_destroy(mt);
-		rcu_barrier();
-		mt_cache_shrink();
-		cond_resched();
-	}
-}
-
 static noinline void __init check_bnode_min_spanning(struct maple_tree *mt)
 {
 	int i = 50;
@@ -4077,10 +3944,6 @@ static int __init maple_tree_seed(void)
 	check_fuzzer(&tree);
 	mtree_destroy(&tree);
 
-	mt_init_flags(&tree, MT_FLAGS_ALLOC_RANGE);
-	check_dup(&tree);
-	mtree_destroy(&tree);
-
 	mt_init_flags(&tree, MT_FLAGS_ALLOC_RANGE);
 	check_bnode_min_spanning(&tree);
 	mtree_destroy(&tree);
diff --git a/lib/tests/Makefile b/lib/tests/Makefile
index fa6d728a8b5b..f7460831cfdd 100644
--- a/lib/tests/Makefile
+++ b/lib/tests/Makefile
@@ -10,6 +10,7 @@ obj-$(CONFIG_BLACKHOLE_DEV_KUNIT_TEST) += blackhole_dev_kunit.o
 obj-$(CONFIG_CHECKSUM_KUNIT) += checksum_kunit.o
 obj-$(CONFIG_CMDLINE_KUNIT_TEST) += cmdline_kunit.o
 obj-$(CONFIG_CPUMASK_KUNIT_TEST) += cpumask_kunit.o
+obj-$(CONFIG_FFS_KUNIT_TEST) += ffs_kunit.o
 CFLAGS_fortify_kunit.o += $(call cc-disable-warning, unsequenced)
 CFLAGS_fortify_kunit.o += $(call cc-disable-warning, stringop-overread)
 CFLAGS_fortify_kunit.o += $(call cc-disable-warning, stringop-truncation)
diff --git a/lib/tests/ffs_kunit.c b/lib/tests/ffs_kunit.c
new file mode 100644
index 000000000000..9a329cdc09c2
--- /dev/null
+++ b/lib/tests/ffs_kunit.c
@@ -0,0 +1,566 @@
+// SPDX-License-Identifier: GPL-2.0-only
+/*
+ * KUnit tests for ffs()-family functions
+ */
+#include <kunit/test.h>
+#include <linux/bitops.h>
+
+/*
+ * Test data structures
+ */
+struct ffs_test_case {
+	unsigned long input;
+	int expected_ffs;	/* ffs() result (1-based) */
+	int expected_fls;	/* fls() result (1-based) */
+	const char *description;
+};
+
+struct ffs64_test_case {
+	u64 input;
+	int expected_fls64;		    /* fls64() result (1-based) */
+	unsigned int expected_ffs64_0based; /* __ffs64() result (0-based) */
+	const char *description;
+};
+
+/*
+ * Basic edge cases - core functionality validation
+ */
+static const struct ffs_test_case basic_test_cases[] = {
+	/* Zero case - special handling */
+	{0x00000000, 0, 0, "zero value"},
+
+	/* Single bit patterns - powers of 2 */
+	{0x00000001, 1, 1, "bit 0 set"},
+	{0x00000002, 2, 2, "bit 1 set"},
+	{0x00000004, 3, 3, "bit 2 set"},
+	{0x00000008, 4, 4, "bit 3 set"},
+	{0x00000010, 5, 5, "bit 4 set"},
+	{0x00000020, 6, 6, "bit 5 set"},
+	{0x00000040, 7, 7, "bit 6 set"},
+	{0x00000080, 8, 8, "bit 7 set"},
+	{0x00000100, 9, 9, "bit 8 set"},
+	{0x00008000, 16, 16, "bit 15 set"},
+	{0x00010000, 17, 17, "bit 16 set"},
+	{0x40000000, 31, 31, "bit 30 set"},
+	{0x80000000, 32, 32, "bit 31 set (sign bit)"},
+
+	/* Maximum values */
+	{0xFFFFFFFF, 1, 32, "all bits set"},
+
+	/* Multiple bit patterns */
+	{0x00000003, 1, 2, "bits 0-1 set"},
+	{0x00000007, 1, 3, "bits 0-2 set"},
+	{0x0000000F, 1, 4, "bits 0-3 set"},
+	{0x000000FF, 1, 8, "bits 0-7 set"},
+	{0x0000FFFF, 1, 16, "bits 0-15 set"},
+	{0x7FFFFFFF, 1, 31, "bits 0-30 set"},
+
+	/* Sparse patterns */
+	{0x00000101, 1, 9, "bits 0,8 set"},
+	{0x00001001, 1, 13, "bits 0,12 set"},
+	{0x80000001, 1, 32, "bits 0,31 set"},
+	{0x40000002, 2, 31, "bits 1,30 set"},
+};
+
+/*
+ * 64-bit test cases
+ */
+static const struct ffs64_test_case ffs64_test_cases[] = {
+	/* Zero case */
+	{0x0000000000000000ULL, 0, 0, "zero value"},
+
+	/* Single bit patterns */
+	{0x0000000000000001ULL, 1, 0, "bit 0 set"},
+	{0x0000000000000002ULL, 2, 1, "bit 1 set"},
+	{0x0000000000000004ULL, 3, 2, "bit 2 set"},
+	{0x0000000000000008ULL, 4, 3, "bit 3 set"},
+	{0x0000000000008000ULL, 16, 15, "bit 15 set"},
+	{0x0000000000010000ULL, 17, 16, "bit 16 set"},
+	{0x0000000080000000ULL, 32, 31, "bit 31 set"},
+	{0x0000000100000000ULL, 33, 32, "bit 32 set"},
+	{0x0000000200000000ULL, 34, 33, "bit 33 set"},
+	{0x4000000000000000ULL, 63, 62, "bit 62 set"},
+	{0x8000000000000000ULL, 64, 63, "bit 63 set (sign bit)"},
+
+	/* Maximum values */
+	{0xFFFFFFFFFFFFFFFFULL, 64, 0, "all bits set"},
+
+	/* Cross 32-bit boundary patterns */
+	{0x00000000FFFFFFFFULL, 32, 0, "lower 32 bits set"},
+	{0xFFFFFFFF00000000ULL, 64, 32, "upper 32 bits set"},
+	{0x8000000000000001ULL, 64, 0, "bits 0,63 set"},
+	{0x4000000000000002ULL, 63, 1, "bits 1,62 set"},
+
+	/* Mixed patterns */
+	{0x00000001FFFFFFFFULL, 33, 0, "bit 32 + lower 32 bits"},
+	{0xFFFFFFFF80000000ULL, 64, 31, "upper 32 bits + bit 31"},
+};
+
+/*
+ * Helper function to validate ffs results with detailed error messages
+ */
+static void validate_ffs_result(struct kunit *test, unsigned long input,
+				int actual, int expected, const char *func_name,
+				const char *description)
+{
+	KUNIT_EXPECT_EQ_MSG(test, actual, expected,
+			    "%s(0x%08lx) [%s]: expected %d, got %d",
+			    func_name, input, description, expected, actual);
+}
+
+/*
+ * Helper function to validate 64-bit ffs results
+ */
+static void validate_ffs64_result(struct kunit *test, u64 input,
+				  int actual, int expected, const char *func_name,
+				  const char *description)
+{
+	KUNIT_EXPECT_EQ_MSG(test, actual, expected,
+			    "%s(0x%016llx) [%s]: expected %d, got %d",
+			    func_name, input, description, expected, actual);
+}
+
+/*
+ * Helper function to validate mathematical relationships between functions
+ */
+static void validate_ffs_relationships(struct kunit *test, unsigned long input)
+{
+	int ffs_result;
+	int fls_result;
+	unsigned int ffs_0based;
+	unsigned int fls_0based;
+
+	if (input == 0) {
+		/* Special case: zero input */
+		KUNIT_EXPECT_EQ(test, ffs(input), 0);
+		KUNIT_EXPECT_EQ(test, fls(input), 0);
+		/* __ffs and __fls are undefined for 0, but often return specific values */
+		return;
+	}
+
+	ffs_result = ffs(input);
+	fls_result = fls(input);
+	ffs_0based = __ffs(input);
+	fls_0based = __fls(input);
+
+	/* Relationship: ffs(x) == __ffs(x) + 1 for x != 0 */
+	KUNIT_EXPECT_EQ_MSG(test, ffs_result, ffs_0based + 1,
+			    "ffs(0x%08lx) != __ffs(0x%08lx) + 1: %d != %u + 1",
+			    input, input, ffs_result, ffs_0based);
+
+	/* Relationship: fls(x) == __fls(x) + 1 for x != 0 */
+	KUNIT_EXPECT_EQ_MSG(test, fls_result, fls_0based + 1,
+			    "fls(0x%08lx) != __fls(0x%08lx) + 1: %d != %u + 1",
+			    input, input, fls_result, fls_0based);
+
+	/* Range validation */
+	KUNIT_EXPECT_GE(test, ffs_result, 1);
+	KUNIT_EXPECT_LE(test, ffs_result, BITS_PER_LONG);
+	KUNIT_EXPECT_GE(test, fls_result, 1);
+	KUNIT_EXPECT_LE(test, fls_result, BITS_PER_LONG);
+}
+
+/*
+ * Helper function to validate 64-bit relationships
+ */
+static void validate_ffs64_relationships(struct kunit *test, u64 input)
+{
+	int fls64_result;
+	unsigned int ffs64_0based;
+
+	if (input == 0) {
+		KUNIT_EXPECT_EQ(test, fls64(input), 0);
+		return;
+	}
+
+	fls64_result = fls64(input);
+	ffs64_0based = __ffs64(input);
+
+	/* Range validation */
+	KUNIT_EXPECT_GE(test, fls64_result, 1);
+	KUNIT_EXPECT_LE(test, fls64_result, 64);
+	KUNIT_EXPECT_LT(test, ffs64_0based, 64);
+
+	/*
+	 * Relationships with 32-bit functions should hold for small values
+	 * on all architectures.
+	 */
+	if (input <= 0xFFFFFFFFULL) {
+		unsigned long input_32 = (unsigned long)input;
+		KUNIT_EXPECT_EQ_MSG(test, fls64(input), fls(input_32),
+				    "fls64(0x%llx) != fls(0x%lx): %d != %d",
+				    input, input_32, fls64(input), fls(input_32));
+
+		if (input != 0) {
+			KUNIT_EXPECT_EQ_MSG(test, __ffs64(input), __ffs(input_32),
+					    "__ffs64(0x%llx) != __ffs(0x%lx): %lu != %lu",
+					    input, input_32,
+					    (unsigned long)__ffs64(input),
+					    (unsigned long)__ffs(input_32));
+		}
+	}
+}
+
+/*
+ * Test basic correctness of all ffs-family functions
+ */
+static void ffs_basic_correctness_test(struct kunit *test)
+{
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(basic_test_cases); i++) {
+		const struct ffs_test_case *tc = &basic_test_cases[i];
+
+		/* Test ffs() */
+		validate_ffs_result(test, tc->input, ffs(tc->input),
+				    tc->expected_ffs, "ffs", tc->description);
+
+		/* Test fls() */
+		validate_ffs_result(test, tc->input, fls(tc->input),
+				    tc->expected_fls, "fls", tc->description);
+
+		/* Test __ffs() - skip zero case as it's undefined */
+		if (tc->input != 0) {
+			/* Calculate expected __ffs() result: __ffs(x) == ffs(x) - 1 */
+			unsigned int expected_ffs_0based = tc->expected_ffs - 1;
+			validate_ffs_result(test, tc->input, __ffs(tc->input),
+					    expected_ffs_0based, "__ffs", tc->description);
+		}
+
+		/* Test __fls() - skip zero case as it's undefined */
+		if (tc->input != 0) {
+			/* Calculate expected __fls() result: __fls(x) == fls(x) - 1 */
+			unsigned int expected_fls_0based = tc->expected_fls - 1;
+			validate_ffs_result(test, tc->input, __fls(tc->input),
+					    expected_fls_0based, "__fls", tc->description);
+		}
+	}
+}
+
+/*
+ * Test 64-bit function correctness
+ */
+static void ffs64_correctness_test(struct kunit *test)
+{
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(ffs64_test_cases); i++) {
+		const struct ffs64_test_case *tc = &ffs64_test_cases[i];
+
+		/* Test fls64() */
+		validate_ffs64_result(test, tc->input, fls64(tc->input),
+				      tc->expected_fls64, "fls64", tc->description);
+
+		/* Test __ffs64() - skip zero case as it's undefined */
+		if (tc->input != 0) {
+			validate_ffs64_result(test, tc->input, __ffs64(tc->input),
+					      tc->expected_ffs64_0based, "__ffs64",
+					      tc->description);
+		}
+	}
+}
+
+/*
+ * Test mathematical relationships between functions
+ */
+static void ffs_mathematical_relationships_test(struct kunit *test)
+{
+	int i;
+
+	/* Test basic cases */
+	for (i = 0; i < ARRAY_SIZE(basic_test_cases); i++) {
+		validate_ffs_relationships(test, basic_test_cases[i].input);
+	}
+
+	/* Test 64-bit cases */
+	for (i = 0; i < ARRAY_SIZE(ffs64_test_cases); i++) {
+		validate_ffs64_relationships(test, ffs64_test_cases[i].input);
+	}
+}
+
+/*
+ * Test edge cases and boundary conditions
+ */
+static void ffs_edge_cases_test(struct kunit *test)
+{
+	unsigned long test_patterns[] = {
+		/* Powers of 2 */
+		1UL, 2UL, 4UL, 8UL, 16UL, 32UL, 64UL, 128UL,
+		256UL, 512UL, 1024UL, 2048UL, 4096UL, 8192UL,
+
+		/* Powers of 2 minus 1 */
+		1UL, 3UL, 7UL, 15UL, 31UL, 63UL, 127UL, 255UL,
+		511UL, 1023UL, 2047UL, 4095UL, 8191UL,
+
+		/* Boundary values */
+		0x7FFFFFFFUL,	/* Maximum positive 32-bit */
+		0x80000000UL,	/* Minimum negative 32-bit */
+		0xFFFFFFFFUL,	/* Maximum 32-bit unsigned */
+	};
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(test_patterns); i++) {
+		validate_ffs_relationships(test, test_patterns[i]);
+	}
+}
+
+/*
+ * Test 64-bit edge cases
+ */
+static void ffs64_edge_cases_test(struct kunit *test)
+{
+	u64 test_patterns_64[] = {
+		/* 64-bit powers of 2 */
+		0x0000000100000000ULL,	/* 2^32 */
+		0x0000000200000000ULL,	/* 2^33 */
+		0x0000000400000000ULL,	/* 2^34 */
+		0x0000001000000000ULL,	/* 2^36 */
+		0x0000010000000000ULL,	/* 2^40 */
+		0x0001000000000000ULL,	/* 2^48 */
+		0x0100000000000000ULL,	/* 2^56 */
+		0x4000000000000000ULL,	/* 2^62 */
+		0x8000000000000000ULL,	/* 2^63 */
+
+		/* Cross-boundary patterns */
+		0x00000000FFFFFFFFULL,	/* Lower 32 bits */
+		0xFFFFFFFF00000000ULL,	/* Upper 32 bits */
+		0x7FFFFFFFFFFFFFFFULL,	/* Maximum positive 64-bit */
+		0xFFFFFFFFFFFFFFFFULL,	/* Maximum 64-bit unsigned */
+	};
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(test_patterns_64); i++) {
+		validate_ffs64_relationships(test, test_patterns_64[i]);
+	}
+}
+
+/*
+ * ffz() test data - Find First Zero bit test cases
+ */
+struct ffz_test_case {
+	unsigned long input;
+	unsigned long expected_ffz;
+	const char *description;
+};
+
+static const struct ffz_test_case ffz_test_cases[] = {
+	/* Zero bits in specific positions */
+	{0xFFFFFFFE, 0, "bit 0 is zero"},      /* ...11111110 */
+	{0xFFFFFFFD, 1, "bit 1 is zero"},      /* ...11111101 */
+	{0xFFFFFFFB, 2, "bit 2 is zero"},      /* ...11111011 */
+	{0xFFFFFFF7, 3, "bit 3 is zero"},      /* ...11110111 */
+	{0xFFFFFFEF, 4, "bit 4 is zero"},      /* ...11101111 */
+	{0xFFFFFFDF, 5, "bit 5 is zero"},      /* ...11011111 */
+	{0xFFFFFFBF, 6, "bit 6 is zero"},      /* ...10111111 */
+	{0xFFFFFF7F, 7, "bit 7 is zero"},      /* ...01111111 */
+	{0xFFFFFEFF, 8, "bit 8 is zero"},      /* Gap in bit 8 */
+	{0xFFFF7FFF, 15, "bit 15 is zero"},    /* Gap in bit 15 */
+	{0xFFFEFFFF, 16, "bit 16 is zero"},    /* Gap in bit 16 */
+	{0xBFFFFFFF, 30, "bit 30 is zero"},    /* Gap in bit 30 */
+	{0x7FFFFFFF, 31, "bit 31 is zero"},    /* 01111111... */
+
+	/* Multiple zero patterns */
+	{0xFFFFFFFC, 0, "bits 0-1 are zero"},  /* ...11111100 */
+	{0xFFFFFFF8, 0, "bits 0-2 are zero"},  /* ...11111000 */
+	{0xFFFFFFF0, 0, "bits 0-3 are zero"},  /* ...11110000 */
+	{0xFFFFFF00, 0, "bits 0-7 are zero"},  /* ...00000000 */
+	{0xFFFF0000, 0, "bits 0-15 are zero"}, /* Lower 16 bits zero */
+
+	/* All zeros (special case) */
+	{0x00000000, 0, "all bits zero"},
+
+	/* Complex patterns */
+	{0xFFFDFFFF, 17, "bit 17 is zero"},    /* Gap in bit 17 */
+	{0xFFF7FFFF, 19, "bit 19 is zero"},    /* Gap in bit 19 */
+	{0xF7FFFFFF, 27, "bit 27 is zero"},    /* Gap in bit 27 */
+	{0xDFFFFFFF, 29, "bit 29 is zero"},    /* Gap in bit 29 */
+};
+
+/*
+ * Test basic correctness of ffz() function
+ */
+static void ffz_basic_correctness_test(struct kunit *test)
+{
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(ffz_test_cases); i++) {
+		const struct ffz_test_case *tc = &ffz_test_cases[i];
+		unsigned long result = ffz(tc->input);
+
+		KUNIT_EXPECT_EQ_MSG(test, result, tc->expected_ffz,
+				    "ffz(0x%08lx) [%s]: expected %lu, got %lu",
+				    tc->input, tc->description, tc->expected_ffz, result);
+	}
+}
+
+/*
+ * Test mathematical relationships between ffz() and other functions
+ */
+static void validate_ffz_relationships(struct kunit *test, unsigned long input)
+{
+	unsigned long ffz_result;
+
+	if (input == 0) {
+		/* ffz(0) should return 0 (first zero bit is at position 0) */
+		KUNIT_EXPECT_EQ(test, ffz(input), 0);
+		return;
+	}
+
+	if (input == ~0UL) {
+		/* ffz(~0) is undefined (no zero bits) - just verify it doesn't crash */
+		ffz_result = ffz(input);
+		/* Implementation-defined behavior, just ensure it completes */
+		return;
+	}
+
+	ffz_result = ffz(input);
+
+	/* Range validation - result should be within valid bit range */
+	KUNIT_EXPECT_LT(test, ffz_result, BITS_PER_LONG);
+
+	/* Verify the bit at ffz_result position is actually zero */
+	KUNIT_EXPECT_EQ_MSG(test, (input >> ffz_result) & 1, 0,
+			    "ffz(0x%08lx) = %lu, but bit %lu is not zero",
+			    input, ffz_result, ffz_result);
+
+	/* Core relationship: if we set the ffz bit, ffz should find a different bit */
+	if (ffz_result < BITS_PER_LONG - 1) {
+		unsigned long modified = input | (1UL << ffz_result);
+		if (modified != ~0UL) { /* Skip if all bits would be set */
+			unsigned long new_ffz = ffz(modified);
+			KUNIT_EXPECT_NE_MSG(test, new_ffz, ffz_result,
+					    "ffz(0x%08lx) = %lu, but setting that bit doesn't change ffz result",
+					    input, ffz_result);
+		}
+	}
+}
+
+static void ffz_mathematical_relationships_test(struct kunit *test)
+{
+	unsigned long test_patterns[] = {
+		/* Powers of 2 with one bit clear */
+		0xFFFFFFFE, 0xFFFFFFFD, 0xFFFFFFFB, 0xFFFFFFF7,
+		0xFFFFFFEF, 0xFFFFFFDF, 0xFFFFFFBF, 0xFFFFFF7F,
+
+		/* Multiple patterns */
+		0xFFFFFF00, 0xFFFFF000, 0xFFFF0000, 0xFFF00000,
+		0x7FFFFFFF, 0x3FFFFFFF, 0x1FFFFFFF, 0x0FFFFFFF,
+
+		/* Complex bit patterns */
+		0xAAAAAAAA, 0x55555555, 0xCCCCCCCC, 0x33333333,
+		0xF0F0F0F0, 0x0F0F0F0F, 0xFF00FF00, 0x00FF00FF,
+	};
+	int i;
+
+	/* Test basic test cases */
+	for (i = 0; i < ARRAY_SIZE(ffz_test_cases); i++) {
+		validate_ffz_relationships(test, ffz_test_cases[i].input);
+	}
+
+	/* Test additional patterns */
+	for (i = 0; i < ARRAY_SIZE(test_patterns); i++) {
+		validate_ffz_relationships(test, test_patterns[i]);
+	}
+}
+
+/*
+ * Test edge cases and boundary conditions for ffz()
+ */
+static void ffz_edge_cases_test(struct kunit *test)
+{
+	unsigned long edge_patterns[] = {
+		/* Boundary values */
+		0x00000000,  /* All zeros */
+		0x80000000,  /* Only MSB set */
+		0x00000001,  /* Only LSB set */
+		0x7FFFFFFF,  /* MSB clear */
+		0xFFFFFFFE,  /* LSB clear */
+
+		/* Powers of 2 complement patterns (one zero bit each) */
+		~(1UL << 0),  ~(1UL << 1),  ~(1UL << 2),  ~(1UL << 3),
+		~(1UL << 4),  ~(1UL << 8),  ~(1UL << 16), ~(1UL << 31),
+
+		/* Walking zero patterns */
+		0xFFFFFFFE, 0xFFFFFFFD, 0xFFFFFFFB, 0xFFFFFFF7,
+		0xFFFFFFEF, 0xFFFFFFDF, 0xFFFFFFBF, 0xFFFFFF7F,
+		0xFFFFFEFF, 0xFFFFFDFF, 0xFFFFFBFF, 0xFFFFF7FF,
+
+		/* Multiple zeros */
+		0xFFFFFF00, 0xFFFFF000, 0xFFFF0000, 0xFFF00000,
+		0xFF000000, 0xF0000000, 0x00000000,
+	};
+	int i;
+
+	for (i = 0; i < ARRAY_SIZE(edge_patterns); i++) {
+		validate_ffz_relationships(test, edge_patterns[i]);
+	}
+}
+
+/*
+ * To have useful build error output, split the tests into separate
+ * functions so it's clear which are missing __attribute_const__.
+ */
+#define CREATE_WRAPPER(func)						\
+static noinline bool build_test_##func(void)				\
+{									\
+	int init_##func = 32;						\
+	int result_##func = func(6);					\
+									\
+	/* Does the static initializer vanish after calling func? */	\
+	BUILD_BUG_ON(init_##func < 32);					\
+									\
+	/* "Consume" the results so optimizer doesn't drop them. */	\
+	barrier_data(&init_##func);					\
+	barrier_data(&result_##func);					\
+									\
+	return true;							\
+}
+CREATE_WRAPPER(ffs)
+CREATE_WRAPPER(fls)
+CREATE_WRAPPER(__ffs)
+CREATE_WRAPPER(__fls)
+CREATE_WRAPPER(ffz)
+#undef CREATE_WRAPPER
+
+/*
+ * Make sure that __attribute_const__ has be applied to all the
+ * functions. This is a regression test for:
+ * https://github.com/KSPP/linux/issues/364
+ */
+static void ffs_attribute_const_test(struct kunit *test)
+{
+	KUNIT_EXPECT_TRUE(test, build_test_ffs());
+	KUNIT_EXPECT_TRUE(test, build_test_fls());
+	KUNIT_EXPECT_TRUE(test, build_test___ffs());
+	KUNIT_EXPECT_TRUE(test, build_test___fls());
+	KUNIT_EXPECT_TRUE(test, build_test_ffz());
+}
+
+/*
+ * KUnit test case definitions
+ */
+static struct kunit_case ffs_test_cases[] = {
+	KUNIT_CASE(ffs_basic_correctness_test),
+	KUNIT_CASE(ffs64_correctness_test),
+	KUNIT_CASE(ffs_mathematical_relationships_test),
+	KUNIT_CASE(ffs_edge_cases_test),
+	KUNIT_CASE(ffs64_edge_cases_test),
+	KUNIT_CASE(ffz_basic_correctness_test),
+	KUNIT_CASE(ffz_mathematical_relationships_test),
+	KUNIT_CASE(ffz_edge_cases_test),
+	KUNIT_CASE(ffs_attribute_const_test),
+	{}
+};
+
+/*
+ * KUnit test suite definition
+ */
+static struct kunit_suite ffs_test_suite = {
+	.name = "ffs",
+	.test_cases = ffs_test_cases,
+};
+
+kunit_test_suites(&ffs_test_suite);
+
+MODULE_DESCRIPTION("KUnit tests for ffs()-family functions");
+MODULE_LICENSE("GPL");
diff --git a/lib/xarray.c b/lib/xarray.c
index 9a8b4916540c..a2e543d1396c 100644
--- a/lib/xarray.c
+++ b/lib/xarray.c
@@ -368,7 +368,7 @@ static void *xas_alloc(struct xa_state *xas, unsigned int shift)
 		return NULL;
 
 	if (node) {
-		xas->xa_alloc = NULL;
+		xas->xa_alloc = rcu_dereference_raw(node->parent);
 	} else {
 		gfp_t gfp = GFP_NOWAIT;
 
@@ -2386,7 +2386,6 @@ void xa_destroy(struct xarray *xa)
 	unsigned long flags;
 	void *entry;
 
-	xas.xa_node = NULL;
 	xas_lock_irqsave(&xas, flags);
 	entry = xa_head_locked(xa);
 	RCU_INIT_POINTER(xa->xa_head, NULL);
diff --git a/localversion-next b/localversion-next
new file mode 100644
index 000000000000..29eef74bbed8
--- /dev/null
+++ b/localversion-next
@@ -0,0 +1 @@
+-next-20250929
diff --git a/mm/Kconfig b/mm/Kconfig
index bde9f842a4a8..0e26f4fc8717 100644
--- a/mm/Kconfig
+++ b/mm/Kconfig
@@ -167,6 +167,7 @@ menu "Slab allocator options"
 
 config SLUB
 	def_bool y
+	select IRQ_WORK
 
 config KVFREE_RCU_BATCHED
 	def_bool y
diff --git a/mm/internal.h b/mm/internal.h
index 63e3ec8d63be..1561fc2ff5b8 100644
--- a/mm/internal.h
+++ b/mm/internal.h
@@ -843,6 +843,10 @@ static inline struct page *alloc_frozen_pages_noprof(gfp_t gfp, unsigned int ord
 #define alloc_frozen_pages(...) \
 	alloc_hooks(alloc_frozen_pages_noprof(__VA_ARGS__))
 
+struct page *alloc_frozen_pages_nolock_noprof(gfp_t gfp_flags, int nid, unsigned int order);
+#define alloc_frozen_pages_nolock(...) \
+	alloc_hooks(alloc_frozen_pages_nolock_noprof(__VA_ARGS__))
+
 extern void zone_pcp_reset(struct zone *zone);
 extern void zone_pcp_disable(struct zone *zone);
 extern void zone_pcp_enable(struct zone *zone);
diff --git a/mm/kasan/common.c b/mm/kasan/common.c
index e3765931a31f..d4c14359feaf 100644
--- a/mm/kasan/common.c
+++ b/mm/kasan/common.c
@@ -261,7 +261,7 @@ bool __kasan_slab_pre_free(struct kmem_cache *cache, void *object,
 }
 
 bool __kasan_slab_free(struct kmem_cache *cache, void *object, bool init,
-		       bool still_accessible)
+		       bool still_accessible, bool no_quarantine)
 {
 	if (is_kfence_address(object))
 		return false;
@@ -283,6 +283,9 @@ bool __kasan_slab_free(struct kmem_cache *cache, void *object, bool init,
 
 	poison_slab_object(cache, object, init);
 
+	if (no_quarantine)
+		return false;
+
 	/*
 	 * If the object is put into quarantine, do not let slab put the object
 	 * onto the freelist for now. The object's metadata is kept until the
diff --git a/mm/memblock.c b/mm/memblock.c
index 6ec3eaa4e8d1..e23e16618e9b 100644
--- a/mm/memblock.c
+++ b/mm/memblock.c
@@ -1445,70 +1445,6 @@ int __init_memblock memblock_set_node(phys_addr_t base, phys_addr_t size,
 	return 0;
 }
 
-#ifdef CONFIG_DEFERRED_STRUCT_PAGE_INIT
-/**
- * __next_mem_pfn_range_in_zone - iterator for for_each_*_range_in_zone()
- *
- * @idx: pointer to u64 loop variable
- * @zone: zone in which all of the memory blocks reside
- * @out_spfn: ptr to ulong for start pfn of the range, can be %NULL
- * @out_epfn: ptr to ulong for end pfn of the range, can be %NULL
- *
- * This function is meant to be a zone/pfn specific wrapper for the
- * for_each_mem_range type iterators. Specifically they are used in the
- * deferred memory init routines and as such we were duplicating much of
- * this logic throughout the code. So instead of having it in multiple
- * locations it seemed like it would make more sense to centralize this to
- * one new iterator that does everything they need.
- */
-void __init_memblock
-__next_mem_pfn_range_in_zone(u64 *idx, struct zone *zone,
-			     unsigned long *out_spfn, unsigned long *out_epfn)
-{
-	int zone_nid = zone_to_nid(zone);
-	phys_addr_t spa, epa;
-
-	__next_mem_range(idx, zone_nid, MEMBLOCK_NONE,
-			 &memblock.memory, &memblock.reserved,
-			 &spa, &epa, NULL);
-
-	while (*idx != U64_MAX) {
-		unsigned long epfn = PFN_DOWN(epa);
-		unsigned long spfn = PFN_UP(spa);
-
-		/*
-		 * Verify the end is at least past the start of the zone and
-		 * that we have at least one PFN to initialize.
-		 */
-		if (zone->zone_start_pfn < epfn && spfn < epfn) {
-			/* if we went too far just stop searching */
-			if (zone_end_pfn(zone) <= spfn) {
-				*idx = U64_MAX;
-				break;
-			}
-
-			if (out_spfn)
-				*out_spfn = max(zone->zone_start_pfn, spfn);
-			if (out_epfn)
-				*out_epfn = min(zone_end_pfn(zone), epfn);
-
-			return;
-		}
-
-		__next_mem_range(idx, zone_nid, MEMBLOCK_NONE,
-				 &memblock.memory, &memblock.reserved,
-				 &spa, &epa, NULL);
-	}
-
-	/* signal end of iteration */
-	if (out_spfn)
-		*out_spfn = ULONG_MAX;
-	if (out_epfn)
-		*out_epfn = 0;
-}
-
-#endif /* CONFIG_DEFERRED_STRUCT_PAGE_INIT */
-
 /**
  * memblock_alloc_range_nid - allocate boot memory block
  * @size: size of memory block to be allocated in bytes
diff --git a/mm/mm_init.c b/mm/mm_init.c
index df614556741a..3db2dea7db4c 100644
--- a/mm/mm_init.c
+++ b/mm/mm_init.c
@@ -2045,112 +2045,63 @@ static unsigned long __init deferred_init_pages(struct zone *zone,
 }
 
 /*
- * This function is meant to pre-load the iterator for the zone init from
- * a given point.
- * Specifically it walks through the ranges starting with initial index
- * passed to it until we are caught up to the first_init_pfn value and
- * exits there. If we never encounter the value we return false indicating
- * there are no valid ranges left.
- */
-static bool __init
-deferred_init_mem_pfn_range_in_zone(u64 *i, struct zone *zone,
-				    unsigned long *spfn, unsigned long *epfn,
-				    unsigned long first_init_pfn)
-{
-	u64 j = *i;
-
-	if (j == 0)
-		__next_mem_pfn_range_in_zone(&j, zone, spfn, epfn);
-
-	/*
-	 * Start out by walking through the ranges in this zone that have
-	 * already been initialized. We don't need to do anything with them
-	 * so we just need to flush them out of the system.
-	 */
-	for_each_free_mem_pfn_range_in_zone_from(j, zone, spfn, epfn) {
-		if (*epfn <= first_init_pfn)
-			continue;
-		if (*spfn < first_init_pfn)
-			*spfn = first_init_pfn;
-		*i = j;
-		return true;
-	}
-
-	return false;
-}
-
-/*
- * Initialize and free pages. We do it in two loops: first we initialize
- * struct page, then free to buddy allocator, because while we are
- * freeing pages we can access pages that are ahead (computing buddy
- * page in __free_one_page()).
+ * Initialize and free pages.
+ *
+ * At this point reserved pages and struct pages that correspond to holes in
+ * memblock.memory are already intialized so every free range has a valid
+ * memory map around it.
+ * This ensures that access of pages that are ahead of the range being
+ * initialized (computing buddy page in __free_one_page()) always reads a valid
+ * struct page.
  *
- * In order to try and keep some memory in the cache we have the loop
- * broken along max page order boundaries. This way we will not cause
- * any issues with the buddy page computation.
+ * In order to try and improve CPU cache locality we have the loop broken along
+ * max page order boundaries.
  */
 static unsigned long __init
-deferred_init_maxorder(u64 *i, struct zone *zone, unsigned long *start_pfn,
-		       unsigned long *end_pfn)
+deferred_init_memmap_chunk(unsigned long start_pfn, unsigned long end_pfn,
+			   struct zone *zone)
 {
-	unsigned long mo_pfn = ALIGN(*start_pfn + 1, MAX_ORDER_NR_PAGES);
-	unsigned long spfn = *start_pfn, epfn = *end_pfn;
+	int nid = zone_to_nid(zone);
 	unsigned long nr_pages = 0;
-	u64 j = *i;
-
-	/* First we loop through and initialize the page values */
-	for_each_free_mem_pfn_range_in_zone_from(j, zone, start_pfn, end_pfn) {
-		unsigned long t;
-
-		if (mo_pfn <= *start_pfn)
-			break;
+	phys_addr_t start, end;
+	u64 i = 0;
 
-		t = min(mo_pfn, *end_pfn);
-		nr_pages += deferred_init_pages(zone, *start_pfn, t);
+	for_each_free_mem_range(i, nid, 0, &start, &end, NULL) {
+		unsigned long spfn = PFN_UP(start);
+		unsigned long epfn = PFN_DOWN(end);
 
-		if (mo_pfn < *end_pfn) {
-			*start_pfn = mo_pfn;
+		if (spfn >= end_pfn)
 			break;
-		}
-	}
 
-	/* Reset values and now loop through freeing pages as needed */
-	swap(j, *i);
+		spfn = max(spfn, start_pfn);
+		epfn = min(epfn, end_pfn);
 
-	for_each_free_mem_pfn_range_in_zone_from(j, zone, &spfn, &epfn) {
-		unsigned long t;
+		while (spfn < epfn) {
+			unsigned long mo_pfn = ALIGN(spfn + 1, MAX_ORDER_NR_PAGES);
+			unsigned long chunk_end = min(mo_pfn, epfn);
 
-		if (mo_pfn <= spfn)
-			break;
+			nr_pages += deferred_init_pages(zone, spfn, chunk_end);
+			deferred_free_pages(spfn, chunk_end - spfn);
 
-		t = min(mo_pfn, epfn);
-		deferred_free_pages(spfn, t - spfn);
+			spfn = chunk_end;
 
-		if (mo_pfn <= epfn)
-			break;
+			if (irqs_disabled())
+				touch_nmi_watchdog();
+			else
+				cond_resched();
+		}
 	}
 
 	return nr_pages;
 }
 
 static void __init
-deferred_init_memmap_chunk(unsigned long start_pfn, unsigned long end_pfn,
-			   void *arg)
+deferred_init_memmap_job(unsigned long start_pfn, unsigned long end_pfn,
+			 void *arg)
 {
-	unsigned long spfn, epfn;
 	struct zone *zone = arg;
-	u64 i = 0;
-
-	deferred_init_mem_pfn_range_in_zone(&i, zone, &spfn, &epfn, start_pfn);
 
-	/*
-	 * Initialize and free pages in MAX_PAGE_ORDER sized increments so that
-	 * we can avoid introducing any issues with the buddy allocator.
-	 */
-	while (spfn < end_pfn) {
-		deferred_init_maxorder(&i, zone, &spfn, &epfn);
-		cond_resched();
-	}
+	deferred_init_memmap_chunk(start_pfn, end_pfn, zone);
 }
 
 static unsigned int __init
@@ -2164,12 +2115,10 @@ static int __init deferred_init_memmap(void *data)
 {
 	pg_data_t *pgdat = data;
 	const struct cpumask *cpumask = cpumask_of_node(pgdat->node_id);
-	unsigned long spfn = 0, epfn = 0;
-	unsigned long first_init_pfn, flags;
+	int max_threads = deferred_page_init_max_threads(cpumask);
+	unsigned long first_init_pfn, last_pfn, flags;
 	unsigned long start = jiffies;
 	struct zone *zone;
-	int max_threads;
-	u64 i = 0;
 
 	/* Bind memory initialisation thread to a local node if possible */
 	if (!cpumask_empty(cpumask))
@@ -2197,24 +2146,20 @@ static int __init deferred_init_memmap(void *data)
 
 	/* Only the highest zone is deferred */
 	zone = pgdat->node_zones + pgdat->nr_zones - 1;
+	last_pfn = SECTION_ALIGN_UP(zone_end_pfn(zone));
 
-	max_threads = deferred_page_init_max_threads(cpumask);
+	struct padata_mt_job job = {
+		.thread_fn   = deferred_init_memmap_job,
+		.fn_arg      = zone,
+		.start       = first_init_pfn,
+		.size        = last_pfn - first_init_pfn,
+		.align       = PAGES_PER_SECTION,
+		.min_chunk   = PAGES_PER_SECTION,
+		.max_threads = max_threads,
+		.numa_aware  = false,
+	};
 
-	while (deferred_init_mem_pfn_range_in_zone(&i, zone, &spfn, &epfn, first_init_pfn)) {
-		first_init_pfn = ALIGN(epfn, PAGES_PER_SECTION);
-		struct padata_mt_job job = {
-			.thread_fn   = deferred_init_memmap_chunk,
-			.fn_arg      = zone,
-			.start       = spfn,
-			.size        = first_init_pfn - spfn,
-			.align       = PAGES_PER_SECTION,
-			.min_chunk   = PAGES_PER_SECTION,
-			.max_threads = max_threads,
-			.numa_aware  = false,
-		};
-
-		padata_do_multithreaded(&job);
-	}
+	padata_do_multithreaded(&job);
 
 	/* Sanity check that the next zone really is unpopulated */
 	WARN_ON(pgdat->nr_zones < MAX_NR_ZONES && populated_zone(++zone));
@@ -2239,12 +2184,11 @@ static int __init deferred_init_memmap(void *data)
  */
 bool __init deferred_grow_zone(struct zone *zone, unsigned int order)
 {
-	unsigned long nr_pages_needed = ALIGN(1 << order, PAGES_PER_SECTION);
+	unsigned long nr_pages_needed = SECTION_ALIGN_UP(1 << order);
 	pg_data_t *pgdat = zone->zone_pgdat;
 	unsigned long first_deferred_pfn = pgdat->first_deferred_pfn;
 	unsigned long spfn, epfn, flags;
 	unsigned long nr_pages = 0;
-	u64 i = 0;
 
 	/* Only the last zone may have deferred pages */
 	if (zone_end_pfn(zone) != pgdat_end_pfn(pgdat))
@@ -2261,37 +2205,26 @@ bool __init deferred_grow_zone(struct zone *zone, unsigned int order)
 		return true;
 	}
 
-	/* If the zone is empty somebody else may have cleared out the zone */
-	if (!deferred_init_mem_pfn_range_in_zone(&i, zone, &spfn, &epfn,
-						 first_deferred_pfn)) {
-		pgdat->first_deferred_pfn = ULONG_MAX;
-		pgdat_resize_unlock(pgdat, &flags);
-		/* Retry only once. */
-		return first_deferred_pfn != ULONG_MAX;
+	/*
+	 * Initialize at least nr_pages_needed in section chunks.
+	 * If a section has less free memory than nr_pages_needed, the next
+	 * section will be also initialized.
+	 * Note, that it still does not guarantee that allocation of order can
+	 * be satisfied if the sections are fragmented because of memblock
+	 * allocations.
+	 */
+	for (spfn = first_deferred_pfn, epfn = SECTION_ALIGN_UP(spfn + 1);
+	     nr_pages < nr_pages_needed && spfn < zone_end_pfn(zone);
+	     spfn = epfn, epfn += PAGES_PER_SECTION) {
+		nr_pages += deferred_init_memmap_chunk(spfn, epfn, zone);
 	}
 
 	/*
-	 * Initialize and free pages in MAX_PAGE_ORDER sized increments so
-	 * that we can avoid introducing any issues with the buddy
-	 * allocator.
+	 * There were no pages to initialize and free which means the zone's
+	 * memory map is completely initialized.
 	 */
-	while (spfn < epfn) {
-		/* update our first deferred PFN for this section */
-		first_deferred_pfn = spfn;
-
-		nr_pages += deferred_init_maxorder(&i, zone, &spfn, &epfn);
-		touch_nmi_watchdog();
-
-		/* We should only stop along section boundaries */
-		if ((first_deferred_pfn ^ spfn) < PAGES_PER_SECTION)
-			continue;
-
-		/* If our quota has been met we can stop here */
-		if (nr_pages >= nr_pages_needed)
-			break;
-	}
+	pgdat->first_deferred_pfn = nr_pages ? spfn : ULONG_MAX;
 
-	pgdat->first_deferred_pfn = spfn;
 	pgdat_resize_unlock(pgdat, &flags);
 
 	return nr_pages > 0;
diff --git a/mm/page_alloc.c b/mm/page_alloc.c
index 304e12bf2e4e..600d9e981c23 100644
--- a/mm/page_alloc.c
+++ b/mm/page_alloc.c
@@ -7533,22 +7533,7 @@ static bool __free_unaccepted(struct page *page)
 
 #endif /* CONFIG_UNACCEPTED_MEMORY */
 
-/**
- * alloc_pages_nolock - opportunistic reentrant allocation from any context
- * @nid: node to allocate from
- * @order: allocation order size
- *
- * Allocates pages of a given order from the given node. This is safe to
- * call from any context (from atomic, NMI, and also reentrant
- * allocator -> tracepoint -> alloc_pages_nolock_noprof).
- * Allocation is best effort and to be expected to fail easily so nobody should
- * rely on the success. Failures are not reported via warn_alloc().
- * See always fail conditions below.
- *
- * Return: allocated page or NULL on failure. NULL does not mean EBUSY or EAGAIN.
- * It means ENOMEM. There is no reason to call it again and expect !NULL.
- */
-struct page *alloc_pages_nolock_noprof(int nid, unsigned int order)
+struct page *alloc_frozen_pages_nolock_noprof(gfp_t gfp_flags, int nid, unsigned int order)
 {
 	/*
 	 * Do not specify __GFP_DIRECT_RECLAIM, since direct claim is not allowed.
@@ -7570,12 +7555,13 @@ struct page *alloc_pages_nolock_noprof(int nid, unsigned int order)
 	 * specify it here to highlight that alloc_pages_nolock()
 	 * doesn't want to deplete reserves.
 	 */
-	gfp_t alloc_gfp = __GFP_NOWARN | __GFP_ZERO | __GFP_NOMEMALLOC
-			| __GFP_ACCOUNT;
+	gfp_t alloc_gfp = __GFP_NOWARN | __GFP_ZERO | __GFP_NOMEMALLOC | __GFP_COMP
+			| gfp_flags;
 	unsigned int alloc_flags = ALLOC_TRYLOCK;
 	struct alloc_context ac = { };
 	struct page *page;
 
+	VM_WARN_ON_ONCE(gfp_flags & ~__GFP_ACCOUNT);
 	/*
 	 * In PREEMPT_RT spin_trylock() will call raw_spin_lock() which is
 	 * unsafe in NMI. If spin_trylock() is called from hard IRQ the current
@@ -7610,15 +7596,38 @@ struct page *alloc_pages_nolock_noprof(int nid, unsigned int order)
 
 	/* Unlike regular alloc_pages() there is no __alloc_pages_slowpath(). */
 
-	if (page)
-		set_page_refcounted(page);
-
-	if (memcg_kmem_online() && page &&
+	if (memcg_kmem_online() && page && (gfp_flags & __GFP_ACCOUNT) &&
 	    unlikely(__memcg_kmem_charge_page(page, alloc_gfp, order) != 0)) {
-		free_pages_nolock(page, order);
+		__free_frozen_pages(page, order, FPI_TRYLOCK);
 		page = NULL;
 	}
 	trace_mm_page_alloc(page, order, alloc_gfp, ac.migratetype);
 	kmsan_alloc_page(page, order, alloc_gfp);
 	return page;
 }
+/**
+ * alloc_pages_nolock - opportunistic reentrant allocation from any context
+ * @gfp_flags: GFP flags. Only __GFP_ACCOUNT allowed.
+ * @nid: node to allocate from
+ * @order: allocation order size
+ *
+ * Allocates pages of a given order from the given node. This is safe to
+ * call from any context (from atomic, NMI, and also reentrant
+ * allocator -> tracepoint -> alloc_pages_nolock_noprof).
+ * Allocation is best effort and to be expected to fail easily so nobody should
+ * rely on the success. Failures are not reported via warn_alloc().
+ * See always fail conditions below.
+ *
+ * Return: allocated page or NULL on failure. NULL does not mean EBUSY or EAGAIN.
+ * It means ENOMEM. There is no reason to call it again and expect !NULL.
+ */
+struct page *alloc_pages_nolock_noprof(gfp_t gfp_flags, int nid, unsigned int order)
+{
+	struct page *page;
+
+	page = alloc_frozen_pages_nolock_noprof(gfp_flags, nid, order);
+	if (page)
+		set_page_refcounted(page);
+	return page;
+}
+EXPORT_SYMBOL_GPL(alloc_pages_nolock_noprof);
diff --git a/mm/slab.h b/mm/slab.h
index c41a512dd07c..078daecc7cf5 100644
--- a/mm/slab.h
+++ b/mm/slab.h
@@ -57,6 +57,10 @@ struct slab {
 		struct {
 			union {
 				struct list_head slab_list;
+				struct { /* For deferred deactivate_slab() */
+					struct llist_node llnode;
+					void *flush_freelist;
+				};
 #ifdef CONFIG_SLUB_CPU_PARTIAL
 				struct {
 					struct slab *next;
@@ -234,7 +238,9 @@ struct kmem_cache_order_objects {
 struct kmem_cache {
 #ifndef CONFIG_SLUB_TINY
 	struct kmem_cache_cpu __percpu *cpu_slab;
+	struct lock_class_key lock_key;
 #endif
+	struct slub_percpu_sheaves __percpu *cpu_sheaves;
 	/* Used for retrieving partial slabs, etc. */
 	slab_flags_t flags;
 	unsigned long min_partial;
@@ -248,6 +254,7 @@ struct kmem_cache {
 	/* Number of per cpu partial slabs to keep around */
 	unsigned int cpu_partial_slabs;
 #endif
+	unsigned int sheaf_capacity;
 	struct kmem_cache_order_objects oo;
 
 	/* Allocation and freeing of slabs */
@@ -433,6 +440,9 @@ static inline bool is_kmalloc_normal(struct kmem_cache *s)
 	return !(s->flags & (SLAB_CACHE_DMA|SLAB_ACCOUNT|SLAB_RECLAIM_ACCOUNT));
 }
 
+bool __kfree_rcu_sheaf(struct kmem_cache *s, void *obj);
+void flush_all_rcu_sheaves(void);
+
 #define SLAB_CORE_FLAGS (SLAB_HWCACHE_ALIGN | SLAB_CACHE_DMA | \
 			 SLAB_CACHE_DMA32 | SLAB_PANIC | \
 			 SLAB_TYPESAFE_BY_RCU | SLAB_DEBUG_OBJECTS | \
@@ -526,8 +536,12 @@ static inline struct slabobj_ext *slab_obj_exts(struct slab *slab)
 	unsigned long obj_exts = READ_ONCE(slab->obj_exts);
 
 #ifdef CONFIG_MEMCG
-	VM_BUG_ON_PAGE(obj_exts && !(obj_exts & MEMCG_DATA_OBJEXTS),
-							slab_page(slab));
+	/*
+	 * obj_exts should be either NULL, a valid pointer with
+	 * MEMCG_DATA_OBJEXTS bit set or be equal to OBJEXTS_ALLOC_FAIL.
+	 */
+	VM_BUG_ON_PAGE(obj_exts && !(obj_exts & MEMCG_DATA_OBJEXTS) &&
+		       obj_exts != OBJEXTS_ALLOC_FAIL, slab_page(slab));
 	VM_BUG_ON_PAGE(obj_exts & MEMCG_DATA_KMEM, slab_page(slab));
 #endif
 	return (struct slabobj_ext *)(obj_exts & ~OBJEXTS_FLAGS_MASK);
@@ -656,6 +670,8 @@ void __kmem_obj_info(struct kmem_obj_info *kpp, void *object, struct slab *slab)
 void __check_heap_object(const void *ptr, unsigned long n,
 			 const struct slab *slab, bool to_user);
 
+void defer_free_barrier(void);
+
 static inline bool slub_debug_orig_size(struct kmem_cache *s)
 {
 	return (kmem_cache_debug_flags(s, SLAB_STORE_USER) &&
diff --git a/mm/slab_common.c b/mm/slab_common.c
index bfe7c40eeee1..932d13ada36c 100644
--- a/mm/slab_common.c
+++ b/mm/slab_common.c
@@ -163,6 +163,9 @@ int slab_unmergeable(struct kmem_cache *s)
 		return 1;
 #endif
 
+	if (s->cpu_sheaves)
+		return 1;
+
 	/*
 	 * We may have set a slab to be unmergeable during bootstrap.
 	 */
@@ -321,7 +324,7 @@ struct kmem_cache *__kmem_cache_create_args(const char *name,
 		    object_size - args->usersize < args->useroffset))
 		args->usersize = args->useroffset = 0;
 
-	if (!args->usersize)
+	if (!args->usersize && !args->sheaf_capacity)
 		s = __kmem_cache_alias(name, object_size, args->align, flags,
 				       args->ctor);
 	if (s)
@@ -507,6 +510,9 @@ void kmem_cache_destroy(struct kmem_cache *s)
 		rcu_barrier();
 	}
 
+	/* Wait for deferred work from kmalloc/kfree_nolock() */
+	defer_free_barrier();
+
 	cpus_read_lock();
 	mutex_lock(&slab_mutex);
 
@@ -1605,6 +1611,30 @@ static void kfree_rcu_work(struct work_struct *work)
 		kvfree_rcu_list(head);
 }
 
+static bool kfree_rcu_sheaf(void *obj)
+{
+	struct kmem_cache *s;
+	struct folio *folio;
+	struct slab *slab;
+
+	if (is_vmalloc_addr(obj))
+		return false;
+
+	folio = virt_to_folio(obj);
+	if (unlikely(!folio_test_slab(folio)))
+		return false;
+
+	slab = folio_slab(folio);
+	s = slab->slab_cache;
+	if (s->cpu_sheaves) {
+		if (likely(!IS_ENABLED(CONFIG_NUMA) ||
+			   slab_nid(slab) == numa_mem_id()))
+			return __kfree_rcu_sheaf(s, obj);
+	}
+
+	return false;
+}
+
 static bool
 need_offload_krc(struct kfree_rcu_cpu *krcp)
 {
@@ -1949,6 +1979,9 @@ void kvfree_call_rcu(struct rcu_head *head, void *ptr)
 	if (!head)
 		might_sleep();
 
+	if (!IS_ENABLED(CONFIG_PREEMPT_RT) && kfree_rcu_sheaf(ptr))
+		return;
+
 	// Queue the object but don't yet schedule the batch.
 	if (debug_rcu_head_queue(ptr)) {
 		// Probable double kfree_rcu(), just leak.
@@ -2023,6 +2056,8 @@ void kvfree_rcu_barrier(void)
 	bool queued;
 	int i, cpu;
 
+	flush_all_rcu_sheaves();
+
 	/*
 	 * Firstly we detach objects and queue them over an RCU-batch
 	 * for all CPUs. Finally queued works are flushed for each CPU.
diff --git a/mm/slub.c b/mm/slub.c
index e7233e523402..584a5ff1828b 100644
--- a/mm/slub.c
+++ b/mm/slub.c
@@ -44,7 +44,8 @@
 #include <kunit/test.h>
 #include <kunit/test-bug.h>
 #include <linux/sort.h>
-
+#include <linux/irq_work.h>
+#include <linux/kprobes.h>
 #include <linux/debugfs.h>
 #include <trace/events/kmem.h>
 
@@ -363,8 +364,12 @@ static inline void debugfs_slab_add(struct kmem_cache *s) { }
 #endif
 
 enum stat_item {
+	ALLOC_PCS,		/* Allocation from percpu sheaf */
 	ALLOC_FASTPATH,		/* Allocation from cpu slab */
 	ALLOC_SLOWPATH,		/* Allocation by getting a new cpu slab */
+	FREE_PCS,		/* Free to percpu sheaf */
+	FREE_RCU_SHEAF,		/* Free to rcu_free sheaf */
+	FREE_RCU_SHEAF_FAIL,	/* Failed to free to a rcu_free sheaf */
 	FREE_FASTPATH,		/* Free to cpu slab */
 	FREE_SLOWPATH,		/* Freeing not to cpu slab */
 	FREE_FROZEN,		/* Freeing to frozen slab */
@@ -389,6 +394,19 @@ enum stat_item {
 	CPU_PARTIAL_FREE,	/* Refill cpu partial on free */
 	CPU_PARTIAL_NODE,	/* Refill cpu partial from node partial */
 	CPU_PARTIAL_DRAIN,	/* Drain cpu partial to node partial */
+	SHEAF_FLUSH,		/* Objects flushed from a sheaf */
+	SHEAF_REFILL,		/* Objects refilled to a sheaf */
+	SHEAF_ALLOC,		/* Allocation of an empty sheaf */
+	SHEAF_FREE,		/* Freeing of an empty sheaf */
+	BARN_GET,		/* Got full sheaf from barn */
+	BARN_GET_FAIL,		/* Failed to get full sheaf from barn */
+	BARN_PUT,		/* Put full sheaf to barn */
+	BARN_PUT_FAIL,		/* Failed to put full sheaf to barn */
+	SHEAF_PREFILL_FAST,	/* Sheaf prefill grabbed the spare sheaf */
+	SHEAF_PREFILL_SLOW,	/* Sheaf prefill found no spare sheaf */
+	SHEAF_PREFILL_OVERSIZE,	/* Allocation of oversize sheaf for prefill */
+	SHEAF_RETURN_FAST,	/* Sheaf return reattached spare sheaf */
+	SHEAF_RETURN_SLOW,	/* Sheaf return could not reattach spare */
 	NR_SLUB_STAT_ITEMS
 };
 
@@ -409,7 +427,7 @@ struct kmem_cache_cpu {
 #ifdef CONFIG_SLUB_CPU_PARTIAL
 	struct slab *partial;	/* Partially allocated slabs */
 #endif
-	local_lock_t lock;	/* Protects the fields above */
+	local_trylock_t lock;	/* Protects the fields above */
 #ifdef CONFIG_SLUB_STATS
 	unsigned int stat[NR_SLUB_STAT_ITEMS];
 #endif
@@ -435,6 +453,37 @@ void stat_add(const struct kmem_cache *s, enum stat_item si, int v)
 #endif
 }
 
+#define MAX_FULL_SHEAVES	10
+#define MAX_EMPTY_SHEAVES	10
+
+struct node_barn {
+	spinlock_t lock;
+	struct list_head sheaves_full;
+	struct list_head sheaves_empty;
+	unsigned int nr_full;
+	unsigned int nr_empty;
+};
+
+struct slab_sheaf {
+	union {
+		struct rcu_head rcu_head;
+		struct list_head barn_list;
+		/* only used for prefilled sheafs */
+		unsigned int capacity;
+	};
+	struct kmem_cache *cache;
+	unsigned int size;
+	int node; /* only used for rcu_sheaf */
+	void *objects[];
+};
+
+struct slub_percpu_sheaves {
+	local_trylock_t lock;
+	struct slab_sheaf *main; /* never NULL when unlocked */
+	struct slab_sheaf *spare; /* empty or full, may be NULL */
+	struct slab_sheaf *rcu_free; /* for batching kfree_rcu() */
+};
+
 /*
  * The slab lists for all objects.
  */
@@ -447,6 +496,7 @@ struct kmem_cache_node {
 	atomic_long_t total_objects;
 	struct list_head full;
 #endif
+	struct node_barn *barn;
 };
 
 static inline struct kmem_cache_node *get_node(struct kmem_cache *s, int node)
@@ -454,6 +504,12 @@ static inline struct kmem_cache_node *get_node(struct kmem_cache *s, int node)
 	return s->node[node];
 }
 
+/* Get the barn of the current cpu's memory node */
+static inline struct node_barn *get_barn(struct kmem_cache *s)
+{
+	return get_node(s, numa_mem_id())->barn;
+}
+
 /*
  * Iterator over all nodes. The body will be executed for each node that has
  * a kmem_cache_node structure allocated (which is true for all online nodes)
@@ -470,12 +526,19 @@ static inline struct kmem_cache_node *get_node(struct kmem_cache *s, int node)
  */
 static nodemask_t slab_nodes;
 
-#ifndef CONFIG_SLUB_TINY
 /*
  * Workqueue used for flush_cpu_slab().
  */
 static struct workqueue_struct *flushwq;
-#endif
+
+struct slub_flush_work {
+	struct work_struct work;
+	struct kmem_cache *s;
+	bool skip;
+};
+
+static DEFINE_MUTEX(flush_lock);
+static DEFINE_PER_CPU(struct slub_flush_work, slub_flush);
 
 /********************************************************************
  * 			Core slab cache functions
@@ -822,6 +885,16 @@ static inline unsigned int get_orig_size(struct kmem_cache *s, void *object)
 }
 
 #ifdef CONFIG_SLUB_DEBUG
+
+/*
+ * For debugging context when we want to check if the struct slab pointer
+ * appears to be valid.
+ */
+static inline bool validate_slab_ptr(struct slab *slab)
+{
+	return PageSlab(slab_page(slab));
+}
+
 static unsigned long object_map[BITS_TO_LONGS(MAX_OBJS_PER_PAGE)];
 static DEFINE_SPINLOCK(object_map_lock);
 
@@ -1449,15 +1522,15 @@ static int check_object(struct kmem_cache *s, struct slab *slab,
 	return ret;
 }
 
+/*
+ * Checks if the slab state looks sane. Assumes the struct slab pointer
+ * was either obtained in a way that ensures it's valid, or validated
+ * by validate_slab_ptr()
+ */
 static int check_slab(struct kmem_cache *s, struct slab *slab)
 {
 	int maxobj;
 
-	if (!folio_test_slab(slab_folio(slab))) {
-		slab_err(s, slab, "Not a valid slab page");
-		return 0;
-	}
-
 	maxobj = order_objects(slab_order(slab), s->size);
 	if (slab->objects > maxobj) {
 		slab_err(s, slab, "objects %u > max %u",
@@ -1653,17 +1726,15 @@ static noinline bool alloc_debug_processing(struct kmem_cache *s,
 	return true;
 
 bad:
-	if (folio_test_slab(slab_folio(slab))) {
-		/*
-		 * If this is a slab page then lets do the best we can
-		 * to avoid issues in the future. Marking all objects
-		 * as used avoids touching the remaining objects.
-		 */
-		slab_fix(s, "Marking all objects used");
-		slab->inuse = slab->objects;
-		slab->freelist = NULL;
-		slab->frozen = 1; /* mark consistency-failed slab as frozen */
-	}
+	/*
+	 * Let's do the best we can to avoid issues in the future. Marking all
+	 * objects as used avoids touching the remaining objects.
+	 */
+	slab_fix(s, "Marking all objects used");
+	slab->inuse = slab->objects;
+	slab->freelist = NULL;
+	slab->frozen = 1; /* mark consistency-failed slab as frozen */
+
 	return false;
 }
 
@@ -1684,10 +1755,7 @@ static inline int free_consistency_checks(struct kmem_cache *s,
 		return 0;
 
 	if (unlikely(s != slab->slab_cache)) {
-		if (!folio_test_slab(slab_folio(slab))) {
-			slab_err(s, slab, "Attempt to free object(0x%p) outside of slab",
-				 object);
-		} else if (!slab->slab_cache) {
+		if (!slab->slab_cache) {
 			slab_err(NULL, slab, "No slab cache for object 0x%p",
 				 object);
 		} else {
@@ -1989,7 +2057,7 @@ static inline void handle_failed_objexts_alloc(unsigned long obj_exts,
 	 * objects with no tag reference. Mark all references in this
 	 * vector as empty to avoid warnings later on.
 	 */
-	if (obj_exts & OBJEXTS_ALLOC_FAIL) {
+	if (obj_exts == OBJEXTS_ALLOC_FAIL) {
 		unsigned int i;
 
 		for (i = 0; i < objects; i++)
@@ -2022,6 +2090,7 @@ static inline void init_slab_obj_exts(struct slab *slab)
 int alloc_slab_obj_exts(struct slab *slab, struct kmem_cache *s,
 		        gfp_t gfp, bool new_slab)
 {
+	bool allow_spin = gfpflags_allow_spinning(gfp);
 	unsigned int objects = objs_per_slab(s, slab);
 	unsigned long new_exts;
 	unsigned long old_exts;
@@ -2030,17 +2099,32 @@ int alloc_slab_obj_exts(struct slab *slab, struct kmem_cache *s,
 	gfp &= ~OBJCGS_CLEAR_MASK;
 	/* Prevent recursive extension vector allocation */
 	gfp |= __GFP_NO_OBJ_EXT;
-	vec = kcalloc_node(objects, sizeof(struct slabobj_ext), gfp,
-			   slab_nid(slab));
+
+	/*
+	 * Note that allow_spin may be false during early boot and its
+	 * restricted GFP_BOOT_MASK. Due to kmalloc_nolock() only supporting
+	 * architectures with cmpxchg16b, early obj_exts will be missing for
+	 * very early allocations on those.
+	 */
+	if (unlikely(!allow_spin)) {
+		size_t sz = objects * sizeof(struct slabobj_ext);
+
+		vec = kmalloc_nolock(sz, __GFP_ZERO | __GFP_NO_OBJ_EXT,
+				     slab_nid(slab));
+	} else {
+		vec = kcalloc_node(objects, sizeof(struct slabobj_ext), gfp,
+				   slab_nid(slab));
+	}
 	if (!vec) {
 		/* Mark vectors which failed to allocate */
-		if (new_slab)
-			mark_failed_objexts_alloc(slab);
+		mark_failed_objexts_alloc(slab);
 
 		return -ENOMEM;
 	}
 
 	new_exts = (unsigned long)vec;
+	if (unlikely(!allow_spin))
+		new_exts |= OBJEXTS_NOSPIN_ALLOC;
 #ifdef CONFIG_MEMCG
 	new_exts |= MEMCG_DATA_OBJEXTS;
 #endif
@@ -2061,7 +2145,10 @@ int alloc_slab_obj_exts(struct slab *slab, struct kmem_cache *s,
 		 * objcg vector should be reused.
 		 */
 		mark_objexts_empty(vec);
-		kfree(vec);
+		if (unlikely(!allow_spin))
+			kfree_nolock(vec);
+		else
+			kfree(vec);
 		return 0;
 	}
 
@@ -2085,7 +2172,10 @@ static inline void free_slab_obj_exts(struct slab *slab)
 	 * the extension for obj_exts is expected to be NULL.
 	 */
 	mark_objexts_empty(obj_exts);
-	kfree(obj_exts);
+	if (unlikely(READ_ONCE(slab->obj_exts) & OBJEXTS_NOSPIN_ALLOC))
+		kfree_nolock(obj_exts);
+	else
+		kfree(obj_exts);
 	slab->obj_exts = 0;
 }
 
@@ -2421,7 +2511,7 @@ bool slab_free_hook(struct kmem_cache *s, void *x, bool init,
 
 	}
 	/* KASAN might put x into memory quarantine, delaying its reuse. */
-	return !kasan_slab_free(s, x, init, still_accessible);
+	return !kasan_slab_free(s, x, init, still_accessible, false);
 }
 
 static __fastpath_inline
@@ -2480,2132 +2570,3888 @@ static void *setup_object(struct kmem_cache *s, void *object)
 	return object;
 }
 
-/*
- * Slab allocation and freeing
- */
-static inline struct slab *alloc_slab_page(gfp_t flags, int node,
-		struct kmem_cache_order_objects oo)
+static struct slab_sheaf *alloc_empty_sheaf(struct kmem_cache *s, gfp_t gfp)
 {
-	struct folio *folio;
-	struct slab *slab;
-	unsigned int order = oo_order(oo);
-
-	if (node == NUMA_NO_NODE)
-		folio = (struct folio *)alloc_frozen_pages(flags, order);
-	else
-		folio = (struct folio *)__alloc_frozen_pages(flags, order, node, NULL);
+	struct slab_sheaf *sheaf = kzalloc(struct_size(sheaf, objects,
+					s->sheaf_capacity), gfp);
 
-	if (!folio)
+	if (unlikely(!sheaf))
 		return NULL;
 
-	slab = folio_slab(folio);
-	__folio_set_slab(folio);
-	if (folio_is_pfmemalloc(folio))
-		slab_set_pfmemalloc(slab);
+	sheaf->cache = s;
 
-	return slab;
+	stat(s, SHEAF_ALLOC);
+
+	return sheaf;
 }
 
-#ifdef CONFIG_SLAB_FREELIST_RANDOM
-/* Pre-initialize the random sequence cache */
-static int init_cache_random_seq(struct kmem_cache *s)
+static void free_empty_sheaf(struct kmem_cache *s, struct slab_sheaf *sheaf)
 {
-	unsigned int count = oo_objects(s->oo);
-	int err;
+	kfree(sheaf);
 
-	/* Bailout if already initialised */
-	if (s->random_seq)
+	stat(s, SHEAF_FREE);
+}
+
+static int __kmem_cache_alloc_bulk(struct kmem_cache *s, gfp_t flags,
+				   size_t size, void **p);
+
+
+static int refill_sheaf(struct kmem_cache *s, struct slab_sheaf *sheaf,
+			 gfp_t gfp)
+{
+	int to_fill = s->sheaf_capacity - sheaf->size;
+	int filled;
+
+	if (!to_fill)
 		return 0;
 
-	err = cache_random_seq_create(s, count, GFP_KERNEL);
-	if (err) {
-		pr_err("SLUB: Unable to initialize free list for %s\n",
-			s->name);
-		return err;
-	}
+	filled = __kmem_cache_alloc_bulk(s, gfp, to_fill,
+					 &sheaf->objects[sheaf->size]);
 
-	/* Transform to an offset on the set of pages */
-	if (s->random_seq) {
-		unsigned int i;
+	sheaf->size += filled;
+
+	stat_add(s, SHEAF_REFILL, filled);
+
+	if (filled < to_fill)
+		return -ENOMEM;
 
-		for (i = 0; i < count; i++)
-			s->random_seq[i] *= s->size;
-	}
 	return 0;
 }
 
-/* Initialize each random sequence freelist per cache */
-static void __init init_freelist_randomization(void)
+
+static struct slab_sheaf *alloc_full_sheaf(struct kmem_cache *s, gfp_t gfp)
 {
-	struct kmem_cache *s;
+	struct slab_sheaf *sheaf = alloc_empty_sheaf(s, gfp);
 
-	mutex_lock(&slab_mutex);
+	if (!sheaf)
+		return NULL;
 
-	list_for_each_entry(s, &slab_caches, list)
-		init_cache_random_seq(s);
+	if (refill_sheaf(s, sheaf, gfp)) {
+		free_empty_sheaf(s, sheaf);
+		return NULL;
+	}
 
-	mutex_unlock(&slab_mutex);
+	return sheaf;
 }
 
-/* Get the next entry on the pre-computed freelist randomized */
-static void *next_freelist_entry(struct kmem_cache *s,
-				unsigned long *pos, void *start,
-				unsigned long page_limit,
-				unsigned long freelist_count)
+/*
+ * Maximum number of objects freed during a single flush of main pcs sheaf.
+ * Translates directly to an on-stack array size.
+ */
+#define PCS_BATCH_MAX	32U
+
+static void __kmem_cache_free_bulk(struct kmem_cache *s, size_t size, void **p);
+
+/*
+ * Free all objects from the main sheaf. In order to perform
+ * __kmem_cache_free_bulk() outside of cpu_sheaves->lock, work in batches where
+ * object pointers are moved to a on-stack array under the lock. To bound the
+ * stack usage, limit each batch to PCS_BATCH_MAX.
+ *
+ * returns true if at least partially flushed
+ */
+static bool sheaf_flush_main(struct kmem_cache *s)
 {
-	unsigned int idx;
+	struct slub_percpu_sheaves *pcs;
+	unsigned int batch, remaining;
+	void *objects[PCS_BATCH_MAX];
+	struct slab_sheaf *sheaf;
+	bool ret = false;
 
-	/*
-	 * If the target page allocation failed, the number of objects on the
-	 * page might be smaller than the usual size defined by the cache.
-	 */
-	do {
-		idx = s->random_seq[*pos];
-		*pos += 1;
-		if (*pos >= freelist_count)
-			*pos = 0;
-	} while (unlikely(idx >= page_limit));
+next_batch:
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		return ret;
 
-	return (char *)start + idx;
-}
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+	sheaf = pcs->main;
 
-/* Shuffle the single linked freelist based on a random pre-computed sequence */
-static bool shuffle_freelist(struct kmem_cache *s, struct slab *slab)
-{
-	void *start;
-	void *cur;
-	void *next;
-	unsigned long idx, pos, page_limit, freelist_count;
+	batch = min(PCS_BATCH_MAX, sheaf->size);
 
-	if (slab->objects < 2 || !s->random_seq)
-		return false;
+	sheaf->size -= batch;
+	memcpy(objects, sheaf->objects + sheaf->size, batch * sizeof(void *));
 
-	freelist_count = oo_objects(s->oo);
-	pos = get_random_u32_below(freelist_count);
+	remaining = sheaf->size;
 
-	page_limit = slab->objects * s->size;
-	start = fixup_red_left(s, slab_address(slab));
+	local_unlock(&s->cpu_sheaves->lock);
 
-	/* First entry is used as the base of the freelist */
-	cur = next_freelist_entry(s, &pos, start, page_limit, freelist_count);
-	cur = setup_object(s, cur);
-	slab->freelist = cur;
+	__kmem_cache_free_bulk(s, batch, &objects[0]);
 
-	for (idx = 1; idx < slab->objects; idx++) {
-		next = next_freelist_entry(s, &pos, start, page_limit,
-			freelist_count);
-		next = setup_object(s, next);
-		set_freepointer(s, cur, next);
-		cur = next;
-	}
-	set_freepointer(s, cur, NULL);
+	stat_add(s, SHEAF_FLUSH, batch);
 
-	return true;
-}
-#else
-static inline int init_cache_random_seq(struct kmem_cache *s)
-{
-	return 0;
+	ret = true;
+
+	if (remaining)
+		goto next_batch;
+
+	return ret;
 }
-static inline void init_freelist_randomization(void) { }
-static inline bool shuffle_freelist(struct kmem_cache *s, struct slab *slab)
+
+/*
+ * Free all objects from a sheaf that's unused, i.e. not linked to any
+ * cpu_sheaves, so we need no locking and batching. The locking is also not
+ * necessary when flushing cpu's sheaves (both spare and main) during cpu
+ * hotremove as the cpu is not executing anymore.
+ */
+static void sheaf_flush_unused(struct kmem_cache *s, struct slab_sheaf *sheaf)
 {
-	return false;
+	if (!sheaf->size)
+		return;
+
+	stat_add(s, SHEAF_FLUSH, sheaf->size);
+
+	__kmem_cache_free_bulk(s, sheaf->size, &sheaf->objects[0]);
+
+	sheaf->size = 0;
 }
-#endif /* CONFIG_SLAB_FREELIST_RANDOM */
 
-static __always_inline void account_slab(struct slab *slab, int order,
-					 struct kmem_cache *s, gfp_t gfp)
+static void __rcu_free_sheaf_prepare(struct kmem_cache *s,
+				     struct slab_sheaf *sheaf)
 {
-	if (memcg_kmem_online() && (s->flags & SLAB_ACCOUNT))
-		alloc_slab_obj_exts(slab, s, gfp, true);
+	bool init = slab_want_init_on_free(s);
+	void **p = &sheaf->objects[0];
+	unsigned int i = 0;
 
-	mod_node_page_state(slab_pgdat(slab), cache_vmstat_idx(s),
-			    PAGE_SIZE << order);
+	while (i < sheaf->size) {
+		struct slab *slab = virt_to_slab(p[i]);
+
+		memcg_slab_free_hook(s, slab, p + i, 1);
+		alloc_tagging_slab_free_hook(s, slab, p + i, 1);
+
+		if (unlikely(!slab_free_hook(s, p[i], init, true))) {
+			p[i] = p[--sheaf->size];
+			continue;
+		}
+
+		i++;
+	}
 }
 
-static __always_inline void unaccount_slab(struct slab *slab, int order,
-					   struct kmem_cache *s)
+static void rcu_free_sheaf_nobarn(struct rcu_head *head)
 {
-	/*
-	 * The slab object extensions should now be freed regardless of
-	 * whether mem_alloc_profiling_enabled() or not because profiling
-	 * might have been disabled after slab->obj_exts got allocated.
-	 */
-	free_slab_obj_exts(slab);
+	struct slab_sheaf *sheaf;
+	struct kmem_cache *s;
 
-	mod_node_page_state(slab_pgdat(slab), cache_vmstat_idx(s),
-			    -(PAGE_SIZE << order));
+	sheaf = container_of(head, struct slab_sheaf, rcu_head);
+	s = sheaf->cache;
+
+	__rcu_free_sheaf_prepare(s, sheaf);
+
+	sheaf_flush_unused(s, sheaf);
+
+	free_empty_sheaf(s, sheaf);
 }
 
-static struct slab *allocate_slab(struct kmem_cache *s, gfp_t flags, int node)
+/*
+ * Caller needs to make sure migration is disabled in order to fully flush
+ * single cpu's sheaves
+ *
+ * must not be called from an irq
+ *
+ * flushing operations are rare so let's keep it simple and flush to slabs
+ * directly, skipping the barn
+ */
+static void pcs_flush_all(struct kmem_cache *s)
 {
-	struct slab *slab;
-	struct kmem_cache_order_objects oo = s->oo;
-	gfp_t alloc_gfp;
-	void *start, *p, *next;
-	int idx;
-	bool shuffle;
+	struct slub_percpu_sheaves *pcs;
+	struct slab_sheaf *spare, *rcu_free;
 
-	flags &= gfp_allowed_mask;
+	local_lock(&s->cpu_sheaves->lock);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
 
-	flags |= s->allocflags;
+	spare = pcs->spare;
+	pcs->spare = NULL;
 
-	/*
-	 * Let the initial higher-order allocation fail under memory pressure
-	 * so we fall-back to the minimum order allocation.
-	 */
-	alloc_gfp = (flags | __GFP_NOWARN | __GFP_NORETRY) & ~__GFP_NOFAIL;
-	if ((alloc_gfp & __GFP_DIRECT_RECLAIM) && oo_order(oo) > oo_order(s->min))
-		alloc_gfp = (alloc_gfp | __GFP_NOMEMALLOC) & ~__GFP_RECLAIM;
+	rcu_free = pcs->rcu_free;
+	pcs->rcu_free = NULL;
 
-	slab = alloc_slab_page(alloc_gfp, node, oo);
-	if (unlikely(!slab)) {
-		oo = s->min;
-		alloc_gfp = flags;
-		/*
-		 * Allocation may have failed due to fragmentation.
-		 * Try a lower order alloc if possible
-		 */
-		slab = alloc_slab_page(alloc_gfp, node, oo);
-		if (unlikely(!slab))
-			return NULL;
-		stat(s, ORDER_FALLBACK);
-	}
+	local_unlock(&s->cpu_sheaves->lock);
 
-	slab->objects = oo_objects(oo);
-	slab->inuse = 0;
-	slab->frozen = 0;
-	init_slab_obj_exts(slab);
+	if (spare) {
+		sheaf_flush_unused(s, spare);
+		free_empty_sheaf(s, spare);
+	}
 
-	account_slab(slab, oo_order(oo), s, flags);
+	if (rcu_free)
+		call_rcu(&rcu_free->rcu_head, rcu_free_sheaf_nobarn);
 
-	slab->slab_cache = s;
+	sheaf_flush_main(s);
+}
 
-	kasan_poison_slab(slab);
+static void __pcs_flush_all_cpu(struct kmem_cache *s, unsigned int cpu)
+{
+	struct slub_percpu_sheaves *pcs;
 
-	start = slab_address(slab);
+	pcs = per_cpu_ptr(s->cpu_sheaves, cpu);
 
-	setup_slab_debug(s, slab, start);
+	/* The cpu is not executing anymore so we don't need pcs->lock */
+	sheaf_flush_unused(s, pcs->main);
+	if (pcs->spare) {
+		sheaf_flush_unused(s, pcs->spare);
+		free_empty_sheaf(s, pcs->spare);
+		pcs->spare = NULL;
+	}
 
-	shuffle = shuffle_freelist(s, slab);
-
-	if (!shuffle) {
-		start = fixup_red_left(s, start);
-		start = setup_object(s, start);
-		slab->freelist = start;
-		for (idx = 0, p = start; idx < slab->objects - 1; idx++) {
-			next = p + s->size;
-			next = setup_object(s, next);
-			set_freepointer(s, p, next);
-			p = next;
-		}
-		set_freepointer(s, p, NULL);
+	if (pcs->rcu_free) {
+		call_rcu(&pcs->rcu_free->rcu_head, rcu_free_sheaf_nobarn);
+		pcs->rcu_free = NULL;
 	}
-
-	return slab;
 }
 
-static struct slab *new_slab(struct kmem_cache *s, gfp_t flags, int node)
+static void pcs_destroy(struct kmem_cache *s)
 {
-	if (unlikely(flags & GFP_SLAB_BUG_MASK))
-		flags = kmalloc_fix_flags(flags);
-
-	WARN_ON_ONCE(s->ctor && (flags & __GFP_ZERO));
-
-	return allocate_slab(s,
-		flags & (GFP_RECLAIM_MASK | GFP_CONSTRAINT_MASK), node);
-}
+	int cpu;
 
-static void __free_slab(struct kmem_cache *s, struct slab *slab)
-{
-	struct folio *folio = slab_folio(slab);
-	int order = folio_order(folio);
-	int pages = 1 << order;
+	for_each_possible_cpu(cpu) {
+		struct slub_percpu_sheaves *pcs;
 
-	__slab_clear_pfmemalloc(slab);
-	folio->mapping = NULL;
-	__folio_clear_slab(folio);
-	mm_account_reclaimed_pages(pages);
-	unaccount_slab(slab, order, s);
-	free_frozen_pages(&folio->page, order);
-}
+		pcs = per_cpu_ptr(s->cpu_sheaves, cpu);
 
-static void rcu_free_slab(struct rcu_head *h)
-{
-	struct slab *slab = container_of(h, struct slab, rcu_head);
+		/* can happen when unwinding failed create */
+		if (!pcs->main)
+			continue;
 
-	__free_slab(slab->slab_cache, slab);
-}
+		/*
+		 * We have already passed __kmem_cache_shutdown() so everything
+		 * was flushed and there should be no objects allocated from
+		 * slabs, otherwise kmem_cache_destroy() would have aborted.
+		 * Therefore something would have to be really wrong if the
+		 * warnings here trigger, and we should rather leave objects and
+		 * sheaves to leak in that case.
+		 */
 
-static void free_slab(struct kmem_cache *s, struct slab *slab)
-{
-	if (kmem_cache_debug_flags(s, SLAB_CONSISTENCY_CHECKS)) {
-		void *p;
+		WARN_ON(pcs->spare);
+		WARN_ON(pcs->rcu_free);
 
-		slab_pad_check(s, slab);
-		for_each_object(p, s, slab_address(slab), slab->objects)
-			check_object(s, slab, p, SLUB_RED_INACTIVE);
+		if (!WARN_ON(pcs->main->size)) {
+			free_empty_sheaf(s, pcs->main);
+			pcs->main = NULL;
+		}
 	}
 
-	if (unlikely(s->flags & SLAB_TYPESAFE_BY_RCU))
-		call_rcu(&slab->rcu_head, rcu_free_slab);
-	else
-		__free_slab(s, slab);
+	free_percpu(s->cpu_sheaves);
+	s->cpu_sheaves = NULL;
 }
 
-static void discard_slab(struct kmem_cache *s, struct slab *slab)
+static struct slab_sheaf *barn_get_empty_sheaf(struct node_barn *barn)
 {
-	dec_slabs_node(s, slab_nid(slab), slab->objects);
-	free_slab(s, slab);
-}
+	struct slab_sheaf *empty = NULL;
+	unsigned long flags;
 
-static inline bool slab_test_node_partial(const struct slab *slab)
-{
-	return test_bit(SL_partial, &slab->flags.f);
-}
+	if (!data_race(barn->nr_empty))
+		return NULL;
 
-static inline void slab_set_node_partial(struct slab *slab)
-{
-	set_bit(SL_partial, &slab->flags.f);
-}
+	spin_lock_irqsave(&barn->lock, flags);
 
-static inline void slab_clear_node_partial(struct slab *slab)
-{
-	clear_bit(SL_partial, &slab->flags.f);
+	if (likely(barn->nr_empty)) {
+		empty = list_first_entry(&barn->sheaves_empty,
+					 struct slab_sheaf, barn_list);
+		list_del(&empty->barn_list);
+		barn->nr_empty--;
+	}
+
+	spin_unlock_irqrestore(&barn->lock, flags);
+
+	return empty;
 }
 
 /*
- * Management of partially allocated slabs.
+ * The following two functions are used mainly in cases where we have to undo an
+ * intended action due to a race or cpu migration. Thus they do not check the
+ * empty or full sheaf limits for simplicity.
  */
-static inline void
-__add_partial(struct kmem_cache_node *n, struct slab *slab, int tail)
-{
-	n->nr_partial++;
-	if (tail == DEACTIVATE_TO_TAIL)
-		list_add_tail(&slab->slab_list, &n->partial);
-	else
-		list_add(&slab->slab_list, &n->partial);
-	slab_set_node_partial(slab);
-}
 
-static inline void add_partial(struct kmem_cache_node *n,
-				struct slab *slab, int tail)
+static void barn_put_empty_sheaf(struct node_barn *barn, struct slab_sheaf *sheaf)
 {
-	lockdep_assert_held(&n->list_lock);
-	__add_partial(n, slab, tail);
+	unsigned long flags;
+
+	spin_lock_irqsave(&barn->lock, flags);
+
+	list_add(&sheaf->barn_list, &barn->sheaves_empty);
+	barn->nr_empty++;
+
+	spin_unlock_irqrestore(&barn->lock, flags);
 }
 
-static inline void remove_partial(struct kmem_cache_node *n,
-					struct slab *slab)
+static void barn_put_full_sheaf(struct node_barn *barn, struct slab_sheaf *sheaf)
 {
-	lockdep_assert_held(&n->list_lock);
-	list_del(&slab->slab_list);
-	slab_clear_node_partial(slab);
-	n->nr_partial--;
+	unsigned long flags;
+
+	spin_lock_irqsave(&barn->lock, flags);
+
+	list_add(&sheaf->barn_list, &barn->sheaves_full);
+	barn->nr_full++;
+
+	spin_unlock_irqrestore(&barn->lock, flags);
 }
 
-/*
- * Called only for kmem_cache_debug() caches instead of remove_partial(), with a
- * slab from the n->partial list. Remove only a single object from the slab, do
- * the alloc_debug_processing() checks and leave the slab on the list, or move
- * it to full list if it was the last free object.
- */
-static void *alloc_single_from_partial(struct kmem_cache *s,
-		struct kmem_cache_node *n, struct slab *slab, int orig_size)
+static struct slab_sheaf *barn_get_full_or_empty_sheaf(struct node_barn *barn)
 {
-	void *object;
+	struct slab_sheaf *sheaf = NULL;
+	unsigned long flags;
 
-	lockdep_assert_held(&n->list_lock);
+	if (!data_race(barn->nr_full) && !data_race(barn->nr_empty))
+		return NULL;
 
-	object = slab->freelist;
-	slab->freelist = get_freepointer(s, object);
-	slab->inuse++;
+	spin_lock_irqsave(&barn->lock, flags);
 
-	if (!alloc_debug_processing(s, slab, object, orig_size)) {
-		if (folio_test_slab(slab_folio(slab)))
-			remove_partial(n, slab);
-		return NULL;
+	if (barn->nr_full) {
+		sheaf = list_first_entry(&barn->sheaves_full, struct slab_sheaf,
+					barn_list);
+		list_del(&sheaf->barn_list);
+		barn->nr_full--;
+	} else if (barn->nr_empty) {
+		sheaf = list_first_entry(&barn->sheaves_empty,
+					 struct slab_sheaf, barn_list);
+		list_del(&sheaf->barn_list);
+		barn->nr_empty--;
 	}
 
-	if (slab->inuse == slab->objects) {
-		remove_partial(n, slab);
-		add_full(s, n, slab);
-	}
+	spin_unlock_irqrestore(&barn->lock, flags);
 
-	return object;
+	return sheaf;
 }
 
 /*
- * Called only for kmem_cache_debug() caches to allocate from a freshly
- * allocated slab. Allocate a single object instead of whole freelist
- * and put the slab to the partial (or full) list.
+ * If a full sheaf is available, return it and put the supplied empty one to
+ * barn. We ignore the limit on empty sheaves as the number of sheaves doesn't
+ * change.
  */
-static void *alloc_single_from_new_slab(struct kmem_cache *s,
-					struct slab *slab, int orig_size)
+static struct slab_sheaf *
+barn_replace_empty_sheaf(struct node_barn *barn, struct slab_sheaf *empty)
 {
-	int nid = slab_nid(slab);
-	struct kmem_cache_node *n = get_node(s, nid);
+	struct slab_sheaf *full = NULL;
 	unsigned long flags;
-	void *object;
 
-
-	object = slab->freelist;
-	slab->freelist = get_freepointer(s, object);
-	slab->inuse = 1;
-
-	if (!alloc_debug_processing(s, slab, object, orig_size))
-		/*
-		 * It's not really expected that this would fail on a
-		 * freshly allocated slab, but a concurrent memory
-		 * corruption in theory could cause that.
-		 */
+	if (!data_race(barn->nr_full))
 		return NULL;
 
-	spin_lock_irqsave(&n->list_lock, flags);
+	spin_lock_irqsave(&barn->lock, flags);
 
-	if (slab->inuse == slab->objects)
-		add_full(s, n, slab);
-	else
-		add_partial(n, slab, DEACTIVATE_TO_HEAD);
+	if (likely(barn->nr_full)) {
+		full = list_first_entry(&barn->sheaves_full, struct slab_sheaf,
+					barn_list);
+		list_del(&full->barn_list);
+		list_add(&empty->barn_list, &barn->sheaves_empty);
+		barn->nr_full--;
+		barn->nr_empty++;
+	}
 
-	inc_slabs_node(s, nid, slab->objects);
-	spin_unlock_irqrestore(&n->list_lock, flags);
+	spin_unlock_irqrestore(&barn->lock, flags);
 
-	return object;
+	return full;
 }
 
-#ifdef CONFIG_SLUB_CPU_PARTIAL
-static void put_cpu_partial(struct kmem_cache *s, struct slab *slab, int drain);
-#else
-static inline void put_cpu_partial(struct kmem_cache *s, struct slab *slab,
-				   int drain) { }
-#endif
-static inline bool pfmemalloc_match(struct slab *slab, gfp_t gfpflags);
-
 /*
- * Try to allocate a partial slab from a specific node.
+ * If an empty sheaf is available, return it and put the supplied full one to
+ * barn. But if there are too many full sheaves, reject this with -E2BIG.
  */
-static struct slab *get_partial_node(struct kmem_cache *s,
-				     struct kmem_cache_node *n,
-				     struct partial_context *pc)
+static struct slab_sheaf *
+barn_replace_full_sheaf(struct node_barn *barn, struct slab_sheaf *full)
 {
-	struct slab *slab, *slab2, *partial = NULL;
+	struct slab_sheaf *empty;
 	unsigned long flags;
-	unsigned int partial_slabs = 0;
 
-	/*
-	 * Racy check. If we mistakenly see no partial slabs then we
-	 * just allocate an empty slab. If we mistakenly try to get a
-	 * partial slab and there is none available then get_partial()
-	 * will return NULL.
-	 */
-	if (!n || !n->nr_partial)
-		return NULL;
+	/* we don't repeat this check under barn->lock as it's not critical */
+	if (data_race(barn->nr_full) >= MAX_FULL_SHEAVES)
+		return ERR_PTR(-E2BIG);
+	if (!data_race(barn->nr_empty))
+		return ERR_PTR(-ENOMEM);
 
-	spin_lock_irqsave(&n->list_lock, flags);
-	list_for_each_entry_safe(slab, slab2, &n->partial, slab_list) {
-		if (!pfmemalloc_match(slab, pc->flags))
-			continue;
+	spin_lock_irqsave(&barn->lock, flags);
 
-		if (IS_ENABLED(CONFIG_SLUB_TINY) || kmem_cache_debug(s)) {
-			void *object = alloc_single_from_partial(s, n, slab,
-							pc->orig_size);
-			if (object) {
-				partial = slab;
-				pc->object = object;
-				break;
-			}
-			continue;
-		}
+	if (likely(barn->nr_empty)) {
+		empty = list_first_entry(&barn->sheaves_empty, struct slab_sheaf,
+					 barn_list);
+		list_del(&empty->barn_list);
+		list_add(&full->barn_list, &barn->sheaves_full);
+		barn->nr_empty--;
+		barn->nr_full++;
+	} else {
+		empty = ERR_PTR(-ENOMEM);
+	}
 
-		remove_partial(n, slab);
+	spin_unlock_irqrestore(&barn->lock, flags);
 
-		if (!partial) {
-			partial = slab;
-			stat(s, ALLOC_FROM_PARTIAL);
+	return empty;
+}
 
-			if ((slub_get_cpu_partial(s) == 0)) {
-				break;
-			}
-		} else {
-			put_cpu_partial(s, slab, 0);
-			stat(s, CPU_PARTIAL_NODE);
+static void barn_init(struct node_barn *barn)
+{
+	spin_lock_init(&barn->lock);
+	INIT_LIST_HEAD(&barn->sheaves_full);
+	INIT_LIST_HEAD(&barn->sheaves_empty);
+	barn->nr_full = 0;
+	barn->nr_empty = 0;
+}
 
-			if (++partial_slabs > slub_get_cpu_partial(s) / 2) {
-				break;
-			}
-		}
+static void barn_shrink(struct kmem_cache *s, struct node_barn *barn)
+{
+	struct list_head empty_list;
+	struct list_head full_list;
+	struct slab_sheaf *sheaf, *sheaf2;
+	unsigned long flags;
+
+	INIT_LIST_HEAD(&empty_list);
+	INIT_LIST_HEAD(&full_list);
+
+	spin_lock_irqsave(&barn->lock, flags);
+
+	list_splice_init(&barn->sheaves_full, &full_list);
+	barn->nr_full = 0;
+	list_splice_init(&barn->sheaves_empty, &empty_list);
+	barn->nr_empty = 0;
+
+	spin_unlock_irqrestore(&barn->lock, flags);
+
+	list_for_each_entry_safe(sheaf, sheaf2, &full_list, barn_list) {
+		sheaf_flush_unused(s, sheaf);
+		free_empty_sheaf(s, sheaf);
 	}
-	spin_unlock_irqrestore(&n->list_lock, flags);
-	return partial;
+
+	list_for_each_entry_safe(sheaf, sheaf2, &empty_list, barn_list)
+		free_empty_sheaf(s, sheaf);
 }
 
 /*
- * Get a slab from somewhere. Search in increasing NUMA distances.
+ * Slab allocation and freeing
  */
-static struct slab *get_any_partial(struct kmem_cache *s,
-				    struct partial_context *pc)
+static inline struct slab *alloc_slab_page(gfp_t flags, int node,
+					   struct kmem_cache_order_objects oo,
+					   bool allow_spin)
 {
-#ifdef CONFIG_NUMA
-	struct zonelist *zonelist;
-	struct zoneref *z;
-	struct zone *zone;
-	enum zone_type highest_zoneidx = gfp_zone(pc->flags);
+	struct folio *folio;
 	struct slab *slab;
-	unsigned int cpuset_mems_cookie;
-
-	/*
-	 * The defrag ratio allows a configuration of the tradeoffs between
-	 * inter node defragmentation and node local allocations. A lower
-	 * defrag_ratio increases the tendency to do local allocations
-	 * instead of attempting to obtain partial slabs from other nodes.
-	 *
-	 * If the defrag_ratio is set to 0 then kmalloc() always
-	 * returns node local objects. If the ratio is higher then kmalloc()
-	 * may return off node objects because partial slabs are obtained
-	 * from other nodes and filled up.
-	 *
-	 * If /sys/kernel/slab/xx/remote_node_defrag_ratio is set to 100
-	 * (which makes defrag_ratio = 1000) then every (well almost)
-	 * allocation will first attempt to defrag slab caches on other nodes.
-	 * This means scanning over all nodes to look for partial slabs which
-	 * may be expensive if we do it every time we are trying to find a slab
-	 * with available objects.
-	 */
-	if (!s->remote_node_defrag_ratio ||
-			get_cycles() % 1024 > s->remote_node_defrag_ratio)
-		return NULL;
+	unsigned int order = oo_order(oo);
 
-	do {
-		cpuset_mems_cookie = read_mems_allowed_begin();
-		zonelist = node_zonelist(mempolicy_slab_node(), pc->flags);
-		for_each_zone_zonelist(zone, z, zonelist, highest_zoneidx) {
-			struct kmem_cache_node *n;
+	if (unlikely(!allow_spin))
+		folio = (struct folio *)alloc_frozen_pages_nolock(0/* __GFP_COMP is implied */,
+								  node, order);
+	else if (node == NUMA_NO_NODE)
+		folio = (struct folio *)alloc_frozen_pages(flags, order);
+	else
+		folio = (struct folio *)__alloc_frozen_pages(flags, order, node, NULL);
 
-			n = get_node(s, zone_to_nid(zone));
+	if (!folio)
+		return NULL;
 
-			if (n && cpuset_zone_allowed(zone, pc->flags) &&
-					n->nr_partial > s->min_partial) {
-				slab = get_partial_node(s, n, pc);
-				if (slab) {
-					/*
-					 * Don't check read_mems_allowed_retry()
-					 * here - if mems_allowed was updated in
-					 * parallel, that was a harmless race
-					 * between allocation and the cpuset
-					 * update
-					 */
-					return slab;
-				}
-			}
-		}
-	} while (read_mems_allowed_retry(cpuset_mems_cookie));
-#endif	/* CONFIG_NUMA */
-	return NULL;
+	slab = folio_slab(folio);
+	__folio_set_slab(folio);
+	if (folio_is_pfmemalloc(folio))
+		slab_set_pfmemalloc(slab);
+
+	return slab;
 }
 
-/*
- * Get a partial slab, lock it and return it.
- */
-static struct slab *get_partial(struct kmem_cache *s, int node,
-				struct partial_context *pc)
+#ifdef CONFIG_SLAB_FREELIST_RANDOM
+/* Pre-initialize the random sequence cache */
+static int init_cache_random_seq(struct kmem_cache *s)
 {
-	struct slab *slab;
-	int searchnode = node;
+	unsigned int count = oo_objects(s->oo);
+	int err;
 
-	if (node == NUMA_NO_NODE)
-		searchnode = numa_mem_id();
+	/* Bailout if already initialised */
+	if (s->random_seq)
+		return 0;
 
-	slab = get_partial_node(s, get_node(s, searchnode), pc);
-	if (slab || (node != NUMA_NO_NODE && (pc->flags & __GFP_THISNODE)))
-		return slab;
+	err = cache_random_seq_create(s, count, GFP_KERNEL);
+	if (err) {
+		pr_err("SLUB: Unable to initialize free list for %s\n",
+			s->name);
+		return err;
+	}
 
-	return get_any_partial(s, pc);
+	/* Transform to an offset on the set of pages */
+	if (s->random_seq) {
+		unsigned int i;
+
+		for (i = 0; i < count; i++)
+			s->random_seq[i] *= s->size;
+	}
+	return 0;
 }
 
-#ifndef CONFIG_SLUB_TINY
+/* Initialize each random sequence freelist per cache */
+static void __init init_freelist_randomization(void)
+{
+	struct kmem_cache *s;
 
-#ifdef CONFIG_PREEMPTION
-/*
- * Calculate the next globally unique transaction for disambiguation
- * during cmpxchg. The transactions start with the cpu number and are then
- * incremented by CONFIG_NR_CPUS.
- */
-#define TID_STEP  roundup_pow_of_two(CONFIG_NR_CPUS)
-#else
-/*
- * No preemption supported therefore also no need to check for
- * different cpus.
- */
-#define TID_STEP 1
-#endif /* CONFIG_PREEMPTION */
+	mutex_lock(&slab_mutex);
 
-static inline unsigned long next_tid(unsigned long tid)
-{
-	return tid + TID_STEP;
-}
+	list_for_each_entry(s, &slab_caches, list)
+		init_cache_random_seq(s);
 
-#ifdef SLUB_DEBUG_CMPXCHG
-static inline unsigned int tid_to_cpu(unsigned long tid)
-{
-	return tid % TID_STEP;
+	mutex_unlock(&slab_mutex);
 }
 
-static inline unsigned long tid_to_event(unsigned long tid)
+/* Get the next entry on the pre-computed freelist randomized */
+static void *next_freelist_entry(struct kmem_cache *s,
+				unsigned long *pos, void *start,
+				unsigned long page_limit,
+				unsigned long freelist_count)
 {
-	return tid / TID_STEP;
-}
-#endif
+	unsigned int idx;
 
-static inline unsigned int init_tid(int cpu)
-{
-	return cpu;
+	/*
+	 * If the target page allocation failed, the number of objects on the
+	 * page might be smaller than the usual size defined by the cache.
+	 */
+	do {
+		idx = s->random_seq[*pos];
+		*pos += 1;
+		if (*pos >= freelist_count)
+			*pos = 0;
+	} while (unlikely(idx >= page_limit));
+
+	return (char *)start + idx;
 }
 
-static inline void note_cmpxchg_failure(const char *n,
-		const struct kmem_cache *s, unsigned long tid)
+/* Shuffle the single linked freelist based on a random pre-computed sequence */
+static bool shuffle_freelist(struct kmem_cache *s, struct slab *slab)
 {
-#ifdef SLUB_DEBUG_CMPXCHG
-	unsigned long actual_tid = __this_cpu_read(s->cpu_slab->tid);
+	void *start;
+	void *cur;
+	void *next;
+	unsigned long idx, pos, page_limit, freelist_count;
 
-	pr_info("%s %s: cmpxchg redo ", n, s->name);
+	if (slab->objects < 2 || !s->random_seq)
+		return false;
 
-#ifdef CONFIG_PREEMPTION
-	if (tid_to_cpu(tid) != tid_to_cpu(actual_tid))
-		pr_warn("due to cpu change %d -> %d\n",
-			tid_to_cpu(tid), tid_to_cpu(actual_tid));
-	else
-#endif
-	if (tid_to_event(tid) != tid_to_event(actual_tid))
-		pr_warn("due to cpu running other code. Event %ld->%ld\n",
-			tid_to_event(tid), tid_to_event(actual_tid));
-	else
-		pr_warn("for unknown reason: actual=%lx was=%lx target=%lx\n",
-			actual_tid, tid, next_tid(tid));
-#endif
-	stat(s, CMPXCHG_DOUBLE_CPU_FAIL);
-}
+	freelist_count = oo_objects(s->oo);
+	pos = get_random_u32_below(freelist_count);
 
-static void init_kmem_cache_cpus(struct kmem_cache *s)
-{
-	int cpu;
-	struct kmem_cache_cpu *c;
+	page_limit = slab->objects * s->size;
+	start = fixup_red_left(s, slab_address(slab));
 
-	for_each_possible_cpu(cpu) {
-		c = per_cpu_ptr(s->cpu_slab, cpu);
-		local_lock_init(&c->lock);
-		c->tid = init_tid(cpu);
+	/* First entry is used as the base of the freelist */
+	cur = next_freelist_entry(s, &pos, start, page_limit, freelist_count);
+	cur = setup_object(s, cur);
+	slab->freelist = cur;
+
+	for (idx = 1; idx < slab->objects; idx++) {
+		next = next_freelist_entry(s, &pos, start, page_limit,
+			freelist_count);
+		next = setup_object(s, next);
+		set_freepointer(s, cur, next);
+		cur = next;
 	}
+	set_freepointer(s, cur, NULL);
+
+	return true;
+}
+#else
+static inline int init_cache_random_seq(struct kmem_cache *s)
+{
+	return 0;
+}
+static inline void init_freelist_randomization(void) { }
+static inline bool shuffle_freelist(struct kmem_cache *s, struct slab *slab)
+{
+	return false;
 }
+#endif /* CONFIG_SLAB_FREELIST_RANDOM */
 
-/*
- * Finishes removing the cpu slab. Merges cpu's freelist with slab's freelist,
- * unfreezes the slabs and puts it on the proper list.
- * Assumes the slab has been already safely taken away from kmem_cache_cpu
- * by the caller.
- */
-static void deactivate_slab(struct kmem_cache *s, struct slab *slab,
-			    void *freelist)
+static __always_inline void account_slab(struct slab *slab, int order,
+					 struct kmem_cache *s, gfp_t gfp)
 {
-	struct kmem_cache_node *n = get_node(s, slab_nid(slab));
-	int free_delta = 0;
-	void *nextfree, *freelist_iter, *freelist_tail;
-	int tail = DEACTIVATE_TO_HEAD;
-	unsigned long flags = 0;
-	struct slab new;
-	struct slab old;
+	if (memcg_kmem_online() && (s->flags & SLAB_ACCOUNT))
+		alloc_slab_obj_exts(slab, s, gfp, true);
 
-	if (READ_ONCE(slab->freelist)) {
-		stat(s, DEACTIVATE_REMOTE_FREES);
-		tail = DEACTIVATE_TO_TAIL;
-	}
+	mod_node_page_state(slab_pgdat(slab), cache_vmstat_idx(s),
+			    PAGE_SIZE << order);
+}
 
+static __always_inline void unaccount_slab(struct slab *slab, int order,
+					   struct kmem_cache *s)
+{
 	/*
-	 * Stage one: Count the objects on cpu's freelist as free_delta and
-	 * remember the last object in freelist_tail for later splicing.
+	 * The slab object extensions should now be freed regardless of
+	 * whether mem_alloc_profiling_enabled() or not because profiling
+	 * might have been disabled after slab->obj_exts got allocated.
 	 */
-	freelist_tail = NULL;
-	freelist_iter = freelist;
-	while (freelist_iter) {
-		nextfree = get_freepointer(s, freelist_iter);
+	free_slab_obj_exts(slab);
 
-		/*
-		 * If 'nextfree' is invalid, it is possible that the object at
-		 * 'freelist_iter' is already corrupted.  So isolate all objects
-		 * starting at 'freelist_iter' by skipping them.
-		 */
-		if (freelist_corrupted(s, slab, &freelist_iter, nextfree))
-			break;
+	mod_node_page_state(slab_pgdat(slab), cache_vmstat_idx(s),
+			    -(PAGE_SIZE << order));
+}
 
-		freelist_tail = freelist_iter;
-		free_delta++;
+static struct slab *allocate_slab(struct kmem_cache *s, gfp_t flags, int node)
+{
+	bool allow_spin = gfpflags_allow_spinning(flags);
+	struct slab *slab;
+	struct kmem_cache_order_objects oo = s->oo;
+	gfp_t alloc_gfp;
+	void *start, *p, *next;
+	int idx;
+	bool shuffle;
 
-		freelist_iter = nextfree;
-	}
+	flags &= gfp_allowed_mask;
+
+	flags |= s->allocflags;
 
 	/*
-	 * Stage two: Unfreeze the slab while splicing the per-cpu
-	 * freelist to the head of slab's freelist.
+	 * Let the initial higher-order allocation fail under memory pressure
+	 * so we fall-back to the minimum order allocation.
 	 */
-	do {
-		old.freelist = READ_ONCE(slab->freelist);
-		old.counters = READ_ONCE(slab->counters);
-		VM_BUG_ON(!old.frozen);
-
-		/* Determine target state of the slab */
-		new.counters = old.counters;
-		new.frozen = 0;
-		if (freelist_tail) {
-			new.inuse -= free_delta;
-			set_freepointer(s, freelist_tail, old.freelist);
-			new.freelist = freelist;
-		} else {
-			new.freelist = old.freelist;
-		}
-	} while (!slab_update_freelist(s, slab,
-		old.freelist, old.counters,
-		new.freelist, new.counters,
-		"unfreezing slab"));
+	alloc_gfp = (flags | __GFP_NOWARN | __GFP_NORETRY) & ~__GFP_NOFAIL;
+	if ((alloc_gfp & __GFP_DIRECT_RECLAIM) && oo_order(oo) > oo_order(s->min))
+		alloc_gfp = (alloc_gfp | __GFP_NOMEMALLOC) & ~__GFP_RECLAIM;
 
 	/*
-	 * Stage three: Manipulate the slab list based on the updated state.
+	 * __GFP_RECLAIM could be cleared on the first allocation attempt,
+	 * so pass allow_spin flag directly.
 	 */
-	if (!new.inuse && n->nr_partial >= s->min_partial) {
-		stat(s, DEACTIVATE_EMPTY);
-		discard_slab(s, slab);
-		stat(s, FREE_SLAB);
-	} else if (new.freelist) {
-		spin_lock_irqsave(&n->list_lock, flags);
-		add_partial(n, slab, tail);
-		spin_unlock_irqrestore(&n->list_lock, flags);
-		stat(s, tail);
-	} else {
-		stat(s, DEACTIVATE_FULL);
+	slab = alloc_slab_page(alloc_gfp, node, oo, allow_spin);
+	if (unlikely(!slab)) {
+		oo = s->min;
+		alloc_gfp = flags;
+		/*
+		 * Allocation may have failed due to fragmentation.
+		 * Try a lower order alloc if possible
+		 */
+		slab = alloc_slab_page(alloc_gfp, node, oo, allow_spin);
+		if (unlikely(!slab))
+			return NULL;
+		stat(s, ORDER_FALLBACK);
 	}
-}
 
-#ifdef CONFIG_SLUB_CPU_PARTIAL
-static void __put_partials(struct kmem_cache *s, struct slab *partial_slab)
-{
-	struct kmem_cache_node *n = NULL, *n2 = NULL;
-	struct slab *slab, *slab_to_discard = NULL;
-	unsigned long flags = 0;
+	slab->objects = oo_objects(oo);
+	slab->inuse = 0;
+	slab->frozen = 0;
+	init_slab_obj_exts(slab);
 
-	while (partial_slab) {
-		slab = partial_slab;
-		partial_slab = slab->next;
+	account_slab(slab, oo_order(oo), s, flags);
 
-		n2 = get_node(s, slab_nid(slab));
-		if (n != n2) {
-			if (n)
-				spin_unlock_irqrestore(&n->list_lock, flags);
+	slab->slab_cache = s;
 
-			n = n2;
-			spin_lock_irqsave(&n->list_lock, flags);
-		}
+	kasan_poison_slab(slab);
 
-		if (unlikely(!slab->inuse && n->nr_partial >= s->min_partial)) {
-			slab->next = slab_to_discard;
-			slab_to_discard = slab;
-		} else {
-			add_partial(n, slab, DEACTIVATE_TO_TAIL);
-			stat(s, FREE_ADD_PARTIAL);
-		}
-	}
+	start = slab_address(slab);
 
-	if (n)
-		spin_unlock_irqrestore(&n->list_lock, flags);
+	setup_slab_debug(s, slab, start);
 
-	while (slab_to_discard) {
-		slab = slab_to_discard;
-		slab_to_discard = slab_to_discard->next;
+	shuffle = shuffle_freelist(s, slab);
 
-		stat(s, DEACTIVATE_EMPTY);
-		discard_slab(s, slab);
-		stat(s, FREE_SLAB);
+	if (!shuffle) {
+		start = fixup_red_left(s, start);
+		start = setup_object(s, start);
+		slab->freelist = start;
+		for (idx = 0, p = start; idx < slab->objects - 1; idx++) {
+			next = p + s->size;
+			next = setup_object(s, next);
+			set_freepointer(s, p, next);
+			p = next;
+		}
+		set_freepointer(s, p, NULL);
 	}
+
+	return slab;
 }
 
-/*
- * Put all the cpu partial slabs to the node partial list.
- */
-static void put_partials(struct kmem_cache *s)
+static struct slab *new_slab(struct kmem_cache *s, gfp_t flags, int node)
 {
-	struct slab *partial_slab;
-	unsigned long flags;
+	if (unlikely(flags & GFP_SLAB_BUG_MASK))
+		flags = kmalloc_fix_flags(flags);
 
-	local_lock_irqsave(&s->cpu_slab->lock, flags);
-	partial_slab = this_cpu_read(s->cpu_slab->partial);
-	this_cpu_write(s->cpu_slab->partial, NULL);
-	local_unlock_irqrestore(&s->cpu_slab->lock, flags);
+	WARN_ON_ONCE(s->ctor && (flags & __GFP_ZERO));
 
-	if (partial_slab)
-		__put_partials(s, partial_slab);
+	return allocate_slab(s,
+		flags & (GFP_RECLAIM_MASK | GFP_CONSTRAINT_MASK), node);
 }
 
-static void put_partials_cpu(struct kmem_cache *s,
-			     struct kmem_cache_cpu *c)
+static void __free_slab(struct kmem_cache *s, struct slab *slab)
 {
-	struct slab *partial_slab;
-
-	partial_slab = slub_percpu_partial(c);
-	c->partial = NULL;
+	struct folio *folio = slab_folio(slab);
+	int order = folio_order(folio);
+	int pages = 1 << order;
 
-	if (partial_slab)
-		__put_partials(s, partial_slab);
+	__slab_clear_pfmemalloc(slab);
+	folio->mapping = NULL;
+	__folio_clear_slab(folio);
+	mm_account_reclaimed_pages(pages);
+	unaccount_slab(slab, order, s);
+	free_frozen_pages(&folio->page, order);
 }
 
-/*
- * Put a slab into a partial slab slot if available.
- *
- * If we did not find a slot then simply move all the partials to the
- * per node partial list.
- */
-static void put_cpu_partial(struct kmem_cache *s, struct slab *slab, int drain)
+static void rcu_free_slab(struct rcu_head *h)
 {
-	struct slab *oldslab;
-	struct slab *slab_to_put = NULL;
-	unsigned long flags;
-	int slabs = 0;
+	struct slab *slab = container_of(h, struct slab, rcu_head);
 
-	local_lock_irqsave(&s->cpu_slab->lock, flags);
+	__free_slab(slab->slab_cache, slab);
+}
 
-	oldslab = this_cpu_read(s->cpu_slab->partial);
+static void free_slab(struct kmem_cache *s, struct slab *slab)
+{
+	if (kmem_cache_debug_flags(s, SLAB_CONSISTENCY_CHECKS)) {
+		void *p;
 
-	if (oldslab) {
-		if (drain && oldslab->slabs >= s->cpu_partial_slabs) {
-			/*
-			 * Partial array is full. Move the existing set to the
-			 * per node partial list. Postpone the actual unfreezing
-			 * outside of the critical section.
-			 */
-			slab_to_put = oldslab;
-			oldslab = NULL;
-		} else {
-			slabs = oldslab->slabs;
-		}
+		slab_pad_check(s, slab);
+		for_each_object(p, s, slab_address(slab), slab->objects)
+			check_object(s, slab, p, SLUB_RED_INACTIVE);
 	}
 
-	slabs++;
-
-	slab->slabs = slabs;
-	slab->next = oldslab;
-
-	this_cpu_write(s->cpu_slab->partial, slab);
-
-	local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-
-	if (slab_to_put) {
-		__put_partials(s, slab_to_put);
-		stat(s, CPU_PARTIAL_DRAIN);
-	}
+	if (unlikely(s->flags & SLAB_TYPESAFE_BY_RCU))
+		call_rcu(&slab->rcu_head, rcu_free_slab);
+	else
+		__free_slab(s, slab);
 }
 
-#else	/* CONFIG_SLUB_CPU_PARTIAL */
-
-static inline void put_partials(struct kmem_cache *s) { }
-static inline void put_partials_cpu(struct kmem_cache *s,
-				    struct kmem_cache_cpu *c) { }
-
-#endif	/* CONFIG_SLUB_CPU_PARTIAL */
-
-static inline void flush_slab(struct kmem_cache *s, struct kmem_cache_cpu *c)
+static void discard_slab(struct kmem_cache *s, struct slab *slab)
 {
-	unsigned long flags;
-	struct slab *slab;
-	void *freelist;
-
-	local_lock_irqsave(&s->cpu_slab->lock, flags);
-
-	slab = c->slab;
-	freelist = c->freelist;
-
-	c->slab = NULL;
-	c->freelist = NULL;
-	c->tid = next_tid(c->tid);
-
-	local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-
-	if (slab) {
-		deactivate_slab(s, slab, freelist);
-		stat(s, CPUSLAB_FLUSH);
-	}
+	dec_slabs_node(s, slab_nid(slab), slab->objects);
+	free_slab(s, slab);
 }
 
-static inline void __flush_cpu_slab(struct kmem_cache *s, int cpu)
+static inline bool slab_test_node_partial(const struct slab *slab)
 {
-	struct kmem_cache_cpu *c = per_cpu_ptr(s->cpu_slab, cpu);
-	void *freelist = c->freelist;
-	struct slab *slab = c->slab;
-
-	c->slab = NULL;
-	c->freelist = NULL;
-	c->tid = next_tid(c->tid);
-
-	if (slab) {
-		deactivate_slab(s, slab, freelist);
-		stat(s, CPUSLAB_FLUSH);
-	}
+	return test_bit(SL_partial, &slab->flags.f);
+}
 
-	put_partials_cpu(s, c);
+static inline void slab_set_node_partial(struct slab *slab)
+{
+	set_bit(SL_partial, &slab->flags.f);
 }
 
-struct slub_flush_work {
-	struct work_struct work;
-	struct kmem_cache *s;
-	bool skip;
-};
+static inline void slab_clear_node_partial(struct slab *slab)
+{
+	clear_bit(SL_partial, &slab->flags.f);
+}
 
 /*
- * Flush cpu slab.
- *
- * Called from CPU work handler with migration disabled.
+ * Management of partially allocated slabs.
  */
-static void flush_cpu_slab(struct work_struct *w)
+static inline void
+__add_partial(struct kmem_cache_node *n, struct slab *slab, int tail)
 {
-	struct kmem_cache *s;
-	struct kmem_cache_cpu *c;
-	struct slub_flush_work *sfw;
-
-	sfw = container_of(w, struct slub_flush_work, work);
-
-	s = sfw->s;
-	c = this_cpu_ptr(s->cpu_slab);
-
-	if (c->slab)
-		flush_slab(s, c);
-
-	put_partials(s);
+	n->nr_partial++;
+	if (tail == DEACTIVATE_TO_TAIL)
+		list_add_tail(&slab->slab_list, &n->partial);
+	else
+		list_add(&slab->slab_list, &n->partial);
+	slab_set_node_partial(slab);
 }
 
-static bool has_cpu_slab(int cpu, struct kmem_cache *s)
+static inline void add_partial(struct kmem_cache_node *n,
+				struct slab *slab, int tail)
 {
-	struct kmem_cache_cpu *c = per_cpu_ptr(s->cpu_slab, cpu);
-
-	return c->slab || slub_percpu_partial(c);
+	lockdep_assert_held(&n->list_lock);
+	__add_partial(n, slab, tail);
 }
 
-static DEFINE_MUTEX(flush_lock);
-static DEFINE_PER_CPU(struct slub_flush_work, slub_flush);
+static inline void remove_partial(struct kmem_cache_node *n,
+					struct slab *slab)
+{
+	lockdep_assert_held(&n->list_lock);
+	list_del(&slab->slab_list);
+	slab_clear_node_partial(slab);
+	n->nr_partial--;
+}
 
-static void flush_all_cpus_locked(struct kmem_cache *s)
+/*
+ * Called only for kmem_cache_debug() caches instead of remove_partial(), with a
+ * slab from the n->partial list. Remove only a single object from the slab, do
+ * the alloc_debug_processing() checks and leave the slab on the list, or move
+ * it to full list if it was the last free object.
+ */
+static void *alloc_single_from_partial(struct kmem_cache *s,
+		struct kmem_cache_node *n, struct slab *slab, int orig_size)
 {
-	struct slub_flush_work *sfw;
-	unsigned int cpu;
+	void *object;
 
-	lockdep_assert_cpus_held();
-	mutex_lock(&flush_lock);
+	lockdep_assert_held(&n->list_lock);
 
-	for_each_online_cpu(cpu) {
-		sfw = &per_cpu(slub_flush, cpu);
-		if (!has_cpu_slab(cpu, s)) {
-			sfw->skip = true;
-			continue;
+#ifdef CONFIG_SLUB_DEBUG
+	if (s->flags & SLAB_CONSISTENCY_CHECKS) {
+		if (!validate_slab_ptr(slab)) {
+			slab_err(s, slab, "Not a valid slab page");
+			return NULL;
 		}
-		INIT_WORK(&sfw->work, flush_cpu_slab);
-		sfw->skip = false;
-		sfw->s = s;
-		queue_work_on(cpu, flushwq, &sfw->work);
 	}
+#endif
 
-	for_each_online_cpu(cpu) {
-		sfw = &per_cpu(slub_flush, cpu);
-		if (sfw->skip)
-			continue;
-		flush_work(&sfw->work);
+	object = slab->freelist;
+	slab->freelist = get_freepointer(s, object);
+	slab->inuse++;
+
+	if (!alloc_debug_processing(s, slab, object, orig_size)) {
+		remove_partial(n, slab);
+		return NULL;
 	}
 
-	mutex_unlock(&flush_lock);
-}
+	if (slab->inuse == slab->objects) {
+		remove_partial(n, slab);
+		add_full(s, n, slab);
+	}
 
-static void flush_all(struct kmem_cache *s)
-{
-	cpus_read_lock();
-	flush_all_cpus_locked(s);
-	cpus_read_unlock();
+	return object;
 }
 
+static void defer_deactivate_slab(struct slab *slab, void *flush_freelist);
+
 /*
- * Use the cpu notifier to insure that the cpu slabs are flushed when
- * necessary.
+ * Called only for kmem_cache_debug() caches to allocate from a freshly
+ * allocated slab. Allocate a single object instead of whole freelist
+ * and put the slab to the partial (or full) list.
  */
-static int slub_cpu_dead(unsigned int cpu)
+static void *alloc_single_from_new_slab(struct kmem_cache *s, struct slab *slab,
+					int orig_size, gfp_t gfpflags)
 {
-	struct kmem_cache *s;
-
-	mutex_lock(&slab_mutex);
-	list_for_each_entry(s, &slab_caches, list)
-		__flush_cpu_slab(s, cpu);
-	mutex_unlock(&slab_mutex);
-	return 0;
-}
+	bool allow_spin = gfpflags_allow_spinning(gfpflags);
+	int nid = slab_nid(slab);
+	struct kmem_cache_node *n = get_node(s, nid);
+	unsigned long flags;
+	void *object;
 
-#else /* CONFIG_SLUB_TINY */
-static inline void flush_all_cpus_locked(struct kmem_cache *s) { }
-static inline void flush_all(struct kmem_cache *s) { }
-static inline void __flush_cpu_slab(struct kmem_cache *s, int cpu) { }
-static inline int slub_cpu_dead(unsigned int cpu) { return 0; }
-#endif /* CONFIG_SLUB_TINY */
+	if (!allow_spin && !spin_trylock_irqsave(&n->list_lock, flags)) {
+		/* Unlucky, discard newly allocated slab */
+		slab->frozen = 1;
+		defer_deactivate_slab(slab, NULL);
+		return NULL;
+	}
 
-/*
- * Check if the objects in a per cpu structure fit numa
- * locality expectations.
- */
-static inline int node_match(struct slab *slab, int node)
-{
-#ifdef CONFIG_NUMA
-	if (node != NUMA_NO_NODE && slab_nid(slab) != node)
-		return 0;
-#endif
-	return 1;
-}
+	object = slab->freelist;
+	slab->freelist = get_freepointer(s, object);
+	slab->inuse = 1;
 
-#ifdef CONFIG_SLUB_DEBUG
-static int count_free(struct slab *slab)
-{
-	return slab->objects - slab->inuse;
-}
+	if (!alloc_debug_processing(s, slab, object, orig_size)) {
+		/*
+		 * It's not really expected that this would fail on a
+		 * freshly allocated slab, but a concurrent memory
+		 * corruption in theory could cause that.
+		 * Leak memory of allocated slab.
+		 */
+		if (!allow_spin)
+			spin_unlock_irqrestore(&n->list_lock, flags);
+		return NULL;
+	}
 
-static inline unsigned long node_nr_objs(struct kmem_cache_node *n)
-{
-	return atomic_long_read(&n->total_objects);
-}
+	if (allow_spin)
+		spin_lock_irqsave(&n->list_lock, flags);
 
-/* Supports checking bulk free of a constructed freelist */
-static inline bool free_debug_processing(struct kmem_cache *s,
-	struct slab *slab, void *head, void *tail, int *bulk_cnt,
-	unsigned long addr, depot_stack_handle_t handle)
-{
-	bool checks_ok = false;
-	void *object = head;
-	int cnt = 0;
+	if (slab->inuse == slab->objects)
+		add_full(s, n, slab);
+	else
+		add_partial(n, slab, DEACTIVATE_TO_HEAD);
 
-	if (s->flags & SLAB_CONSISTENCY_CHECKS) {
-		if (!check_slab(s, slab))
-			goto out;
-	}
+	inc_slabs_node(s, nid, slab->objects);
+	spin_unlock_irqrestore(&n->list_lock, flags);
 
-	if (slab->inuse < *bulk_cnt) {
-		slab_err(s, slab, "Slab has %d allocated objects but %d are to be freed\n",
-			 slab->inuse, *bulk_cnt);
-		goto out;
-	}
+	return object;
+}
 
-next_object:
+#ifdef CONFIG_SLUB_CPU_PARTIAL
+static void put_cpu_partial(struct kmem_cache *s, struct slab *slab, int drain);
+#else
+static inline void put_cpu_partial(struct kmem_cache *s, struct slab *slab,
+				   int drain) { }
+#endif
+static inline bool pfmemalloc_match(struct slab *slab, gfp_t gfpflags);
 
-	if (++cnt > *bulk_cnt)
-		goto out_cnt;
+/*
+ * Try to allocate a partial slab from a specific node.
+ */
+static struct slab *get_partial_node(struct kmem_cache *s,
+				     struct kmem_cache_node *n,
+				     struct partial_context *pc)
+{
+	struct slab *slab, *slab2, *partial = NULL;
+	unsigned long flags;
+	unsigned int partial_slabs = 0;
 
-	if (s->flags & SLAB_CONSISTENCY_CHECKS) {
-		if (!free_consistency_checks(s, slab, object, addr))
-			goto out;
-	}
+	/*
+	 * Racy check. If we mistakenly see no partial slabs then we
+	 * just allocate an empty slab. If we mistakenly try to get a
+	 * partial slab and there is none available then get_partial()
+	 * will return NULL.
+	 */
+	if (!n || !n->nr_partial)
+		return NULL;
 
-	if (s->flags & SLAB_STORE_USER)
-		set_track_update(s, object, TRACK_FREE, addr, handle);
-	trace(s, slab, object, 0);
-	/* Freepointer not overwritten by init_object(), SLAB_POISON moved it */
-	init_object(s, object, SLUB_RED_INACTIVE);
+	if (gfpflags_allow_spinning(pc->flags))
+		spin_lock_irqsave(&n->list_lock, flags);
+	else if (!spin_trylock_irqsave(&n->list_lock, flags))
+		return NULL;
+	list_for_each_entry_safe(slab, slab2, &n->partial, slab_list) {
+		if (!pfmemalloc_match(slab, pc->flags))
+			continue;
 
-	/* Reached end of constructed freelist yet? */
-	if (object != tail) {
-		object = get_freepointer(s, object);
-		goto next_object;
-	}
-	checks_ok = true;
+		if (IS_ENABLED(CONFIG_SLUB_TINY) || kmem_cache_debug(s)) {
+			void *object = alloc_single_from_partial(s, n, slab,
+							pc->orig_size);
+			if (object) {
+				partial = slab;
+				pc->object = object;
+				break;
+			}
+			continue;
+		}
 
-out_cnt:
-	if (cnt != *bulk_cnt) {
-		slab_err(s, slab, "Bulk free expected %d objects but found %d\n",
-			 *bulk_cnt, cnt);
-		*bulk_cnt = cnt;
-	}
+		remove_partial(n, slab);
 
-out:
+		if (!partial) {
+			partial = slab;
+			stat(s, ALLOC_FROM_PARTIAL);
 
-	if (!checks_ok)
-		slab_fix(s, "Object at 0x%p not freed", object);
+			if ((slub_get_cpu_partial(s) == 0)) {
+				break;
+			}
+		} else {
+			put_cpu_partial(s, slab, 0);
+			stat(s, CPU_PARTIAL_NODE);
 
-	return checks_ok;
+			if (++partial_slabs > slub_get_cpu_partial(s) / 2) {
+				break;
+			}
+		}
+	}
+	spin_unlock_irqrestore(&n->list_lock, flags);
+	return partial;
 }
-#endif /* CONFIG_SLUB_DEBUG */
 
-#if defined(CONFIG_SLUB_DEBUG) || defined(SLAB_SUPPORTS_SYSFS)
-static unsigned long count_partial(struct kmem_cache_node *n,
-					int (*get_count)(struct slab *))
+/*
+ * Get a slab from somewhere. Search in increasing NUMA distances.
+ */
+static struct slab *get_any_partial(struct kmem_cache *s,
+				    struct partial_context *pc)
 {
-	unsigned long flags;
-	unsigned long x = 0;
+#ifdef CONFIG_NUMA
+	struct zonelist *zonelist;
+	struct zoneref *z;
+	struct zone *zone;
+	enum zone_type highest_zoneidx = gfp_zone(pc->flags);
 	struct slab *slab;
+	unsigned int cpuset_mems_cookie;
 
-	spin_lock_irqsave(&n->list_lock, flags);
-	list_for_each_entry(slab, &n->partial, slab_list)
-		x += get_count(slab);
-	spin_unlock_irqrestore(&n->list_lock, flags);
-	return x;
-}
-#endif /* CONFIG_SLUB_DEBUG || SLAB_SUPPORTS_SYSFS */
-
-#ifdef CONFIG_SLUB_DEBUG
-#define MAX_PARTIAL_TO_SCAN 10000
+	/*
+	 * The defrag ratio allows a configuration of the tradeoffs between
+	 * inter node defragmentation and node local allocations. A lower
+	 * defrag_ratio increases the tendency to do local allocations
+	 * instead of attempting to obtain partial slabs from other nodes.
+	 *
+	 * If the defrag_ratio is set to 0 then kmalloc() always
+	 * returns node local objects. If the ratio is higher then kmalloc()
+	 * may return off node objects because partial slabs are obtained
+	 * from other nodes and filled up.
+	 *
+	 * If /sys/kernel/slab/xx/remote_node_defrag_ratio is set to 100
+	 * (which makes defrag_ratio = 1000) then every (well almost)
+	 * allocation will first attempt to defrag slab caches on other nodes.
+	 * This means scanning over all nodes to look for partial slabs which
+	 * may be expensive if we do it every time we are trying to find a slab
+	 * with available objects.
+	 */
+	if (!s->remote_node_defrag_ratio ||
+			get_cycles() % 1024 > s->remote_node_defrag_ratio)
+		return NULL;
 
-static unsigned long count_partial_free_approx(struct kmem_cache_node *n)
-{
-	unsigned long flags;
-	unsigned long x = 0;
-	struct slab *slab;
+	do {
+		cpuset_mems_cookie = read_mems_allowed_begin();
+		zonelist = node_zonelist(mempolicy_slab_node(), pc->flags);
+		for_each_zone_zonelist(zone, z, zonelist, highest_zoneidx) {
+			struct kmem_cache_node *n;
 
-	spin_lock_irqsave(&n->list_lock, flags);
-	if (n->nr_partial <= MAX_PARTIAL_TO_SCAN) {
-		list_for_each_entry(slab, &n->partial, slab_list)
-			x += slab->objects - slab->inuse;
-	} else {
-		/*
-		 * For a long list, approximate the total count of objects in
-		 * it to meet the limit on the number of slabs to scan.
-		 * Scan from both the list's head and tail for better accuracy.
-		 */
-		unsigned long scanned = 0;
+			n = get_node(s, zone_to_nid(zone));
 
-		list_for_each_entry(slab, &n->partial, slab_list) {
-			x += slab->objects - slab->inuse;
-			if (++scanned == MAX_PARTIAL_TO_SCAN / 2)
-				break;
-		}
-		list_for_each_entry_reverse(slab, &n->partial, slab_list) {
-			x += slab->objects - slab->inuse;
-			if (++scanned == MAX_PARTIAL_TO_SCAN)
-				break;
+			if (n && cpuset_zone_allowed(zone, pc->flags) &&
+					n->nr_partial > s->min_partial) {
+				slab = get_partial_node(s, n, pc);
+				if (slab) {
+					/*
+					 * Don't check read_mems_allowed_retry()
+					 * here - if mems_allowed was updated in
+					 * parallel, that was a harmless race
+					 * between allocation and the cpuset
+					 * update
+					 */
+					return slab;
+				}
+			}
 		}
-		x = mult_frac(x, n->nr_partial, scanned);
-		x = min(x, node_nr_objs(n));
-	}
-	spin_unlock_irqrestore(&n->list_lock, flags);
-	return x;
+	} while (read_mems_allowed_retry(cpuset_mems_cookie));
+#endif	/* CONFIG_NUMA */
+	return NULL;
 }
 
-static noinline void
-slab_out_of_memory(struct kmem_cache *s, gfp_t gfpflags, int nid)
+/*
+ * Get a partial slab, lock it and return it.
+ */
+static struct slab *get_partial(struct kmem_cache *s, int node,
+				struct partial_context *pc)
 {
-	static DEFINE_RATELIMIT_STATE(slub_oom_rs, DEFAULT_RATELIMIT_INTERVAL,
-				      DEFAULT_RATELIMIT_BURST);
-	int cpu = raw_smp_processor_id();
-	int node;
-	struct kmem_cache_node *n;
+	struct slab *slab;
+	int searchnode = node;
 
-	if ((gfpflags & __GFP_NOWARN) || !__ratelimit(&slub_oom_rs))
-		return;
+	if (node == NUMA_NO_NODE)
+		searchnode = numa_mem_id();
 
-	pr_warn("SLUB: Unable to allocate memory on CPU %u (of node %d) on node %d, gfp=%#x(%pGg)\n",
-		cpu, cpu_to_node(cpu), nid, gfpflags, &gfpflags);
-	pr_warn("  cache: %s, object size: %u, buffer size: %u, default order: %u, min order: %u\n",
-		s->name, s->object_size, s->size, oo_order(s->oo),
-		oo_order(s->min));
+	slab = get_partial_node(s, get_node(s, searchnode), pc);
+	if (slab || (node != NUMA_NO_NODE && (pc->flags & __GFP_THISNODE)))
+		return slab;
 
-	if (oo_order(s->min) > get_order(s->object_size))
-		pr_warn("  %s debugging increased min order, use slab_debug=O to disable.\n",
-			s->name);
+	return get_any_partial(s, pc);
+}
 
-	for_each_kmem_cache_node(s, node, n) {
-		unsigned long nr_slabs;
-		unsigned long nr_objs;
-		unsigned long nr_free;
+#ifndef CONFIG_SLUB_TINY
 
-		nr_free  = count_partial_free_approx(n);
-		nr_slabs = node_nr_slabs(n);
-		nr_objs  = node_nr_objs(n);
+#ifdef CONFIG_PREEMPTION
+/*
+ * Calculate the next globally unique transaction for disambiguation
+ * during cmpxchg. The transactions start with the cpu number and are then
+ * incremented by CONFIG_NR_CPUS.
+ */
+#define TID_STEP  roundup_pow_of_two(CONFIG_NR_CPUS)
+#else
+/*
+ * No preemption supported therefore also no need to check for
+ * different cpus.
+ */
+#define TID_STEP 1
+#endif /* CONFIG_PREEMPTION */
 
-		pr_warn("  node %d: slabs: %ld, objs: %ld, free: %ld\n",
-			node, nr_slabs, nr_objs, nr_free);
-	}
+static inline unsigned long next_tid(unsigned long tid)
+{
+	return tid + TID_STEP;
 }
-#else /* CONFIG_SLUB_DEBUG */
-static inline void
-slab_out_of_memory(struct kmem_cache *s, gfp_t gfpflags, int nid) { }
-#endif
 
-static inline bool pfmemalloc_match(struct slab *slab, gfp_t gfpflags)
+#ifdef SLUB_DEBUG_CMPXCHG
+static inline unsigned int tid_to_cpu(unsigned long tid)
 {
-	if (unlikely(slab_test_pfmemalloc(slab)))
-		return gfp_pfmemalloc_allowed(gfpflags);
-
-	return true;
+	return tid % TID_STEP;
 }
 
-#ifndef CONFIG_SLUB_TINY
-static inline bool
-__update_cpu_freelist_fast(struct kmem_cache *s,
-			   void *freelist_old, void *freelist_new,
-			   unsigned long tid)
+static inline unsigned long tid_to_event(unsigned long tid)
 {
-	freelist_aba_t old = { .freelist = freelist_old, .counter = tid };
-	freelist_aba_t new = { .freelist = freelist_new, .counter = next_tid(tid) };
-
-	return this_cpu_try_cmpxchg_freelist(s->cpu_slab->freelist_tid.full,
-					     &old.full, new.full);
+	return tid / TID_STEP;
 }
+#endif
 
-/*
- * Check the slab->freelist and either transfer the freelist to the
- * per cpu freelist or deactivate the slab.
- *
- * The slab is still frozen if the return value is not NULL.
- *
- * If this function returns NULL then the slab has been unfrozen.
- */
-static inline void *get_freelist(struct kmem_cache *s, struct slab *slab)
+static inline unsigned int init_tid(int cpu)
 {
-	struct slab new;
-	unsigned long counters;
-	void *freelist;
-
-	lockdep_assert_held(this_cpu_ptr(&s->cpu_slab->lock));
+	return cpu;
+}
 
-	do {
-		freelist = slab->freelist;
-		counters = slab->counters;
+static inline void note_cmpxchg_failure(const char *n,
+		const struct kmem_cache *s, unsigned long tid)
+{
+#ifdef SLUB_DEBUG_CMPXCHG
+	unsigned long actual_tid = __this_cpu_read(s->cpu_slab->tid);
 
-		new.counters = counters;
+	pr_info("%s %s: cmpxchg redo ", n, s->name);
 
-		new.inuse = slab->objects;
-		new.frozen = freelist != NULL;
+	if (IS_ENABLED(CONFIG_PREEMPTION) &&
+	    tid_to_cpu(tid) != tid_to_cpu(actual_tid)) {
+		pr_warn("due to cpu change %d -> %d\n",
+			tid_to_cpu(tid), tid_to_cpu(actual_tid));
+	} else if (tid_to_event(tid) != tid_to_event(actual_tid)) {
+		pr_warn("due to cpu running other code. Event %ld->%ld\n",
+			tid_to_event(tid), tid_to_event(actual_tid));
+	} else {
+		pr_warn("for unknown reason: actual=%lx was=%lx target=%lx\n",
+			actual_tid, tid, next_tid(tid));
+	}
+#endif
+	stat(s, CMPXCHG_DOUBLE_CPU_FAIL);
+}
 
-	} while (!__slab_update_freelist(s, slab,
-		freelist, counters,
-		NULL, new.counters,
-		"get_freelist"));
+static void init_kmem_cache_cpus(struct kmem_cache *s)
+{
+#ifdef CONFIG_PREEMPT_RT
+	/*
+	 * Register lockdep key for non-boot kmem caches to avoid
+	 * WARN_ON_ONCE(static_obj(key))) in lockdep_register_key()
+	 */
+	bool finegrain_lockdep = !init_section_contains(s, 1);
+#else
+	/*
+	 * Don't bother with different lockdep classes for each
+	 * kmem_cache, since we only use local_trylock_irqsave().
+	 */
+	bool finegrain_lockdep = false;
+#endif
+	int cpu;
+	struct kmem_cache_cpu *c;
 
-	return freelist;
+	if (finegrain_lockdep)
+		lockdep_register_key(&s->lock_key);
+	for_each_possible_cpu(cpu) {
+		c = per_cpu_ptr(s->cpu_slab, cpu);
+		local_trylock_init(&c->lock);
+		if (finegrain_lockdep)
+			lockdep_set_class(&c->lock, &s->lock_key);
+		c->tid = init_tid(cpu);
+	}
 }
 
 /*
- * Freeze the partial slab and return the pointer to the freelist.
+ * Finishes removing the cpu slab. Merges cpu's freelist with slab's freelist,
+ * unfreezes the slabs and puts it on the proper list.
+ * Assumes the slab has been already safely taken away from kmem_cache_cpu
+ * by the caller.
  */
-static inline void *freeze_slab(struct kmem_cache *s, struct slab *slab)
+static void deactivate_slab(struct kmem_cache *s, struct slab *slab,
+			    void *freelist)
 {
+	struct kmem_cache_node *n = get_node(s, slab_nid(slab));
+	int free_delta = 0;
+	void *nextfree, *freelist_iter, *freelist_tail;
+	int tail = DEACTIVATE_TO_HEAD;
+	unsigned long flags = 0;
 	struct slab new;
-	unsigned long counters;
-	void *freelist;
+	struct slab old;
 
-	do {
-		freelist = slab->freelist;
-		counters = slab->counters;
+	if (READ_ONCE(slab->freelist)) {
+		stat(s, DEACTIVATE_REMOTE_FREES);
+		tail = DEACTIVATE_TO_TAIL;
+	}
 
-		new.counters = counters;
-		VM_BUG_ON(new.frozen);
+	/*
+	 * Stage one: Count the objects on cpu's freelist as free_delta and
+	 * remember the last object in freelist_tail for later splicing.
+	 */
+	freelist_tail = NULL;
+	freelist_iter = freelist;
+	while (freelist_iter) {
+		nextfree = get_freepointer(s, freelist_iter);
 
-		new.inuse = slab->objects;
-		new.frozen = 1;
+		/*
+		 * If 'nextfree' is invalid, it is possible that the object at
+		 * 'freelist_iter' is already corrupted.  So isolate all objects
+		 * starting at 'freelist_iter' by skipping them.
+		 */
+		if (freelist_corrupted(s, slab, &freelist_iter, nextfree))
+			break;
+
+		freelist_tail = freelist_iter;
+		free_delta++;
 
+		freelist_iter = nextfree;
+	}
+
+	/*
+	 * Stage two: Unfreeze the slab while splicing the per-cpu
+	 * freelist to the head of slab's freelist.
+	 */
+	do {
+		old.freelist = READ_ONCE(slab->freelist);
+		old.counters = READ_ONCE(slab->counters);
+		VM_BUG_ON(!old.frozen);
+
+		/* Determine target state of the slab */
+		new.counters = old.counters;
+		new.frozen = 0;
+		if (freelist_tail) {
+			new.inuse -= free_delta;
+			set_freepointer(s, freelist_tail, old.freelist);
+			new.freelist = freelist;
+		} else {
+			new.freelist = old.freelist;
+		}
 	} while (!slab_update_freelist(s, slab,
-		freelist, counters,
-		NULL, new.counters,
-		"freeze_slab"));
+		old.freelist, old.counters,
+		new.freelist, new.counters,
+		"unfreezing slab"));
 
-	return freelist;
+	/*
+	 * Stage three: Manipulate the slab list based on the updated state.
+	 */
+	if (!new.inuse && n->nr_partial >= s->min_partial) {
+		stat(s, DEACTIVATE_EMPTY);
+		discard_slab(s, slab);
+		stat(s, FREE_SLAB);
+	} else if (new.freelist) {
+		spin_lock_irqsave(&n->list_lock, flags);
+		add_partial(n, slab, tail);
+		spin_unlock_irqrestore(&n->list_lock, flags);
+		stat(s, tail);
+	} else {
+		stat(s, DEACTIVATE_FULL);
+	}
 }
 
 /*
- * Slow path. The lockless freelist is empty or we need to perform
- * debugging duties.
+ * ___slab_alloc()'s caller is supposed to check if kmem_cache::kmem_cache_cpu::lock
+ * can be acquired without a deadlock before invoking the function.
  *
- * Processing is still very fast if new objects have been freed to the
- * regular freelist. In that case we simply take over the regular freelist
- * as the lockless freelist and zap the regular freelist.
+ * Without LOCKDEP we trust the code to be correct. kmalloc_nolock() is
+ * using local_lock_is_locked() properly before calling local_lock_cpu_slab(),
+ * and kmalloc() is not used in an unsupported context.
  *
- * If that is not working then we fall back to the partial lists. We take the
- * first element of the freelist as the object to allocate now and move the
- * rest of the freelist to the lockless freelist.
+ * With LOCKDEP, on PREEMPT_RT lockdep does its checking in local_lock_irqsave().
+ * On !PREEMPT_RT we use trylock to avoid false positives in NMI, but
+ * lockdep_assert() will catch a bug in case:
+ * #1
+ * kmalloc() -> ___slab_alloc() -> irqsave -> NMI -> bpf -> kmalloc_nolock()
+ * or
+ * #2
+ * kmalloc() -> ___slab_alloc() -> irqsave -> tracepoint/kprobe -> bpf -> kmalloc_nolock()
  *
- * And if we were unable to get a new slab from the partial slab lists then
- * we need to allocate a new slab. This is the slowest path since it involves
- * a call to the page allocator and the setup of a new slab.
+ * On PREEMPT_RT an invocation is not possible from IRQ-off or preempt
+ * disabled context. The lock will always be acquired and if needed it
+ * block and sleep until the lock is available.
+ * #1 is possible in !PREEMPT_RT only.
+ * #2 is possible in both with a twist that irqsave is replaced with rt_spinlock:
+ * kmalloc() -> ___slab_alloc() -> rt_spin_lock(kmem_cache_A) ->
+ *    tracepoint/kprobe -> bpf -> kmalloc_nolock() -> rt_spin_lock(kmem_cache_B)
  *
- * Version of __slab_alloc to use when we know that preemption is
- * already disabled (which is the case for bulk allocation).
+ * local_lock_is_locked() prevents the case kmem_cache_A == kmem_cache_B
  */
-static void *___slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,
-			  unsigned long addr, struct kmem_cache_cpu *c, unsigned int orig_size)
+#if defined(CONFIG_PREEMPT_RT) || !defined(CONFIG_LOCKDEP)
+#define local_lock_cpu_slab(s, flags)	\
+	local_lock_irqsave(&(s)->cpu_slab->lock, flags)
+#else
+#define local_lock_cpu_slab(s, flags)					       \
+	do {								       \
+		bool __l = local_trylock_irqsave(&(s)->cpu_slab->lock, flags); \
+		lockdep_assert(__l);					       \
+	} while (0)
+#endif
+
+#define local_unlock_cpu_slab(s, flags)	\
+	local_unlock_irqrestore(&(s)->cpu_slab->lock, flags)
+
+#ifdef CONFIG_SLUB_CPU_PARTIAL
+static void __put_partials(struct kmem_cache *s, struct slab *partial_slab)
 {
-	void *freelist;
-	struct slab *slab;
-	unsigned long flags;
-	struct partial_context pc;
-	bool try_thisnode = true;
+	struct kmem_cache_node *n = NULL, *n2 = NULL;
+	struct slab *slab, *slab_to_discard = NULL;
+	unsigned long flags = 0;
 
-	stat(s, ALLOC_SLOWPATH);
+	while (partial_slab) {
+		slab = partial_slab;
+		partial_slab = slab->next;
 
-reread_slab:
+		n2 = get_node(s, slab_nid(slab));
+		if (n != n2) {
+			if (n)
+				spin_unlock_irqrestore(&n->list_lock, flags);
 
-	slab = READ_ONCE(c->slab);
-	if (!slab) {
-		/*
-		 * if the node is not online or has no normal memory, just
-		 * ignore the node constraint
-		 */
-		if (unlikely(node != NUMA_NO_NODE &&
-			     !node_isset(node, slab_nodes)))
-			node = NUMA_NO_NODE;
-		goto new_slab;
-	}
+			n = n2;
+			spin_lock_irqsave(&n->list_lock, flags);
+		}
 
-	if (unlikely(!node_match(slab, node))) {
-		/*
-		 * same as above but node_match() being false already
-		 * implies node != NUMA_NO_NODE
-		 */
-		if (!node_isset(node, slab_nodes)) {
-			node = NUMA_NO_NODE;
+		if (unlikely(!slab->inuse && n->nr_partial >= s->min_partial)) {
+			slab->next = slab_to_discard;
+			slab_to_discard = slab;
 		} else {
-			stat(s, ALLOC_NODE_MISMATCH);
-			goto deactivate_slab;
+			add_partial(n, slab, DEACTIVATE_TO_TAIL);
+			stat(s, FREE_ADD_PARTIAL);
 		}
 	}
 
-	/*
-	 * By rights, we should be searching for a slab page that was
-	 * PFMEMALLOC but right now, we are losing the pfmemalloc
-	 * information when the page leaves the per-cpu allocator
-	 */
-	if (unlikely(!pfmemalloc_match(slab, gfpflags)))
-		goto deactivate_slab;
-
-	/* must check again c->slab in case we got preempted and it changed */
-	local_lock_irqsave(&s->cpu_slab->lock, flags);
-	if (unlikely(slab != c->slab)) {
-		local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-		goto reread_slab;
-	}
-	freelist = c->freelist;
-	if (freelist)
-		goto load_freelist;
+	if (n)
+		spin_unlock_irqrestore(&n->list_lock, flags);
 
-	freelist = get_freelist(s, slab);
+	while (slab_to_discard) {
+		slab = slab_to_discard;
+		slab_to_discard = slab_to_discard->next;
 
-	if (!freelist) {
-		c->slab = NULL;
-		c->tid = next_tid(c->tid);
-		local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-		stat(s, DEACTIVATE_BYPASS);
-		goto new_slab;
+		stat(s, DEACTIVATE_EMPTY);
+		discard_slab(s, slab);
+		stat(s, FREE_SLAB);
 	}
+}
 
-	stat(s, ALLOC_REFILL);
-
-load_freelist:
-
-	lockdep_assert_held(this_cpu_ptr(&s->cpu_slab->lock));
-
-	/*
-	 * freelist is pointing to the list of objects to be used.
-	 * slab is pointing to the slab from which the objects are obtained.
-	 * That slab must be frozen for per cpu allocations to work.
-	 */
-	VM_BUG_ON(!c->slab->frozen);
-	c->freelist = get_freepointer(s, freelist);
-	c->tid = next_tid(c->tid);
-	local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-	return freelist;
-
-deactivate_slab:
+/*
+ * Put all the cpu partial slabs to the node partial list.
+ */
+static void put_partials(struct kmem_cache *s)
+{
+	struct slab *partial_slab;
+	unsigned long flags;
 
 	local_lock_irqsave(&s->cpu_slab->lock, flags);
-	if (slab != c->slab) {
-		local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-		goto reread_slab;
-	}
-	freelist = c->freelist;
-	c->slab = NULL;
-	c->freelist = NULL;
-	c->tid = next_tid(c->tid);
+	partial_slab = this_cpu_read(s->cpu_slab->partial);
+	this_cpu_write(s->cpu_slab->partial, NULL);
 	local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-	deactivate_slab(s, slab, freelist);
 
-new_slab:
+	if (partial_slab)
+		__put_partials(s, partial_slab);
+}
 
-#ifdef CONFIG_SLUB_CPU_PARTIAL
-	while (slub_percpu_partial(c)) {
-		local_lock_irqsave(&s->cpu_slab->lock, flags);
-		if (unlikely(c->slab)) {
-			local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-			goto reread_slab;
-		}
-		if (unlikely(!slub_percpu_partial(c))) {
-			local_unlock_irqrestore(&s->cpu_slab->lock, flags);
-			/* we were preempted and partial list got empty */
-			goto new_objects;
-		}
+static void put_partials_cpu(struct kmem_cache *s,
+			     struct kmem_cache_cpu *c)
+{
+	struct slab *partial_slab;
 
-		slab = slub_percpu_partial(c);
-		slub_set_percpu_partial(c, slab);
+	partial_slab = slub_percpu_partial(c);
+	c->partial = NULL;
 
-		if (likely(node_match(slab, node) &&
-			   pfmemalloc_match(slab, gfpflags))) {
-			c->slab = slab;
-			freelist = get_freelist(s, slab);
-			VM_BUG_ON(!freelist);
-			stat(s, CPU_PARTIAL_ALLOC);
-			goto load_freelist;
-		}
+	if (partial_slab)
+		__put_partials(s, partial_slab);
+}
 
-		local_unlock_irqrestore(&s->cpu_slab->lock, flags);
+/*
+ * Put a slab into a partial slab slot if available.
+ *
+ * If we did not find a slot then simply move all the partials to the
+ * per node partial list.
+ */
+static void put_cpu_partial(struct kmem_cache *s, struct slab *slab, int drain)
+{
+	struct slab *oldslab;
+	struct slab *slab_to_put = NULL;
+	unsigned long flags;
+	int slabs = 0;
 
-		slab->next = NULL;
-		__put_partials(s, slab);
-	}
-#endif
+	local_lock_cpu_slab(s, flags);
 
-new_objects:
+	oldslab = this_cpu_read(s->cpu_slab->partial);
 
-	pc.flags = gfpflags;
-	/*
-	 * When a preferred node is indicated but no __GFP_THISNODE
-	 *
-	 * 1) try to get a partial slab from target node only by having
-	 *    __GFP_THISNODE in pc.flags for get_partial()
-	 * 2) if 1) failed, try to allocate a new slab from target node with
-	 *    GPF_NOWAIT | __GFP_THISNODE opportunistically
-	 * 3) if 2) failed, retry with original gfpflags which will allow
-	 *    get_partial() try partial lists of other nodes before potentially
-	 *    allocating new page from other nodes
-	 */
-	if (unlikely(node != NUMA_NO_NODE && !(gfpflags & __GFP_THISNODE)
-		     && try_thisnode))
-		pc.flags = GFP_NOWAIT | __GFP_THISNODE;
-
-	pc.orig_size = orig_size;
-	slab = get_partial(s, node, &pc);
-	if (slab) {
-		if (kmem_cache_debug(s)) {
-			freelist = pc.object;
+	if (oldslab) {
+		if (drain && oldslab->slabs >= s->cpu_partial_slabs) {
 			/*
-			 * For debug caches here we had to go through
-			 * alloc_single_from_partial() so just store the
-			 * tracking info and return the object.
-			 *
-			 * Due to disabled preemption we need to disallow
-			 * blocking. The flags are further adjusted by
-			 * gfp_nested_mask() in stack_depot itself.
+			 * Partial array is full. Move the existing set to the
+			 * per node partial list. Postpone the actual unfreezing
+			 * outside of the critical section.
 			 */
-			if (s->flags & SLAB_STORE_USER)
-				set_track(s, freelist, TRACK_ALLOC, addr,
-					  gfpflags & ~(__GFP_DIRECT_RECLAIM));
-
-			return freelist;
-		}
-
-		freelist = freeze_slab(s, slab);
-		goto retry_load_slab;
-	}
-
-	slub_put_cpu_ptr(s->cpu_slab);
-	slab = new_slab(s, pc.flags, node);
-	c = slub_get_cpu_ptr(s->cpu_slab);
-
-	if (unlikely(!slab)) {
-		if (node != NUMA_NO_NODE && !(gfpflags & __GFP_THISNODE)
-		    && try_thisnode) {
-			try_thisnode = false;
-			goto new_objects;
+			slab_to_put = oldslab;
+			oldslab = NULL;
+		} else {
+			slabs = oldslab->slabs;
 		}
-		slab_out_of_memory(s, gfpflags, node);
-		return NULL;
 	}
 
-	stat(s, ALLOC_SLAB);
+	slabs++;
 
-	if (kmem_cache_debug(s)) {
-		freelist = alloc_single_from_new_slab(s, slab, orig_size);
+	slab->slabs = slabs;
+	slab->next = oldslab;
 
-		if (unlikely(!freelist))
-			goto new_objects;
+	this_cpu_write(s->cpu_slab->partial, slab);
 
-		if (s->flags & SLAB_STORE_USER)
-			set_track(s, freelist, TRACK_ALLOC, addr,
-				  gfpflags & ~(__GFP_DIRECT_RECLAIM));
+	local_unlock_cpu_slab(s, flags);
 
-		return freelist;
+	if (slab_to_put) {
+		__put_partials(s, slab_to_put);
+		stat(s, CPU_PARTIAL_DRAIN);
 	}
+}
 
-	/*
-	 * No other reference to the slab yet so we can
-	 * muck around with it freely without cmpxchg
-	 */
-	freelist = slab->freelist;
-	slab->freelist = NULL;
-	slab->inuse = slab->objects;
-	slab->frozen = 1;
+#else	/* CONFIG_SLUB_CPU_PARTIAL */
 
-	inc_slabs_node(s, slab_nid(slab), slab->objects);
+static inline void put_partials(struct kmem_cache *s) { }
+static inline void put_partials_cpu(struct kmem_cache *s,
+				    struct kmem_cache_cpu *c) { }
 
-	if (unlikely(!pfmemalloc_match(slab, gfpflags))) {
-		/*
-		 * For !pfmemalloc_match() case we don't load freelist so that
-		 * we don't make further mismatched allocations easier.
-		 */
-		deactivate_slab(s, slab, get_freepointer(s, freelist));
-		return freelist;
-	}
+#endif	/* CONFIG_SLUB_CPU_PARTIAL */
 
-retry_load_slab:
+static inline void flush_slab(struct kmem_cache *s, struct kmem_cache_cpu *c)
+{
+	unsigned long flags;
+	struct slab *slab;
+	void *freelist;
 
 	local_lock_irqsave(&s->cpu_slab->lock, flags);
-	if (unlikely(c->slab)) {
-		void *flush_freelist = c->freelist;
-		struct slab *flush_slab = c->slab;
 
-		c->slab = NULL;
-		c->freelist = NULL;
-		c->tid = next_tid(c->tid);
+	slab = c->slab;
+	freelist = c->freelist;
 
-		local_unlock_irqrestore(&s->cpu_slab->lock, flags);
+	c->slab = NULL;
+	c->freelist = NULL;
+	c->tid = next_tid(c->tid);
 
-		deactivate_slab(s, flush_slab, flush_freelist);
+	local_unlock_irqrestore(&s->cpu_slab->lock, flags);
 
+	if (slab) {
+		deactivate_slab(s, slab, freelist);
 		stat(s, CPUSLAB_FLUSH);
+	}
+}
 
-		goto retry_load_slab;
+static inline void __flush_cpu_slab(struct kmem_cache *s, int cpu)
+{
+	struct kmem_cache_cpu *c = per_cpu_ptr(s->cpu_slab, cpu);
+	void *freelist = c->freelist;
+	struct slab *slab = c->slab;
+
+	c->slab = NULL;
+	c->freelist = NULL;
+	c->tid = next_tid(c->tid);
+
+	if (slab) {
+		deactivate_slab(s, slab, freelist);
+		stat(s, CPUSLAB_FLUSH);
 	}
-	c->slab = slab;
 
-	goto load_freelist;
+	put_partials_cpu(s, c);
 }
 
-/*
- * A wrapper for ___slab_alloc() for contexts where preemption is not yet
- * disabled. Compensates for possible cpu changes by refetching the per cpu area
- * pointer.
- */
-static void *__slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,
-			  unsigned long addr, struct kmem_cache_cpu *c, unsigned int orig_size)
+static inline void flush_this_cpu_slab(struct kmem_cache *s)
 {
-	void *p;
+	struct kmem_cache_cpu *c = this_cpu_ptr(s->cpu_slab);
 
-#ifdef CONFIG_PREEMPT_COUNT
-	/*
-	 * We may have been preempted and rescheduled on a different
-	 * cpu before disabling preemption. Need to reload cpu area
-	 * pointer.
-	 */
-	c = slub_get_cpu_ptr(s->cpu_slab);
-#endif
+	if (c->slab)
+		flush_slab(s, c);
 
-	p = ___slab_alloc(s, gfpflags, node, addr, c, orig_size);
-#ifdef CONFIG_PREEMPT_COUNT
-	slub_put_cpu_ptr(s->cpu_slab);
-#endif
-	return p;
+	put_partials(s);
 }
 
-static __always_inline void *__slab_alloc_node(struct kmem_cache *s,
-		gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)
+static bool has_cpu_slab(int cpu, struct kmem_cache *s)
 {
-	struct kmem_cache_cpu *c;
-	struct slab *slab;
-	unsigned long tid;
-	void *object;
+	struct kmem_cache_cpu *c = per_cpu_ptr(s->cpu_slab, cpu);
 
-redo:
-	/*
-	 * Must read kmem_cache cpu data via this cpu ptr. Preemption is
-	 * enabled. We may switch back and forth between cpus while
-	 * reading from one cpu area. That does not matter as long
-	 * as we end up on the original cpu again when doing the cmpxchg.
-	 *
-	 * We must guarantee that tid and kmem_cache_cpu are retrieved on the
-	 * same cpu. We read first the kmem_cache_cpu pointer and use it to read
-	 * the tid. If we are preempted and switched to another cpu between the
-	 * two reads, it's OK as the two are still associated with the same cpu
-	 * and cmpxchg later will validate the cpu.
-	 */
-	c = raw_cpu_ptr(s->cpu_slab);
-	tid = READ_ONCE(c->tid);
+	return c->slab || slub_percpu_partial(c);
+}
 
-	/*
-	 * Irqless object alloc/free algorithm used here depends on sequence
-	 * of fetching cpu_slab's data. tid should be fetched before anything
-	 * on c to guarantee that object and slab associated with previous tid
-	 * won't be used with current tid. If we fetch tid first, object and
-	 * slab could be one associated with next tid and our alloc/free
-	 * request will be failed. In this case, we will retry. So, no problem.
-	 */
-	barrier();
+#else /* CONFIG_SLUB_TINY */
+static inline void __flush_cpu_slab(struct kmem_cache *s, int cpu) { }
+static inline bool has_cpu_slab(int cpu, struct kmem_cache *s) { return false; }
+static inline void flush_this_cpu_slab(struct kmem_cache *s) { }
+#endif /* CONFIG_SLUB_TINY */
 
-	/*
-	 * The transaction ids are globally unique per cpu and per operation on
-	 * a per cpu queue. Thus they can be guarantee that the cmpxchg_double
-	 * occurs on the right processor and that there was no operation on the
-	 * linked list in between.
-	 */
+static bool has_pcs_used(int cpu, struct kmem_cache *s)
+{
+	struct slub_percpu_sheaves *pcs;
 
-	object = c->freelist;
-	slab = c->slab;
+	if (!s->cpu_sheaves)
+		return false;
 
-#ifdef CONFIG_NUMA
-	if (static_branch_unlikely(&strict_numa) &&
-			node == NUMA_NO_NODE) {
+	pcs = per_cpu_ptr(s->cpu_sheaves, cpu);
 
-		struct mempolicy *mpol = current->mempolicy;
+	return (pcs->spare || pcs->rcu_free || pcs->main->size);
+}
 
-		if (mpol) {
-			/*
-			 * Special BIND rule support. If existing slab
-			 * is in permitted set then do not redirect
-			 * to a particular node.
-			 * Otherwise we apply the memory policy to get
-			 * the node we need to allocate on.
-			 */
-			if (mpol->mode != MPOL_BIND || !slab ||
-					!node_isset(slab_nid(slab), mpol->nodes))
+/*
+ * Flush cpu slab.
+ *
+ * Called from CPU work handler with migration disabled.
+ */
+static void flush_cpu_slab(struct work_struct *w)
+{
+	struct kmem_cache *s;
+	struct slub_flush_work *sfw;
 
-				node = mempolicy_slab_node();
+	sfw = container_of(w, struct slub_flush_work, work);
+
+	s = sfw->s;
+
+	if (s->cpu_sheaves)
+		pcs_flush_all(s);
+
+	flush_this_cpu_slab(s);
+}
+
+static void flush_all_cpus_locked(struct kmem_cache *s)
+{
+	struct slub_flush_work *sfw;
+	unsigned int cpu;
+
+	lockdep_assert_cpus_held();
+	mutex_lock(&flush_lock);
+
+	for_each_online_cpu(cpu) {
+		sfw = &per_cpu(slub_flush, cpu);
+		if (!has_cpu_slab(cpu, s) && !has_pcs_used(cpu, s)) {
+			sfw->skip = true;
+			continue;
 		}
+		INIT_WORK(&sfw->work, flush_cpu_slab);
+		sfw->skip = false;
+		sfw->s = s;
+		queue_work_on(cpu, flushwq, &sfw->work);
 	}
-#endif
 
-	if (!USE_LOCKLESS_FAST_PATH() ||
-	    unlikely(!object || !slab || !node_match(slab, node))) {
-		object = __slab_alloc(s, gfpflags, node, addr, c, orig_size);
-	} else {
-		void *next_object = get_freepointer_safe(s, object);
+	for_each_online_cpu(cpu) {
+		sfw = &per_cpu(slub_flush, cpu);
+		if (sfw->skip)
+			continue;
+		flush_work(&sfw->work);
+	}
+
+	mutex_unlock(&flush_lock);
+}
+
+static void flush_all(struct kmem_cache *s)
+{
+	cpus_read_lock();
+	flush_all_cpus_locked(s);
+	cpus_read_unlock();
+}
+
+static void flush_rcu_sheaf(struct work_struct *w)
+{
+	struct slub_percpu_sheaves *pcs;
+	struct slab_sheaf *rcu_free;
+	struct slub_flush_work *sfw;
+	struct kmem_cache *s;
+
+	sfw = container_of(w, struct slub_flush_work, work);
+	s = sfw->s;
+
+	local_lock(&s->cpu_sheaves->lock);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+
+	rcu_free = pcs->rcu_free;
+	pcs->rcu_free = NULL;
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	if (rcu_free)
+		call_rcu(&rcu_free->rcu_head, rcu_free_sheaf_nobarn);
+}
+
+
+/* needed for kvfree_rcu_barrier() */
+void flush_all_rcu_sheaves(void)
+{
+	struct slub_flush_work *sfw;
+	struct kmem_cache *s;
+	unsigned int cpu;
+
+	cpus_read_lock();
+	mutex_lock(&slab_mutex);
+
+	list_for_each_entry(s, &slab_caches, list) {
+		if (!s->cpu_sheaves)
+			continue;
+
+		mutex_lock(&flush_lock);
+
+		for_each_online_cpu(cpu) {
+			sfw = &per_cpu(slub_flush, cpu);
+
+			/*
+			 * we don't check if rcu_free sheaf exists - racing
+			 * __kfree_rcu_sheaf() might have just removed it.
+			 * by executing flush_rcu_sheaf() on the cpu we make
+			 * sure the __kfree_rcu_sheaf() finished its call_rcu()
+			 */
+
+			INIT_WORK(&sfw->work, flush_rcu_sheaf);
+			sfw->s = s;
+			queue_work_on(cpu, flushwq, &sfw->work);
+		}
+
+		for_each_online_cpu(cpu) {
+			sfw = &per_cpu(slub_flush, cpu);
+			flush_work(&sfw->work);
+		}
+
+		mutex_unlock(&flush_lock);
+	}
+
+	mutex_unlock(&slab_mutex);
+	cpus_read_unlock();
+
+	rcu_barrier();
+}
+
+/*
+ * Use the cpu notifier to insure that the cpu slabs are flushed when
+ * necessary.
+ */
+static int slub_cpu_dead(unsigned int cpu)
+{
+	struct kmem_cache *s;
+
+	mutex_lock(&slab_mutex);
+	list_for_each_entry(s, &slab_caches, list) {
+		__flush_cpu_slab(s, cpu);
+		if (s->cpu_sheaves)
+			__pcs_flush_all_cpu(s, cpu);
+	}
+	mutex_unlock(&slab_mutex);
+	return 0;
+}
+
+/*
+ * Check if the objects in a per cpu structure fit numa
+ * locality expectations.
+ */
+static inline int node_match(struct slab *slab, int node)
+{
+#ifdef CONFIG_NUMA
+	if (node != NUMA_NO_NODE && slab_nid(slab) != node)
+		return 0;
+#endif
+	return 1;
+}
+
+#ifdef CONFIG_SLUB_DEBUG
+static int count_free(struct slab *slab)
+{
+	return slab->objects - slab->inuse;
+}
+
+static inline unsigned long node_nr_objs(struct kmem_cache_node *n)
+{
+	return atomic_long_read(&n->total_objects);
+}
+
+/* Supports checking bulk free of a constructed freelist */
+static inline bool free_debug_processing(struct kmem_cache *s,
+	struct slab *slab, void *head, void *tail, int *bulk_cnt,
+	unsigned long addr, depot_stack_handle_t handle)
+{
+	bool checks_ok = false;
+	void *object = head;
+	int cnt = 0;
+
+	if (s->flags & SLAB_CONSISTENCY_CHECKS) {
+		if (!check_slab(s, slab))
+			goto out;
+	}
+
+	if (slab->inuse < *bulk_cnt) {
+		slab_err(s, slab, "Slab has %d allocated objects but %d are to be freed\n",
+			 slab->inuse, *bulk_cnt);
+		goto out;
+	}
+
+next_object:
+
+	if (++cnt > *bulk_cnt)
+		goto out_cnt;
+
+	if (s->flags & SLAB_CONSISTENCY_CHECKS) {
+		if (!free_consistency_checks(s, slab, object, addr))
+			goto out;
+	}
+
+	if (s->flags & SLAB_STORE_USER)
+		set_track_update(s, object, TRACK_FREE, addr, handle);
+	trace(s, slab, object, 0);
+	/* Freepointer not overwritten by init_object(), SLAB_POISON moved it */
+	init_object(s, object, SLUB_RED_INACTIVE);
+
+	/* Reached end of constructed freelist yet? */
+	if (object != tail) {
+		object = get_freepointer(s, object);
+		goto next_object;
+	}
+	checks_ok = true;
+
+out_cnt:
+	if (cnt != *bulk_cnt) {
+		slab_err(s, slab, "Bulk free expected %d objects but found %d\n",
+			 *bulk_cnt, cnt);
+		*bulk_cnt = cnt;
+	}
+
+out:
+
+	if (!checks_ok)
+		slab_fix(s, "Object at 0x%p not freed", object);
+
+	return checks_ok;
+}
+#endif /* CONFIG_SLUB_DEBUG */
+
+#if defined(CONFIG_SLUB_DEBUG) || defined(SLAB_SUPPORTS_SYSFS)
+static unsigned long count_partial(struct kmem_cache_node *n,
+					int (*get_count)(struct slab *))
+{
+	unsigned long flags;
+	unsigned long x = 0;
+	struct slab *slab;
+
+	spin_lock_irqsave(&n->list_lock, flags);
+	list_for_each_entry(slab, &n->partial, slab_list)
+		x += get_count(slab);
+	spin_unlock_irqrestore(&n->list_lock, flags);
+	return x;
+}
+#endif /* CONFIG_SLUB_DEBUG || SLAB_SUPPORTS_SYSFS */
+
+#ifdef CONFIG_SLUB_DEBUG
+#define MAX_PARTIAL_TO_SCAN 10000
+
+static unsigned long count_partial_free_approx(struct kmem_cache_node *n)
+{
+	unsigned long flags;
+	unsigned long x = 0;
+	struct slab *slab;
+
+	spin_lock_irqsave(&n->list_lock, flags);
+	if (n->nr_partial <= MAX_PARTIAL_TO_SCAN) {
+		list_for_each_entry(slab, &n->partial, slab_list)
+			x += slab->objects - slab->inuse;
+	} else {
+		/*
+		 * For a long list, approximate the total count of objects in
+		 * it to meet the limit on the number of slabs to scan.
+		 * Scan from both the list's head and tail for better accuracy.
+		 */
+		unsigned long scanned = 0;
+
+		list_for_each_entry(slab, &n->partial, slab_list) {
+			x += slab->objects - slab->inuse;
+			if (++scanned == MAX_PARTIAL_TO_SCAN / 2)
+				break;
+		}
+		list_for_each_entry_reverse(slab, &n->partial, slab_list) {
+			x += slab->objects - slab->inuse;
+			if (++scanned == MAX_PARTIAL_TO_SCAN)
+				break;
+		}
+		x = mult_frac(x, n->nr_partial, scanned);
+		x = min(x, node_nr_objs(n));
+	}
+	spin_unlock_irqrestore(&n->list_lock, flags);
+	return x;
+}
+
+static noinline void
+slab_out_of_memory(struct kmem_cache *s, gfp_t gfpflags, int nid)
+{
+	static DEFINE_RATELIMIT_STATE(slub_oom_rs, DEFAULT_RATELIMIT_INTERVAL,
+				      DEFAULT_RATELIMIT_BURST);
+	int cpu = raw_smp_processor_id();
+	int node;
+	struct kmem_cache_node *n;
+
+	if ((gfpflags & __GFP_NOWARN) || !__ratelimit(&slub_oom_rs))
+		return;
+
+	pr_warn("SLUB: Unable to allocate memory on CPU %u (of node %d) on node %d, gfp=%#x(%pGg)\n",
+		cpu, cpu_to_node(cpu), nid, gfpflags, &gfpflags);
+	pr_warn("  cache: %s, object size: %u, buffer size: %u, default order: %u, min order: %u\n",
+		s->name, s->object_size, s->size, oo_order(s->oo),
+		oo_order(s->min));
+
+	if (oo_order(s->min) > get_order(s->object_size))
+		pr_warn("  %s debugging increased min order, use slab_debug=O to disable.\n",
+			s->name);
+
+	for_each_kmem_cache_node(s, node, n) {
+		unsigned long nr_slabs;
+		unsigned long nr_objs;
+		unsigned long nr_free;
+
+		nr_free  = count_partial_free_approx(n);
+		nr_slabs = node_nr_slabs(n);
+		nr_objs  = node_nr_objs(n);
+
+		pr_warn("  node %d: slabs: %ld, objs: %ld, free: %ld\n",
+			node, nr_slabs, nr_objs, nr_free);
+	}
+}
+#else /* CONFIG_SLUB_DEBUG */
+static inline void
+slab_out_of_memory(struct kmem_cache *s, gfp_t gfpflags, int nid) { }
+#endif
+
+static inline bool pfmemalloc_match(struct slab *slab, gfp_t gfpflags)
+{
+	if (unlikely(slab_test_pfmemalloc(slab)))
+		return gfp_pfmemalloc_allowed(gfpflags);
+
+	return true;
+}
+
+#ifndef CONFIG_SLUB_TINY
+static inline bool
+__update_cpu_freelist_fast(struct kmem_cache *s,
+			   void *freelist_old, void *freelist_new,
+			   unsigned long tid)
+{
+	freelist_aba_t old = { .freelist = freelist_old, .counter = tid };
+	freelist_aba_t new = { .freelist = freelist_new, .counter = next_tid(tid) };
+
+	return this_cpu_try_cmpxchg_freelist(s->cpu_slab->freelist_tid.full,
+					     &old.full, new.full);
+}
+
+/*
+ * Check the slab->freelist and either transfer the freelist to the
+ * per cpu freelist or deactivate the slab.
+ *
+ * The slab is still frozen if the return value is not NULL.
+ *
+ * If this function returns NULL then the slab has been unfrozen.
+ */
+static inline void *get_freelist(struct kmem_cache *s, struct slab *slab)
+{
+	struct slab new;
+	unsigned long counters;
+	void *freelist;
+
+	lockdep_assert_held(this_cpu_ptr(&s->cpu_slab->lock));
+
+	do {
+		freelist = slab->freelist;
+		counters = slab->counters;
+
+		new.counters = counters;
+
+		new.inuse = slab->objects;
+		new.frozen = freelist != NULL;
+
+	} while (!__slab_update_freelist(s, slab,
+		freelist, counters,
+		NULL, new.counters,
+		"get_freelist"));
+
+	return freelist;
+}
+
+/*
+ * Freeze the partial slab and return the pointer to the freelist.
+ */
+static inline void *freeze_slab(struct kmem_cache *s, struct slab *slab)
+{
+	struct slab new;
+	unsigned long counters;
+	void *freelist;
+
+	do {
+		freelist = slab->freelist;
+		counters = slab->counters;
+
+		new.counters = counters;
+		VM_BUG_ON(new.frozen);
+
+		new.inuse = slab->objects;
+		new.frozen = 1;
+
+	} while (!slab_update_freelist(s, slab,
+		freelist, counters,
+		NULL, new.counters,
+		"freeze_slab"));
+
+	return freelist;
+}
+
+/*
+ * Slow path. The lockless freelist is empty or we need to perform
+ * debugging duties.
+ *
+ * Processing is still very fast if new objects have been freed to the
+ * regular freelist. In that case we simply take over the regular freelist
+ * as the lockless freelist and zap the regular freelist.
+ *
+ * If that is not working then we fall back to the partial lists. We take the
+ * first element of the freelist as the object to allocate now and move the
+ * rest of the freelist to the lockless freelist.
+ *
+ * And if we were unable to get a new slab from the partial slab lists then
+ * we need to allocate a new slab. This is the slowest path since it involves
+ * a call to the page allocator and the setup of a new slab.
+ *
+ * Version of __slab_alloc to use when we know that preemption is
+ * already disabled (which is the case for bulk allocation).
+ */
+static void *___slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,
+			  unsigned long addr, struct kmem_cache_cpu *c, unsigned int orig_size)
+{
+	bool allow_spin = gfpflags_allow_spinning(gfpflags);
+	void *freelist;
+	struct slab *slab;
+	unsigned long flags;
+	struct partial_context pc;
+	bool try_thisnode = true;
+
+	stat(s, ALLOC_SLOWPATH);
+
+reread_slab:
+
+	slab = READ_ONCE(c->slab);
+	if (!slab) {
+		/*
+		 * if the node is not online or has no normal memory, just
+		 * ignore the node constraint
+		 */
+		if (unlikely(node != NUMA_NO_NODE &&
+			     !node_isset(node, slab_nodes)))
+			node = NUMA_NO_NODE;
+		goto new_slab;
+	}
+
+	if (unlikely(!node_match(slab, node))) {
+		/*
+		 * same as above but node_match() being false already
+		 * implies node != NUMA_NO_NODE.
+		 *
+		 * We don't strictly honor pfmemalloc and NUMA preferences
+		 * when !allow_spin because:
+		 *
+		 * 1. Most kmalloc() users allocate objects on the local node,
+		 *    so kmalloc_nolock() tries not to interfere with them by
+		 *    deactivating the cpu slab.
+		 *
+		 * 2. Deactivating due to NUMA or pfmemalloc mismatch may cause
+		 *    unnecessary slab allocations even when n->partial list
+		 *    is not empty.
+		 */
+		if (!node_isset(node, slab_nodes) ||
+		    !allow_spin) {
+			node = NUMA_NO_NODE;
+		} else {
+			stat(s, ALLOC_NODE_MISMATCH);
+			goto deactivate_slab;
+		}
+	}
+
+	/*
+	 * By rights, we should be searching for a slab page that was
+	 * PFMEMALLOC but right now, we are losing the pfmemalloc
+	 * information when the page leaves the per-cpu allocator
+	 */
+	if (unlikely(!pfmemalloc_match(slab, gfpflags) && allow_spin))
+		goto deactivate_slab;
+
+	/* must check again c->slab in case we got preempted and it changed */
+	local_lock_cpu_slab(s, flags);
+
+	if (unlikely(slab != c->slab)) {
+		local_unlock_cpu_slab(s, flags);
+		goto reread_slab;
+	}
+	freelist = c->freelist;
+	if (freelist)
+		goto load_freelist;
+
+	freelist = get_freelist(s, slab);
+
+	if (!freelist) {
+		c->slab = NULL;
+		c->tid = next_tid(c->tid);
+		local_unlock_cpu_slab(s, flags);
+		stat(s, DEACTIVATE_BYPASS);
+		goto new_slab;
+	}
+
+	stat(s, ALLOC_REFILL);
+
+load_freelist:
+
+	lockdep_assert_held(this_cpu_ptr(&s->cpu_slab->lock));
+
+	/*
+	 * freelist is pointing to the list of objects to be used.
+	 * slab is pointing to the slab from which the objects are obtained.
+	 * That slab must be frozen for per cpu allocations to work.
+	 */
+	VM_BUG_ON(!c->slab->frozen);
+	c->freelist = get_freepointer(s, freelist);
+	c->tid = next_tid(c->tid);
+	local_unlock_cpu_slab(s, flags);
+	return freelist;
+
+deactivate_slab:
+
+	local_lock_cpu_slab(s, flags);
+	if (slab != c->slab) {
+		local_unlock_cpu_slab(s, flags);
+		goto reread_slab;
+	}
+	freelist = c->freelist;
+	c->slab = NULL;
+	c->freelist = NULL;
+	c->tid = next_tid(c->tid);
+	local_unlock_cpu_slab(s, flags);
+	deactivate_slab(s, slab, freelist);
+
+new_slab:
+
+#ifdef CONFIG_SLUB_CPU_PARTIAL
+	while (slub_percpu_partial(c)) {
+		local_lock_cpu_slab(s, flags);
+		if (unlikely(c->slab)) {
+			local_unlock_cpu_slab(s, flags);
+			goto reread_slab;
+		}
+		if (unlikely(!slub_percpu_partial(c))) {
+			local_unlock_cpu_slab(s, flags);
+			/* we were preempted and partial list got empty */
+			goto new_objects;
+		}
+
+		slab = slub_percpu_partial(c);
+		slub_set_percpu_partial(c, slab);
+
+		if (likely(node_match(slab, node) &&
+			   pfmemalloc_match(slab, gfpflags)) ||
+		    !allow_spin) {
+			c->slab = slab;
+			freelist = get_freelist(s, slab);
+			VM_BUG_ON(!freelist);
+			stat(s, CPU_PARTIAL_ALLOC);
+			goto load_freelist;
+		}
+
+		local_unlock_cpu_slab(s, flags);
+
+		slab->next = NULL;
+		__put_partials(s, slab);
+	}
+#endif
+
+new_objects:
+
+	pc.flags = gfpflags;
+	/*
+	 * When a preferred node is indicated but no __GFP_THISNODE
+	 *
+	 * 1) try to get a partial slab from target node only by having
+	 *    __GFP_THISNODE in pc.flags for get_partial()
+	 * 2) if 1) failed, try to allocate a new slab from target node with
+	 *    GPF_NOWAIT | __GFP_THISNODE opportunistically
+	 * 3) if 2) failed, retry with original gfpflags which will allow
+	 *    get_partial() try partial lists of other nodes before potentially
+	 *    allocating new page from other nodes
+	 */
+	if (unlikely(node != NUMA_NO_NODE && !(gfpflags & __GFP_THISNODE)
+		     && try_thisnode)) {
+		if (unlikely(!allow_spin))
+			/* Do not upgrade gfp to NOWAIT from more restrictive mode */
+			pc.flags = gfpflags | __GFP_THISNODE;
+		else
+			pc.flags = GFP_NOWAIT | __GFP_THISNODE;
+	}
+
+	pc.orig_size = orig_size;
+	slab = get_partial(s, node, &pc);
+	if (slab) {
+		if (kmem_cache_debug(s)) {
+			freelist = pc.object;
+			/*
+			 * For debug caches here we had to go through
+			 * alloc_single_from_partial() so just store the
+			 * tracking info and return the object.
+			 *
+			 * Due to disabled preemption we need to disallow
+			 * blocking. The flags are further adjusted by
+			 * gfp_nested_mask() in stack_depot itself.
+			 */
+			if (s->flags & SLAB_STORE_USER)
+				set_track(s, freelist, TRACK_ALLOC, addr,
+					  gfpflags & ~(__GFP_DIRECT_RECLAIM));
+
+			return freelist;
+		}
+
+		freelist = freeze_slab(s, slab);
+		goto retry_load_slab;
+	}
+
+	slub_put_cpu_ptr(s->cpu_slab);
+	slab = new_slab(s, pc.flags, node);
+	c = slub_get_cpu_ptr(s->cpu_slab);
+
+	if (unlikely(!slab)) {
+		if (node != NUMA_NO_NODE && !(gfpflags & __GFP_THISNODE)
+		    && try_thisnode) {
+			try_thisnode = false;
+			goto new_objects;
+		}
+		slab_out_of_memory(s, gfpflags, node);
+		return NULL;
+	}
+
+	stat(s, ALLOC_SLAB);
+
+	if (kmem_cache_debug(s)) {
+		freelist = alloc_single_from_new_slab(s, slab, orig_size, gfpflags);
+
+		if (unlikely(!freelist))
+			goto new_objects;
+
+		if (s->flags & SLAB_STORE_USER)
+			set_track(s, freelist, TRACK_ALLOC, addr,
+				  gfpflags & ~(__GFP_DIRECT_RECLAIM));
+
+		return freelist;
+	}
+
+	/*
+	 * No other reference to the slab yet so we can
+	 * muck around with it freely without cmpxchg
+	 */
+	freelist = slab->freelist;
+	slab->freelist = NULL;
+	slab->inuse = slab->objects;
+	slab->frozen = 1;
+
+	inc_slabs_node(s, slab_nid(slab), slab->objects);
+
+	if (unlikely(!pfmemalloc_match(slab, gfpflags) && allow_spin)) {
+		/*
+		 * For !pfmemalloc_match() case we don't load freelist so that
+		 * we don't make further mismatched allocations easier.
+		 */
+		deactivate_slab(s, slab, get_freepointer(s, freelist));
+		return freelist;
+	}
+
+retry_load_slab:
+
+	local_lock_cpu_slab(s, flags);
+	if (unlikely(c->slab)) {
+		void *flush_freelist = c->freelist;
+		struct slab *flush_slab = c->slab;
+
+		c->slab = NULL;
+		c->freelist = NULL;
+		c->tid = next_tid(c->tid);
+
+		local_unlock_cpu_slab(s, flags);
+
+		if (unlikely(!allow_spin)) {
+			/* Reentrant slub cannot take locks, defer */
+			defer_deactivate_slab(flush_slab, flush_freelist);
+		} else {
+			deactivate_slab(s, flush_slab, flush_freelist);
+		}
+
+		stat(s, CPUSLAB_FLUSH);
+
+		goto retry_load_slab;
+	}
+	c->slab = slab;
+
+	goto load_freelist;
+}
+/*
+ * We disallow kprobes in ___slab_alloc() to prevent reentrance
+ *
+ * kmalloc() -> ___slab_alloc() -> local_lock_cpu_slab() protected part of
+ * ___slab_alloc() manipulating c->freelist -> kprobe -> bpf ->
+ * kmalloc_nolock() or kfree_nolock() -> __update_cpu_freelist_fast()
+ * manipulating c->freelist without lock.
+ *
+ * This does not prevent kprobe in functions called from ___slab_alloc() such as
+ * local_lock_irqsave() itself, and that is fine, we only need to protect the
+ * c->freelist manipulation in ___slab_alloc() itself.
+ */
+NOKPROBE_SYMBOL(___slab_alloc);
+
+/*
+ * A wrapper for ___slab_alloc() for contexts where preemption is not yet
+ * disabled. Compensates for possible cpu changes by refetching the per cpu area
+ * pointer.
+ */
+static void *__slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,
+			  unsigned long addr, struct kmem_cache_cpu *c, unsigned int orig_size)
+{
+	void *p;
+
+#ifdef CONFIG_PREEMPT_COUNT
+	/*
+	 * We may have been preempted and rescheduled on a different
+	 * cpu before disabling preemption. Need to reload cpu area
+	 * pointer.
+	 */
+	c = slub_get_cpu_ptr(s->cpu_slab);
+#endif
+	if (unlikely(!gfpflags_allow_spinning(gfpflags))) {
+		if (local_lock_is_locked(&s->cpu_slab->lock)) {
+			/*
+			 * EBUSY is an internal signal to kmalloc_nolock() to
+			 * retry a different bucket. It's not propagated
+			 * to the caller.
+			 */
+			p = ERR_PTR(-EBUSY);
+			goto out;
+		}
+	}
+	p = ___slab_alloc(s, gfpflags, node, addr, c, orig_size);
+out:
+#ifdef CONFIG_PREEMPT_COUNT
+	slub_put_cpu_ptr(s->cpu_slab);
+#endif
+	return p;
+}
+
+static __always_inline void *__slab_alloc_node(struct kmem_cache *s,
+		gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)
+{
+	struct kmem_cache_cpu *c;
+	struct slab *slab;
+	unsigned long tid;
+	void *object;
+
+redo:
+	/*
+	 * Must read kmem_cache cpu data via this cpu ptr. Preemption is
+	 * enabled. We may switch back and forth between cpus while
+	 * reading from one cpu area. That does not matter as long
+	 * as we end up on the original cpu again when doing the cmpxchg.
+	 *
+	 * We must guarantee that tid and kmem_cache_cpu are retrieved on the
+	 * same cpu. We read first the kmem_cache_cpu pointer and use it to read
+	 * the tid. If we are preempted and switched to another cpu between the
+	 * two reads, it's OK as the two are still associated with the same cpu
+	 * and cmpxchg later will validate the cpu.
+	 */
+	c = raw_cpu_ptr(s->cpu_slab);
+	tid = READ_ONCE(c->tid);
+
+	/*
+	 * Irqless object alloc/free algorithm used here depends on sequence
+	 * of fetching cpu_slab's data. tid should be fetched before anything
+	 * on c to guarantee that object and slab associated with previous tid
+	 * won't be used with current tid. If we fetch tid first, object and
+	 * slab could be one associated with next tid and our alloc/free
+	 * request will be failed. In this case, we will retry. So, no problem.
+	 */
+	barrier();
+
+	/*
+	 * The transaction ids are globally unique per cpu and per operation on
+	 * a per cpu queue. Thus they can be guarantee that the cmpxchg_double
+	 * occurs on the right processor and that there was no operation on the
+	 * linked list in between.
+	 */
+
+	object = c->freelist;
+	slab = c->slab;
+
+#ifdef CONFIG_NUMA
+	if (static_branch_unlikely(&strict_numa) &&
+			node == NUMA_NO_NODE) {
+
+		struct mempolicy *mpol = current->mempolicy;
+
+		if (mpol) {
+			/*
+			 * Special BIND rule support. If existing slab
+			 * is in permitted set then do not redirect
+			 * to a particular node.
+			 * Otherwise we apply the memory policy to get
+			 * the node we need to allocate on.
+			 */
+			if (mpol->mode != MPOL_BIND || !slab ||
+					!node_isset(slab_nid(slab), mpol->nodes))
+
+				node = mempolicy_slab_node();
+		}
+	}
+#endif
+
+	if (!USE_LOCKLESS_FAST_PATH() ||
+	    unlikely(!object || !slab || !node_match(slab, node))) {
+		object = __slab_alloc(s, gfpflags, node, addr, c, orig_size);
+	} else {
+		void *next_object = get_freepointer_safe(s, object);
+
+		/*
+		 * The cmpxchg will only match if there was no additional
+		 * operation and if we are on the right processor.
+		 *
+		 * The cmpxchg does the following atomically (without lock
+		 * semantics!)
+		 * 1. Relocate first pointer to the current per cpu area.
+		 * 2. Verify that tid and freelist have not been changed
+		 * 3. If they were not changed replace tid and freelist
+		 *
+		 * Since this is without lock semantics the protection is only
+		 * against code executing on this cpu *not* from access by
+		 * other cpus.
+		 */
+		if (unlikely(!__update_cpu_freelist_fast(s, object, next_object, tid))) {
+			note_cmpxchg_failure("slab_alloc", s, tid);
+			goto redo;
+		}
+		prefetch_freepointer(s, next_object);
+		stat(s, ALLOC_FASTPATH);
+	}
+
+	return object;
+}
+#else /* CONFIG_SLUB_TINY */
+static void *__slab_alloc_node(struct kmem_cache *s,
+		gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)
+{
+	struct partial_context pc;
+	struct slab *slab;
+	void *object;
+
+	pc.flags = gfpflags;
+	pc.orig_size = orig_size;
+	slab = get_partial(s, node, &pc);
+
+	if (slab)
+		return pc.object;
+
+	slab = new_slab(s, gfpflags, node);
+	if (unlikely(!slab)) {
+		slab_out_of_memory(s, gfpflags, node);
+		return NULL;
+	}
+
+	object = alloc_single_from_new_slab(s, slab, orig_size, gfpflags);
+
+	return object;
+}
+#endif /* CONFIG_SLUB_TINY */
+
+/*
+ * If the object has been wiped upon free, make sure it's fully initialized by
+ * zeroing out freelist pointer.
+ *
+ * Note that we also wipe custom freelist pointers.
+ */
+static __always_inline void maybe_wipe_obj_freeptr(struct kmem_cache *s,
+						   void *obj)
+{
+	if (unlikely(slab_want_init_on_free(s)) && obj &&
+	    !freeptr_outside_object(s))
+		memset((void *)((char *)kasan_reset_tag(obj) + s->offset),
+			0, sizeof(void *));
+}
+
+static __fastpath_inline
+struct kmem_cache *slab_pre_alloc_hook(struct kmem_cache *s, gfp_t flags)
+{
+	flags &= gfp_allowed_mask;
+
+	might_alloc(flags);
+
+	if (unlikely(should_failslab(s, flags)))
+		return NULL;
+
+	return s;
+}
+
+static __fastpath_inline
+bool slab_post_alloc_hook(struct kmem_cache *s, struct list_lru *lru,
+			  gfp_t flags, size_t size, void **p, bool init,
+			  unsigned int orig_size)
+{
+	unsigned int zero_size = s->object_size;
+	bool kasan_init = init;
+	size_t i;
+	gfp_t init_flags = flags & gfp_allowed_mask;
+
+	/*
+	 * For kmalloc object, the allocated memory size(object_size) is likely
+	 * larger than the requested size(orig_size). If redzone check is
+	 * enabled for the extra space, don't zero it, as it will be redzoned
+	 * soon. The redzone operation for this extra space could be seen as a
+	 * replacement of current poisoning under certain debug option, and
+	 * won't break other sanity checks.
+	 */
+	if (kmem_cache_debug_flags(s, SLAB_STORE_USER | SLAB_RED_ZONE) &&
+	    (s->flags & SLAB_KMALLOC))
+		zero_size = orig_size;
+
+	/*
+	 * When slab_debug is enabled, avoid memory initialization integrated
+	 * into KASAN and instead zero out the memory via the memset below with
+	 * the proper size. Otherwise, KASAN might overwrite SLUB redzones and
+	 * cause false-positive reports. This does not lead to a performance
+	 * penalty on production builds, as slab_debug is not intended to be
+	 * enabled there.
+	 */
+	if (__slub_debug_enabled())
+		kasan_init = false;
+
+	/*
+	 * As memory initialization might be integrated into KASAN,
+	 * kasan_slab_alloc and initialization memset must be
+	 * kept together to avoid discrepancies in behavior.
+	 *
+	 * As p[i] might get tagged, memset and kmemleak hook come after KASAN.
+	 */
+	for (i = 0; i < size; i++) {
+		p[i] = kasan_slab_alloc(s, p[i], init_flags, kasan_init);
+		if (p[i] && init && (!kasan_init ||
+				     !kasan_has_integrated_init()))
+			memset(p[i], 0, zero_size);
+		if (gfpflags_allow_spinning(flags))
+			kmemleak_alloc_recursive(p[i], s->object_size, 1,
+						 s->flags, init_flags);
+		kmsan_slab_alloc(s, p[i], init_flags);
+		alloc_tagging_slab_alloc_hook(s, p[i], flags);
+	}
+
+	return memcg_slab_post_alloc_hook(s, lru, flags, size, p);
+}
+
+/*
+ * Replace the empty main sheaf with a (at least partially) full sheaf.
+ *
+ * Must be called with the cpu_sheaves local lock locked. If successful, returns
+ * the pcs pointer and the local lock locked (possibly on a different cpu than
+ * initially called). If not successful, returns NULL and the local lock
+ * unlocked.
+ */
+static struct slub_percpu_sheaves *
+__pcs_replace_empty_main(struct kmem_cache *s, struct slub_percpu_sheaves *pcs, gfp_t gfp)
+{
+	struct slab_sheaf *empty = NULL;
+	struct slab_sheaf *full;
+	struct node_barn *barn;
+	bool can_alloc;
+
+	lockdep_assert_held(this_cpu_ptr(&s->cpu_sheaves->lock));
+
+	if (pcs->spare && pcs->spare->size > 0) {
+		swap(pcs->main, pcs->spare);
+		return pcs;
+	}
+
+	barn = get_barn(s);
+
+	full = barn_replace_empty_sheaf(barn, pcs->main);
+
+	if (full) {
+		stat(s, BARN_GET);
+		pcs->main = full;
+		return pcs;
+	}
+
+	stat(s, BARN_GET_FAIL);
+
+	can_alloc = gfpflags_allow_blocking(gfp);
+
+	if (can_alloc) {
+		if (pcs->spare) {
+			empty = pcs->spare;
+			pcs->spare = NULL;
+		} else {
+			empty = barn_get_empty_sheaf(barn);
+		}
+	}
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	if (!can_alloc)
+		return NULL;
+
+	if (empty) {
+		if (!refill_sheaf(s, empty, gfp)) {
+			full = empty;
+		} else {
+			/*
+			 * we must be very low on memory so don't bother
+			 * with the barn
+			 */
+			free_empty_sheaf(s, empty);
+		}
+	} else {
+		full = alloc_full_sheaf(s, gfp);
+	}
+
+	if (!full)
+		return NULL;
+
+	/*
+	 * we can reach here only when gfpflags_allow_blocking
+	 * so this must not be an irq
+	 */
+	local_lock(&s->cpu_sheaves->lock);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+
+	/*
+	 * If we are returning empty sheaf, we either got it from the
+	 * barn or had to allocate one. If we are returning a full
+	 * sheaf, it's due to racing or being migrated to a different
+	 * cpu. Breaching the barn's sheaf limits should be thus rare
+	 * enough so just ignore them to simplify the recovery.
+	 */
+
+	if (pcs->main->size == 0) {
+		barn_put_empty_sheaf(barn, pcs->main);
+		pcs->main = full;
+		return pcs;
+	}
+
+	if (!pcs->spare) {
+		pcs->spare = full;
+		return pcs;
+	}
+
+	if (pcs->spare->size == 0) {
+		barn_put_empty_sheaf(barn, pcs->spare);
+		pcs->spare = full;
+		return pcs;
+	}
+
+	barn_put_full_sheaf(barn, full);
+	stat(s, BARN_PUT);
+
+	return pcs;
+}
+
+static __fastpath_inline
+void *alloc_from_pcs(struct kmem_cache *s, gfp_t gfp, int node)
+{
+	struct slub_percpu_sheaves *pcs;
+	bool node_requested;
+	void *object;
+
+#ifdef CONFIG_NUMA
+	if (static_branch_unlikely(&strict_numa) &&
+			 node == NUMA_NO_NODE) {
+
+		struct mempolicy *mpol = current->mempolicy;
+
+		if (mpol) {
+			/*
+			 * Special BIND rule support. If the local node
+			 * is in permitted set then do not redirect
+			 * to a particular node.
+			 * Otherwise we apply the memory policy to get
+			 * the node we need to allocate on.
+			 */
+			if (mpol->mode != MPOL_BIND ||
+					!node_isset(numa_mem_id(), mpol->nodes))
+
+				node = mempolicy_slab_node();
+		}
+	}
+#endif
+
+	node_requested = IS_ENABLED(CONFIG_NUMA) && node != NUMA_NO_NODE;
+
+	/*
+	 * We assume the percpu sheaves contain only local objects although it's
+	 * not completely guaranteed, so we verify later.
+	 */
+	if (unlikely(node_requested && node != numa_mem_id()))
+		return NULL;
+
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		return NULL;
+
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+
+	if (unlikely(pcs->main->size == 0)) {
+		pcs = __pcs_replace_empty_main(s, pcs, gfp);
+		if (unlikely(!pcs))
+			return NULL;
+	}
+
+	object = pcs->main->objects[pcs->main->size - 1];
+
+	if (unlikely(node_requested)) {
+		/*
+		 * Verify that the object was from the node we want. This could
+		 * be false because of cpu migration during an unlocked part of
+		 * the current allocation or previous freeing process.
+		 */
+		if (folio_nid(virt_to_folio(object)) != node) {
+			local_unlock(&s->cpu_sheaves->lock);
+			return NULL;
+		}
+	}
+
+	pcs->main->size--;
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	stat(s, ALLOC_PCS);
+
+	return object;
+}
+
+static __fastpath_inline
+unsigned int alloc_from_pcs_bulk(struct kmem_cache *s, size_t size, void **p)
+{
+	struct slub_percpu_sheaves *pcs;
+	struct slab_sheaf *main;
+	unsigned int allocated = 0;
+	unsigned int batch;
+
+next_batch:
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		return allocated;
+
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+
+	if (unlikely(pcs->main->size == 0)) {
+
+		struct slab_sheaf *full;
+
+		if (pcs->spare && pcs->spare->size > 0) {
+			swap(pcs->main, pcs->spare);
+			goto do_alloc;
+		}
+
+		full = barn_replace_empty_sheaf(get_barn(s), pcs->main);
+
+		if (full) {
+			stat(s, BARN_GET);
+			pcs->main = full;
+			goto do_alloc;
+		}
+
+		stat(s, BARN_GET_FAIL);
+
+		local_unlock(&s->cpu_sheaves->lock);
+
+		/*
+		 * Once full sheaves in barn are depleted, let the bulk
+		 * allocation continue from slab pages, otherwise we would just
+		 * be copying arrays of pointers twice.
+		 */
+		return allocated;
+	}
+
+do_alloc:
+
+	main = pcs->main;
+	batch = min(size, main->size);
+
+	main->size -= batch;
+	memcpy(p, main->objects + main->size, batch * sizeof(void *));
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	stat_add(s, ALLOC_PCS, batch);
+
+	allocated += batch;
+
+	if (batch < size) {
+		p += batch;
+		size -= batch;
+		goto next_batch;
+	}
+
+	return allocated;
+}
+
+
+/*
+ * Inlined fastpath so that allocation functions (kmalloc, kmem_cache_alloc)
+ * have the fastpath folded into their functions. So no function call
+ * overhead for requests that can be satisfied on the fastpath.
+ *
+ * The fastpath works by first checking if the lockless freelist can be used.
+ * If not then __slab_alloc is called for slow processing.
+ *
+ * Otherwise we can simply pick the next object from the lockless free list.
+ */
+static __fastpath_inline void *slab_alloc_node(struct kmem_cache *s, struct list_lru *lru,
+		gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)
+{
+	void *object;
+	bool init = false;
+
+	s = slab_pre_alloc_hook(s, gfpflags);
+	if (unlikely(!s))
+		return NULL;
+
+	object = kfence_alloc(s, orig_size, gfpflags);
+	if (unlikely(object))
+		goto out;
+
+	if (s->cpu_sheaves)
+		object = alloc_from_pcs(s, gfpflags, node);
+
+	if (!object)
+		object = __slab_alloc_node(s, gfpflags, node, addr, orig_size);
+
+	maybe_wipe_obj_freeptr(s, object);
+	init = slab_want_init_on_alloc(gfpflags, s);
+
+out:
+	/*
+	 * When init equals 'true', like for kzalloc() family, only
+	 * @orig_size bytes might be zeroed instead of s->object_size
+	 * In case this fails due to memcg_slab_post_alloc_hook(),
+	 * object is set to NULL
+	 */
+	slab_post_alloc_hook(s, lru, gfpflags, 1, &object, init, orig_size);
+
+	return object;
+}
+
+void *kmem_cache_alloc_noprof(struct kmem_cache *s, gfp_t gfpflags)
+{
+	void *ret = slab_alloc_node(s, NULL, gfpflags, NUMA_NO_NODE, _RET_IP_,
+				    s->object_size);
+
+	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfpflags, NUMA_NO_NODE);
+
+	return ret;
+}
+EXPORT_SYMBOL(kmem_cache_alloc_noprof);
+
+void *kmem_cache_alloc_lru_noprof(struct kmem_cache *s, struct list_lru *lru,
+			   gfp_t gfpflags)
+{
+	void *ret = slab_alloc_node(s, lru, gfpflags, NUMA_NO_NODE, _RET_IP_,
+				    s->object_size);
+
+	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfpflags, NUMA_NO_NODE);
+
+	return ret;
+}
+EXPORT_SYMBOL(kmem_cache_alloc_lru_noprof);
+
+bool kmem_cache_charge(void *objp, gfp_t gfpflags)
+{
+	if (!memcg_kmem_online())
+		return true;
+
+	return memcg_slab_post_charge(objp, gfpflags);
+}
+EXPORT_SYMBOL(kmem_cache_charge);
+
+/**
+ * kmem_cache_alloc_node - Allocate an object on the specified node
+ * @s: The cache to allocate from.
+ * @gfpflags: See kmalloc().
+ * @node: node number of the target node.
+ *
+ * Identical to kmem_cache_alloc but it will allocate memory on the given
+ * node, which can improve the performance for cpu bound structures.
+ *
+ * Fallback to other node is possible if __GFP_THISNODE is not set.
+ *
+ * Return: pointer to the new object or %NULL in case of error
+ */
+void *kmem_cache_alloc_node_noprof(struct kmem_cache *s, gfp_t gfpflags, int node)
+{
+	void *ret = slab_alloc_node(s, NULL, gfpflags, node, _RET_IP_, s->object_size);
+
+	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfpflags, node);
+
+	return ret;
+}
+EXPORT_SYMBOL(kmem_cache_alloc_node_noprof);
+
+/*
+ * returns a sheaf that has at least the requested size
+ * when prefilling is needed, do so with given gfp flags
+ *
+ * return NULL if sheaf allocation or prefilling failed
+ */
+struct slab_sheaf *
+kmem_cache_prefill_sheaf(struct kmem_cache *s, gfp_t gfp, unsigned int size)
+{
+	struct slub_percpu_sheaves *pcs;
+	struct slab_sheaf *sheaf = NULL;
+
+	if (unlikely(size > s->sheaf_capacity)) {
+
+		/*
+		 * slab_debug disables cpu sheaves intentionally so all
+		 * prefilled sheaves become "oversize" and we give up on
+		 * performance for the debugging. Same with SLUB_TINY.
+		 * Creating a cache without sheaves and then requesting a
+		 * prefilled sheaf is however not expected, so warn.
+		 */
+		WARN_ON_ONCE(s->sheaf_capacity == 0 &&
+			     !IS_ENABLED(CONFIG_SLUB_TINY) &&
+			     !(s->flags & SLAB_DEBUG_FLAGS));
+
+		sheaf = kzalloc(struct_size(sheaf, objects, size), gfp);
+		if (!sheaf)
+			return NULL;
+
+		stat(s, SHEAF_PREFILL_OVERSIZE);
+		sheaf->cache = s;
+		sheaf->capacity = size;
+
+		if (!__kmem_cache_alloc_bulk(s, gfp, size,
+					     &sheaf->objects[0])) {
+			kfree(sheaf);
+			return NULL;
+		}
+
+		sheaf->size = size;
+
+		return sheaf;
+	}
+
+	local_lock(&s->cpu_sheaves->lock);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+
+	if (pcs->spare) {
+		sheaf = pcs->spare;
+		pcs->spare = NULL;
+		stat(s, SHEAF_PREFILL_FAST);
+	} else {
+		stat(s, SHEAF_PREFILL_SLOW);
+		sheaf = barn_get_full_or_empty_sheaf(get_barn(s));
+		if (sheaf && sheaf->size)
+			stat(s, BARN_GET);
+		else
+			stat(s, BARN_GET_FAIL);
+	}
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+
+	if (!sheaf)
+		sheaf = alloc_empty_sheaf(s, gfp);
+
+	if (sheaf && sheaf->size < size) {
+		if (refill_sheaf(s, sheaf, gfp)) {
+			sheaf_flush_unused(s, sheaf);
+			free_empty_sheaf(s, sheaf);
+			sheaf = NULL;
+		}
+	}
+
+	if (sheaf)
+		sheaf->capacity = s->sheaf_capacity;
+
+	return sheaf;
+}
+
+/*
+ * Use this to return a sheaf obtained by kmem_cache_prefill_sheaf()
+ *
+ * If the sheaf cannot simply become the percpu spare sheaf, but there's space
+ * for a full sheaf in the barn, we try to refill the sheaf back to the cache's
+ * sheaf_capacity to avoid handling partially full sheaves.
+ *
+ * If the refill fails because gfp is e.g. GFP_NOWAIT, or the barn is full, the
+ * sheaf is instead flushed and freed.
+ */
+void kmem_cache_return_sheaf(struct kmem_cache *s, gfp_t gfp,
+			     struct slab_sheaf *sheaf)
+{
+	struct slub_percpu_sheaves *pcs;
+	struct node_barn *barn;
+
+	if (unlikely(sheaf->capacity != s->sheaf_capacity)) {
+		sheaf_flush_unused(s, sheaf);
+		kfree(sheaf);
+		return;
+	}
+
+	local_lock(&s->cpu_sheaves->lock);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+	barn = get_barn(s);
+
+	if (!pcs->spare) {
+		pcs->spare = sheaf;
+		sheaf = NULL;
+		stat(s, SHEAF_RETURN_FAST);
+	}
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	if (!sheaf)
+		return;
+
+	stat(s, SHEAF_RETURN_SLOW);
+
+	/*
+	 * If the barn has too many full sheaves or we fail to refill the sheaf,
+	 * simply flush and free it.
+	 */
+	if (data_race(barn->nr_full) >= MAX_FULL_SHEAVES ||
+	    refill_sheaf(s, sheaf, gfp)) {
+		sheaf_flush_unused(s, sheaf);
+		free_empty_sheaf(s, sheaf);
+		return;
+	}
+
+	barn_put_full_sheaf(barn, sheaf);
+	stat(s, BARN_PUT);
+}
+
+/*
+ * refill a sheaf previously returned by kmem_cache_prefill_sheaf to at least
+ * the given size
+ *
+ * the sheaf might be replaced by a new one when requesting more than
+ * s->sheaf_capacity objects if such replacement is necessary, but the refill
+ * fails (returning -ENOMEM), the existing sheaf is left intact
+ *
+ * In practice we always refill to full sheaf's capacity.
+ */
+int kmem_cache_refill_sheaf(struct kmem_cache *s, gfp_t gfp,
+			    struct slab_sheaf **sheafp, unsigned int size)
+{
+	struct slab_sheaf *sheaf;
+
+	/*
+	 * TODO: do we want to support *sheaf == NULL to be equivalent of
+	 * kmem_cache_prefill_sheaf() ?
+	 */
+	if (!sheafp || !(*sheafp))
+		return -EINVAL;
+
+	sheaf = *sheafp;
+	if (sheaf->size >= size)
+		return 0;
+
+	if (likely(sheaf->capacity >= size)) {
+		if (likely(sheaf->capacity == s->sheaf_capacity))
+			return refill_sheaf(s, sheaf, gfp);
+
+		if (!__kmem_cache_alloc_bulk(s, gfp, sheaf->capacity - sheaf->size,
+					     &sheaf->objects[sheaf->size])) {
+			return -ENOMEM;
+		}
+		sheaf->size = sheaf->capacity;
+
+		return 0;
+	}
+
+	/*
+	 * We had a regular sized sheaf and need an oversize one, or we had an
+	 * oversize one already but need a larger one now.
+	 * This should be a very rare path so let's not complicate it.
+	 */
+	sheaf = kmem_cache_prefill_sheaf(s, gfp, size);
+	if (!sheaf)
+		return -ENOMEM;
+
+	kmem_cache_return_sheaf(s, gfp, *sheafp);
+	*sheafp = sheaf;
+	return 0;
+}
+
+/*
+ * Allocate from a sheaf obtained by kmem_cache_prefill_sheaf()
+ *
+ * Guaranteed not to fail as many allocations as was the requested size.
+ * After the sheaf is emptied, it fails - no fallback to the slab cache itself.
+ *
+ * The gfp parameter is meant only to specify __GFP_ZERO or __GFP_ACCOUNT
+ * memcg charging is forced over limit if necessary, to avoid failure.
+ */
+void *
+kmem_cache_alloc_from_sheaf_noprof(struct kmem_cache *s, gfp_t gfp,
+				   struct slab_sheaf *sheaf)
+{
+	void *ret = NULL;
+	bool init;
+
+	if (sheaf->size == 0)
+		goto out;
+
+	ret = sheaf->objects[--sheaf->size];
+
+	init = slab_want_init_on_alloc(gfp, s);
+
+	/* add __GFP_NOFAIL to force successful memcg charging */
+	slab_post_alloc_hook(s, NULL, gfp | __GFP_NOFAIL, 1, &ret, init, s->object_size);
+out:
+	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfp, NUMA_NO_NODE);
+
+	return ret;
+}
+
+unsigned int kmem_cache_sheaf_size(struct slab_sheaf *sheaf)
+{
+	return sheaf->size;
+}
+/*
+ * To avoid unnecessary overhead, we pass through large allocation requests
+ * directly to the page allocator. We use __GFP_COMP, because we will need to
+ * know the allocation order to free the pages properly in kfree.
+ */
+static void *___kmalloc_large_node(size_t size, gfp_t flags, int node)
+{
+	struct folio *folio;
+	void *ptr = NULL;
+	unsigned int order = get_order(size);
+
+	if (unlikely(flags & GFP_SLAB_BUG_MASK))
+		flags = kmalloc_fix_flags(flags);
+
+	flags |= __GFP_COMP;
+
+	if (node == NUMA_NO_NODE)
+		folio = (struct folio *)alloc_frozen_pages_noprof(flags, order);
+	else
+		folio = (struct folio *)__alloc_frozen_pages_noprof(flags, order, node, NULL);
+
+	if (folio) {
+		ptr = folio_address(folio);
+		lruvec_stat_mod_folio(folio, NR_SLAB_UNRECLAIMABLE_B,
+				      PAGE_SIZE << order);
+		__folio_set_large_kmalloc(folio);
+	}
+
+	ptr = kasan_kmalloc_large(ptr, size, flags);
+	/* As ptr might get tagged, call kmemleak hook after KASAN. */
+	kmemleak_alloc(ptr, size, 1, flags);
+	kmsan_kmalloc_large(ptr, size, flags);
+
+	return ptr;
+}
+
+void *__kmalloc_large_noprof(size_t size, gfp_t flags)
+{
+	void *ret = ___kmalloc_large_node(size, flags, NUMA_NO_NODE);
+
+	trace_kmalloc(_RET_IP_, ret, size, PAGE_SIZE << get_order(size),
+		      flags, NUMA_NO_NODE);
+	return ret;
+}
+EXPORT_SYMBOL(__kmalloc_large_noprof);
+
+void *__kmalloc_large_node_noprof(size_t size, gfp_t flags, int node)
+{
+	void *ret = ___kmalloc_large_node(size, flags, node);
+
+	trace_kmalloc(_RET_IP_, ret, size, PAGE_SIZE << get_order(size),
+		      flags, node);
+	return ret;
+}
+EXPORT_SYMBOL(__kmalloc_large_node_noprof);
+
+static __always_inline
+void *__do_kmalloc_node(size_t size, kmem_buckets *b, gfp_t flags, int node,
+			unsigned long caller)
+{
+	struct kmem_cache *s;
+	void *ret;
+
+	if (unlikely(size > KMALLOC_MAX_CACHE_SIZE)) {
+		ret = __kmalloc_large_node_noprof(size, flags, node);
+		trace_kmalloc(caller, ret, size,
+			      PAGE_SIZE << get_order(size), flags, node);
+		return ret;
+	}
+
+	if (unlikely(!size))
+		return ZERO_SIZE_PTR;
+
+	s = kmalloc_slab(size, b, flags, caller);
+
+	ret = slab_alloc_node(s, NULL, flags, node, caller, size);
+	ret = kasan_kmalloc(s, ret, size, flags);
+	trace_kmalloc(caller, ret, size, s->size, flags, node);
+	return ret;
+}
+void *__kmalloc_node_noprof(DECL_BUCKET_PARAMS(size, b), gfp_t flags, int node)
+{
+	return __do_kmalloc_node(size, PASS_BUCKET_PARAM(b), flags, node, _RET_IP_);
+}
+EXPORT_SYMBOL(__kmalloc_node_noprof);
+
+void *__kmalloc_noprof(size_t size, gfp_t flags)
+{
+	return __do_kmalloc_node(size, NULL, flags, NUMA_NO_NODE, _RET_IP_);
+}
+EXPORT_SYMBOL(__kmalloc_noprof);
+
+/**
+ * kmalloc_nolock - Allocate an object of given size from any context.
+ * @size: size to allocate
+ * @gfp_flags: GFP flags. Only __GFP_ACCOUNT, __GFP_ZERO, __GFP_NO_OBJ_EXT
+ * allowed.
+ * @node: node number of the target node.
+ *
+ * Return: pointer to the new object or NULL in case of error.
+ * NULL does not mean EBUSY or EAGAIN. It means ENOMEM.
+ * There is no reason to call it again and expect !NULL.
+ */
+void *kmalloc_nolock_noprof(size_t size, gfp_t gfp_flags, int node)
+{
+	gfp_t alloc_gfp = __GFP_NOWARN | __GFP_NOMEMALLOC | gfp_flags;
+	struct kmem_cache *s;
+	bool can_retry = true;
+	void *ret = ERR_PTR(-EBUSY);
+
+	VM_WARN_ON_ONCE(gfp_flags & ~(__GFP_ACCOUNT | __GFP_ZERO |
+				      __GFP_NO_OBJ_EXT));
+
+	if (unlikely(!size))
+		return ZERO_SIZE_PTR;
+
+	if (IS_ENABLED(CONFIG_PREEMPT_RT) && (in_nmi() || in_hardirq()))
+		/* kmalloc_nolock() in PREEMPT_RT is not supported from irq */
+		return NULL;
+retry:
+	if (unlikely(size > KMALLOC_MAX_CACHE_SIZE))
+		return NULL;
+	s = kmalloc_slab(size, NULL, alloc_gfp, _RET_IP_);
+
+	if (!(s->flags & __CMPXCHG_DOUBLE) && !kmem_cache_debug(s))
+		/*
+		 * kmalloc_nolock() is not supported on architectures that
+		 * don't implement cmpxchg16b, but debug caches don't use
+		 * per-cpu slab and per-cpu partial slabs. They rely on
+		 * kmem_cache_node->list_lock, so kmalloc_nolock() can
+		 * attempt to allocate from debug caches by
+		 * spin_trylock_irqsave(&n->list_lock, ...)
+		 */
+		return NULL;
+
+	/*
+	 * Do not call slab_alloc_node(), since trylock mode isn't
+	 * compatible with slab_pre_alloc_hook/should_failslab and
+	 * kfence_alloc. Hence call __slab_alloc_node() (at most twice)
+	 * and slab_post_alloc_hook() directly.
+	 *
+	 * In !PREEMPT_RT ___slab_alloc() manipulates (freelist,tid) pair
+	 * in irq saved region. It assumes that the same cpu will not
+	 * __update_cpu_freelist_fast() into the same (freelist,tid) pair.
+	 * Therefore use in_nmi() to check whether particular bucket is in
+	 * irq protected section.
+	 *
+	 * If in_nmi() && local_lock_is_locked(s->cpu_slab) then it means that
+	 * this cpu was interrupted somewhere inside ___slab_alloc() after
+	 * it did local_lock_irqsave(&s->cpu_slab->lock, flags).
+	 * In this case fast path with __update_cpu_freelist_fast() is not safe.
+	 */
+#ifndef CONFIG_SLUB_TINY
+	if (!in_nmi() || !local_lock_is_locked(&s->cpu_slab->lock))
+#endif
+		ret = __slab_alloc_node(s, alloc_gfp, node, _RET_IP_, size);
+
+	if (PTR_ERR(ret) == -EBUSY) {
+		if (can_retry) {
+			/* pick the next kmalloc bucket */
+			size = s->object_size + 1;
+			/*
+			 * Another alternative is to
+			 * if (memcg) alloc_gfp &= ~__GFP_ACCOUNT;
+			 * else if (!memcg) alloc_gfp |= __GFP_ACCOUNT;
+			 * to retry from bucket of the same size.
+			 */
+			can_retry = false;
+			goto retry;
+		}
+		ret = NULL;
+	}
+
+	maybe_wipe_obj_freeptr(s, ret);
+	slab_post_alloc_hook(s, NULL, alloc_gfp, 1, &ret,
+			     slab_want_init_on_alloc(alloc_gfp, s), size);
+
+	ret = kasan_kmalloc(s, ret, size, alloc_gfp);
+	return ret;
+}
+EXPORT_SYMBOL_GPL(kmalloc_nolock_noprof);
+
+void *__kmalloc_node_track_caller_noprof(DECL_BUCKET_PARAMS(size, b), gfp_t flags,
+					 int node, unsigned long caller)
+{
+	return __do_kmalloc_node(size, PASS_BUCKET_PARAM(b), flags, node, caller);
+
+}
+EXPORT_SYMBOL(__kmalloc_node_track_caller_noprof);
+
+void *__kmalloc_cache_noprof(struct kmem_cache *s, gfp_t gfpflags, size_t size)
+{
+	void *ret = slab_alloc_node(s, NULL, gfpflags, NUMA_NO_NODE,
+					    _RET_IP_, size);
+
+	trace_kmalloc(_RET_IP_, ret, size, s->size, gfpflags, NUMA_NO_NODE);
+
+	ret = kasan_kmalloc(s, ret, size, gfpflags);
+	return ret;
+}
+EXPORT_SYMBOL(__kmalloc_cache_noprof);
+
+void *__kmalloc_cache_node_noprof(struct kmem_cache *s, gfp_t gfpflags,
+				  int node, size_t size)
+{
+	void *ret = slab_alloc_node(s, NULL, gfpflags, node, _RET_IP_, size);
+
+	trace_kmalloc(_RET_IP_, ret, size, s->size, gfpflags, node);
+
+	ret = kasan_kmalloc(s, ret, size, gfpflags);
+	return ret;
+}
+EXPORT_SYMBOL(__kmalloc_cache_node_noprof);
+
+static noinline void free_to_partial_list(
+	struct kmem_cache *s, struct slab *slab,
+	void *head, void *tail, int bulk_cnt,
+	unsigned long addr)
+{
+	struct kmem_cache_node *n = get_node(s, slab_nid(slab));
+	struct slab *slab_free = NULL;
+	int cnt = bulk_cnt;
+	unsigned long flags;
+	depot_stack_handle_t handle = 0;
+
+	/*
+	 * We cannot use GFP_NOWAIT as there are callsites where waking up
+	 * kswapd could deadlock
+	 */
+	if (s->flags & SLAB_STORE_USER)
+		handle = set_track_prepare(__GFP_NOWARN);
+
+	spin_lock_irqsave(&n->list_lock, flags);
+
+	if (free_debug_processing(s, slab, head, tail, &cnt, addr, handle)) {
+		void *prior = slab->freelist;
+
+		/* Perform the actual freeing while we still hold the locks */
+		slab->inuse -= cnt;
+		set_freepointer(s, tail, prior);
+		slab->freelist = head;
 
 		/*
-		 * The cmpxchg will only match if there was no additional
-		 * operation and if we are on the right processor.
-		 *
-		 * The cmpxchg does the following atomically (without lock
-		 * semantics!)
-		 * 1. Relocate first pointer to the current per cpu area.
-		 * 2. Verify that tid and freelist have not been changed
-		 * 3. If they were not changed replace tid and freelist
-		 *
-		 * Since this is without lock semantics the protection is only
-		 * against code executing on this cpu *not* from access by
-		 * other cpus.
+		 * If the slab is empty, and node's partial list is full,
+		 * it should be discarded anyway no matter it's on full or
+		 * partial list.
 		 */
-		if (unlikely(!__update_cpu_freelist_fast(s, object, next_object, tid))) {
-			note_cmpxchg_failure("slab_alloc", s, tid);
-			goto redo;
+		if (slab->inuse == 0 && n->nr_partial >= s->min_partial)
+			slab_free = slab;
+
+		if (!prior) {
+			/* was on full list */
+			remove_full(s, n, slab);
+			if (!slab_free) {
+				add_partial(n, slab, DEACTIVATE_TO_TAIL);
+				stat(s, FREE_ADD_PARTIAL);
+			}
+		} else if (slab_free) {
+			remove_partial(n, slab);
+			stat(s, FREE_REMOVE_PARTIAL);
 		}
-		prefetch_freepointer(s, next_object);
-		stat(s, ALLOC_FASTPATH);
 	}
 
-	return object;
-}
-#else /* CONFIG_SLUB_TINY */
-static void *__slab_alloc_node(struct kmem_cache *s,
-		gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)
-{
-	struct partial_context pc;
-	struct slab *slab;
-	void *object;
-
-	pc.flags = gfpflags;
-	pc.orig_size = orig_size;
-	slab = get_partial(s, node, &pc);
-
-	if (slab)
-		return pc.object;
-
-	slab = new_slab(s, gfpflags, node);
-	if (unlikely(!slab)) {
-		slab_out_of_memory(s, gfpflags, node);
-		return NULL;
+	if (slab_free) {
+		/*
+		 * Update the counters while still holding n->list_lock to
+		 * prevent spurious validation warnings
+		 */
+		dec_slabs_node(s, slab_nid(slab_free), slab_free->objects);
 	}
 
-	object = alloc_single_from_new_slab(s, slab, orig_size);
+	spin_unlock_irqrestore(&n->list_lock, flags);
 
-	return object;
+	if (slab_free) {
+		stat(s, FREE_SLAB);
+		free_slab(s, slab_free);
+	}
 }
-#endif /* CONFIG_SLUB_TINY */
 
 /*
- * If the object has been wiped upon free, make sure it's fully initialized by
- * zeroing out freelist pointer.
+ * Slow path handling. This may still be called frequently since objects
+ * have a longer lifetime than the cpu slabs in most processing loads.
  *
- * Note that we also wipe custom freelist pointers.
+ * So we still attempt to reduce cache line usage. Just take the slab
+ * lock and free the item. If there is no additional partial slab
+ * handling required then we can return immediately.
  */
-static __always_inline void maybe_wipe_obj_freeptr(struct kmem_cache *s,
-						   void *obj)
-{
-	if (unlikely(slab_want_init_on_free(s)) && obj &&
-	    !freeptr_outside_object(s))
-		memset((void *)((char *)kasan_reset_tag(obj) + s->offset),
-			0, sizeof(void *));
-}
+static void __slab_free(struct kmem_cache *s, struct slab *slab,
+			void *head, void *tail, int cnt,
+			unsigned long addr)
 
-static __fastpath_inline
-struct kmem_cache *slab_pre_alloc_hook(struct kmem_cache *s, gfp_t flags)
 {
-	flags &= gfp_allowed_mask;
+	void *prior;
+	int was_frozen;
+	struct slab new;
+	unsigned long counters;
+	struct kmem_cache_node *n = NULL;
+	unsigned long flags;
+	bool on_node_partial;
 
-	might_alloc(flags);
+	stat(s, FREE_SLOWPATH);
 
-	if (unlikely(should_failslab(s, flags)))
-		return NULL;
+	if (IS_ENABLED(CONFIG_SLUB_TINY) || kmem_cache_debug(s)) {
+		free_to_partial_list(s, slab, head, tail, cnt, addr);
+		return;
+	}
 
-	return s;
-}
+	do {
+		if (unlikely(n)) {
+			spin_unlock_irqrestore(&n->list_lock, flags);
+			n = NULL;
+		}
+		prior = slab->freelist;
+		counters = slab->counters;
+		set_freepointer(s, tail, prior);
+		new.counters = counters;
+		was_frozen = new.frozen;
+		new.inuse -= cnt;
+		if ((!new.inuse || !prior) && !was_frozen) {
+			/* Needs to be taken off a list */
+			if (!kmem_cache_has_cpu_partial(s) || prior) {
 
-static __fastpath_inline
-bool slab_post_alloc_hook(struct kmem_cache *s, struct list_lru *lru,
-			  gfp_t flags, size_t size, void **p, bool init,
-			  unsigned int orig_size)
-{
-	unsigned int zero_size = s->object_size;
-	bool kasan_init = init;
-	size_t i;
-	gfp_t init_flags = flags & gfp_allowed_mask;
+				n = get_node(s, slab_nid(slab));
+				/*
+				 * Speculatively acquire the list_lock.
+				 * If the cmpxchg does not succeed then we may
+				 * drop the list_lock without any processing.
+				 *
+				 * Otherwise the list_lock will synchronize with
+				 * other processors updating the list of slabs.
+				 */
+				spin_lock_irqsave(&n->list_lock, flags);
 
-	/*
-	 * For kmalloc object, the allocated memory size(object_size) is likely
-	 * larger than the requested size(orig_size). If redzone check is
-	 * enabled for the extra space, don't zero it, as it will be redzoned
-	 * soon. The redzone operation for this extra space could be seen as a
-	 * replacement of current poisoning under certain debug option, and
-	 * won't break other sanity checks.
-	 */
-	if (kmem_cache_debug_flags(s, SLAB_STORE_USER | SLAB_RED_ZONE) &&
-	    (s->flags & SLAB_KMALLOC))
-		zero_size = orig_size;
+				on_node_partial = slab_test_node_partial(slab);
+			}
+		}
+
+	} while (!slab_update_freelist(s, slab,
+		prior, counters,
+		head, new.counters,
+		"__slab_free"));
+
+	if (likely(!n)) {
+
+		if (likely(was_frozen)) {
+			/*
+			 * The list lock was not taken therefore no list
+			 * activity can be necessary.
+			 */
+			stat(s, FREE_FROZEN);
+		} else if (kmem_cache_has_cpu_partial(s) && !prior) {
+			/*
+			 * If we started with a full slab then put it onto the
+			 * per cpu partial list.
+			 */
+			put_cpu_partial(s, slab, 1);
+			stat(s, CPU_PARTIAL_FREE);
+		}
+
+		return;
+	}
 
 	/*
-	 * When slab_debug is enabled, avoid memory initialization integrated
-	 * into KASAN and instead zero out the memory via the memset below with
-	 * the proper size. Otherwise, KASAN might overwrite SLUB redzones and
-	 * cause false-positive reports. This does not lead to a performance
-	 * penalty on production builds, as slab_debug is not intended to be
-	 * enabled there.
+	 * This slab was partially empty but not on the per-node partial list,
+	 * in which case we shouldn't manipulate its list, just return.
 	 */
-	if (__slub_debug_enabled())
-		kasan_init = false;
+	if (prior && !on_node_partial) {
+		spin_unlock_irqrestore(&n->list_lock, flags);
+		return;
+	}
+
+	if (unlikely(!new.inuse && n->nr_partial >= s->min_partial))
+		goto slab_empty;
 
 	/*
-	 * As memory initialization might be integrated into KASAN,
-	 * kasan_slab_alloc and initialization memset must be
-	 * kept together to avoid discrepancies in behavior.
-	 *
-	 * As p[i] might get tagged, memset and kmemleak hook come after KASAN.
+	 * Objects left in the slab. If it was not on the partial list before
+	 * then add it.
 	 */
-	for (i = 0; i < size; i++) {
-		p[i] = kasan_slab_alloc(s, p[i], init_flags, kasan_init);
-		if (p[i] && init && (!kasan_init ||
-				     !kasan_has_integrated_init()))
-			memset(p[i], 0, zero_size);
-		kmemleak_alloc_recursive(p[i], s->object_size, 1,
-					 s->flags, init_flags);
-		kmsan_slab_alloc(s, p[i], init_flags);
-		alloc_tagging_slab_alloc_hook(s, p[i], flags);
+	if (!kmem_cache_has_cpu_partial(s) && unlikely(!prior)) {
+		add_partial(n, slab, DEACTIVATE_TO_TAIL);
+		stat(s, FREE_ADD_PARTIAL);
 	}
+	spin_unlock_irqrestore(&n->list_lock, flags);
+	return;
 
-	return memcg_slab_post_alloc_hook(s, lru, flags, size, p);
+slab_empty:
+	if (prior) {
+		/*
+		 * Slab on the partial list.
+		 */
+		remove_partial(n, slab);
+		stat(s, FREE_REMOVE_PARTIAL);
+	}
+
+	spin_unlock_irqrestore(&n->list_lock, flags);
+	stat(s, FREE_SLAB);
+	discard_slab(s, slab);
 }
 
 /*
- * Inlined fastpath so that allocation functions (kmalloc, kmem_cache_alloc)
- * have the fastpath folded into their functions. So no function call
- * overhead for requests that can be satisfied on the fastpath.
+ * pcs is locked. We should have get rid of the spare sheaf and obtained an
+ * empty sheaf, while the main sheaf is full. We want to install the empty sheaf
+ * as a main sheaf, and make the current main sheaf a spare sheaf.
  *
- * The fastpath works by first checking if the lockless freelist can be used.
- * If not then __slab_alloc is called for slow processing.
+ * However due to having relinquished the cpu_sheaves lock when obtaining
+ * the empty sheaf, we need to handle some unlikely but possible cases.
+ *
+ * If we put any sheaf to barn here, it's because we were interrupted or have
+ * been migrated to a different cpu, which should be rare enough so just ignore
+ * the barn's limits to simplify the handling.
+ *
+ * An alternative scenario that gets us here is when we fail
+ * barn_replace_full_sheaf(), because there's no empty sheaf available in the
+ * barn, so we had to allocate it by alloc_empty_sheaf(). But because we saw the
+ * limit on full sheaves was not exceeded, we assume it didn't change and just
+ * put the full sheaf there.
+ */
+static void __pcs_install_empty_sheaf(struct kmem_cache *s,
+		struct slub_percpu_sheaves *pcs, struct slab_sheaf *empty)
+{
+	struct node_barn *barn;
+
+	lockdep_assert_held(this_cpu_ptr(&s->cpu_sheaves->lock));
+
+	/* This is what we expect to find if nobody interrupted us. */
+	if (likely(!pcs->spare)) {
+		pcs->spare = pcs->main;
+		pcs->main = empty;
+		return;
+	}
+
+	barn = get_barn(s);
+
+	/*
+	 * Unlikely because if the main sheaf had space, we would have just
+	 * freed to it. Get rid of our empty sheaf.
+	 */
+	if (pcs->main->size < s->sheaf_capacity) {
+		barn_put_empty_sheaf(barn, empty);
+		return;
+	}
+
+	/* Also unlikely for the same reason */
+	if (pcs->spare->size < s->sheaf_capacity) {
+		swap(pcs->main, pcs->spare);
+		barn_put_empty_sheaf(barn, empty);
+		return;
+	}
+
+	/*
+	 * We probably failed barn_replace_full_sheaf() due to no empty sheaf
+	 * available there, but we allocated one, so finish the job.
+	 */
+	barn_put_full_sheaf(barn, pcs->main);
+	stat(s, BARN_PUT);
+	pcs->main = empty;
+}
+
+/*
+ * Replace the full main sheaf with a (at least partially) empty sheaf.
  *
- * Otherwise we can simply pick the next object from the lockless free list.
+ * Must be called with the cpu_sheaves local lock locked. If successful, returns
+ * the pcs pointer and the local lock locked (possibly on a different cpu than
+ * initially called). If not successful, returns NULL and the local lock
+ * unlocked.
  */
-static __fastpath_inline void *slab_alloc_node(struct kmem_cache *s, struct list_lru *lru,
-		gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)
+static struct slub_percpu_sheaves *
+__pcs_replace_full_main(struct kmem_cache *s, struct slub_percpu_sheaves *pcs)
 {
-	void *object;
-	bool init = false;
+	struct slab_sheaf *empty;
+	struct node_barn *barn;
+	bool put_fail;
 
-	s = slab_pre_alloc_hook(s, gfpflags);
-	if (unlikely(!s))
-		return NULL;
+restart:
+	lockdep_assert_held(this_cpu_ptr(&s->cpu_sheaves->lock));
 
-	object = kfence_alloc(s, orig_size, gfpflags);
-	if (unlikely(object))
-		goto out;
+	barn = get_barn(s);
+	put_fail = false;
+
+	if (!pcs->spare) {
+		empty = barn_get_empty_sheaf(barn);
+		if (empty) {
+			pcs->spare = pcs->main;
+			pcs->main = empty;
+			return pcs;
+		}
+		goto alloc_empty;
+	}
 
-	object = __slab_alloc_node(s, gfpflags, node, addr, orig_size);
+	if (pcs->spare->size < s->sheaf_capacity) {
+		swap(pcs->main, pcs->spare);
+		return pcs;
+	}
 
-	maybe_wipe_obj_freeptr(s, object);
-	init = slab_want_init_on_alloc(gfpflags, s);
+	empty = barn_replace_full_sheaf(barn, pcs->main);
+
+	if (!IS_ERR(empty)) {
+		stat(s, BARN_PUT);
+		pcs->main = empty;
+		return pcs;
+	}
+
+	if (PTR_ERR(empty) == -E2BIG) {
+		/* Since we got here, spare exists and is full */
+		struct slab_sheaf *to_flush = pcs->spare;
+
+		stat(s, BARN_PUT_FAIL);
+
+		pcs->spare = NULL;
+		local_unlock(&s->cpu_sheaves->lock);
+
+		sheaf_flush_unused(s, to_flush);
+		empty = to_flush;
+		goto got_empty;
+	}
 
-out:
 	/*
-	 * When init equals 'true', like for kzalloc() family, only
-	 * @orig_size bytes might be zeroed instead of s->object_size
-	 * In case this fails due to memcg_slab_post_alloc_hook(),
-	 * object is set to NULL
+	 * We could not replace full sheaf because barn had no empty
+	 * sheaves. We can still allocate it and put the full sheaf in
+	 * __pcs_install_empty_sheaf(), but if we fail to allocate it,
+	 * make sure to count the fail.
 	 */
-	slab_post_alloc_hook(s, lru, gfpflags, 1, &object, init, orig_size);
-
-	return object;
-}
+	put_fail = true;
 
-void *kmem_cache_alloc_noprof(struct kmem_cache *s, gfp_t gfpflags)
-{
-	void *ret = slab_alloc_node(s, NULL, gfpflags, NUMA_NO_NODE, _RET_IP_,
-				    s->object_size);
+alloc_empty:
+	local_unlock(&s->cpu_sheaves->lock);
 
-	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfpflags, NUMA_NO_NODE);
+	empty = alloc_empty_sheaf(s, GFP_NOWAIT);
+	if (empty)
+		goto got_empty;
 
-	return ret;
-}
-EXPORT_SYMBOL(kmem_cache_alloc_noprof);
+	if (put_fail)
+		 stat(s, BARN_PUT_FAIL);
 
-void *kmem_cache_alloc_lru_noprof(struct kmem_cache *s, struct list_lru *lru,
-			   gfp_t gfpflags)
-{
-	void *ret = slab_alloc_node(s, lru, gfpflags, NUMA_NO_NODE, _RET_IP_,
-				    s->object_size);
+	if (!sheaf_flush_main(s))
+		return NULL;
 
-	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfpflags, NUMA_NO_NODE);
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		return NULL;
 
-	return ret;
-}
-EXPORT_SYMBOL(kmem_cache_alloc_lru_noprof);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
 
-bool kmem_cache_charge(void *objp, gfp_t gfpflags)
-{
-	if (!memcg_kmem_online())
-		return true;
+	/*
+	 * we flushed the main sheaf so it should be empty now,
+	 * but in case we got preempted or migrated, we need to
+	 * check again
+	 */
+	if (pcs->main->size == s->sheaf_capacity)
+		goto restart;
 
-	return memcg_slab_post_charge(objp, gfpflags);
-}
-EXPORT_SYMBOL(kmem_cache_charge);
+	return pcs;
 
-/**
- * kmem_cache_alloc_node - Allocate an object on the specified node
- * @s: The cache to allocate from.
- * @gfpflags: See kmalloc().
- * @node: node number of the target node.
- *
- * Identical to kmem_cache_alloc but it will allocate memory on the given
- * node, which can improve the performance for cpu bound structures.
- *
- * Fallback to other node is possible if __GFP_THISNODE is not set.
- *
- * Return: pointer to the new object or %NULL in case of error
- */
-void *kmem_cache_alloc_node_noprof(struct kmem_cache *s, gfp_t gfpflags, int node)
-{
-	void *ret = slab_alloc_node(s, NULL, gfpflags, node, _RET_IP_, s->object_size);
+got_empty:
+	if (!local_trylock(&s->cpu_sheaves->lock)) {
+		barn_put_empty_sheaf(barn, empty);
+		return NULL;
+	}
 
-	trace_kmem_cache_alloc(_RET_IP_, ret, s, gfpflags, node);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
+	__pcs_install_empty_sheaf(s, pcs, empty);
 
-	return ret;
+	return pcs;
 }
-EXPORT_SYMBOL(kmem_cache_alloc_node_noprof);
 
 /*
- * To avoid unnecessary overhead, we pass through large allocation requests
- * directly to the page allocator. We use __GFP_COMP, because we will need to
- * know the allocation order to free the pages properly in kfree.
+ * Free an object to the percpu sheaves.
+ * The object is expected to have passed slab_free_hook() already.
  */
-static void *___kmalloc_large_node(size_t size, gfp_t flags, int node)
+static __fastpath_inline
+bool free_to_pcs(struct kmem_cache *s, void *object)
 {
-	struct folio *folio;
-	void *ptr = NULL;
-	unsigned int order = get_order(size);
+	struct slub_percpu_sheaves *pcs;
 
-	if (unlikely(flags & GFP_SLAB_BUG_MASK))
-		flags = kmalloc_fix_flags(flags);
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		return false;
 
-	flags |= __GFP_COMP;
+	pcs = this_cpu_ptr(s->cpu_sheaves);
 
-	if (node == NUMA_NO_NODE)
-		folio = (struct folio *)alloc_frozen_pages_noprof(flags, order);
-	else
-		folio = (struct folio *)__alloc_frozen_pages_noprof(flags, order, node, NULL);
+	if (unlikely(pcs->main->size == s->sheaf_capacity)) {
 
-	if (folio) {
-		ptr = folio_address(folio);
-		lruvec_stat_mod_folio(folio, NR_SLAB_UNRECLAIMABLE_B,
-				      PAGE_SIZE << order);
-		__folio_set_large_kmalloc(folio);
+		pcs = __pcs_replace_full_main(s, pcs);
+		if (unlikely(!pcs))
+			return false;
 	}
 
-	ptr = kasan_kmalloc_large(ptr, size, flags);
-	/* As ptr might get tagged, call kmemleak hook after KASAN. */
-	kmemleak_alloc(ptr, size, 1, flags);
-	kmsan_kmalloc_large(ptr, size, flags);
+	pcs->main->objects[pcs->main->size++] = object;
 
-	return ptr;
-}
+	local_unlock(&s->cpu_sheaves->lock);
 
-void *__kmalloc_large_noprof(size_t size, gfp_t flags)
-{
-	void *ret = ___kmalloc_large_node(size, flags, NUMA_NO_NODE);
+	stat(s, FREE_PCS);
 
-	trace_kmalloc(_RET_IP_, ret, size, PAGE_SIZE << get_order(size),
-		      flags, NUMA_NO_NODE);
-	return ret;
+	return true;
 }
-EXPORT_SYMBOL(__kmalloc_large_noprof);
 
-void *__kmalloc_large_node_noprof(size_t size, gfp_t flags, int node)
+static void rcu_free_sheaf(struct rcu_head *head)
 {
-	void *ret = ___kmalloc_large_node(size, flags, node);
+	struct slab_sheaf *sheaf;
+	struct node_barn *barn;
+	struct kmem_cache *s;
 
-	trace_kmalloc(_RET_IP_, ret, size, PAGE_SIZE << get_order(size),
-		      flags, node);
-	return ret;
-}
-EXPORT_SYMBOL(__kmalloc_large_node_noprof);
+	sheaf = container_of(head, struct slab_sheaf, rcu_head);
 
-static __always_inline
-void *__do_kmalloc_node(size_t size, kmem_buckets *b, gfp_t flags, int node,
-			unsigned long caller)
-{
-	struct kmem_cache *s;
-	void *ret;
+	s = sheaf->cache;
 
-	if (unlikely(size > KMALLOC_MAX_CACHE_SIZE)) {
-		ret = __kmalloc_large_node_noprof(size, flags, node);
-		trace_kmalloc(caller, ret, size,
-			      PAGE_SIZE << get_order(size), flags, node);
-		return ret;
-	}
+	/*
+	 * This may remove some objects due to slab_free_hook() returning false,
+	 * so that the sheaf might no longer be completely full. But it's easier
+	 * to handle it as full (unless it became completely empty), as the code
+	 * handles it fine. The only downside is that sheaf will serve fewer
+	 * allocations when reused. It only happens due to debugging, which is a
+	 * performance hit anyway.
+	 */
+	__rcu_free_sheaf_prepare(s, sheaf);
 
-	if (unlikely(!size))
-		return ZERO_SIZE_PTR;
+	barn = get_node(s, sheaf->node)->barn;
 
-	s = kmalloc_slab(size, b, flags, caller);
+	/* due to slab_free_hook() */
+	if (unlikely(sheaf->size == 0))
+		goto empty;
 
-	ret = slab_alloc_node(s, NULL, flags, node, caller, size);
-	ret = kasan_kmalloc(s, ret, size, flags);
-	trace_kmalloc(caller, ret, size, s->size, flags, node);
-	return ret;
-}
-void *__kmalloc_node_noprof(DECL_BUCKET_PARAMS(size, b), gfp_t flags, int node)
-{
-	return __do_kmalloc_node(size, PASS_BUCKET_PARAM(b), flags, node, _RET_IP_);
-}
-EXPORT_SYMBOL(__kmalloc_node_noprof);
+	/*
+	 * Checking nr_full/nr_empty outside lock avoids contention in case the
+	 * barn is at the respective limit. Due to the race we might go over the
+	 * limit but that should be rare and harmless.
+	 */
 
-void *__kmalloc_noprof(size_t size, gfp_t flags)
-{
-	return __do_kmalloc_node(size, NULL, flags, NUMA_NO_NODE, _RET_IP_);
-}
-EXPORT_SYMBOL(__kmalloc_noprof);
+	if (data_race(barn->nr_full) < MAX_FULL_SHEAVES) {
+		stat(s, BARN_PUT);
+		barn_put_full_sheaf(barn, sheaf);
+		return;
+	}
 
-void *__kmalloc_node_track_caller_noprof(DECL_BUCKET_PARAMS(size, b), gfp_t flags,
-					 int node, unsigned long caller)
-{
-	return __do_kmalloc_node(size, PASS_BUCKET_PARAM(b), flags, node, caller);
+	stat(s, BARN_PUT_FAIL);
+	sheaf_flush_unused(s, sheaf);
+
+empty:
+	if (data_race(barn->nr_empty) < MAX_EMPTY_SHEAVES) {
+		barn_put_empty_sheaf(barn, sheaf);
+		return;
+	}
 
+	free_empty_sheaf(s, sheaf);
 }
-EXPORT_SYMBOL(__kmalloc_node_track_caller_noprof);
 
-void *__kmalloc_cache_noprof(struct kmem_cache *s, gfp_t gfpflags, size_t size)
+bool __kfree_rcu_sheaf(struct kmem_cache *s, void *obj)
 {
-	void *ret = slab_alloc_node(s, NULL, gfpflags, NUMA_NO_NODE,
-					    _RET_IP_, size);
+	struct slub_percpu_sheaves *pcs;
+	struct slab_sheaf *rcu_sheaf;
 
-	trace_kmalloc(_RET_IP_, ret, size, s->size, gfpflags, NUMA_NO_NODE);
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		goto fail;
 
-	ret = kasan_kmalloc(s, ret, size, gfpflags);
-	return ret;
-}
-EXPORT_SYMBOL(__kmalloc_cache_noprof);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
 
-void *__kmalloc_cache_node_noprof(struct kmem_cache *s, gfp_t gfpflags,
-				  int node, size_t size)
-{
-	void *ret = slab_alloc_node(s, NULL, gfpflags, node, _RET_IP_, size);
+	if (unlikely(!pcs->rcu_free)) {
 
-	trace_kmalloc(_RET_IP_, ret, size, s->size, gfpflags, node);
+		struct slab_sheaf *empty;
+		struct node_barn *barn;
 
-	ret = kasan_kmalloc(s, ret, size, gfpflags);
-	return ret;
-}
-EXPORT_SYMBOL(__kmalloc_cache_node_noprof);
+		if (pcs->spare && pcs->spare->size == 0) {
+			pcs->rcu_free = pcs->spare;
+			pcs->spare = NULL;
+			goto do_free;
+		}
 
-static noinline void free_to_partial_list(
-	struct kmem_cache *s, struct slab *slab,
-	void *head, void *tail, int bulk_cnt,
-	unsigned long addr)
-{
-	struct kmem_cache_node *n = get_node(s, slab_nid(slab));
-	struct slab *slab_free = NULL;
-	int cnt = bulk_cnt;
-	unsigned long flags;
-	depot_stack_handle_t handle = 0;
+		barn = get_barn(s);
 
-	/*
-	 * We cannot use GFP_NOWAIT as there are callsites where waking up
-	 * kswapd could deadlock
-	 */
-	if (s->flags & SLAB_STORE_USER)
-		handle = set_track_prepare(__GFP_NOWARN);
+		empty = barn_get_empty_sheaf(barn);
 
-	spin_lock_irqsave(&n->list_lock, flags);
+		if (empty) {
+			pcs->rcu_free = empty;
+			goto do_free;
+		}
 
-	if (free_debug_processing(s, slab, head, tail, &cnt, addr, handle)) {
-		void *prior = slab->freelist;
+		local_unlock(&s->cpu_sheaves->lock);
 
-		/* Perform the actual freeing while we still hold the locks */
-		slab->inuse -= cnt;
-		set_freepointer(s, tail, prior);
-		slab->freelist = head;
+		empty = alloc_empty_sheaf(s, GFP_NOWAIT);
 
-		/*
-		 * If the slab is empty, and node's partial list is full,
-		 * it should be discarded anyway no matter it's on full or
-		 * partial list.
-		 */
-		if (slab->inuse == 0 && n->nr_partial >= s->min_partial)
-			slab_free = slab;
+		if (!empty)
+			goto fail;
 
-		if (!prior) {
-			/* was on full list */
-			remove_full(s, n, slab);
-			if (!slab_free) {
-				add_partial(n, slab, DEACTIVATE_TO_TAIL);
-				stat(s, FREE_ADD_PARTIAL);
-			}
-		} else if (slab_free) {
-			remove_partial(n, slab);
-			stat(s, FREE_REMOVE_PARTIAL);
+		if (!local_trylock(&s->cpu_sheaves->lock)) {
+			barn_put_empty_sheaf(barn, empty);
+			goto fail;
 		}
-	}
 
-	if (slab_free) {
-		/*
-		 * Update the counters while still holding n->list_lock to
-		 * prevent spurious validation warnings
-		 */
-		dec_slabs_node(s, slab_nid(slab_free), slab_free->objects);
+		pcs = this_cpu_ptr(s->cpu_sheaves);
+
+		if (unlikely(pcs->rcu_free))
+			barn_put_empty_sheaf(barn, empty);
+		else
+			pcs->rcu_free = empty;
 	}
 
-	spin_unlock_irqrestore(&n->list_lock, flags);
+do_free:
 
-	if (slab_free) {
-		stat(s, FREE_SLAB);
-		free_slab(s, slab_free);
+	rcu_sheaf = pcs->rcu_free;
+
+	/*
+	 * Since we flush immediately when size reaches capacity, we never reach
+	 * this with size already at capacity, so no OOB write is possible.
+	 */
+	rcu_sheaf->objects[rcu_sheaf->size++] = obj;
+
+	if (likely(rcu_sheaf->size < s->sheaf_capacity)) {
+		rcu_sheaf = NULL;
+	} else {
+		pcs->rcu_free = NULL;
+		rcu_sheaf->node = numa_mem_id();
 	}
+
+	/*
+	 * we flush before local_unlock to make sure a racing
+	 * flush_all_rcu_sheaves() doesn't miss this sheaf
+	 */
+	if (rcu_sheaf)
+		call_rcu(&rcu_sheaf->rcu_head, rcu_free_sheaf);
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	stat(s, FREE_RCU_SHEAF);
+	return true;
+
+fail:
+	stat(s, FREE_RCU_SHEAF_FAIL);
+	return false;
 }
 
 /*
- * Slow path handling. This may still be called frequently since objects
- * have a longer lifetime than the cpu slabs in most processing loads.
- *
- * So we still attempt to reduce cache line usage. Just take the slab
- * lock and free the item. If there is no additional partial slab
- * handling required then we can return immediately.
+ * Bulk free objects to the percpu sheaves.
+ * Unlike free_to_pcs() this includes the calls to all necessary hooks
+ * and the fallback to freeing to slab pages.
  */
-static void __slab_free(struct kmem_cache *s, struct slab *slab,
-			void *head, void *tail, int cnt,
-			unsigned long addr)
-
-{
-	void *prior;
-	int was_frozen;
-	struct slab new;
-	unsigned long counters;
-	struct kmem_cache_node *n = NULL;
-	unsigned long flags;
-	bool on_node_partial;
+static void free_to_pcs_bulk(struct kmem_cache *s, size_t size, void **p)
+{
+	struct slub_percpu_sheaves *pcs;
+	struct slab_sheaf *main, *empty;
+	bool init = slab_want_init_on_free(s);
+	unsigned int batch, i = 0;
+	struct node_barn *barn;
+	void *remote_objects[PCS_BATCH_MAX];
+	unsigned int remote_nr = 0;
+	int node = numa_mem_id();
+
+next_remote_batch:
+	while (i < size) {
+		struct slab *slab = virt_to_slab(p[i]);
+
+		memcg_slab_free_hook(s, slab, p + i, 1);
+		alloc_tagging_slab_free_hook(s, slab, p + i, 1);
+
+		if (unlikely(!slab_free_hook(s, p[i], init, false))) {
+			p[i] = p[--size];
+			if (!size)
+				goto flush_remote;
+			continue;
+		}
 
-	stat(s, FREE_SLOWPATH);
+		if (unlikely(IS_ENABLED(CONFIG_NUMA) && slab_nid(slab) != node)) {
+			remote_objects[remote_nr] = p[i];
+			p[i] = p[--size];
+			if (++remote_nr >= PCS_BATCH_MAX)
+				goto flush_remote;
+			continue;
+		}
 
-	if (IS_ENABLED(CONFIG_SLUB_TINY) || kmem_cache_debug(s)) {
-		free_to_partial_list(s, slab, head, tail, cnt, addr);
-		return;
+		i++;
 	}
 
-	do {
-		if (unlikely(n)) {
-			spin_unlock_irqrestore(&n->list_lock, flags);
-			n = NULL;
-		}
-		prior = slab->freelist;
-		counters = slab->counters;
-		set_freepointer(s, tail, prior);
-		new.counters = counters;
-		was_frozen = new.frozen;
-		new.inuse -= cnt;
-		if ((!new.inuse || !prior) && !was_frozen) {
-			/* Needs to be taken off a list */
-			if (!kmem_cache_has_cpu_partial(s) || prior) {
+next_batch:
+	if (!local_trylock(&s->cpu_sheaves->lock))
+		goto fallback;
 
-				n = get_node(s, slab_nid(slab));
-				/*
-				 * Speculatively acquire the list_lock.
-				 * If the cmpxchg does not succeed then we may
-				 * drop the list_lock without any processing.
-				 *
-				 * Otherwise the list_lock will synchronize with
-				 * other processors updating the list of slabs.
-				 */
-				spin_lock_irqsave(&n->list_lock, flags);
+	pcs = this_cpu_ptr(s->cpu_sheaves);
 
-				on_node_partial = slab_test_node_partial(slab);
-			}
-		}
+	if (likely(pcs->main->size < s->sheaf_capacity))
+		goto do_free;
 
-	} while (!slab_update_freelist(s, slab,
-		prior, counters,
-		head, new.counters,
-		"__slab_free"));
+	barn = get_barn(s);
 
-	if (likely(!n)) {
+	if (!pcs->spare) {
+		empty = barn_get_empty_sheaf(barn);
+		if (!empty)
+			goto no_empty;
 
-		if (likely(was_frozen)) {
-			/*
-			 * The list lock was not taken therefore no list
-			 * activity can be necessary.
-			 */
-			stat(s, FREE_FROZEN);
-		} else if (kmem_cache_has_cpu_partial(s) && !prior) {
-			/*
-			 * If we started with a full slab then put it onto the
-			 * per cpu partial list.
-			 */
-			put_cpu_partial(s, slab, 1);
-			stat(s, CPU_PARTIAL_FREE);
-		}
+		pcs->spare = pcs->main;
+		pcs->main = empty;
+		goto do_free;
+	}
 
-		return;
+	if (pcs->spare->size < s->sheaf_capacity) {
+		swap(pcs->main, pcs->spare);
+		goto do_free;
 	}
 
-	/*
-	 * This slab was partially empty but not on the per-node partial list,
-	 * in which case we shouldn't manipulate its list, just return.
-	 */
-	if (prior && !on_node_partial) {
-		spin_unlock_irqrestore(&n->list_lock, flags);
-		return;
+	empty = barn_replace_full_sheaf(barn, pcs->main);
+	if (IS_ERR(empty)) {
+		stat(s, BARN_PUT_FAIL);
+		goto no_empty;
 	}
 
-	if (unlikely(!new.inuse && n->nr_partial >= s->min_partial))
-		goto slab_empty;
+	stat(s, BARN_PUT);
+	pcs->main = empty;
+
+do_free:
+	main = pcs->main;
+	batch = min(size, s->sheaf_capacity - main->size);
+
+	memcpy(main->objects + main->size, p, batch * sizeof(void *));
+	main->size += batch;
+
+	local_unlock(&s->cpu_sheaves->lock);
+
+	stat_add(s, FREE_PCS, batch);
+
+	if (batch < size) {
+		p += batch;
+		size -= batch;
+		goto next_batch;
+	}
+
+	return;
+
+no_empty:
+	local_unlock(&s->cpu_sheaves->lock);
 
 	/*
-	 * Objects left in the slab. If it was not on the partial list before
-	 * then add it.
+	 * if we depleted all empty sheaves in the barn or there are too
+	 * many full sheaves, free the rest to slab pages
 	 */
-	if (!kmem_cache_has_cpu_partial(s) && unlikely(!prior)) {
-		add_partial(n, slab, DEACTIVATE_TO_TAIL);
-		stat(s, FREE_ADD_PARTIAL);
+fallback:
+	__kmem_cache_free_bulk(s, size, p);
+
+flush_remote:
+	if (remote_nr) {
+		__kmem_cache_free_bulk(s, remote_nr, &remote_objects[0]);
+		if (i < size) {
+			remote_nr = 0;
+			goto next_remote_batch;
+		}
 	}
-	spin_unlock_irqrestore(&n->list_lock, flags);
-	return;
+}
+
+struct defer_free {
+	struct llist_head objects;
+	struct llist_head slabs;
+	struct irq_work work;
+};
+
+static void free_deferred_objects(struct irq_work *work);
+
+static DEFINE_PER_CPU(struct defer_free, defer_free_objects) = {
+	.objects = LLIST_HEAD_INIT(objects),
+	.slabs = LLIST_HEAD_INIT(slabs),
+	.work = IRQ_WORK_INIT(free_deferred_objects),
+};
+
+/*
+ * In PREEMPT_RT irq_work runs in per-cpu kthread, so it's safe
+ * to take sleeping spin_locks from __slab_free() and deactivate_slab().
+ * In !PREEMPT_RT irq_work will run after local_unlock_irqrestore().
+ */
+static void free_deferred_objects(struct irq_work *work)
+{
+	struct defer_free *df = container_of(work, struct defer_free, work);
+	struct llist_head *objs = &df->objects;
+	struct llist_head *slabs = &df->slabs;
+	struct llist_node *llnode, *pos, *t;
+
+	if (llist_empty(objs) && llist_empty(slabs))
+		return;
+
+	llnode = llist_del_all(objs);
+	llist_for_each_safe(pos, t, llnode) {
+		struct kmem_cache *s;
+		struct slab *slab;
+		void *x = pos;
+
+		slab = virt_to_slab(x);
+		s = slab->slab_cache;
 
-slab_empty:
-	if (prior) {
 		/*
-		 * Slab on the partial list.
+		 * We used freepointer in 'x' to link 'x' into df->objects.
+		 * Clear it to NULL to avoid false positive detection
+		 * of "Freepointer corruption".
 		 */
-		remove_partial(n, slab);
-		stat(s, FREE_REMOVE_PARTIAL);
+		*(void **)x = NULL;
+
+		/* Point 'x' back to the beginning of allocated object */
+		x -= s->offset;
+		__slab_free(s, slab, x, x, 1, _THIS_IP_);
 	}
 
-	spin_unlock_irqrestore(&n->list_lock, flags);
-	stat(s, FREE_SLAB);
-	discard_slab(s, slab);
+	llnode = llist_del_all(slabs);
+	llist_for_each_safe(pos, t, llnode) {
+		struct slab *slab = container_of(pos, struct slab, llnode);
+
+#ifdef CONFIG_SLUB_TINY
+		discard_slab(slab->slab_cache, slab);
+#else
+		deactivate_slab(slab->slab_cache, slab, slab->flush_freelist);
+#endif
+	}
+}
+
+static void defer_free(struct kmem_cache *s, void *head)
+{
+	struct defer_free *df = this_cpu_ptr(&defer_free_objects);
+
+	if (llist_add(head + s->offset, &df->objects))
+		irq_work_queue(&df->work);
+}
+
+static void defer_deactivate_slab(struct slab *slab, void *flush_freelist)
+{
+	struct defer_free *df = this_cpu_ptr(&defer_free_objects);
+
+	slab->flush_freelist = flush_freelist;
+	if (llist_add(&slab->llnode, &df->slabs))
+		irq_work_queue(&df->work);
+}
+
+void defer_free_barrier(void)
+{
+	int cpu;
+
+	for_each_possible_cpu(cpu)
+		irq_work_sync(&per_cpu_ptr(&defer_free_objects, cpu)->work);
 }
 
 #ifndef CONFIG_SLUB_TINY
@@ -4628,6 +6474,8 @@ static __always_inline void do_slab_free(struct kmem_cache *s,
 				struct slab *slab, void *head, void *tail,
 				int cnt, unsigned long addr)
 {
+	/* cnt == 0 signals that it's called from kfree_nolock() */
+	bool allow_spin = cnt;
 	struct kmem_cache_cpu *c;
 	unsigned long tid;
 	void **freelist;
@@ -4646,10 +6494,29 @@ static __always_inline void do_slab_free(struct kmem_cache *s,
 	barrier();
 
 	if (unlikely(slab != c->slab)) {
-		__slab_free(s, slab, head, tail, cnt, addr);
+		if (unlikely(!allow_spin)) {
+			/*
+			 * __slab_free() can locklessly cmpxchg16 into a slab,
+			 * but then it might need to take spin_lock or local_lock
+			 * in put_cpu_partial() for further processing.
+			 * Avoid the complexity and simply add to a deferred list.
+			 */
+			defer_free(s, head);
+		} else {
+			__slab_free(s, slab, head, tail, cnt, addr);
+		}
 		return;
 	}
 
+	if (unlikely(!allow_spin)) {
+		if ((in_nmi() || !USE_LOCKLESS_FAST_PATH()) &&
+		    local_lock_is_locked(&s->cpu_slab->lock)) {
+			defer_free(s, head);
+			return;
+		}
+		cnt = 1; /* restore cnt. kfree_nolock() frees one object at a time */
+	}
+
 	if (USE_LOCKLESS_FAST_PATH()) {
 		freelist = READ_ONCE(c->freelist);
 
@@ -4660,11 +6527,13 @@ static __always_inline void do_slab_free(struct kmem_cache *s,
 			goto redo;
 		}
 	} else {
+		__maybe_unused unsigned long flags = 0;
+
 		/* Update the free list under the local lock */
-		local_lock(&s->cpu_slab->lock);
+		local_lock_cpu_slab(s, flags);
 		c = this_cpu_ptr(s->cpu_slab);
 		if (unlikely(slab != c->slab)) {
-			local_unlock(&s->cpu_slab->lock);
+			local_unlock_cpu_slab(s, flags);
 			goto redo;
 		}
 		tid = c->tid;
@@ -4674,7 +6543,7 @@ static __always_inline void do_slab_free(struct kmem_cache *s,
 		c->freelist = head;
 		c->tid = next_tid(tid);
 
-		local_unlock(&s->cpu_slab->lock);
+		local_unlock_cpu_slab(s, flags);
 	}
 	stat_add(s, FREE_FASTPATH, cnt);
 }
@@ -4694,8 +6563,16 @@ void slab_free(struct kmem_cache *s, struct slab *slab, void *object,
 	memcg_slab_free_hook(s, slab, &object, 1);
 	alloc_tagging_slab_free_hook(s, slab, &object, 1);
 
-	if (likely(slab_free_hook(s, object, slab_want_init_on_free(s), false)))
-		do_slab_free(s, slab, object, object, 1, addr);
+	if (unlikely(!slab_free_hook(s, object, slab_want_init_on_free(s), false)))
+		return;
+
+	if (s->cpu_sheaves && likely(!IS_ENABLED(CONFIG_NUMA) ||
+				     slab_nid(slab) == numa_mem_id())) {
+		if (likely(free_to_pcs(s, object)))
+			return;
+	}
+
+	do_slab_free(s, slab, object, object, 1, addr);
 }
 
 #ifdef CONFIG_MEMCG
@@ -4897,6 +6774,71 @@ void kfree(const void *object)
 }
 EXPORT_SYMBOL(kfree);
 
+/*
+ * Can be called while holding raw_spinlock_t or from IRQ and NMI,
+ * but ONLY for objects allocated by kmalloc_nolock().
+ * Debug checks (like kmemleak and kfence) were skipped on allocation,
+ * hence
+ * obj = kmalloc(); kfree_nolock(obj);
+ * will miss kmemleak/kfence book keeping and will cause false positives.
+ * large_kmalloc is not supported either.
+ */
+void kfree_nolock(const void *object)
+{
+	struct folio *folio;
+	struct slab *slab;
+	struct kmem_cache *s;
+	void *x = (void *)object;
+
+	if (unlikely(ZERO_OR_NULL_PTR(object)))
+		return;
+
+	folio = virt_to_folio(object);
+	if (unlikely(!folio_test_slab(folio))) {
+		WARN_ONCE(1, "large_kmalloc is not supported by kfree_nolock()");
+		return;
+	}
+
+	slab = folio_slab(folio);
+	s = slab->slab_cache;
+
+	memcg_slab_free_hook(s, slab, &x, 1);
+	alloc_tagging_slab_free_hook(s, slab, &x, 1);
+	/*
+	 * Unlike slab_free() do NOT call the following:
+	 * kmemleak_free_recursive(x, s->flags);
+	 * debug_check_no_locks_freed(x, s->object_size);
+	 * debug_check_no_obj_freed(x, s->object_size);
+	 * __kcsan_check_access(x, s->object_size, ..);
+	 * kfence_free(x);
+	 * since they take spinlocks or not safe from any context.
+	 */
+	kmsan_slab_free(s, x);
+	/*
+	 * If KASAN finds a kernel bug it will do kasan_report_invalid_free()
+	 * which will call raw_spin_lock_irqsave() which is technically
+	 * unsafe from NMI, but take chance and report kernel bug.
+	 * The sequence of
+	 * kasan_report_invalid_free() -> raw_spin_lock_irqsave() -> NMI
+	 *  -> kfree_nolock() -> kasan_report_invalid_free() on the same CPU
+	 * is double buggy and deserves to deadlock.
+	 */
+	if (kasan_slab_pre_free(s, x))
+		return;
+	/*
+	 * memcg, kasan_slab_pre_free are done for 'x'.
+	 * The only thing left is kasan_poison without quarantine,
+	 * since kasan quarantine takes locks and not supported from NMI.
+	 */
+	kasan_slab_free(s, x, false, false, /* skip quarantine */true);
+#ifndef CONFIG_SLUB_TINY
+	do_slab_free(s, slab, x, x, 0, _RET_IP_);
+#else
+	defer_free(s, x);
+#endif
+}
+EXPORT_SYMBOL_GPL(kfree_nolock);
+
 static __always_inline __realloc_size(2) void *
 __do_krealloc(const void *p, size_t new_size, unsigned long align, gfp_t flags, int nid)
 {
@@ -5321,6 +7263,15 @@ void kmem_cache_free_bulk(struct kmem_cache *s, size_t size, void **p)
 	if (!size)
 		return;
 
+	/*
+	 * freeing to sheaves is so incompatible with the detached freelist so
+	 * once we go that way, we have to do everything differently
+	 */
+	if (s && s->cpu_sheaves) {
+		free_to_pcs_bulk(s, size, p);
+		return;
+	}
+
 	do {
 		struct detached_freelist df;
 
@@ -5439,7 +7390,7 @@ static int __kmem_cache_alloc_bulk(struct kmem_cache *s, gfp_t flags,
 int kmem_cache_alloc_bulk_noprof(struct kmem_cache *s, gfp_t flags, size_t size,
 				 void **p)
 {
-	int i;
+	unsigned int i = 0;
 
 	if (!size)
 		return 0;
@@ -5448,9 +7399,20 @@ int kmem_cache_alloc_bulk_noprof(struct kmem_cache *s, gfp_t flags, size_t size,
 	if (unlikely(!s))
 		return 0;
 
-	i = __kmem_cache_alloc_bulk(s, flags, size, p);
-	if (unlikely(i == 0))
-		return 0;
+	if (s->cpu_sheaves)
+		i = alloc_from_pcs_bulk(s, size, p);
+
+	if (i < size) {
+		/*
+		 * If we ran out of memory, don't bother with freeing back to
+		 * the percpu sheaves, we have bigger problems.
+		 */
+		if (unlikely(__kmem_cache_alloc_bulk(s, flags, size - i, p + i) == 0)) {
+			if (i > 0)
+				__kmem_cache_free_bulk(s, i, p);
+			return 0;
+		}
+	}
 
 	/*
 	 * memcg and kmem_cache debug support and memory initialization.
@@ -5460,11 +7422,11 @@ int kmem_cache_alloc_bulk_noprof(struct kmem_cache *s, gfp_t flags, size_t size,
 		    slab_want_init_on_alloc(flags, s), s->object_size))) {
 		return 0;
 	}
-	return i;
+
+	return size;
 }
 EXPORT_SYMBOL(kmem_cache_alloc_bulk_noprof);
 
-
 /*
  * Object placement in a slab is made very easy because we always start at
  * offset 0. If we tune the size of the object to the alignment then we can
@@ -5598,7 +7560,7 @@ static inline int calculate_order(unsigned int size)
 }
 
 static void
-init_kmem_cache_node(struct kmem_cache_node *n)
+init_kmem_cache_node(struct kmem_cache_node *n, struct node_barn *barn)
 {
 	n->nr_partial = 0;
 	spin_lock_init(&n->list_lock);
@@ -5608,6 +7570,9 @@ init_kmem_cache_node(struct kmem_cache_node *n)
 	atomic_long_set(&n->total_objects, 0);
 	INIT_LIST_HEAD(&n->full);
 #endif
+	n->barn = barn;
+	if (barn)
+		barn_init(barn);
 }
 
 #ifndef CONFIG_SLUB_TINY
@@ -5638,6 +7603,26 @@ static inline int alloc_kmem_cache_cpus(struct kmem_cache *s)
 }
 #endif /* CONFIG_SLUB_TINY */
 
+static int init_percpu_sheaves(struct kmem_cache *s)
+{
+	int cpu;
+
+	for_each_possible_cpu(cpu) {
+		struct slub_percpu_sheaves *pcs;
+
+		pcs = per_cpu_ptr(s->cpu_sheaves, cpu);
+
+		local_trylock_init(&pcs->lock);
+
+		pcs->main = alloc_empty_sheaf(s, GFP_KERNEL);
+
+		if (!pcs->main)
+			return -ENOMEM;
+	}
+
+	return 0;
+}
+
 static struct kmem_cache *kmem_cache_node;
 
 /*
@@ -5673,7 +7658,7 @@ static void early_kmem_cache_node_alloc(int node)
 	slab->freelist = get_freepointer(kmem_cache_node, n);
 	slab->inuse = 1;
 	kmem_cache_node->node[node] = n;
-	init_kmem_cache_node(n);
+	init_kmem_cache_node(n, NULL);
 	inc_slabs_node(kmem_cache_node, node, slab->objects);
 
 	/*
@@ -5689,6 +7674,13 @@ static void free_kmem_cache_nodes(struct kmem_cache *s)
 	struct kmem_cache_node *n;
 
 	for_each_kmem_cache_node(s, node, n) {
+		if (n->barn) {
+			WARN_ON(n->barn->nr_full);
+			WARN_ON(n->barn->nr_empty);
+			kfree(n->barn);
+			n->barn = NULL;
+		}
+
 		s->node[node] = NULL;
 		kmem_cache_free(kmem_cache_node, n);
 	}
@@ -5697,7 +7689,12 @@ static void free_kmem_cache_nodes(struct kmem_cache *s)
 void __kmem_cache_release(struct kmem_cache *s)
 {
 	cache_random_seq_destroy(s);
+	if (s->cpu_sheaves)
+		pcs_destroy(s);
 #ifndef CONFIG_SLUB_TINY
+#ifdef CONFIG_PREEMPT_RT
+	lockdep_unregister_key(&s->lock_key);
+#endif
 	free_percpu(s->cpu_slab);
 #endif
 	free_kmem_cache_nodes(s);
@@ -5709,20 +7706,29 @@ static int init_kmem_cache_nodes(struct kmem_cache *s)
 
 	for_each_node_mask(node, slab_nodes) {
 		struct kmem_cache_node *n;
+		struct node_barn *barn = NULL;
 
 		if (slab_state == DOWN) {
 			early_kmem_cache_node_alloc(node);
 			continue;
 		}
+
+		if (s->cpu_sheaves) {
+			barn = kmalloc_node(sizeof(*barn), GFP_KERNEL, node);
+
+			if (!barn)
+				return 0;
+		}
+
 		n = kmem_cache_alloc_node(kmem_cache_node,
 						GFP_KERNEL, node);
-
 		if (!n) {
-			free_kmem_cache_nodes(s);
+			kfree(barn);
 			return 0;
 		}
 
-		init_kmem_cache_node(n);
+		init_kmem_cache_node(n, barn);
+
 		s->node[node] = n;
 	}
 	return 1;
@@ -5977,8 +7983,15 @@ int __kmem_cache_shutdown(struct kmem_cache *s)
 	struct kmem_cache_node *n;
 
 	flush_all_cpus_locked(s);
+
+	/* we might have rcu sheaves in flight */
+	if (s->cpu_sheaves)
+		rcu_barrier();
+
 	/* Attempt to free all objects */
 	for_each_kmem_cache_node(s, node, n) {
+		if (n->barn)
+			barn_shrink(s, n->barn);
 		free_partial(s, n);
 		if (n->nr_partial || node_nr_slabs(n))
 			return 1;
@@ -6182,6 +8195,9 @@ static int __kmem_cache_do_shrink(struct kmem_cache *s)
 		for (i = 0; i < SHRINK_PROMOTE_MAX; i++)
 			INIT_LIST_HEAD(promote + i);
 
+		if (n->barn)
+			barn_shrink(s, n->barn);
+
 		spin_lock_irqsave(&n->list_lock, flags);
 
 		/*
@@ -6261,12 +8277,24 @@ static int slab_mem_going_online_callback(int nid)
 	 */
 	mutex_lock(&slab_mutex);
 	list_for_each_entry(s, &slab_caches, list) {
+		struct node_barn *barn = NULL;
+
 		/*
 		 * The structure may already exist if the node was previously
 		 * onlined and offlined.
 		 */
 		if (get_node(s, nid))
 			continue;
+
+		if (s->cpu_sheaves) {
+			barn = kmalloc_node(sizeof(*barn), GFP_KERNEL, nid);
+
+			if (!barn) {
+				ret = -ENOMEM;
+				goto out;
+			}
+		}
+
 		/*
 		 * XXX: kmem_cache_alloc_node will fallback to other nodes
 		 *      since memory is not yet available from the node that
@@ -6274,10 +8302,13 @@ static int slab_mem_going_online_callback(int nid)
 		 */
 		n = kmem_cache_alloc(kmem_cache_node, GFP_KERNEL);
 		if (!n) {
+			kfree(barn);
 			ret = -ENOMEM;
 			goto out;
 		}
-		init_kmem_cache_node(n);
+
+		init_kmem_cache_node(n, barn);
+
 		s->node[nid] = n;
 	}
 	/*
@@ -6490,6 +8521,17 @@ int do_kmem_cache_create(struct kmem_cache *s, const char *name,
 
 	set_cpu_partial(s);
 
+	if (args->sheaf_capacity && !IS_ENABLED(CONFIG_SLUB_TINY)
+					&& !(s->flags & SLAB_DEBUG_FLAGS)) {
+		s->cpu_sheaves = alloc_percpu(struct slub_percpu_sheaves);
+		if (!s->cpu_sheaves) {
+			err = -ENOMEM;
+			goto out;
+		}
+		// TODO: increase capacity to grow slab_sheaf up to next kmalloc size?
+		s->sheaf_capacity = args->sheaf_capacity;
+	}
+
 #ifdef CONFIG_NUMA
 	s->remote_node_defrag_ratio = 1000;
 #endif
@@ -6506,6 +8548,12 @@ int do_kmem_cache_create(struct kmem_cache *s, const char *name,
 	if (!alloc_kmem_cache_cpus(s))
 		goto out;
 
+	if (s->cpu_sheaves) {
+		err = init_percpu_sheaves(s);
+		if (err)
+			goto out;
+	}
+
 	err = 0;
 
 	/* Mutex is not taken during early boot */
@@ -6547,6 +8595,11 @@ static void validate_slab(struct kmem_cache *s, struct slab *slab,
 	void *p;
 	void *addr = slab_address(slab);
 
+	if (!validate_slab_ptr(slab)) {
+		slab_err(s, slab, "Not a valid slab page");
+		return;
+	}
+
 	if (!check_slab(s, slab) || !on_freelist(s, slab, NULL))
 		return;
 
@@ -6958,6 +9011,12 @@ static ssize_t order_show(struct kmem_cache *s, char *buf)
 }
 SLAB_ATTR_RO(order);
 
+static ssize_t sheaf_capacity_show(struct kmem_cache *s, char *buf)
+{
+	return sysfs_emit(buf, "%u\n", s->sheaf_capacity);
+}
+SLAB_ATTR_RO(sheaf_capacity);
+
 static ssize_t min_partial_show(struct kmem_cache *s, char *buf)
 {
 	return sysfs_emit(buf, "%lu\n", s->min_partial);
@@ -7305,8 +9364,12 @@ static ssize_t text##_store(struct kmem_cache *s,		\
 }								\
 SLAB_ATTR(text);						\
 
+STAT_ATTR(ALLOC_PCS, alloc_cpu_sheaf);
 STAT_ATTR(ALLOC_FASTPATH, alloc_fastpath);
 STAT_ATTR(ALLOC_SLOWPATH, alloc_slowpath);
+STAT_ATTR(FREE_PCS, free_cpu_sheaf);
+STAT_ATTR(FREE_RCU_SHEAF, free_rcu_sheaf);
+STAT_ATTR(FREE_RCU_SHEAF_FAIL, free_rcu_sheaf_fail);
 STAT_ATTR(FREE_FASTPATH, free_fastpath);
 STAT_ATTR(FREE_SLOWPATH, free_slowpath);
 STAT_ATTR(FREE_FROZEN, free_frozen);
@@ -7331,6 +9394,19 @@ STAT_ATTR(CPU_PARTIAL_ALLOC, cpu_partial_alloc);
 STAT_ATTR(CPU_PARTIAL_FREE, cpu_partial_free);
 STAT_ATTR(CPU_PARTIAL_NODE, cpu_partial_node);
 STAT_ATTR(CPU_PARTIAL_DRAIN, cpu_partial_drain);
+STAT_ATTR(SHEAF_FLUSH, sheaf_flush);
+STAT_ATTR(SHEAF_REFILL, sheaf_refill);
+STAT_ATTR(SHEAF_ALLOC, sheaf_alloc);
+STAT_ATTR(SHEAF_FREE, sheaf_free);
+STAT_ATTR(BARN_GET, barn_get);
+STAT_ATTR(BARN_GET_FAIL, barn_get_fail);
+STAT_ATTR(BARN_PUT, barn_put);
+STAT_ATTR(BARN_PUT_FAIL, barn_put_fail);
+STAT_ATTR(SHEAF_PREFILL_FAST, sheaf_prefill_fast);
+STAT_ATTR(SHEAF_PREFILL_SLOW, sheaf_prefill_slow);
+STAT_ATTR(SHEAF_PREFILL_OVERSIZE, sheaf_prefill_oversize);
+STAT_ATTR(SHEAF_RETURN_FAST, sheaf_return_fast);
+STAT_ATTR(SHEAF_RETURN_SLOW, sheaf_return_slow);
 #endif	/* CONFIG_SLUB_STATS */
 
 #ifdef CONFIG_KFENCE
@@ -7361,6 +9437,7 @@ static struct attribute *slab_attrs[] = {
 	&object_size_attr.attr,
 	&objs_per_slab_attr.attr,
 	&order_attr.attr,
+	&sheaf_capacity_attr.attr,
 	&min_partial_attr.attr,
 	&cpu_partial_attr.attr,
 	&objects_partial_attr.attr,
@@ -7392,8 +9469,12 @@ static struct attribute *slab_attrs[] = {
 	&remote_node_defrag_ratio_attr.attr,
 #endif
 #ifdef CONFIG_SLUB_STATS
+	&alloc_cpu_sheaf_attr.attr,
 	&alloc_fastpath_attr.attr,
 	&alloc_slowpath_attr.attr,
+	&free_cpu_sheaf_attr.attr,
+	&free_rcu_sheaf_attr.attr,
+	&free_rcu_sheaf_fail_attr.attr,
 	&free_fastpath_attr.attr,
 	&free_slowpath_attr.attr,
 	&free_frozen_attr.attr,
@@ -7418,6 +9499,19 @@ static struct attribute *slab_attrs[] = {
 	&cpu_partial_free_attr.attr,
 	&cpu_partial_node_attr.attr,
 	&cpu_partial_drain_attr.attr,
+	&sheaf_flush_attr.attr,
+	&sheaf_refill_attr.attr,
+	&sheaf_alloc_attr.attr,
+	&sheaf_free_attr.attr,
+	&barn_get_attr.attr,
+	&barn_get_fail_attr.attr,
+	&barn_put_attr.attr,
+	&barn_put_fail_attr.attr,
+	&sheaf_prefill_fast_attr.attr,
+	&sheaf_prefill_slow_attr.attr,
+	&sheaf_prefill_oversize_attr.attr,
+	&sheaf_return_fast_attr.attr,
+	&sheaf_return_slow_attr.attr,
 #endif
 #ifdef CONFIG_FAILSLAB
 	&failslab_attr.attr,
@@ -7759,15 +9853,12 @@ static void *slab_debugfs_next(struct seq_file *seq, void *v, loff_t *ppos)
 	return NULL;
 }
 
-static int cmp_loc_by_count(const void *a, const void *b, const void *data)
+static int cmp_loc_by_count(const void *a, const void *b)
 {
 	struct location *loc1 = (struct location *)a;
 	struct location *loc2 = (struct location *)b;
 
-	if (loc1->count > loc2->count)
-		return -1;
-	else
-		return 1;
+	return cmp_int(loc2->count, loc1->count);
 }
 
 static void *slab_debugfs_start(struct seq_file *seq, loff_t *ppos)
@@ -7829,8 +9920,8 @@ static int slab_debug_trace_open(struct inode *inode, struct file *filep)
 	}
 
 	/* Sort locations by count */
-	sort_r(t->loc, t->count, sizeof(struct location),
-		cmp_loc_by_count, NULL, NULL);
+	sort(t->loc, t->count, sizeof(struct location),
+	     cmp_loc_by_count, NULL);
 
 	bitmap_free(obj_map);
 	return 0;
diff --git a/mm/vma_init.c b/mm/vma_init.c
index d847c6557261..3c0b65950510 100644
--- a/mm/vma_init.c
+++ b/mm/vma_init.c
@@ -16,6 +16,7 @@ void __init vma_state_init(void)
 	struct kmem_cache_args args = {
 		.use_freeptr_offset = true,
 		.freeptr_offset = offsetof(struct vm_area_struct, vm_freeptr),
+		.sheaf_capacity = 32,
 	};
 
 	vm_area_cachep = kmem_cache_create("vm_area_struct",
diff --git a/rust/Makefile b/rust/Makefile
index bfa915b0e588..23c7ae905bd2 100644
--- a/rust/Makefile
+++ b/rust/Makefile
@@ -98,6 +98,12 @@ quiet_cmd_rustdoc = RUSTDOC $(if $(rustdoc_host),H, ) $<
 # and then retouch the generated files.
 rustdoc: rustdoc-core rustdoc-macros rustdoc-compiler_builtins \
     rustdoc-kernel rustdoc-pin_init
+	$(Q)grep -Ehro '<a href="srctree/([^"]+)"' $(rustdoc_output) | \
+		cut -d'"' -f2 | cut -d/ -f2- | while read f; do \
+			if [ ! -e "$(srctree)/$$f" ]; then \
+				echo "warning: srctree/ link to $$f does not exist"; \
+			fi \
+		done
 	$(Q)cp $(srctree)/Documentation/images/logo.svg $(rustdoc_output)/static.files/
 	$(Q)cp $(srctree)/Documentation/images/COPYING-logo $(rustdoc_output)/static.files/
 	$(Q)find $(rustdoc_output) -name '*.html' -type f -print0 | xargs -0 sed -Ei \
@@ -193,12 +199,12 @@ rusttestlib-kernel: $(src)/kernel/lib.rs rusttestlib-bindings rusttestlib-uapi \
     $(obj)/bindings.o FORCE
 	+$(call if_changed,rustc_test_library)
 
-rusttestlib-bindings: private rustc_target_flags = --extern ffi
-rusttestlib-bindings: $(src)/bindings/lib.rs rusttestlib-ffi FORCE
+rusttestlib-bindings: private rustc_target_flags = --extern ffi --extern pin_init
+rusttestlib-bindings: $(src)/bindings/lib.rs rusttestlib-ffi rusttestlib-pin_init FORCE
 	+$(call if_changed,rustc_test_library)
 
-rusttestlib-uapi: private rustc_target_flags = --extern ffi
-rusttestlib-uapi: $(src)/uapi/lib.rs rusttestlib-ffi FORCE
+rusttestlib-uapi: private rustc_target_flags = --extern ffi --extern pin_init
+rusttestlib-uapi: $(src)/uapi/lib.rs rusttestlib-ffi rusttestlib-pin_init FORCE
 	+$(call if_changed,rustc_test_library)
 
 quiet_cmd_rustdoc_test = RUSTDOC T $<
@@ -248,7 +254,7 @@ quiet_cmd_rustc_test = $(RUSTC_OR_CLIPPY_QUIET) T  $<
 	$(objtree)/$(obj)/test/$(subst rusttest-,,$@) $(rust_test_quiet) \
 		$(rustc_test_run_flags)
 
-rusttest: rusttest-macros rusttest-kernel
+rusttest: rusttest-macros
 
 rusttest-macros: private rustc_target_flags = --extern proc_macro \
 	--extern macros --extern kernel --extern pin_init
@@ -258,13 +264,6 @@ rusttest-macros: $(src)/macros/lib.rs \
 	+$(call if_changed,rustc_test)
 	+$(call if_changed,rustdoc_test)
 
-rusttest-kernel: private rustc_target_flags = --extern ffi --extern pin_init \
-    --extern build_error --extern macros --extern bindings --extern uapi
-rusttest-kernel: $(src)/kernel/lib.rs rusttestlib-ffi rusttestlib-kernel \
-    rusttestlib-build_error rusttestlib-macros rusttestlib-bindings \
-    rusttestlib-uapi rusttestlib-pin_init FORCE
-	+$(call if_changed,rustc_test)
-
 ifdef CONFIG_CC_IS_CLANG
 bindgen_c_flags = $(c_flags)
 else
@@ -531,17 +530,19 @@ $(obj)/ffi.o: private skip_gendwarfksyms = 1
 $(obj)/ffi.o: $(src)/ffi.rs $(obj)/compiler_builtins.o FORCE
 	+$(call if_changed_rule,rustc_library)
 
-$(obj)/bindings.o: private rustc_target_flags = --extern ffi
+$(obj)/bindings.o: private rustc_target_flags = --extern ffi --extern pin_init
 $(obj)/bindings.o: $(src)/bindings/lib.rs \
     $(obj)/ffi.o \
+    $(obj)/pin_init.o \
     $(obj)/bindings/bindings_generated.rs \
     $(obj)/bindings/bindings_helpers_generated.rs FORCE
 	+$(call if_changed_rule,rustc_library)
 
-$(obj)/uapi.o: private rustc_target_flags = --extern ffi
+$(obj)/uapi.o: private rustc_target_flags = --extern ffi --extern pin_init
 $(obj)/uapi.o: private skip_gendwarfksyms = 1
 $(obj)/uapi.o: $(src)/uapi/lib.rs \
     $(obj)/ffi.o \
+    $(obj)/pin_init.o \
     $(obj)/uapi/uapi_generated.rs FORCE
 	+$(call if_changed_rule,rustc_library)
 
diff --git a/rust/bindgen_parameters b/rust/bindgen_parameters
index 0f96af8b9a7f..e13c6f9dd17b 100644
--- a/rust/bindgen_parameters
+++ b/rust/bindgen_parameters
@@ -34,3 +34,8 @@
 # We use const helpers to aid bindgen, to avoid conflicts when constants are
 # recognized, block generation of the non-helper constants.
 --blocklist-item ARCH_SLAB_MINALIGN
+--blocklist-item ARCH_KMALLOC_MINALIGN
+
+# Structs should implement `Zeroable` when all of their fields do.
+--with-derive-custom-struct .*=MaybeZeroable
+--with-derive-custom-union .*=MaybeZeroable
diff --git a/rust/bindings/bindings_helper.h b/rust/bindings/bindings_helper.h
index 95e444c8508f..04b75d4d01c3 100644
--- a/rust/bindings/bindings_helper.h
+++ b/rust/bindings/bindings_helper.h
@@ -36,6 +36,7 @@
 #include <drm/drm_ioctl.h>
 #include <kunit/test.h>
 #include <linux/auxiliary_bus.h>
+#include <linux/bitmap.h>
 #include <linux/blk-mq.h>
 #include <linux/blk_types.h>
 #include <linux/blkdev.h>
@@ -71,6 +72,7 @@
 #include <linux/pm_opp.h>
 #include <linux/poll.h>
 #include <linux/property.h>
+#include <linux/random.h>
 #include <linux/refcount.h>
 #include <linux/regulator/consumer.h>
 #include <linux/sched.h>
@@ -90,6 +92,7 @@
 
 /* `bindgen` gets confused at certain things. */
 const size_t RUST_CONST_HELPER_ARCH_SLAB_MINALIGN = ARCH_SLAB_MINALIGN;
+const size_t RUST_CONST_HELPER_ARCH_KMALLOC_MINALIGN = ARCH_KMALLOC_MINALIGN;
 const size_t RUST_CONST_HELPER_PAGE_SIZE = PAGE_SIZE;
 const gfp_t RUST_CONST_HELPER_GFP_ATOMIC = GFP_ATOMIC;
 const gfp_t RUST_CONST_HELPER_GFP_KERNEL = GFP_KERNEL;
diff --git a/rust/bindings/lib.rs b/rust/bindings/lib.rs
index 474cc98c48a3..0c57cf9b4004 100644
--- a/rust/bindings/lib.rs
+++ b/rust/bindings/lib.rs
@@ -31,11 +31,19 @@
 #[allow(clippy::undocumented_unsafe_blocks)]
 #[cfg_attr(CONFIG_RUSTC_HAS_UNNECESSARY_TRANSMUTES, allow(unnecessary_transmutes))]
 mod bindings_raw {
+    use pin_init::{MaybeZeroable, Zeroable};
+
     // Manual definition for blocklisted types.
     type __kernel_size_t = usize;
     type __kernel_ssize_t = isize;
     type __kernel_ptrdiff_t = isize;
 
+    // `bindgen` doesn't automatically do this, see
+    // <https://github.com/rust-lang/rust-bindgen/issues/3196>
+    //
+    // SAFETY: `__BindgenBitfieldUnit<Storage>` is a newtype around `Storage`.
+    unsafe impl<Storage> Zeroable for __BindgenBitfieldUnit<Storage> where Storage: Zeroable {}
+
     // Use glob import here to expose all helpers.
     // Symbols defined within the module will take precedence to the glob import.
     pub use super::bindings_helper::*;
diff --git a/rust/helpers/bitmap.c b/rust/helpers/bitmap.c
new file mode 100644
index 000000000000..a50e2f082e47
--- /dev/null
+++ b/rust/helpers/bitmap.c
@@ -0,0 +1,9 @@
+// SPDX-License-Identifier: GPL-2.0
+
+#include <linux/bitmap.h>
+
+void rust_helper_bitmap_copy_and_extend(unsigned long *to, const unsigned long *from,
+		unsigned int count, unsigned int size)
+{
+	bitmap_copy_and_extend(to, from, count, size);
+}
diff --git a/rust/helpers/bitops.c b/rust/helpers/bitops.c
new file mode 100644
index 000000000000..5d0861d29d3f
--- /dev/null
+++ b/rust/helpers/bitops.c
@@ -0,0 +1,23 @@
+// SPDX-License-Identifier: GPL-2.0
+
+#include <linux/bitops.h>
+
+void rust_helper___set_bit(unsigned long nr, unsigned long *addr)
+{
+	__set_bit(nr, addr);
+}
+
+void rust_helper___clear_bit(unsigned long nr, unsigned long *addr)
+{
+	__clear_bit(nr, addr);
+}
+
+void rust_helper_set_bit(unsigned long nr, volatile unsigned long *addr)
+{
+	set_bit(nr, addr);
+}
+
+void rust_helper_clear_bit(unsigned long nr, volatile unsigned long *addr)
+{
+	clear_bit(nr, addr);
+}
diff --git a/rust/helpers/helpers.c b/rust/helpers/helpers.c
index 3d7d0b40c9f1..551da6c9b506 100644
--- a/rust/helpers/helpers.c
+++ b/rust/helpers/helpers.c
@@ -11,6 +11,8 @@
 #include "auxiliary.c"
 #include "barrier.c"
 #include "binder.c"
+#include "bitmap.c"
+#include "bitops.c"
 #include "blk.c"
 #include "bug.c"
 #include "build_assert.c"
diff --git a/rust/kernel/acpi.rs b/rust/kernel/acpi.rs
index 7ae317368b00..37e1161c1298 100644
--- a/rust/kernel/acpi.rs
+++ b/rust/kernel/acpi.rs
@@ -37,11 +37,8 @@ impl DeviceId {
     /// Create a new device id from an ACPI 'id' string.
     #[inline(always)]
     pub const fn new(id: &'static CStr) -> Self {
-        build_assert!(
-            id.len_with_nul() <= Self::ACPI_ID_LEN,
-            "ID exceeds 16 bytes"
-        );
-        let src = id.as_bytes_with_nul();
+        let src = id.to_bytes_with_nul();
+        build_assert!(src.len() <= Self::ACPI_ID_LEN, "ID exceeds 16 bytes");
         // Replace with `bindings::acpi_device_id::default()` once stabilized for `const`.
         // SAFETY: FFI type is valid to be zero-initialized.
         let mut acpi: bindings::acpi_device_id = unsafe { core::mem::zeroed() };
diff --git a/rust/kernel/alloc.rs b/rust/kernel/alloc.rs
index b39c279236f5..e38720349dcf 100644
--- a/rust/kernel/alloc.rs
+++ b/rust/kernel/alloc.rs
@@ -2,18 +2,11 @@
 
 //! Implementation of the kernel's memory allocation infrastructure.
 
-#[cfg(not(any(test, testlib)))]
 pub mod allocator;
 pub mod kbox;
 pub mod kvec;
 pub mod layout;
 
-#[cfg(any(test, testlib))]
-pub mod allocator_test;
-
-#[cfg(any(test, testlib))]
-pub use self::allocator_test as allocator;
-
 pub use self::kbox::Box;
 pub use self::kbox::KBox;
 pub use self::kbox::KVBox;
@@ -164,6 +157,14 @@ impl NumaNode {
 /// - Implementers must ensure that all trait functions abide by the guarantees documented in the
 ///   `# Guarantees` sections.
 pub unsafe trait Allocator {
+    /// The minimum alignment satisfied by all allocations from this allocator.
+    ///
+    /// # Guarantees
+    ///
+    /// Any pointer allocated by this allocator is guaranteed to be aligned to `MIN_ALIGN` even if
+    /// the requested layout has a smaller alignment.
+    const MIN_ALIGN: usize;
+
     /// Allocate memory based on `layout`, `flags` and `nid`.
     ///
     /// On success, returns a buffer represented as `NonNull<[u8]>` that satisfies the layout
diff --git a/rust/kernel/alloc/allocator.rs b/rust/kernel/alloc/allocator.rs
index 39c1cfbaf235..e3bca62fe237 100644
--- a/rust/kernel/alloc/allocator.rs
+++ b/rust/kernel/alloc/allocator.rs
@@ -20,6 +20,8 @@
 mod iter;
 pub use self::iter::VmallocPageIter;
 
+const ARCH_KMALLOC_MINALIGN: usize = bindings::ARCH_KMALLOC_MINALIGN;
+
 /// The contiguous kernel allocator.
 ///
 /// `Kmalloc` is typically used for physically contiguous allocations up to page size, but also
@@ -138,6 +140,8 @@ pub fn aligned_layout(layout: Layout) -> Layout {
 // - passing a pointer to a valid memory allocation is OK,
 // - `realloc` satisfies the guarantees, since `ReallocFunc::call` has the same.
 unsafe impl Allocator for Kmalloc {
+    const MIN_ALIGN: usize = ARCH_KMALLOC_MINALIGN;
+
     #[inline]
     unsafe fn realloc(
         ptr: Option<NonNull<u8>>,
@@ -206,6 +210,8 @@ pub unsafe fn to_page<'a>(ptr: NonNull<u8>) -> page::BorrowedPage<'a> {
 // - passing a pointer to a valid memory allocation is OK,
 // - `realloc` satisfies the guarantees, since `ReallocFunc::call` has the same.
 unsafe impl Allocator for Vmalloc {
+    const MIN_ALIGN: usize = kernel::page::PAGE_SIZE;
+
     #[inline]
     unsafe fn realloc(
         ptr: Option<NonNull<u8>>,
@@ -225,6 +231,8 @@ unsafe fn realloc(
 // - passing a pointer to a valid memory allocation is OK,
 // - `realloc` satisfies the guarantees, since `ReallocFunc::call` has the same.
 unsafe impl Allocator for KVmalloc {
+    const MIN_ALIGN: usize = ARCH_KMALLOC_MINALIGN;
+
     #[inline]
     unsafe fn realloc(
         ptr: Option<NonNull<u8>>,
diff --git a/rust/kernel/alloc/allocator_test.rs b/rust/kernel/alloc/allocator_test.rs
deleted file mode 100644
index ad52a32d0560..000000000000
--- a/rust/kernel/alloc/allocator_test.rs
+++ /dev/null
@@ -1,154 +0,0 @@
-// SPDX-License-Identifier: GPL-2.0
-
-//! So far the kernel's `Box` and `Vec` types can't be used by userspace test cases, since all users
-//! of those types (e.g. `CString`) use kernel allocators for instantiation.
-//!
-//! In order to allow userspace test cases to make use of such types as well, implement the
-//! `Cmalloc` allocator within the `allocator_test` module and type alias all kernel allocators to
-//! `Cmalloc`. The `Cmalloc` allocator uses libc's `realloc()` function as allocator backend.
-
-#![allow(missing_docs)]
-
-use super::{flags::*, AllocError, Allocator, Flags, NumaNode};
-use core::alloc::Layout;
-use core::cmp;
-use core::marker::PhantomData;
-use core::ptr;
-use core::ptr::NonNull;
-use kernel::page;
-
-/// The userspace allocator based on libc.
-pub struct Cmalloc;
-
-pub type Kmalloc = Cmalloc;
-pub type Vmalloc = Kmalloc;
-pub type KVmalloc = Kmalloc;
-
-impl Cmalloc {
-    /// Returns a [`Layout`] that makes [`Kmalloc`] fulfill the requested size and alignment of
-    /// `layout`.
-    pub fn aligned_layout(layout: Layout) -> Layout {
-        // Note that `layout.size()` (after padding) is guaranteed to be a multiple of
-        // `layout.align()` which together with the slab guarantees means that `Kmalloc` will return
-        // a properly aligned object (see comments in `kmalloc()` for more information).
-        layout.pad_to_align()
-    }
-}
-
-pub struct VmallocPageIter<'a> {
-    _p: PhantomData<page::BorrowedPage<'a>>,
-}
-
-impl<'a> Iterator for VmallocPageIter<'a> {
-    type Item = page::BorrowedPage<'a>;
-
-    fn next(&mut self) -> Option<Self::Item> {
-        None
-    }
-}
-
-impl<'a> VmallocPageIter<'a> {
-    #[allow(clippy::missing_safety_doc)]
-    pub unsafe fn new(_buf: NonNull<u8>, _size: usize) -> Self {
-        Self { _p: PhantomData }
-    }
-
-    pub fn size(&self) -> usize {
-        0
-    }
-
-    pub fn page_count(&self) -> usize {
-        0
-    }
-}
-
-extern "C" {
-    #[link_name = "aligned_alloc"]
-    fn libc_aligned_alloc(align: usize, size: usize) -> *mut crate::ffi::c_void;
-
-    #[link_name = "free"]
-    fn libc_free(ptr: *mut crate::ffi::c_void);
-}
-
-// SAFETY:
-// - memory remains valid until it is explicitly freed,
-// - passing a pointer to a valid memory allocation created by this `Allocator` is always OK,
-// - `realloc` provides the guarantees as provided in the `# Guarantees` section.
-unsafe impl Allocator for Cmalloc {
-    unsafe fn realloc(
-        ptr: Option<NonNull<u8>>,
-        layout: Layout,
-        old_layout: Layout,
-        flags: Flags,
-        _nid: NumaNode,
-    ) -> Result<NonNull<[u8]>, AllocError> {
-        let src = match ptr {
-            Some(src) => {
-                if old_layout.size() == 0 {
-                    ptr::null_mut()
-                } else {
-                    src.as_ptr()
-                }
-            }
-            None => ptr::null_mut(),
-        };
-
-        if layout.size() == 0 {
-            // SAFETY: `src` is either NULL or was previously allocated with this `Allocator`
-            unsafe { libc_free(src.cast()) };
-
-            return Ok(NonNull::slice_from_raw_parts(
-                crate::alloc::dangling_from_layout(layout),
-                0,
-            ));
-        }
-
-        // ISO C (ISO/IEC 9899:2011) defines `aligned_alloc`:
-        //
-        // > The value of alignment shall be a valid alignment supported by the implementation
-        // [...].
-        //
-        // As an example of the "supported by the implementation" requirement, POSIX.1-2001 (IEEE
-        // 1003.1-2001) defines `posix_memalign`:
-        //
-        // > The value of alignment shall be a power of two multiple of sizeof (void *).
-        //
-        // and POSIX-based implementations of `aligned_alloc` inherit this requirement. At the time
-        // of writing, this is known to be the case on macOS (but not in glibc).
-        //
-        // Satisfy the stricter requirement to avoid spurious test failures on some platforms.
-        let min_align = core::mem::size_of::<*const crate::ffi::c_void>();
-        let layout = layout.align_to(min_align).map_err(|_| AllocError)?;
-        let layout = layout.pad_to_align();
-
-        // SAFETY: Returns either NULL or a pointer to a memory allocation that satisfies or
-        // exceeds the given size and alignment requirements.
-        let dst = unsafe { libc_aligned_alloc(layout.align(), layout.size()) }.cast::<u8>();
-        let dst = NonNull::new(dst).ok_or(AllocError)?;
-
-        if flags.contains(__GFP_ZERO) {
-            // SAFETY: The preceding calls to `libc_aligned_alloc` and `NonNull::new`
-            // guarantee that `dst` points to memory of at least `layout.size()` bytes.
-            unsafe { dst.as_ptr().write_bytes(0, layout.size()) };
-        }
-
-        if !src.is_null() {
-            // SAFETY:
-            // - `src` has previously been allocated with this `Allocator`; `dst` has just been
-            //   newly allocated, hence the memory regions do not overlap.
-            // - both` src` and `dst` are properly aligned and valid for reads and writes
-            unsafe {
-                ptr::copy_nonoverlapping(
-                    src,
-                    dst.as_ptr(),
-                    cmp::min(layout.size(), old_layout.size()),
-                )
-            };
-        }
-
-        // SAFETY: `src` is either NULL or was previously allocated with this `Allocator`
-        unsafe { libc_free(src.cast()) };
-
-        Ok(NonNull::slice_from_raw_parts(dst, layout.size()))
-    }
-}
diff --git a/rust/kernel/alloc/kbox.rs b/rust/kernel/alloc/kbox.rs
index 1371a397c593..622b3529edfc 100644
--- a/rust/kernel/alloc/kbox.rs
+++ b/rust/kernel/alloc/kbox.rs
@@ -7,7 +7,6 @@
 use super::{AllocError, Allocator, Flags, NumaNode};
 use core::alloc::Layout;
 use core::borrow::{Borrow, BorrowMut};
-use core::fmt;
 use core::marker::PhantomData;
 use core::mem::ManuallyDrop;
 use core::mem::MaybeUninit;
@@ -17,6 +16,7 @@
 use core::result::Result;
 
 use crate::ffi::c_void;
+use crate::fmt;
 use crate::init::InPlaceInit;
 use crate::page::AsPageIter;
 use crate::types::ForeignOwnable;
@@ -291,6 +291,83 @@ pub fn pin(x: T, flags: Flags) -> Result<Pin<Box<T, A>>, AllocError>
         Ok(Self::new(x, flags)?.into())
     }
 
+    /// Construct a pinned slice of elements `Pin<Box<[T], A>>`.
+    ///
+    /// This is a convenient means for creation of e.g. slices of structrures containing spinlocks
+    /// or mutexes.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::sync::{new_spinlock, SpinLock};
+    ///
+    /// struct Inner {
+    ///     a: u32,
+    ///     b: u32,
+    /// }
+    ///
+    /// #[pin_data]
+    /// struct Example {
+    ///     c: u32,
+    ///     #[pin]
+    ///     d: SpinLock<Inner>,
+    /// }
+    ///
+    /// impl Example {
+    ///     fn new() -> impl PinInit<Self, Error> {
+    ///         try_pin_init!(Self {
+    ///             c: 10,
+    ///             d <- new_spinlock!(Inner { a: 20, b: 30 }),
+    ///         })
+    ///     }
+    /// }
+    ///
+    /// // Allocate a boxed slice of 10 `Example`s.
+    /// let s = KBox::pin_slice(
+    ///     | _i | Example::new(),
+    ///     10,
+    ///     GFP_KERNEL
+    /// )?;
+    ///
+    /// assert_eq!(s[5].c, 10);
+    /// assert_eq!(s[3].d.lock().a, 20);
+    /// # Ok::<(), Error>(())
+    /// ```
+    pub fn pin_slice<Func, Item, E>(
+        mut init: Func,
+        len: usize,
+        flags: Flags,
+    ) -> Result<Pin<Box<[T], A>>, E>
+    where
+        Func: FnMut(usize) -> Item,
+        Item: PinInit<T, E>,
+        E: From<AllocError>,
+    {
+        let mut buffer = super::Vec::<T, A>::with_capacity(len, flags)?;
+        for i in 0..len {
+            let ptr = buffer.spare_capacity_mut().as_mut_ptr().cast();
+            // SAFETY:
+            // - `ptr` is a valid pointer to uninitialized memory.
+            // - `ptr` is not used if an error is returned.
+            // - `ptr` won't be moved until it is dropped, i.e. it is pinned.
+            unsafe { init(i).__pinned_init(ptr)? };
+
+            // SAFETY:
+            // - `i + 1 <= len`, hence we don't exceed the capacity, due to the call to
+            //   `with_capacity()` above.
+            // - The new value at index buffer.len() + 1 is the only element being added here, and
+            //   it has been initialized above by `init(i).__pinned_init(ptr)`.
+            unsafe { buffer.inc_len(1) };
+        }
+
+        let (ptr, _, _) = buffer.into_raw_parts();
+        let slice = core::ptr::slice_from_raw_parts_mut(ptr, len);
+
+        // SAFETY: `slice` points to an allocation allocated with `A` (`buffer`) and holds a valid
+        // `[T]`.
+        Ok(Pin::from(unsafe { Box::from_raw(slice) }))
+    }
+
     /// Convert a [`Box<T,A>`] to a [`Pin<Box<T,A>>`]. If `T` does not implement
     /// [`Unpin`], then `x` will be pinned in memory and can't be moved.
     pub fn into_pin(this: Self) -> Pin<Self> {
@@ -402,12 +479,17 @@ fn try_init<E>(init: impl Init<T, E>, flags: Flags) -> Result<Self, E>
 }
 
 // SAFETY: The pointer returned by `into_foreign` comes from a well aligned
-// pointer to `T`.
+// pointer to `T` allocated by `A`.
 unsafe impl<T: 'static, A> ForeignOwnable for Box<T, A>
 where
     A: Allocator,
 {
-    const FOREIGN_ALIGN: usize = core::mem::align_of::<T>();
+    const FOREIGN_ALIGN: usize = if core::mem::align_of::<T>() < A::MIN_ALIGN {
+        A::MIN_ALIGN
+    } else {
+        core::mem::align_of::<T>()
+    };
+
     type Borrowed<'a> = &'a T;
     type BorrowedMut<'a> = &'a mut T;
 
@@ -436,12 +518,12 @@ unsafe fn borrow_mut<'a>(ptr: *mut c_void) -> &'a mut T {
 }
 
 // SAFETY: The pointer returned by `into_foreign` comes from a well aligned
-// pointer to `T`.
+// pointer to `T` allocated by `A`.
 unsafe impl<T: 'static, A> ForeignOwnable for Pin<Box<T, A>>
 where
     A: Allocator,
 {
-    const FOREIGN_ALIGN: usize = core::mem::align_of::<T>();
+    const FOREIGN_ALIGN: usize = <Box<T, A> as ForeignOwnable>::FOREIGN_ALIGN;
     type Borrowed<'a> = Pin<&'a T>;
     type BorrowedMut<'a> = Pin<&'a mut T>;
 
diff --git a/rust/kernel/alloc/kvec.rs b/rust/kernel/alloc/kvec.rs
index 38ed271b1d04..2cc147a4cb88 100644
--- a/rust/kernel/alloc/kvec.rs
+++ b/rust/kernel/alloc/kvec.rs
@@ -7,10 +7,10 @@
     layout::ArrayLayout,
     AllocError, Allocator, Box, Flags, NumaNode,
 };
+use crate::fmt;
 use crate::page::AsPageIter;
 use core::{
     borrow::{Borrow, BorrowMut},
-    fmt,
     marker::PhantomData,
     mem::{ManuallyDrop, MaybeUninit},
     ops::Deref,
@@ -176,7 +176,7 @@ const fn is_zst() -> bool {
 
     /// Returns the number of elements that can be stored within the vector without allocating
     /// additional memory.
-    pub fn capacity(&self) -> usize {
+    pub const fn capacity(&self) -> usize {
         if const { Self::is_zst() } {
             usize::MAX
         } else {
@@ -186,7 +186,7 @@ pub fn capacity(&self) -> usize {
 
     /// Returns the number of elements stored within the vector.
     #[inline]
-    pub fn len(&self) -> usize {
+    pub const fn len(&self) -> usize {
         self.len
     }
 
@@ -197,7 +197,7 @@ pub fn len(&self) -> usize {
     /// - `additional` must be less than or equal to `self.capacity - self.len`.
     /// - All elements within the interval [`self.len`,`self.len + additional`) must be initialized.
     #[inline]
-    pub unsafe fn inc_len(&mut self, additional: usize) {
+    pub const unsafe fn inc_len(&mut self, additional: usize) {
         // Guaranteed by the type invariant to never underflow.
         debug_assert!(additional <= self.capacity() - self.len());
         // INVARIANT: By the safety requirements of this method this represents the exact number of
@@ -225,6 +225,16 @@ unsafe fn dec_len(&mut self, count: usize) -> &mut [T] {
     }
 
     /// Returns a slice of the entire vector.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// let mut v = KVec::new();
+    /// v.push(1, GFP_KERNEL)?;
+    /// v.push(2, GFP_KERNEL)?;
+    /// assert_eq!(v.as_slice(), &[1, 2]);
+    /// # Ok::<(), Error>(())
+    /// ```
     #[inline]
     pub fn as_slice(&self) -> &[T] {
         self
@@ -246,7 +256,7 @@ pub fn as_mut_ptr(&mut self) -> *mut T {
     /// Returns a raw pointer to the vector's backing buffer, or, if `T` is a ZST, a dangling raw
     /// pointer.
     #[inline]
-    pub fn as_ptr(&self) -> *const T {
+    pub const fn as_ptr(&self) -> *const T {
         self.ptr.as_ptr()
     }
 
@@ -262,7 +272,7 @@ pub fn as_ptr(&self) -> *const T {
     /// assert!(!v.is_empty());
     /// ```
     #[inline]
-    pub fn is_empty(&self) -> bool {
+    pub const fn is_empty(&self) -> bool {
         self.len() == 0
     }
 
@@ -1339,7 +1349,7 @@ fn drop(&mut self) {
     }
 }
 
-#[macros::kunit_tests(rust_kvec_kunit)]
+#[macros::kunit_tests(rust_kvec)]
 mod tests {
     use super::*;
     use crate::prelude::*;
diff --git a/rust/kernel/alloc/kvec/errors.rs b/rust/kernel/alloc/kvec/errors.rs
index 348b8d27e102..21a920a4b09b 100644
--- a/rust/kernel/alloc/kvec/errors.rs
+++ b/rust/kernel/alloc/kvec/errors.rs
@@ -2,7 +2,7 @@
 
 //! Errors for the [`Vec`] type.
 
-use core::fmt::{self, Debug, Formatter};
+use kernel::fmt::{self, Debug, Formatter};
 use kernel::prelude::*;
 
 /// Error type for [`Vec::push_within_capacity`].
diff --git a/rust/kernel/alloc/layout.rs b/rust/kernel/alloc/layout.rs
index 666accb7859c..9f8be72feb7a 100644
--- a/rust/kernel/alloc/layout.rs
+++ b/rust/kernel/alloc/layout.rs
@@ -80,7 +80,7 @@ pub const fn new(len: usize) -> Result<Self, LayoutError> {
     /// # Safety
     ///
     /// `len` must be a value, for which `len * size_of::<T>() <= isize::MAX` is true.
-    pub unsafe fn new_unchecked(len: usize) -> Self {
+    pub const unsafe fn new_unchecked(len: usize) -> Self {
         // INVARIANT: By the safety requirements of this function
         // `len * size_of::<T>() <= isize::MAX`.
         Self {
diff --git a/rust/kernel/auxiliary.rs b/rust/kernel/auxiliary.rs
index 8dc7490a79a4..e11848bbf206 100644
--- a/rust/kernel/auxiliary.rs
+++ b/rust/kernel/auxiliary.rs
@@ -105,8 +105,8 @@ macro_rules! module_auxiliary_driver {
 impl DeviceId {
     /// Create a new [`DeviceId`] from name.
     pub const fn new(modname: &'static CStr, name: &'static CStr) -> Self {
-        let name = name.as_bytes_with_nul();
-        let modname = modname.as_bytes_with_nul();
+        let name = name.to_bytes_with_nul();
+        let modname = modname.to_bytes_with_nul();
 
         // TODO: Replace with `bindings::auxiliary_device_id::default()` once stabilized for
         // `const`.
diff --git a/rust/kernel/bitmap.rs b/rust/kernel/bitmap.rs
new file mode 100644
index 000000000000..f45915694454
--- /dev/null
+++ b/rust/kernel/bitmap.rs
@@ -0,0 +1,600 @@
+// SPDX-License-Identifier: GPL-2.0
+
+// Copyright (C) 2025 Google LLC.
+
+//! Rust API for bitmap.
+//!
+//! C headers: [`include/linux/bitmap.h`](srctree/include/linux/bitmap.h).
+
+use crate::alloc::{AllocError, Flags};
+use crate::bindings;
+#[cfg(not(CONFIG_RUST_BITMAP_HARDENED))]
+use crate::pr_err;
+use core::ptr::NonNull;
+
+const BITS_PER_LONG: usize = bindings::BITS_PER_LONG as usize;
+
+/// Represents a C bitmap. Wraps underlying C bitmap API.
+///
+/// # Invariants
+///
+/// Must reference a `[c_ulong]` long enough to fit `data.len()` bits.
+#[cfg_attr(CONFIG_64BIT, repr(align(8)))]
+#[cfg_attr(not(CONFIG_64BIT), repr(align(4)))]
+pub struct Bitmap {
+    data: [()],
+}
+
+impl Bitmap {
+    /// Borrows a C bitmap.
+    ///
+    /// # Safety
+    ///
+    /// * `ptr` holds a non-null address of an initialized array of `unsigned long`
+    ///   that is large enough to hold `nbits` bits.
+    /// * the array must not be freed for the lifetime of this [`Bitmap`]
+    /// * concurrent access only happens through atomic operations
+    pub unsafe fn from_raw<'a>(ptr: *const usize, nbits: usize) -> &'a Bitmap {
+        let data: *const [()] = core::ptr::slice_from_raw_parts(ptr.cast(), nbits);
+        // INVARIANT: `data` references an initialized array that can hold `nbits` bits.
+        // SAFETY:
+        // The caller guarantees that `data` (derived from `ptr` and `nbits`)
+        // points to a valid, initialized, and appropriately sized memory region
+        // that will not be freed for the lifetime 'a.
+        // We are casting `*const [()]` to `*const Bitmap`. The `Bitmap`
+        // struct is a ZST with a `data: [()]` field. This means its layout
+        // is compatible with a slice of `()`, and effectively it's a "thin pointer"
+        // (its size is 0 and alignment is 1). The `slice_from_raw_parts`
+        // function correctly encodes the length (number of bits, not elements)
+        // into the metadata of the fat pointer. Therefore, dereferencing this
+        // pointer as `&Bitmap` is safe given the caller's guarantees.
+        unsafe { &*(data as *const Bitmap) }
+    }
+
+    /// Borrows a C bitmap exclusively.
+    ///
+    /// # Safety
+    ///
+    /// * `ptr` holds a non-null address of an initialized array of `unsigned long`
+    ///   that is large enough to hold `nbits` bits.
+    /// * the array must not be freed for the lifetime of this [`Bitmap`]
+    /// * no concurrent access may happen.
+    pub unsafe fn from_raw_mut<'a>(ptr: *mut usize, nbits: usize) -> &'a mut Bitmap {
+        let data: *mut [()] = core::ptr::slice_from_raw_parts_mut(ptr.cast(), nbits);
+        // INVARIANT: `data` references an initialized array that can hold `nbits` bits.
+        // SAFETY:
+        // The caller guarantees that `data` (derived from `ptr` and `nbits`)
+        // points to a valid, initialized, and appropriately sized memory region
+        // that will not be freed for the lifetime 'a.
+        // Furthermore, the caller guarantees no concurrent access will happen,
+        // which upholds the exclusivity requirement for a mutable reference.
+        // Similar to `from_raw`, casting `*mut [()]` to `*mut Bitmap` is
+        // safe because `Bitmap` is a ZST with a `data: [()]` field,
+        // making its layout compatible with a slice of `()`.
+        unsafe { &mut *(data as *mut Bitmap) }
+    }
+
+    /// Returns a raw pointer to the backing [`Bitmap`].
+    pub fn as_ptr(&self) -> *const usize {
+        core::ptr::from_ref::<Bitmap>(self).cast::<usize>()
+    }
+
+    /// Returns a mutable raw pointer to the backing [`Bitmap`].
+    pub fn as_mut_ptr(&mut self) -> *mut usize {
+        core::ptr::from_mut::<Bitmap>(self).cast::<usize>()
+    }
+
+    /// Returns length of this [`Bitmap`].
+    #[expect(clippy::len_without_is_empty)]
+    pub fn len(&self) -> usize {
+        self.data.len()
+    }
+}
+
+/// Holds either a pointer to array of `unsigned long` or a small bitmap.
+#[repr(C)]
+union BitmapRepr {
+    bitmap: usize,
+    ptr: NonNull<usize>,
+}
+
+macro_rules! bitmap_assert {
+    ($cond:expr, $($arg:tt)+) => {
+        #[cfg(CONFIG_RUST_BITMAP_HARDENED)]
+        assert!($cond, $($arg)*);
+    }
+}
+
+macro_rules! bitmap_assert_return {
+    ($cond:expr, $($arg:tt)+) => {
+        #[cfg(CONFIG_RUST_BITMAP_HARDENED)]
+        assert!($cond, $($arg)*);
+
+        #[cfg(not(CONFIG_RUST_BITMAP_HARDENED))]
+        if !($cond) {
+            pr_err!($($arg)*);
+            return
+        }
+    }
+}
+
+/// Represents an owned bitmap.
+///
+/// Wraps underlying C bitmap API. See [`Bitmap`] for available
+/// methods.
+///
+/// # Examples
+///
+/// Basic usage
+///
+/// ```
+/// use kernel::alloc::flags::GFP_KERNEL;
+/// use kernel::bitmap::BitmapVec;
+///
+/// let mut b = BitmapVec::new(16, GFP_KERNEL)?;
+///
+/// assert_eq!(16, b.len());
+/// for i in 0..16 {
+///     if i % 4 == 0 {
+///       b.set_bit(i);
+///     }
+/// }
+/// assert_eq!(Some(0), b.next_bit(0));
+/// assert_eq!(Some(1), b.next_zero_bit(0));
+/// assert_eq!(Some(4), b.next_bit(1));
+/// assert_eq!(Some(5), b.next_zero_bit(4));
+/// assert_eq!(Some(12), b.last_bit());
+/// # Ok::<(), Error>(())
+/// ```
+///
+/// # Invariants
+///
+/// * `nbits` is `<= i32::MAX` and never changes.
+/// * if `nbits <= bindings::BITS_PER_LONG`, then `repr` is a `usize`.
+/// * otherwise, `repr` holds a non-null pointer to an initialized
+///   array of `unsigned long` that is large enough to hold `nbits` bits.
+pub struct BitmapVec {
+    /// Representation of bitmap.
+    repr: BitmapRepr,
+    /// Length of this bitmap. Must be `<= i32::MAX`.
+    nbits: usize,
+}
+
+impl core::ops::Deref for BitmapVec {
+    type Target = Bitmap;
+
+    fn deref(&self) -> &Bitmap {
+        let ptr = if self.nbits <= BITS_PER_LONG {
+            // SAFETY: Bitmap is represented inline.
+            unsafe { core::ptr::addr_of!(self.repr.bitmap) }
+        } else {
+            // SAFETY: Bitmap is represented as array of `unsigned long`.
+            unsafe { self.repr.ptr.as_ptr() }
+        };
+
+        // SAFETY: We got the right pointer and invariants of [`Bitmap`] hold.
+        // An inline bitmap is treated like an array with single element.
+        unsafe { Bitmap::from_raw(ptr, self.nbits) }
+    }
+}
+
+impl core::ops::DerefMut for BitmapVec {
+    fn deref_mut(&mut self) -> &mut Bitmap {
+        let ptr = if self.nbits <= BITS_PER_LONG {
+            // SAFETY: Bitmap is represented inline.
+            unsafe { core::ptr::addr_of_mut!(self.repr.bitmap) }
+        } else {
+            // SAFETY: Bitmap is represented as array of `unsigned long`.
+            unsafe { self.repr.ptr.as_ptr() }
+        };
+
+        // SAFETY: We got the right pointer and invariants of [`BitmapVec`] hold.
+        // An inline bitmap is treated like an array with single element.
+        unsafe { Bitmap::from_raw_mut(ptr, self.nbits) }
+    }
+}
+
+/// Enable ownership transfer to other threads.
+///
+/// SAFETY: We own the underlying bitmap representation.
+unsafe impl Send for BitmapVec {}
+
+/// Enable unsynchronized concurrent access to [`BitmapVec`] through shared references.
+///
+/// SAFETY: `deref()` will return a reference to a [`Bitmap`]. Its methods
+/// take immutable references are either atomic or read-only.
+unsafe impl Sync for BitmapVec {}
+
+impl Drop for BitmapVec {
+    fn drop(&mut self) {
+        if self.nbits <= BITS_PER_LONG {
+            return;
+        }
+        // SAFETY: `self.ptr` was returned by the C `bitmap_zalloc`.
+        //
+        // INVARIANT: there is no other use of the `self.ptr` after this
+        // call and the value is being dropped so the broken invariant is
+        // not observable on function exit.
+        unsafe { bindings::bitmap_free(self.repr.ptr.as_ptr()) };
+    }
+}
+
+impl BitmapVec {
+    /// Constructs a new [`BitmapVec`].
+    ///
+    /// Fails with [`AllocError`] when the [`BitmapVec`] could not be allocated. This
+    /// includes the case when `nbits` is greater than `i32::MAX`.
+    #[inline]
+    pub fn new(nbits: usize, flags: Flags) -> Result<Self, AllocError> {
+        if nbits <= BITS_PER_LONG {
+            return Ok(BitmapVec {
+                repr: BitmapRepr { bitmap: 0 },
+                nbits,
+            });
+        }
+        if nbits > i32::MAX.try_into().unwrap() {
+            return Err(AllocError);
+        }
+        let nbits_u32 = u32::try_from(nbits).unwrap();
+        // SAFETY: `BITS_PER_LONG < nbits` and `nbits <= i32::MAX`.
+        let ptr = unsafe { bindings::bitmap_zalloc(nbits_u32, flags.as_raw()) };
+        let ptr = NonNull::new(ptr).ok_or(AllocError)?;
+        // INVARIANT: `ptr` returned by C `bitmap_zalloc` and `nbits` checked.
+        Ok(BitmapVec {
+            repr: BitmapRepr { ptr },
+            nbits,
+        })
+    }
+
+    /// Returns length of this [`Bitmap`].
+    #[allow(clippy::len_without_is_empty)]
+    #[inline]
+    pub fn len(&self) -> usize {
+        self.nbits
+    }
+
+    /// Fills this `Bitmap` with random bits.
+    #[cfg(CONFIG_FIND_BIT_BENCHMARK_RUST)]
+    pub fn fill_random(&mut self) {
+        // SAFETY: `self.as_mut_ptr` points to either an array of the
+        // appropriate length or one usize.
+        unsafe {
+            bindings::get_random_bytes(
+                self.as_mut_ptr().cast::<ffi::c_void>(),
+                usize::div_ceil(self.nbits, bindings::BITS_PER_LONG as usize)
+                    * bindings::BITS_PER_LONG as usize
+                    / 8,
+            );
+        }
+    }
+}
+
+impl Bitmap {
+    /// Set bit with index `index`.
+    ///
+    /// ATTENTION: `set_bit` is non-atomic, which differs from the naming
+    /// convention in C code. The corresponding C function is `__set_bit`.
+    ///
+    /// If CONFIG_RUST_BITMAP_HARDENED is not enabled and `index` is greater than
+    /// or equal to `self.nbits`, does nothing.
+    ///
+    /// # Panics
+    ///
+    /// Panics if CONFIG_RUST_BITMAP_HARDENED is enabled and `index` is greater than
+    /// or equal to `self.nbits`.
+    #[inline]
+    pub fn set_bit(&mut self, index: usize) {
+        bitmap_assert_return!(
+            index < self.len(),
+            "Bit `index` must be < {}, was {}",
+            self.len(),
+            index
+        );
+        // SAFETY: Bit `index` is within bounds.
+        unsafe { bindings::__set_bit(index, self.as_mut_ptr()) };
+    }
+
+    /// Set bit with index `index`, atomically.
+    ///
+    /// This is a relaxed atomic operation (no implied memory barriers).
+    ///
+    /// ATTENTION: The naming convention differs from C, where the corresponding
+    /// function is called `set_bit`.
+    ///
+    /// If CONFIG_RUST_BITMAP_HARDENED is not enabled and `index` is greater than
+    /// or equal to `self.len()`, does nothing.
+    ///
+    /// # Panics
+    ///
+    /// Panics if CONFIG_RUST_BITMAP_HARDENED is enabled and `index` is greater than
+    /// or equal to `self.len()`.
+    #[inline]
+    pub fn set_bit_atomic(&self, index: usize) {
+        bitmap_assert_return!(
+            index < self.len(),
+            "Bit `index` must be < {}, was {}",
+            self.len(),
+            index
+        );
+        // SAFETY: `index` is within bounds and the caller has ensured that
+        // there is no mix of non-atomic and atomic operations.
+        unsafe { bindings::set_bit(index, self.as_ptr().cast_mut()) };
+    }
+
+    /// Clear `index` bit.
+    ///
+    /// ATTENTION: `clear_bit` is non-atomic, which differs from the naming
+    /// convention in C code. The corresponding C function is `__clear_bit`.
+    ///
+    /// If CONFIG_RUST_BITMAP_HARDENED is not enabled and `index` is greater than
+    /// or equal to `self.len()`, does nothing.
+    ///
+    /// # Panics
+    ///
+    /// Panics if CONFIG_RUST_BITMAP_HARDENED is enabled and `index` is greater than
+    /// or equal to `self.len()`.
+    #[inline]
+    pub fn clear_bit(&mut self, index: usize) {
+        bitmap_assert_return!(
+            index < self.len(),
+            "Bit `index` must be < {}, was {}",
+            self.len(),
+            index
+        );
+        // SAFETY: `index` is within bounds.
+        unsafe { bindings::__clear_bit(index, self.as_mut_ptr()) };
+    }
+
+    /// Clear `index` bit, atomically.
+    ///
+    /// This is a relaxed atomic operation (no implied memory barriers).
+    ///
+    /// ATTENTION: The naming convention differs from C, where the corresponding
+    /// function is called `clear_bit`.
+    ///
+    /// If CONFIG_RUST_BITMAP_HARDENED is not enabled and `index` is greater than
+    /// or equal to `self.len()`, does nothing.
+    ///
+    /// # Panics
+    ///
+    /// Panics if CONFIG_RUST_BITMAP_HARDENED is enabled and `index` is greater than
+    /// or equal to `self.len()`.
+    #[inline]
+    pub fn clear_bit_atomic(&self, index: usize) {
+        bitmap_assert_return!(
+            index < self.len(),
+            "Bit `index` must be < {}, was {}",
+            self.len(),
+            index
+        );
+        // SAFETY: `index` is within bounds and the caller has ensured that
+        // there is no mix of non-atomic and atomic operations.
+        unsafe { bindings::clear_bit(index, self.as_ptr().cast_mut()) };
+    }
+
+    /// Copy `src` into this [`Bitmap`] and set any remaining bits to zero.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::alloc::{AllocError, flags::GFP_KERNEL};
+    /// use kernel::bitmap::BitmapVec;
+    ///
+    /// let mut long_bitmap = BitmapVec::new(256, GFP_KERNEL)?;
+    ///
+    /// assert_eq!(None, long_bitmap.last_bit());
+    ///
+    /// let mut short_bitmap = BitmapVec::new(16, GFP_KERNEL)?;
+    ///
+    /// short_bitmap.set_bit(7);
+    /// long_bitmap.copy_and_extend(&short_bitmap);
+    /// assert_eq!(Some(7), long_bitmap.last_bit());
+    ///
+    /// # Ok::<(), AllocError>(())
+    /// ```
+    #[inline]
+    pub fn copy_and_extend(&mut self, src: &Bitmap) {
+        let len = core::cmp::min(src.len(), self.len());
+        // SAFETY: access to `self` and `src` is within bounds.
+        unsafe {
+            bindings::bitmap_copy_and_extend(
+                self.as_mut_ptr(),
+                src.as_ptr(),
+                len as u32,
+                self.len() as u32,
+            )
+        };
+    }
+
+    /// Finds last set bit.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::alloc::{AllocError, flags::GFP_KERNEL};
+    /// use kernel::bitmap::BitmapVec;
+    ///
+    /// let bitmap = BitmapVec::new(64, GFP_KERNEL)?;
+    ///
+    /// match bitmap.last_bit() {
+    ///     Some(idx) => {
+    ///         pr_info!("The last bit has index {idx}.\n");
+    ///     }
+    ///     None => {
+    ///         pr_info!("All bits in this bitmap are 0.\n");
+    ///     }
+    /// }
+    /// # Ok::<(), AllocError>(())
+    /// ```
+    #[inline]
+    pub fn last_bit(&self) -> Option<usize> {
+        // SAFETY: `_find_next_bit` access is within bounds due to invariant.
+        let index = unsafe { bindings::_find_last_bit(self.as_ptr(), self.len()) };
+        if index >= self.len() {
+            None
+        } else {
+            Some(index)
+        }
+    }
+
+    /// Finds next set bit, starting from `start`.
+    ///
+    /// Returns `None` if `start` is greater or equal to `self.nbits`.
+    #[inline]
+    pub fn next_bit(&self, start: usize) -> Option<usize> {
+        bitmap_assert!(
+            start < self.len(),
+            "`start` must be < {} was {}",
+            self.len(),
+            start
+        );
+        // SAFETY: `_find_next_bit` tolerates out-of-bounds arguments and returns a
+        // value larger than or equal to `self.len()` in that case.
+        let index = unsafe { bindings::_find_next_bit(self.as_ptr(), self.len(), start) };
+        if index >= self.len() {
+            None
+        } else {
+            Some(index)
+        }
+    }
+
+    /// Finds next zero bit, starting from `start`.
+    /// Returns `None` if `start` is greater than or equal to `self.len()`.
+    #[inline]
+    pub fn next_zero_bit(&self, start: usize) -> Option<usize> {
+        bitmap_assert!(
+            start < self.len(),
+            "`start` must be < {} was {}",
+            self.len(),
+            start
+        );
+        // SAFETY: `_find_next_zero_bit` tolerates out-of-bounds arguments and returns a
+        // value larger than or equal to `self.len()` in that case.
+        let index = unsafe { bindings::_find_next_zero_bit(self.as_ptr(), self.len(), start) };
+        if index >= self.len() {
+            None
+        } else {
+            Some(index)
+        }
+    }
+}
+
+use macros::kunit_tests;
+
+#[kunit_tests(rust_kernel_bitmap)]
+mod tests {
+    use super::*;
+    use kernel::alloc::flags::GFP_KERNEL;
+
+    #[test]
+    fn bitmap_borrow() {
+        let fake_bitmap: [usize; 2] = [0, 0];
+        // SAFETY: `fake_c_bitmap` is an array of expected length.
+        let b = unsafe { Bitmap::from_raw(fake_bitmap.as_ptr(), 2 * BITS_PER_LONG) };
+        assert_eq!(2 * BITS_PER_LONG, b.len());
+        assert_eq!(None, b.next_bit(0));
+    }
+
+    #[test]
+    fn bitmap_copy() {
+        let fake_bitmap: usize = 0xFF;
+        // SAFETY: `fake_c_bitmap` can be used as one-element array of expected length.
+        let b = unsafe { Bitmap::from_raw(core::ptr::addr_of!(fake_bitmap), 8) };
+        assert_eq!(8, b.len());
+        assert_eq!(None, b.next_zero_bit(0));
+    }
+
+    #[test]
+    fn bitmap_vec_new() -> Result<(), AllocError> {
+        let b = BitmapVec::new(0, GFP_KERNEL)?;
+        assert_eq!(0, b.len());
+
+        let b = BitmapVec::new(3, GFP_KERNEL)?;
+        assert_eq!(3, b.len());
+
+        let b = BitmapVec::new(1024, GFP_KERNEL)?;
+        assert_eq!(1024, b.len());
+
+        // Requesting too large values results in [`AllocError`].
+        let res = BitmapVec::new(1 << 31, GFP_KERNEL);
+        assert!(res.is_err());
+        Ok(())
+    }
+
+    #[test]
+    fn bitmap_set_clear_find() -> Result<(), AllocError> {
+        let mut b = BitmapVec::new(128, GFP_KERNEL)?;
+
+        // Zero-initialized
+        assert_eq!(None, b.next_bit(0));
+        assert_eq!(Some(0), b.next_zero_bit(0));
+        assert_eq!(None, b.last_bit());
+
+        b.set_bit(17);
+
+        assert_eq!(Some(17), b.next_bit(0));
+        assert_eq!(Some(17), b.next_bit(17));
+        assert_eq!(None, b.next_bit(18));
+        assert_eq!(Some(17), b.last_bit());
+
+        b.set_bit(107);
+
+        assert_eq!(Some(17), b.next_bit(0));
+        assert_eq!(Some(17), b.next_bit(17));
+        assert_eq!(Some(107), b.next_bit(18));
+        assert_eq!(Some(107), b.last_bit());
+
+        b.clear_bit(17);
+
+        assert_eq!(Some(107), b.next_bit(0));
+        assert_eq!(Some(107), b.last_bit());
+        Ok(())
+    }
+
+    #[test]
+    fn owned_bitmap_out_of_bounds() -> Result<(), AllocError> {
+        // TODO: Kunit #[test]s do not support `cfg` yet,
+        // so we add it here in the body.
+        #[cfg(not(CONFIG_RUST_BITMAP_HARDENED))]
+        {
+            let mut b = BitmapVec::new(128, GFP_KERNEL)?;
+            b.set_bit(2048);
+            b.set_bit_atomic(2048);
+            b.clear_bit(2048);
+            b.clear_bit_atomic(2048);
+            assert_eq!(None, b.next_bit(2048));
+            assert_eq!(None, b.next_zero_bit(2048));
+            assert_eq!(None, b.last_bit());
+        }
+        Ok(())
+    }
+
+    // TODO: uncomment once kunit supports [should_panic] and `cfg`.
+    // #[cfg(CONFIG_RUST_BITMAP_HARDENED)]
+    // #[test]
+    // #[should_panic]
+    // fn owned_bitmap_out_of_bounds() -> Result<(), AllocError> {
+    //     let mut b = BitmapVec::new(128, GFP_KERNEL)?;
+    //
+    //     b.set_bit(2048);
+    // }
+
+    #[test]
+    fn bitmap_copy_and_extend() -> Result<(), AllocError> {
+        let mut long_bitmap = BitmapVec::new(256, GFP_KERNEL)?;
+
+        long_bitmap.set_bit(3);
+        long_bitmap.set_bit(200);
+
+        let mut short_bitmap = BitmapVec::new(32, GFP_KERNEL)?;
+
+        short_bitmap.set_bit(17);
+
+        long_bitmap.copy_and_extend(&short_bitmap);
+
+        // Previous bits have been cleared.
+        assert_eq!(Some(17), long_bitmap.next_bit(0));
+        assert_eq!(Some(17), long_bitmap.last_bit());
+        Ok(())
+    }
+}
diff --git a/rust/kernel/block/mq.rs b/rust/kernel/block/mq.rs
index c0ec06b84355..637018ead0ab 100644
--- a/rust/kernel/block/mq.rs
+++ b/rust/kernel/block/mq.rs
@@ -89,7 +89,7 @@
 //!     Arc::pin_init(TagSet::new(1, 256, 1), flags::GFP_KERNEL)?;
 //! let mut disk = gen_disk::GenDiskBuilder::new()
 //!     .capacity_sectors(4096)
-//!     .build(format_args!("myblk"), tagset, ())?;
+//!     .build(fmt!("myblk"), tagset, ())?;
 //!
 //! # Ok::<(), kernel::error::Error>(())
 //! ```
diff --git a/rust/kernel/block/mq/gen_disk.rs b/rust/kernel/block/mq/gen_disk.rs
index 46ec80269970..1ce815c8cdab 100644
--- a/rust/kernel/block/mq/gen_disk.rs
+++ b/rust/kernel/block/mq/gen_disk.rs
@@ -3,19 +3,19 @@
 //! Generic disk abstraction.
 //!
 //! C header: [`include/linux/blkdev.h`](srctree/include/linux/blkdev.h)
-//! C header: [`include/linux/blk_mq.h`](srctree/include/linux/blk_mq.h)
+//! C header: [`include/linux/blk-mq.h`](srctree/include/linux/blk-mq.h)
 
 use crate::{
     bindings,
     block::mq::{Operations, TagSet},
     error::{self, from_err_ptr, Result},
+    fmt::{self, Write},
     prelude::*,
     static_lock_class,
     str::NullTerminatedFormatter,
     sync::Arc,
     types::{ForeignOwnable, ScopeGuard},
 };
-use core::fmt::{self, Write};
 
 /// A builder for [`GenDisk`].
 ///
diff --git a/rust/kernel/block/mq/raw_writer.rs b/rust/kernel/block/mq/raw_writer.rs
new file mode 100644
index 000000000000..d311e24e2595
--- /dev/null
+++ b/rust/kernel/block/mq/raw_writer.rs
@@ -0,0 +1,54 @@
+// SPDX-License-Identifier: GPL-2.0
+
+use crate::error::Result;
+use crate::fmt::{self, Write};
+use crate::prelude::EINVAL;
+
+/// A mutable reference to a byte buffer where a string can be written into.
+///
+/// # Invariants
+///
+/// `buffer` is always null terminated.
+pub(crate) struct RawWriter<'a> {
+    buffer: &'a mut [u8],
+    pos: usize,
+}
+
+impl<'a> RawWriter<'a> {
+    /// Create a new `RawWriter` instance.
+    fn new(buffer: &'a mut [u8]) -> Result<RawWriter<'a>> {
+        *(buffer.last_mut().ok_or(EINVAL)?) = 0;
+
+        // INVARIANT: We null terminated the buffer above.
+        Ok(Self { buffer, pos: 0 })
+    }
+
+    pub(crate) fn from_array<const N: usize>(
+        a: &'a mut [crate::ffi::c_char; N],
+    ) -> Result<RawWriter<'a>> {
+        Self::new(
+            // SAFETY: the buffer of `a` is valid for read and write as `u8` for
+            // at least `N` bytes.
+            unsafe { core::slice::from_raw_parts_mut(a.as_mut_ptr().cast::<u8>(), N) },
+        )
+    }
+}
+
+impl Write for RawWriter<'_> {
+    fn write_str(&mut self, s: &str) -> fmt::Result {
+        let bytes = s.as_bytes();
+        let len = bytes.len();
+
+        // We do not want to overwrite our null terminator
+        if self.pos + len > self.buffer.len() - 1 {
+            return Err(fmt::Error);
+        }
+
+        // INVARIANT: We are not overwriting the last byte
+        self.buffer[self.pos..self.pos + len].copy_from_slice(bytes);
+
+        self.pos += len;
+
+        Ok(())
+    }
+}
diff --git a/rust/kernel/configfs.rs b/rust/kernel/configfs.rs
index 318a2f073d1c..10f1547ca9f1 100644
--- a/rust/kernel/configfs.rs
+++ b/rust/kernel/configfs.rs
@@ -263,7 +263,7 @@ pub fn new(
         try_pin_init!(Self {
             group <- pin_init::init_zeroed().chain(|v: &mut Opaque<bindings::config_group>| {
                 let place = v.get();
-                let name = name.as_bytes_with_nul().as_ptr();
+                let name = name.to_bytes_with_nul().as_ptr();
                 // SAFETY: It is safe to initialize a group once it has been zeroed.
                 unsafe {
                     bindings::config_group_init_type_name(place, name.cast(), item_type.as_ptr())
@@ -613,7 +613,7 @@ impl<const ID: u64, O, Data> Attribute<ID, O, Data>
     pub const fn new(name: &'static CStr) -> Self {
         Self {
             attribute: Opaque::new(bindings::configfs_attribute {
-                ca_name: name.as_char_ptr(),
+                ca_name: crate::str::as_char_ptr_in_const_context(name),
                 ca_owner: core::ptr::null_mut(),
                 ca_mode: 0o660,
                 show: Some(Self::show),
diff --git a/rust/kernel/cpu.rs b/rust/kernel/cpu.rs
index 5de730c8d817..cb6c0338ef5a 100644
--- a/rust/kernel/cpu.rs
+++ b/rust/kernel/cpu.rs
@@ -109,6 +109,7 @@ pub fn as_u32(&self) -> u32 {
     /// unexpectedly due to preemption or CPU migration. It should only be
     /// used when the context ensures that the task remains on the same CPU
     /// or the users could use a stale (yet valid) CPU ID.
+    #[inline]
     pub fn current() -> Self {
         // SAFETY: raw_smp_processor_id() always returns a valid CPU ID.
         unsafe { Self::from_u32_unchecked(bindings::raw_smp_processor_id()) }
diff --git a/rust/kernel/cpufreq.rs b/rust/kernel/cpufreq.rs
index eea57ba95f24..29bdf7fe80a1 100644
--- a/rust/kernel/cpufreq.rs
+++ b/rust/kernel/cpufreq.rs
@@ -27,7 +27,6 @@
 use core::{
     cell::UnsafeCell,
     marker::PhantomData,
-    mem::MaybeUninit,
     ops::{Deref, DerefMut},
     pin::Pin,
     ptr,
@@ -1013,12 +1012,11 @@ impl<T: Driver> Registration<T> {
         } else {
             None
         },
-        // SAFETY: All zeros is a valid value for `bindings::cpufreq_driver`.
-        ..unsafe { MaybeUninit::zeroed().assume_init() }
+        ..pin_init::zeroed()
     };
 
     const fn copy_name(name: &'static CStr) -> [c_char; CPUFREQ_NAME_LEN] {
-        let src = name.as_bytes_with_nul();
+        let src = name.to_bytes_with_nul();
         let mut dst = [0; CPUFREQ_NAME_LEN];
 
         build_assert!(src.len() <= CPUFREQ_NAME_LEN);
diff --git a/rust/kernel/device.rs b/rust/kernel/device.rs
index c2a6f5c203f0..1321e6f0b53c 100644
--- a/rust/kernel/device.rs
+++ b/rust/kernel/device.rs
@@ -5,11 +5,11 @@
 //! C header: [`include/linux/device.h`](srctree/include/linux/device.h)
 
 use crate::{
-    bindings,
+    bindings, fmt,
     sync::aref::ARef,
     types::{ForeignOwnable, Opaque},
 };
-use core::{fmt, marker::PhantomData, ptr};
+use core::{marker::PhantomData, ptr};
 
 #[cfg(CONFIG_PRINTK)]
 use crate::c_str;
@@ -597,7 +597,7 @@ macro_rules! impl_device_context_into_aref {
 macro_rules! dev_printk {
     ($method:ident, $dev:expr, $($f:tt)*) => {
         {
-            ($dev).$method(::core::format_args!($($f)*));
+            ($dev).$method($crate::prelude::fmt!($($f)*));
         }
     }
 }
diff --git a/rust/kernel/device/property.rs b/rust/kernel/device/property.rs
index 49ee12a906db..3a332a8c53a9 100644
--- a/rust/kernel/device/property.rs
+++ b/rust/kernel/device/property.rs
@@ -11,6 +11,7 @@
     alloc::KVec,
     bindings,
     error::{to_result, Result},
+    fmt,
     prelude::*,
     str::{CStr, CString},
     types::{ARef, Opaque},
@@ -68,16 +69,16 @@ pub fn is_of_node(&self) -> bool {
         unsafe { bindings::is_of_node(self.as_raw()) }
     }
 
-    /// Returns an object that implements [`Display`](core::fmt::Display) for
+    /// Returns an object that implements [`Display`](fmt::Display) for
     /// printing the name of a node.
     ///
     /// This is an alternative to the default `Display` implementation, which
     /// prints the full path.
-    pub fn display_name(&self) -> impl core::fmt::Display + '_ {
+    pub fn display_name(&self) -> impl fmt::Display + '_ {
         struct FwNodeDisplayName<'a>(&'a FwNode);
 
-        impl core::fmt::Display for FwNodeDisplayName<'_> {
-            fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
+        impl fmt::Display for FwNodeDisplayName<'_> {
+            fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
                 // SAFETY: `self` is valid by its type invariant.
                 let name = unsafe { bindings::fwnode_get_name(self.0.as_raw()) };
                 if name.is_null() {
@@ -87,7 +88,7 @@ fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
                 // - `fwnode_get_name` returns null or a valid C string.
                 // - `name` was checked to be non-null.
                 let name = unsafe { CStr::from_char_ptr(name) };
-                write!(f, "{name}")
+                fmt::Display::fmt(name, f)
             }
         }
 
@@ -351,8 +352,8 @@ pub fn is_empty(&self) -> bool {
     }
 }
 
-impl core::fmt::Debug for FwNodeReferenceArgs {
-    fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
+impl fmt::Debug for FwNodeReferenceArgs {
+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
         write!(f, "{:?}", self.as_slice())
     }
 }
@@ -377,8 +378,8 @@ enum Node<'a> {
     Owned(ARef<FwNode>),
 }
 
-impl core::fmt::Display for FwNode {
-    fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
+impl fmt::Display for FwNode {
+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
         // The logic here is the same as the one in lib/vsprintf.c
         // (fwnode_full_name_string).
 
@@ -413,9 +414,9 @@ fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
                 // SAFETY: `fwnode_get_name_prefix` returns null or a
                 // valid C string.
                 let prefix = unsafe { CStr::from_char_ptr(prefix) };
-                write!(f, "{prefix}")?;
+                fmt::Display::fmt(prefix, f)?;
             }
-            write!(f, "{}", fwnode.display_name())?;
+            fmt::Display::fmt(&fwnode.display_name(), f)?;
         }
 
         Ok(())
diff --git a/rust/kernel/dma.rs b/rust/kernel/dma.rs
index bc8dfe38db77..4e0af3e1a3b9 100644
--- a/rust/kernel/dma.rs
+++ b/rust/kernel/dma.rs
@@ -9,8 +9,8 @@
     device::{Bound, Core},
     error::{to_result, Result},
     prelude::*,
+    sync::aref::ARef,
     transmute::{AsBytes, FromBytes},
-    types::ARef,
 };
 
 /// DMA address type.
diff --git a/rust/kernel/drm/device.rs b/rust/kernel/drm/device.rs
index bb8e43c77dc9..3ce8f62a0056 100644
--- a/rust/kernel/drm/device.rs
+++ b/rust/kernel/drm/device.rs
@@ -2,7 +2,7 @@
 
 //! DRM device.
 //!
-//! C header: [`include/linux/drm/drm_device.h`](srctree/include/linux/drm/drm_device.h)
+//! C header: [`include/drm/drm_device.h`](srctree/include/drm/drm_device.h)
 
 use crate::{
     alloc::allocator::Kmalloc,
@@ -83,8 +83,8 @@ impl<T: drm::Driver> Device<T> {
         major: T::INFO.major,
         minor: T::INFO.minor,
         patchlevel: T::INFO.patchlevel,
-        name: T::INFO.name.as_char_ptr().cast_mut(),
-        desc: T::INFO.desc.as_char_ptr().cast_mut(),
+        name: crate::str::as_char_ptr_in_const_context(T::INFO.name).cast_mut(),
+        desc: crate::str::as_char_ptr_in_const_context(T::INFO.desc).cast_mut(),
 
         driver_features: drm::driver::FEAT_GEM,
         ioctls: T::IOCTLS.as_ptr(),
diff --git a/rust/kernel/drm/driver.rs b/rust/kernel/drm/driver.rs
index 91e13b6ca26a..f30ee4c6245c 100644
--- a/rust/kernel/drm/driver.rs
+++ b/rust/kernel/drm/driver.rs
@@ -2,7 +2,7 @@
 
 //! DRM driver core.
 //!
-//! C header: [`include/linux/drm/drm_drv.h`](srctree/include/linux/drm/drm_drv.h)
+//! C header: [`include/drm/drm_drv.h`](srctree/include/drm/drm_drv.h)
 
 use crate::{
     bindings, device, devres, drm,
diff --git a/rust/kernel/drm/file.rs b/rust/kernel/drm/file.rs
index e8789c9110d6..8c46f8d51951 100644
--- a/rust/kernel/drm/file.rs
+++ b/rust/kernel/drm/file.rs
@@ -2,7 +2,7 @@
 
 //! DRM File objects.
 //!
-//! C header: [`include/linux/drm/drm_file.h`](srctree/include/linux/drm/drm_file.h)
+//! C header: [`include/drm/drm_file.h`](srctree/include/drm/drm_file.h)
 
 use crate::{bindings, drm, error::Result, prelude::*, types::Opaque};
 use core::marker::PhantomData;
diff --git a/rust/kernel/drm/gem/mod.rs b/rust/kernel/drm/gem/mod.rs
index 6ccbb25628a1..30c853988b94 100644
--- a/rust/kernel/drm/gem/mod.rs
+++ b/rust/kernel/drm/gem/mod.rs
@@ -2,7 +2,7 @@
 
 //! DRM GEM API
 //!
-//! C header: [`include/linux/drm/drm_gem.h`](srctree/include/linux/drm/drm_gem.h)
+//! C header: [`include/drm/drm_gem.h`](srctree/include/drm/drm_gem.h)
 
 use crate::{
     alloc::flags::*,
diff --git a/rust/kernel/drm/ioctl.rs b/rust/kernel/drm/ioctl.rs
index af1bb29cf06d..69efbdb4c85a 100644
--- a/rust/kernel/drm/ioctl.rs
+++ b/rust/kernel/drm/ioctl.rs
@@ -2,7 +2,7 @@
 
 //! DRM IOCTL definitions.
 //!
-//! C header: [`include/linux/drm/drm_ioctl.h`](srctree/include/linux/drm/drm_ioctl.h)
+//! C header: [`include/drm/drm_ioctl.h`](srctree/include/drm/drm_ioctl.h)
 
 use crate::ioctl;
 
diff --git a/rust/kernel/error.rs b/rust/kernel/error.rs
index a41de293dcd1..1c0e0e241daa 100644
--- a/rust/kernel/error.rs
+++ b/rust/kernel/error.rs
@@ -2,7 +2,9 @@
 
 //! Kernel errors.
 //!
-//! C header: [`include/uapi/asm-generic/errno-base.h`](srctree/include/uapi/asm-generic/errno-base.h)
+//! C header: [`include/uapi/asm-generic/errno-base.h`](srctree/include/uapi/asm-generic/errno-base.h)\
+//! C header: [`include/uapi/asm-generic/errno.h`](srctree/include/uapi/asm-generic/errno.h)\
+//! C header: [`include/linux/errno.h`](srctree/include/linux/errno.h)
 
 use crate::{
     alloc::{layout::LayoutError, AllocError},
@@ -101,8 +103,23 @@ macro_rules! declare_err {
 impl Error {
     /// Creates an [`Error`] from a kernel error code.
     ///
-    /// It is a bug to pass an out-of-range `errno`. `EINVAL` would
-    /// be returned in such a case.
+    /// `errno` must be within error code range (i.e. `>= -MAX_ERRNO && < 0`).
+    ///
+    /// It is a bug to pass an out-of-range `errno`. [`code::EINVAL`] is returned in such a case.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// assert_eq!(Error::from_errno(-1), EPERM);
+    /// assert_eq!(Error::from_errno(-2), ENOENT);
+    /// ```
+    ///
+    /// The following calls are considered a bug:
+    ///
+    /// ```
+    /// assert_eq!(Error::from_errno(0), EINVAL);
+    /// assert_eq!(Error::from_errno(-1000000), EINVAL);
+    /// ```
     pub fn from_errno(errno: crate::ffi::c_int) -> Error {
         if let Some(error) = Self::try_from_errno(errno) {
             error
@@ -158,7 +175,7 @@ pub fn to_ptr<T>(self) -> *mut T {
     }
 
     /// Returns a string representing the error, if one exists.
-    #[cfg(not(any(test, testlib)))]
+    #[cfg(not(testlib))]
     pub fn name(&self) -> Option<&'static CStr> {
         // SAFETY: Just an FFI call, there are no extra safety requirements.
         let ptr = unsafe { bindings::errname(-self.0.get()) };
@@ -175,7 +192,7 @@ pub fn name(&self) -> Option<&'static CStr> {
     /// When `testlib` is configured, this always returns `None` to avoid the dependency on a
     /// kernel function so that tests that use this (e.g., by calling [`Result::unwrap`]) can still
     /// run in userspace.
-    #[cfg(any(test, testlib))]
+    #[cfg(testlib)]
     pub fn name(&self) -> Option<&'static CStr> {
         None
     }
@@ -375,8 +392,43 @@ fn from(e: core::convert::Infallible) -> Error {
 /// [Rust documentation]: https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html
 pub type Result<T = (), E = Error> = core::result::Result<T, E>;
 
-/// Converts an integer as returned by a C kernel function to an error if it's negative, and
-/// `Ok(())` otherwise.
+/// Converts an integer as returned by a C kernel function to a [`Result`].
+///
+/// If the integer is negative, an [`Err`] with an [`Error`] as given by [`Error::from_errno`] is
+/// returned. This means the integer must be `>= -MAX_ERRNO`.
+///
+/// Otherwise, it returns [`Ok`].
+///
+/// It is a bug to pass an out-of-range negative integer. `Err(EINVAL)` is returned in such a case.
+///
+/// # Examples
+///
+/// This function may be used to easily perform early returns with the [`?`] operator when working
+/// with C APIs within Rust abstractions:
+///
+/// ```
+/// # use kernel::error::to_result;
+/// # mod bindings {
+/// #     #![expect(clippy::missing_safety_doc)]
+/// #     use kernel::prelude::*;
+/// #     pub(super) unsafe fn f1() -> c_int { 0 }
+/// #     pub(super) unsafe fn f2() -> c_int { EINVAL.to_errno() }
+/// # }
+/// fn f() -> Result {
+///     // SAFETY: ...
+///     to_result(unsafe { bindings::f1() })?;
+///
+///     // SAFETY: ...
+///     to_result(unsafe { bindings::f2() })?;
+///
+///     // ...
+///
+///     Ok(())
+/// }
+/// # assert_eq!(f(), Err(EINVAL));
+/// ```
+///
+/// [`?`]: https://doc.rust-lang.org/reference/expressions/operator-expr.html#the-question-mark-operator
 pub fn to_result(err: crate::ffi::c_int) -> Result {
     if err < 0 {
         Err(Error::from_errno(err))
diff --git a/rust/kernel/firmware.rs b/rust/kernel/firmware.rs
index 1abab5b2f052..94e6bb88b903 100644
--- a/rust/kernel/firmware.rs
+++ b/rust/kernel/firmware.rs
@@ -291,7 +291,7 @@ const fn push_module_name(self) -> Self {
         let module_name = this.module_name;
 
         if !this.module_name.is_empty() {
-            this = this.push_internal(module_name.as_bytes_with_nul());
+            this = this.push_internal(module_name.to_bytes_with_nul());
 
             if N != 0 {
                 // Re-use the space taken by the NULL terminator and swap it with the '.' separator.
diff --git a/rust/kernel/fs/file.rs b/rust/kernel/fs/file.rs
index f1a3fa698745..cf06e73a6da0 100644
--- a/rust/kernel/fs/file.rs
+++ b/rust/kernel/fs/file.rs
@@ -11,6 +11,7 @@
     bindings,
     cred::Credential,
     error::{code::*, to_result, Error, Result},
+    fmt,
     sync::aref::{ARef, AlwaysRefCounted},
     types::{NotThreadSafe, Opaque},
 };
@@ -460,8 +461,8 @@ fn from(_: BadFdError) -> Error {
     }
 }
 
-impl core::fmt::Debug for BadFdError {
-    fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
+impl fmt::Debug for BadFdError {
+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
         f.pad("EBADF")
     }
 }
diff --git a/rust/kernel/id_pool.rs b/rust/kernel/id_pool.rs
new file mode 100644
index 000000000000..a41a3404213c
--- /dev/null
+++ b/rust/kernel/id_pool.rs
@@ -0,0 +1,226 @@
+// SPDX-License-Identifier: GPL-2.0
+
+// Copyright (C) 2025 Google LLC.
+
+//! Rust API for an ID pool backed by a [`BitmapVec`].
+
+use crate::alloc::{AllocError, Flags};
+use crate::bitmap::BitmapVec;
+
+const BITS_PER_LONG: usize = bindings::BITS_PER_LONG as usize;
+
+/// Represents a dynamic ID pool backed by a [`BitmapVec`].
+///
+/// Clients acquire and release IDs from unset bits in a bitmap.
+///
+/// The capacity of the ID pool may be adjusted by users as
+/// needed. The API supports the scenario where users need precise control
+/// over the time of allocation of a new backing bitmap, which may require
+/// release of spinlock.
+/// Due to concurrent updates, all operations are re-verified to determine
+/// if the grow or shrink is sill valid.
+///
+/// # Examples
+///
+/// Basic usage
+///
+/// ```
+/// use kernel::alloc::{AllocError, flags::GFP_KERNEL};
+/// use kernel::id_pool::IdPool;
+///
+/// let mut pool = IdPool::new(64, GFP_KERNEL)?;
+/// for i in 0..64 {
+///     assert_eq!(i, pool.acquire_next_id(i).ok_or(ENOSPC)?);
+/// }
+///
+/// pool.release_id(23);
+/// assert_eq!(23, pool.acquire_next_id(0).ok_or(ENOSPC)?);
+///
+/// assert_eq!(None, pool.acquire_next_id(0));  // time to realloc.
+/// let resizer = pool.grow_request().ok_or(ENOSPC)?.realloc(GFP_KERNEL)?;
+/// pool.grow(resizer);
+///
+/// assert_eq!(pool.acquire_next_id(0), Some(64));
+/// # Ok::<(), Error>(())
+/// ```
+///
+/// Releasing spinlock to grow the pool
+///
+/// ```no_run
+/// use kernel::alloc::{AllocError, flags::GFP_KERNEL};
+/// use kernel::sync::{new_spinlock, SpinLock};
+/// use kernel::id_pool::IdPool;
+///
+/// fn get_id_maybe_realloc(guarded_pool: &SpinLock<IdPool>) -> Result<usize, AllocError> {
+///     let mut pool = guarded_pool.lock();
+///     loop {
+///         match pool.acquire_next_id(0) {
+///             Some(index) => return Ok(index),
+///             None => {
+///                 let alloc_request = pool.grow_request();
+///                 drop(pool);
+///                 let resizer = alloc_request.ok_or(AllocError)?.realloc(GFP_KERNEL)?;
+///                 pool = guarded_pool.lock();
+///                 pool.grow(resizer)
+///             }
+///         }
+///     }
+/// }
+/// ```
+pub struct IdPool {
+    map: BitmapVec,
+}
+
+/// Indicates that an [`IdPool`] should change to a new target size.
+pub struct ReallocRequest {
+    num_ids: usize,
+}
+
+/// Contains a [`BitmapVec`] of a size suitable for reallocating [`IdPool`].
+pub struct PoolResizer {
+    new: BitmapVec,
+}
+
+impl ReallocRequest {
+    /// Allocates a new backing [`BitmapVec`] for [`IdPool`].
+    ///
+    /// This method only prepares reallocation and does not complete it.
+    /// Reallocation will complete after passing the [`PoolResizer`] to the
+    /// [`IdPool::grow`] or [`IdPool::shrink`] operation, which will check
+    /// that reallocation still makes sense.
+    pub fn realloc(&self, flags: Flags) -> Result<PoolResizer, AllocError> {
+        let new = BitmapVec::new(self.num_ids, flags)?;
+        Ok(PoolResizer { new })
+    }
+}
+
+impl IdPool {
+    /// Constructs a new [`IdPool`].
+    ///
+    /// A capacity below [`BITS_PER_LONG`] is adjusted to
+    /// [`BITS_PER_LONG`].
+    ///
+    /// [`BITS_PER_LONG`]: srctree/include/asm-generic/bitsperlong.h
+    #[inline]
+    pub fn new(num_ids: usize, flags: Flags) -> Result<Self, AllocError> {
+        let num_ids = core::cmp::max(num_ids, BITS_PER_LONG);
+        let map = BitmapVec::new(num_ids, flags)?;
+        Ok(Self { map })
+    }
+
+    /// Returns how many IDs this pool can currently have.
+    #[inline]
+    pub fn capacity(&self) -> usize {
+        self.map.len()
+    }
+
+    /// Returns a [`ReallocRequest`] if the [`IdPool`] can be shrunk, [`None`] otherwise.
+    ///
+    /// The capacity of an [`IdPool`] cannot be shrunk below [`BITS_PER_LONG`].
+    ///
+    /// [`BITS_PER_LONG`]: srctree/include/asm-generic/bitsperlong.h
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::alloc::{AllocError, flags::GFP_KERNEL};
+    /// use kernel::id_pool::{ReallocRequest, IdPool};
+    ///
+    /// let mut pool = IdPool::new(1024, GFP_KERNEL)?;
+    /// let alloc_request = pool.shrink_request().ok_or(AllocError)?;
+    /// let resizer = alloc_request.realloc(GFP_KERNEL)?;
+    /// pool.shrink(resizer);
+    /// assert_eq!(pool.capacity(), kernel::bindings::BITS_PER_LONG as usize);
+    /// # Ok::<(), AllocError>(())
+    /// ```
+    #[inline]
+    pub fn shrink_request(&self) -> Option<ReallocRequest> {
+        let cap = self.capacity();
+        // Shrinking below [`BITS_PER_LONG`] is never possible.
+        if cap <= BITS_PER_LONG {
+            return None;
+        }
+        // Determine if the bitmap can shrink based on the position of
+        // its last set bit. If the bit is within the first quarter of
+        // the bitmap then shrinking is possible. In this case, the
+        // bitmap should shrink to half its current size.
+        let Some(bit) = self.map.last_bit() else {
+            return Some(ReallocRequest {
+                num_ids: BITS_PER_LONG,
+            });
+        };
+        if bit >= (cap / 4) {
+            return None;
+        }
+        let num_ids = usize::max(BITS_PER_LONG, cap / 2);
+        Some(ReallocRequest { num_ids })
+    }
+
+    /// Shrinks pool by using a new [`BitmapVec`], if still possible.
+    #[inline]
+    pub fn shrink(&mut self, mut resizer: PoolResizer) {
+        // Between request to shrink that led to allocation of `resizer` and now,
+        // bits may have changed.
+        // Verify that shrinking is still possible. In case shrinking to
+        // the size of `resizer` is no longer possible, do nothing,
+        // drop `resizer` and move on.
+        let Some(updated) = self.shrink_request() else {
+            return;
+        };
+        if updated.num_ids > resizer.new.len() {
+            return;
+        }
+
+        resizer.new.copy_and_extend(&self.map);
+        self.map = resizer.new;
+    }
+
+    /// Returns a [`ReallocRequest`] for growing this [`IdPool`], if possible.
+    ///
+    /// The capacity of an [`IdPool`] cannot be grown above [`i32::MAX`].
+    #[inline]
+    pub fn grow_request(&self) -> Option<ReallocRequest> {
+        let num_ids = self.capacity() * 2;
+        if num_ids > i32::MAX.try_into().unwrap() {
+            return None;
+        }
+        Some(ReallocRequest { num_ids })
+    }
+
+    /// Grows pool by using a new [`BitmapVec`], if still necessary.
+    ///
+    /// The `resizer` arguments has to be obtained by calling [`Self::grow_request`]
+    /// on this object and performing a [`ReallocRequest::realloc`].
+    #[inline]
+    pub fn grow(&mut self, mut resizer: PoolResizer) {
+        // Between request to grow that led to allocation of `resizer` and now,
+        // another thread may have already grown the capacity.
+        // In this case, do nothing, drop `resizer` and move on.
+        if resizer.new.len() <= self.capacity() {
+            return;
+        }
+
+        resizer.new.copy_and_extend(&self.map);
+        self.map = resizer.new;
+    }
+
+    /// Acquires a new ID by finding and setting the next zero bit in the
+    /// bitmap.
+    ///
+    /// Upon success, returns its index. Otherwise, returns [`None`]
+    /// to indicate that a [`Self::grow_request`] is needed.
+    #[inline]
+    pub fn acquire_next_id(&mut self, offset: usize) -> Option<usize> {
+        let next_zero_bit = self.map.next_zero_bit(offset);
+        if let Some(nr) = next_zero_bit {
+            self.map.set_bit(nr);
+        }
+        next_zero_bit
+    }
+
+    /// Releases an ID.
+    #[inline]
+    pub fn release_id(&mut self, id: usize) {
+        self.map.clear_bit(id);
+    }
+}
diff --git a/rust/kernel/kunit.rs b/rust/kernel/kunit.rs
index 8a1e1b222ac8..79436509dd73 100644
--- a/rust/kernel/kunit.rs
+++ b/rust/kernel/kunit.rs
@@ -6,8 +6,8 @@
 //!
 //! Reference: <https://docs.kernel.org/dev-tools/kunit/index.html>
 
+use crate::fmt;
 use crate::prelude::*;
-use core::fmt;
 
 #[cfg(CONFIG_PRINTK)]
 use crate::c_str;
@@ -74,14 +74,14 @@ macro_rules! kunit_assert {
                 // mistake (it is hidden to prevent that).
                 //
                 // This mimics KUnit's failed assertion format.
-                $crate::kunit::err(format_args!(
+                $crate::kunit::err($crate::prelude::fmt!(
                     "    # {}: ASSERTION FAILED at {FILE}:{LINE}\n",
                     $name
                 ));
-                $crate::kunit::err(format_args!(
+                $crate::kunit::err($crate::prelude::fmt!(
                     "    Expected {CONDITION} to be true, but is false\n"
                 ));
-                $crate::kunit::err(format_args!(
+                $crate::kunit::err($crate::prelude::fmt!(
                     "    Failure not reported to KUnit since this is a non-KUnit task\n"
                 ));
                 break 'out;
@@ -102,12 +102,12 @@ unsafe impl Sync for Location {}
             unsafe impl Sync for UnaryAssert {}
 
             static LOCATION: Location = Location($crate::bindings::kunit_loc {
-                file: FILE.as_char_ptr(),
+                file: $crate::str::as_char_ptr_in_const_context(FILE),
                 line: LINE,
             });
             static ASSERTION: UnaryAssert = UnaryAssert($crate::bindings::kunit_unary_assert {
                 assert: $crate::bindings::kunit_assert {},
-                condition: CONDITION.as_char_ptr(),
+                condition: $crate::str::as_char_ptr_in_const_context(CONDITION),
                 expected_true: true,
             });
 
@@ -202,7 +202,7 @@ pub const fn kunit_case(
 ) -> kernel::bindings::kunit_case {
     kernel::bindings::kunit_case {
         run_case: Some(run_case),
-        name: name.as_char_ptr(),
+        name: kernel::str::as_char_ptr_in_const_context(name),
         attr: kernel::bindings::kunit_attributes {
             speed: kernel::bindings::kunit_speed_KUNIT_SPEED_NORMAL,
         },
diff --git a/rust/kernel/lib.rs b/rust/kernel/lib.rs
index fa083aa44cd6..3dd7bebe7888 100644
--- a/rust/kernel/lib.rs
+++ b/rust/kernel/lib.rs
@@ -17,6 +17,7 @@
 // the unstable features in use.
 //
 // Stable since Rust 1.79.0.
+#![feature(generic_nonzero)]
 #![feature(inline_const)]
 #![feature(pointer_is_aligned)]
 //
@@ -29,6 +30,7 @@
 // Stable since Rust 1.83.0.
 #![feature(const_maybe_uninit_as_mut_ptr)]
 #![feature(const_mut_refs)]
+#![feature(const_option)]
 #![feature(const_ptr_write)]
 #![feature(const_refs_to_cell)]
 //
@@ -63,6 +65,7 @@
 pub mod alloc;
 #[cfg(CONFIG_AUXILIARY_BUS)]
 pub mod auxiliary;
+pub mod bitmap;
 pub mod bits;
 #[cfg(CONFIG_BLOCK)]
 pub mod block;
@@ -91,6 +94,7 @@
 pub mod firmware;
 pub mod fmt;
 pub mod fs;
+pub mod id_pool;
 pub mod init;
 pub mod io;
 pub mod ioctl;
@@ -116,6 +120,7 @@
 pub mod prelude;
 pub mod print;
 pub mod processor;
+pub mod ptr;
 pub mod rbtree;
 pub mod regulator;
 pub mod revocable;
@@ -213,7 +218,7 @@ pub const fn as_ptr(&self) -> *mut bindings::module {
     }
 }
 
-#[cfg(not(any(testlib, test)))]
+#[cfg(not(testlib))]
 #[panic_handler]
 fn panic(info: &core::panic::PanicInfo<'_>) -> ! {
     pr_emerg!("{}\n", info);
diff --git a/rust/kernel/list.rs b/rust/kernel/list.rs
index 44e5219cfcbc..7355bbac16a7 100644
--- a/rust/kernel/list.rs
+++ b/rust/kernel/list.rs
@@ -38,6 +38,8 @@
 ///
 /// # Examples
 ///
+/// Use [`ListLinks`] as the type of the intrusive field.
+///
 /// ```
 /// use kernel::list::*;
 ///
@@ -140,6 +142,124 @@
 /// }
 /// # Result::<(), Error>::Ok(())
 /// ```
+///
+/// Use [`ListLinksSelfPtr`] as the type of the intrusive field. This allows a list of trait object
+/// type.
+///
+/// ```
+/// use kernel::list::*;
+///
+/// trait Foo {
+///     fn foo(&self) -> (&'static str, i32);
+/// }
+///
+/// #[pin_data]
+/// struct DTWrap<T: ?Sized> {
+///     #[pin]
+///     links: ListLinksSelfPtr<DTWrap<dyn Foo>>,
+///     value: T,
+/// }
+///
+/// impl<T> DTWrap<T> {
+///     fn new(value: T) -> Result<ListArc<Self>> {
+///         ListArc::pin_init(try_pin_init!(Self {
+///             value,
+///             links <- ListLinksSelfPtr::new(),
+///         }), GFP_KERNEL)
+///     }
+/// }
+///
+/// impl_list_arc_safe! {
+///     impl{T: ?Sized} ListArcSafe<0> for DTWrap<T> { untracked; }
+/// }
+/// impl_list_item! {
+///     impl ListItem<0> for DTWrap<dyn Foo> { using ListLinksSelfPtr { self.links }; }
+/// }
+///
+/// // Create a new empty list.
+/// let mut list = List::<DTWrap<dyn Foo>>::new();
+/// {
+///     assert!(list.is_empty());
+/// }
+///
+/// struct A(i32);
+/// // `A` returns the inner value for `foo`.
+/// impl Foo for A { fn foo(&self) -> (&'static str, i32) { ("a", self.0) } }
+///
+/// struct B;
+/// // `B` always returns 42.
+/// impl Foo for B { fn foo(&self) -> (&'static str, i32) { ("b", 42) } }
+///
+/// // Insert 3 element using `push_back()`.
+/// list.push_back(DTWrap::new(A(15))?);
+/// list.push_back(DTWrap::new(A(32))?);
+/// list.push_back(DTWrap::new(B)?);
+///
+/// // Iterate over the list to verify the nodes were inserted correctly.
+/// // [A(15), A(32), B]
+/// {
+///     let mut iter = list.iter();
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("a", 15));
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("a", 32));
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("b", 42));
+///     assert!(iter.next().is_none());
+///
+///     // Verify the length of the list.
+///     assert_eq!(list.iter().count(), 3);
+/// }
+///
+/// // Pop the items from the list using `pop_back()` and verify the content.
+/// {
+///     assert_eq!(list.pop_back().ok_or(EINVAL)?.value.foo(), ("b", 42));
+///     assert_eq!(list.pop_back().ok_or(EINVAL)?.value.foo(), ("a", 32));
+///     assert_eq!(list.pop_back().ok_or(EINVAL)?.value.foo(), ("a", 15));
+/// }
+///
+/// // Insert 3 elements using `push_front()`.
+/// list.push_front(DTWrap::new(A(15))?);
+/// list.push_front(DTWrap::new(A(32))?);
+/// list.push_front(DTWrap::new(B)?);
+///
+/// // Iterate over the list to verify the nodes were inserted correctly.
+/// // [B, A(32), A(15)]
+/// {
+///     let mut iter = list.iter();
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("b", 42));
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("a", 32));
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("a", 15));
+///     assert!(iter.next().is_none());
+///
+///     // Verify the length of the list.
+///     assert_eq!(list.iter().count(), 3);
+/// }
+///
+/// // Pop the items from the list using `pop_front()` and verify the content.
+/// {
+///     assert_eq!(list.pop_back().ok_or(EINVAL)?.value.foo(), ("a", 15));
+///     assert_eq!(list.pop_back().ok_or(EINVAL)?.value.foo(), ("a", 32));
+/// }
+///
+/// // Push `list2` to `list` through `push_all_back()`.
+/// // list: [B]
+/// // list2: [B, A(25)]
+/// {
+///     let mut list2 = List::<DTWrap<dyn Foo>>::new();
+///     list2.push_back(DTWrap::new(B)?);
+///     list2.push_back(DTWrap::new(A(25))?);
+///
+///     list.push_all_back(&mut list2);
+///
+///     // list: [B, B, A(25)]
+///     // list2: []
+///     let mut iter = list.iter();
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("b", 42));
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("b", 42));
+///     assert_eq!(iter.next().ok_or(EINVAL)?.value.foo(), ("a", 25));
+///     assert!(iter.next().is_none());
+///     assert!(list2.is_empty());
+/// }
+/// # Result::<(), Error>::Ok(())
+/// ```
 pub struct List<T: ?Sized + ListItem<ID>, const ID: u64 = 0> {
     first: *mut ListLinksFields,
     _ty: PhantomData<ListArc<T, ID>>,
diff --git a/rust/kernel/miscdevice.rs b/rust/kernel/miscdevice.rs
index 35630fc63875..d698cddcb4a5 100644
--- a/rust/kernel/miscdevice.rs
+++ b/rust/kernel/miscdevice.rs
@@ -35,7 +35,7 @@ pub const fn into_raw<T: MiscDevice>(self) -> bindings::miscdevice {
         // SAFETY: All zeros is valid for this C type.
         let mut result: bindings::miscdevice = unsafe { MaybeUninit::zeroed().assume_init() };
         result.minor = bindings::MISC_DYNAMIC_MINOR as ffi::c_int;
-        result.name = self.name.as_char_ptr();
+        result.name = crate::str::as_char_ptr_in_const_context(self.name);
         result.fops = MiscdeviceVTable::<T>::build();
         result
     }
diff --git a/rust/kernel/net/phy.rs b/rust/kernel/net/phy.rs
index c895582cd624..bf6272d87a7b 100644
--- a/rust/kernel/net/phy.rs
+++ b/rust/kernel/net/phy.rs
@@ -494,7 +494,7 @@ unsafe impl Sync for DriverVTable {}
 pub const fn create_phy_driver<T: Driver>() -> DriverVTable {
     // INVARIANT: All the fields of `struct phy_driver` are initialized properly.
     DriverVTable(Opaque::new(bindings::phy_driver {
-        name: T::NAME.as_char_ptr().cast_mut(),
+        name: crate::str::as_char_ptr_in_const_context(T::NAME).cast_mut(),
         flags: T::FLAGS,
         phy_id: T::PHY_DEVICE_ID.id(),
         phy_id_mask: T::PHY_DEVICE_ID.mask_as_int(),
diff --git a/rust/kernel/of.rs b/rust/kernel/of.rs
index b76b35265df2..58b20c367f99 100644
--- a/rust/kernel/of.rs
+++ b/rust/kernel/of.rs
@@ -34,7 +34,7 @@ fn index(&self) -> usize {
 impl DeviceId {
     /// Create a new device id from an OF 'compatible' string.
     pub const fn new(compatible: &'static CStr) -> Self {
-        let src = compatible.as_bytes_with_nul();
+        let src = compatible.to_bytes_with_nul();
         // Replace with `bindings::of_device_id::default()` once stabilized for `const`.
         // SAFETY: FFI type is valid to be zero-initialized.
         let mut of: bindings::of_device_id = unsafe { core::mem::zeroed() };
diff --git a/rust/kernel/prelude.rs b/rust/kernel/prelude.rs
index 25fe97aafd02..198d09a31449 100644
--- a/rust/kernel/prelude.rs
+++ b/rust/kernel/prelude.rs
@@ -12,7 +12,10 @@
 //! ```
 
 #[doc(no_inline)]
-pub use core::pin::Pin;
+pub use core::{
+    mem::{align_of, align_of_val, size_of, size_of_val},
+    pin::Pin,
+};
 
 pub use ::ffi::{
     c_char, c_int, c_long, c_longlong, c_schar, c_short, c_uchar, c_uint, c_ulong, c_ulonglong,
diff --git a/rust/kernel/ptr.rs b/rust/kernel/ptr.rs
new file mode 100644
index 000000000000..2e5e2a090480
--- /dev/null
+++ b/rust/kernel/ptr.rs
@@ -0,0 +1,228 @@
+// SPDX-License-Identifier: GPL-2.0
+
+//! Types and functions to work with pointers and addresses.
+
+use core::fmt::Debug;
+use core::mem::align_of;
+use core::num::NonZero;
+
+use crate::build_assert;
+
+/// Type representing an alignment, which is always a power of two.
+///
+/// It is used to validate that a given value is a valid alignment, and to perform masking and
+/// alignment operations.
+///
+/// This is a temporary substitute for the [`Alignment`] nightly type from the standard library,
+/// and to be eventually replaced by it.
+///
+/// [`Alignment`]: https://github.com/rust-lang/rust/issues/102070
+///
+/// # Invariants
+///
+/// An alignment is always a power of two.
+#[repr(transparent)]
+#[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]
+pub struct Alignment(NonZero<usize>);
+
+impl Alignment {
+    /// Validates that `ALIGN` is a power of two at build-time, and returns an [`Alignment`] of the
+    /// same value.
+    ///
+    /// A build error is triggered if `ALIGN` is not a power of two.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::Alignment;
+    ///
+    /// let v = Alignment::new::<16>();
+    /// assert_eq!(v.as_usize(), 16);
+    /// ```
+    #[inline(always)]
+    pub const fn new<const ALIGN: usize>() -> Self {
+        build_assert!(
+            ALIGN.is_power_of_two(),
+            "Provided alignment is not a power of two."
+        );
+
+        // INVARIANT: `align` is a power of two.
+        // SAFETY: `align` is a power of two, and thus non-zero.
+        Self(unsafe { NonZero::new_unchecked(ALIGN) })
+    }
+
+    /// Validates that `align` is a power of two at runtime, and returns an
+    /// [`Alignment`] of the same value.
+    ///
+    /// Returns [`None`] if `align` is not a power of two.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::Alignment;
+    ///
+    /// assert_eq!(Alignment::new_checked(16), Some(Alignment::new::<16>()));
+    /// assert_eq!(Alignment::new_checked(15), None);
+    /// assert_eq!(Alignment::new_checked(1), Some(Alignment::new::<1>()));
+    /// assert_eq!(Alignment::new_checked(0), None);
+    /// ```
+    #[inline(always)]
+    pub const fn new_checked(align: usize) -> Option<Self> {
+        if align.is_power_of_two() {
+            // INVARIANT: `align` is a power of two.
+            // SAFETY: `align` is a power of two, and thus non-zero.
+            Some(Self(unsafe { NonZero::new_unchecked(align) }))
+        } else {
+            None
+        }
+    }
+
+    /// Returns the alignment of `T`.
+    ///
+    /// This is equivalent to [`align_of`], but with the return value provided as an [`Alignment`].
+    #[inline(always)]
+    pub const fn of<T>() -> Self {
+        #![allow(clippy::incompatible_msrv)]
+        // This cannot panic since alignments are always powers of two.
+        //
+        // We unfortunately cannot use `new` as it would require the `generic_const_exprs` feature.
+        const { Alignment::new_checked(align_of::<T>()).unwrap() }
+    }
+
+    /// Returns this alignment as a [`usize`].
+    ///
+    /// It is guaranteed to be a power of two.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::Alignment;
+    ///
+    /// assert_eq!(Alignment::new::<16>().as_usize(), 16);
+    /// ```
+    #[inline(always)]
+    pub const fn as_usize(self) -> usize {
+        self.as_nonzero().get()
+    }
+
+    /// Returns this alignment as a [`NonZero`].
+    ///
+    /// It is guaranteed to be a power of two.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::Alignment;
+    ///
+    /// assert_eq!(Alignment::new::<16>().as_nonzero().get(), 16);
+    /// ```
+    #[inline(always)]
+    pub const fn as_nonzero(self) -> NonZero<usize> {
+        // Allow the compiler to know that the value is indeed a power of two. This can help
+        // optimize some operations down the line, like e.g. replacing divisions by bit shifts.
+        if !self.0.is_power_of_two() {
+            // SAFETY: Per the invariants, `self.0` is always a power of two so this block will
+            // never be reached.
+            unsafe { core::hint::unreachable_unchecked() }
+        }
+        self.0
+    }
+
+    /// Returns the base-2 logarithm of the alignment.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::Alignment;
+    ///
+    /// assert_eq!(Alignment::of::<u8>().log2(), 0);
+    /// assert_eq!(Alignment::new::<16>().log2(), 4);
+    /// ```
+    #[inline(always)]
+    pub const fn log2(self) -> u32 {
+        self.0.ilog2()
+    }
+
+    /// Returns the mask for this alignment.
+    ///
+    /// This is equivalent to `!(self.as_usize() - 1)`.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::Alignment;
+    ///
+    /// assert_eq!(Alignment::new::<0x10>().mask(), !0xf);
+    /// ```
+    #[inline(always)]
+    pub const fn mask(self) -> usize {
+        // No underflow can occur as the alignment is guaranteed to be a power of two, and thus is
+        // non-zero.
+        !(self.as_usize() - 1)
+    }
+}
+
+/// Trait for items that can be aligned against an [`Alignment`].
+pub trait Alignable: Sized {
+    /// Aligns `self` down to `alignment`.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::{Alignable, Alignment};
+    ///
+    /// assert_eq!(0x2f_usize.align_down(Alignment::new::<0x10>()), 0x20);
+    /// assert_eq!(0x30usize.align_down(Alignment::new::<0x10>()), 0x30);
+    /// assert_eq!(0xf0u8.align_down(Alignment::new::<0x1000>()), 0x0);
+    /// ```
+    fn align_down(self, alignment: Alignment) -> Self;
+
+    /// Aligns `self` up to `alignment`, returning `None` if aligning would result in an overflow.
+    ///
+    /// # Examples
+    ///
+    /// ```
+    /// use kernel::ptr::{Alignable, Alignment};
+    ///
+    /// assert_eq!(0x4fusize.align_up(Alignment::new::<0x10>()), Some(0x50));
+    /// assert_eq!(0x40usize.align_up(Alignment::new::<0x10>()), Some(0x40));
+    /// assert_eq!(0x0usize.align_up(Alignment::new::<0x10>()), Some(0x0));
+    /// assert_eq!(u8::MAX.align_up(Alignment::new::<0x10>()), None);
+    /// assert_eq!(0x10u8.align_up(Alignment::new::<0x100>()), None);
+    /// assert_eq!(0x0u8.align_up(Alignment::new::<0x100>()), Some(0x0));
+    /// ```
+    fn align_up(self, alignment: Alignment) -> Option<Self>;
+}
+
+/// Implement [`Alignable`] for unsigned integer types.
+macro_rules! impl_alignable_uint {
+    ($($t:ty),*) => {
+        $(
+        impl Alignable for $t {
+            #[inline(always)]
+            fn align_down(self, alignment: Alignment) -> Self {
+                // The operands of `&` need to be of the same type so convert the alignment to
+                // `Self`. This means we need to compute the mask ourselves.
+                ::core::num::NonZero::<Self>::try_from(alignment.as_nonzero())
+                    .map(|align| self & !(align.get() - 1))
+                    // An alignment larger than `Self` always aligns down to `0`.
+                    .unwrap_or(0)
+            }
+
+            #[inline(always)]
+            fn align_up(self, alignment: Alignment) -> Option<Self> {
+                let aligned_down = self.align_down(alignment);
+                if self == aligned_down {
+                    Some(aligned_down)
+                } else {
+                    Self::try_from(alignment.as_usize())
+                        .ok()
+                        .and_then(|align| aligned_down.checked_add(align))
+                }
+            }
+        }
+        )*
+    };
+}
+
+impl_alignable_uint!(u8, u16, u32, u64, usize);
diff --git a/rust/kernel/seq_file.rs b/rust/kernel/seq_file.rs
index 8f199b1a3bb1..59fbfc2473f8 100644
--- a/rust/kernel/seq_file.rs
+++ b/rust/kernel/seq_file.rs
@@ -4,7 +4,7 @@
 //!
 //! C header: [`include/linux/seq_file.h`](srctree/include/linux/seq_file.h)
 
-use crate::{bindings, c_str, types::NotThreadSafe, types::Opaque};
+use crate::{bindings, c_str, fmt, types::NotThreadSafe, types::Opaque};
 
 /// A utility for generating the contents of a seq file.
 #[repr(transparent)]
@@ -31,7 +31,7 @@ pub unsafe fn from_raw<'a>(ptr: *mut bindings::seq_file) -> &'a SeqFile {
 
     /// Used by the [`seq_print`] macro.
     #[inline]
-    pub fn call_printf(&self, args: core::fmt::Arguments<'_>) {
+    pub fn call_printf(&self, args: fmt::Arguments<'_>) {
         // SAFETY: Passing a void pointer to `Arguments` is valid for `%pA`.
         unsafe {
             bindings::seq_printf(
@@ -47,7 +47,7 @@ pub fn call_printf(&self, args: core::fmt::Arguments<'_>) {
 #[macro_export]
 macro_rules! seq_print {
     ($m:expr, $($arg:tt)+) => (
-        $m.call_printf(format_args!($($arg)+))
+        $m.call_printf($crate::prelude::fmt!($($arg)+))
     );
 }
 pub use seq_print;
diff --git a/rust/kernel/sync/arc.rs b/rust/kernel/sync/arc.rs
index 9298993ea7d8..289f77abf415 100644
--- a/rust/kernel/sync/arc.rs
+++ b/rust/kernel/sync/arc.rs
@@ -19,6 +19,7 @@
 use crate::{
     alloc::{AllocError, Flags, KBox},
     ffi::c_void,
+    fmt,
     init::InPlaceInit,
     sync::Refcount,
     try_init,
@@ -27,7 +28,6 @@
 use core::{
     alloc::Layout,
     borrow::{Borrow, BorrowMut},
-    fmt,
     marker::PhantomData,
     mem::{ManuallyDrop, MaybeUninit},
     ops::{Deref, DerefMut},
@@ -367,10 +367,10 @@ pub fn into_unique_or_drop(this: Self) -> Option<Pin<UniqueArc<T>>> {
     }
 }
 
-// SAFETY: The pointer returned by `into_foreign` comes from a well aligned
-// pointer to `ArcInner<T>`.
+// SAFETY: The pointer returned by `into_foreign` was originally allocated as an
+// `KBox<ArcInner<T>>`, so that type is what determines the alignment.
 unsafe impl<T: 'static> ForeignOwnable for Arc<T> {
-    const FOREIGN_ALIGN: usize = core::mem::align_of::<ArcInner<T>>();
+    const FOREIGN_ALIGN: usize = <KBox<ArcInner<T>> as ForeignOwnable>::FOREIGN_ALIGN;
 
     type Borrowed<'a> = ArcBorrow<'a, T>;
     type BorrowedMut<'a> = Self::Borrowed<'a>;
diff --git a/rust/kernel/sync/aref.rs b/rust/kernel/sync/aref.rs
index dbd77bb68617..0d24a0432015 100644
--- a/rust/kernel/sync/aref.rs
+++ b/rust/kernel/sync/aref.rs
@@ -1,6 +1,21 @@
 // SPDX-License-Identifier: GPL-2.0
 
 //! Internal reference counting support.
+//!
+//! Many C types already have their own reference counting mechanism (e.g. by storing a
+//! `refcount_t`). This module provides support for directly using their internal reference count
+//! from Rust; instead of making users have to use an additional Rust-reference count in the form of
+//! [`Arc`].
+//!
+//! The smart pointer [`ARef<T>`] acts similarly to [`Arc<T>`] in that it holds a refcount on the
+//! underlying object, but this refcount is internal to the object. It essentially is a Rust
+//! implementation of the `get_` and `put_` pattern used in C for reference counting.
+//!
+//! To make use of [`ARef<MyType>`], `MyType` needs to implement [`AlwaysRefCounted`]. It is a trait
+//! for accessing the internal reference count of an object of the `MyType` type.
+//!
+//! [`Arc`]: crate::sync::Arc
+//! [`Arc<T>`]: crate::sync::Arc
 
 use core::{marker::PhantomData, mem::ManuallyDrop, ops::Deref, ptr::NonNull};
 
@@ -97,7 +112,7 @@ pub unsafe fn from_raw(ptr: NonNull<T>) -> Self {
     ///
     /// ```
     /// use core::ptr::NonNull;
-    /// use kernel::types::{ARef, AlwaysRefCounted};
+    /// use kernel::sync::aref::{ARef, AlwaysRefCounted};
     ///
     /// struct Empty {}
     ///
diff --git a/rust/kernel/task.rs b/rust/kernel/task.rs
index 7d0935bc325c..49fad6de0674 100644
--- a/rust/kernel/task.rs
+++ b/rust/kernel/task.rs
@@ -9,7 +9,8 @@
     ffi::{c_int, c_long, c_uint},
     mm::MmWithUser,
     pid_namespace::PidNamespace,
-    types::{ARef, NotThreadSafe, Opaque},
+    sync::aref::ARef,
+    types::{NotThreadSafe, Opaque},
 };
 use core::{
     cmp::{Eq, PartialEq},
@@ -76,7 +77,7 @@ macro_rules! current {
 /// incremented when creating `State` and decremented when it is dropped:
 ///
 /// ```
-/// use kernel::{task::Task, types::ARef};
+/// use kernel::{task::Task, sync::aref::ARef};
 ///
 /// struct State {
 ///     creator: ARef<Task>,
@@ -347,7 +348,7 @@ pub fn active_pid_ns(&self) -> Option<&PidNamespace> {
 }
 
 // SAFETY: The type invariants guarantee that `Task` is always refcounted.
-unsafe impl crate::types::AlwaysRefCounted for Task {
+unsafe impl crate::sync::aref::AlwaysRefCounted for Task {
     #[inline]
     fn inc_ref(&self) {
         // SAFETY: The existence of a shared reference means that the refcount is nonzero.
diff --git a/rust/kernel/time.rs b/rust/kernel/time.rs
index 64c8dcf548d6..6ea98dfcd027 100644
--- a/rust/kernel/time.rs
+++ b/rust/kernel/time.rs
@@ -25,6 +25,7 @@
 //! C header: [`include/linux/ktime.h`](srctree/include/linux/ktime.h).
 
 use core::marker::PhantomData;
+use core::ops;
 
 pub mod delay;
 pub mod hrtimer;
@@ -200,9 +201,31 @@ pub fn elapsed(&self) -> Delta {
     pub(crate) fn as_nanos(&self) -> i64 {
         self.inner
     }
+
+    /// Create an [`Instant`] from a `ktime_t` without checking if it is non-negative.
+    ///
+    /// # Panics
+    ///
+    /// On debug builds, this function will panic if `ktime` is not in the range from 0 to
+    /// `KTIME_MAX`.
+    ///
+    /// # Safety
+    ///
+    /// The caller promises that `ktime` is in the range from 0 to `KTIME_MAX`.
+    #[inline]
+    pub(crate) unsafe fn from_ktime(ktime: bindings::ktime_t) -> Self {
+        debug_assert!(ktime >= 0);
+
+        // INVARIANT: Our safety contract ensures that `ktime` is in the range from 0 to
+        // `KTIME_MAX`.
+        Self {
+            inner: ktime,
+            _c: PhantomData,
+        }
+    }
 }
 
-impl<C: ClockSource> core::ops::Sub for Instant<C> {
+impl<C: ClockSource> ops::Sub for Instant<C> {
     type Output = Delta;
 
     // By the type invariant, it never overflows.
@@ -214,6 +237,46 @@ fn sub(self, other: Instant<C>) -> Delta {
     }
 }
 
+impl<T: ClockSource> ops::Add<Delta> for Instant<T> {
+    type Output = Self;
+
+    #[inline]
+    fn add(self, rhs: Delta) -> Self::Output {
+        // INVARIANT: With arithmetic over/underflow checks enabled, this will panic if we overflow
+        // (e.g. go above `KTIME_MAX`)
+        let res = self.inner + rhs.nanos;
+
+        // INVARIANT: With overflow checks enabled, we verify here that the value is >= 0
+        #[cfg(CONFIG_RUST_OVERFLOW_CHECKS)]
+        assert!(res >= 0);
+
+        Self {
+            inner: res,
+            _c: PhantomData,
+        }
+    }
+}
+
+impl<T: ClockSource> ops::Sub<Delta> for Instant<T> {
+    type Output = Self;
+
+    #[inline]
+    fn sub(self, rhs: Delta) -> Self::Output {
+        // INVARIANT: With arithmetic over/underflow checks enabled, this will panic if we overflow
+        // (e.g. go above `KTIME_MAX`)
+        let res = self.inner - rhs.nanos;
+
+        // INVARIANT: With overflow checks enabled, we verify here that the value is >= 0
+        #[cfg(CONFIG_RUST_OVERFLOW_CHECKS)]
+        assert!(res >= 0);
+
+        Self {
+            inner: res,
+            _c: PhantomData,
+        }
+    }
+}
+
 /// A span of time.
 ///
 /// This struct represents a span of time, with its value stored as nanoseconds.
@@ -224,6 +287,78 @@ pub struct Delta {
     nanos: i64,
 }
 
+impl ops::Add for Delta {
+    type Output = Self;
+
+    #[inline]
+    fn add(self, rhs: Self) -> Self {
+        Self {
+            nanos: self.nanos + rhs.nanos,
+        }
+    }
+}
+
+impl ops::AddAssign for Delta {
+    #[inline]
+    fn add_assign(&mut self, rhs: Self) {
+        self.nanos += rhs.nanos;
+    }
+}
+
+impl ops::Sub for Delta {
+    type Output = Self;
+
+    #[inline]
+    fn sub(self, rhs: Self) -> Self::Output {
+        Self {
+            nanos: self.nanos - rhs.nanos,
+        }
+    }
+}
+
+impl ops::SubAssign for Delta {
+    #[inline]
+    fn sub_assign(&mut self, rhs: Self) {
+        self.nanos -= rhs.nanos;
+    }
+}
+
+impl ops::Mul<i64> for Delta {
+    type Output = Self;
+
+    #[inline]
+    fn mul(self, rhs: i64) -> Self::Output {
+        Self {
+            nanos: self.nanos * rhs,
+        }
+    }
+}
+
+impl ops::MulAssign<i64> for Delta {
+    #[inline]
+    fn mul_assign(&mut self, rhs: i64) {
+        self.nanos *= rhs;
+    }
+}
+
+impl ops::Div for Delta {
+    type Output = i64;
+
+    #[inline]
+    fn div(self, rhs: Self) -> Self::Output {
+        #[cfg(CONFIG_64BIT)]
+        {
+            self.nanos / rhs.nanos
+        }
+
+        #[cfg(not(CONFIG_64BIT))]
+        {
+            // SAFETY: This function is always safe to call regardless of the input values
+            unsafe { bindings::div64_s64(self.nanos, rhs.nanos) }
+        }
+    }
+}
+
 impl Delta {
     /// A span of time equal to zero.
     pub const ZERO: Self = Self { nanos: 0 };
@@ -312,4 +447,30 @@ pub fn as_millis(self) -> i64 {
             bindings::ktime_to_ms(self.as_nanos())
         }
     }
+
+    /// Return `self % dividend` where `dividend` is in nanoseconds.
+    ///
+    /// The kernel doesn't have any emulation for `s64 % s64` on 32 bit platforms, so this is
+    /// limited to 32 bit dividends.
+    #[inline]
+    pub fn rem_nanos(self, dividend: i32) -> Self {
+        #[cfg(CONFIG_64BIT)]
+        {
+            Self {
+                nanos: self.as_nanos() % i64::from(dividend),
+            }
+        }
+
+        #[cfg(not(CONFIG_64BIT))]
+        {
+            let mut rem = 0;
+
+            // SAFETY: `rem` is in the stack, so we can always provide a valid pointer to it.
+            unsafe { bindings::div_s64_rem(self.as_nanos(), dividend, &mut rem) };
+
+            Self {
+                nanos: i64::from(rem),
+            }
+        }
+    }
 }
diff --git a/rust/kernel/time/hrtimer.rs b/rust/kernel/time/hrtimer.rs
index 144e3b57cc78..856d2d929a00 100644
--- a/rust/kernel/time/hrtimer.rs
+++ b/rust/kernel/time/hrtimer.rs
@@ -69,9 +69,14 @@
 
 use super::{ClockSource, Delta, Instant};
 use crate::{prelude::*, types::Opaque};
-use core::marker::PhantomData;
+use core::{marker::PhantomData, ptr::NonNull};
 use pin_init::PinInit;
 
+/// A type-alias to refer to the [`Instant<C>`] for a given `T` from [`HrTimer<T>`].
+///
+/// Where `C` is the [`ClockSource`] of the [`HrTimer`].
+pub type HrTimerInstant<T> = Instant<<<T as HasHrTimer<T>>::TimerMode as HrTimerMode>::Clock>;
+
 /// A timer backed by a C `struct hrtimer`.
 ///
 /// # Invariants
@@ -163,6 +168,84 @@ pub(crate) unsafe fn raw_cancel(this: *const Self) -> bool {
         // handled on the C side.
         unsafe { bindings::hrtimer_cancel(c_timer_ptr) != 0 }
     }
+
+    /// Forward the timer expiry for a given timer pointer.
+    ///
+    /// # Safety
+    ///
+    /// - `self_ptr` must point to a valid `Self`.
+    /// - The caller must either have exclusive access to the data pointed at by `self_ptr`, or be
+    ///   within the context of the timer callback.
+    #[inline]
+    unsafe fn raw_forward(self_ptr: *mut Self, now: HrTimerInstant<T>, interval: Delta) -> u64
+    where
+        T: HasHrTimer<T>,
+    {
+        // SAFETY:
+        // * The C API requirements for this function are fulfilled by our safety contract.
+        // * `self_ptr` is guaranteed to point to a valid `Self` via our safety contract
+        unsafe {
+            bindings::hrtimer_forward(Self::raw_get(self_ptr), now.as_nanos(), interval.as_nanos())
+        }
+    }
+
+    /// Conditionally forward the timer.
+    ///
+    /// If the timer expires after `now`, this function does nothing and returns 0. If the timer
+    /// expired at or before `now`, this function forwards the timer by `interval` until the timer
+    /// expires after `now` and then returns the number of times the timer was forwarded by
+    /// `interval`.
+    ///
+    /// This function is mainly useful for timer types which can provide exclusive access to the
+    /// timer when the timer is not running. For forwarding the timer from within the timer callback
+    /// context, see [`HrTimerCallbackContext::forward()`].
+    ///
+    /// Returns the number of overruns that occurred as a result of the timer expiry change.
+    pub fn forward(self: Pin<&mut Self>, now: HrTimerInstant<T>, interval: Delta) -> u64
+    where
+        T: HasHrTimer<T>,
+    {
+        // SAFETY: `raw_forward` does not move `Self`
+        let this = unsafe { self.get_unchecked_mut() };
+
+        // SAFETY: By existence of `Pin<&mut Self>`, the pointer passed to `raw_forward` points to a
+        // valid `Self` that we have exclusive access to.
+        unsafe { Self::raw_forward(this, now, interval) }
+    }
+
+    /// Conditionally forward the timer.
+    ///
+    /// This is a variant of [`forward()`](Self::forward) that uses an interval after the current
+    /// time of the base clock for the [`HrTimer`].
+    pub fn forward_now(self: Pin<&mut Self>, interval: Delta) -> u64
+    where
+        T: HasHrTimer<T>,
+    {
+        self.forward(HrTimerInstant::<T>::now(), interval)
+    }
+
+    /// Return the time expiry for this [`HrTimer`].
+    ///
+    /// This value should only be used as a snapshot, as the actual expiry time could change after
+    /// this function is called.
+    pub fn expires(&self) -> HrTimerInstant<T>
+    where
+        T: HasHrTimer<T>,
+    {
+        // SAFETY: `self` is an immutable reference and thus always points to a valid `HrTimer`.
+        let c_timer_ptr = unsafe { HrTimer::raw_get(self) };
+
+        // SAFETY:
+        // - Timers cannot have negative ktime_t values as their expiration time.
+        // - There's no actual locking here, a racy read is fine and expected
+        unsafe {
+            Instant::from_ktime(
+                // This `read_volatile` is intended to correspond to a READ_ONCE call.
+                // FIXME(read_once): Replace with `read_once` when available on the Rust side.
+                core::ptr::read_volatile(&raw const ((*c_timer_ptr).node.expires)),
+            )
+        }
+    }
 }
 
 /// Implemented by pointer types that point to structs that contain a [`HrTimer`].
@@ -300,9 +383,13 @@ pub trait HrTimerCallback {
     type Pointer<'a>: RawHrTimerCallback;
 
     /// Called by the timer logic when the timer fires.
-    fn run(this: <Self::Pointer<'_> as RawHrTimerCallback>::CallbackTarget<'_>) -> HrTimerRestart
+    fn run(
+        this: <Self::Pointer<'_> as RawHrTimerCallback>::CallbackTarget<'_>,
+        ctx: HrTimerCallbackContext<'_, Self>,
+    ) -> HrTimerRestart
     where
-        Self: Sized;
+        Self: Sized,
+        Self: HasHrTimer<Self>;
 }
 
 /// A handle representing a potentially running timer.
@@ -324,6 +411,8 @@ pub unsafe trait HrTimerHandle {
     /// Note that the timer might be started by a concurrent start operation. If
     /// so, the timer might not be in the **stopped** state when this function
     /// returns.
+    ///
+    /// Returns `true` if the timer was running.
     fn cancel(&mut self) -> bool;
 }
 
@@ -585,6 +674,63 @@ impl<C: ClockSource> HrTimerMode for RelativePinnedHardMode<C> {
     type Expires = Delta;
 }
 
+/// Privileged smart-pointer for a [`HrTimer`] callback context.
+///
+/// Many [`HrTimer`] methods can only be called in two situations:
+///
+/// * When the caller has exclusive access to the `HrTimer` and the `HrTimer` is guaranteed not to
+///   be running.
+/// * From within the context of an `HrTimer`'s callback method.
+///
+/// This type provides access to said methods from within a timer callback context.
+///
+/// # Invariants
+///
+/// * The existence of this type means the caller is currently within the callback for an
+///   [`HrTimer`].
+/// * `self.0` always points to a live instance of [`HrTimer<T>`].
+pub struct HrTimerCallbackContext<'a, T: HasHrTimer<T>>(NonNull<HrTimer<T>>, PhantomData<&'a ()>);
+
+impl<'a, T: HasHrTimer<T>> HrTimerCallbackContext<'a, T> {
+    /// Create a new [`HrTimerCallbackContext`].
+    ///
+    /// # Safety
+    ///
+    /// This function relies on the caller being within the context of a timer callback, so it must
+    /// not be used anywhere except for within implementations of [`RawHrTimerCallback::run`]. The
+    /// caller promises that `timer` points to a valid initialized instance of
+    /// [`bindings::hrtimer`].
+    ///
+    /// The returned `Self` must not outlive the function context of [`RawHrTimerCallback::run`]
+    /// where this function is called.
+    pub(crate) unsafe fn from_raw(timer: *mut HrTimer<T>) -> Self {
+        // SAFETY: The caller guarantees `timer` is a valid pointer to an initialized
+        // `bindings::hrtimer`
+        // INVARIANT: Our safety contract ensures that we're within the context of a timer callback
+        // and that `timer` points to a live instance of `HrTimer<T>`.
+        Self(unsafe { NonNull::new_unchecked(timer) }, PhantomData)
+    }
+
+    /// Conditionally forward the timer.
+    ///
+    /// This function is identical to [`HrTimer::forward()`] except that it may only be used from
+    /// within the context of a [`HrTimer`] callback.
+    pub fn forward(&mut self, now: HrTimerInstant<T>, interval: Delta) -> u64 {
+        // SAFETY:
+        // - We are guaranteed to be within the context of a timer callback by our type invariants
+        // - By our type invariants, `self.0` always points to a valid `HrTimer<T>`
+        unsafe { HrTimer::<T>::raw_forward(self.0.as_ptr(), now, interval) }
+    }
+
+    /// Conditionally forward the timer.
+    ///
+    /// This is a variant of [`HrTimerCallbackContext::forward()`] that uses an interval after the
+    /// current time of the base clock for the [`HrTimer`].
+    pub fn forward_now(&mut self, duration: Delta) -> u64 {
+        self.forward(HrTimerInstant::<T>::now(), duration)
+    }
+}
+
 /// Use to implement the [`HasHrTimer<T>`] trait.
 ///
 /// See [`module`] documentation for an example.
diff --git a/rust/kernel/time/hrtimer/arc.rs b/rust/kernel/time/hrtimer/arc.rs
index ed490a7a8950..7be82bcb352a 100644
--- a/rust/kernel/time/hrtimer/arc.rs
+++ b/rust/kernel/time/hrtimer/arc.rs
@@ -3,6 +3,7 @@
 use super::HasHrTimer;
 use super::HrTimer;
 use super::HrTimerCallback;
+use super::HrTimerCallbackContext;
 use super::HrTimerHandle;
 use super::HrTimerMode;
 use super::HrTimerPointer;
@@ -99,6 +100,12 @@ impl<T> RawHrTimerCallback for Arc<T>
         //    allocation from other `Arc` clones.
         let receiver = unsafe { ArcBorrow::from_raw(data_ptr) };
 
-        T::run(receiver).into_c()
+        // SAFETY:
+        // - By C API contract `timer_ptr` is the pointer that we passed when queuing the timer, so
+        //   it is a valid pointer to a `HrTimer<T>` embedded in a `T`.
+        // - We are within `RawHrTimerCallback::run`
+        let context = unsafe { HrTimerCallbackContext::from_raw(timer_ptr) };
+
+        T::run(receiver, context).into_c()
     }
 }
diff --git a/rust/kernel/time/hrtimer/pin.rs b/rust/kernel/time/hrtimer/pin.rs
index aef16d9ee2f0..4d39ef781697 100644
--- a/rust/kernel/time/hrtimer/pin.rs
+++ b/rust/kernel/time/hrtimer/pin.rs
@@ -3,6 +3,7 @@
 use super::HasHrTimer;
 use super::HrTimer;
 use super::HrTimerCallback;
+use super::HrTimerCallbackContext;
 use super::HrTimerHandle;
 use super::HrTimerMode;
 use super::RawHrTimerCallback;
@@ -103,6 +104,12 @@ impl<'a, T> RawHrTimerCallback for Pin<&'a T>
         // here.
         let receiver_pin = unsafe { Pin::new_unchecked(receiver_ref) };
 
-        T::run(receiver_pin).into_c()
+        // SAFETY:
+        // - By C API contract `timer_ptr` is the pointer that we passed when queuing the timer, so
+        //   it is a valid pointer to a `HrTimer<T>` embedded in a `T`.
+        // - We are within `RawHrTimerCallback::run`
+        let context = unsafe { HrTimerCallbackContext::from_raw(timer_ptr) };
+
+        T::run(receiver_pin, context).into_c()
     }
 }
diff --git a/rust/kernel/time/hrtimer/pin_mut.rs b/rust/kernel/time/hrtimer/pin_mut.rs
index 767d0a4e8a2c..9d9447d4d57e 100644
--- a/rust/kernel/time/hrtimer/pin_mut.rs
+++ b/rust/kernel/time/hrtimer/pin_mut.rs
@@ -1,8 +1,8 @@
 // SPDX-License-Identifier: GPL-2.0
 
 use super::{
-    HasHrTimer, HrTimer, HrTimerCallback, HrTimerHandle, HrTimerMode, RawHrTimerCallback,
-    UnsafeHrTimerPointer,
+    HasHrTimer, HrTimer, HrTimerCallback, HrTimerCallbackContext, HrTimerHandle, HrTimerMode,
+    RawHrTimerCallback, UnsafeHrTimerPointer,
 };
 use core::{marker::PhantomData, pin::Pin, ptr::NonNull};
 
@@ -107,6 +107,12 @@ impl<'a, T> RawHrTimerCallback for Pin<&'a mut T>
         // here.
         let receiver_pin = unsafe { Pin::new_unchecked(receiver_ref) };
 
-        T::run(receiver_pin).into_c()
+        // SAFETY:
+        // - By C API contract `timer_ptr` is the pointer that we passed when queuing the timer, so
+        //   it is a valid pointer to a `HrTimer<T>` embedded in a `T`.
+        // - We are within `RawHrTimerCallback::run`
+        let context = unsafe { HrTimerCallbackContext::from_raw(timer_ptr) };
+
+        T::run(receiver_pin, context).into_c()
     }
 }
diff --git a/rust/kernel/time/hrtimer/tbox.rs b/rust/kernel/time/hrtimer/tbox.rs
index ec08303315f2..aa1ee31a7195 100644
--- a/rust/kernel/time/hrtimer/tbox.rs
+++ b/rust/kernel/time/hrtimer/tbox.rs
@@ -3,6 +3,7 @@
 use super::HasHrTimer;
 use super::HrTimer;
 use super::HrTimerCallback;
+use super::HrTimerCallbackContext;
 use super::HrTimerHandle;
 use super::HrTimerMode;
 use super::HrTimerPointer;
@@ -119,6 +120,12 @@ impl<T, A> RawHrTimerCallback for Pin<Box<T, A>>
         //   `data_ptr` exist.
         let data_mut_ref = unsafe { Pin::new_unchecked(&mut *data_ptr) };
 
-        T::run(data_mut_ref).into_c()
+        // SAFETY:
+        // - By C API contract `timer_ptr` is the pointer that we passed when queuing the timer, so
+        //   it is a valid pointer to a `HrTimer<T>` embedded in a `T`.
+        // - We are within `RawHrTimerCallback::run`
+        let context = unsafe { HrTimerCallbackContext::from_raw(timer_ptr) };
+
+        T::run(data_mut_ref, context).into_c()
     }
 }
diff --git a/rust/macros/quote.rs b/rust/macros/quote.rs
index 92cacc4067c9..acc140c18653 100644
--- a/rust/macros/quote.rs
+++ b/rust/macros/quote.rs
@@ -2,7 +2,6 @@
 
 use proc_macro::{TokenStream, TokenTree};
 
-#[allow(dead_code)]
 pub(crate) trait ToTokens {
     fn to_tokens(&self, tokens: &mut TokenStream);
 }
@@ -47,121 +46,116 @@ fn to_tokens(&self, tokens: &mut TokenStream) {
 /// `quote` crate but provides only just enough functionality needed by the current `macros` crate.
 macro_rules! quote_spanned {
     ($span:expr => $($tt:tt)*) => {{
-        let mut tokens: ::std::vec::Vec<::proc_macro::TokenTree>;
-        #[allow(clippy::vec_init_then_push)]
+        let mut tokens = ::proc_macro::TokenStream::new();
         {
-            tokens = ::std::vec::Vec::new();
             let span = $span;
             quote_spanned!(@proc tokens span $($tt)*);
         }
-        ::proc_macro::TokenStream::from_iter(tokens)
+        tokens
     }};
     (@proc $v:ident $span:ident) => {};
     (@proc $v:ident $span:ident #$id:ident $($tt:tt)*) => {
-        let mut ts = ::proc_macro::TokenStream::new();
-        $crate::quote::ToTokens::to_tokens(&$id, &mut ts);
-        $v.extend(ts);
+        $crate::quote::ToTokens::to_tokens(&$id, &mut $v);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident #(#$id:ident)* $($tt:tt)*) => {
         for token in $id {
-            let mut ts = ::proc_macro::TokenStream::new();
-            $crate::quote::ToTokens::to_tokens(&token, &mut ts);
-            $v.extend(ts);
+            $crate::quote::ToTokens::to_tokens(&token, &mut $v);
         }
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident ( $($inner:tt)* ) $($tt:tt)*) => {
         #[allow(unused_mut)]
-        let mut tokens = ::std::vec::Vec::<::proc_macro::TokenTree>::new();
+        let mut tokens = ::proc_macro::TokenStream::new();
         quote_spanned!(@proc tokens $span $($inner)*);
-        $v.push(::proc_macro::TokenTree::Group(::proc_macro::Group::new(
+        $v.extend([::proc_macro::TokenTree::Group(::proc_macro::Group::new(
             ::proc_macro::Delimiter::Parenthesis,
-            ::proc_macro::TokenStream::from_iter(tokens)
-        )));
+            tokens,
+        ))]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident [ $($inner:tt)* ] $($tt:tt)*) => {
-        let mut tokens = ::std::vec::Vec::new();
+        let mut tokens = ::proc_macro::TokenStream::new();
         quote_spanned!(@proc tokens $span $($inner)*);
-        $v.push(::proc_macro::TokenTree::Group(::proc_macro::Group::new(
+        $v.extend([::proc_macro::TokenTree::Group(::proc_macro::Group::new(
             ::proc_macro::Delimiter::Bracket,
-            ::proc_macro::TokenStream::from_iter(tokens)
-        )));
+            tokens,
+        ))]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident { $($inner:tt)* } $($tt:tt)*) => {
-        let mut tokens = ::std::vec::Vec::new();
+        let mut tokens = ::proc_macro::TokenStream::new();
         quote_spanned!(@proc tokens $span $($inner)*);
-        $v.push(::proc_macro::TokenTree::Group(::proc_macro::Group::new(
+        $v.extend([::proc_macro::TokenTree::Group(::proc_macro::Group::new(
             ::proc_macro::Delimiter::Brace,
-            ::proc_macro::TokenStream::from_iter(tokens)
-        )));
+            tokens,
+        ))]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident :: $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new(':', ::proc_macro::Spacing::Joint)
-        ));
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new(':', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::Spacing::Joint, ::proc_macro::Spacing::Alone].map(|spacing| {
+            ::proc_macro::TokenTree::Punct(::proc_macro::Punct::new(':', spacing))
+        }));
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident : $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new(':', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new(':', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident , $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new(',', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new(',', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident @ $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new('@', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new('@', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident ! $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new('!', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new('!', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident ; $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new(';', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new(';', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident + $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new('+', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new('+', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident = $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new('=', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new('=', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident # $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Punct(
-                ::proc_macro::Punct::new('#', ::proc_macro::Spacing::Alone)
-        ));
+        $v.extend([::proc_macro::TokenTree::Punct(
+            ::proc_macro::Punct::new('#', ::proc_macro::Spacing::Alone),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident _ $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Ident(::proc_macro::Ident::new("_", $span)));
+        $v.extend([::proc_macro::TokenTree::Ident(
+            ::proc_macro::Ident::new("_", $span),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
     (@proc $v:ident $span:ident $id:ident $($tt:tt)*) => {
-        $v.push(::proc_macro::TokenTree::Ident(::proc_macro::Ident::new(stringify!($id), $span)));
+        $v.extend([::proc_macro::TokenTree::Ident(
+            ::proc_macro::Ident::new(stringify!($id), $span),
+        )]);
         quote_spanned!(@proc $v $span $($tt)*);
     };
 }
diff --git a/rust/uapi/lib.rs b/rust/uapi/lib.rs
index 31c2f713313f..1d5fd9efb93e 100644
--- a/rust/uapi/lib.rs
+++ b/rust/uapi/lib.rs
@@ -34,4 +34,6 @@
 type __kernel_ssize_t = isize;
 type __kernel_ptrdiff_t = isize;
 
+use pin_init::MaybeZeroable;
+
 include!(concat!(env!("OBJTREE"), "/rust/uapi/uapi_generated.rs"));
diff --git a/samples/rust/rust_configfs.rs b/samples/rust/rust_configfs.rs
index ad364fb93e53..0ccc7553ef39 100644
--- a/samples/rust/rust_configfs.rs
+++ b/samples/rust/rust_configfs.rs
@@ -94,7 +94,7 @@ impl configfs::AttributeOperations<0> for Configuration {
 
     fn show(container: &Configuration, page: &mut [u8; PAGE_SIZE]) -> Result<usize> {
         pr_info!("Show message\n");
-        let data = container.message;
+        let data = container.message.to_bytes();
         page[0..data.len()].copy_from_slice(data);
         Ok(data.len())
     }
diff --git a/samples/rust/rust_dma.rs b/samples/rust/rust_dma.rs
index f55c6a37ccd9..4d324f06cc2a 100644
--- a/samples/rust/rust_dma.rs
+++ b/samples/rust/rust_dma.rs
@@ -10,7 +10,7 @@
     page, pci,
     prelude::*,
     scatterlist::{Owned, SGTable},
-    types::ARef,
+    sync::aref::ARef,
 };
 
 #[pin_data(PinnedDrop)]
diff --git a/scripts/gcc-plugins/gcc-common.h b/scripts/gcc-plugins/gcc-common.h
index 6cb6d1051815..8f1b3500f8e2 100644
--- a/scripts/gcc-plugins/gcc-common.h
+++ b/scripts/gcc-plugins/gcc-common.h
@@ -173,10 +173,17 @@ static inline opt_pass *get_pass_for_id(int id)
 	return g->get_passes()->get_pass_for_id(id);
 }
 
+#if BUILDING_GCC_VERSION < 16000
 #define TODO_verify_ssa TODO_verify_il
 #define TODO_verify_flow TODO_verify_il
 #define TODO_verify_stmts TODO_verify_il
 #define TODO_verify_rtl_sharing TODO_verify_il
+#else
+#define TODO_verify_ssa 0
+#define TODO_verify_flow 0
+#define TODO_verify_stmts 0
+#define TODO_verify_rtl_sharing 0
+#endif
 
 #define INSN_DELETED_P(insn) (insn)->deleted()
 
diff --git a/scripts/generate_rust_analyzer.py b/scripts/generate_rust_analyzer.py
index 7c3ea2b55041..fc27f0cca752 100755
--- a/scripts/generate_rust_analyzer.py
+++ b/scripts/generate_rust_analyzer.py
@@ -139,8 +139,8 @@ def generate_crates(srctree, objtree, sysroot_src, external_src, cfgs, core_edit
             "exclude_dirs": [],
         }
 
-    append_crate_with_generated("bindings", ["core", "ffi"])
-    append_crate_with_generated("uapi", ["core", "ffi"])
+    append_crate_with_generated("bindings", ["core", "ffi", "pin_init"])
+    append_crate_with_generated("uapi", ["core", "ffi", "pin_init"])
     append_crate_with_generated("kernel", ["core", "macros", "build_error", "pin_init", "ffi", "bindings", "uapi"])
 
     def is_root_crate(build_file, target):
diff --git a/scripts/kconfig/expr.h b/scripts/kconfig/expr.h
index fe2231e0e6a4..5f900d18dae0 100644
--- a/scripts/kconfig/expr.h
+++ b/scripts/kconfig/expr.h
@@ -145,6 +145,7 @@ struct symbol {
 #define SYMBOL_CONST      0x0001  /* symbol is const */
 #define SYMBOL_CHECK      0x0008  /* used during dependency checking */
 #define SYMBOL_VALID      0x0080  /* set when symbol.curr is calculated */
+#define SYMBOL_TRANS      0x0100  /* symbol is transitional only (not visible)*/
 #define SYMBOL_WRITE      0x0200  /* write symbol to file (KCONFIG_CONFIG) */
 #define SYMBOL_WRITTEN    0x0800  /* track info to avoid double-write to .config */
 #define SYMBOL_CHECKED    0x2000  /* used during dependency checking */
diff --git a/scripts/kconfig/lexer.l b/scripts/kconfig/lexer.l
index 9c2cdfc33c6f..6d2c92c6095d 100644
--- a/scripts/kconfig/lexer.l
+++ b/scripts/kconfig/lexer.l
@@ -126,6 +126,7 @@ n	[A-Za-z0-9_-]
 "select"		return T_SELECT;
 "source"		return T_SOURCE;
 "string"		return T_STRING;
+"transitional"		return T_TRANSITIONAL;
 "tristate"		return T_TRISTATE;
 "visible"		return T_VISIBLE;
 "||"			return T_OR;
diff --git a/scripts/kconfig/parser.y b/scripts/kconfig/parser.y
index e9c3c664e925..49b79dde1725 100644
--- a/scripts/kconfig/parser.y
+++ b/scripts/kconfig/parser.y
@@ -75,6 +75,7 @@ struct menu *current_menu, *current_entry, *current_choice;
 %token T_SELECT
 %token T_SOURCE
 %token T_STRING
+%token T_TRANSITIONAL
 %token T_TRISTATE
 %token T_VISIBLE
 %token T_EOL
@@ -205,6 +206,12 @@ config_option: T_PROMPT T_WORD_QUOTE if_expr T_EOL
 	printd(DEBUG_PARSE, "%s:%d:prompt\n", cur_filename, cur_lineno);
 };
 
+config_option: T_TRANSITIONAL T_EOL
+{
+	current_entry->sym->flags |= SYMBOL_TRANS;
+	printd(DEBUG_PARSE, "%s:%d:transitional\n", cur_filename, cur_lineno);
+};
+
 config_option: default expr if_expr T_EOL
 {
 	menu_add_expr(P_DEFAULT, $2, $3);
@@ -482,6 +489,43 @@ assign_val:
 
 %%
 
+/**
+ * transitional_check_sanity - check transitional symbols have no other
+ *			       properties
+ *
+ * @menu: menu of the potentially transitional symbol
+ *
+ * Return: -1 if an error is found, 0 otherwise.
+ */
+static int transitional_check_sanity(const struct menu *menu)
+{
+	struct property *prop;
+
+	if (!menu->sym || !(menu->sym->flags & SYMBOL_TRANS))
+		return 0;
+
+	/* Check for depends and visible conditions. */
+	if ((menu->dep && !expr_is_yes(menu->dep)) ||
+	    (menu->visibility && !expr_is_yes(menu->visibility))) {
+		fprintf(stderr, "%s:%d: error: %s",
+			menu->filename, menu->lineno,
+			"transitional symbols can only have help sections\n");
+		return -1;
+	}
+
+	/* Check for any property other than "help". */
+	for (prop = menu->sym->prop; prop; prop = prop->next) {
+		if (prop->type != P_COMMENT) {
+			fprintf(stderr, "%s:%d: error: %s",
+				prop->filename, prop->lineno,
+				"transitional symbols can only have help sections\n");
+			return -1;
+		}
+	}
+
+	return 0;
+}
+
 /**
  * choice_check_sanity - check sanity of a choice member
  *
@@ -558,6 +602,9 @@ void conf_parse(const char *name)
 		if (menu->sym && sym_check_deps(menu->sym))
 			yynerrs++;
 
+		if (transitional_check_sanity(menu))
+			yynerrs++;
+
 		if (menu->sym && sym_is_choice(menu->sym)) {
 			menu_for_each_sub_entry(child, menu)
 				if (child->sym && choice_check_sanity(child))
diff --git a/scripts/kconfig/symbol.c b/scripts/kconfig/symbol.c
index 26ab10c0fd76..760cac998381 100644
--- a/scripts/kconfig/symbol.c
+++ b/scripts/kconfig/symbol.c
@@ -214,6 +214,11 @@ static void sym_calc_visibility(struct symbol *sym)
 	struct property *prop;
 	tristate tri;
 
+	if (sym->flags & SYMBOL_TRANS) {
+		sym->visible = yes;
+		return;
+	}
+
 	/* any prompt visible? */
 	tri = no;
 	for_all_prompts(sym, prop) {
@@ -526,7 +531,7 @@ void sym_calc_value(struct symbol *sym)
 		}
 	}
 
-	if (sym_is_choice(sym))
+	if (sym_is_choice(sym) || sym->flags & SYMBOL_TRANS)
 		sym->flags &= ~SYMBOL_WRITE;
 }
 
diff --git a/scripts/kconfig/tests/conftest.py b/scripts/kconfig/tests/conftest.py
index 2a2a7e2da060..d94b79e012c0 100644
--- a/scripts/kconfig/tests/conftest.py
+++ b/scripts/kconfig/tests/conftest.py
@@ -81,7 +81,22 @@ class Conf:
                 # For interactive modes such as oldaskconfig, oldconfig,
                 # send 'Enter' key until the program finishes.
                 if interactive:
-                    ps.stdin.write(b'\n')
+                    try:
+                        ps.stdin.write(b'\n')
+                        ps.stdin.flush()
+                    except (BrokenPipeError, OSError):
+                        # Process has exited, stop sending input
+                        break
+
+            # Close stdin gracefully
+            try:
+                ps.stdin.close()
+            except (BrokenPipeError, OSError):
+                # Ignore broken pipe on close
+                pass
+
+            # Wait for process to complete
+            ps.wait()
 
             self.retcode = ps.returncode
             self.stdout = ps.stdout.read().decode()
diff --git a/scripts/kconfig/tests/err_transitional/Kconfig b/scripts/kconfig/tests/err_transitional/Kconfig
new file mode 100644
index 000000000000..a75ed3b2fe5e
--- /dev/null
+++ b/scripts/kconfig/tests/err_transitional/Kconfig
@@ -0,0 +1,52 @@
+# SPDX-License-Identifier: GPL-2.0
+# Test that transitional symbols cannot have properties other than help
+
+config BAD_DEFAULT
+	bool
+	transitional
+	default y
+	help
+	  This transitional symbol illegally has a default property.
+
+config BAD_PROMPT
+	bool
+	transitional
+	prompt "Bad prompt"
+	help
+	  This transitional symbol illegally has a prompt.
+
+config BAD_SELECT
+	bool
+	transitional
+	select OTHER_SYMBOL
+	help
+	  This transitional symbol illegally has a select.
+
+config BAD_IMPLY
+	bool
+	transitional
+	imply OTHER_SYMBOL
+	help
+	  This transitional symbol illegally has an imply.
+
+config BAD_DEPENDS
+	bool
+	transitional
+	depends on OTHER_SYMBOL
+	help
+	  This transitional symbol illegally has a depends.
+
+config BAD_RANGE
+	int
+	transitional
+	range 1 10
+	help
+	  This transitional symbol illegally has a range.
+
+config BAD_NO_TYPE
+	transitional
+	help
+	  This transitional symbol illegally has no type specified.
+
+config OTHER_SYMBOL
+	bool
diff --git a/scripts/kconfig/tests/err_transitional/__init__.py b/scripts/kconfig/tests/err_transitional/__init__.py
new file mode 100644
index 000000000000..7dffb5b0833f
--- /dev/null
+++ b/scripts/kconfig/tests/err_transitional/__init__.py
@@ -0,0 +1,14 @@
+# SPDX-License-Identifier: GPL-2.0
+"""
+Test that transitional symbols with invalid properties are rejected.
+
+Transitional symbols can only have help sections. Any other properties
+(default, select, depends, etc.) should cause a parser error.
+"""
+
+def test(conf):
+    # This should fail with exit code 1 due to invalid transitional symbol
+    assert conf.olddefconfig() == 1
+
+    # Check that the error message is about transitional symbols
+    assert conf.stderr_contains('expected_stderr')
diff --git a/scripts/kconfig/tests/err_transitional/expected_stderr b/scripts/kconfig/tests/err_transitional/expected_stderr
new file mode 100644
index 000000000000..b52db4f680f4
--- /dev/null
+++ b/scripts/kconfig/tests/err_transitional/expected_stderr
@@ -0,0 +1,7 @@
+Kconfig:46:warning: config symbol defined without type
+Kconfig:7: error: transitional symbols can only have help sections
+Kconfig:14: error: transitional symbols can only have help sections
+Kconfig:21: error: transitional symbols can only have help sections
+Kconfig:28: error: transitional symbols can only have help sections
+Kconfig:32: error: transitional symbols can only have help sections
+Kconfig:42: error: transitional symbols can only have help sections
diff --git a/scripts/kconfig/tests/transitional/Kconfig b/scripts/kconfig/tests/transitional/Kconfig
new file mode 100644
index 000000000000..62c3b24665b9
--- /dev/null
+++ b/scripts/kconfig/tests/transitional/Kconfig
@@ -0,0 +1,100 @@
+# SPDX-License-Identifier: GPL-2.0
+# Test transitional symbols for config migration with all Kconfig types
+
+# Enable module support for tristate testing
+config MODULES
+	bool "Enable loadable module support"
+	modules
+	default y
+
+# Basic migration tests for all types
+config NEW_BOOL
+	bool "New bool option"
+	default OLD_BOOL
+
+config OLD_BOOL
+	bool
+	transitional
+
+config NEW_TRISTATE
+	tristate "New tristate option"
+	default OLD_TRISTATE
+
+config OLD_TRISTATE
+	tristate
+	transitional
+
+config NEW_STRING
+	string "New string option"
+	default OLD_STRING
+
+config OLD_STRING
+	string
+	transitional
+
+config NEW_HEX
+	hex "New hex option"
+	default OLD_HEX
+
+config OLD_HEX
+	hex
+	transitional
+
+config NEW_INT
+	int "New int option"
+	default OLD_INT
+
+config OLD_INT
+	int
+	transitional
+
+# Precedence tests for all types
+config NEW_BOOL_PRECEDENCE
+	bool "New bool option with precedence"
+	default OLD_BOOL_PRECEDENCE
+
+config OLD_BOOL_PRECEDENCE
+	bool
+	transitional
+
+config NEW_STRING_PRECEDENCE
+	string "New string option with precedence"
+	default OLD_STRING_PRECEDENCE
+
+config OLD_STRING_PRECEDENCE
+	string
+	transitional
+
+config NEW_TRISTATE_PRECEDENCE
+	tristate "New tristate option with precedence"
+	default OLD_TRISTATE_PRECEDENCE
+
+config OLD_TRISTATE_PRECEDENCE
+	tristate
+	transitional
+
+config NEW_HEX_PRECEDENCE
+	hex "New hex option with precedence"
+	default OLD_HEX_PRECEDENCE
+
+config OLD_HEX_PRECEDENCE
+	hex
+	transitional
+
+config NEW_INT_PRECEDENCE
+	int "New int option with precedence"
+	default OLD_INT_PRECEDENCE
+
+config OLD_INT_PRECEDENCE
+	int
+	transitional
+
+# Test that help sections are allowed for transitional symbols
+config OLD_WITH_HELP
+	bool
+	transitional
+	help
+	  This transitional symbol has a help section to validate that help is allowed.
+
+config REGULAR_OPTION
+	bool "Regular option"
diff --git a/scripts/kconfig/tests/transitional/__init__.py b/scripts/kconfig/tests/transitional/__init__.py
new file mode 100644
index 000000000000..61937d10edf1
--- /dev/null
+++ b/scripts/kconfig/tests/transitional/__init__.py
@@ -0,0 +1,18 @@
+# SPDX-License-Identifier: GPL-2.0
+"""
+Test transitional symbol migration functionality for all Kconfig types.
+
+This tests that:
+- OLD_* options in existing .config cause NEW_* options to be set
+- OLD_* options are not written to the new .config file
+- NEW_* options appear in the new .config file with correct values
+- All Kconfig types work correctly: bool, tristate, string, hex, int
+- User-set NEW values take precedence over conflicting OLD transitional values
+"""
+
+def test(conf):
+    # Run olddefconfig to process the migration with the initial config
+    assert conf.olddefconfig(dot_config='initial_config') == 0
+
+    # Check that the configuration matches expected output
+    assert conf.config_contains('expected_config')
diff --git a/scripts/kconfig/tests/transitional/expected_config b/scripts/kconfig/tests/transitional/expected_config
new file mode 100644
index 000000000000..846e9ddcab91
--- /dev/null
+++ b/scripts/kconfig/tests/transitional/expected_config
@@ -0,0 +1,12 @@
+CONFIG_MODULES=y
+CONFIG_NEW_BOOL=y
+CONFIG_NEW_TRISTATE=m
+CONFIG_NEW_STRING="test string"
+CONFIG_NEW_HEX=0x1234
+CONFIG_NEW_INT=42
+# CONFIG_NEW_BOOL_PRECEDENCE is not set
+CONFIG_NEW_STRING_PRECEDENCE="user value"
+CONFIG_NEW_TRISTATE_PRECEDENCE=y
+CONFIG_NEW_HEX_PRECEDENCE=0xABCD
+CONFIG_NEW_INT_PRECEDENCE=100
+# CONFIG_REGULAR_OPTION is not set
diff --git a/scripts/kconfig/tests/transitional/initial_config b/scripts/kconfig/tests/transitional/initial_config
new file mode 100644
index 000000000000..e648a65e504c
--- /dev/null
+++ b/scripts/kconfig/tests/transitional/initial_config
@@ -0,0 +1,16 @@
+CONFIG_MODULES=y
+CONFIG_OLD_BOOL=y
+CONFIG_OLD_TRISTATE=m
+CONFIG_OLD_STRING="test string"
+CONFIG_OLD_HEX=0x1234
+CONFIG_OLD_INT=42
+# CONFIG_NEW_BOOL_PRECEDENCE is not set
+CONFIG_OLD_BOOL_PRECEDENCE=y
+CONFIG_NEW_STRING_PRECEDENCE="user value"
+CONFIG_OLD_STRING_PRECEDENCE="old value"
+CONFIG_NEW_TRISTATE_PRECEDENCE=y
+CONFIG_OLD_TRISTATE_PRECEDENCE=m
+CONFIG_NEW_HEX_PRECEDENCE=0xABCD
+CONFIG_OLD_HEX_PRECEDENCE=0x5678
+CONFIG_NEW_INT_PRECEDENCE=100
+CONFIG_OLD_INT_PRECEDENCE=200
diff --git a/scripts/rustdoc_test_gen.rs b/scripts/rustdoc_test_gen.rs
index abb34ada2508..c8f9dc2ab976 100644
--- a/scripts/rustdoc_test_gen.rs
+++ b/scripts/rustdoc_test_gen.rs
@@ -202,7 +202,7 @@ macro_rules! assert_eq {{
     // This follows the syntax for declaring test metadata in the proposed KTAP v2 spec, which may
     // be used for the proposed KUnit test attributes API. Thus hopefully this will make migration
     // easier later on.
-    ::kernel::kunit::info(format_args!("    # {kunit_name}.location: {real_path}:{line}\n"));
+    ::kernel::kunit::info(fmt!("    # {kunit_name}.location: {real_path}:{line}\n"));
 
     /// The anchor where the test code body starts.
     #[allow(unused)]
diff --git a/security/Kconfig.hardening b/security/Kconfig.hardening
index b9a5bc3430aa..86f8768c63d4 100644
--- a/security/Kconfig.hardening
+++ b/security/Kconfig.hardening
@@ -255,6 +255,16 @@ config LIST_HARDENED
 
 	  If unsure, say N.
 
+config RUST_BITMAP_HARDENED
+	bool "Check integrity of bitmap Rust API"
+	depends on RUST
+	help
+	  Enables additional assertions in the Rust Bitmap API to catch
+	  arguments that are not guaranteed to result in an immediate access
+	  fault.
+
+	  If unsure, say N.
+
 config BUG_ON_DATA_CORRUPTION
 	bool "Trigger a BUG when data corruption is detected"
 	select LIST_HARDENED
diff --git a/security/landlock/errata/abi-1.h b/security/landlock/errata/abi-1.h
new file mode 100644
index 000000000000..6edc7182800f
--- /dev/null
+++ b/security/landlock/errata/abi-1.h
@@ -0,0 +1,16 @@
+/* SPDX-License-Identifier: GPL-2.0-only */
+
+/**
+ * DOC: erratum_3
+ *
+ * Erratum 3: Disconnected directory handling
+ * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ *
+ * This fix addresses an issue with disconnected directories that occur when a
+ * directory is moved outside the scope of a bind mount.  The change ensures
+ * that evaluated access rights exclude those inherited from disconnected file
+ * hierarchies (no longer accessible from the related mount point), and instead
+ * only consider rights tied to directories that remain visible.  This prevents
+ * access inconsistencies caused by missing access rights.
+ */
+LANDLOCK_ERRATUM(3)
diff --git a/security/landlock/fs.c b/security/landlock/fs.c
index 0bade2c5aa1d..4ed997f4a663 100644
--- a/security/landlock/fs.c
+++ b/security/landlock/fs.c
@@ -714,7 +714,8 @@ static void test_is_eacces_with_write(struct kunit *const test)
  * is_access_to_paths_allowed - Check accesses for requests with a common path
  *
  * @domain: Domain to check against.
- * @path: File hierarchy to walk through.
+ * @path: File hierarchy to walk through.  For refer checks, this would be
+ *     the common mountpoint.
  * @access_request_parent1: Accesses to check, once @layer_masks_parent1 is
  *     equal to @layer_masks_parent2 (if any).  This is tied to the unique
  *     requested path for most actions, or the source in case of a refer action
@@ -764,11 +765,14 @@ static bool is_access_to_paths_allowed(
 	struct dentry *const dentry_child2)
 {
 	bool allowed_parent1 = false, allowed_parent2 = false, is_dom_check,
-	     child1_is_directory = true, child2_is_directory = true;
+	     is_dom_check_bkp, child1_is_directory = true,
+	     child2_is_directory = true;
 	struct path walker_path;
 	access_mask_t access_masked_parent1, access_masked_parent2;
 	layer_mask_t _layer_masks_child1[LANDLOCK_NUM_ACCESS_FS],
-		_layer_masks_child2[LANDLOCK_NUM_ACCESS_FS];
+		_layer_masks_child2[LANDLOCK_NUM_ACCESS_FS],
+		_layer_masks_parent1_bkp[LANDLOCK_NUM_ACCESS_FS],
+		_layer_masks_parent2_bkp[LANDLOCK_NUM_ACCESS_FS];
 	layer_mask_t(*layer_masks_child1)[LANDLOCK_NUM_ACCESS_FS] = NULL,
 	(*layer_masks_child2)[LANDLOCK_NUM_ACCESS_FS] = NULL;
 
@@ -784,12 +788,18 @@ static bool is_access_to_paths_allowed(
 	if (WARN_ON_ONCE(!layer_masks_parent1))
 		return false;
 
-	allowed_parent1 = is_layer_masks_allowed(layer_masks_parent1);
-
 	if (unlikely(layer_masks_parent2)) {
 		if (WARN_ON_ONCE(!dentry_child1))
 			return false;
 
+		/*
+		 * Creates a backup of the initial layer masks to be able to restore
+		 * them if we find out that we were walking a disconnected directory,
+		 * which would make the collected access rights inconsistent (cf.
+		 * reset_to_mount_root).
+		 */
+		memcpy(&_layer_masks_parent2_bkp, layer_masks_parent2,
+		       sizeof(_layer_masks_parent2_bkp));
 		allowed_parent2 = is_layer_masks_allowed(layer_masks_parent2);
 
 		/*
@@ -809,6 +819,16 @@ static bool is_access_to_paths_allowed(
 		is_dom_check = false;
 	}
 
+	/*
+	 * Creates a backup of the initial layer masks to be able to restore them if
+	 * we find out that we were walking a disconnected directory, which would
+	 * make the collected access rights inconsistent (cf. reset_to_mount_root).
+	 */
+	memcpy(&_layer_masks_parent1_bkp, layer_masks_parent1,
+	       sizeof(_layer_masks_parent1_bkp));
+	allowed_parent1 = is_layer_masks_allowed(layer_masks_parent1);
+	is_dom_check_bkp = is_dom_check;
+
 	if (unlikely(dentry_child1)) {
 		landlock_unmask_layers(
 			find_rule(domain, dentry_child1),
@@ -874,13 +894,13 @@ static bool is_access_to_paths_allowed(
 				allowed_parent2 ||
 				scope_to_request(access_masked_parent2,
 						 layer_masks_parent2);
-
-			/* Stops when all accesses are granted. */
-			if (allowed_parent1 && allowed_parent2)
-				break;
 		}
 
-		rule = find_rule(domain, walker_path.dentry);
+		/* Looks for a rule when needed. */
+		rule = unlikely(allowed_parent1 && allowed_parent2) ?
+			       NULL :
+			       find_rule(domain, walker_path.dentry);
+
 		allowed_parent1 = allowed_parent1 ||
 				  landlock_unmask_layers(
 					  rule, access_masked_parent1,
@@ -893,12 +913,47 @@ static bool is_access_to_paths_allowed(
 					  ARRAY_SIZE(*layer_masks_parent2));
 
 		/* Stops when a rule from each layer grants access. */
-		if (allowed_parent1 && allowed_parent2)
+		if (allowed_parent1 && allowed_parent2) {
+			/*
+			 * Before allowing the access request, checks that the walk was not
+			 * in a disconnected directory.
+			 */
+			if (unlikely(!path_connected(walker_path.mnt,
+						     walker_path.dentry)))
+				goto reset_to_mount_root;
+
 			break;
+		}
 
 jump_up:
 		if (walker_path.dentry == walker_path.mnt->mnt_root) {
+			/*
+			 * We reached a mount point which is not a disconnected directory.
+			 * We can now safely assume that the collected access rights are
+			 * valid, and we can save them to be able to get back to this state
+			 * later on.  If we reached the real root, the walk will end, and we
+			 * will not need to restore anything, so we only need to save the
+			 * collected access rights if we are not at the real root.
+			 */
 			if (follow_up(&walker_path)) {
+				/*
+				 * The mount point before this follow_up() call was connected.
+				 * We will know during the ongoing walk if the path from this
+				 * new mount point (i.e. walker_path) is disconnected.  If it is
+				 * the case, we will restore the collected access rights from
+				 * here and jump to walker_path.mnt->mnt_root, short-circuiting
+				 * the disconnected hierarchy (cf. reset_to_mount_root).
+				 */
+				memcpy(&_layer_masks_parent1_bkp,
+				       layer_masks_parent1,
+				       sizeof(_layer_masks_parent1_bkp));
+				if (layer_masks_parent2) {
+					memcpy(&_layer_masks_parent2_bkp,
+					       layer_masks_parent2,
+					       sizeof(_layer_masks_parent2_bkp));
+					is_dom_check_bkp = is_dom_check;
+				}
+
 				/* Ignores hidden mount points. */
 				goto jump_up;
 			} else {
@@ -910,20 +965,69 @@ static bool is_access_to_paths_allowed(
 			}
 		}
 		if (unlikely(IS_ROOT(walker_path.dentry))) {
-			/*
-			 * Stops at disconnected root directories.  Only allows
-			 * access to internal filesystems (e.g. nsfs, which is
-			 * reachable through /proc/<pid>/ns/<namespace>).
-			 */
-			if (walker_path.mnt->mnt_flags & MNT_INTERNAL) {
+			if (likely(walker_path.mnt->mnt_flags & MNT_INTERNAL)) {
+				/*
+				 * Stops and allows access when reaching disconnected root
+				 * directories that are part of internal filesystems (e.g. nsfs,
+				 * which is reachable through /proc/<pid>/ns/<namespace>).
+				 */
 				allowed_parent1 = true;
 				allowed_parent2 = true;
+				break;
 			}
-			break;
+
+			/*
+			 * We reached a disconnected root directory from a bind mount, and
+			 * we need to reset the walk to the current mount root.
+			 */
+			goto reset_to_mount_root;
 		}
 		parent_dentry = dget_parent(walker_path.dentry);
 		dput(walker_path.dentry);
 		walker_path.dentry = parent_dentry;
+		continue;
+
+reset_to_mount_root:
+		/*
+		 * At this point, we know that the walk was in a disconnected file
+		 * hierarchy and we need to restore the layer masks from the last known
+		 * good values.  These were either built from the domain (at the
+		 * beginning of the walk) or from the collected access rights up to the
+		 * previous connected mount point.  This ensures we don't use
+		 * potentially invalid access rights from the disconnected path
+		 * traversal.
+		 */
+		memcpy(layer_masks_parent1, &_layer_masks_parent1_bkp,
+		       sizeof(_layer_masks_parent1_bkp));
+		allowed_parent1 =
+			is_layer_masks_allowed(&_layer_masks_parent1_bkp);
+		if (layer_masks_parent2) {
+			memcpy(layer_masks_parent2, &_layer_masks_parent2_bkp,
+			       sizeof(_layer_masks_parent2_bkp));
+			allowed_parent2 = is_layer_masks_allowed(
+				&_layer_masks_parent2_bkp);
+
+			/*
+			 * Restores domain check mode if needed: increases back the scope of
+			 * the access checks to the domain's handled accesses, which are a
+			 * superset of the requested ones.
+			 */
+			if (is_dom_check_bkp) {
+				access_masked_parent1 = access_masked_parent2 =
+					landlock_union_access_masks(domain).fs;
+				is_dom_check = true;
+			}
+		}
+
+		/*
+		 * Jumps to the root of the current mount point to short-circuit the
+		 * disconnected walk with a reachable directory.  This ensures we
+		 * continue the access check from a known good location in the
+		 * filesystem hierarchy.
+		 */
+		dput(walker_path.dentry);
+		walker_path.dentry = walker_path.mnt->mnt_root;
+		dget(walker_path.dentry);
 	}
 	path_put(&walker_path);
 
@@ -1011,15 +1115,18 @@ static access_mask_t maybe_remove(const struct dentry *const dentry)
  * collect_domain_accesses - Walk through a file path and collect accesses
  *
  * @domain: Domain to check against.
- * @mnt_root: Last directory to check.
+ * @mnt_dir: Mount point directory to stop the walk at.
  * @dir: Directory to start the walk from.
  * @layer_masks_dom: Where to store the collected accesses.
  *
- * This helper is useful to begin a path walk from the @dir directory to a
- * @mnt_root directory used as a mount point.  This mount point is the common
- * ancestor between the source and the destination of a renamed and linked
- * file.  While walking from @dir to @mnt_root, we record all the domain's
- * allowed accesses in @layer_masks_dom.
+ * This helper is useful to begin a path walk from the @dir directory to
+ * @mnt_dir.  This mount point is the common ancestor between the source and the
+ * destination of a renamed and linked file.  While walking from @dir to
+ * @mnt_dir, we record all the domain's allowed accesses in @layer_masks_dom.
+ *
+ * Because of disconnected directories, this walk may not reach @mnt_dir.  In
+ * this case, the walk is canceled and the collected accesses are reset to the
+ * domain handled ones.
  *
  * This is similar to is_access_to_paths_allowed() but much simpler because it
  * only handles walking on the same mount point and only checks one set of
@@ -1031,13 +1138,13 @@ static access_mask_t maybe_remove(const struct dentry *const dentry)
  */
 static bool collect_domain_accesses(
 	const struct landlock_ruleset *const domain,
-	const struct dentry *const mnt_root, struct dentry *dir,
+	const struct path *const mnt_dir, struct dentry *dir,
 	layer_mask_t (*const layer_masks_dom)[LANDLOCK_NUM_ACCESS_FS])
 {
-	unsigned long access_dom;
+	access_mask_t access_dom;
 	bool ret = false;
 
-	if (WARN_ON_ONCE(!domain || !mnt_root || !dir || !layer_masks_dom))
+	if (WARN_ON_ONCE(!domain || !mnt_dir || !dir || !layer_masks_dom))
 		return true;
 	if (is_nouser_or_private(dir))
 		return true;
@@ -1054,6 +1161,13 @@ static bool collect_domain_accesses(
 		if (landlock_unmask_layers(find_rule(domain, dir), access_dom,
 					   layer_masks_dom,
 					   ARRAY_SIZE(*layer_masks_dom))) {
+			/*
+			 * Before allowing this side of the access request, checks that the
+			 * walk was not in a disconnected directory.
+			 */
+			if (unlikely(!path_connected(mnt_dir->mnt, dir)))
+				goto cancel_walk;
+
 			/*
 			 * Stops when all handled accesses are allowed by at
 			 * least one rule in each layer.
@@ -1062,13 +1176,27 @@ static bool collect_domain_accesses(
 			break;
 		}
 
-		/* We should not reach a root other than @mnt_root. */
-		if (dir == mnt_root || WARN_ON_ONCE(IS_ROOT(dir)))
+		/* Stops at the mount point. */
+		if (dir == mnt_dir->dentry)
 			break;
 
+		/* Ignores the walk if we end up in a disconnected root directory. */
+		if (unlikely(IS_ROOT(dir)))
+			goto cancel_walk;
+
 		parent_dentry = dget_parent(dir);
 		dput(dir);
 		dir = parent_dentry;
+		continue;
+
+cancel_walk:
+		/*
+		 * Resets the inconsistent collected access rights to the domain's
+		 * handled access rights since we encountered a disconnected directory.
+		 */
+		landlock_init_layer_masks(domain, LANDLOCK_MASK_ACCESS_FS,
+					  layer_masks_dom, LANDLOCK_KEY_INODE);
+		break;
 	}
 	dput(dir);
 	return ret;
@@ -1199,13 +1327,11 @@ static int current_check_refer_path(struct dentry *const old_dentry,
 						      old_dentry->d_parent;
 
 	/* new_dir->dentry is equal to new_dentry->d_parent */
-	allow_parent1 = collect_domain_accesses(subject->domain, mnt_dir.dentry,
-						old_parent,
-						&layer_masks_parent1);
-	allow_parent2 = collect_domain_accesses(subject->domain, mnt_dir.dentry,
+	allow_parent1 = collect_domain_accesses(
+		subject->domain, &mnt_dir, old_parent, &layer_masks_parent1);
+	allow_parent2 = collect_domain_accesses(subject->domain, &mnt_dir,
 						new_dir->dentry,
 						&layer_masks_parent2);
-
 	if (allow_parent1 && allow_parent2)
 		return 0;
 
diff --git a/security/landlock/ruleset.c b/security/landlock/ruleset.c
index ce7940efea51..dfcdc19ea268 100644
--- a/security/landlock/ruleset.c
+++ b/security/landlock/ruleset.c
@@ -83,6 +83,10 @@ static void build_check_rule(void)
 		.num_layers = ~0,
 	};
 
+	/*
+	 * Checks that .num_layers is large enough for at least
+	 * LANDLOCK_MAX_NUM_LAYERS layers.
+	 */
 	BUILD_BUG_ON(rule.num_layers < LANDLOCK_MAX_NUM_LAYERS);
 }
 
@@ -290,6 +294,10 @@ static void build_check_layer(void)
 		.access = ~0,
 	};
 
+	/*
+	 * Checks that .level and .access are large enough to contain their expected
+	 * maximum values.
+	 */
 	BUILD_BUG_ON(layer.level < LANDLOCK_MAX_NUM_LAYERS);
 	BUILD_BUG_ON(layer.access < LANDLOCK_MASK_ACCESS_FS);
 }
@@ -644,8 +652,8 @@ bool landlock_unmask_layers(const struct landlock_rule *const rule,
 		bool is_empty;
 
 		/*
-		 * Records in @layer_masks which layer grants access to each
-		 * requested access.
+		 * Records in @layer_masks which layer grants access to each requested
+		 * access: bit cleared if the related layer grants access.
 		 */
 		is_empty = true;
 		for_each_set_bit(access_bit, &access_req, masks_array_size) {
diff --git a/security/landlock/ruleset.h b/security/landlock/ruleset.h
index 5da9a64f5af7..1a78cba662b2 100644
--- a/security/landlock/ruleset.h
+++ b/security/landlock/ruleset.h
@@ -27,7 +27,7 @@ struct landlock_hierarchy;
  */
 struct landlock_layer {
 	/**
-	 * @level: Position of this layer in the layer stack.
+	 * @level: Position of this layer in the layer stack.  Starts from 1.
 	 */
 	u16 level;
 	/**
diff --git a/sound/soc/rockchip/rockchip_i2s_tdm.h b/sound/soc/rockchip/rockchip_i2s_tdm.h
index 0aa1c6da1e2c..0171e05ee886 100644
--- a/sound/soc/rockchip/rockchip_i2s_tdm.h
+++ b/sound/soc/rockchip/rockchip_i2s_tdm.h
@@ -10,6 +10,8 @@
 #ifndef _ROCKCHIP_I2S_TDM_H
 #define _ROCKCHIP_I2S_TDM_H
 
+#include <linux/hw_bitfield.h>
+
 /*
  * TXCR
  * transmit operation control register
@@ -285,7 +287,7 @@ enum {
 #define I2S_TDM_RXCR	(0x0034)
 #define I2S_CLKDIV	(0x0038)
 
-#define HIWORD_UPDATE(v, h, l)	(((v) << (l)) | (GENMASK((h), (l)) << 16))
+#define HIWORD_UPDATE(v, h, l)	(FIELD_PREP_WM16_CONST(GENMASK((h), (l)), (v)))
 
 /* PX30 GRF CONFIGS */
 #define PX30_I2S0_CLK_IN_SRC_FROM_TX		HIWORD_UPDATE(1, 13, 12)
diff --git a/tools/include/linux/cfi_types.h b/tools/include/linux/cfi_types.h
index 685f7181780f..fb8d90bff92e 100644
--- a/tools/include/linux/cfi_types.h
+++ b/tools/include/linux/cfi_types.h
@@ -8,7 +8,7 @@
 #ifdef __ASSEMBLY__
 #include <linux/linkage.h>
 
-#ifdef CONFIG_CFI_CLANG
+#ifdef CONFIG_CFI
 /*
  * Use the __kcfi_typeid_<function> type identifier symbol to
  * annotate indirectly called assembly functions. The compiler emits
@@ -29,12 +29,12 @@
 #define SYM_TYPED_START(name, linkage, align...)	\
 	SYM_TYPED_ENTRY(name, linkage, align)
 
-#else /* CONFIG_CFI_CLANG */
+#else /* CONFIG_CFI */
 
 #define SYM_TYPED_START(name, linkage, align...)	\
 	SYM_START(name, linkage, align)
 
-#endif /* CONFIG_CFI_CLANG */
+#endif /* CONFIG_CFI */
 
 #ifndef SYM_TYPED_FUNC_START
 #define SYM_TYPED_FUNC_START(name) 			\
diff --git a/tools/include/linux/slab.h b/tools/include/linux/slab.h
index c87051e2b26f..94937a699402 100644
--- a/tools/include/linux/slab.h
+++ b/tools/include/linux/slab.h
@@ -4,11 +4,31 @@
 
 #include <linux/types.h>
 #include <linux/gfp.h>
+#include <pthread.h>
 
-#define SLAB_PANIC 2
 #define SLAB_RECLAIM_ACCOUNT    0x00020000UL            /* Objects are reclaimable */
 
 #define kzalloc_node(size, flags, node) kmalloc(size, flags)
+enum _slab_flag_bits {
+	_SLAB_KMALLOC,
+	_SLAB_HWCACHE_ALIGN,
+	_SLAB_PANIC,
+	_SLAB_TYPESAFE_BY_RCU,
+	_SLAB_ACCOUNT,
+	_SLAB_FLAGS_LAST_BIT
+};
+
+#define __SLAB_FLAG_BIT(nr)	((unsigned int __force)(1U << (nr)))
+#define __SLAB_FLAG_UNUSED	((unsigned int __force)(0U))
+
+#define SLAB_HWCACHE_ALIGN	__SLAB_FLAG_BIT(_SLAB_HWCACHE_ALIGN)
+#define SLAB_PANIC		__SLAB_FLAG_BIT(_SLAB_PANIC)
+#define SLAB_TYPESAFE_BY_RCU	__SLAB_FLAG_BIT(_SLAB_TYPESAFE_BY_RCU)
+#ifdef CONFIG_MEMCG
+# define SLAB_ACCOUNT		__SLAB_FLAG_BIT(_SLAB_ACCOUNT)
+#else
+# define SLAB_ACCOUNT		__SLAB_FLAG_UNUSED
+#endif
 
 void *kmalloc(size_t size, gfp_t gfp);
 void kfree(void *p);
@@ -23,6 +43,98 @@ enum slab_state {
 	FULL
 };
 
+struct kmem_cache {
+	pthread_mutex_t lock;
+	unsigned int size;
+	unsigned int align;
+	unsigned int sheaf_capacity;
+	int nr_objs;
+	void *objs;
+	void (*ctor)(void *);
+	bool non_kernel_enabled;
+	unsigned int non_kernel;
+	unsigned long nr_allocated;
+	unsigned long nr_tallocated;
+	bool exec_callback;
+	void (*callback)(void *);
+	void *private;
+};
+
+struct kmem_cache_args {
+	/**
+	 * @align: The required alignment for the objects.
+	 *
+	 * %0 means no specific alignment is requested.
+	 */
+	unsigned int align;
+	/**
+	 * @sheaf_capacity: The maximum size of the sheaf.
+	 */
+	unsigned int sheaf_capacity;
+	/**
+	 * @useroffset: Usercopy region offset.
+	 *
+	 * %0 is a valid offset, when @usersize is non-%0
+	 */
+	unsigned int useroffset;
+	/**
+	 * @usersize: Usercopy region size.
+	 *
+	 * %0 means no usercopy region is specified.
+	 */
+	unsigned int usersize;
+	/**
+	 * @freeptr_offset: Custom offset for the free pointer
+	 * in &SLAB_TYPESAFE_BY_RCU caches
+	 *
+	 * By default &SLAB_TYPESAFE_BY_RCU caches place the free pointer
+	 * outside of the object. This might cause the object to grow in size.
+	 * Cache creators that have a reason to avoid this can specify a custom
+	 * free pointer offset in their struct where the free pointer will be
+	 * placed.
+	 *
+	 * Note that placing the free pointer inside the object requires the
+	 * caller to ensure that no fields are invalidated that are required to
+	 * guard against object recycling (See &SLAB_TYPESAFE_BY_RCU for
+	 * details).
+	 *
+	 * Using %0 as a value for @freeptr_offset is valid. If @freeptr_offset
+	 * is specified, %use_freeptr_offset must be set %true.
+	 *
+	 * Note that @ctor currently isn't supported with custom free pointers
+	 * as a @ctor requires an external free pointer.
+	 */
+	unsigned int freeptr_offset;
+	/**
+	 * @use_freeptr_offset: Whether a @freeptr_offset is used.
+	 */
+	bool use_freeptr_offset;
+	/**
+	 * @ctor: A constructor for the objects.
+	 *
+	 * The constructor is invoked for each object in a newly allocated slab
+	 * page. It is the cache user's responsibility to free object in the
+	 * same state as after calling the constructor, or deal appropriately
+	 * with any differences between a freshly constructed and a reallocated
+	 * object.
+	 *
+	 * %NULL means no constructor.
+	 */
+	void (*ctor)(void *);
+};
+
+struct slab_sheaf {
+	union {
+		struct list_head barn_list;
+		/* only used for prefilled sheafs */
+		unsigned int capacity;
+	};
+	struct kmem_cache *cache;
+	unsigned int size;
+	int node; /* only used for rcu_sheaf */
+	void *objects[];
+};
+
 static inline void *kzalloc(size_t size, gfp_t gfp)
 {
 	return kmalloc(size, gfp | __GFP_ZERO);
@@ -37,12 +149,57 @@ static inline void *kmem_cache_alloc(struct kmem_cache *cachep, int flags)
 }
 void kmem_cache_free(struct kmem_cache *cachep, void *objp);
 
-struct kmem_cache *kmem_cache_create(const char *name, unsigned int size,
-			unsigned int align, unsigned int flags,
-			void (*ctor)(void *));
+
+struct kmem_cache *
+__kmem_cache_create_args(const char *name, unsigned int size,
+		struct kmem_cache_args *args, unsigned int flags);
+
+/* If NULL is passed for @args, use this variant with default arguments. */
+static inline struct kmem_cache *
+__kmem_cache_default_args(const char *name, unsigned int size,
+		struct kmem_cache_args *args, unsigned int flags)
+{
+	struct kmem_cache_args kmem_default_args = {};
+
+	return __kmem_cache_create_args(name, size, &kmem_default_args, flags);
+}
+
+static inline struct kmem_cache *
+__kmem_cache_create(const char *name, unsigned int size, unsigned int align,
+		unsigned int flags, void (*ctor)(void *))
+{
+	struct kmem_cache_args kmem_args = {
+		.align	= align,
+		.ctor	= ctor,
+	};
+
+	return __kmem_cache_create_args(name, size, &kmem_args, flags);
+}
+
+#define kmem_cache_create(__name, __object_size, __args, ...)           \
+	_Generic((__args),                                              \
+		struct kmem_cache_args *: __kmem_cache_create_args,	\
+		void *: __kmem_cache_default_args,			\
+		default: __kmem_cache_create)(__name, __object_size, __args, __VA_ARGS__)
 
 void kmem_cache_free_bulk(struct kmem_cache *cachep, size_t size, void **list);
 int kmem_cache_alloc_bulk(struct kmem_cache *cachep, gfp_t gfp, size_t size,
 			  void **list);
+struct slab_sheaf *
+kmem_cache_prefill_sheaf(struct kmem_cache *s, gfp_t gfp, unsigned int size);
+
+void *
+kmem_cache_alloc_from_sheaf(struct kmem_cache *s, gfp_t gfp,
+		struct slab_sheaf *sheaf);
+
+void kmem_cache_return_sheaf(struct kmem_cache *s, gfp_t gfp,
+		struct slab_sheaf *sheaf);
+int kmem_cache_refill_sheaf(struct kmem_cache *s, gfp_t gfp,
+		struct slab_sheaf **sheafp, unsigned int size);
+
+static inline unsigned int kmem_cache_sheaf_size(struct slab_sheaf *sheaf)
+{
+	return sheaf->size;
+}
 
 #endif		/* _TOOLS_SLAB_H */
diff --git a/tools/include/nolibc/nolibc.h b/tools/include/nolibc/nolibc.h
index c199ade200c2..d2f5aa085f8e 100644
--- a/tools/include/nolibc/nolibc.h
+++ b/tools/include/nolibc/nolibc.h
@@ -116,6 +116,7 @@
 #include "sched.h"
 #include "signal.h"
 #include "unistd.h"
+#include "stdbool.h"
 #include "stdio.h"
 #include "stdlib.h"
 #include "string.h"
diff --git a/tools/include/nolibc/poll.h b/tools/include/nolibc/poll.h
index 1765acb17ea0..0d053f93ea99 100644
--- a/tools/include/nolibc/poll.h
+++ b/tools/include/nolibc/poll.h
@@ -39,10 +39,8 @@ int sys_poll(struct pollfd *fds, int nfds, int timeout)
 		t.tv_nsec = (timeout % 1000) * 1000000;
 	}
 	return my_syscall5(__NR_ppoll_time64, fds, nfds, (timeout >= 0) ? &t : NULL, NULL, 0);
-#elif defined(__NR_poll)
-	return my_syscall3(__NR_poll, fds, nfds, timeout);
 #else
-	return __nolibc_enosys(__func__, fds, nfds, timeout);
+	return my_syscall3(__NR_poll, fds, nfds, timeout);
 #endif
 }
 
diff --git a/tools/include/nolibc/std.h b/tools/include/nolibc/std.h
index ba950f0e7338..2c1ad23b9b5c 100644
--- a/tools/include/nolibc/std.h
+++ b/tools/include/nolibc/std.h
@@ -29,6 +29,6 @@ typedef unsigned long       nlink_t;
 typedef   signed long         off_t;
 typedef   signed long     blksize_t;
 typedef   signed long      blkcnt_t;
-typedef __kernel_old_time_t  time_t;
+typedef __kernel_time_t      time_t;
 
 #endif /* _NOLIBC_STD_H */
diff --git a/tools/include/nolibc/sys.h b/tools/include/nolibc/sys.h
index 295e71d34aba..c5564f57deec 100644
--- a/tools/include/nolibc/sys.h
+++ b/tools/include/nolibc/sys.h
@@ -142,10 +142,8 @@ int sys_chmod(const char *path, mode_t mode)
 {
 #if defined(__NR_fchmodat)
 	return my_syscall4(__NR_fchmodat, AT_FDCWD, path, mode, 0);
-#elif defined(__NR_chmod)
-	return my_syscall2(__NR_chmod, path, mode);
 #else
-	return __nolibc_enosys(__func__, path, mode);
+	return my_syscall2(__NR_chmod, path, mode);
 #endif
 }
 
@@ -165,10 +163,8 @@ int sys_chown(const char *path, uid_t owner, gid_t group)
 {
 #if defined(__NR_fchownat)
 	return my_syscall5(__NR_fchownat, AT_FDCWD, path, owner, group, 0);
-#elif defined(__NR_chown)
-	return my_syscall3(__NR_chown, path, owner, group);
 #else
-	return __nolibc_enosys(__func__, path, owner, group);
+	return my_syscall3(__NR_chown, path, owner, group);
 #endif
 }
 
@@ -238,11 +234,22 @@ static __attribute__((unused))
 int sys_dup2(int old, int new)
 {
 #if defined(__NR_dup3)
+	int ret, nr_fcntl;
+
+#ifdef __NR_fcntl64
+	nr_fcntl = __NR_fcntl64;
+#else
+	nr_fcntl = __NR_fcntl;
+#endif
+
+	if (old == new) {
+		ret = my_syscall2(nr_fcntl, old, F_GETFD);
+		return ret < 0 ? ret : old;
+	}
+
 	return my_syscall3(__NR_dup3, old, new, 0);
-#elif defined(__NR_dup2)
-	return my_syscall2(__NR_dup2, old, new);
 #else
-	return __nolibc_enosys(__func__, old, new);
+	return my_syscall2(__NR_dup2, old, new);
 #endif
 }
 
@@ -327,10 +334,8 @@ pid_t sys_fork(void)
 	 * will not use the rest with no other flag.
 	 */
 	return my_syscall5(__NR_clone, SIGCHLD, 0, 0, 0, 0);
-#elif defined(__NR_fork)
-	return my_syscall0(__NR_fork);
 #else
-	return __nolibc_enosys(__func__);
+	return my_syscall0(__NR_fork);
 #endif
 }
 #endif
@@ -347,7 +352,7 @@ pid_t sys_vfork(void)
 {
 #if defined(__NR_vfork)
 	return my_syscall0(__NR_vfork);
-#elif defined(__NR_clone3)
+#else
 	/*
 	 * clone() could be used but has different argument orders per
 	 * architecture.
@@ -358,8 +363,6 @@ pid_t sys_vfork(void)
 	};
 
 	return my_syscall2(__NR_clone3, &args, sizeof(args));
-#else
-	return __nolibc_enosys(__func__);
 #endif
 }
 #endif
@@ -569,10 +572,8 @@ int sys_link(const char *old, const char *new)
 {
 #if defined(__NR_linkat)
 	return my_syscall5(__NR_linkat, AT_FDCWD, old, AT_FDCWD, new, 0);
-#elif defined(__NR_link)
-	return my_syscall2(__NR_link, old, new);
 #else
-	return __nolibc_enosys(__func__, old, new);
+	return my_syscall2(__NR_link, old, new);
 #endif
 }
 
@@ -593,41 +594,27 @@ off_t sys_lseek(int fd, off_t offset, int whence)
 #if defined(__NR_lseek)
 	return my_syscall3(__NR_lseek, fd, offset, whence);
 #else
-	return __nolibc_enosys(__func__, fd, offset, whence);
-#endif
-}
+	__kernel_loff_t loff = 0;
+	off_t result;
+	int ret;
 
-static __attribute__((unused))
-int sys_llseek(int fd, unsigned long offset_high, unsigned long offset_low,
-	       __kernel_loff_t *result, int whence)
-{
-#if defined(__NR_llseek)
-	return my_syscall5(__NR_llseek, fd, offset_high, offset_low, result, whence);
-#else
-	return __nolibc_enosys(__func__, fd, offset_high, offset_low, result, whence);
+	/* Only exists on 32bit where nolibc off_t is also 32bit */
+	ret = my_syscall5(__NR_llseek, fd, 0, offset, &loff, whence);
+	if (ret < 0)
+		result = ret;
+	else if (loff != (off_t)loff)
+		result = -EOVERFLOW;
+	else
+		result = loff;
+
+	return result;
 #endif
 }
 
 static __attribute__((unused))
 off_t lseek(int fd, off_t offset, int whence)
 {
-	__kernel_loff_t loff = 0;
-	off_t result;
-	int ret;
-
-	result = sys_lseek(fd, offset, whence);
-	if (result == -ENOSYS) {
-		/* Only exists on 32bit where nolibc off_t is also 32bit */
-		ret = sys_llseek(fd, 0, offset, &loff, whence);
-		if (ret < 0)
-			result = ret;
-		else if (loff != (off_t)loff)
-			result = -EOVERFLOW;
-		else
-			result = loff;
-	}
-
-	return __sysret(result);
+	return __sysret(sys_lseek(fd, offset, whence));
 }
 
 
@@ -640,10 +627,8 @@ int sys_mkdir(const char *path, mode_t mode)
 {
 #if defined(__NR_mkdirat)
 	return my_syscall3(__NR_mkdirat, AT_FDCWD, path, mode);
-#elif defined(__NR_mkdir)
-	return my_syscall2(__NR_mkdir, path, mode);
 #else
-	return __nolibc_enosys(__func__, path, mode);
+	return my_syscall2(__NR_mkdir, path, mode);
 #endif
 }
 
@@ -662,10 +647,8 @@ int sys_rmdir(const char *path)
 {
 #if defined(__NR_rmdir)
 	return my_syscall1(__NR_rmdir, path);
-#elif defined(__NR_unlinkat)
-	return my_syscall3(__NR_unlinkat, AT_FDCWD, path, AT_REMOVEDIR);
 #else
-	return __nolibc_enosys(__func__, path);
+	return my_syscall3(__NR_unlinkat, AT_FDCWD, path, AT_REMOVEDIR);
 #endif
 }
 
@@ -685,10 +668,8 @@ long sys_mknod(const char *path, mode_t mode, dev_t dev)
 {
 #if defined(__NR_mknodat)
 	return my_syscall4(__NR_mknodat, AT_FDCWD, path, mode, dev);
-#elif defined(__NR_mknod)
-	return my_syscall3(__NR_mknod, path, mode, dev);
 #else
-	return __nolibc_enosys(__func__, path, mode, dev);
+	return my_syscall3(__NR_mknod, path, mode, dev);
 #endif
 }
 
@@ -801,7 +782,7 @@ int sys_select(int nfds, fd_set *rfds, fd_set *wfds, fd_set *efds, struct timeva
 		t.tv_nsec = timeout->tv_usec * 1000;
 	}
 	return my_syscall6(__NR_pselect6, nfds, rfds, wfds, efds, timeout ? &t : NULL, NULL);
-#elif defined(__NR_pselect6_time64)
+#else
 	struct __kernel_timespec t;
 
 	if (timeout) {
@@ -809,8 +790,6 @@ int sys_select(int nfds, fd_set *rfds, fd_set *wfds, fd_set *efds, struct timeva
 		t.tv_nsec = timeout->tv_usec * 1000;
 	}
 	return my_syscall6(__NR_pselect6_time64, nfds, rfds, wfds, efds, timeout ? &t : NULL, NULL);
-#else
-	return __nolibc_enosys(__func__, nfds, rfds, wfds, efds, timeout);
 #endif
 }
 
@@ -874,10 +853,8 @@ int sys_symlink(const char *old, const char *new)
 {
 #if defined(__NR_symlinkat)
 	return my_syscall3(__NR_symlinkat, old, AT_FDCWD, new);
-#elif defined(__NR_symlink)
-	return my_syscall2(__NR_symlink, old, new);
 #else
-	return __nolibc_enosys(__func__, old, new);
+	return my_syscall2(__NR_symlink, old, new);
 #endif
 }
 
@@ -931,10 +908,8 @@ int sys_unlink(const char *path)
 {
 #if defined(__NR_unlinkat)
 	return my_syscall3(__NR_unlinkat, AT_FDCWD, path, 0);
-#elif defined(__NR_unlink)
-	return my_syscall1(__NR_unlink, path);
 #else
-	return __nolibc_enosys(__func__, path);
+	return my_syscall1(__NR_unlink, path);
 #endif
 }
 
diff --git a/tools/include/nolibc/sys/random.h b/tools/include/nolibc/sys/random.h
index 8d9749f1c845..cd5d25c571a8 100644
--- a/tools/include/nolibc/sys/random.h
+++ b/tools/include/nolibc/sys/random.h
@@ -22,13 +22,13 @@
 static __attribute__((unused))
 ssize_t sys_getrandom(void *buf, size_t buflen, unsigned int flags)
 {
-       return my_syscall3(__NR_getrandom, buf, buflen, flags);
+	return my_syscall3(__NR_getrandom, buf, buflen, flags);
 }
 
 static __attribute__((unused))
 ssize_t getrandom(void *buf, size_t buflen, unsigned int flags)
 {
-       return __sysret(sys_getrandom(buf, buflen, flags));
+	return __sysret(sys_getrandom(buf, buflen, flags));
 }
 
 #endif /* _NOLIBC_SYS_RANDOM_H */
diff --git a/tools/include/nolibc/sys/timerfd.h b/tools/include/nolibc/sys/timerfd.h
index 4375d546ba58..5dd61030c991 100644
--- a/tools/include/nolibc/sys/timerfd.h
+++ b/tools/include/nolibc/sys/timerfd.h
@@ -34,7 +34,7 @@ int sys_timerfd_gettime(int fd, struct itimerspec *curr_value)
 {
 #if defined(__NR_timerfd_gettime)
 	return my_syscall2(__NR_timerfd_gettime, fd, curr_value);
-#elif defined(__NR_timerfd_gettime64)
+#else
 	struct __kernel_itimerspec kcurr_value;
 	int ret;
 
@@ -42,8 +42,6 @@ int sys_timerfd_gettime(int fd, struct itimerspec *curr_value)
 	__nolibc_timespec_kernel_to_user(&kcurr_value.it_interval, &curr_value->it_interval);
 	__nolibc_timespec_kernel_to_user(&kcurr_value.it_value, &curr_value->it_value);
 	return ret;
-#else
-	return __nolibc_enosys(__func__, fd, curr_value);
 #endif
 }
 
@@ -60,7 +58,7 @@ int sys_timerfd_settime(int fd, int flags,
 {
 #if defined(__NR_timerfd_settime)
 	return my_syscall4(__NR_timerfd_settime, fd, flags, new_value, old_value);
-#elif defined(__NR_timerfd_settime64)
+#else
 	struct __kernel_itimerspec knew_value, kold_value;
 	int ret;
 
@@ -72,8 +70,6 @@ int sys_timerfd_settime(int fd, int flags,
 		__nolibc_timespec_kernel_to_user(&kold_value.it_value, &old_value->it_value);
 	}
 	return ret;
-#else
-	return __nolibc_enosys(__func__, fd, flags, new_value, old_value);
 #endif
 }
 
diff --git a/tools/include/nolibc/sys/wait.h b/tools/include/nolibc/sys/wait.h
index 56ddb806da7f..4e66e1f7a03e 100644
--- a/tools/include/nolibc/sys/wait.h
+++ b/tools/include/nolibc/sys/wait.h
@@ -16,27 +16,10 @@
 
 /*
  * pid_t wait(int *status);
- * pid_t wait4(pid_t pid, int *status, int options, struct rusage *rusage);
  * pid_t waitpid(pid_t pid, int *status, int options);
  * int waitid(idtype_t idtype, id_t id, siginfo_t *infop, int options);
  */
 
-static __attribute__((unused))
-pid_t sys_wait4(pid_t pid, int *status, int options, struct rusage *rusage)
-{
-#ifdef __NR_wait4
-	return my_syscall4(__NR_wait4, pid, status, options, rusage);
-#else
-	return __nolibc_enosys(__func__, pid, status, options, rusage);
-#endif
-}
-
-static __attribute__((unused))
-pid_t wait4(pid_t pid, int *status, int options, struct rusage *rusage)
-{
-	return __sysret(sys_wait4(pid, status, options, rusage));
-}
-
 static __attribute__((unused))
 int sys_waitid(int which, pid_t pid, siginfo_t *infop, int options, struct rusage *rusage)
 {
diff --git a/tools/include/nolibc/time.h b/tools/include/nolibc/time.h
index d02bc44d2643..6c276b8d646a 100644
--- a/tools/include/nolibc/time.h
+++ b/tools/include/nolibc/time.h
@@ -45,7 +45,7 @@ int sys_clock_getres(clockid_t clockid, struct timespec *res)
 {
 #if defined(__NR_clock_getres)
 	return my_syscall2(__NR_clock_getres, clockid, res);
-#elif defined(__NR_clock_getres_time64)
+#else
 	struct __kernel_timespec kres;
 	int ret;
 
@@ -53,8 +53,6 @@ int sys_clock_getres(clockid_t clockid, struct timespec *res)
 	if (res)
 		__nolibc_timespec_kernel_to_user(&kres, res);
 	return ret;
-#else
-	return __nolibc_enosys(__func__, clockid, res);
 #endif
 }
 
@@ -69,7 +67,7 @@ int sys_clock_gettime(clockid_t clockid, struct timespec *tp)
 {
 #if defined(__NR_clock_gettime)
 	return my_syscall2(__NR_clock_gettime, clockid, tp);
-#elif defined(__NR_clock_gettime64)
+#else
 	struct __kernel_timespec ktp;
 	int ret;
 
@@ -77,8 +75,6 @@ int sys_clock_gettime(clockid_t clockid, struct timespec *tp)
 	if (tp)
 		__nolibc_timespec_kernel_to_user(&ktp, tp);
 	return ret;
-#else
-	return __nolibc_enosys(__func__, clockid, tp);
 #endif
 }
 
@@ -133,7 +129,8 @@ static __attribute__((unused))
 int clock_nanosleep(clockid_t clockid, int flags, const struct timespec *rqtp,
 		    struct timespec *rmtp)
 {
-	return __sysret(sys_clock_nanosleep(clockid, flags, rqtp, rmtp));
+	/* Directly return a positive error number */
+	return -sys_clock_nanosleep(clockid, flags, rqtp, rmtp);
 }
 
 static __inline__
@@ -145,7 +142,7 @@ double difftime(time_t time1, time_t time2)
 static __inline__
 int nanosleep(const struct timespec *rqtp, struct timespec *rmtp)
 {
-	return clock_nanosleep(CLOCK_REALTIME, 0, rqtp, rmtp);
+	return __sysret(sys_clock_nanosleep(CLOCK_REALTIME, 0, rqtp, rmtp));
 }
 
 
diff --git a/tools/include/nolibc/unistd.h b/tools/include/nolibc/unistd.h
index 25bfc7732ec7..7405fa2b89ba 100644
--- a/tools/include/nolibc/unistd.h
+++ b/tools/include/nolibc/unistd.h
@@ -33,7 +33,7 @@
 static __attribute__((unused))
 int sys_faccessat(int fd, const char *path, int amode, int flag)
 {
-       return my_syscall4(__NR_faccessat, fd, path, amode, flag);
+	return my_syscall4(__NR_faccessat, fd, path, amode, flag);
 }
 
 static __attribute__((unused))
diff --git a/tools/perf/util/include/linux/linkage.h b/tools/perf/util/include/linux/linkage.h
index 89979ca23c3f..34e2fdfe7300 100644
--- a/tools/perf/util/include/linux/linkage.h
+++ b/tools/perf/util/include/linux/linkage.h
@@ -120,7 +120,7 @@
 #endif
 
 // In the kernel sources (include/linux/cfi_types.h), this has a different
-// definition when CONFIG_CFI_CLANG is used, for tools/ just use the !clang
+// definition when CONFIG_CFI is used, for tools/ just use the !cfi
 // definition:
 #ifndef SYM_TYPED_START
 #define SYM_TYPED_START(name, linkage, align...)        \
diff --git a/tools/power/x86/turbostat/turbostat.8 b/tools/power/x86/turbostat/turbostat.8
index 3340def58d01..869f318314e2 100644
--- a/tools/power/x86/turbostat/turbostat.8
+++ b/tools/power/x86/turbostat/turbostat.8
@@ -101,7 +101,7 @@ The column name "all" can be used to enable all disabled-by-default built-in cou
 .PP
 \fB--show column\fP show only the specified built-in columns.  May be invoked multiple times, or with a comma-separated list of column names.
 .PP
-\fB--show CATEGORY --hide CATEGORY\fP  Show and hide also accept a single CATEGORY of columns: "all", "topology", "idle", "frequency", "power", "cpuidle", "hwidle", "swidle", "other".  "idle" (enabled by default), includes "hwidle" and "pct_idle".  "cpuidle" (default disabled) includes cpuidle software invocation counters.  "swidle" includes "cpuidle" plus "pct_idle".  "hwidle" includes only hardware based idle residency counters.  Older versions of turbostat used the term "sysfs" for what is now "swidle".
+\fB--show CATEGORY --hide CATEGORY\fP  Show and hide also accept a single CATEGORY of columns: "all", "topology", "idle", "frequency", "power", "sysfs", "other".
 .PP
 \fB--Dump\fP displays the raw counter values.
 .PP
@@ -159,22 +159,20 @@ The system configuration dump (if --quiet is not used) is followed by statistics
 .PP
 \fBSMI\fP The number of System Management Interrupts  serviced CPU during the measurement interval.  While this counter is actually per-CPU, SMI are triggered on all processors, so the number should be the same for all CPUs.
 .PP
-\fBC1, C2, C3...\fP The number times Linux requested the C1, C2, C3 idle state during the measurement interval.  The system summary line shows the sum for all CPUs.  These are C-state names as exported in /sys/devices/system/cpu/cpu*/cpuidle/state*/name.  While their names are generic, their attributes are processor specific. They the system description section of output shows what MWAIT sub-states they are mapped to on each system.  These counters are in the "cpuidle" group, which is disabled, by default.
+\fBC1, C2, C3...\fP The number times Linux requested the C1, C2, C3 idle state during the measurement interval.  The system summary line shows the sum for all CPUs.  These are C-state names as exported in /sys/devices/system/cpu/cpu*/cpuidle/state*/name.  While their names are generic, their attributes are processor specific. They the system description section of output shows what MWAIT sub-states they are mapped to on each system.
 .PP
-\fBC1+, C2+, C3+...\fP The idle governor idle state misprediction statistics. Inidcates the number times Linux requested the C1, C2, C3 idle state during the measurement interval, but should have requested a deeper idle state (if it exists and enabled). These statistics come from the /sys/devices/system/cpu/cpu*/cpuidle/state*/below file.  These counters are in the "cpuidle" group, which is disabled, by default.
+\fBC1+, C2+, C3+...\fP The idle governor idle state misprediction statistics. Inidcates the number times Linux requested the C1, C2, C3 idle state during the measurement interval, but should have requested a deeper idle state (if it exists and enabled). These statistics come from the /sys/devices/system/cpu/cpu*/cpuidle/state*/below file.
 .PP
-\fBC1-, C2-, C3-...\fP The idle governor idle state misprediction statistics. Inidcates the number times Linux requested the C1, C2, C3 idle state during the measurement interval, but should have requested a shallower idle state (if it exists and enabled). These statistics come from the /sys/devices/system/cpu/cpu*/cpuidle/state*/above file.  These counters are in the "cpuidle" group, which is disabled, by default.
+\fBC1-, C2-, C3-...\fP The idle governor idle state misprediction statistics. Inidcates the number times Linux requested the C1, C2, C3 idle state during the measurement interval, but should have requested a shallower idle state (if it exists and enabled). These statistics come from the /sys/devices/system/cpu/cpu*/cpuidle/state*/above file.
 .PP
-\fBC1%, C2%, C3%\fP The residency percentage that Linux requested C1, C2, C3....  The system summary is the average of all CPUs in the system.  Note that these are software, reflecting what was requested.  The hardware counters reflect what was actually achieved.  These counters are in the "pct_idle" group, which is enabled by default.
+\fBC1%, C2%, C3%\fP The residency percentage that Linux requested C1, C2, C3....  The system summary is the average of all CPUs in the system.  Note that these are software, reflecting what was requested.  The hardware counters reflect what was actually achieved.
 .PP
-\fBCPU%c1, CPU%c3, CPU%c6, CPU%c7\fP show the percentage residency in hardware core idle states.  These numbers are from hardware residency counters and are in the "hwidle" group, which is enabled, by default.
+\fBCPU%c1, CPU%c3, CPU%c6, CPU%c7\fP show the percentage residency in hardware core idle states.  These numbers are from hardware residency counters.
 .PP
 \fBCoreTmp\fP Degrees Celsius reported by the per-core Digital Thermal Sensor.
 .PP
 \fBPkgTmp\fP Degrees Celsius reported by the per-package Package Thermal Monitor.
 .PP
-\fBCoreThr\fP Core Thermal Throttling events during the measurement interval.  Note that events since boot can be find in /sys/devices/system/cpu/cpu*/thermal_throttle/*
-.PP
 \fBGFX%rc6\fP The percentage of time the GPU is in the "render C6" state, rc6, during the measurement interval. From /sys/class/drm/card0/power/rc6_residency_ms or /sys/class/drm/card0/gt/gt0/rc6_residency_ms or /sys/class/drm/card0/device/tile0/gtN/gtidle/idle_residency_ms depending on the graphics driver being used.
 .PP
 \fBGFXMHz\fP Instantaneous snapshot of what sysfs presents at the end of the measurement interval. From /sys/class/graphics/fb0/device/drm/card0/gt_cur_freq_mhz or /sys/class/drm/card0/gt_cur_freq_mhz or /sys/class/drm/card0/gt/gt0/rps_cur_freq_mhz or /sys/class/drm/card0/device/tile0/gtN/freq0/cur_freq depending on the graphics driver being used.
@@ -213,8 +211,7 @@ The system configuration dump (if --quiet is not used) is followed by statistics
 .PP
 \fBUncMHz\fP per-package uncore MHz, instantaneous sample.
 .PP
-\fBUMHz1.0\fP per-package uncore MHz for pm_domain=1 and fabric_cluster=0, instantaneous sample.  System summary is the average of all packages.
-Intel Granite Rapids systems use pm_domains 0-2 for CPUs, and 3-4 for IO, with cluster always 0.
+\fBUMHz1.0\fP per-package uncore MHz for domain=1 and fabric_cluster=0, instantaneous sample.  System summary is the average of all packages.
 For the "--show" and "--hide" options, use "UncMHz" to operate on all UMHz*.* as a group.
 .SH TOO MUCH INFORMATION EXAMPLE
 By default, turbostat dumps all possible information -- a system configuration header, followed by columns for all counters.
diff --git a/tools/testing/cxl/Kbuild b/tools/testing/cxl/Kbuild
index d07f14cb7aa4..0d5ce4b74b9f 100644
--- a/tools/testing/cxl/Kbuild
+++ b/tools/testing/cxl/Kbuild
@@ -5,22 +5,19 @@ ldflags-y += --wrap=acpi_evaluate_integer
 ldflags-y += --wrap=acpi_pci_find_root
 ldflags-y += --wrap=nvdimm_bus_register
 ldflags-y += --wrap=devm_cxl_port_enumerate_dports
-ldflags-y += --wrap=devm_cxl_setup_hdm
-ldflags-y += --wrap=devm_cxl_add_passthrough_decoder
-ldflags-y += --wrap=devm_cxl_enumerate_decoders
 ldflags-y += --wrap=cxl_await_media_ready
-ldflags-y += --wrap=cxl_hdm_decode_init
-ldflags-y += --wrap=cxl_dvsec_rr_decode
 ldflags-y += --wrap=devm_cxl_add_rch_dport
 ldflags-y += --wrap=cxl_rcd_component_reg_phys
 ldflags-y += --wrap=cxl_endpoint_parse_cdat
 ldflags-y += --wrap=cxl_dport_init_ras_reporting
+ldflags-y += --wrap=devm_cxl_endpoint_decoders_setup
 
 DRIVERS := ../../../drivers
 CXL_SRC := $(DRIVERS)/cxl
 CXL_CORE_SRC := $(DRIVERS)/cxl/core
 ccflags-y := -I$(srctree)/drivers/cxl/
 ccflags-y += -D__mock=__weak
+ccflags-y += -DCXL_TEST_ENABLE=1
 ccflags-y += -DTRACE_INCLUDE_PATH=$(CXL_CORE_SRC) -I$(srctree)/drivers/cxl/core/
 
 obj-m += cxl_acpi.o
diff --git a/tools/testing/cxl/cxl_core_exports.c b/tools/testing/cxl/cxl_core_exports.c
index f088792a8925..6754de35598d 100644
--- a/tools/testing/cxl/cxl_core_exports.c
+++ b/tools/testing/cxl/cxl_core_exports.c
@@ -2,6 +2,28 @@
 /* Copyright(c) 2022 Intel Corporation. All rights reserved. */
 
 #include "cxl.h"
+#include "exports.h"
 
 /* Exporting of cxl_core symbols that are only used by cxl_test */
 EXPORT_SYMBOL_NS_GPL(cxl_num_decoders_committed, "CXL");
+
+cxl_add_dport_by_dev_fn _devm_cxl_add_dport_by_dev =
+	__devm_cxl_add_dport_by_dev;
+EXPORT_SYMBOL_NS_GPL(_devm_cxl_add_dport_by_dev, "CXL");
+
+struct cxl_dport *devm_cxl_add_dport_by_dev(struct cxl_port *port,
+					    struct device *dport_dev)
+{
+	return _devm_cxl_add_dport_by_dev(port, dport_dev);
+}
+EXPORT_SYMBOL_NS_GPL(devm_cxl_add_dport_by_dev, "CXL");
+
+cxl_switch_decoders_setup_fn _devm_cxl_switch_port_decoders_setup =
+	__devm_cxl_switch_port_decoders_setup;
+EXPORT_SYMBOL_NS_GPL(_devm_cxl_switch_port_decoders_setup, "CXL");
+
+int devm_cxl_switch_port_decoders_setup(struct cxl_port *port)
+{
+	return _devm_cxl_switch_port_decoders_setup(port);
+}
+EXPORT_SYMBOL_NS_GPL(devm_cxl_switch_port_decoders_setup, "CXL");
diff --git a/tools/testing/cxl/exports.h b/tools/testing/cxl/exports.h
new file mode 100644
index 000000000000..7ebee7c0bd67
--- /dev/null
+++ b/tools/testing/cxl/exports.h
@@ -0,0 +1,13 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+/* Copyright(c) 2025 Intel Corporation */
+#ifndef __MOCK_CXL_EXPORTS_H_
+#define __MOCK_CXL_EXPORTS_H_
+
+typedef struct cxl_dport *(*cxl_add_dport_by_dev_fn)(struct cxl_port *port,
+							  struct device *dport_dev);
+extern cxl_add_dport_by_dev_fn _devm_cxl_add_dport_by_dev;
+
+typedef int(*cxl_switch_decoders_setup_fn)(struct cxl_port *port);
+extern cxl_switch_decoders_setup_fn _devm_cxl_switch_port_decoders_setup;
+
+#endif
diff --git a/tools/testing/cxl/test/cxl.c b/tools/testing/cxl/test/cxl.c
index 6a25cca5636f..2d135ca533d0 100644
--- a/tools/testing/cxl/test/cxl.c
+++ b/tools/testing/cxl/test/cxl.c
@@ -210,7 +210,7 @@ static struct {
 			},
 			.interleave_ways = 0,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_VOLATILE,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 4UL,
@@ -225,7 +225,7 @@ static struct {
 			},
 			.interleave_ways = 1,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_VOLATILE,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 8UL,
@@ -240,7 +240,7 @@ static struct {
 			},
 			.interleave_ways = 0,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_PMEM,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 4UL,
@@ -255,7 +255,7 @@ static struct {
 			},
 			.interleave_ways = 1,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_PMEM,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 8UL,
@@ -270,7 +270,7 @@ static struct {
 			},
 			.interleave_ways = 0,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_PMEM,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 4UL,
@@ -285,7 +285,7 @@ static struct {
 			},
 			.interleave_ways = 0,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_VOLATILE,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M,
@@ -302,7 +302,7 @@ static struct {
 			.interleave_arithmetic = ACPI_CEDT_CFMWS_ARITHMETIC_XOR,
 			.interleave_ways = 0,
 			.granularity = 4,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_PMEM,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 8UL,
@@ -318,7 +318,7 @@ static struct {
 			.interleave_arithmetic = ACPI_CEDT_CFMWS_ARITHMETIC_XOR,
 			.interleave_ways = 1,
 			.granularity = 0,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_PMEM,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_256M * 8UL,
@@ -334,7 +334,7 @@ static struct {
 			.interleave_arithmetic = ACPI_CEDT_CFMWS_ARITHMETIC_XOR,
 			.interleave_ways = 8,
 			.granularity = 1,
-			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_TYPE3 |
+			.restrictions = ACPI_CEDT_CFMWS_RESTRICT_HOSTONLYMEM |
 					ACPI_CEDT_CFMWS_RESTRICT_PMEM,
 			.qtg_id = FAKE_QTG_ID,
 			.window_size = SZ_512M * 6UL,
@@ -643,15 +643,8 @@ static struct cxl_hdm *mock_cxl_setup_hdm(struct cxl_port *port,
 	return cxlhdm;
 }
 
-static int mock_cxl_add_passthrough_decoder(struct cxl_port *port)
-{
-	dev_err(&port->dev, "unexpected passthrough decoder for cxl_test\n");
-	return -EOPNOTSUPP;
-}
-
-
 struct target_map_ctx {
-	int *target_map;
+	u32 *target_map;
 	int index;
 	int target_count;
 };
@@ -818,15 +811,21 @@ static void mock_init_hdm_decoder(struct cxl_decoder *cxld)
 		 */
 		if (WARN_ON(!dev))
 			continue;
+
 		cxlsd = to_cxl_switch_decoder(dev);
 		if (i == 0) {
 			/* put cxl_mem.4 second in the decode order */
-			if (pdev->id == 4)
+			if (pdev->id == 4) {
 				cxlsd->target[1] = dport;
-			else
+				cxld->target_map[1] = dport->port_id;
+			} else {
 				cxlsd->target[0] = dport;
-		} else
+				cxld->target_map[0] = dport->port_id;
+			}
+		} else {
 			cxlsd->target[0] = dport;
+			cxld->target_map[0] = dport->port_id;
+		}
 		cxld = &cxlsd->cxld;
 		cxld->target_type = CXL_DECODER_HOSTONLYMEM;
 		cxld->flags = CXL_DECODER_F_ENABLE;
@@ -863,9 +862,7 @@ static int mock_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 		target_count = NR_CXL_SWITCH_PORTS;
 
 	for (i = 0; i < NR_CXL_PORT_DECODERS; i++) {
-		int target_map[CXL_DECODER_MAX_INTERLEAVE] = { 0 };
 		struct target_map_ctx ctx = {
-			.target_map = target_map,
 			.target_count = target_count,
 		};
 		struct cxl_decoder *cxld;
@@ -894,6 +891,8 @@ static int mock_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 			cxld = &cxled->cxld;
 		}
 
+		ctx.target_map = cxld->target_map;
+
 		mock_init_hdm_decoder(cxld);
 
 		if (target_count) {
@@ -905,7 +904,7 @@ static int mock_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 			}
 		}
 
-		rc = cxl_decoder_add_locked(cxld, target_map);
+		rc = cxl_decoder_add_locked(cxld);
 		if (rc) {
 			put_device(&cxld->dev);
 			dev_err(&port->dev, "Failed to add decoder\n");
@@ -921,10 +920,42 @@ static int mock_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
 	return 0;
 }
 
-static int mock_cxl_port_enumerate_dports(struct cxl_port *port)
+static int __mock_cxl_decoders_setup(struct cxl_port *port)
+{
+	struct cxl_hdm *cxlhdm;
+
+	cxlhdm = mock_cxl_setup_hdm(port, NULL);
+	if (IS_ERR(cxlhdm)) {
+		if (PTR_ERR(cxlhdm) != -ENODEV)
+			dev_err(&port->dev, "Failed to map HDM decoder capability\n");
+		return PTR_ERR(cxlhdm);
+	}
+
+	return mock_cxl_enumerate_decoders(cxlhdm, NULL);
+}
+
+static int mock_cxl_switch_port_decoders_setup(struct cxl_port *port)
+{
+	if (is_cxl_root(port) || is_cxl_endpoint(port))
+		return -EOPNOTSUPP;
+
+	return __mock_cxl_decoders_setup(port);
+}
+
+static int mock_cxl_endpoint_decoders_setup(struct cxl_port *port)
+{
+	if (!is_cxl_endpoint(port))
+		return -EOPNOTSUPP;
+
+	return __mock_cxl_decoders_setup(port);
+}
+
+static int get_port_array(struct cxl_port *port,
+			  struct platform_device ***port_array,
+			  int *port_array_size)
 {
 	struct platform_device **array;
-	int i, array_size;
+	int array_size;
 
 	if (port->depth == 1) {
 		if (is_multi_bridge(port->uport_dev)) {
@@ -958,6 +989,22 @@ static int mock_cxl_port_enumerate_dports(struct cxl_port *port)
 		return -ENXIO;
 	}
 
+	*port_array = array;
+	*port_array_size = array_size;
+
+	return 0;
+}
+
+static int mock_cxl_port_enumerate_dports(struct cxl_port *port)
+{
+	struct platform_device **array;
+	int i, array_size;
+	int rc;
+
+	rc = get_port_array(port, &array, &array_size);
+	if (rc)
+		return rc;
+
 	for (i = 0; i < array_size; i++) {
 		struct platform_device *pdev = array[i];
 		struct cxl_dport *dport;
@@ -979,6 +1026,36 @@ static int mock_cxl_port_enumerate_dports(struct cxl_port *port)
 	return 0;
 }
 
+static struct cxl_dport *mock_cxl_add_dport_by_dev(struct cxl_port *port,
+						   struct device *dport_dev)
+{
+	struct platform_device **array;
+	int rc, i, array_size;
+
+	rc = get_port_array(port, &array, &array_size);
+	if (rc)
+		return ERR_PTR(rc);
+
+	for (i = 0; i < array_size; i++) {
+		struct platform_device *pdev = array[i];
+
+		if (pdev->dev.parent != port->uport_dev) {
+			dev_dbg(&port->dev, "%s: mismatch parent %s\n",
+				dev_name(port->uport_dev),
+				dev_name(pdev->dev.parent));
+			continue;
+		}
+
+		if (&pdev->dev != dport_dev)
+			continue;
+
+		return devm_cxl_add_dport(port, &pdev->dev, pdev->id,
+					  CXL_RESOURCE_NONE);
+	}
+
+	return ERR_PTR(-ENODEV);
+}
+
 /*
  * Faking the cxl_dpa_perf for the memdev when appropriate.
  */
@@ -1035,11 +1112,11 @@ static struct cxl_mock_ops cxl_mock_ops = {
 	.acpi_table_parse_cedt = mock_acpi_table_parse_cedt,
 	.acpi_evaluate_integer = mock_acpi_evaluate_integer,
 	.acpi_pci_find_root = mock_acpi_pci_find_root,
+	.devm_cxl_switch_port_decoders_setup = mock_cxl_switch_port_decoders_setup,
+	.devm_cxl_endpoint_decoders_setup = mock_cxl_endpoint_decoders_setup,
 	.devm_cxl_port_enumerate_dports = mock_cxl_port_enumerate_dports,
-	.devm_cxl_setup_hdm = mock_cxl_setup_hdm,
-	.devm_cxl_add_passthrough_decoder = mock_cxl_add_passthrough_decoder,
-	.devm_cxl_enumerate_decoders = mock_cxl_enumerate_decoders,
 	.cxl_endpoint_parse_cdat = mock_cxl_endpoint_parse_cdat,
+	.devm_cxl_add_dport_by_dev = mock_cxl_add_dport_by_dev,
 	.list = LIST_HEAD_INIT(cxl_mock_ops.list),
 };
 
diff --git a/tools/testing/cxl/test/mock.c b/tools/testing/cxl/test/mock.c
index 1989ae020df3..995269a75cbd 100644
--- a/tools/testing/cxl/test/mock.c
+++ b/tools/testing/cxl/test/mock.c
@@ -10,12 +10,21 @@
 #include <cxlmem.h>
 #include <cxlpci.h>
 #include "mock.h"
+#include "../exports.h"
 
 static LIST_HEAD(mock);
 
+static struct cxl_dport *
+redirect_devm_cxl_add_dport_by_dev(struct cxl_port *port,
+				   struct device *dport_dev);
+static int redirect_devm_cxl_switch_port_decoders_setup(struct cxl_port *port);
+
 void register_cxl_mock_ops(struct cxl_mock_ops *ops)
 {
 	list_add_rcu(&ops->list, &mock);
+	_devm_cxl_add_dport_by_dev = redirect_devm_cxl_add_dport_by_dev;
+	_devm_cxl_switch_port_decoders_setup =
+		redirect_devm_cxl_switch_port_decoders_setup;
 }
 EXPORT_SYMBOL_GPL(register_cxl_mock_ops);
 
@@ -23,6 +32,9 @@ DEFINE_STATIC_SRCU(cxl_mock_srcu);
 
 void unregister_cxl_mock_ops(struct cxl_mock_ops *ops)
 {
+	_devm_cxl_switch_port_decoders_setup =
+		__devm_cxl_switch_port_decoders_setup;
+	_devm_cxl_add_dport_by_dev = __devm_cxl_add_dport_by_dev;
 	list_del_rcu(&ops->list);
 	synchronize_srcu(&cxl_mock_srcu);
 }
@@ -131,55 +143,34 @@ __wrap_nvdimm_bus_register(struct device *dev,
 }
 EXPORT_SYMBOL_GPL(__wrap_nvdimm_bus_register);
 
-struct cxl_hdm *__wrap_devm_cxl_setup_hdm(struct cxl_port *port,
-					  struct cxl_endpoint_dvsec_info *info)
-
-{
-	int index;
-	struct cxl_hdm *cxlhdm;
-	struct cxl_mock_ops *ops = get_cxl_mock_ops(&index);
-
-	if (ops && ops->is_mock_port(port->uport_dev))
-		cxlhdm = ops->devm_cxl_setup_hdm(port, info);
-	else
-		cxlhdm = devm_cxl_setup_hdm(port, info);
-	put_cxl_mock_ops(index);
-
-	return cxlhdm;
-}
-EXPORT_SYMBOL_NS_GPL(__wrap_devm_cxl_setup_hdm, "CXL");
-
-int __wrap_devm_cxl_add_passthrough_decoder(struct cxl_port *port)
+int redirect_devm_cxl_switch_port_decoders_setup(struct cxl_port *port)
 {
 	int rc, index;
 	struct cxl_mock_ops *ops = get_cxl_mock_ops(&index);
 
 	if (ops && ops->is_mock_port(port->uport_dev))
-		rc = ops->devm_cxl_add_passthrough_decoder(port);
+		rc = ops->devm_cxl_switch_port_decoders_setup(port);
 	else
-		rc = devm_cxl_add_passthrough_decoder(port);
+		rc = __devm_cxl_switch_port_decoders_setup(port);
 	put_cxl_mock_ops(index);
 
 	return rc;
 }
-EXPORT_SYMBOL_NS_GPL(__wrap_devm_cxl_add_passthrough_decoder, "CXL");
 
-int __wrap_devm_cxl_enumerate_decoders(struct cxl_hdm *cxlhdm,
-				       struct cxl_endpoint_dvsec_info *info)
+int __wrap_devm_cxl_endpoint_decoders_setup(struct cxl_port *port)
 {
 	int rc, index;
-	struct cxl_port *port = cxlhdm->port;
 	struct cxl_mock_ops *ops = get_cxl_mock_ops(&index);
 
 	if (ops && ops->is_mock_port(port->uport_dev))
-		rc = ops->devm_cxl_enumerate_decoders(cxlhdm, info);
+		rc = ops->devm_cxl_endpoint_decoders_setup(port);
 	else
-		rc = devm_cxl_enumerate_decoders(cxlhdm, info);
+		rc = devm_cxl_endpoint_decoders_setup(port);
 	put_cxl_mock_ops(index);
 
 	return rc;
 }
-EXPORT_SYMBOL_NS_GPL(__wrap_devm_cxl_enumerate_decoders, "CXL");
+EXPORT_SYMBOL_NS_GPL(__wrap_devm_cxl_endpoint_decoders_setup, "CXL");
 
 int __wrap_devm_cxl_port_enumerate_dports(struct cxl_port *port)
 {
@@ -211,39 +202,6 @@ int __wrap_cxl_await_media_ready(struct cxl_dev_state *cxlds)
 }
 EXPORT_SYMBOL_NS_GPL(__wrap_cxl_await_media_ready, "CXL");
 
-int __wrap_cxl_hdm_decode_init(struct cxl_dev_state *cxlds,
-			       struct cxl_hdm *cxlhdm,
-			       struct cxl_endpoint_dvsec_info *info)
-{
-	int rc = 0, index;
-	struct cxl_mock_ops *ops = get_cxl_mock_ops(&index);
-
-	if (ops && ops->is_mock_dev(cxlds->dev))
-		rc = 0;
-	else
-		rc = cxl_hdm_decode_init(cxlds, cxlhdm, info);
-	put_cxl_mock_ops(index);
-
-	return rc;
-}
-EXPORT_SYMBOL_NS_GPL(__wrap_cxl_hdm_decode_init, "CXL");
-
-int __wrap_cxl_dvsec_rr_decode(struct cxl_dev_state *cxlds,
-			       struct cxl_endpoint_dvsec_info *info)
-{
-	int rc = 0, index;
-	struct cxl_mock_ops *ops = get_cxl_mock_ops(&index);
-
-	if (ops && ops->is_mock_dev(cxlds->dev))
-		rc = 0;
-	else
-		rc = cxl_dvsec_rr_decode(cxlds, info);
-	put_cxl_mock_ops(index);
-
-	return rc;
-}
-EXPORT_SYMBOL_NS_GPL(__wrap_cxl_dvsec_rr_decode, "CXL");
-
 struct cxl_dport *__wrap_devm_cxl_add_rch_dport(struct cxl_port *port,
 						struct device *dport_dev,
 						int port_id,
@@ -311,6 +269,22 @@ void __wrap_cxl_dport_init_ras_reporting(struct cxl_dport *dport, struct device
 }
 EXPORT_SYMBOL_NS_GPL(__wrap_cxl_dport_init_ras_reporting, "CXL");
 
+struct cxl_dport *redirect_devm_cxl_add_dport_by_dev(struct cxl_port *port,
+						     struct device *dport_dev)
+{
+	int index;
+	struct cxl_mock_ops *ops = get_cxl_mock_ops(&index);
+	struct cxl_dport *dport;
+
+	if (ops && ops->is_mock_port(port->uport_dev))
+		dport = ops->devm_cxl_add_dport_by_dev(port, dport_dev);
+	else
+		dport = __devm_cxl_add_dport_by_dev(port, dport_dev);
+	put_cxl_mock_ops(index);
+
+	return dport;
+}
+
 MODULE_LICENSE("GPL v2");
 MODULE_DESCRIPTION("cxl_test: emulation module");
 MODULE_IMPORT_NS("ACPI");
diff --git a/tools/testing/cxl/test/mock.h b/tools/testing/cxl/test/mock.h
index d1b0271d2822..4ed932e76aae 100644
--- a/tools/testing/cxl/test/mock.h
+++ b/tools/testing/cxl/test/mock.h
@@ -20,12 +20,11 @@ struct cxl_mock_ops {
 	bool (*is_mock_port)(struct device *dev);
 	bool (*is_mock_dev)(struct device *dev);
 	int (*devm_cxl_port_enumerate_dports)(struct cxl_port *port);
-	struct cxl_hdm *(*devm_cxl_setup_hdm)(
-		struct cxl_port *port, struct cxl_endpoint_dvsec_info *info);
-	int (*devm_cxl_add_passthrough_decoder)(struct cxl_port *port);
-	int (*devm_cxl_enumerate_decoders)(
-		struct cxl_hdm *hdm, struct cxl_endpoint_dvsec_info *info);
+	int (*devm_cxl_switch_port_decoders_setup)(struct cxl_port *port);
+	int (*devm_cxl_endpoint_decoders_setup)(struct cxl_port *port);
 	void (*cxl_endpoint_parse_cdat)(struct cxl_port *port);
+	struct cxl_dport *(*devm_cxl_add_dport_by_dev)(struct cxl_port *port,
+						       struct device *dport_dev);
 };
 
 void register_cxl_mock_ops(struct cxl_mock_ops *ops);
diff --git a/tools/testing/radix-tree/maple.c b/tools/testing/radix-tree/maple.c
index 05714c22994e..5c1b18e3ed21 100644
--- a/tools/testing/radix-tree/maple.c
+++ b/tools/testing/radix-tree/maple.c
@@ -8,14 +8,6 @@
  * difficult to handle in kernel tests.
  */
 
-#define CONFIG_DEBUG_MAPLE_TREE
-#define CONFIG_MAPLE_SEARCH
-#define MAPLE_32BIT (MAPLE_NODE_SLOTS > 31)
-#include "test.h"
-#include <stdlib.h>
-#include <time.h>
-#include <linux/init.h>
-
 #define module_init(x)
 #define module_exit(x)
 #define MODULE_AUTHOR(x)
@@ -23,7 +15,9 @@
 #define MODULE_LICENSE(x)
 #define dump_stack()	assert(0)
 
-#include "../../../lib/maple_tree.c"
+#include "test.h"
+
+#include "../shared/maple-shim.c"
 #include "../../../lib/test_maple_tree.c"
 
 #define RCU_RANGE_COUNT 1000
@@ -63,430 +57,6 @@ struct rcu_reader_struct {
 	struct rcu_test_struct2 *test;
 };
 
-static int get_alloc_node_count(struct ma_state *mas)
-{
-	int count = 1;
-	struct maple_alloc *node = mas->alloc;
-
-	if (!node || ((unsigned long)node & 0x1))
-		return 0;
-	while (node->node_count) {
-		count += node->node_count;
-		node = node->slot[0];
-	}
-	return count;
-}
-
-static void check_mas_alloc_node_count(struct ma_state *mas)
-{
-	mas_node_count_gfp(mas, MAPLE_ALLOC_SLOTS + 1, GFP_KERNEL);
-	mas_node_count_gfp(mas, MAPLE_ALLOC_SLOTS + 3, GFP_KERNEL);
-	MT_BUG_ON(mas->tree, get_alloc_node_count(mas) != mas->alloc->total);
-	mas_destroy(mas);
-}
-
-/*
- * check_new_node() - Check the creation of new nodes and error path
- * verification.
- */
-static noinline void __init check_new_node(struct maple_tree *mt)
-{
-
-	struct maple_node *mn, *mn2, *mn3;
-	struct maple_alloc *smn;
-	struct maple_node *nodes[100];
-	int i, j, total;
-
-	MA_STATE(mas, mt, 0, 0);
-
-	check_mas_alloc_node_count(&mas);
-
-	/* Try allocating 3 nodes */
-	mtree_lock(mt);
-	mt_set_non_kernel(0);
-	/* request 3 nodes to be allocated. */
-	mas_node_count(&mas, 3);
-	/* Allocation request of 3. */
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != 3);
-	/* Allocate failed. */
-	MT_BUG_ON(mt, mas.node != MA_ERROR(-ENOMEM));
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-
-	MT_BUG_ON(mt, mas_allocated(&mas) != 3);
-	mn = mas_pop_node(&mas);
-	MT_BUG_ON(mt, not_empty(mn));
-	MT_BUG_ON(mt, mn == NULL);
-	MT_BUG_ON(mt, mas.alloc == NULL);
-	MT_BUG_ON(mt, mas.alloc->slot[0] == NULL);
-	mas_push_node(&mas, mn);
-	mas_reset(&mas);
-	mas_destroy(&mas);
-	mtree_unlock(mt);
-
-
-	/* Try allocating 1 node, then 2 more */
-	mtree_lock(mt);
-	/* Set allocation request to 1. */
-	mas_set_alloc_req(&mas, 1);
-	/* Check Allocation request of 1. */
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != 1);
-	mas_set_err(&mas, -ENOMEM);
-	/* Validate allocation request. */
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-	/* Eat the requested node. */
-	mn = mas_pop_node(&mas);
-	MT_BUG_ON(mt, not_empty(mn));
-	MT_BUG_ON(mt, mn == NULL);
-	MT_BUG_ON(mt, mn->slot[0] != NULL);
-	MT_BUG_ON(mt, mn->slot[1] != NULL);
-	MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-
-	mn->parent = ma_parent_ptr(mn);
-	ma_free_rcu(mn);
-	mas.status = ma_start;
-	mas_destroy(&mas);
-	/* Allocate 3 nodes, will fail. */
-	mas_node_count(&mas, 3);
-	/* Drop the lock and allocate 3 nodes. */
-	mas_nomem(&mas, GFP_KERNEL);
-	/* Ensure 3 are allocated. */
-	MT_BUG_ON(mt, mas_allocated(&mas) != 3);
-	/* Allocation request of 0. */
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != 0);
-
-	MT_BUG_ON(mt, mas.alloc == NULL);
-	MT_BUG_ON(mt, mas.alloc->slot[0] == NULL);
-	MT_BUG_ON(mt, mas.alloc->slot[1] == NULL);
-	/* Ensure we counted 3. */
-	MT_BUG_ON(mt, mas_allocated(&mas) != 3);
-	/* Free. */
-	mas_reset(&mas);
-	mas_destroy(&mas);
-
-	/* Set allocation request to 1. */
-	mas_set_alloc_req(&mas, 1);
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != 1);
-	mas_set_err(&mas, -ENOMEM);
-	/* Validate allocation request. */
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-	MT_BUG_ON(mt, mas_allocated(&mas) != 1);
-	/* Check the node is only one node. */
-	mn = mas_pop_node(&mas);
-	MT_BUG_ON(mt, not_empty(mn));
-	MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-	MT_BUG_ON(mt, mn == NULL);
-	MT_BUG_ON(mt, mn->slot[0] != NULL);
-	MT_BUG_ON(mt, mn->slot[1] != NULL);
-	MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-	mas_push_node(&mas, mn);
-	MT_BUG_ON(mt, mas_allocated(&mas) != 1);
-	MT_BUG_ON(mt, mas.alloc->node_count);
-
-	mas_set_alloc_req(&mas, 2); /* request 2 more. */
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != 2);
-	mas_set_err(&mas, -ENOMEM);
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-	MT_BUG_ON(mt, mas_allocated(&mas) != 3);
-	MT_BUG_ON(mt, mas.alloc == NULL);
-	MT_BUG_ON(mt, mas.alloc->slot[0] == NULL);
-	MT_BUG_ON(mt, mas.alloc->slot[1] == NULL);
-	for (i = 2; i >= 0; i--) {
-		mn = mas_pop_node(&mas);
-		MT_BUG_ON(mt, mas_allocated(&mas) != i);
-		MT_BUG_ON(mt, !mn);
-		MT_BUG_ON(mt, not_empty(mn));
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-	}
-
-	total = 64;
-	mas_set_alloc_req(&mas, total); /* request 2 more. */
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != total);
-	mas_set_err(&mas, -ENOMEM);
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-	for (i = total; i > 0; i--) {
-		unsigned int e = 0; /* expected node_count */
-
-		if (!MAPLE_32BIT) {
-			if (i >= 35)
-				e = i - 34;
-			else if (i >= 5)
-				e = i - 4;
-			else if (i >= 2)
-				e = i - 1;
-		} else {
-			if (i >= 4)
-				e = i - 3;
-			else if (i >= 1)
-				e = i - 1;
-			else
-				e = 0;
-		}
-
-		MT_BUG_ON(mt, mas.alloc->node_count != e);
-		mn = mas_pop_node(&mas);
-		MT_BUG_ON(mt, not_empty(mn));
-		MT_BUG_ON(mt, mas_allocated(&mas) != i - 1);
-		MT_BUG_ON(mt, !mn);
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-	}
-
-	total = 100;
-	for (i = 1; i < total; i++) {
-		mas_set_alloc_req(&mas, i);
-		mas_set_err(&mas, -ENOMEM);
-		MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-		for (j = i; j > 0; j--) {
-			mn = mas_pop_node(&mas);
-			MT_BUG_ON(mt, mas_allocated(&mas) != j - 1);
-			MT_BUG_ON(mt, !mn);
-			MT_BUG_ON(mt, not_empty(mn));
-			mas_push_node(&mas, mn);
-			MT_BUG_ON(mt, mas_allocated(&mas) != j);
-			mn = mas_pop_node(&mas);
-			MT_BUG_ON(mt, not_empty(mn));
-			MT_BUG_ON(mt, mas_allocated(&mas) != j - 1);
-			mn->parent = ma_parent_ptr(mn);
-			ma_free_rcu(mn);
-		}
-		MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-
-		mas_set_alloc_req(&mas, i);
-		mas_set_err(&mas, -ENOMEM);
-		MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-		for (j = 0; j <= i/2; j++) {
-			MT_BUG_ON(mt, mas_allocated(&mas) != i - j);
-			nodes[j] = mas_pop_node(&mas);
-			MT_BUG_ON(mt, mas_allocated(&mas) != i - j - 1);
-		}
-
-		while (j) {
-			j--;
-			mas_push_node(&mas, nodes[j]);
-			MT_BUG_ON(mt, mas_allocated(&mas) != i - j);
-		}
-		MT_BUG_ON(mt, mas_allocated(&mas) != i);
-		for (j = 0; j <= i/2; j++) {
-			MT_BUG_ON(mt, mas_allocated(&mas) != i - j);
-			mn = mas_pop_node(&mas);
-			MT_BUG_ON(mt, not_empty(mn));
-			mn->parent = ma_parent_ptr(mn);
-			ma_free_rcu(mn);
-			MT_BUG_ON(mt, mas_allocated(&mas) != i - j - 1);
-		}
-		mas_reset(&mas);
-		MT_BUG_ON(mt, mas_nomem(&mas, GFP_KERNEL));
-		mas_destroy(&mas);
-
-	}
-
-	/* Set allocation request. */
-	total = 500;
-	mas_node_count(&mas, total);
-	/* Drop the lock and allocate the nodes. */
-	mas_nomem(&mas, GFP_KERNEL);
-	MT_BUG_ON(mt, !mas.alloc);
-	i = 1;
-	smn = mas.alloc;
-	while (i < total) {
-		for (j = 0; j < MAPLE_ALLOC_SLOTS; j++) {
-			i++;
-			MT_BUG_ON(mt, !smn->slot[j]);
-			if (i == total)
-				break;
-		}
-		smn = smn->slot[0]; /* next. */
-	}
-	MT_BUG_ON(mt, mas_allocated(&mas) != total);
-	mas_reset(&mas);
-	mas_destroy(&mas); /* Free. */
-
-	MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-	for (i = 1; i < 128; i++) {
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		MT_BUG_ON(mt, mas_allocated(&mas) != i); /* check request filled */
-		for (j = i; j > 0; j--) { /*Free the requests */
-			mn = mas_pop_node(&mas); /* get the next node. */
-			MT_BUG_ON(mt, mn == NULL);
-			MT_BUG_ON(mt, not_empty(mn));
-			mn->parent = ma_parent_ptr(mn);
-			ma_free_rcu(mn);
-		}
-		MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-	}
-
-	for (i = 1; i < MAPLE_NODE_MASK + 1; i++) {
-		MA_STATE(mas2, mt, 0, 0);
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		MT_BUG_ON(mt, mas_allocated(&mas) != i); /* check request filled */
-		for (j = 1; j <= i; j++) { /* Move the allocations to mas2 */
-			mn = mas_pop_node(&mas); /* get the next node. */
-			MT_BUG_ON(mt, mn == NULL);
-			MT_BUG_ON(mt, not_empty(mn));
-			mas_push_node(&mas2, mn);
-			MT_BUG_ON(mt, mas_allocated(&mas2) != j);
-		}
-		MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-		MT_BUG_ON(mt, mas_allocated(&mas2) != i);
-
-		for (j = i; j > 0; j--) { /*Free the requests */
-			MT_BUG_ON(mt, mas_allocated(&mas2) != j);
-			mn = mas_pop_node(&mas2); /* get the next node. */
-			MT_BUG_ON(mt, mn == NULL);
-			MT_BUG_ON(mt, not_empty(mn));
-			mn->parent = ma_parent_ptr(mn);
-			ma_free_rcu(mn);
-		}
-		MT_BUG_ON(mt, mas_allocated(&mas2) != 0);
-	}
-
-
-	MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS + 1); /* Request */
-	MT_BUG_ON(mt, mas.node != MA_ERROR(-ENOMEM));
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS + 1);
-	MT_BUG_ON(mt, mas.alloc->node_count != MAPLE_ALLOC_SLOTS);
-
-	mn = mas_pop_node(&mas); /* get the next node. */
-	MT_BUG_ON(mt, mn == NULL);
-	MT_BUG_ON(mt, not_empty(mn));
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS);
-	MT_BUG_ON(mt, mas.alloc->node_count != MAPLE_ALLOC_SLOTS - 1);
-
-	mas_push_node(&mas, mn);
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS + 1);
-	MT_BUG_ON(mt, mas.alloc->node_count != MAPLE_ALLOC_SLOTS);
-
-	/* Check the limit of pop/push/pop */
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS + 2); /* Request */
-	MT_BUG_ON(mt, mas_alloc_req(&mas) != 1);
-	MT_BUG_ON(mt, mas.node != MA_ERROR(-ENOMEM));
-	MT_BUG_ON(mt, !mas_nomem(&mas, GFP_KERNEL));
-	MT_BUG_ON(mt, mas_alloc_req(&mas));
-	MT_BUG_ON(mt, mas.alloc->node_count != 1);
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS + 2);
-	mn = mas_pop_node(&mas);
-	MT_BUG_ON(mt, not_empty(mn));
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS + 1);
-	MT_BUG_ON(mt, mas.alloc->node_count  != MAPLE_ALLOC_SLOTS);
-	mas_push_node(&mas, mn);
-	MT_BUG_ON(mt, mas.alloc->node_count != 1);
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS + 2);
-	mn = mas_pop_node(&mas);
-	MT_BUG_ON(mt, not_empty(mn));
-	mn->parent = ma_parent_ptr(mn);
-	ma_free_rcu(mn);
-	for (i = 1; i <= MAPLE_ALLOC_SLOTS + 1; i++) {
-		mn = mas_pop_node(&mas);
-		MT_BUG_ON(mt, not_empty(mn));
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-	}
-	MT_BUG_ON(mt, mas_allocated(&mas) != 0);
-
-
-	for (i = 3; i < MAPLE_NODE_MASK * 3; i++) {
-		mas.node = MA_ERROR(-ENOMEM);
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mas_push_node(&mas, mn); /* put it back */
-		mas_destroy(&mas);
-
-		mas.node = MA_ERROR(-ENOMEM);
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mn2 = mas_pop_node(&mas); /* get the next node. */
-		mas_push_node(&mas, mn); /* put them back */
-		mas_push_node(&mas, mn2);
-		mas_destroy(&mas);
-
-		mas.node = MA_ERROR(-ENOMEM);
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mn2 = mas_pop_node(&mas); /* get the next node. */
-		mn3 = mas_pop_node(&mas); /* get the next node. */
-		mas_push_node(&mas, mn); /* put them back */
-		mas_push_node(&mas, mn2);
-		mas_push_node(&mas, mn3);
-		mas_destroy(&mas);
-
-		mas.node = MA_ERROR(-ENOMEM);
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-		mas_destroy(&mas);
-
-		mas.node = MA_ERROR(-ENOMEM);
-		mas_node_count(&mas, i); /* Request */
-		mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-		mn = mas_pop_node(&mas); /* get the next node. */
-		mn->parent = ma_parent_ptr(mn);
-		ma_free_rcu(mn);
-		mas_destroy(&mas);
-	}
-
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, 5); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	MT_BUG_ON(mt, mas_allocated(&mas) != 5);
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, 10); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	mas.status = ma_start;
-	MT_BUG_ON(mt, mas_allocated(&mas) != 10);
-	mas_destroy(&mas);
-
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS - 1); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS - 1);
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, 10 + MAPLE_ALLOC_SLOTS - 1); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	mas.status = ma_start;
-	MT_BUG_ON(mt, mas_allocated(&mas) != 10 + MAPLE_ALLOC_SLOTS - 1);
-	mas_destroy(&mas);
-
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS + 1); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS + 1);
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS * 2 + 2); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	mas.status = ma_start;
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS * 2 + 2);
-	mas_destroy(&mas);
-
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS * 2 + 1); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS * 2 + 1);
-	mas.node = MA_ERROR(-ENOMEM);
-	mas_node_count(&mas, MAPLE_ALLOC_SLOTS * 3 + 2); /* Request */
-	mas_nomem(&mas, GFP_KERNEL); /* Fill request */
-	mas.status = ma_start;
-	MT_BUG_ON(mt, mas_allocated(&mas) != MAPLE_ALLOC_SLOTS * 3 + 2);
-	mas_destroy(&mas);
-
-	mtree_unlock(mt);
-}
-
 /*
  * Check erasing including RCU.
  */
@@ -35455,17 +35025,6 @@ static void check_dfs_preorder(struct maple_tree *mt)
 	MT_BUG_ON(mt, count != e);
 	mtree_destroy(mt);
 
-	mt_init_flags(mt, MT_FLAGS_ALLOC_RANGE);
-	mas_reset(&mas);
-	mt_zero_nr_tallocated();
-	mt_set_non_kernel(200);
-	mas_expected_entries(&mas, max);
-	for (count = 0; count <= max; count++) {
-		mas.index = mas.last = count;
-		mas_store(&mas, xa_mk_value(count));
-		MT_BUG_ON(mt, mas_is_err(&mas));
-	}
-	mas_destroy(&mas);
 	rcu_barrier();
 	/*
 	 * pr_info(" ->seq test of 0-%lu %luK in %d active (%d total)\n",
@@ -35524,6 +35083,18 @@ static unsigned char get_vacant_height(struct ma_wr_state *wr_mas, void *entry)
 	return vacant_height;
 }
 
+static int mas_allocated(struct ma_state *mas)
+{
+	int total = 0;
+
+	if (mas->alloc)
+		total++;
+
+	if (mas->sheaf)
+		total += kmem_cache_sheaf_size(mas->sheaf);
+
+	return total;
+}
 /* Preallocation testing */
 static noinline void __init check_prealloc(struct maple_tree *mt)
 {
@@ -35542,7 +35113,10 @@ static noinline void __init check_prealloc(struct maple_tree *mt)
 
 	/* Spanning store */
 	mas_set_range(&mas, 470, 500);
-	MT_BUG_ON(mt, mas_preallocate(&mas, ptr, GFP_KERNEL) != 0);
+
+	mas_wr_preallocate(&wr_mas, ptr);
+	MT_BUG_ON(mt, mas.store_type != wr_spanning_store);
+	MT_BUG_ON(mt, mas_is_err(&mas));
 	allocated = mas_allocated(&mas);
 	height = mas_mt_height(&mas);
 	vacant_height = get_vacant_height(&wr_mas, ptr);
@@ -35552,6 +35126,7 @@ static noinline void __init check_prealloc(struct maple_tree *mt)
 	allocated = mas_allocated(&mas);
 	MT_BUG_ON(mt, allocated != 0);
 
+	mas_wr_preallocate(&wr_mas, ptr);
 	MT_BUG_ON(mt, mas_preallocate(&mas, ptr, GFP_KERNEL) != 0);
 	allocated = mas_allocated(&mas);
 	height = mas_mt_height(&mas);
@@ -35592,20 +35167,6 @@ static noinline void __init check_prealloc(struct maple_tree *mt)
 	mn->parent = ma_parent_ptr(mn);
 	ma_free_rcu(mn);
 
-	MT_BUG_ON(mt, mas_preallocate(&mas, ptr, GFP_KERNEL) != 0);
-	allocated = mas_allocated(&mas);
-	height = mas_mt_height(&mas);
-	vacant_height = get_vacant_height(&wr_mas, ptr);
-	MT_BUG_ON(mt, allocated != 1 + (height - vacant_height) * 3);
-	mn = mas_pop_node(&mas);
-	MT_BUG_ON(mt, mas_allocated(&mas) != allocated - 1);
-	mas_push_node(&mas, mn);
-	MT_BUG_ON(mt, mas_allocated(&mas) != allocated);
-	MT_BUG_ON(mt, mas_preallocate(&mas, ptr, GFP_KERNEL) != 0);
-	mas_destroy(&mas);
-	allocated = mas_allocated(&mas);
-	MT_BUG_ON(mt, allocated != 0);
-
 	MT_BUG_ON(mt, mas_preallocate(&mas, ptr, GFP_KERNEL) != 0);
 	allocated = mas_allocated(&mas);
 	height = mas_mt_height(&mas);
@@ -36411,11 +35972,17 @@ static void check_nomem_writer_race(struct maple_tree *mt)
 	check_load(mt, 6, xa_mk_value(0xC));
 	mtree_unlock(mt);
 
+	mt_set_non_kernel(0);
 	/* test for the same race but with mas_store_gfp() */
 	mtree_store_range(mt, 0, 5, xa_mk_value(0xA), GFP_KERNEL);
 	mtree_store_range(mt, 6, 10, NULL, GFP_KERNEL);
 
 	mas_set_range(&mas, 0, 5);
+
+	/* setup writer 2 that will trigger the race condition */
+	mt_set_private(mt);
+	mt_set_callback(writer2);
+
 	mtree_lock(mt);
 	mas_store_gfp(&mas, NULL, GFP_KERNEL);
 
@@ -36462,27 +36029,6 @@ static inline int check_vma_modification(struct maple_tree *mt)
 	return 0;
 }
 
-/*
- * test to check that bulk stores do not use wr_rebalance as the store
- * type.
- */
-static inline void check_bulk_rebalance(struct maple_tree *mt)
-{
-	MA_STATE(mas, mt, ULONG_MAX, ULONG_MAX);
-	int max = 10;
-
-	build_full_tree(mt, 0, 2);
-
-	/* erase every entry in the tree */
-	do {
-		/* set up bulk store mode */
-		mas_expected_entries(&mas, max);
-		mas_erase(&mas);
-		MT_BUG_ON(mt, mas.store_type == wr_rebalance);
-	} while (mas_prev(&mas, 0) != NULL);
-
-	mas_destroy(&mas);
-}
 
 void farmer_tests(void)
 {
@@ -36495,10 +36041,6 @@ void farmer_tests(void)
 	check_vma_modification(&tree);
 	mtree_destroy(&tree);
 
-	mt_init(&tree);
-	check_bulk_rebalance(&tree);
-	mtree_destroy(&tree);
-
 	tree.ma_root = xa_mk_value(0);
 	mt_dump(&tree, mt_dump_dec);
 
@@ -36558,10 +36100,6 @@ void farmer_tests(void)
 	check_erase_testset(&tree);
 	mtree_destroy(&tree);
 
-	mt_init_flags(&tree, 0);
-	check_new_node(&tree);
-	mtree_destroy(&tree);
-
 	if (!MAPLE_32BIT) {
 		mt_init_flags(&tree, MT_FLAGS_ALLOC_RANGE);
 		check_rcu_simulated(&tree);
diff --git a/tools/testing/selftests/arm64/abi/tpidr2.c b/tools/testing/selftests/arm64/abi/tpidr2.c
index 4c89ab0f1010..1703543fb7c7 100644
--- a/tools/testing/selftests/arm64/abi/tpidr2.c
+++ b/tools/testing/selftests/arm64/abi/tpidr2.c
@@ -182,16 +182,16 @@ static int write_clone_read(void)
 	}
 
 	for (;;) {
-		waiting = wait4(ret, &status, __WCLONE, NULL);
+		waiting = waitpid(ret, &status, __WCLONE);
 
 		if (waiting < 0) {
 			if (errno == EINTR)
 				continue;
-			ksft_print_msg("wait4() failed: %d\n", errno);
+			ksft_print_msg("waitpid() failed: %d\n", errno);
 			return 0;
 		}
 		if (waiting != ret) {
-			ksft_print_msg("wait4() returned wrong PID %d\n",
+			ksft_print_msg("waitpid() returned wrong PID %d\n",
 				       waiting);
 			return 0;
 		}
diff --git a/tools/testing/selftests/iommu/iommufd_utils.h b/tools/testing/selftests/iommu/iommufd_utils.h
index 3c3e08b8c90e..772ca1db6e59 100644
--- a/tools/testing/selftests/iommu/iommufd_utils.h
+++ b/tools/testing/selftests/iommu/iommufd_utils.h
@@ -1042,15 +1042,13 @@ static int _test_cmd_trigger_vevents(int fd, __u32 dev_id, __u32 nvevents)
 			.dev_id = dev_id,
 		},
 	};
-	int ret;
 
 	while (nvevents--) {
-		ret = ioctl(fd, _IOMMU_TEST_CMD(IOMMU_TEST_OP_TRIGGER_VEVENT),
-			    &trigger_vevent_cmd);
-		if (ret < 0)
+		if (!ioctl(fd, _IOMMU_TEST_CMD(IOMMU_TEST_OP_TRIGGER_VEVENT),
+			    &trigger_vevent_cmd))
 			return -1;
 	}
-	return ret;
+	return 0;
 }
 
 #define test_cmd_trigger_vevents(dev_id, nvevents) \
diff --git a/tools/testing/selftests/landlock/fs_test.c b/tools/testing/selftests/landlock/fs_test.c
index fa0f18ec62c4..21dd95aaf5e4 100644
--- a/tools/testing/selftests/landlock/fs_test.c
+++ b/tools/testing/selftests/landlock/fs_test.c
@@ -2267,6 +2267,22 @@ static int test_exchange(const char *const oldpath, const char *const newpath)
 	return 0;
 }
 
+static int test_renameat(int olddirfd, const char *oldpath, int newdirfd,
+			 const char *newpath)
+{
+	if (renameat2(olddirfd, oldpath, newdirfd, newpath, 0))
+		return errno;
+	return 0;
+}
+
+static int test_exchangeat(int olddirfd, const char *oldpath, int newdirfd,
+			   const char *newpath)
+{
+	if (renameat2(olddirfd, oldpath, newdirfd, newpath, RENAME_EXCHANGE))
+		return errno;
+	return 0;
+}
+
 TEST_F_FORK(layout1, rename_file)
 {
 	const struct rule rules[] = {
@@ -4561,6 +4577,18 @@ TEST_F_FORK(ioctl, handle_file_access_file)
 FIXTURE(layout1_bind) {};
 /* clang-format on */
 
+static const char bind_dir_s1d3[] = TMP_DIR "/s2d1/s2d2/s1d3";
+static const char bind_file1_s1d3[] = TMP_DIR "/s2d1/s2d2/s1d3/f1";
+
+/* Move targets for disconnected path tests. */
+static const char dir_s4d1[] = TMP_DIR "/s4d1";
+static const char file1_s4d1[] = TMP_DIR "/s4d1/f1";
+static const char file2_s4d1[] = TMP_DIR "/s4d1/f2";
+static const char dir_s4d2[] = TMP_DIR "/s4d1/s4d2";
+static const char file1_s4d2[] = TMP_DIR "/s4d1/s4d2/f1";
+static const char file1_name[] = "f1";
+static const char file2_name[] = "f2";
+
 FIXTURE_SETUP(layout1_bind)
 {
 	prepare_layout(_metadata);
@@ -4576,14 +4604,14 @@ FIXTURE_TEARDOWN_PARENT(layout1_bind)
 {
 	/* umount(dir_s2d2)) is handled by namespace lifetime. */
 
+	remove_path(file1_s4d1);
+	remove_path(file2_s4d1);
+
 	remove_layout1(_metadata);
 
 	cleanup_layout(_metadata);
 }
 
-static const char bind_dir_s1d3[] = TMP_DIR "/s2d1/s2d2/s1d3";
-static const char bind_file1_s1d3[] = TMP_DIR "/s2d1/s2d2/s1d3/f1";
-
 /*
  * layout1_bind hierarchy:
  *
@@ -4806,6 +4834,1289 @@ TEST_F_FORK(layout1_bind, reparent_cross_mount)
 	ASSERT_EQ(0, rename(bind_file1_s1d3, file1_s2d2));
 }
 
+/*
+ * Make sure access to file through a disconnected path works as expected.
+ * This test moves s1d3 to s4d1.
+ */
+TEST_F_FORK(layout1_bind, path_disconnected)
+{
+	const struct rule layer1_allow_all[] = {
+		{
+			.path = TMP_DIR,
+			.access = ACCESS_ALL,
+		},
+		{},
+	};
+	const struct rule layer2_allow_just_f1[] = {
+		{
+			.path = file1_s1d3,
+			.access = LANDLOCK_ACCESS_FS_READ_FILE,
+		},
+		{},
+	};
+	const struct rule layer3_only_s1d2[] = {
+		{
+			.path = dir_s1d2,
+			.access = LANDLOCK_ACCESS_FS_READ_FILE,
+		},
+		{},
+	};
+
+	/* Landlock should not deny access just because it is disconnected. */
+	int ruleset_fd_l1 =
+		create_ruleset(_metadata, ACCESS_ALL, layer1_allow_all);
+
+	/* Creates the new ruleset now before we move the dir containing the file. */
+	int ruleset_fd_l2 =
+		create_ruleset(_metadata, ACCESS_RW, layer2_allow_just_f1);
+	int ruleset_fd_l3 =
+		create_ruleset(_metadata, ACCESS_RW, layer3_only_s1d2);
+	int bind_s1d3_fd;
+
+	ASSERT_LE(0, ruleset_fd_l1);
+	ASSERT_LE(0, ruleset_fd_l2);
+	ASSERT_LE(0, ruleset_fd_l3);
+
+	enforce_ruleset(_metadata, ruleset_fd_l1);
+	EXPECT_EQ(0, close(ruleset_fd_l1));
+
+	bind_s1d3_fd = open(bind_dir_s1d3, O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, bind_s1d3_fd);
+
+	/* Tests access is possible before we move. */
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file2_name, O_RDONLY));
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, "..", O_RDONLY | O_DIRECTORY));
+
+	/* Makes it disconnected. */
+	ASSERT_EQ(0, rename(dir_s1d3, dir_s4d1))
+	{
+		TH_LOG("Failed to rename %s to %s: %s", dir_s1d3, dir_s4d1,
+		       strerror(errno));
+	}
+
+	/* Tests that access is still possible. */
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file2_name, O_RDONLY));
+
+	/*
+	 * Tests that ".." is not possible (not because of Landlock, but just
+	 * because it's disconnected).
+	 */
+	EXPECT_EQ(ENOENT,
+		  test_open_rel(bind_s1d3_fd, "..", O_RDONLY | O_DIRECTORY));
+
+	/* This should still work with a narrower rule. */
+	enforce_ruleset(_metadata, ruleset_fd_l2);
+	EXPECT_EQ(0, close(ruleset_fd_l2));
+
+	EXPECT_EQ(0, test_open(file1_s4d1, O_RDONLY));
+	/*
+	 * Accessing a file through a disconnected file descriptor is not allowed
+	 * when it is no longer visible in its mount point.
+	 */
+	EXPECT_EQ(EACCES, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+	EXPECT_EQ(EACCES, test_open_rel(bind_s1d3_fd, file2_name, O_RDONLY));
+
+	/*
+	 * But if we only allow access to under the original dir, then it
+	 * should be denied.
+	 */
+	enforce_ruleset(_metadata, ruleset_fd_l3);
+	EXPECT_EQ(0, close(ruleset_fd_l3));
+	EXPECT_EQ(EACCES, test_open(file1_s4d1, O_RDONLY));
+	EXPECT_EQ(EACCES, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+	EXPECT_EQ(EACCES, test_open_rel(bind_s1d3_fd, file2_name, O_RDONLY));
+}
+
+/*
+ * Test that renameat with disconnected paths works under Landlock.  This test
+ * moves s1d3 to s4d2, so that we can have a rule allowing refers on the move
+ * target's immediate parent.
+ */
+TEST_F_FORK(layout1_bind, path_disconnected_rename)
+{
+	const struct rule layer1[] = {
+		{
+			.path = dir_s1d2,
+			.access = LANDLOCK_ACCESS_FS_REFER |
+				  LANDLOCK_ACCESS_FS_MAKE_DIR |
+				  LANDLOCK_ACCESS_FS_REMOVE_DIR |
+				  LANDLOCK_ACCESS_FS_MAKE_REG |
+				  LANDLOCK_ACCESS_FS_REMOVE_FILE |
+				  LANDLOCK_ACCESS_FS_READ_FILE,
+		},
+		{
+			.path = dir_s4d1,
+			.access = LANDLOCK_ACCESS_FS_REFER |
+				  LANDLOCK_ACCESS_FS_MAKE_DIR |
+				  LANDLOCK_ACCESS_FS_REMOVE_DIR |
+				  LANDLOCK_ACCESS_FS_MAKE_REG |
+				  LANDLOCK_ACCESS_FS_REMOVE_FILE |
+				  LANDLOCK_ACCESS_FS_READ_FILE,
+		},
+		{}
+	};
+
+	/* This layer only handles LANDLOCK_ACCESS_FS_READ_FILE. */
+	const struct rule layer2_only_s1d2[] = {
+		{
+			.path = dir_s1d2,
+			.access = LANDLOCK_ACCESS_FS_READ_FILE,
+		},
+		{},
+	};
+	int ruleset_fd_l1, ruleset_fd_l2;
+	pid_t child_pid;
+	int bind_s1d3_fd, status;
+
+	ASSERT_EQ(0, mkdir(dir_s4d1, 0755))
+	{
+		TH_LOG("Failed to create %s: %s", dir_s4d1, strerror(errno));
+	}
+	ruleset_fd_l1 = create_ruleset(_metadata, ACCESS_ALL, layer1);
+	ruleset_fd_l2 = create_ruleset(_metadata, LANDLOCK_ACCESS_FS_READ_FILE,
+				       layer2_only_s1d2);
+	ASSERT_LE(0, ruleset_fd_l1);
+	ASSERT_LE(0, ruleset_fd_l2);
+
+	enforce_ruleset(_metadata, ruleset_fd_l1);
+	EXPECT_EQ(0, close(ruleset_fd_l1));
+
+	bind_s1d3_fd = open(bind_dir_s1d3, O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, bind_s1d3_fd);
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+
+	/* Tests ENOENT priority over EACCES for disconnected directory. */
+	EXPECT_EQ(EACCES, test_open_rel(bind_s1d3_fd, "..", O_DIRECTORY));
+	ASSERT_EQ(0, rename(dir_s1d3, dir_s4d2))
+	{
+		TH_LOG("Failed to rename %s to %s: %s", dir_s1d3, dir_s4d2,
+		       strerror(errno));
+	}
+	EXPECT_EQ(ENOENT, test_open_rel(bind_s1d3_fd, "..", O_DIRECTORY));
+
+	/*
+	 * The file is no longer under s1d2 but we should still be able to access it
+	 * with layer 2 because its mount point is evaluated as the first valid
+	 * directory because it was initially a parent.  Do a fork to test this so
+	 * we don't prevent ourselves from renaming it back later.
+	 */
+	child_pid = fork();
+	ASSERT_LE(0, child_pid);
+	if (child_pid == 0) {
+		enforce_ruleset(_metadata, ruleset_fd_l2);
+		EXPECT_EQ(0, close(ruleset_fd_l2));
+		EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+		EXPECT_EQ(EACCES, test_open(file1_s4d2, O_RDONLY));
+
+		/*
+		 * Tests that access widening checks indeed prevents us from renaming it
+		 * back.
+		 */
+		EXPECT_EQ(-1, rename(dir_s4d2, dir_s1d3));
+		EXPECT_EQ(EXDEV, errno);
+
+		/*
+		 * Including through the now disconnected fd (but it should return
+		 * EXDEV).
+		 */
+		EXPECT_EQ(-1, renameat(bind_s1d3_fd, file1_name, AT_FDCWD,
+				       file1_s2d2));
+		EXPECT_EQ(EXDEV, errno);
+		_exit(_metadata->exit_code);
+		return;
+	}
+
+	EXPECT_EQ(child_pid, waitpid(child_pid, &status, 0));
+	EXPECT_EQ(1, WIFEXITED(status));
+	EXPECT_EQ(EXIT_SUCCESS, WEXITSTATUS(status));
+
+	ASSERT_EQ(0, rename(dir_s4d2, dir_s1d3))
+	{
+		TH_LOG("Failed to rename %s back to %s: %s", dir_s4d1, dir_s1d3,
+		       strerror(errno));
+	}
+
+	/* Now checks that we can access it under l2. */
+	child_pid = fork();
+	ASSERT_LE(0, child_pid);
+	if (child_pid == 0) {
+		enforce_ruleset(_metadata, ruleset_fd_l2);
+		EXPECT_EQ(0, close(ruleset_fd_l2));
+		EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+		EXPECT_EQ(0, test_open(file1_s1d3, O_RDONLY));
+		_exit(_metadata->exit_code);
+		return;
+	}
+
+	EXPECT_EQ(child_pid, waitpid(child_pid, &status, 0));
+	EXPECT_EQ(1, WIFEXITED(status));
+	EXPECT_EQ(EXIT_SUCCESS, WEXITSTATUS(status));
+
+	/*
+	 * Also test that we can rename via a disconnected path.  We move the
+	 * dir back to the disconnected place first, then we rename file1 to
+	 * file2 through our dir fd.
+	 */
+	ASSERT_EQ(0, rename(dir_s1d3, dir_s4d2))
+	{
+		TH_LOG("Failed to rename %s to %s: %s", dir_s1d3, dir_s4d2,
+		       strerror(errno));
+	}
+	ASSERT_EQ(0,
+		  renameat(bind_s1d3_fd, file1_name, bind_s1d3_fd, file2_name))
+	{
+		TH_LOG("Failed to rename %s to %s within disconnected %s: %s",
+		       file1_name, file2_name, bind_dir_s1d3, strerror(errno));
+	}
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file2_name, O_RDONLY));
+	ASSERT_EQ(0, renameat(bind_s1d3_fd, file2_name, AT_FDCWD, file1_s2d2))
+	{
+		TH_LOG("Failed to rename %s to %s through disconnected %s: %s",
+		       file2_name, file1_s2d2, bind_dir_s1d3, strerror(errno));
+	}
+	EXPECT_EQ(0, test_open(file1_s2d2, O_RDONLY));
+	EXPECT_EQ(0, test_open(file1_s1d2, O_RDONLY));
+
+	/* Move it back using the disconnected path as the target. */
+	ASSERT_EQ(0, renameat(AT_FDCWD, file1_s2d2, bind_s1d3_fd, file1_name))
+	{
+		TH_LOG("Failed to rename %s to %s through disconnected %s: %s",
+		       file1_s1d2, file1_name, bind_dir_s1d3, strerror(errno));
+	}
+
+	/* Now make it connected again. */
+	ASSERT_EQ(0, rename(dir_s4d2, dir_s1d3))
+	{
+		TH_LOG("Failed to rename %s back to %s: %s", dir_s4d2, dir_s1d3,
+		       strerror(errno));
+	}
+
+	/* Checks again that we can access it under l2. */
+	enforce_ruleset(_metadata, ruleset_fd_l2);
+	EXPECT_EQ(0, close(ruleset_fd_l2));
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+	EXPECT_EQ(0, test_open(file1_s1d3, O_RDONLY));
+}
+
+/*
+ * Test that linkat(2) with disconnected paths works under Landlock. This
+ * test moves s1d3 to s4d1.
+ */
+TEST_F_FORK(layout1_bind, path_disconnected_link)
+{
+	/* Ruleset to be applied after renaming s1d3 to s4d1. */
+	const struct rule layer1[] = {
+		{
+			.path = dir_s4d1,
+			.access = LANDLOCK_ACCESS_FS_REFER |
+				  LANDLOCK_ACCESS_FS_READ_FILE |
+				  LANDLOCK_ACCESS_FS_MAKE_REG |
+				  LANDLOCK_ACCESS_FS_REMOVE_FILE,
+		},
+		{
+			.path = dir_s2d2,
+			.access = LANDLOCK_ACCESS_FS_REFER |
+				  LANDLOCK_ACCESS_FS_READ_FILE |
+				  LANDLOCK_ACCESS_FS_MAKE_REG |
+				  LANDLOCK_ACCESS_FS_REMOVE_FILE,
+		},
+		{}
+	};
+	int ruleset_fd, bind_s1d3_fd;
+
+	/* Removes unneeded files created by layout1, otherwise it will EEXIST. */
+	ASSERT_EQ(0, unlink(file1_s1d2));
+	ASSERT_EQ(0, unlink(file2_s1d3));
+
+	bind_s1d3_fd = open(bind_dir_s1d3, O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, bind_s1d3_fd);
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY));
+
+	/* Disconnects bind_s1d3_fd. */
+	ASSERT_EQ(0, rename(dir_s1d3, dir_s4d1))
+	{
+		TH_LOG("Failed to rename %s to %s: %s", dir_s1d3, dir_s4d1,
+		       strerror(errno));
+	}
+
+	/* Need this later to test different parent link. */
+	ASSERT_EQ(0, mkdir(dir_s4d2, 0755))
+	{
+		TH_LOG("Failed to create %s: %s", dir_s4d2, strerror(errno));
+	}
+
+	ruleset_fd = create_ruleset(_metadata, ACCESS_ALL, layer1);
+	ASSERT_LE(0, ruleset_fd);
+	enforce_ruleset(_metadata, ruleset_fd);
+	EXPECT_EQ(0, close(ruleset_fd));
+
+	/* From disconnected to connected. */
+	ASSERT_EQ(0, linkat(bind_s1d3_fd, file1_name, AT_FDCWD, file1_s2d2, 0))
+	{
+		TH_LOG("Failed to link %s to %s via disconnected %s: %s",
+		       file1_name, file1_s2d2, bind_dir_s1d3, strerror(errno));
+	}
+
+	/* Tests that we can access via the new link... */
+	EXPECT_EQ(0, test_open(file1_s2d2, O_RDONLY))
+	{
+		TH_LOG("Failed to open newly linked %s: %s", file1_s2d2,
+		       strerror(errno));
+	}
+
+	/* ...as well as the old one. */
+	EXPECT_EQ(0, test_open(file1_s4d1, O_RDONLY))
+	{
+		TH_LOG("Failed to open original %s: %s", file1_s4d1,
+		       strerror(errno));
+	}
+
+	/* From connected to disconnected. */
+	ASSERT_EQ(0, unlink(file1_s4d1));
+	ASSERT_EQ(0, linkat(AT_FDCWD, file1_s2d2, bind_s1d3_fd, file2_name, 0))
+	{
+		TH_LOG("Failed to link %s to %s via disconnected %s: %s",
+		       file1_s2d2, file2_name, bind_dir_s1d3, strerror(errno));
+	}
+	EXPECT_EQ(0, test_open(file2_s4d1, O_RDONLY));
+	ASSERT_EQ(0, unlink(file1_s2d2));
+
+	/* From disconnected to disconnected (same parent). */
+	ASSERT_EQ(0,
+		  linkat(bind_s1d3_fd, file2_name, bind_s1d3_fd, file1_name, 0))
+	{
+		TH_LOG("Failed to link %s to %s within disconnected %s: %s",
+		       file2_name, file1_name, bind_dir_s1d3, strerror(errno));
+	}
+	EXPECT_EQ(0, test_open(file1_s4d1, O_RDONLY))
+	{
+		TH_LOG("Failed to open newly linked %s: %s", file1_s4d1,
+		       strerror(errno));
+	}
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, file1_name, O_RDONLY))
+	{
+		TH_LOG("Failed to open %s through newly created link under disconnected path: %s",
+		       file1_name, strerror(errno));
+	}
+	ASSERT_EQ(0, unlink(file2_s4d1));
+
+	/* From disconnected to disconnected (different parent). */
+	ASSERT_EQ(0,
+		  linkat(bind_s1d3_fd, file1_name, bind_s1d3_fd, "s4d2/f1", 0))
+	{
+		TH_LOG("Failed to link %s to %s within disconnected %s: %s",
+		       file1_name, "s4d2/f1", bind_dir_s1d3, strerror(errno));
+	}
+	EXPECT_EQ(0, test_open(file1_s4d2, O_RDONLY))
+	{
+		TH_LOG("Failed to open %s after link: %s", file1_s4d2,
+		       strerror(errno));
+	}
+	EXPECT_EQ(0, test_open_rel(bind_s1d3_fd, "s4d2/f1", O_RDONLY))
+	{
+		TH_LOG("Failed to open %s through disconnected path after link: %s",
+		       "s4d2/f1", strerror(errno));
+	}
+}
+
+/*
+ * layout4_disconnected_leafs with bind mount and renames:
+ *
+ * tmp
+ * ├── s1d1
+ * │   └── s1d2 [source of the bind mount]
+ * │       ├── s1d31
+ * │       │   └── s1d41 [now renamed beneath s3d1]
+ * │       │       ├── f1
+ * │       │       └── f2
+ * │       └── s1d32
+ * │           └── s1d42 [now renamed beneath s4d1]
+ * │               ├── f3
+ * │               └── f4
+ * ├── s2d1
+ * │   └── s2d2 [bind mount of s1d2]
+ * │       ├── s1d31
+ * │       │   └── s1d41 [opened FD, now renamed beneath s3d1]
+ * │       │       ├── f1
+ * │       │       └── f2
+ * │       └── s1d32
+ * │           └── s1d42 [opened FD, now renamed beneath s4d1]
+ * │               ├── f3
+ * │               └── f4
+ * ├── s3d1
+ * │   └── s1d41 [renamed here]
+ * │       ├── f1
+ * │       └── f2
+ * └── s4d1
+ *     └── s1d42 [renamed here]
+ *         ├── f3
+ *         └── f4
+ */
+/* clang-format off */
+FIXTURE(layout4_disconnected_leafs) {
+	int s2d2_fd;
+};
+/* clang-format on */
+
+FIXTURE_SETUP(layout4_disconnected_leafs)
+{
+	prepare_layout(_metadata);
+
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d31/s1d41/f1");
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d31/s1d41/f2");
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d32/s1d42/f3");
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d32/s1d42/f4");
+	create_directory(_metadata, TMP_DIR "/s2d1/s2d2");
+	create_directory(_metadata, TMP_DIR "/s3d1");
+	create_directory(_metadata, TMP_DIR "/s4d1");
+
+	self->s2d2_fd =
+		open(TMP_DIR "/s2d1/s2d2", O_DIRECTORY | O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, self->s2d2_fd);
+
+	set_cap(_metadata, CAP_SYS_ADMIN);
+	ASSERT_EQ(0, mount(TMP_DIR "/s1d1/s1d2", TMP_DIR "/s2d1/s2d2", NULL,
+			   MS_BIND, NULL));
+	clear_cap(_metadata, CAP_SYS_ADMIN);
+}
+
+FIXTURE_TEARDOWN_PARENT(layout4_disconnected_leafs)
+{
+	/* umount(TMP_DIR "/s2d1") is handled by namespace lifetime. */
+
+	/* Removes files after renames. */
+	remove_path(TMP_DIR "/s3d1/s1d41/f1");
+	remove_path(TMP_DIR "/s3d1/s1d41/f2");
+	remove_path(TMP_DIR "/s4d1/s1d42/f1");
+	remove_path(TMP_DIR "/s4d1/s1d42/f3");
+	remove_path(TMP_DIR "/s4d1/s1d42/f4");
+	remove_path(TMP_DIR "/s4d1/s1d42/f5");
+
+	cleanup_layout(_metadata);
+}
+
+FIXTURE_VARIANT(layout4_disconnected_leafs)
+{
+	/*
+	 * Parent of the bind mount source.  It should always be ignored when
+	 * testing against files under the s1d41 or s1d42 disconnected directories.
+	 */
+	const __u64 allowed_s1d1;
+	/*
+	 * Source of bind mount (to s2d2).  It should always be enforced when
+	 * testing against files under the s1d41 or s1d42 disconnected directories.
+	 */
+	const __u64 allowed_s1d2;
+	/*
+	 * Original parent of s1d41.  It should always be ignored when testing
+	 * against files under the s1d41 disconnected directory.
+	 */
+	const __u64 allowed_s1d31;
+	/*
+	 * Original parent of s1d42.  It should always be ignored when testing
+	 * against files under the s1d42 disconnected directory.
+	 */
+	const __u64 allowed_s1d32;
+	/*
+	 * Opened and disconnected source directory.  It should always be enforced
+	 * when testing against files under the s1d41 disconnected directory.
+	 */
+	const __u64 allowed_s1d41;
+	/*
+	 * Opened and disconnected source directory.  It should always be enforced
+	 * when testing against files under the s1d42 disconnected directory.
+	 */
+	const __u64 allowed_s1d42;
+	/*
+	 * File in the s1d41 disconnected directory.  It should always be enforced
+	 * when testing against itself under the s1d41 disconnected directory.
+	 */
+	const __u64 allowed_f1;
+	/*
+	 * File in the s1d41 disconnected directory.  It should always be enforced
+	 * when testing against itself under the s1d41 disconnected directory.
+	 */
+	const __u64 allowed_f2;
+	/*
+	 * File in the s1d42 disconnected directory.  It should always be enforced
+	 * when testing against itself under the s1d42 disconnected directory.
+	 */
+	const __u64 allowed_f3;
+	/*
+	 * Parent of the bind mount destination.  It should always be enforced when
+	 * testing against files under the s1d41 or s1d42 disconnected directories.
+	 */
+	const __u64 allowed_s2d1;
+	/*
+	 * Directory covered by the bind mount.  It should always be ignored when
+	 * testing against files under the s1d41 or s1d42 disconnected directories.
+	 */
+	const __u64 allowed_s2d2;
+	/*
+	 * New parent of the renamed s1d41.  It should always be ignored when
+	 * testing against files under the s1d41 disconnected directory.
+	 */
+	const __u64 allowed_s3d1;
+	/*
+	 * New parent of the renamed s1d42.  It should always be ignored when
+	 * testing against files under the s1d42 disconnected directory.
+	 */
+	const __u64 allowed_s4d1;
+
+	/* Expected result of the call to open([fd:s1d41]/f1, O_RDONLY). */
+	const int expected_read_result;
+	/* Expected result of the call to renameat([fd:s1d41]/f1, [fd:s1d42]/f1). */
+	const int expected_rename_result;
+	/*
+	 * Expected result of the call to renameat([fd:s1d41]/f2, [fd:s1d42]/f3,
+	 * RENAME_EXCHANGE).
+	 */
+	const int expected_exchange_result;
+	/* Expected result of the call to renameat([fd:s1d42]/f4, [fd:s1d42]/f5). */
+	const int expected_same_dir_rename_result;
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s1d1_mount_src_parent) {
+	/* clang-format on */
+	.allowed_s1d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s1d2_mount_src_refer) {
+	/* clang-format on */
+	.allowed_s1d2 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s1d2_mount_src_create) {
+	/* clang-format on */
+	.allowed_s1d2 = LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = EXDEV,
+	.expected_exchange_result = EXDEV,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s1d2_mount_src_rename) {
+	/* clang-format on */
+	.allowed_s1d2 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s1d31_s1d32_old_parent) {
+	/* clang-format on */
+	.allowed_s1d31 = LANDLOCK_ACCESS_FS_REFER |
+			 LANDLOCK_ACCESS_FS_READ_FILE |
+			 LANDLOCK_ACCESS_FS_EXECUTE |
+			 LANDLOCK_ACCESS_FS_MAKE_REG,
+	.allowed_s1d32 = LANDLOCK_ACCESS_FS_REFER |
+			 LANDLOCK_ACCESS_FS_READ_FILE |
+			 LANDLOCK_ACCESS_FS_EXECUTE |
+			 LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s1d41_s1d42_disconnected) {
+	/* clang-format on */
+	.allowed_s1d41 = LANDLOCK_ACCESS_FS_REFER |
+			 LANDLOCK_ACCESS_FS_READ_FILE |
+			 LANDLOCK_ACCESS_FS_EXECUTE |
+			 LANDLOCK_ACCESS_FS_MAKE_REG,
+	.allowed_s1d42 = LANDLOCK_ACCESS_FS_REFER |
+			 LANDLOCK_ACCESS_FS_READ_FILE |
+			 LANDLOCK_ACCESS_FS_EXECUTE |
+			 LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s2d1_mount_dst_parent_create) {
+	/* clang-format on */
+	.allowed_s2d1 = LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = EXDEV,
+	.expected_exchange_result = EXDEV,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s2d1_mount_dst_parent_refer) {
+	/* clang-format on */
+	.allowed_s2d1 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s2d1_mount_dst_parent_mini) {
+	/* clang-format on */
+	.allowed_s2d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s2d2_covered_by_mount) {
+	/* clang-format on */
+	.allowed_s2d2 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* Tests collect_domain_accesses(). */
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, s3d1_s4d1_new_parent) {
+	/* clang-format on */
+	.allowed_s3d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.allowed_s4d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout4_disconnected_leafs, f1_f2_f3) {
+	/* clang-format on */
+	.allowed_f1 = LANDLOCK_ACCESS_FS_READ_FILE,
+	.allowed_f2 = LANDLOCK_ACCESS_FS_READ_FILE,
+	.allowed_f3 = LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+TEST_F_FORK(layout4_disconnected_leafs, read_rename_exchange)
+{
+	const __u64 handled_access =
+		LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE |
+		LANDLOCK_ACCESS_FS_EXECUTE | LANDLOCK_ACCESS_FS_MAKE_REG;
+	const struct rule rules[] = {
+		{
+			.path = TMP_DIR "/s1d1",
+			.access = variant->allowed_s1d1,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2",
+			.access = variant->allowed_s1d2,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d31",
+			.access = variant->allowed_s1d31,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d32",
+			.access = variant->allowed_s1d32,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d31/s1d41",
+			.access = variant->allowed_s1d41,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d32/s1d42",
+			.access = variant->allowed_s1d42,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d31/s1d41/f1",
+			.access = variant->allowed_f1,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d31/s1d41/f2",
+			.access = variant->allowed_f2,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d32/s1d42/f3",
+			.access = variant->allowed_f3,
+		},
+		{
+			.path = TMP_DIR "/s2d1",
+			.access = variant->allowed_s2d1,
+		},
+		/* s2d2_fd */
+		{
+			.path = TMP_DIR "/s3d1",
+			.access = variant->allowed_s3d1,
+		},
+		{
+			.path = TMP_DIR "/s4d1",
+			.access = variant->allowed_s4d1,
+		},
+		{},
+	};
+	int ruleset_fd, s1d41_bind_fd, s1d42_bind_fd;
+
+	ruleset_fd = create_ruleset(_metadata, handled_access, rules);
+	ASSERT_LE(0, ruleset_fd);
+
+	/* Adds rule for the covered directory. */
+	if (variant->allowed_s2d2) {
+		ASSERT_EQ(0, landlock_add_rule(
+				     ruleset_fd, LANDLOCK_RULE_PATH_BENEATH,
+				     &(struct landlock_path_beneath_attr){
+					     .parent_fd = self->s2d2_fd,
+					     .allowed_access =
+						     variant->allowed_s2d2,
+				     },
+				     0));
+	}
+	EXPECT_EQ(0, close(self->s2d2_fd));
+
+	s1d41_bind_fd = open(TMP_DIR "/s2d1/s2d2/s1d31/s1d41",
+			     O_DIRECTORY | O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, s1d41_bind_fd);
+	s1d42_bind_fd = open(TMP_DIR "/s2d1/s2d2/s1d32/s1d42",
+			     O_DIRECTORY | O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, s1d42_bind_fd);
+
+	/* Disconnects and checks source and destination directories. */
+	EXPECT_EQ(0, test_open_rel(s1d41_bind_fd, "..", O_DIRECTORY));
+	EXPECT_EQ(0, test_open_rel(s1d42_bind_fd, "..", O_DIRECTORY));
+	/* Renames to make it accessible through s3d1/s1d41 */
+	ASSERT_EQ(0, test_renameat(AT_FDCWD, TMP_DIR "/s1d1/s1d2/s1d31/s1d41",
+				   AT_FDCWD, TMP_DIR "/s3d1/s1d41"));
+	/* Renames to make it accessible through s4d1/s1d42 */
+	ASSERT_EQ(0, test_renameat(AT_FDCWD, TMP_DIR "/s1d1/s1d2/s1d32/s1d42",
+				   AT_FDCWD, TMP_DIR "/s4d1/s1d42"));
+	EXPECT_EQ(ENOENT, test_open_rel(s1d41_bind_fd, "..", O_DIRECTORY));
+	EXPECT_EQ(ENOENT, test_open_rel(s1d42_bind_fd, "..", O_DIRECTORY));
+
+	enforce_ruleset(_metadata, ruleset_fd);
+	EXPECT_EQ(0, close(ruleset_fd));
+
+	EXPECT_EQ(variant->expected_read_result,
+		  test_open_rel(s1d41_bind_fd, "f1", O_RDONLY));
+
+	EXPECT_EQ(variant->expected_rename_result,
+		  test_renameat(s1d41_bind_fd, "f1", s1d42_bind_fd, "f1"));
+	EXPECT_EQ(variant->expected_exchange_result,
+		  test_exchangeat(s1d41_bind_fd, "f2", s1d42_bind_fd, "f3"));
+
+	EXPECT_EQ(variant->expected_same_dir_rename_result,
+		  test_renameat(s1d42_bind_fd, "f4", s1d42_bind_fd, "f5"));
+}
+
+/*
+ * layout5_disconnected_branch before rename:
+ *
+ * tmp
+ * ├── s1d1
+ * │   └── s1d2 [source of the first bind mount]
+ * │       └── s1d3
+ * │           ├── s1d41
+ * │           │   ├── f1
+ * │           │   └── f2
+ * │           └── s1d42
+ * │               ├── f3
+ * │               └── f4
+ * ├── s2d1
+ * │   └── s2d2 [source of the second bind mount]
+ * │       └── s2d3
+ * │           └── s2d4 [first s1d2 bind mount]
+ * │               └── s1d3
+ * │                   ├── s1d41
+ * │                   │   ├── f1
+ * │                   │   └── f2
+ * │                   └── s1d42
+ * │                       ├── f3
+ * │                       └── f4
+ * ├── s3d1
+ * │   └── s3d2 [second s2d2 bind mount]
+ * │       └── s2d3
+ * │           └── s2d4 [first s1d2 bind mount]
+ * │               └── s1d3
+ * │                   ├── s1d41
+ * │                   │   ├── f1
+ * │                   │   └── f2
+ * │                   └── s1d42
+ * │                       ├── f3
+ * │                       └── f4
+ * └── s4d1
+ *
+ * After rename:
+ *
+ * tmp
+ * ├── s1d1
+ * │   └── s1d2 [source of the first bind mount]
+ * │       └── s1d3
+ * │           ├── s1d41
+ * │           │   ├── f1
+ * │           │   └── f2
+ * │           └── s1d42
+ * │               ├── f3
+ * │               └── f4
+ * ├── s2d1
+ * │   └── s2d2 [source of the second bind mount]
+ * ├── s3d1
+ * │   └── s3d2 [second s2d2 bind mount]
+ * └── s4d1
+ *     └── s2d3 [renamed here]
+ *         └── s2d4 [first s1d2 bind mount]
+ *             └── s1d3
+ *                 ├── s1d41
+ *                 │   ├── f1
+ *                 │   └── f2
+ *                 └── s1d42
+ *                     ├── f3
+ *                     └── f4
+ *
+ * Decision path: s1d3 -> s1d2 -> s2d2 -> s3d1 -> tmp
+ * s2d3 is ignored, as well as the directories under the mount points.
+ */
+
+/* clang-format off */
+FIXTURE(layout5_disconnected_branch) {
+	int s2d4_fd, s3d2_fd;
+};
+/* clang-format on */
+
+FIXTURE_SETUP(layout5_disconnected_branch)
+{
+	prepare_layout(_metadata);
+
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d3/s1d41/f1");
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d3/s1d41/f2");
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d3/s1d42/f3");
+	create_file(_metadata, TMP_DIR "/s1d1/s1d2/s1d3/s1d42/f4");
+	create_directory(_metadata, TMP_DIR "/s2d1/s2d2/s2d3/s2d4");
+	create_directory(_metadata, TMP_DIR "/s3d1/s3d2");
+	create_directory(_metadata, TMP_DIR "/s4d1");
+
+	self->s2d4_fd = open(TMP_DIR "/s2d1/s2d2/s2d3/s2d4",
+			     O_DIRECTORY | O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, self->s2d4_fd);
+
+	self->s3d2_fd =
+		open(TMP_DIR "/s3d1/s3d2", O_DIRECTORY | O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, self->s3d2_fd);
+
+	set_cap(_metadata, CAP_SYS_ADMIN);
+	ASSERT_EQ(0, mount(TMP_DIR "/s1d1/s1d2", TMP_DIR "/s2d1/s2d2/s2d3/s2d4",
+			   NULL, MS_BIND, NULL));
+	ASSERT_EQ(0, mount(TMP_DIR "/s2d1/s2d2", TMP_DIR "/s3d1/s3d2", NULL,
+			   MS_BIND | MS_REC, NULL));
+	clear_cap(_metadata, CAP_SYS_ADMIN);
+}
+
+FIXTURE_TEARDOWN_PARENT(layout5_disconnected_branch)
+{
+	/* Bind mounts are handled by namespace lifetime. */
+
+	/* Removes files after renames. */
+	remove_path(TMP_DIR "/s1d1/s1d2/s1d3/s1d41/f1");
+	remove_path(TMP_DIR "/s1d1/s1d2/s1d3/s1d41/f2");
+	remove_path(TMP_DIR "/s1d1/s1d2/s1d3/s1d42/f1");
+	remove_path(TMP_DIR "/s1d1/s1d2/s1d3/s1d42/f3");
+	remove_path(TMP_DIR "/s1d1/s1d2/s1d3/s1d42/f4");
+	remove_path(TMP_DIR "/s1d1/s1d2/s1d3/s1d42/f5");
+
+	cleanup_layout(_metadata);
+}
+
+FIXTURE_VARIANT(layout5_disconnected_branch)
+{
+	/*
+	 * Parent of all files.  It should always be enforced when testing against
+	 * files under the s1d41 or s1d42 disconnected directories.
+	 */
+	const __u64 allowed_base;
+	/*
+	 * Parent of the first bind mount source.  It should always be ignored when
+	 * testing against files under the s1d41 or s1d42 disconnected directories.
+	 */
+	const __u64 allowed_s1d1;
+	const __u64 allowed_s1d2;
+	const __u64 allowed_s1d3;
+	const __u64 allowed_s2d1;
+	const __u64 allowed_s2d2;
+	const __u64 allowed_s2d3;
+	const __u64 allowed_s2d4;
+	const __u64 allowed_s3d1;
+	const __u64 allowed_s3d2;
+	const __u64 allowed_s4d1;
+
+	/* Expected result of the call to open([fd:s1d3]/s1d41/f1, O_RDONLY). */
+	const int expected_read_result;
+	/*
+	 * Expected result of the call to renameat([fd:s1d3]/s1d41/f1,
+	 * [fd:s1d3]/s1d42/f1).
+	 */
+	const int expected_rename_result;
+	/*
+	 * Expected result of the call to renameat([fd:s1d3]/s1d41/f2,
+	 * [fd:s1d3]/s1d42/f3,  RENAME_EXCHANGE).
+	 */
+	const int expected_exchange_result;
+	/*
+	 * Expected result of the call to renameat([fd:s1d3]/s1d42/f4,
+	 * [fd:s1d3]/s1d42/f5).
+	 */
+	const int expected_same_dir_rename_result;
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d1_mount1_src_parent) {
+	/* clang-format on */
+	.allowed_s1d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d2_mount1_src_refer) {
+	/* clang-format on */
+	.allowed_s1d2 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d2_mount1_src_create) {
+	/* clang-format on */
+	.allowed_s1d2 = LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = EXDEV,
+	.expected_exchange_result = EXDEV,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d2_mount1_src_rename) {
+	/* clang-format on */
+	.allowed_s1d2 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d3_fd_refer) {
+	/* clang-format on */
+	.allowed_s1d3 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d3_fd_create) {
+	/* clang-format on */
+	.allowed_s1d3 = LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = EXDEV,
+	.expected_exchange_result = EXDEV,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d3_fd_rename) {
+	/* clang-format on */
+	.allowed_s1d3 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s1d3_fd_full) {
+	/* clang-format on */
+	.allowed_s1d3 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s2d1_mount2_src_parent) {
+	/* clang-format on */
+	.allowed_s2d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s2d2_mount2_src_refer) {
+	/* clang-format on */
+	.allowed_s2d2 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s2d2_mount2_src_create) {
+	/* clang-format on */
+	.allowed_s2d2 = LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = EXDEV,
+	.expected_exchange_result = EXDEV,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s2d2_mount2_src_rename) {
+	/* clang-format on */
+	.allowed_s2d2 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s2d3_mount1_dst_parent) {
+	/* clang-format on */
+	.allowed_s2d3 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s2d4_mount1_dst) {
+	/* clang-format on */
+	.allowed_s2d4 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s3d1_mount2_dst_parent_refer) {
+	/* clang-format on */
+	.allowed_s3d1 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s3d1_mount2_dst_parent_create) {
+	/* clang-format on */
+	.allowed_s3d1 = LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = 0,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = EXDEV,
+	.expected_exchange_result = EXDEV,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s3d1_mount2_dst_parent_rename) {
+	/* clang-format on */
+	.allowed_s3d1 = LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = 0,
+	.expected_rename_result = 0,
+	.expected_exchange_result = 0,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s3d2_mount1_dst) {
+	/* clang-format on */
+	.allowed_s3d2 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+/* clang-format off */
+FIXTURE_VARIANT_ADD(layout5_disconnected_branch, s4d1_rename_parent) {
+	/* clang-format on */
+	.allowed_s4d1 = LANDLOCK_ACCESS_FS_REFER |
+			LANDLOCK_ACCESS_FS_READ_FILE |
+			LANDLOCK_ACCESS_FS_EXECUTE |
+			LANDLOCK_ACCESS_FS_MAKE_REG,
+	.expected_read_result = EACCES,
+	.expected_same_dir_rename_result = EACCES,
+	.expected_rename_result = EACCES,
+	.expected_exchange_result = EACCES,
+};
+
+TEST_F_FORK(layout5_disconnected_branch, read_rename_exchange)
+{
+	const __u64 handled_access =
+		LANDLOCK_ACCESS_FS_REFER | LANDLOCK_ACCESS_FS_READ_FILE |
+		LANDLOCK_ACCESS_FS_EXECUTE | LANDLOCK_ACCESS_FS_MAKE_REG;
+	const struct rule rules[] = {
+		{
+			.path = TMP_DIR "/s1d1",
+			.access = variant->allowed_s1d1,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2",
+			.access = variant->allowed_s1d2,
+		},
+		{
+			.path = TMP_DIR "/s1d1/s1d2/s1d3",
+			.access = variant->allowed_s1d3,
+		},
+		{
+			.path = TMP_DIR "/s2d1",
+			.access = variant->allowed_s2d1,
+		},
+		{
+			.path = TMP_DIR "/s2d1/s2d2",
+			.access = variant->allowed_s2d2,
+		},
+		{
+			.path = TMP_DIR "/s2d1/s2d2/s2d3",
+			.access = variant->allowed_s2d3,
+		},
+		/* s2d4_fd */
+		{
+			.path = TMP_DIR "/s3d1",
+			.access = variant->allowed_s3d1,
+		},
+		/* s3d2_fd */
+		{
+			.path = TMP_DIR "/s4d1",
+			.access = variant->allowed_s4d1,
+		},
+		{},
+	};
+	int ruleset_fd, s1d3_bind_fd;
+
+	ruleset_fd = create_ruleset(_metadata, handled_access, rules);
+	ASSERT_LE(0, ruleset_fd);
+
+	/* Adds rules for the covered directories. */
+	if (variant->allowed_s2d4) {
+		ASSERT_EQ(0, landlock_add_rule(
+				     ruleset_fd, LANDLOCK_RULE_PATH_BENEATH,
+				     &(struct landlock_path_beneath_attr){
+					     .parent_fd = self->s2d4_fd,
+					     .allowed_access =
+						     variant->allowed_s2d4,
+				     },
+				     0));
+	}
+	EXPECT_EQ(0, close(self->s2d4_fd));
+
+	if (variant->allowed_s3d2) {
+		ASSERT_EQ(0, landlock_add_rule(
+				     ruleset_fd, LANDLOCK_RULE_PATH_BENEATH,
+				     &(struct landlock_path_beneath_attr){
+					     .parent_fd = self->s3d2_fd,
+					     .allowed_access =
+						     variant->allowed_s3d2,
+				     },
+				     0));
+	}
+	EXPECT_EQ(0, close(self->s3d2_fd));
+
+	s1d3_bind_fd = open(TMP_DIR "/s3d1/s3d2/s2d3/s2d4/s1d3",
+			    O_DIRECTORY | O_PATH | O_CLOEXEC);
+	ASSERT_LE(0, s1d3_bind_fd);
+
+	/* Disconnects and checks source and destination directories. */
+	EXPECT_EQ(0, test_open_rel(s1d3_bind_fd, "../../..", O_DIRECTORY));
+	/* Renames to make it accessible through s3d1/s1d41 */
+	ASSERT_EQ(0, test_renameat(AT_FDCWD, TMP_DIR "/s2d1/s2d2/s2d3",
+				   AT_FDCWD, TMP_DIR "/s4d1/s2d3"));
+	EXPECT_EQ(ENOENT, test_open_rel(s1d3_bind_fd, "../../..", O_DIRECTORY));
+
+	enforce_ruleset(_metadata, ruleset_fd);
+	EXPECT_EQ(0, close(ruleset_fd));
+
+	EXPECT_EQ(variant->expected_read_result,
+		  test_open_rel(s1d3_bind_fd, "s1d41/f1", O_RDONLY));
+
+	EXPECT_EQ(variant->expected_rename_result,
+		  test_renameat(s1d3_bind_fd, "s1d41/f1", s1d3_bind_fd,
+				"s1d42/f1"));
+	EXPECT_EQ(variant->expected_exchange_result,
+		  test_exchangeat(s1d3_bind_fd, "s1d41/f2", s1d3_bind_fd,
+				  "s1d42/f3"));
+
+	EXPECT_EQ(variant->expected_same_dir_rename_result,
+		  test_renameat(s1d3_bind_fd, "s1d42/f4", s1d3_bind_fd,
+				"s1d42/f5"));
+}
+
 #define LOWER_BASE TMP_DIR "/lower"
 #define LOWER_DATA LOWER_BASE "/data"
 static const char lower_fl1[] = LOWER_DATA "/fl1";
diff --git a/tools/testing/selftests/nolibc/Makefile.nolibc b/tools/testing/selftests/nolibc/Makefile.nolibc
index 0fb759ba992e..330e000baeb1 100644
--- a/tools/testing/selftests/nolibc/Makefile.nolibc
+++ b/tools/testing/selftests/nolibc/Makefile.nolibc
@@ -262,19 +262,22 @@ REPORT  ?= awk '/\[OK\][\r]*$$/{p++} /\[FAIL\][\r]*$$/{if (!f) printf("\n"); f++
 		if (f || !p || !done) printf("failure\n"); else if (s) printf("warning\n"); else printf("success\n");; \
 		printf("\nSee all results in %s\n", ARGV[1]); }'
 
+# Execute the toplevel kernel Makefile
+KBUILD_MAKE = $(MAKE) -C $(srctree) ARCH=$(ARCH) CROSS_COMPILE=$(CROSS_COMPILE) LLVM=
+
 help:
 	@echo "Supported targets under selftests/nolibc:"
 	@echo "  all               call the \"run\" target below"
 	@echo "  help              this help"
 	@echo "  sysroot           create the nolibc sysroot here (uses \$$ARCH)"
-	@echo "  nolibc-test       build the executable (uses \$$CC and \$$CROSS_COMPILE)"
+	@echo "  nolibc-test       build the executable (uses \$$CC or \$$CROSS_COMPILE)"
 	@echo "  libc-test         build an executable using the compiler's default libc instead"
 	@echo "  run-user          runs the executable under QEMU (uses \$$XARCH, \$$TEST)"
 	@echo "  initramfs.cpio    prepare the initramfs archive with nolibc-test"
 	@echo "  initramfs         prepare the initramfs tree with nolibc-test"
 	@echo "  defconfig         create a fresh new default config (uses \$$XARCH)"
-	@echo "  kernel            (re)build the kernel (uses \$$XARCH)"
-	@echo "  kernel-standalone (re)build the kernel with the initramfs (uses \$$XARCH)"
+	@echo "  kernel            (re)build the kernel (uses \$$XARCH, \$$CROSS_COMPILE)"
+	@echo "  kernel-standalone (re)build the kernel with the initramfs (uses \$$XARCH, \$$CROSS_COMPILE)"
 	@echo "  run               runs the kernel in QEMU after building it (uses \$$XARCH, \$$TEST)"
 	@echo "  rerun             runs a previously prebuilt kernel in QEMU (uses \$$XARCH, \$$TEST)"
 	@echo "  clean             clean the sysroot, initramfs, build and output files"
@@ -340,17 +343,17 @@ initramfs: nolibc-test
 	$(Q)cp nolibc-test initramfs/init
 
 defconfig:
-	$(Q)$(MAKE) -C $(srctree) ARCH=$(ARCH) CC=$(CC) CROSS_COMPILE=$(CROSS_COMPILE) $(DEFCONFIG)
+	$(Q)$(KBUILD_MAKE) $(DEFCONFIG)
 	$(Q)if [ -n "$(EXTRACONFIG)" ]; then \
 		$(srctree)/scripts/config --file $(objtree)/.config $(EXTRACONFIG); \
-		$(MAKE) -C $(srctree) ARCH=$(ARCH) CC=$(CC) CROSS_COMPILE=$(CROSS_COMPILE) olddefconfig < /dev/null; \
+		$(KBUILD_MAKE) olddefconfig < /dev/null; \
 	fi
 
 kernel:
-	$(Q)$(MAKE) -C $(srctree) ARCH=$(ARCH) CC=$(CC) CROSS_COMPILE=$(CROSS_COMPILE) $(IMAGE_NAME) < /dev/null
+	$(Q)$(KBUILD_MAKE) $(IMAGE_NAME) < /dev/null
 
 kernel-standalone: initramfs
-	$(Q)$(MAKE) -C $(srctree) ARCH=$(ARCH) CC=$(CC) CROSS_COMPILE=$(CROSS_COMPILE) $(IMAGE_NAME) CONFIG_INITRAMFS_SOURCE=$(CURDIR)/initramfs < /dev/null
+	$(Q)$(KBUILD_MAKE) $(IMAGE_NAME) CONFIG_INITRAMFS_SOURCE=$(CURDIR)/initramfs < /dev/null
 
 # run the tests after building the kernel
 run: kernel initramfs.cpio
diff --git a/tools/testing/selftests/nolibc/nolibc-test.c b/tools/testing/selftests/nolibc/nolibc-test.c
index a297ee0d6d07..29de21595fc9 100644
--- a/tools/testing/selftests/nolibc/nolibc-test.c
+++ b/tools/testing/selftests/nolibc/nolibc-test.c
@@ -196,8 +196,8 @@ int expect_zr(int expr, int llen)
 }
 
 
-#define EXPECT_NZ(cond, expr, val)			\
-	do { if (!(cond)) result(llen, SKIPPED); else ret += expect_nz(expr, llen; } while (0)
+#define EXPECT_NZ(cond, expr)				\
+	do { if (!(cond)) result(llen, SKIPPED); else ret += expect_nz(expr, llen); } while (0)
 
 static __attribute__((unused))
 int expect_nz(int expr, int llen)
@@ -686,7 +686,6 @@ int expect_strtox(int llen, void *func, const char *input, int base, intmax_t ex
 #define CASE_TEST(name) \
 	case __LINE__: llen += printf("%d %s", test, #name);
 
-/* constructors validate that they are executed in definition order */
 __attribute__((constructor))
 static void constructor1(void)
 {
@@ -1334,6 +1333,7 @@ int run_syscall(int min, int max)
 		CASE_TEST(chroot_root);       EXPECT_SYSZR(euid0, chroot("/")); break;
 		CASE_TEST(chroot_blah);       EXPECT_SYSER(1, chroot("/proc/self/blah"), -1, ENOENT); break;
 		CASE_TEST(chroot_exe);        EXPECT_SYSER(1, chroot(argv0), -1, ENOTDIR); break;
+		CASE_TEST(clock_nanosleep);   ts.tv_nsec = -1; EXPECT_EQ(1, EINVAL, clock_nanosleep(CLOCK_REALTIME, 0, &ts, NULL)); break;
 		CASE_TEST(close_m1);          EXPECT_SYSER(1, close(-1), -1, EBADF); break;
 		CASE_TEST(close_dup);         EXPECT_SYSZR(1, close(dup(0))); break;
 		CASE_TEST(dup_0);             tmp = dup(0);  EXPECT_SYSNE(1, tmp, -1); close(tmp); break;
diff --git a/tools/testing/selftests/seccomp/seccomp_bpf.c b/tools/testing/selftests/seccomp/seccomp_bpf.c
index 2cf6fc825d86..874f17763536 100644
--- a/tools/testing/selftests/seccomp/seccomp_bpf.c
+++ b/tools/testing/selftests/seccomp/seccomp_bpf.c
@@ -24,6 +24,7 @@
 #include <linux/filter.h>
 #include <sys/prctl.h>
 #include <sys/ptrace.h>
+#include <sys/time.h>
 #include <sys/user.h>
 #include <linux/prctl.h>
 #include <linux/ptrace.h>
@@ -3555,6 +3556,10 @@ static void signal_handler(int signal)
 		perror("write from signal");
 }
 
+static void signal_handler_nop(int signal)
+{
+}
+
 TEST(user_notification_signal)
 {
 	pid_t pid;
@@ -4827,6 +4832,132 @@ TEST(user_notification_wait_killable_fatal)
 	EXPECT_EQ(SIGTERM, WTERMSIG(status));
 }
 
+/* Ensure signals after the reply do not interrupt */
+TEST(user_notification_wait_killable_after_reply)
+{
+	int i, max_iter = 100000;
+	int listener, status;
+	int pipe_fds[2];
+	pid_t pid;
+	long ret;
+
+	ret = prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);
+	ASSERT_EQ(0, ret)
+	{
+		TH_LOG("Kernel does not support PR_SET_NO_NEW_PRIVS!");
+	}
+
+	listener = user_notif_syscall(
+		__NR_dup, SECCOMP_FILTER_FLAG_NEW_LISTENER |
+			  SECCOMP_FILTER_FLAG_WAIT_KILLABLE_RECV);
+	ASSERT_GE(listener, 0);
+
+	/*
+	 * Used to count invocations. One token is transferred from the child
+	 * to the parent per syscall invocation, the parent tries to take
+	 * one token per successful RECV. If the syscall is restarted after
+	 * RECV the parent will try to get two tokens while the child only
+	 * provided one.
+	 */
+	ASSERT_EQ(pipe(pipe_fds), 0);
+
+	pid = fork();
+	ASSERT_GE(pid, 0);
+
+	if (pid == 0) {
+		struct sigaction new_action = {
+			.sa_handler = signal_handler_nop,
+			.sa_flags = SA_RESTART,
+		};
+		struct itimerval timer = {
+			.it_value = { .tv_usec = 1000 },
+			.it_interval = { .tv_usec = 1000 },
+		};
+		char c = 'a';
+
+		close(pipe_fds[0]);
+
+		/* Setup the sigaction with SA_RESTART */
+		if (sigaction(SIGALRM, &new_action, NULL)) {
+			perror("sigaction");
+			exit(1);
+		}
+
+		/*
+		 * Kill with SIGALRM repeatedly, to try to hit the race when
+		 * handling the syscall.
+		 */
+		if (setitimer(ITIMER_REAL, &timer, NULL) < 0)
+			perror("setitimer");
+
+		for (i = 0; i < max_iter; ++i) {
+			int fd;
+
+			/* Send one token per iteration to catch repeats. */
+			if (write(pipe_fds[1], &c, sizeof(c)) != 1) {
+				perror("write");
+				exit(1);
+			}
+
+			fd = syscall(__NR_dup, 0);
+			if (fd < 0) {
+				perror("dup");
+				exit(1);
+			}
+			close(fd);
+		}
+
+		exit(0);
+	}
+
+	close(pipe_fds[1]);
+
+	for (i = 0; i < max_iter; ++i) {
+		struct seccomp_notif req = {};
+		struct seccomp_notif_addfd addfd = {};
+		struct pollfd pfd = {
+			.fd = pipe_fds[0],
+			.events = POLLIN,
+		};
+		char c;
+
+		/*
+		 * Try to receive one token. If it failed, one child syscall
+		 * was restarted after RECV and needed to be handled twice.
+		 */
+		ASSERT_EQ(poll(&pfd, 1, 1000), 1)
+			kill(pid, SIGKILL);
+
+		ASSERT_EQ(read(pipe_fds[0], &c, sizeof(c)), 1)
+			kill(pid, SIGKILL);
+
+		/*
+		 * Get the notification, reply to it as fast as possible to test
+		 * whether the child wrongly skips going into the non-preemptible
+		 * (TASK_KILLABLE) state.
+		 */
+		do
+			ret = ioctl(listener, SECCOMP_IOCTL_NOTIF_RECV, &req);
+		while (ret < 0 && errno == ENOENT); /* Accept interruptions before RECV */
+		ASSERT_EQ(ret, 0)
+			kill(pid, SIGKILL);
+
+		addfd.id = req.id;
+		addfd.flags = SECCOMP_ADDFD_FLAG_SEND;
+		addfd.srcfd = 0;
+		ASSERT_GE(ioctl(listener, SECCOMP_IOCTL_NOTIF_ADDFD, &addfd), 0)
+			kill(pid, SIGKILL);
+	}
+
+	/*
+	 * Wait for the process to exit, and make sure the process terminated
+	 * with a zero exit code..
+	 */
+	EXPECT_EQ(waitpid(pid, &status, 0), pid);
+	EXPECT_EQ(true, WIFEXITED(status));
+	EXPECT_EQ(0, WEXITSTATUS(status));
+}
+
 struct tsync_vs_thread_leader_args {
 	pthread_t leader;
 };
diff --git a/tools/testing/shared/linux.c b/tools/testing/shared/linux.c
index 0f97fb0d19e1..8c7257155958 100644
--- a/tools/testing/shared/linux.c
+++ b/tools/testing/shared/linux.c
@@ -16,21 +16,6 @@ int nr_allocated;
 int preempt_count;
 int test_verbose;
 
-struct kmem_cache {
-	pthread_mutex_t lock;
-	unsigned int size;
-	unsigned int align;
-	int nr_objs;
-	void *objs;
-	void (*ctor)(void *);
-	unsigned int non_kernel;
-	unsigned long nr_allocated;
-	unsigned long nr_tallocated;
-	bool exec_callback;
-	void (*callback)(void *);
-	void *private;
-};
-
 void kmem_cache_set_callback(struct kmem_cache *cachep, void (*callback)(void *))
 {
 	cachep->callback = callback;
@@ -79,7 +64,8 @@ void *kmem_cache_alloc_lru(struct kmem_cache *cachep, struct list_lru *lru,
 
 	if (!(gfp & __GFP_DIRECT_RECLAIM)) {
 		if (!cachep->non_kernel) {
-			cachep->exec_callback = true;
+			if (cachep->callback)
+				cachep->exec_callback = true;
 			return NULL;
 		}
 
@@ -152,6 +138,12 @@ void kmem_cache_free_bulk(struct kmem_cache *cachep, size_t size, void **list)
 	if (kmalloc_verbose)
 		pr_debug("Bulk free %p[0-%zu]\n", list, size - 1);
 
+	if (cachep->exec_callback) {
+		if (cachep->callback)
+			cachep->callback(cachep->private);
+		cachep->exec_callback = false;
+	}
+
 	pthread_mutex_lock(&cachep->lock);
 	for (int i = 0; i < size; i++)
 		kmem_cache_free_locked(cachep, list[i]);
@@ -219,6 +211,8 @@ int kmem_cache_alloc_bulk(struct kmem_cache *cachep, gfp_t gfp, size_t size,
 		for (i = 0; i < size; i++)
 			__kmem_cache_free_locked(cachep, p[i]);
 		pthread_mutex_unlock(&cachep->lock);
+		if (cachep->callback)
+			cachep->exec_callback = true;
 		return 0;
 	}
 
@@ -234,26 +228,112 @@ int kmem_cache_alloc_bulk(struct kmem_cache *cachep, gfp_t gfp, size_t size,
 }
 
 struct kmem_cache *
-kmem_cache_create(const char *name, unsigned int size, unsigned int align,
-		unsigned int flags, void (*ctor)(void *))
+__kmem_cache_create_args(const char *name, unsigned int size,
+			  struct kmem_cache_args *args,
+			  unsigned int flags)
 {
 	struct kmem_cache *ret = malloc(sizeof(*ret));
 
 	pthread_mutex_init(&ret->lock, NULL);
 	ret->size = size;
-	ret->align = align;
+	ret->align = args->align;
+	ret->sheaf_capacity = args->sheaf_capacity;
 	ret->nr_objs = 0;
 	ret->nr_allocated = 0;
 	ret->nr_tallocated = 0;
 	ret->objs = NULL;
-	ret->ctor = ctor;
+	ret->ctor = args->ctor;
 	ret->non_kernel = 0;
 	ret->exec_callback = false;
 	ret->callback = NULL;
 	ret->private = NULL;
+
 	return ret;
 }
 
+struct slab_sheaf *
+kmem_cache_prefill_sheaf(struct kmem_cache *s, gfp_t gfp, unsigned int size)
+{
+	struct slab_sheaf *sheaf;
+	unsigned int capacity;
+
+	if (s->exec_callback) {
+		if (s->callback)
+			s->callback(s->private);
+		s->exec_callback = false;
+	}
+
+	capacity = max(size, s->sheaf_capacity);
+
+	sheaf = calloc(1, sizeof(*sheaf) + sizeof(void *) * capacity);
+	if (!sheaf)
+		return NULL;
+
+	sheaf->cache = s;
+	sheaf->capacity = capacity;
+	sheaf->size = kmem_cache_alloc_bulk(s, gfp, size, sheaf->objects);
+	if (!sheaf->size) {
+		free(sheaf);
+		return NULL;
+	}
+
+	return sheaf;
+}
+
+int kmem_cache_refill_sheaf(struct kmem_cache *s, gfp_t gfp,
+		 struct slab_sheaf **sheafp, unsigned int size)
+{
+	struct slab_sheaf *sheaf = *sheafp;
+	int refill;
+
+	if (sheaf->size >= size)
+		return 0;
+
+	if (size > sheaf->capacity) {
+		sheaf = kmem_cache_prefill_sheaf(s, gfp, size);
+		if (!sheaf)
+			return -ENOMEM;
+
+		kmem_cache_return_sheaf(s, gfp, *sheafp);
+		*sheafp = sheaf;
+		return 0;
+	}
+
+	refill = kmem_cache_alloc_bulk(s, gfp, size - sheaf->size,
+				       &sheaf->objects[sheaf->size]);
+	if (!refill)
+		return -ENOMEM;
+
+	sheaf->size += refill;
+	return 0;
+}
+
+void kmem_cache_return_sheaf(struct kmem_cache *s, gfp_t gfp,
+		 struct slab_sheaf *sheaf)
+{
+	if (sheaf->size)
+		kmem_cache_free_bulk(s, sheaf->size, &sheaf->objects[0]);
+
+	free(sheaf);
+}
+
+void *
+kmem_cache_alloc_from_sheaf(struct kmem_cache *s, gfp_t gfp,
+		struct slab_sheaf *sheaf)
+{
+	void *obj;
+
+	if (sheaf->size == 0) {
+		printf("Nothing left in sheaf!\n");
+		return NULL;
+	}
+
+	obj = sheaf->objects[--sheaf->size];
+	sheaf->objects[sheaf->size] = NULL;
+
+	return obj;
+}
+
 /*
  * Test the test infrastructure for kem_cache_alloc/free and bulk counterparts.
  */
diff --git a/tools/testing/shared/maple-shared.h b/tools/testing/shared/maple-shared.h
index dc4d30f3860b..2a1e9a8594a2 100644
--- a/tools/testing/shared/maple-shared.h
+++ b/tools/testing/shared/maple-shared.h
@@ -10,4 +10,15 @@
 #include <time.h>
 #include "linux/init.h"
 
+void maple_rcu_cb(struct rcu_head *head);
+#define rcu_cb		maple_rcu_cb
+
+#define kfree_rcu(_struct, _memb)		\
+do {                                            \
+    typeof(_struct) _p_struct = (_struct);      \
+                                                \
+    call_rcu(&((_p_struct)->_memb), rcu_cb);    \
+} while(0);
+
+
 #endif /* __MAPLE_SHARED_H__ */
diff --git a/tools/testing/shared/maple-shim.c b/tools/testing/shared/maple-shim.c
index 640df76f483e..16252ee616c0 100644
--- a/tools/testing/shared/maple-shim.c
+++ b/tools/testing/shared/maple-shim.c
@@ -3,5 +3,12 @@
 /* Very simple shim around the maple tree. */
 
 #include "maple-shared.h"
+#include <linux/slab.h>
 
 #include "../../../lib/maple_tree.c"
+
+void maple_rcu_cb(struct rcu_head *head) {
+	struct maple_node *node = container_of(head, struct maple_node, rcu);
+
+	kmem_cache_free(maple_node_cache, node);
+}
diff --git a/tools/testing/vma/vma_internal.h b/tools/testing/vma/vma_internal.h
index 07167446dcf4..dc976a285ad2 100644
--- a/tools/testing/vma/vma_internal.h
+++ b/tools/testing/vma/vma_internal.h
@@ -27,6 +27,7 @@
 #include <linux/mm.h>
 #include <linux/rbtree.h>
 #include <linux/refcount.h>
+#include <linux/slab.h>
 
 extern unsigned long stack_guard_gap;
 #ifdef CONFIG_MMU
@@ -527,65 +528,6 @@ struct pagetable_move_control {
 		.len_in = len_,						\
 	}
 
-struct kmem_cache_args {
-	/**
-	 * @align: The required alignment for the objects.
-	 *
-	 * %0 means no specific alignment is requested.
-	 */
-	unsigned int align;
-	/**
-	 * @useroffset: Usercopy region offset.
-	 *
-	 * %0 is a valid offset, when @usersize is non-%0
-	 */
-	unsigned int useroffset;
-	/**
-	 * @usersize: Usercopy region size.
-	 *
-	 * %0 means no usercopy region is specified.
-	 */
-	unsigned int usersize;
-	/**
-	 * @freeptr_offset: Custom offset for the free pointer
-	 * in &SLAB_TYPESAFE_BY_RCU caches
-	 *
-	 * By default &SLAB_TYPESAFE_BY_RCU caches place the free pointer
-	 * outside of the object. This might cause the object to grow in size.
-	 * Cache creators that have a reason to avoid this can specify a custom
-	 * free pointer offset in their struct where the free pointer will be
-	 * placed.
-	 *
-	 * Note that placing the free pointer inside the object requires the
-	 * caller to ensure that no fields are invalidated that are required to
-	 * guard against object recycling (See &SLAB_TYPESAFE_BY_RCU for
-	 * details).
-	 *
-	 * Using %0 as a value for @freeptr_offset is valid. If @freeptr_offset
-	 * is specified, %use_freeptr_offset must be set %true.
-	 *
-	 * Note that @ctor currently isn't supported with custom free pointers
-	 * as a @ctor requires an external free pointer.
-	 */
-	unsigned int freeptr_offset;
-	/**
-	 * @use_freeptr_offset: Whether a @freeptr_offset is used.
-	 */
-	bool use_freeptr_offset;
-	/**
-	 * @ctor: A constructor for the objects.
-	 *
-	 * The constructor is invoked for each object in a newly allocated slab
-	 * page. It is the cache user's responsibility to free object in the
-	 * same state as after calling the constructor, or deal appropriately
-	 * with any differences between a freshly constructed and a reallocated
-	 * object.
-	 *
-	 * %NULL means no constructor.
-	 */
-	void (*ctor)(void *);
-};
-
 static inline void vma_iter_invalidate(struct vma_iterator *vmi)
 {
 	mas_pause(&vmi->mas);
@@ -670,40 +612,6 @@ static inline void vma_init(struct vm_area_struct *vma, struct mm_struct *mm)
 	vma->vm_lock_seq = UINT_MAX;
 }
 
-struct kmem_cache {
-	const char *name;
-	size_t object_size;
-	struct kmem_cache_args *args;
-};
-
-static inline struct kmem_cache *__kmem_cache_create(const char *name,
-						     size_t object_size,
-						     struct kmem_cache_args *args)
-{
-	struct kmem_cache *ret = malloc(sizeof(struct kmem_cache));
-
-	ret->name = name;
-	ret->object_size = object_size;
-	ret->args = args;
-
-	return ret;
-}
-
-#define kmem_cache_create(__name, __object_size, __args, ...)           \
-	__kmem_cache_create((__name), (__object_size), (__args))
-
-static inline void *kmem_cache_alloc(struct kmem_cache *s, gfp_t gfpflags)
-{
-	(void)gfpflags;
-
-	return calloc(s->object_size, 1);
-}
-
-static inline void kmem_cache_free(struct kmem_cache *s, void *x)
-{
-	free(x);
-}
-
 /*
  * These are defined in vma.h, but sadly vm_stat_account() is referenced by
  * kernel/fork.c, so we have to these broadly available there, and temporarily
@@ -860,11 +768,11 @@ static inline unsigned long vma_pages(struct vm_area_struct *vma)
 	return (vma->vm_end - vma->vm_start) >> PAGE_SHIFT;
 }
 
-static inline void fput(struct file *)
+static inline void fput(struct file *file)
 {
 }
 
-static inline void mpol_put(struct mempolicy *)
+static inline void mpol_put(struct mempolicy *pol)
 {
 }
 
@@ -872,15 +780,15 @@ static inline void lru_add_drain(void)
 {
 }
 
-static inline void tlb_gather_mmu(struct mmu_gather *, struct mm_struct *)
+static inline void tlb_gather_mmu(struct mmu_gather *tlb, struct mm_struct *mm)
 {
 }
 
-static inline void update_hiwater_rss(struct mm_struct *)
+static inline void update_hiwater_rss(struct mm_struct *mm)
 {
 }
 
-static inline void update_hiwater_vm(struct mm_struct *)
+static inline void update_hiwater_vm(struct mm_struct *mm)
 {
 }
 
@@ -889,36 +797,23 @@ static inline void unmap_vmas(struct mmu_gather *tlb, struct ma_state *mas,
 		      unsigned long end_addr, unsigned long tree_end,
 		      bool mm_wr_locked)
 {
-	(void)tlb;
-	(void)mas;
-	(void)vma;
-	(void)start_addr;
-	(void)end_addr;
-	(void)tree_end;
-	(void)mm_wr_locked;
 }
 
 static inline void free_pgtables(struct mmu_gather *tlb, struct ma_state *mas,
 		   struct vm_area_struct *vma, unsigned long floor,
 		   unsigned long ceiling, bool mm_wr_locked)
 {
-	(void)tlb;
-	(void)mas;
-	(void)vma;
-	(void)floor;
-	(void)ceiling;
-	(void)mm_wr_locked;
 }
 
-static inline void mapping_unmap_writable(struct address_space *)
+static inline void mapping_unmap_writable(struct address_space *mapping)
 {
 }
 
-static inline void flush_dcache_mmap_lock(struct address_space *)
+static inline void flush_dcache_mmap_lock(struct address_space *mapping)
 {
 }
 
-static inline void tlb_finish_mmu(struct mmu_gather *)
+static inline void tlb_finish_mmu(struct mmu_gather *tlb)
 {
 }
 
@@ -927,7 +822,7 @@ static inline struct file *get_file(struct file *f)
 	return f;
 }
 
-static inline int vma_dup_policy(struct vm_area_struct *, struct vm_area_struct *)
+static inline int vma_dup_policy(struct vm_area_struct *src, struct vm_area_struct *dst)
 {
 	return 0;
 }
@@ -954,10 +849,6 @@ static inline void vma_adjust_trans_huge(struct vm_area_struct *vma,
 					 unsigned long end,
 					 struct vm_area_struct *next)
 {
-	(void)vma;
-	(void)start;
-	(void)end;
-	(void)next;
 }
 
 static inline void hugetlb_split(struct vm_area_struct *, unsigned long) {}
@@ -977,51 +868,48 @@ static inline void vm_acct_memory(long pages)
 {
 }
 
-static inline void vma_interval_tree_insert(struct vm_area_struct *,
-					    struct rb_root_cached *)
+static inline void vma_interval_tree_insert(struct vm_area_struct *vma,
+					    struct rb_root_cached *rb)
 {
 }
 
-static inline void vma_interval_tree_remove(struct vm_area_struct *,
-					    struct rb_root_cached *)
+static inline void vma_interval_tree_remove(struct vm_area_struct *vma,
+					    struct rb_root_cached *rb)
 {
 }
 
-static inline void flush_dcache_mmap_unlock(struct address_space *)
+static inline void flush_dcache_mmap_unlock(struct address_space *mapping)
 {
 }
 
-static inline void anon_vma_interval_tree_insert(struct anon_vma_chain*,
-						 struct rb_root_cached *)
+static inline void anon_vma_interval_tree_insert(struct anon_vma_chain *avc,
+						 struct rb_root_cached *rb)
 {
 }
 
-static inline void anon_vma_interval_tree_remove(struct anon_vma_chain*,
-						 struct rb_root_cached *)
+static inline void anon_vma_interval_tree_remove(struct anon_vma_chain *avc,
+						 struct rb_root_cached *rb)
 {
 }
 
-static inline void uprobe_mmap(struct vm_area_struct *)
+static inline void uprobe_mmap(struct vm_area_struct *vma)
 {
 }
 
 static inline void uprobe_munmap(struct vm_area_struct *vma,
 				 unsigned long start, unsigned long end)
 {
-	(void)vma;
-	(void)start;
-	(void)end;
 }
 
-static inline void i_mmap_lock_write(struct address_space *)
+static inline void i_mmap_lock_write(struct address_space *mapping)
 {
 }
 
-static inline void anon_vma_lock_write(struct anon_vma *)
+static inline void anon_vma_lock_write(struct anon_vma *anon_vma)
 {
 }
 
-static inline void vma_assert_write_locked(struct vm_area_struct *)
+static inline void vma_assert_write_locked(struct vm_area_struct *vma)
 {
 }
 
@@ -1031,16 +919,16 @@ static inline void unlink_anon_vmas(struct vm_area_struct *vma)
 	vma->anon_vma->was_unlinked = true;
 }
 
-static inline void anon_vma_unlock_write(struct anon_vma *)
+static inline void anon_vma_unlock_write(struct anon_vma *anon_vma)
 {
 }
 
-static inline void i_mmap_unlock_write(struct address_space *)
+static inline void i_mmap_unlock_write(struct address_space *mapping)
 {
 }
 
-static inline void anon_vma_merge(struct vm_area_struct *,
-				  struct vm_area_struct *)
+static inline void anon_vma_merge(struct vm_area_struct *vma,
+				  struct vm_area_struct *next)
 {
 }
 
@@ -1049,27 +937,22 @@ static inline int userfaultfd_unmap_prep(struct vm_area_struct *vma,
 					 unsigned long end,
 					 struct list_head *unmaps)
 {
-	(void)vma;
-	(void)start;
-	(void)end;
-	(void)unmaps;
-
 	return 0;
 }
 
-static inline void mmap_write_downgrade(struct mm_struct *)
+static inline void mmap_write_downgrade(struct mm_struct *mm)
 {
 }
 
-static inline void mmap_read_unlock(struct mm_struct *)
+static inline void mmap_read_unlock(struct mm_struct *mm)
 {
 }
 
-static inline void mmap_write_unlock(struct mm_struct *)
+static inline void mmap_write_unlock(struct mm_struct *mm)
 {
 }
 
-static inline int mmap_write_lock_killable(struct mm_struct *)
+static inline int mmap_write_lock_killable(struct mm_struct *mm)
 {
 	return 0;
 }
@@ -1078,10 +961,6 @@ static inline bool can_modify_mm(struct mm_struct *mm,
 				 unsigned long start,
 				 unsigned long end)
 {
-	(void)mm;
-	(void)start;
-	(void)end;
-
 	return true;
 }
 
@@ -1089,16 +968,13 @@ static inline void arch_unmap(struct mm_struct *mm,
 				 unsigned long start,
 				 unsigned long end)
 {
-	(void)mm;
-	(void)start;
-	(void)end;
 }
 
-static inline void mmap_assert_locked(struct mm_struct *)
+static inline void mmap_assert_locked(struct mm_struct *mm)
 {
 }
 
-static inline bool mpol_equal(struct mempolicy *, struct mempolicy *)
+static inline bool mpol_equal(struct mempolicy *a, struct mempolicy *b)
 {
 	return true;
 }
@@ -1106,63 +982,62 @@ static inline bool mpol_equal(struct mempolicy *, struct mempolicy *)
 static inline void khugepaged_enter_vma(struct vm_area_struct *vma,
 			  vm_flags_t vm_flags)
 {
-	(void)vma;
-	(void)vm_flags;
 }
 
-static inline bool mapping_can_writeback(struct address_space *)
+static inline bool mapping_can_writeback(struct address_space *mapping)
 {
 	return true;
 }
 
-static inline bool is_vm_hugetlb_page(struct vm_area_struct *)
+static inline bool is_vm_hugetlb_page(struct vm_area_struct *vma)
 {
 	return false;
 }
 
-static inline bool vma_soft_dirty_enabled(struct vm_area_struct *)
+static inline bool vma_soft_dirty_enabled(struct vm_area_struct *vma)
 {
 	return false;
 }
 
-static inline bool userfaultfd_wp(struct vm_area_struct *)
+static inline bool userfaultfd_wp(struct vm_area_struct *vma)
 {
 	return false;
 }
 
-static inline void mmap_assert_write_locked(struct mm_struct *)
+static inline void mmap_assert_write_locked(struct mm_struct *mm)
 {
 }
 
-static inline void mutex_lock(struct mutex *)
+static inline void mutex_lock(struct mutex *lock)
 {
 }
 
-static inline void mutex_unlock(struct mutex *)
+static inline void mutex_unlock(struct mutex *lock)
 {
 }
 
-static inline bool mutex_is_locked(struct mutex *)
+static inline bool mutex_is_locked(struct mutex *lock)
 {
 	return true;
 }
 
-static inline bool signal_pending(void *)
+static inline bool signal_pending(void *p)
 {
 	return false;
 }
 
-static inline bool is_file_hugepages(struct file *)
+static inline bool is_file_hugepages(struct file *file)
 {
 	return false;
 }
 
-static inline int security_vm_enough_memory_mm(struct mm_struct *, long)
+static inline int security_vm_enough_memory_mm(struct mm_struct *mm, long pages)
 {
 	return 0;
 }
 
-static inline bool may_expand_vm(struct mm_struct *, vm_flags_t, unsigned long)
+static inline bool may_expand_vm(struct mm_struct *mm, vm_flags_t flags,
+				 unsigned long npages)
 {
 	return true;
 }
@@ -1187,7 +1062,7 @@ static inline void vm_flags_clear(struct vm_area_struct *vma,
 	vma->__vm_flags &= ~flags;
 }
 
-static inline int shmem_zero_setup(struct vm_area_struct *)
+static inline int shmem_zero_setup(struct vm_area_struct *vma)
 {
 	return 0;
 }
@@ -1197,20 +1072,20 @@ static inline void vma_set_anonymous(struct vm_area_struct *vma)
 	vma->vm_ops = NULL;
 }
 
-static inline void ksm_add_vma(struct vm_area_struct *)
+static inline void ksm_add_vma(struct vm_area_struct *vma)
 {
 }
 
-static inline void perf_event_mmap(struct vm_area_struct *)
+static inline void perf_event_mmap(struct vm_area_struct *vma)
 {
 }
 
-static inline bool vma_is_dax(struct vm_area_struct *)
+static inline bool vma_is_dax(struct vm_area_struct *vma)
 {
 	return false;
 }
 
-static inline struct vm_area_struct *get_gate_vma(struct mm_struct *)
+static inline struct vm_area_struct *get_gate_vma(struct mm_struct *mm)
 {
 	return NULL;
 }
@@ -1235,16 +1110,16 @@ static inline void vma_set_page_prot(struct vm_area_struct *vma)
 	WRITE_ONCE(vma->vm_page_prot, vm_page_prot);
 }
 
-static inline bool arch_validate_flags(vm_flags_t)
+static inline bool arch_validate_flags(vm_flags_t flags)
 {
 	return true;
 }
 
-static inline void vma_close(struct vm_area_struct *)
+static inline void vma_close(struct vm_area_struct *vma)
 {
 }
 
-static inline int mmap_file(struct file *, struct vm_area_struct *)
+static inline int mmap_file(struct file *file, struct vm_area_struct *vma)
 {
 	return 0;
 }
@@ -1406,8 +1281,6 @@ static inline int mapping_map_writable(struct address_space *mapping)
 
 static inline unsigned long move_page_tables(struct pagetable_move_control *pmc)
 {
-	(void)pmc;
-
 	return 0;
 }
 
@@ -1415,51 +1288,38 @@ static inline void free_pgd_range(struct mmu_gather *tlb,
 			unsigned long addr, unsigned long end,
 			unsigned long floor, unsigned long ceiling)
 {
-	(void)tlb;
-	(void)addr;
-	(void)end;
-	(void)floor;
-	(void)ceiling;
 }
 
 static inline int ksm_execve(struct mm_struct *mm)
 {
-	(void)mm;
-
 	return 0;
 }
 
 static inline void ksm_exit(struct mm_struct *mm)
 {
-	(void)mm;
 }
 
 static inline void vma_lock_init(struct vm_area_struct *vma, bool reset_refcnt)
 {
-	(void)vma;
-	(void)reset_refcnt;
+	if (reset_refcnt)
+		refcount_set(&vma->vm_refcnt, 0);
 }
 
 static inline void vma_numab_state_init(struct vm_area_struct *vma)
 {
-	(void)vma;
 }
 
 static inline void vma_numab_state_free(struct vm_area_struct *vma)
 {
-	(void)vma;
 }
 
 static inline void dup_anon_vma_name(struct vm_area_struct *orig_vma,
 				     struct vm_area_struct *new_vma)
 {
-	(void)orig_vma;
-	(void)new_vma;
 }
 
 static inline void free_anon_vma_name(struct vm_area_struct *vma)
 {
-	(void)vma;
 }
 
 /* Declared in vma.h. */
@@ -1526,7 +1386,6 @@ static inline int vfs_mmap_prepare(struct file *file, struct vm_area_desc *desc)
 
 static inline void fixup_hugetlb_reservations(struct vm_area_struct *vma)
 {
-	(void)vma;
 }
 
 static inline void vma_set_file(struct vm_area_struct *vma, struct file *file)
@@ -1537,13 +1396,13 @@ static inline void vma_set_file(struct vm_area_struct *vma, struct file *file)
 	fput(file);
 }
 
-static inline bool shmem_file(struct file *)
+static inline bool shmem_file(struct file *file)
 {
 	return false;
 }
 
-static inline vm_flags_t ksm_vma_flags(const struct mm_struct *, const struct file *,
-			 vm_flags_t vm_flags)
+static inline vm_flags_t ksm_vma_flags(const struct mm_struct *mm,
+		const struct file *file, vm_flags_t vm_flags)
 {
 	return vm_flags;
 }
diff --git a/virt/kvm/Kconfig b/virt/kvm/Kconfig
index 1b7d5be0b6c4..0227e13cd8dd 100644
--- a/virt/kvm/Kconfig
+++ b/virt/kvm/Kconfig
@@ -87,7 +87,7 @@ config HAVE_KVM_VCPU_RUN_PID_CHANGE
 config HAVE_KVM_NO_POLL
        bool
 
-config KVM_XFER_TO_GUEST_WORK
+config VIRT_XFER_TO_GUEST_WORK
        bool
 
 config HAVE_KVM_PM_NOTIFIER